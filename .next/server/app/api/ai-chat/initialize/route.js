/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/ai-chat/initialize/route";
exports.ids = ["app/api/ai-chat/initialize/route"];
exports.modules = {

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader/index.js?name=app%2Fapi%2Fai-chat%2Finitialize%2Froute&page=%2Fapi%2Fai-chat%2Finitialize%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fai-chat%2Finitialize%2Froute.ts&appDir=%2FUsers%2Frodrigodibernardo33gmail.com%2FDocuments%2FApp%20Development%20Proyects%2FIntellego%20Platform%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Frodrigodibernardo33gmail.com%2FDocuments%2FApp%20Development%20Proyects%2FIntellego%20Platform&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!":
/*!**********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-app-loader/index.js?name=app%2Fapi%2Fai-chat%2Finitialize%2Froute&page=%2Fapi%2Fai-chat%2Finitialize%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fai-chat%2Finitialize%2Froute.ts&appDir=%2FUsers%2Frodrigodibernardo33gmail.com%2FDocuments%2FApp%20Development%20Proyects%2FIntellego%20Platform%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Frodrigodibernardo33gmail.com%2FDocuments%2FApp%20Development%20Proyects%2FIntellego%20Platform&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D! ***!
  \**********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   workAsyncStorage: () => (/* binding */ workAsyncStorage),\n/* harmony export */   workUnitAsyncStorage: () => (/* binding */ workUnitAsyncStorage)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/route-modules/app-route/module.compiled */ \"(rsc)/./node_modules/next/dist/server/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/route-kind */ \"(rsc)/./node_modules/next/dist/server/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/./node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var _Users_rodrigodibernardo33gmail_com_Documents_App_Development_Proyects_Intellego_Platform_src_app_api_ai_chat_initialize_route_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./src/app/api/ai-chat/initialize/route.ts */ \"(rsc)/./src/app/api/ai-chat/initialize/route.ts\");\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new next_dist_server_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/ai-chat/initialize/route\",\n        pathname: \"/api/ai-chat/initialize\",\n        filename: \"route\",\n        bundlePath: \"app/api/ai-chat/initialize/route\"\n    },\n    resolvedPagePath: \"/Users/rodrigodibernardo33gmail.com/Documents/App Development Proyects/Intellego Platform/src/app/api/ai-chat/initialize/route.ts\",\n    nextConfigOutput,\n    userland: _Users_rodrigodibernardo33gmail_com_Documents_App_Development_Proyects_Intellego_Platform_src_app_api_ai_chat_initialize_route_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { workAsyncStorage, workUnitAsyncStorage, serverHooks } = routeModule;\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        workAsyncStorage,\n        workUnitAsyncStorage\n    });\n}\n\n\n//# sourceMappingURL=app-route.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LWFwcC1sb2FkZXIvaW5kZXguanM/bmFtZT1hcHAlMkZhcGklMkZhaS1jaGF0JTJGaW5pdGlhbGl6ZSUyRnJvdXRlJnBhZ2U9JTJGYXBpJTJGYWktY2hhdCUyRmluaXRpYWxpemUlMkZyb3V0ZSZhcHBQYXRocz0mcGFnZVBhdGg9cHJpdmF0ZS1uZXh0LWFwcC1kaXIlMkZhcGklMkZhaS1jaGF0JTJGaW5pdGlhbGl6ZSUyRnJvdXRlLnRzJmFwcERpcj0lMkZVc2VycyUyRnJvZHJpZ29kaWJlcm5hcmRvMzNnbWFpbC5jb20lMkZEb2N1bWVudHMlMkZBcHAlMjBEZXZlbG9wbWVudCUyMFByb3llY3RzJTJGSW50ZWxsZWdvJTIwUGxhdGZvcm0lMkZzcmMlMkZhcHAmcGFnZUV4dGVuc2lvbnM9dHN4JnBhZ2VFeHRlbnNpb25zPXRzJnBhZ2VFeHRlbnNpb25zPWpzeCZwYWdlRXh0ZW5zaW9ucz1qcyZyb290RGlyPSUyRlVzZXJzJTJGcm9kcmlnb2RpYmVybmFyZG8zM2dtYWlsLmNvbSUyRkRvY3VtZW50cyUyRkFwcCUyMERldmVsb3BtZW50JTIwUHJveWVjdHMlMkZJbnRlbGxlZ28lMjBQbGF0Zm9ybSZpc0Rldj10cnVlJnRzY29uZmlnUGF0aD10c2NvbmZpZy5qc29uJmJhc2VQYXRoPSZhc3NldFByZWZpeD0mbmV4dENvbmZpZ091dHB1dD0mcHJlZmVycmVkUmVnaW9uPSZtaWRkbGV3YXJlQ29uZmlnPWUzMCUzRCEiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7QUFBK0Y7QUFDdkM7QUFDcUI7QUFDaUY7QUFDOUo7QUFDQTtBQUNBO0FBQ0Esd0JBQXdCLHlHQUFtQjtBQUMzQztBQUNBLGNBQWMsa0VBQVM7QUFDdkI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLFlBQVk7QUFDWixDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0EsUUFBUSxzREFBc0Q7QUFDOUQ7QUFDQSxXQUFXLDRFQUFXO0FBQ3RCO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDMEY7O0FBRTFGIiwic291cmNlcyI6WyIiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQXBwUm91dGVSb3V0ZU1vZHVsZSB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL3JvdXRlLW1vZHVsZXMvYXBwLXJvdXRlL21vZHVsZS5jb21waWxlZFwiO1xuaW1wb3J0IHsgUm91dGVLaW5kIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvcm91dGUta2luZFwiO1xuaW1wb3J0IHsgcGF0Y2hGZXRjaCBhcyBfcGF0Y2hGZXRjaCB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2xpYi9wYXRjaC1mZXRjaFwiO1xuaW1wb3J0ICogYXMgdXNlcmxhbmQgZnJvbSBcIi9Vc2Vycy9yb2RyaWdvZGliZXJuYXJkbzMzZ21haWwuY29tL0RvY3VtZW50cy9BcHAgRGV2ZWxvcG1lbnQgUHJveWVjdHMvSW50ZWxsZWdvIFBsYXRmb3JtL3NyYy9hcHAvYXBpL2FpLWNoYXQvaW5pdGlhbGl6ZS9yb3V0ZS50c1wiO1xuLy8gV2UgaW5qZWN0IHRoZSBuZXh0Q29uZmlnT3V0cHV0IGhlcmUgc28gdGhhdCB3ZSBjYW4gdXNlIHRoZW0gaW4gdGhlIHJvdXRlXG4vLyBtb2R1bGUuXG5jb25zdCBuZXh0Q29uZmlnT3V0cHV0ID0gXCJcIlxuY29uc3Qgcm91dGVNb2R1bGUgPSBuZXcgQXBwUm91dGVSb3V0ZU1vZHVsZSh7XG4gICAgZGVmaW5pdGlvbjoge1xuICAgICAgICBraW5kOiBSb3V0ZUtpbmQuQVBQX1JPVVRFLFxuICAgICAgICBwYWdlOiBcIi9hcGkvYWktY2hhdC9pbml0aWFsaXplL3JvdXRlXCIsXG4gICAgICAgIHBhdGhuYW1lOiBcIi9hcGkvYWktY2hhdC9pbml0aWFsaXplXCIsXG4gICAgICAgIGZpbGVuYW1lOiBcInJvdXRlXCIsXG4gICAgICAgIGJ1bmRsZVBhdGg6IFwiYXBwL2FwaS9haS1jaGF0L2luaXRpYWxpemUvcm91dGVcIlxuICAgIH0sXG4gICAgcmVzb2x2ZWRQYWdlUGF0aDogXCIvVXNlcnMvcm9kcmlnb2RpYmVybmFyZG8zM2dtYWlsLmNvbS9Eb2N1bWVudHMvQXBwIERldmVsb3BtZW50IFByb3llY3RzL0ludGVsbGVnbyBQbGF0Zm9ybS9zcmMvYXBwL2FwaS9haS1jaGF0L2luaXRpYWxpemUvcm91dGUudHNcIixcbiAgICBuZXh0Q29uZmlnT3V0cHV0LFxuICAgIHVzZXJsYW5kXG59KTtcbi8vIFB1bGwgb3V0IHRoZSBleHBvcnRzIHRoYXQgd2UgbmVlZCB0byBleHBvc2UgZnJvbSB0aGUgbW9kdWxlLiBUaGlzIHNob3VsZFxuLy8gYmUgZWxpbWluYXRlZCB3aGVuIHdlJ3ZlIG1vdmVkIHRoZSBvdGhlciByb3V0ZXMgdG8gdGhlIG5ldyBmb3JtYXQuIFRoZXNlXG4vLyBhcmUgdXNlZCB0byBob29rIGludG8gdGhlIHJvdXRlLlxuY29uc3QgeyB3b3JrQXN5bmNTdG9yYWdlLCB3b3JrVW5pdEFzeW5jU3RvcmFnZSwgc2VydmVySG9va3MgfSA9IHJvdXRlTW9kdWxlO1xuZnVuY3Rpb24gcGF0Y2hGZXRjaCgpIHtcbiAgICByZXR1cm4gX3BhdGNoRmV0Y2goe1xuICAgICAgICB3b3JrQXN5bmNTdG9yYWdlLFxuICAgICAgICB3b3JrVW5pdEFzeW5jU3RvcmFnZVxuICAgIH0pO1xufVxuZXhwb3J0IHsgcm91dGVNb2R1bGUsIHdvcmtBc3luY1N0b3JhZ2UsIHdvcmtVbml0QXN5bmNTdG9yYWdlLCBzZXJ2ZXJIb29rcywgcGF0Y2hGZXRjaCwgIH07XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWFwcC1yb3V0ZS5qcy5tYXAiXSwibmFtZXMiOltdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader/index.js?name=app%2Fapi%2Fai-chat%2Finitialize%2Froute&page=%2Fapi%2Fai-chat%2Finitialize%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fai-chat%2Finitialize%2Froute.ts&appDir=%2FUsers%2Frodrigodibernardo33gmail.com%2FDocuments%2FApp%20Development%20Proyects%2FIntellego%20Platform%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Frodrigodibernardo33gmail.com%2FDocuments%2FApp%20Development%20Proyects%2FIntellego%20Platform&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-flight-client-entry-loader.js?server=true!":
/*!******************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-flight-client-entry-loader.js?server=true! ***!
  \******************************************************************************************************/
/***/ (() => {



/***/ }),

/***/ "(rsc)/./src/app/api/ai-calendar/create-event/route.ts":
/*!*******************************************************!*\
  !*** ./src/app/api/ai-calendar/create-event/route.ts ***!
  \*******************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   POST: () => (/* binding */ POST)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/./node_modules/next/dist/api/server.js\");\n/* harmony import */ var next_auth__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next-auth */ \"(rsc)/./node_modules/next-auth/index.js\");\n/* harmony import */ var next_auth__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(next_auth__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var _lib_auth__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/lib/auth */ \"(rsc)/./src/lib/auth.ts\");\n/* harmony import */ var _lib_calendar_data__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @/lib/calendar-data */ \"(rsc)/./src/lib/calendar-data.ts\");\n\n\n\n\nasync function POST(request) {\n    try {\n        const session = await (0,next_auth__WEBPACK_IMPORTED_MODULE_1__.getServerSession)(_lib_auth__WEBPACK_IMPORTED_MODULE_2__.authOptions);\n        if (!session) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: 'Authentication required',\n                success: false\n            }, {\n                status: 401\n            });\n        }\n        const body = await request.json();\n        const { title, type, subject, date, startTime, endTime, duration, location, description, priority } = body;\n        // Validaciones básicas\n        if (!title || !type || !date) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: 'Missing required fields: title, type, date',\n                success: false\n            }, {\n                status: 400\n            });\n        }\n        // Validar tipo de evento\n        const validTypes = [\n            'exam',\n            'study_session',\n            'class',\n            'personal',\n            'extracurricular'\n        ];\n        if (!validTypes.includes(type)) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: `Invalid event type. Must be one of: ${validTypes.join(', ')}`,\n                success: false\n            }, {\n                status: 400\n            });\n        }\n        // Procesar fecha\n        let eventDate;\n        try {\n            eventDate = new Date(date);\n            if (isNaN(eventDate.getTime())) {\n                throw new Error('Invalid date');\n            }\n        } catch (error) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: 'Invalid date format',\n                success: false\n            }, {\n                status: 400\n            });\n        }\n        // Calcular endTime si no se proporciona pero se tiene duration\n        let finalEndTime = endTime;\n        if (!endTime && startTime && duration) {\n            const start = new Date(`2000-01-01T${startTime}:00`);\n            const end = new Date(start.getTime() + duration * 60000);\n            finalEndTime = end.toTimeString().substring(0, 5);\n        }\n        // Crear el evento\n        const event = {\n            id: `ai-event-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`,\n            title: title.trim(),\n            date: eventDate,\n            startTime: startTime || '15:00',\n            endTime: finalEndTime || '16:00',\n            type: type,\n            color: (0,_lib_calendar_data__WEBPACK_IMPORTED_MODULE_3__.getEventTypeColor)(type),\n            subject: subject || undefined,\n            location: location || undefined,\n            description: description || 'Creado automáticamente por IA Tutora',\n            priority: priority || 'medium',\n            duration: duration || 60\n        };\n        // Intentar agregar el evento al calendario del usuario\n        const userId = session.user.id;\n        const success = (0,_lib_calendar_data__WEBPACK_IMPORTED_MODULE_3__.addCalendarEvent)(userId, event);\n        if (!success) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: 'Failed to create event in calendar',\n                success: false\n            }, {\n                status: 500\n            });\n        }\n        // Verificar que el evento se guardó correctamente\n        const userData = (0,_lib_calendar_data__WEBPACK_IMPORTED_MODULE_3__.getUserCalendarData)(userId);\n        const savedEvent = userData?.events.find((e)=>e.id === event.id);\n        if (!savedEvent) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: 'Event was not saved correctly',\n                success: false\n            }, {\n                status: 500\n            });\n        }\n        console.log(`🤖 IA creó evento: ${event.title} para ${userId}`);\n        // Disparar evento global para notificar a los componentes frontend\n        if (typeof globalThis !== 'undefined') {\n            // Usar setTimeout para evitar problemas de timing\n            setTimeout(()=>{\n                if (false) {}\n            }, 100);\n        }\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            success: true,\n            event: savedEvent,\n            message: `Evento \"${event.title}\" creado exitosamente`,\n            totalEvents: userData?.events.length || 0\n        });\n    } catch (error) {\n        console.error('❌ Error in AI calendar creation:', error);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: 'Internal server error while creating event',\n            success: false\n        }, {\n            status: 500\n        });\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvYXBwL2FwaS9haS1jYWxlbmRhci9jcmVhdGUtZXZlbnQvcm91dGUudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7O0FBQTBDO0FBQ0U7QUFDSjtBQU1aO0FBRXJCLGVBQWVNLEtBQUtDLE9BQWdCO0lBQ3pDLElBQUk7UUFDRixNQUFNQyxVQUFVLE1BQU1QLDJEQUFnQkEsQ0FBQ0Msa0RBQVdBO1FBRWxELElBQUksQ0FBQ00sU0FBUztZQUNaLE9BQU9SLHFEQUFZQSxDQUFDUyxJQUFJLENBQ3RCO2dCQUFFQyxPQUFPO2dCQUEyQkMsU0FBUztZQUFNLEdBQ25EO2dCQUFFQyxRQUFRO1lBQUk7UUFFbEI7UUFFQSxNQUFNQyxPQUFPLE1BQU1OLFFBQVFFLElBQUk7UUFDL0IsTUFBTSxFQUNKSyxLQUFLLEVBQ0xDLElBQUksRUFDSkMsT0FBTyxFQUNQQyxJQUFJLEVBQ0pDLFNBQVMsRUFDVEMsT0FBTyxFQUNQQyxRQUFRLEVBQ1JDLFFBQVEsRUFDUkMsV0FBVyxFQUNYQyxRQUFRLEVBQ1QsR0FBR1Y7UUFFSix1QkFBdUI7UUFDdkIsSUFBSSxDQUFDQyxTQUFTLENBQUNDLFFBQVEsQ0FBQ0UsTUFBTTtZQUM1QixPQUFPakIscURBQVlBLENBQUNTLElBQUksQ0FDdEI7Z0JBQ0VDLE9BQU87Z0JBQ1BDLFNBQVM7WUFDWCxHQUNBO2dCQUFFQyxRQUFRO1lBQUk7UUFFbEI7UUFFQSx5QkFBeUI7UUFDekIsTUFBTVksYUFBYTtZQUFDO1lBQVE7WUFBaUI7WUFBUztZQUFZO1NBQWtCO1FBQ3BGLElBQUksQ0FBQ0EsV0FBV0MsUUFBUSxDQUFDVixPQUFPO1lBQzlCLE9BQU9mLHFEQUFZQSxDQUFDUyxJQUFJLENBQ3RCO2dCQUNFQyxPQUFPLENBQUMsb0NBQW9DLEVBQUVjLFdBQVdFLElBQUksQ0FBQyxPQUFPO2dCQUNyRWYsU0FBUztZQUNYLEdBQ0E7Z0JBQUVDLFFBQVE7WUFBSTtRQUVsQjtRQUVBLGlCQUFpQjtRQUNqQixJQUFJZTtRQUNKLElBQUk7WUFDRkEsWUFBWSxJQUFJQyxLQUFLWDtZQUNyQixJQUFJWSxNQUFNRixVQUFVRyxPQUFPLEtBQUs7Z0JBQzlCLE1BQU0sSUFBSUMsTUFBTTtZQUNsQjtRQUNGLEVBQUUsT0FBT3JCLE9BQU87WUFDZCxPQUFPVixxREFBWUEsQ0FBQ1MsSUFBSSxDQUN0QjtnQkFBRUMsT0FBTztnQkFBdUJDLFNBQVM7WUFBTSxHQUMvQztnQkFBRUMsUUFBUTtZQUFJO1FBRWxCO1FBRUEsK0RBQStEO1FBQy9ELElBQUlvQixlQUFlYjtRQUNuQixJQUFJLENBQUNBLFdBQVdELGFBQWFFLFVBQVU7WUFDckMsTUFBTWEsUUFBUSxJQUFJTCxLQUFLLENBQUMsV0FBVyxFQUFFVixVQUFVLEdBQUcsQ0FBQztZQUNuRCxNQUFNZ0IsTUFBTSxJQUFJTixLQUFLSyxNQUFNSCxPQUFPLEtBQUtWLFdBQVc7WUFDbERZLGVBQWVFLElBQUlDLFlBQVksR0FBR0MsU0FBUyxDQUFDLEdBQUc7UUFDakQ7UUFFQSxrQkFBa0I7UUFDbEIsTUFBTUMsUUFBdUI7WUFDM0JDLElBQUksQ0FBQyxTQUFTLEVBQUVWLEtBQUtXLEdBQUcsR0FBRyxDQUFDLEVBQUVDLEtBQUtDLE1BQU0sR0FBR0MsUUFBUSxDQUFDLElBQUlDLE1BQU0sQ0FBQyxHQUFHLElBQUk7WUFDdkU3QixPQUFPQSxNQUFNOEIsSUFBSTtZQUNqQjNCLE1BQU1VO1lBQ05ULFdBQVdBLGFBQWE7WUFDeEJDLFNBQVNhLGdCQUFnQjtZQUN6QmpCLE1BQU1BO1lBQ044QixPQUFPekMscUVBQWlCQSxDQUFDVztZQUN6QkMsU0FBU0EsV0FBVzhCO1lBQ3BCekIsVUFBVUEsWUFBWXlCO1lBQ3RCeEIsYUFBYUEsZUFBZTtZQUM1QkMsVUFBVUEsWUFBWTtZQUN0QkgsVUFBVUEsWUFBWTtRQUN4QjtRQUVBLHVEQUF1RDtRQUN2RCxNQUFNMkIsU0FBU3ZDLFFBQVF3QyxJQUFJLENBQUNWLEVBQUU7UUFDOUIsTUFBTTNCLFVBQVVSLG9FQUFnQkEsQ0FBQzRDLFFBQVFWO1FBRXpDLElBQUksQ0FBQzFCLFNBQVM7WUFDWixPQUFPWCxxREFBWUEsQ0FBQ1MsSUFBSSxDQUN0QjtnQkFDRUMsT0FBTztnQkFDUEMsU0FBUztZQUNYLEdBQ0E7Z0JBQUVDLFFBQVE7WUFBSTtRQUVsQjtRQUVBLGtEQUFrRDtRQUNsRCxNQUFNcUMsV0FBVzVDLHVFQUFtQkEsQ0FBQzBDO1FBQ3JDLE1BQU1HLGFBQWFELFVBQVVFLE9BQU9DLEtBQUtDLENBQUFBLElBQUtBLEVBQUVmLEVBQUUsS0FBS0QsTUFBTUMsRUFBRTtRQUUvRCxJQUFJLENBQUNZLFlBQVk7WUFDZixPQUFPbEQscURBQVlBLENBQUNTLElBQUksQ0FDdEI7Z0JBQ0VDLE9BQU87Z0JBQ1BDLFNBQVM7WUFDWCxHQUNBO2dCQUFFQyxRQUFRO1lBQUk7UUFFbEI7UUFFQTBDLFFBQVFDLEdBQUcsQ0FBQyxDQUFDLG1CQUFtQixFQUFFbEIsTUFBTXZCLEtBQUssQ0FBQyxNQUFNLEVBQUVpQyxRQUFRO1FBRTlELG1FQUFtRTtRQUNuRSxJQUFJLE9BQU9TLGVBQWUsYUFBYTtZQUNyQyxrREFBa0Q7WUFDbERDLFdBQVc7Z0JBQ1QsSUFBSSxLQUE2QixFQUFFLEVBSWxDO1lBQ0gsR0FBRztRQUNMO1FBRUEsT0FBT3pELHFEQUFZQSxDQUFDUyxJQUFJLENBQUM7WUFDdkJFLFNBQVM7WUFDVDBCLE9BQU9hO1lBQ1BZLFNBQVMsQ0FBQyxRQUFRLEVBQUV6QixNQUFNdkIsS0FBSyxDQUFDLHFCQUFxQixDQUFDO1lBQ3REaUQsYUFBYWQsVUFBVUUsT0FBT2EsVUFBVTtRQUMxQztJQUVGLEVBQUUsT0FBT3RELE9BQU87UUFDZDRDLFFBQVE1QyxLQUFLLENBQUMsb0NBQW9DQTtRQUVsRCxPQUFPVixxREFBWUEsQ0FBQ1MsSUFBSSxDQUN0QjtZQUNFQyxPQUFPO1lBQ1BDLFNBQVM7UUFDWCxHQUNBO1lBQUVDLFFBQVE7UUFBSTtJQUVsQjtBQUNGIiwic291cmNlcyI6WyIvVXNlcnMvcm9kcmlnb2RpYmVybmFyZG8zM2dtYWlsLmNvbS9Eb2N1bWVudHMvQXBwIERldmVsb3BtZW50IFByb3llY3RzL0ludGVsbGVnbyBQbGF0Zm9ybS9zcmMvYXBwL2FwaS9haS1jYWxlbmRhci9jcmVhdGUtZXZlbnQvcm91dGUudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgTmV4dFJlc3BvbnNlIH0gZnJvbSAnbmV4dC9zZXJ2ZXInXG5pbXBvcnQgeyBnZXRTZXJ2ZXJTZXNzaW9uIH0gZnJvbSAnbmV4dC1hdXRoJ1xuaW1wb3J0IHsgYXV0aE9wdGlvbnMgfSBmcm9tICdAL2xpYi9hdXRoJ1xuaW1wb3J0IHsgXG4gIGFkZENhbGVuZGFyRXZlbnQsIFxuICBDYWxlbmRhckV2ZW50LCBcbiAgZ2V0RXZlbnRUeXBlQ29sb3IsXG4gIGdldFVzZXJDYWxlbmRhckRhdGEgXG59IGZyb20gJ0AvbGliL2NhbGVuZGFyLWRhdGEnXG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBQT1NUKHJlcXVlc3Q6IFJlcXVlc3QpIHtcbiAgdHJ5IHtcbiAgICBjb25zdCBzZXNzaW9uID0gYXdhaXQgZ2V0U2VydmVyU2Vzc2lvbihhdXRoT3B0aW9ucylcbiAgICBcbiAgICBpZiAoIXNlc3Npb24pIHtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAgeyBlcnJvcjogJ0F1dGhlbnRpY2F0aW9uIHJlcXVpcmVkJywgc3VjY2VzczogZmFsc2UgfSxcbiAgICAgICAgeyBzdGF0dXM6IDQwMSB9XG4gICAgICApXG4gICAgfVxuXG4gICAgY29uc3QgYm9keSA9IGF3YWl0IHJlcXVlc3QuanNvbigpXG4gICAgY29uc3QgeyBcbiAgICAgIHRpdGxlLCBcbiAgICAgIHR5cGUsIFxuICAgICAgc3ViamVjdCwgXG4gICAgICBkYXRlLCBcbiAgICAgIHN0YXJ0VGltZSwgXG4gICAgICBlbmRUaW1lLCBcbiAgICAgIGR1cmF0aW9uLCBcbiAgICAgIGxvY2F0aW9uLCBcbiAgICAgIGRlc2NyaXB0aW9uLCBcbiAgICAgIHByaW9yaXR5IFxuICAgIH0gPSBib2R5XG5cbiAgICAvLyBWYWxpZGFjaW9uZXMgYsOhc2ljYXNcbiAgICBpZiAoIXRpdGxlIHx8ICF0eXBlIHx8ICFkYXRlKSB7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgIHsgXG4gICAgICAgICAgZXJyb3I6ICdNaXNzaW5nIHJlcXVpcmVkIGZpZWxkczogdGl0bGUsIHR5cGUsIGRhdGUnLCBcbiAgICAgICAgICBzdWNjZXNzOiBmYWxzZSBcbiAgICAgICAgfSxcbiAgICAgICAgeyBzdGF0dXM6IDQwMCB9XG4gICAgICApXG4gICAgfVxuXG4gICAgLy8gVmFsaWRhciB0aXBvIGRlIGV2ZW50b1xuICAgIGNvbnN0IHZhbGlkVHlwZXMgPSBbJ2V4YW0nLCAnc3R1ZHlfc2Vzc2lvbicsICdjbGFzcycsICdwZXJzb25hbCcsICdleHRyYWN1cnJpY3VsYXInXVxuICAgIGlmICghdmFsaWRUeXBlcy5pbmNsdWRlcyh0eXBlKSkge1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICB7IFxuICAgICAgICAgIGVycm9yOiBgSW52YWxpZCBldmVudCB0eXBlLiBNdXN0IGJlIG9uZSBvZjogJHt2YWxpZFR5cGVzLmpvaW4oJywgJyl9YCwgXG4gICAgICAgICAgc3VjY2VzczogZmFsc2UgXG4gICAgICAgIH0sXG4gICAgICAgIHsgc3RhdHVzOiA0MDAgfVxuICAgICAgKVxuICAgIH1cblxuICAgIC8vIFByb2Nlc2FyIGZlY2hhXG4gICAgbGV0IGV2ZW50RGF0ZTogRGF0ZVxuICAgIHRyeSB7XG4gICAgICBldmVudERhdGUgPSBuZXcgRGF0ZShkYXRlKVxuICAgICAgaWYgKGlzTmFOKGV2ZW50RGF0ZS5nZXRUaW1lKCkpKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcignSW52YWxpZCBkYXRlJylcbiAgICAgIH1cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICB7IGVycm9yOiAnSW52YWxpZCBkYXRlIGZvcm1hdCcsIHN1Y2Nlc3M6IGZhbHNlIH0sXG4gICAgICAgIHsgc3RhdHVzOiA0MDAgfVxuICAgICAgKVxuICAgIH1cblxuICAgIC8vIENhbGN1bGFyIGVuZFRpbWUgc2kgbm8gc2UgcHJvcG9yY2lvbmEgcGVybyBzZSB0aWVuZSBkdXJhdGlvblxuICAgIGxldCBmaW5hbEVuZFRpbWUgPSBlbmRUaW1lXG4gICAgaWYgKCFlbmRUaW1lICYmIHN0YXJ0VGltZSAmJiBkdXJhdGlvbikge1xuICAgICAgY29uc3Qgc3RhcnQgPSBuZXcgRGF0ZShgMjAwMC0wMS0wMVQke3N0YXJ0VGltZX06MDBgKVxuICAgICAgY29uc3QgZW5kID0gbmV3IERhdGUoc3RhcnQuZ2V0VGltZSgpICsgZHVyYXRpb24gKiA2MDAwMClcbiAgICAgIGZpbmFsRW5kVGltZSA9IGVuZC50b1RpbWVTdHJpbmcoKS5zdWJzdHJpbmcoMCwgNSlcbiAgICB9XG5cbiAgICAvLyBDcmVhciBlbCBldmVudG9cbiAgICBjb25zdCBldmVudDogQ2FsZW5kYXJFdmVudCA9IHtcbiAgICAgIGlkOiBgYWktZXZlbnQtJHtEYXRlLm5vdygpfS0ke01hdGgucmFuZG9tKCkudG9TdHJpbmcoMzYpLnN1YnN0cigyLCA5KX1gLFxuICAgICAgdGl0bGU6IHRpdGxlLnRyaW0oKSxcbiAgICAgIGRhdGU6IGV2ZW50RGF0ZSxcbiAgICAgIHN0YXJ0VGltZTogc3RhcnRUaW1lIHx8ICcxNTowMCcsXG4gICAgICBlbmRUaW1lOiBmaW5hbEVuZFRpbWUgfHwgJzE2OjAwJyxcbiAgICAgIHR5cGU6IHR5cGUgYXMgQ2FsZW5kYXJFdmVudFsndHlwZSddLFxuICAgICAgY29sb3I6IGdldEV2ZW50VHlwZUNvbG9yKHR5cGUgYXMgQ2FsZW5kYXJFdmVudFsndHlwZSddKSxcbiAgICAgIHN1YmplY3Q6IHN1YmplY3QgfHwgdW5kZWZpbmVkLFxuICAgICAgbG9jYXRpb246IGxvY2F0aW9uIHx8IHVuZGVmaW5lZCxcbiAgICAgIGRlc2NyaXB0aW9uOiBkZXNjcmlwdGlvbiB8fCAnQ3JlYWRvIGF1dG9tw6F0aWNhbWVudGUgcG9yIElBIFR1dG9yYScsXG4gICAgICBwcmlvcml0eTogcHJpb3JpdHkgfHwgJ21lZGl1bScsXG4gICAgICBkdXJhdGlvbjogZHVyYXRpb24gfHwgNjBcbiAgICB9XG5cbiAgICAvLyBJbnRlbnRhciBhZ3JlZ2FyIGVsIGV2ZW50byBhbCBjYWxlbmRhcmlvIGRlbCB1c3VhcmlvXG4gICAgY29uc3QgdXNlcklkID0gc2Vzc2lvbi51c2VyLmlkXG4gICAgY29uc3Qgc3VjY2VzcyA9IGFkZENhbGVuZGFyRXZlbnQodXNlcklkLCBldmVudClcblxuICAgIGlmICghc3VjY2Vzcykge1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICB7IFxuICAgICAgICAgIGVycm9yOiAnRmFpbGVkIHRvIGNyZWF0ZSBldmVudCBpbiBjYWxlbmRhcicsIFxuICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlIFxuICAgICAgICB9LFxuICAgICAgICB7IHN0YXR1czogNTAwIH1cbiAgICAgIClcbiAgICB9XG5cbiAgICAvLyBWZXJpZmljYXIgcXVlIGVsIGV2ZW50byBzZSBndWFyZMOzIGNvcnJlY3RhbWVudGVcbiAgICBjb25zdCB1c2VyRGF0YSA9IGdldFVzZXJDYWxlbmRhckRhdGEodXNlcklkKVxuICAgIGNvbnN0IHNhdmVkRXZlbnQgPSB1c2VyRGF0YT8uZXZlbnRzLmZpbmQoZSA9PiBlLmlkID09PSBldmVudC5pZClcblxuICAgIGlmICghc2F2ZWRFdmVudCkge1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICB7IFxuICAgICAgICAgIGVycm9yOiAnRXZlbnQgd2FzIG5vdCBzYXZlZCBjb3JyZWN0bHknLCBcbiAgICAgICAgICBzdWNjZXNzOiBmYWxzZSBcbiAgICAgICAgfSxcbiAgICAgICAgeyBzdGF0dXM6IDUwMCB9XG4gICAgICApXG4gICAgfVxuXG4gICAgY29uc29sZS5sb2coYPCfpJYgSUEgY3Jlw7MgZXZlbnRvOiAke2V2ZW50LnRpdGxlfSBwYXJhICR7dXNlcklkfWApXG5cbiAgICAvLyBEaXNwYXJhciBldmVudG8gZ2xvYmFsIHBhcmEgbm90aWZpY2FyIGEgbG9zIGNvbXBvbmVudGVzIGZyb250ZW5kXG4gICAgaWYgKHR5cGVvZiBnbG9iYWxUaGlzICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgLy8gVXNhciBzZXRUaW1lb3V0IHBhcmEgZXZpdGFyIHByb2JsZW1hcyBkZSB0aW1pbmdcbiAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICBpZiAodHlwZW9mIHdpbmRvdyAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICB3aW5kb3cuZGlzcGF0Y2hFdmVudChuZXcgQ3VzdG9tRXZlbnQoJ2NhbGVuZGFyRXZlbnRDcmVhdGVkJywge1xuICAgICAgICAgICAgZGV0YWlsOiB7IGV2ZW50OiBzYXZlZEV2ZW50LCB1c2VySWQgfVxuICAgICAgICAgIH0pKVxuICAgICAgICB9XG4gICAgICB9LCAxMDApXG4gICAgfVxuXG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHtcbiAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICBldmVudDogc2F2ZWRFdmVudCxcbiAgICAgIG1lc3NhZ2U6IGBFdmVudG8gXCIke2V2ZW50LnRpdGxlfVwiIGNyZWFkbyBleGl0b3NhbWVudGVgLFxuICAgICAgdG90YWxFdmVudHM6IHVzZXJEYXRhPy5ldmVudHMubGVuZ3RoIHx8IDBcbiAgICB9KVxuXG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcign4p2MIEVycm9yIGluIEFJIGNhbGVuZGFyIGNyZWF0aW9uOicsIGVycm9yKVxuICAgIFxuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgIHsgXG4gICAgICAgIGVycm9yOiAnSW50ZXJuYWwgc2VydmVyIGVycm9yIHdoaWxlIGNyZWF0aW5nIGV2ZW50JywgXG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlIFxuICAgICAgfSxcbiAgICAgIHsgc3RhdHVzOiA1MDAgfVxuICAgIClcbiAgfVxufSJdLCJuYW1lcyI6WyJOZXh0UmVzcG9uc2UiLCJnZXRTZXJ2ZXJTZXNzaW9uIiwiYXV0aE9wdGlvbnMiLCJhZGRDYWxlbmRhckV2ZW50IiwiZ2V0RXZlbnRUeXBlQ29sb3IiLCJnZXRVc2VyQ2FsZW5kYXJEYXRhIiwiUE9TVCIsInJlcXVlc3QiLCJzZXNzaW9uIiwianNvbiIsImVycm9yIiwic3VjY2VzcyIsInN0YXR1cyIsImJvZHkiLCJ0aXRsZSIsInR5cGUiLCJzdWJqZWN0IiwiZGF0ZSIsInN0YXJ0VGltZSIsImVuZFRpbWUiLCJkdXJhdGlvbiIsImxvY2F0aW9uIiwiZGVzY3JpcHRpb24iLCJwcmlvcml0eSIsInZhbGlkVHlwZXMiLCJpbmNsdWRlcyIsImpvaW4iLCJldmVudERhdGUiLCJEYXRlIiwiaXNOYU4iLCJnZXRUaW1lIiwiRXJyb3IiLCJmaW5hbEVuZFRpbWUiLCJzdGFydCIsImVuZCIsInRvVGltZVN0cmluZyIsInN1YnN0cmluZyIsImV2ZW50IiwiaWQiLCJub3ciLCJNYXRoIiwicmFuZG9tIiwidG9TdHJpbmciLCJzdWJzdHIiLCJ0cmltIiwiY29sb3IiLCJ1bmRlZmluZWQiLCJ1c2VySWQiLCJ1c2VyIiwidXNlckRhdGEiLCJzYXZlZEV2ZW50IiwiZXZlbnRzIiwiZmluZCIsImUiLCJjb25zb2xlIiwibG9nIiwiZ2xvYmFsVGhpcyIsInNldFRpbWVvdXQiLCJ3aW5kb3ciLCJkaXNwYXRjaEV2ZW50IiwiQ3VzdG9tRXZlbnQiLCJkZXRhaWwiLCJtZXNzYWdlIiwidG90YWxFdmVudHMiLCJsZW5ndGgiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./src/app/api/ai-calendar/create-event/route.ts\n");

/***/ }),

/***/ "(rsc)/./src/app/api/ai-chat/initialize/route.ts":
/*!*************************************************!*\
  !*** ./src/app/api/ai-chat/initialize/route.ts ***!
  \*************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   POST: () => (/* binding */ POST)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/./node_modules/next/dist/api/server.js\");\n/* harmony import */ var next_auth__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next-auth */ \"(rsc)/./node_modules/next-auth/index.js\");\n/* harmony import */ var next_auth__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(next_auth__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var _lib_auth__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/lib/auth */ \"(rsc)/./src/lib/auth.ts\");\n/* harmony import */ var _lib_conversation_engine__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @/lib/conversation-engine */ \"(rsc)/./src/lib/conversation-engine.ts\");\n\n\n\n\nasync function POST(request) {\n    try {\n        const session = await (0,next_auth__WEBPACK_IMPORTED_MODULE_1__.getServerSession)(_lib_auth__WEBPACK_IMPORTED_MODULE_2__.authOptions);\n        if (!session) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: 'Authentication required'\n            }, {\n                status: 401\n            });\n        }\n        const body = await request.json();\n        const { userName } = body;\n        // Crear mensaje de bienvenida personalizado (stateless)\n        const welcomeMessage = await _lib_conversation_engine__WEBPACK_IMPORTED_MODULE_3__.ConversationEngine.createWelcomeMessage(session.user.id, userName || session.user.name);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            success: true,\n            conversationHistory: [\n                welcomeMessage\n            ],\n            currentMode: 'chat'\n        });\n    } catch (error) {\n        console.error('❌ Error initializing AI chat:', error);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: 'Internal server error',\n            message: error instanceof Error ? error.message : 'Unknown error'\n        }, {\n            status: 500\n        });\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvYXBwL2FwaS9haS1jaGF0L2luaXRpYWxpemUvcm91dGUudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7O0FBQTBDO0FBQ0U7QUFDSjtBQUNzQjtBQUV2RCxlQUFlSSxLQUFLQyxPQUFnQjtJQUN6QyxJQUFJO1FBQ0YsTUFBTUMsVUFBVSxNQUFNTCwyREFBZ0JBLENBQUNDLGtEQUFXQTtRQUVsRCxJQUFJLENBQUNJLFNBQVM7WUFDWixPQUFPTixxREFBWUEsQ0FBQ08sSUFBSSxDQUN0QjtnQkFBRUMsT0FBTztZQUEwQixHQUNuQztnQkFBRUMsUUFBUTtZQUFJO1FBRWxCO1FBRUEsTUFBTUMsT0FBTyxNQUFNTCxRQUFRRSxJQUFJO1FBQy9CLE1BQU0sRUFBRUksUUFBUSxFQUFFLEdBQUdEO1FBRXJCLHdEQUF3RDtRQUN4RCxNQUFNRSxpQkFBaUIsTUFBTVQsd0VBQWtCQSxDQUFDVSxvQkFBb0IsQ0FDbEVQLFFBQVFRLElBQUksQ0FBQ0MsRUFBRSxFQUNmSixZQUFZTCxRQUFRUSxJQUFJLENBQUNFLElBQUk7UUFHL0IsT0FBT2hCLHFEQUFZQSxDQUFDTyxJQUFJLENBQUM7WUFDdkJVLFNBQVM7WUFDVEMscUJBQXFCO2dCQUFDTjthQUFlO1lBQ3JDTyxhQUFhO1FBQ2Y7SUFFRixFQUFFLE9BQU9YLE9BQU87UUFDZFksUUFBUVosS0FBSyxDQUFDLGlDQUFpQ0E7UUFDL0MsT0FBT1IscURBQVlBLENBQUNPLElBQUksQ0FDdEI7WUFDRUMsT0FBTztZQUNQYSxTQUFTYixpQkFBaUJjLFFBQVFkLE1BQU1hLE9BQU8sR0FBRztRQUNwRCxHQUNBO1lBQUVaLFFBQVE7UUFBSTtJQUVsQjtBQUNGIiwic291cmNlcyI6WyIvVXNlcnMvcm9kcmlnb2RpYmVybmFyZG8zM2dtYWlsLmNvbS9Eb2N1bWVudHMvQXBwIERldmVsb3BtZW50IFByb3llY3RzL0ludGVsbGVnbyBQbGF0Zm9ybS9zcmMvYXBwL2FwaS9haS1jaGF0L2luaXRpYWxpemUvcm91dGUudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgTmV4dFJlc3BvbnNlIH0gZnJvbSAnbmV4dC9zZXJ2ZXInXG5pbXBvcnQgeyBnZXRTZXJ2ZXJTZXNzaW9uIH0gZnJvbSAnbmV4dC1hdXRoJ1xuaW1wb3J0IHsgYXV0aE9wdGlvbnMgfSBmcm9tICdAL2xpYi9hdXRoJ1xuaW1wb3J0IHsgQ29udmVyc2F0aW9uRW5naW5lIH0gZnJvbSAnQC9saWIvY29udmVyc2F0aW9uLWVuZ2luZSdcblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIFBPU1QocmVxdWVzdDogUmVxdWVzdCkge1xuICB0cnkge1xuICAgIGNvbnN0IHNlc3Npb24gPSBhd2FpdCBnZXRTZXJ2ZXJTZXNzaW9uKGF1dGhPcHRpb25zKVxuICAgIFxuICAgIGlmICghc2Vzc2lvbikge1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICB7IGVycm9yOiAnQXV0aGVudGljYXRpb24gcmVxdWlyZWQnIH0sXG4gICAgICAgIHsgc3RhdHVzOiA0MDEgfVxuICAgICAgKVxuICAgIH1cblxuICAgIGNvbnN0IGJvZHkgPSBhd2FpdCByZXF1ZXN0Lmpzb24oKVxuICAgIGNvbnN0IHsgdXNlck5hbWUgfSA9IGJvZHlcblxuICAgIC8vIENyZWFyIG1lbnNhamUgZGUgYmllbnZlbmlkYSBwZXJzb25hbGl6YWRvIChzdGF0ZWxlc3MpXG4gICAgY29uc3Qgd2VsY29tZU1lc3NhZ2UgPSBhd2FpdCBDb252ZXJzYXRpb25FbmdpbmUuY3JlYXRlV2VsY29tZU1lc3NhZ2UoXG4gICAgICBzZXNzaW9uLnVzZXIuaWQsIFxuICAgICAgdXNlck5hbWUgfHwgc2Vzc2lvbi51c2VyLm5hbWVcbiAgICApXG5cbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oe1xuICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgIGNvbnZlcnNhdGlvbkhpc3Rvcnk6IFt3ZWxjb21lTWVzc2FnZV0sXG4gICAgICBjdXJyZW50TW9kZTogJ2NoYXQnXG4gICAgfSlcblxuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBFcnJvciBpbml0aWFsaXppbmcgQUkgY2hhdDonLCBlcnJvcilcbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICB7IFxuICAgICAgICBlcnJvcjogJ0ludGVybmFsIHNlcnZlciBlcnJvcicsXG4gICAgICAgIG1lc3NhZ2U6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ1Vua25vd24gZXJyb3InXG4gICAgICB9LFxuICAgICAgeyBzdGF0dXM6IDUwMCB9XG4gICAgKVxuICB9XG59Il0sIm5hbWVzIjpbIk5leHRSZXNwb25zZSIsImdldFNlcnZlclNlc3Npb24iLCJhdXRoT3B0aW9ucyIsIkNvbnZlcnNhdGlvbkVuZ2luZSIsIlBPU1QiLCJyZXF1ZXN0Iiwic2Vzc2lvbiIsImpzb24iLCJlcnJvciIsInN0YXR1cyIsImJvZHkiLCJ1c2VyTmFtZSIsIndlbGNvbWVNZXNzYWdlIiwiY3JlYXRlV2VsY29tZU1lc3NhZ2UiLCJ1c2VyIiwiaWQiLCJuYW1lIiwic3VjY2VzcyIsImNvbnZlcnNhdGlvbkhpc3RvcnkiLCJjdXJyZW50TW9kZSIsImNvbnNvbGUiLCJtZXNzYWdlIiwiRXJyb3IiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./src/app/api/ai-chat/initialize/route.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/academic-analyzer.ts":
/*!**************************************!*\
  !*** ./src/lib/academic-analyzer.ts ***!
  \**************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   AcademicAnalyzer: () => (/* binding */ AcademicAnalyzer),\n/* harmony export */   AcademicSubject: () => (/* binding */ AcademicSubject),\n/* harmony export */   DifficultyLevel: () => (/* binding */ DifficultyLevel),\n/* harmony export */   SUBJECT_TOPICS: () => (/* binding */ SUBJECT_TOPICS)\n/* harmony export */ });\n/* harmony import */ var _temp_storage__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./temp-storage */ \"(rsc)/./src/lib/temp-storage.ts\");\n\n// Definición de materias académicas\nvar AcademicSubject = /*#__PURE__*/ function(AcademicSubject) {\n    AcademicSubject[\"MATHEMATICS\"] = \"mathematics\";\n    AcademicSubject[\"PHYSICS\"] = \"physics\";\n    AcademicSubject[\"CHEMISTRY\"] = \"chemistry\";\n    AcademicSubject[\"BIOLOGY\"] = \"biology\";\n    AcademicSubject[\"SPANISH\"] = \"spanish\";\n    AcademicSubject[\"ENGLISH\"] = \"english\";\n    AcademicSubject[\"HISTORY\"] = \"history\";\n    AcademicSubject[\"GEOGRAPHY\"] = \"geography\";\n    AcademicSubject[\"GENERAL\"] = \"general\";\n    return AcademicSubject;\n}({});\n// Nivel de dificultad detectado\nvar DifficultyLevel = /*#__PURE__*/ function(DifficultyLevel) {\n    DifficultyLevel[\"BASIC\"] = \"basic\";\n    DifficultyLevel[\"INTERMEDIATE\"] = \"intermediate\";\n    DifficultyLevel[\"ADVANCED\"] = \"advanced\";\n    DifficultyLevel[\"REVIEW_NEEDED\"] = \"review_needed\";\n    return DifficultyLevel;\n}({});\n// Temas específicos por materia\nconst SUBJECT_TOPICS = {\n    [\"mathematics\"]: [\n        'algebra',\n        'geometria',\n        'trigonometria',\n        'calculo',\n        'estadistica',\n        'probabilidad',\n        'ecuaciones',\n        'funciones',\n        'logaritmos',\n        'matrices',\n        'derivadas',\n        'integrales'\n    ],\n    [\"physics\"]: [\n        'cinematica',\n        'dinamica',\n        'energia',\n        'ondas',\n        'termodinamica',\n        'electricidad',\n        'magnetismo',\n        'optica',\n        'mecanica',\n        'fluidos',\n        'movimiento',\n        'fuerza',\n        'velocidad'\n    ],\n    [\"chemistry\"]: [\n        'atomos',\n        'moleculas',\n        'enlaces',\n        'reacciones',\n        'estequiometria',\n        'acidos',\n        'bases',\n        'oxidacion',\n        'reduccion',\n        'equilibrio',\n        'cinetica',\n        'termoquimica'\n    ]\n};\n// Palabras clave que indican dificultades\nconst DIFFICULTY_INDICATORS = {\n    high: [\n        'muy difícil',\n        'no entiendo',\n        'confuso',\n        'complicado',\n        'imposible',\n        'no puedo'\n    ],\n    medium: [\n        'difícil',\n        'complicado',\n        'no comprendo',\n        'me cuesta',\n        'problema'\n    ],\n    low: [\n        'un poco difícil',\n        'necesito ayuda',\n        'no está claro',\n        'dudas'\n    ]\n};\n// Palabras clave que indican progreso positivo\nconst PROGRESS_INDICATORS = {\n    excellent: [\n        'excelente',\n        'perfecto',\n        'domino',\n        'fácil',\n        'entiendo todo'\n    ],\n    good: [\n        'bien',\n        'entiendo',\n        'comprendo',\n        'logré',\n        'mejorando'\n    ],\n    fair: [\n        'más o menos',\n        'regular',\n        'algunas veces',\n        'avanzando'\n    ]\n};\nclass AcademicAnalyzer {\n    /**\n   * Analiza los reportes académicos de un estudiante\n   */ static async analyzeStudent(userId) {\n        const reports = _temp_storage__WEBPACK_IMPORTED_MODULE_0__.tempWeeklyReports.filter((report)=>report.userId === userId);\n        if (reports.length === 0) {\n            return this.createDefaultAnalysis(userId);\n        }\n        // Analizar reportes recientes (últimas 8 semanas)\n        const recentReports = reports.sort((a, b)=>new Date(b.createdAt).getTime() - new Date(a.createdAt).getTime()).slice(0, 8);\n        // Extraer todo el texto de las respuestas\n        const allResponseText = recentReports.flatMap((report)=>Object.values(report.responses || {})).filter(Boolean).join(' ').toLowerCase();\n        // Analizar por materias\n        const subjectAnalyses = this.analyzeSubjects(allResponseText, recentReports);\n        // Análisis general\n        const overallPerformance = this.calculateOverallPerformance(subjectAnalyses);\n        const strugglingAreas = this.identifyStrugglingAreas(subjectAnalyses, allResponseText);\n        const strengths = this.identifyStrengths(subjectAnalyses, allResponseText);\n        const recommendedTopics = this.generateRecommendations(subjectAnalyses);\n        const learningPattern = this.identifyLearningPattern(allResponseText);\n        return {\n            userId,\n            subjects: subjectAnalyses,\n            overallPerformance,\n            strugglingAreas,\n            strengths,\n            recommendedTopics,\n            learningPattern,\n            lastReportDate: new Date(recentReports[0]?.createdAt || Date.now())\n        };\n    }\n    /**\n   * Analiza materias específicas mencionadas en los reportes\n   */ static analyzeSubjects(text, reports) {\n        const analyses = [];\n        // Palabras clave para identificar materias\n        const subjectKeywords = {\n            [\"mathematics\"]: [\n                'matemática',\n                'matemáticas',\n                'mate',\n                'álgebra',\n                'geometría',\n                'cálculo',\n                'números'\n            ],\n            [\"physics\"]: [\n                'física',\n                'mecánica',\n                'energía',\n                'fuerza',\n                'movimiento',\n                'velocidad'\n            ],\n            [\"chemistry\"]: [\n                'química',\n                'átomos',\n                'moléculas',\n                'reacciones',\n                'elementos',\n                'laboratorio'\n            ],\n            [\"biology\"]: [\n                'biología',\n                'células',\n                'organismos',\n                'evolución',\n                'ecosistema'\n            ],\n            [\"spanish\"]: [\n                'lengua',\n                'español',\n                'literatura',\n                'redacción',\n                'gramática'\n            ],\n            [\"english\"]: [\n                'inglés',\n                'english',\n                'grammar',\n                'vocabulary'\n            ],\n            [\"history\"]: [\n                'historia',\n                'civilización',\n                'época',\n                'guerra',\n                'revolución'\n            ],\n            [\"geography\"]: [\n                'geografía',\n                'países',\n                'continentes',\n                'clima',\n                'población'\n            ]\n        };\n        Object.entries(subjectKeywords).forEach(([subject, keywords])=>{\n            const mentions = keywords.filter((keyword)=>text.includes(keyword)).length;\n            if (mentions > 0) {\n                const analysis = this.analyzeSpecificSubject(subject, text, reports, mentions);\n                analyses.push(analysis);\n            }\n        });\n        // Si no se encontraron materias específicas, agregar análisis general\n        if (analyses.length === 0) {\n            analyses.push(this.createGeneralSubjectAnalysis(text, reports));\n        }\n        return analyses;\n    }\n    /**\n   * Analiza una materia específica\n   */ static analyzeSpecificSubject(subject, text, reports, mentions) {\n        const subjectName = this.getSubjectDisplayName(subject);\n        const topics = SUBJECT_TOPICS[subject] || [];\n        // Detectar temas mencionados\n        const mentionedTopics = topics.filter((topic)=>text.includes(topic));\n        // Analizar dificultades específicas\n        const specificChallenges = this.extractSpecificChallenges(text, subject);\n        // Calcular rendimiento basado en indicadores\n        const performance = this.calculateSubjectPerformance(text, specificChallenges.length);\n        // Determinar nivel de dificultad\n        const difficultyLevel = this.determineDifficultyLevel(performance, specificChallenges.length);\n        // Determinar si necesita atención\n        const needsAttention = performance < 60 || specificChallenges.length > 2;\n        return {\n            subject,\n            subjectName,\n            performance,\n            difficultyLevel,\n            strugglingTopics: mentionedTopics.slice(0, 3),\n            masteredTopics: performance > 75 ? mentionedTopics.slice(0, 2) : [],\n            recentMentions: mentions,\n            needsAttention,\n            specificChallenges\n        };\n    }\n    /**\n   * Extrae desafíos específicos mencionados por el estudiante\n   */ static extractSpecificChallenges(text, subject) {\n        const challenges = [];\n        // Buscar patrones de dificultad\n        const difficultyPatterns = [\n            /no entiendo (.*?)(?:\\.|,|$)/g,\n            /me cuesta (.*?)(?:\\.|,|$)/g,\n            /difícil (.*?)(?:\\.|,|$)/g,\n            /problema con (.*?)(?:\\.|,|$)/g,\n            /confuso (.*?)(?:\\.|,|$)/g\n        ];\n        difficultyPatterns.forEach((pattern)=>{\n            let match;\n            while((match = pattern.exec(text)) !== null){\n                if (match[1] && match[1].length < 50) {\n                    challenges.push(match[1].trim());\n                }\n            }\n        });\n        return challenges.slice(0, 3) // Máximo 3 desafíos específicos\n        ;\n    }\n    /**\n   * Calcula el rendimiento de una materia\n   */ static calculateSubjectPerformance(text, challengesCount) {\n        let score = 70 // Base score\n        ;\n        // Indicadores positivos\n        Object.entries(PROGRESS_INDICATORS).forEach(([level, indicators])=>{\n            const multiplier = level === 'excellent' ? 10 : level === 'good' ? 5 : 2;\n            indicators.forEach((indicator)=>{\n                if (text.includes(indicator)) {\n                    score += multiplier;\n                }\n            });\n        });\n        // Indicadores negativos\n        Object.entries(DIFFICULTY_INDICATORS).forEach(([level, indicators])=>{\n            const penalty = level === 'high' ? 15 : level === 'medium' ? 10 : 5;\n            indicators.forEach((indicator)=>{\n                if (text.includes(indicator)) {\n                    score -= penalty;\n                }\n            });\n        });\n        // Penalizar por número de desafíos específicos\n        score -= challengesCount * 8;\n        return Math.max(0, Math.min(100, score));\n    }\n    /**\n   * Determina el nivel de dificultad basado en el rendimiento\n   */ static determineDifficultyLevel(performance, challengesCount) {\n        if (performance < 40 || challengesCount > 3) return \"review_needed\";\n        if (performance < 60) return \"basic\";\n        if (performance < 80) return \"intermediate\";\n        return \"advanced\";\n    }\n    /**\n   * Crea análisis por defecto para estudiantes sin reportes\n   */ static createDefaultAnalysis(userId) {\n        return {\n            userId,\n            subjects: [\n                this.createGeneralSubjectAnalysis('', [])\n            ],\n            overallPerformance: 50,\n            strugglingAreas: [\n                'Falta de datos históricos'\n            ],\n            strengths: [\n                'Nuevo estudiante con potencial'\n            ],\n            recommendedTopics: [\n                'Evaluación inicial',\n                'Fundamentos'\n            ],\n            learningPattern: 'mixed',\n            lastReportDate: new Date()\n        };\n    }\n    /**\n   * Crea análisis general cuando no se detectan materias específicas\n   */ static createGeneralSubjectAnalysis(text, reports) {\n        const performance = text.length > 0 ? this.calculateSubjectPerformance(text, 0) : 50;\n        return {\n            subject: \"general\",\n            subjectName: 'Análisis General',\n            performance,\n            difficultyLevel: this.determineDifficultyLevel(performance, 0),\n            strugglingTopics: [],\n            masteredTopics: [],\n            recentMentions: reports.length,\n            needsAttention: performance < 60,\n            specificChallenges: this.extractSpecificChallenges(text, \"general\")\n        };\n    }\n    /**\n   * Calcula el rendimiento general\n   */ static calculateOverallPerformance(subjects) {\n        if (subjects.length === 0) return 50;\n        const average = subjects.reduce((sum, subject)=>sum + subject.performance, 0) / subjects.length;\n        return Math.round(average);\n    }\n    /**\n   * Identifica áreas con dificultades\n   */ static identifyStrugglingAreas(subjects, text) {\n        const areas = [];\n        // Agregar materias con bajo rendimiento\n        subjects.filter((subject)=>subject.needsAttention).forEach((subject)=>{\n            areas.push(`${subject.subjectName}: ${subject.specificChallenges.join(', ')}`);\n        });\n        // Si no hay áreas específicas, buscar patrones generales\n        if (areas.length === 0 && text.length > 0) {\n            if (text.includes('tiempo')) areas.push('Gestión del tiempo');\n            if (text.includes('concentr')) areas.push('Concentración');\n            if (text.includes('motiv')) areas.push('Motivación');\n        }\n        return areas.slice(0, 3);\n    }\n    /**\n   * Identifica fortalezas del estudiante\n   */ static identifyStrengths(subjects, text) {\n        const strengths = [];\n        // Agregar materias con buen rendimiento\n        subjects.filter((subject)=>subject.performance > 75).forEach((subject)=>{\n            strengths.push(`Dominio en ${subject.subjectName}`);\n        });\n        // Patrones de fortaleza general\n        if (text.includes('organiz')) strengths.push('Capacidad de organización');\n        if (text.includes('persever') || text.includes('persist')) strengths.push('Perseverancia');\n        if (text.includes('creativ')) strengths.push('Pensamiento creativo');\n        return strengths.length > 0 ? strengths.slice(0, 3) : [\n            'Dedicación al aprendizaje'\n        ];\n    }\n    /**\n   * Genera recomendaciones de temas\n   */ static generateRecommendations(subjects) {\n        const recommendations = [];\n        subjects.forEach((subject)=>{\n            if (subject.needsAttention) {\n                recommendations.push(`Reforzar conceptos básicos de ${subject.subjectName}`);\n                if (subject.strugglingTopics.length > 0) {\n                    recommendations.push(`Practicar: ${subject.strugglingTopics.join(', ')}`);\n                }\n            }\n        });\n        return recommendations.slice(0, 4);\n    }\n    /**\n   * Identifica el patrón de aprendizaje\n   */ static identifyLearningPattern(text) {\n        const visualKeywords = [\n            'gráfico',\n            'diagrama',\n            'imagen',\n            'visual',\n            'dibujo'\n        ];\n        const analyticalKeywords = [\n            'análisis',\n            'lógica',\n            'razonamiento',\n            'teoría'\n        ];\n        const practicalKeywords = [\n            'práctica',\n            'ejercicio',\n            'aplicar',\n            'hacer'\n        ];\n        const visualCount = visualKeywords.reduce((count, word)=>count + (text.includes(word) ? 1 : 0), 0);\n        const analyticalCount = analyticalKeywords.reduce((count, word)=>count + (text.includes(word) ? 1 : 0), 0);\n        const practicalCount = practicalKeywords.reduce((count, word)=>count + (text.includes(word) ? 1 : 0), 0);\n        if (visualCount > analyticalCount && visualCount > practicalCount) return 'visual';\n        if (analyticalCount > practicalCount) return 'analytical';\n        if (practicalCount > 0) return 'practical';\n        return 'mixed';\n    }\n    /**\n   * Obtiene el nombre de visualización de una materia\n   */ static getSubjectDisplayName(subject) {\n        const names = {\n            [\"mathematics\"]: 'Matemáticas',\n            [\"physics\"]: 'Física',\n            [\"chemistry\"]: 'Química',\n            [\"biology\"]: 'Biología',\n            [\"spanish\"]: 'Lengua y Literatura',\n            [\"english\"]: 'Inglés',\n            [\"history\"]: 'Historia',\n            [\"geography\"]: 'Geografía',\n            [\"general\"]: 'General'\n        };\n        return names[subject] || 'Materia';\n    }\n    /**\n   * Obtiene un resumen contextual para generar ejercicios\n   */ static getExerciseContext(analysis, subject) {\n        const targetSubject = subject || analysis.subjects[0]?.subject || \"general\";\n        const subjectAnalysis = analysis.subjects.find((s)=>s.subject === targetSubject);\n        if (!subjectAnalysis) {\n            return `Estudiante: nivel intermedio, necesita evaluación inicial en ${targetSubject}`;\n        }\n        const context = [\n            `Materia: ${subjectAnalysis.subjectName}`,\n            `Nivel: ${subjectAnalysis.difficultyLevel}`,\n            `Rendimiento actual: ${subjectAnalysis.performance}%`,\n            subjectAnalysis.specificChallenges.length > 0 ? `Dificultades específicas: ${subjectAnalysis.specificChallenges.join(', ')}` : null,\n            subjectAnalysis.strugglingTopics.length > 0 ? `Temas a reforzar: ${subjectAnalysis.strugglingTopics.join(', ')}` : null,\n            `Patrón de aprendizaje: ${analysis.learningPattern}`\n        ].filter(Boolean).join('. ');\n        return context;\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QyxDQUFDLENBQUM7WUFDckR5QyxnQkFBZ0IzQyxrQkFBa0IsQ0FBQ3BELE1BQU0sR0FBRyxJQUN4QyxDQUFDLDBCQUEwQixFQUFFK0YsZ0JBQWdCM0Msa0JBQWtCLENBQUNwQyxJQUFJLENBQUMsT0FBTyxHQUM1RTtZQUNKK0UsZ0JBQWdCcEMsZ0JBQWdCLENBQUMzRCxNQUFNLEdBQUcsSUFDdEMsQ0FBQyxrQkFBa0IsRUFBRStGLGdCQUFnQnBDLGdCQUFnQixDQUFDM0MsSUFBSSxDQUFDLE9BQU8sR0FDbEU7WUFDSixDQUFDLHVCQUF1QixFQUFFMkIsU0FBU2YsZUFBZSxFQUFFO1NBQ3JELENBQUM5QixNQUFNLENBQUNpQixTQUFTQyxJQUFJLENBQUM7UUFFdkIsT0FBT2tGO0lBQ1Q7QUFDRiIsInNvdXJjZXMiOlsiL1VzZXJzL3JvZHJpZ29kaWJlcm5hcmRvMzNnbWFpbC5jb20vRG9jdW1lbnRzL0FwcCBEZXZlbG9wbWVudCBQcm95ZWN0cy9JbnRlbGxlZ28gUGxhdGZvcm0vc3JjL2xpYi9hY2FkZW1pYy1hbmFseXplci50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyB0ZW1wV2Vla2x5UmVwb3J0cyB9IGZyb20gJy4vdGVtcC1zdG9yYWdlJ1xuXG4vLyBEZWZpbmljacOzbiBkZSBtYXRlcmlhcyBhY2Fkw6ltaWNhc1xuZXhwb3J0IGVudW0gQWNhZGVtaWNTdWJqZWN0IHtcbiAgTUFUSEVNQVRJQ1MgPSAnbWF0aGVtYXRpY3MnLFxuICBQSFlTSUNTID0gJ3BoeXNpY3MnLCBcbiAgQ0hFTUlTVFJZID0gJ2NoZW1pc3RyeScsXG4gIEJJT0xPR1kgPSAnYmlvbG9neScsXG4gIFNQQU5JU0ggPSAnc3BhbmlzaCcsXG4gIEVOR0xJU0ggPSAnZW5nbGlzaCcsXG4gIEhJU1RPUlkgPSAnaGlzdG9yeScsXG4gIEdFT0dSQVBIWSA9ICdnZW9ncmFwaHknLFxuICBHRU5FUkFMID0gJ2dlbmVyYWwnXG59XG5cbi8vIE5pdmVsIGRlIGRpZmljdWx0YWQgZGV0ZWN0YWRvXG5leHBvcnQgZW51bSBEaWZmaWN1bHR5TGV2ZWwge1xuICBCQVNJQyA9ICdiYXNpYycsXG4gIElOVEVSTUVESUFURSA9ICdpbnRlcm1lZGlhdGUnLCBcbiAgQURWQU5DRUQgPSAnYWR2YW5jZWQnLFxuICBSRVZJRVdfTkVFREVEID0gJ3Jldmlld19uZWVkZWQnXG59XG5cbi8vIFRlbWFzIGVzcGVjw61maWNvcyBwb3IgbWF0ZXJpYVxuZXhwb3J0IGNvbnN0IFNVQkpFQ1RfVE9QSUNTID0ge1xuICBbQWNhZGVtaWNTdWJqZWN0Lk1BVEhFTUFUSUNTXTogW1xuICAgICdhbGdlYnJhJywgJ2dlb21ldHJpYScsICd0cmlnb25vbWV0cmlhJywgJ2NhbGN1bG8nLCAnZXN0YWRpc3RpY2EnLCAncHJvYmFiaWxpZGFkJyxcbiAgICAnZWN1YWNpb25lcycsICdmdW5jaW9uZXMnLCAnbG9nYXJpdG1vcycsICdtYXRyaWNlcycsICdkZXJpdmFkYXMnLCAnaW50ZWdyYWxlcydcbiAgXSxcbiAgW0FjYWRlbWljU3ViamVjdC5QSFlTSUNTXTogW1xuICAgICdjaW5lbWF0aWNhJywgJ2RpbmFtaWNhJywgJ2VuZXJnaWEnLCAnb25kYXMnLCAndGVybW9kaW5hbWljYScsICdlbGVjdHJpY2lkYWQnLFxuICAgICdtYWduZXRpc21vJywgJ29wdGljYScsICdtZWNhbmljYScsICdmbHVpZG9zJywgJ21vdmltaWVudG8nLCAnZnVlcnphJywgJ3ZlbG9jaWRhZCdcbiAgXSxcbiAgW0FjYWRlbWljU3ViamVjdC5DSEVNSVNUUlldOiBbXG4gICAgJ2F0b21vcycsICdtb2xlY3VsYXMnLCAnZW5sYWNlcycsICdyZWFjY2lvbmVzJywgJ2VzdGVxdWlvbWV0cmlhJywgJ2FjaWRvcycsXG4gICAgJ2Jhc2VzJywgJ294aWRhY2lvbicsICdyZWR1Y2Npb24nLCAnZXF1aWxpYnJpbycsICdjaW5ldGljYScsICd0ZXJtb3F1aW1pY2EnXG4gIF1cbn1cblxuLy8gUGFsYWJyYXMgY2xhdmUgcXVlIGluZGljYW4gZGlmaWN1bHRhZGVzXG5jb25zdCBESUZGSUNVTFRZX0lORElDQVRPUlMgPSB7XG4gIGhpZ2g6IFsnbXV5IGRpZsOtY2lsJywgJ25vIGVudGllbmRvJywgJ2NvbmZ1c28nLCAnY29tcGxpY2FkbycsICdpbXBvc2libGUnLCAnbm8gcHVlZG8nXSxcbiAgbWVkaXVtOiBbJ2RpZsOtY2lsJywgJ2NvbXBsaWNhZG8nLCAnbm8gY29tcHJlbmRvJywgJ21lIGN1ZXN0YScsICdwcm9ibGVtYSddLFxuICBsb3c6IFsndW4gcG9jbyBkaWbDrWNpbCcsICduZWNlc2l0byBheXVkYScsICdubyBlc3TDoSBjbGFybycsICdkdWRhcyddXG59XG5cbi8vIFBhbGFicmFzIGNsYXZlIHF1ZSBpbmRpY2FuIHByb2dyZXNvIHBvc2l0aXZvXG5jb25zdCBQUk9HUkVTU19JTkRJQ0FUT1JTID0ge1xuICBleGNlbGxlbnQ6IFsnZXhjZWxlbnRlJywgJ3BlcmZlY3RvJywgJ2RvbWlubycsICdmw6FjaWwnLCAnZW50aWVuZG8gdG9kbyddLFxuICBnb29kOiBbJ2JpZW4nLCAnZW50aWVuZG8nLCAnY29tcHJlbmRvJywgJ2xvZ3LDqScsICdtZWpvcmFuZG8nXSxcbiAgZmFpcjogWydtw6FzIG8gbWVub3MnLCAncmVndWxhcicsICdhbGd1bmFzIHZlY2VzJywgJ2F2YW56YW5kbyddXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgQWNhZGVtaWNBbmFseXNpcyB7XG4gIHVzZXJJZDogc3RyaW5nXG4gIHN0dWRlbnROYW1lPzogc3RyaW5nXG4gIHN1YmplY3RzOiBTdWJqZWN0QW5hbHlzaXNbXVxuICBvdmVyYWxsUGVyZm9ybWFuY2U6IG51bWJlclxuICBzdHJ1Z2dsaW5nQXJlYXM6IHN0cmluZ1tdXG4gIHN0cmVuZ3Roczogc3RyaW5nW11cbiAgcmVjb21tZW5kZWRUb3BpY3M6IHN0cmluZ1tdXG4gIGxlYXJuaW5nUGF0dGVybjogJ3Zpc3VhbCcgfCAnYW5hbHl0aWNhbCcgfCAncHJhY3RpY2FsJyB8ICdtaXhlZCdcbiAgbGFzdFJlcG9ydERhdGU6IERhdGVcbn1cblxuZXhwb3J0IGludGVyZmFjZSBTdWJqZWN0QW5hbHlzaXMge1xuICBzdWJqZWN0OiBBY2FkZW1pY1N1YmplY3RcbiAgc3ViamVjdE5hbWU6IHN0cmluZ1xuICBwZXJmb3JtYW5jZTogbnVtYmVyXG4gIGRpZmZpY3VsdHlMZXZlbDogRGlmZmljdWx0eUxldmVsXG4gIHN0cnVnZ2xpbmdUb3BpY3M6IHN0cmluZ1tdXG4gIG1hc3RlcmVkVG9waWNzOiBzdHJpbmdbXVxuICByZWNlbnRNZW50aW9uczogbnVtYmVyXG4gIG5lZWRzQXR0ZW50aW9uOiBib29sZWFuXG4gIHNwZWNpZmljQ2hhbGxlbmdlczogc3RyaW5nW11cbn1cblxuZXhwb3J0IGNsYXNzIEFjYWRlbWljQW5hbHl6ZXIge1xuICBcbiAgLyoqXG4gICAqIEFuYWxpemEgbG9zIHJlcG9ydGVzIGFjYWTDqW1pY29zIGRlIHVuIGVzdHVkaWFudGVcbiAgICovXG4gIHN0YXRpYyBhc3luYyBhbmFseXplU3R1ZGVudCh1c2VySWQ6IHN0cmluZyk6IFByb21pc2U8QWNhZGVtaWNBbmFseXNpcz4ge1xuICAgIGNvbnN0IHJlcG9ydHMgPSB0ZW1wV2Vla2x5UmVwb3J0cy5maWx0ZXIocmVwb3J0ID0+IHJlcG9ydC51c2VySWQgPT09IHVzZXJJZClcbiAgICBcbiAgICBpZiAocmVwb3J0cy5sZW5ndGggPT09IDApIHtcbiAgICAgIHJldHVybiB0aGlzLmNyZWF0ZURlZmF1bHRBbmFseXNpcyh1c2VySWQpXG4gICAgfVxuXG4gICAgLy8gQW5hbGl6YXIgcmVwb3J0ZXMgcmVjaWVudGVzICjDumx0aW1hcyA4IHNlbWFuYXMpXG4gICAgY29uc3QgcmVjZW50UmVwb3J0cyA9IHJlcG9ydHNcbiAgICAgIC5zb3J0KChhLCBiKSA9PiBuZXcgRGF0ZShiLmNyZWF0ZWRBdCkuZ2V0VGltZSgpIC0gbmV3IERhdGUoYS5jcmVhdGVkQXQpLmdldFRpbWUoKSlcbiAgICAgIC5zbGljZSgwLCA4KVxuXG4gICAgLy8gRXh0cmFlciB0b2RvIGVsIHRleHRvIGRlIGxhcyByZXNwdWVzdGFzXG4gICAgY29uc3QgYWxsUmVzcG9uc2VUZXh0ID0gcmVjZW50UmVwb3J0c1xuICAgICAgLmZsYXRNYXAocmVwb3J0ID0+IE9iamVjdC52YWx1ZXMocmVwb3J0LnJlc3BvbnNlcyB8fCB7fSkpXG4gICAgICAuZmlsdGVyKEJvb2xlYW4pXG4gICAgICAuam9pbignICcpXG4gICAgICAudG9Mb3dlckNhc2UoKVxuXG4gICAgLy8gQW5hbGl6YXIgcG9yIG1hdGVyaWFzXG4gICAgY29uc3Qgc3ViamVjdEFuYWx5c2VzID0gdGhpcy5hbmFseXplU3ViamVjdHMoYWxsUmVzcG9uc2VUZXh0LCByZWNlbnRSZXBvcnRzKVxuICAgIFxuICAgIC8vIEFuw6FsaXNpcyBnZW5lcmFsXG4gICAgY29uc3Qgb3ZlcmFsbFBlcmZvcm1hbmNlID0gdGhpcy5jYWxjdWxhdGVPdmVyYWxsUGVyZm9ybWFuY2Uoc3ViamVjdEFuYWx5c2VzKVxuICAgIGNvbnN0IHN0cnVnZ2xpbmdBcmVhcyA9IHRoaXMuaWRlbnRpZnlTdHJ1Z2dsaW5nQXJlYXMoc3ViamVjdEFuYWx5c2VzLCBhbGxSZXNwb25zZVRleHQpXG4gICAgY29uc3Qgc3RyZW5ndGhzID0gdGhpcy5pZGVudGlmeVN0cmVuZ3RocyhzdWJqZWN0QW5hbHlzZXMsIGFsbFJlc3BvbnNlVGV4dClcbiAgICBjb25zdCByZWNvbW1lbmRlZFRvcGljcyA9IHRoaXMuZ2VuZXJhdGVSZWNvbW1lbmRhdGlvbnMoc3ViamVjdEFuYWx5c2VzKVxuICAgIGNvbnN0IGxlYXJuaW5nUGF0dGVybiA9IHRoaXMuaWRlbnRpZnlMZWFybmluZ1BhdHRlcm4oYWxsUmVzcG9uc2VUZXh0KVxuXG4gICAgcmV0dXJuIHtcbiAgICAgIHVzZXJJZCxcbiAgICAgIHN1YmplY3RzOiBzdWJqZWN0QW5hbHlzZXMsXG4gICAgICBvdmVyYWxsUGVyZm9ybWFuY2UsXG4gICAgICBzdHJ1Z2dsaW5nQXJlYXMsXG4gICAgICBzdHJlbmd0aHMsXG4gICAgICByZWNvbW1lbmRlZFRvcGljcyxcbiAgICAgIGxlYXJuaW5nUGF0dGVybixcbiAgICAgIGxhc3RSZXBvcnREYXRlOiBuZXcgRGF0ZShyZWNlbnRSZXBvcnRzWzBdPy5jcmVhdGVkQXQgfHwgRGF0ZS5ub3coKSlcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogQW5hbGl6YSBtYXRlcmlhcyBlc3BlY8OtZmljYXMgbWVuY2lvbmFkYXMgZW4gbG9zIHJlcG9ydGVzXG4gICAqL1xuICBwcml2YXRlIHN0YXRpYyBhbmFseXplU3ViamVjdHModGV4dDogc3RyaW5nLCByZXBvcnRzOiBhbnlbXSk6IFN1YmplY3RBbmFseXNpc1tdIHtcbiAgICBjb25zdCBhbmFseXNlczogU3ViamVjdEFuYWx5c2lzW10gPSBbXVxuXG4gICAgLy8gUGFsYWJyYXMgY2xhdmUgcGFyYSBpZGVudGlmaWNhciBtYXRlcmlhc1xuICAgIGNvbnN0IHN1YmplY3RLZXl3b3JkcyA9IHtcbiAgICAgIFtBY2FkZW1pY1N1YmplY3QuTUFUSEVNQVRJQ1NdOiBbJ21hdGVtw6F0aWNhJywgJ21hdGVtw6F0aWNhcycsICdtYXRlJywgJ8OhbGdlYnJhJywgJ2dlb21ldHLDrWEnLCAnY8OhbGN1bG8nLCAnbsO6bWVyb3MnXSxcbiAgICAgIFtBY2FkZW1pY1N1YmplY3QuUEhZU0lDU106IFsnZsOtc2ljYScsICdtZWPDoW5pY2EnLCAnZW5lcmfDrWEnLCAnZnVlcnphJywgJ21vdmltaWVudG8nLCAndmVsb2NpZGFkJ10sXG4gICAgICBbQWNhZGVtaWNTdWJqZWN0LkNIRU1JU1RSWV06IFsncXXDrW1pY2EnLCAnw6F0b21vcycsICdtb2zDqWN1bGFzJywgJ3JlYWNjaW9uZXMnLCAnZWxlbWVudG9zJywgJ2xhYm9yYXRvcmlvJ10sXG4gICAgICBbQWNhZGVtaWNTdWJqZWN0LkJJT0xPR1ldOiBbJ2Jpb2xvZ8OtYScsICdjw6lsdWxhcycsICdvcmdhbmlzbW9zJywgJ2V2b2x1Y2nDs24nLCAnZWNvc2lzdGVtYSddLFxuICAgICAgW0FjYWRlbWljU3ViamVjdC5TUEFOSVNIXTogWydsZW5ndWEnLCAnZXNwYcOxb2wnLCAnbGl0ZXJhdHVyYScsICdyZWRhY2Npw7NuJywgJ2dyYW3DoXRpY2EnXSxcbiAgICAgIFtBY2FkZW1pY1N1YmplY3QuRU5HTElTSF06IFsnaW5nbMOpcycsICdlbmdsaXNoJywgJ2dyYW1tYXInLCAndm9jYWJ1bGFyeSddLFxuICAgICAgW0FjYWRlbWljU3ViamVjdC5ISVNUT1JZXTogWydoaXN0b3JpYScsICdjaXZpbGl6YWNpw7NuJywgJ8OpcG9jYScsICdndWVycmEnLCAncmV2b2x1Y2nDs24nXSxcbiAgICAgIFtBY2FkZW1pY1N1YmplY3QuR0VPR1JBUEhZXTogWydnZW9ncmFmw61hJywgJ3Bhw61zZXMnLCAnY29udGluZW50ZXMnLCAnY2xpbWEnLCAncG9ibGFjacOzbiddXG4gICAgfVxuXG4gICAgT2JqZWN0LmVudHJpZXMoc3ViamVjdEtleXdvcmRzKS5mb3JFYWNoKChbc3ViamVjdCwga2V5d29yZHNdKSA9PiB7XG4gICAgICBjb25zdCBtZW50aW9ucyA9IGtleXdvcmRzLmZpbHRlcihrZXl3b3JkID0+IHRleHQuaW5jbHVkZXMoa2V5d29yZCkpLmxlbmd0aFxuICAgICAgXG4gICAgICBpZiAobWVudGlvbnMgPiAwKSB7XG4gICAgICAgIGNvbnN0IGFuYWx5c2lzID0gdGhpcy5hbmFseXplU3BlY2lmaWNTdWJqZWN0KHN1YmplY3QgYXMgQWNhZGVtaWNTdWJqZWN0LCB0ZXh0LCByZXBvcnRzLCBtZW50aW9ucylcbiAgICAgICAgYW5hbHlzZXMucHVzaChhbmFseXNpcylcbiAgICAgIH1cbiAgICB9KVxuXG4gICAgLy8gU2kgbm8gc2UgZW5jb250cmFyb24gbWF0ZXJpYXMgZXNwZWPDrWZpY2FzLCBhZ3JlZ2FyIGFuw6FsaXNpcyBnZW5lcmFsXG4gICAgaWYgKGFuYWx5c2VzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgYW5hbHlzZXMucHVzaCh0aGlzLmNyZWF0ZUdlbmVyYWxTdWJqZWN0QW5hbHlzaXModGV4dCwgcmVwb3J0cykpXG4gICAgfVxuXG4gICAgcmV0dXJuIGFuYWx5c2VzXG4gIH1cblxuICAvKipcbiAgICogQW5hbGl6YSB1bmEgbWF0ZXJpYSBlc3BlY8OtZmljYVxuICAgKi9cbiAgcHJpdmF0ZSBzdGF0aWMgYW5hbHl6ZVNwZWNpZmljU3ViamVjdChcbiAgICBzdWJqZWN0OiBBY2FkZW1pY1N1YmplY3QsIFxuICAgIHRleHQ6IHN0cmluZywgXG4gICAgcmVwb3J0czogYW55W10sIFxuICAgIG1lbnRpb25zOiBudW1iZXJcbiAgKTogU3ViamVjdEFuYWx5c2lzIHtcbiAgICBcbiAgICBjb25zdCBzdWJqZWN0TmFtZSA9IHRoaXMuZ2V0U3ViamVjdERpc3BsYXlOYW1lKHN1YmplY3QpXG4gICAgY29uc3QgdG9waWNzID0gU1VCSkVDVF9UT1BJQ1Nbc3ViamVjdF0gfHwgW11cbiAgICBcbiAgICAvLyBEZXRlY3RhciB0ZW1hcyBtZW5jaW9uYWRvc1xuICAgIGNvbnN0IG1lbnRpb25lZFRvcGljcyA9IHRvcGljcy5maWx0ZXIodG9waWMgPT4gdGV4dC5pbmNsdWRlcyh0b3BpYykpXG4gICAgXG4gICAgLy8gQW5hbGl6YXIgZGlmaWN1bHRhZGVzIGVzcGVjw61maWNhc1xuICAgIGNvbnN0IHNwZWNpZmljQ2hhbGxlbmdlcyA9IHRoaXMuZXh0cmFjdFNwZWNpZmljQ2hhbGxlbmdlcyh0ZXh0LCBzdWJqZWN0KVxuICAgIFxuICAgIC8vIENhbGN1bGFyIHJlbmRpbWllbnRvIGJhc2FkbyBlbiBpbmRpY2Fkb3Jlc1xuICAgIGNvbnN0IHBlcmZvcm1hbmNlID0gdGhpcy5jYWxjdWxhdGVTdWJqZWN0UGVyZm9ybWFuY2UodGV4dCwgc3BlY2lmaWNDaGFsbGVuZ2VzLmxlbmd0aClcbiAgICBcbiAgICAvLyBEZXRlcm1pbmFyIG5pdmVsIGRlIGRpZmljdWx0YWRcbiAgICBjb25zdCBkaWZmaWN1bHR5TGV2ZWwgPSB0aGlzLmRldGVybWluZURpZmZpY3VsdHlMZXZlbChwZXJmb3JtYW5jZSwgc3BlY2lmaWNDaGFsbGVuZ2VzLmxlbmd0aClcbiAgICBcbiAgICAvLyBEZXRlcm1pbmFyIHNpIG5lY2VzaXRhIGF0ZW5jacOzblxuICAgIGNvbnN0IG5lZWRzQXR0ZW50aW9uID0gcGVyZm9ybWFuY2UgPCA2MCB8fCBzcGVjaWZpY0NoYWxsZW5nZXMubGVuZ3RoID4gMlxuXG4gICAgcmV0dXJuIHtcbiAgICAgIHN1YmplY3QsXG4gICAgICBzdWJqZWN0TmFtZSxcbiAgICAgIHBlcmZvcm1hbmNlLFxuICAgICAgZGlmZmljdWx0eUxldmVsLFxuICAgICAgc3RydWdnbGluZ1RvcGljczogbWVudGlvbmVkVG9waWNzLnNsaWNlKDAsIDMpLCAvLyBQcmltZXJvcyAzIHRlbWFzIG1lbmNpb25hZG9zXG4gICAgICBtYXN0ZXJlZFRvcGljczogcGVyZm9ybWFuY2UgPiA3NSA/IG1lbnRpb25lZFRvcGljcy5zbGljZSgwLCAyKSA6IFtdLFxuICAgICAgcmVjZW50TWVudGlvbnM6IG1lbnRpb25zLFxuICAgICAgbmVlZHNBdHRlbnRpb24sXG4gICAgICBzcGVjaWZpY0NoYWxsZW5nZXNcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogRXh0cmFlIGRlc2Fmw61vcyBlc3BlY8OtZmljb3MgbWVuY2lvbmFkb3MgcG9yIGVsIGVzdHVkaWFudGVcbiAgICovXG4gIHByaXZhdGUgc3RhdGljIGV4dHJhY3RTcGVjaWZpY0NoYWxsZW5nZXModGV4dDogc3RyaW5nLCBzdWJqZWN0OiBBY2FkZW1pY1N1YmplY3QpOiBzdHJpbmdbXSB7XG4gICAgY29uc3QgY2hhbGxlbmdlczogc3RyaW5nW10gPSBbXVxuICAgIFxuICAgIC8vIEJ1c2NhciBwYXRyb25lcyBkZSBkaWZpY3VsdGFkXG4gICAgY29uc3QgZGlmZmljdWx0eVBhdHRlcm5zID0gW1xuICAgICAgL25vIGVudGllbmRvICguKj8pKD86XFwufCx8JCkvZyxcbiAgICAgIC9tZSBjdWVzdGEgKC4qPykoPzpcXC58LHwkKS9nLFxuICAgICAgL2RpZsOtY2lsICguKj8pKD86XFwufCx8JCkvZyxcbiAgICAgIC9wcm9ibGVtYSBjb24gKC4qPykoPzpcXC58LHwkKS9nLFxuICAgICAgL2NvbmZ1c28gKC4qPykoPzpcXC58LHwkKS9nXG4gICAgXVxuXG4gICAgZGlmZmljdWx0eVBhdHRlcm5zLmZvckVhY2gocGF0dGVybiA9PiB7XG4gICAgICBsZXQgbWF0Y2hcbiAgICAgIHdoaWxlICgobWF0Y2ggPSBwYXR0ZXJuLmV4ZWModGV4dCkpICE9PSBudWxsKSB7XG4gICAgICAgIGlmIChtYXRjaFsxXSAmJiBtYXRjaFsxXS5sZW5ndGggPCA1MCkge1xuICAgICAgICAgIGNoYWxsZW5nZXMucHVzaChtYXRjaFsxXS50cmltKCkpXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KVxuXG4gICAgcmV0dXJuIGNoYWxsZW5nZXMuc2xpY2UoMCwgMykgLy8gTcOheGltbyAzIGRlc2Fmw61vcyBlc3BlY8OtZmljb3NcbiAgfVxuXG4gIC8qKlxuICAgKiBDYWxjdWxhIGVsIHJlbmRpbWllbnRvIGRlIHVuYSBtYXRlcmlhXG4gICAqL1xuICBwcml2YXRlIHN0YXRpYyBjYWxjdWxhdGVTdWJqZWN0UGVyZm9ybWFuY2UodGV4dDogc3RyaW5nLCBjaGFsbGVuZ2VzQ291bnQ6IG51bWJlcik6IG51bWJlciB7XG4gICAgbGV0IHNjb3JlID0gNzAgLy8gQmFzZSBzY29yZVxuXG4gICAgLy8gSW5kaWNhZG9yZXMgcG9zaXRpdm9zXG4gICAgT2JqZWN0LmVudHJpZXMoUFJPR1JFU1NfSU5ESUNBVE9SUykuZm9yRWFjaCgoW2xldmVsLCBpbmRpY2F0b3JzXSkgPT4ge1xuICAgICAgY29uc3QgbXVsdGlwbGllciA9IGxldmVsID09PSAnZXhjZWxsZW50JyA/IDEwIDogbGV2ZWwgPT09ICdnb29kJyA/IDUgOiAyXG4gICAgICBpbmRpY2F0b3JzLmZvckVhY2goaW5kaWNhdG9yID0+IHtcbiAgICAgICAgaWYgKHRleHQuaW5jbHVkZXMoaW5kaWNhdG9yKSkge1xuICAgICAgICAgIHNjb3JlICs9IG11bHRpcGxpZXJcbiAgICAgICAgfVxuICAgICAgfSlcbiAgICB9KVxuXG4gICAgLy8gSW5kaWNhZG9yZXMgbmVnYXRpdm9zXG4gICAgT2JqZWN0LmVudHJpZXMoRElGRklDVUxUWV9JTkRJQ0FUT1JTKS5mb3JFYWNoKChbbGV2ZWwsIGluZGljYXRvcnNdKSA9PiB7XG4gICAgICBjb25zdCBwZW5hbHR5ID0gbGV2ZWwgPT09ICdoaWdoJyA/IDE1IDogbGV2ZWwgPT09ICdtZWRpdW0nID8gMTAgOiA1XG4gICAgICBpbmRpY2F0b3JzLmZvckVhY2goaW5kaWNhdG9yID0+IHtcbiAgICAgICAgaWYgKHRleHQuaW5jbHVkZXMoaW5kaWNhdG9yKSkge1xuICAgICAgICAgIHNjb3JlIC09IHBlbmFsdHlcbiAgICAgICAgfVxuICAgICAgfSlcbiAgICB9KVxuXG4gICAgLy8gUGVuYWxpemFyIHBvciBuw7ptZXJvIGRlIGRlc2Fmw61vcyBlc3BlY8OtZmljb3NcbiAgICBzY29yZSAtPSBjaGFsbGVuZ2VzQ291bnQgKiA4XG5cbiAgICByZXR1cm4gTWF0aC5tYXgoMCwgTWF0aC5taW4oMTAwLCBzY29yZSkpXG4gIH1cblxuICAvKipcbiAgICogRGV0ZXJtaW5hIGVsIG5pdmVsIGRlIGRpZmljdWx0YWQgYmFzYWRvIGVuIGVsIHJlbmRpbWllbnRvXG4gICAqL1xuICBwcml2YXRlIHN0YXRpYyBkZXRlcm1pbmVEaWZmaWN1bHR5TGV2ZWwocGVyZm9ybWFuY2U6IG51bWJlciwgY2hhbGxlbmdlc0NvdW50OiBudW1iZXIpOiBEaWZmaWN1bHR5TGV2ZWwge1xuICAgIGlmIChwZXJmb3JtYW5jZSA8IDQwIHx8IGNoYWxsZW5nZXNDb3VudCA+IDMpIHJldHVybiBEaWZmaWN1bHR5TGV2ZWwuUkVWSUVXX05FRURFRFxuICAgIGlmIChwZXJmb3JtYW5jZSA8IDYwKSByZXR1cm4gRGlmZmljdWx0eUxldmVsLkJBU0lDXG4gICAgaWYgKHBlcmZvcm1hbmNlIDwgODApIHJldHVybiBEaWZmaWN1bHR5TGV2ZWwuSU5URVJNRURJQVRFXG4gICAgcmV0dXJuIERpZmZpY3VsdHlMZXZlbC5BRFZBTkNFRFxuICB9XG5cbiAgLyoqXG4gICAqIENyZWEgYW7DoWxpc2lzIHBvciBkZWZlY3RvIHBhcmEgZXN0dWRpYW50ZXMgc2luIHJlcG9ydGVzXG4gICAqL1xuICBwcml2YXRlIHN0YXRpYyBjcmVhdGVEZWZhdWx0QW5hbHlzaXModXNlcklkOiBzdHJpbmcpOiBBY2FkZW1pY0FuYWx5c2lzIHtcbiAgICByZXR1cm4ge1xuICAgICAgdXNlcklkLFxuICAgICAgc3ViamVjdHM6IFt0aGlzLmNyZWF0ZUdlbmVyYWxTdWJqZWN0QW5hbHlzaXMoJycsIFtdKV0sXG4gICAgICBvdmVyYWxsUGVyZm9ybWFuY2U6IDUwLFxuICAgICAgc3RydWdnbGluZ0FyZWFzOiBbJ0ZhbHRhIGRlIGRhdG9zIGhpc3TDs3JpY29zJ10sXG4gICAgICBzdHJlbmd0aHM6IFsnTnVldm8gZXN0dWRpYW50ZSBjb24gcG90ZW5jaWFsJ10sXG4gICAgICByZWNvbW1lbmRlZFRvcGljczogWydFdmFsdWFjacOzbiBpbmljaWFsJywgJ0Z1bmRhbWVudG9zJ10sXG4gICAgICBsZWFybmluZ1BhdHRlcm46ICdtaXhlZCcsXG4gICAgICBsYXN0UmVwb3J0RGF0ZTogbmV3IERhdGUoKVxuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBDcmVhIGFuw6FsaXNpcyBnZW5lcmFsIGN1YW5kbyBubyBzZSBkZXRlY3RhbiBtYXRlcmlhcyBlc3BlY8OtZmljYXNcbiAgICovXG4gIHByaXZhdGUgc3RhdGljIGNyZWF0ZUdlbmVyYWxTdWJqZWN0QW5hbHlzaXModGV4dDogc3RyaW5nLCByZXBvcnRzOiBhbnlbXSk6IFN1YmplY3RBbmFseXNpcyB7XG4gICAgY29uc3QgcGVyZm9ybWFuY2UgPSB0ZXh0Lmxlbmd0aCA+IDAgPyB0aGlzLmNhbGN1bGF0ZVN1YmplY3RQZXJmb3JtYW5jZSh0ZXh0LCAwKSA6IDUwXG4gICAgXG4gICAgcmV0dXJuIHtcbiAgICAgIHN1YmplY3Q6IEFjYWRlbWljU3ViamVjdC5HRU5FUkFMLFxuICAgICAgc3ViamVjdE5hbWU6ICdBbsOhbGlzaXMgR2VuZXJhbCcsXG4gICAgICBwZXJmb3JtYW5jZSxcbiAgICAgIGRpZmZpY3VsdHlMZXZlbDogdGhpcy5kZXRlcm1pbmVEaWZmaWN1bHR5TGV2ZWwocGVyZm9ybWFuY2UsIDApLFxuICAgICAgc3RydWdnbGluZ1RvcGljczogW10sXG4gICAgICBtYXN0ZXJlZFRvcGljczogW10sXG4gICAgICByZWNlbnRNZW50aW9uczogcmVwb3J0cy5sZW5ndGgsXG4gICAgICBuZWVkc0F0dGVudGlvbjogcGVyZm9ybWFuY2UgPCA2MCxcbiAgICAgIHNwZWNpZmljQ2hhbGxlbmdlczogdGhpcy5leHRyYWN0U3BlY2lmaWNDaGFsbGVuZ2VzKHRleHQsIEFjYWRlbWljU3ViamVjdC5HRU5FUkFMKVxuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBDYWxjdWxhIGVsIHJlbmRpbWllbnRvIGdlbmVyYWxcbiAgICovXG4gIHByaXZhdGUgc3RhdGljIGNhbGN1bGF0ZU92ZXJhbGxQZXJmb3JtYW5jZShzdWJqZWN0czogU3ViamVjdEFuYWx5c2lzW10pOiBudW1iZXIge1xuICAgIGlmIChzdWJqZWN0cy5sZW5ndGggPT09IDApIHJldHVybiA1MFxuICAgIFxuICAgIGNvbnN0IGF2ZXJhZ2UgPSBzdWJqZWN0cy5yZWR1Y2UoKHN1bSwgc3ViamVjdCkgPT4gc3VtICsgc3ViamVjdC5wZXJmb3JtYW5jZSwgMCkgLyBzdWJqZWN0cy5sZW5ndGhcbiAgICByZXR1cm4gTWF0aC5yb3VuZChhdmVyYWdlKVxuICB9XG5cbiAgLyoqXG4gICAqIElkZW50aWZpY2Egw6FyZWFzIGNvbiBkaWZpY3VsdGFkZXNcbiAgICovXG4gIHByaXZhdGUgc3RhdGljIGlkZW50aWZ5U3RydWdnbGluZ0FyZWFzKHN1YmplY3RzOiBTdWJqZWN0QW5hbHlzaXNbXSwgdGV4dDogc3RyaW5nKTogc3RyaW5nW10ge1xuICAgIGNvbnN0IGFyZWFzOiBzdHJpbmdbXSA9IFtdXG4gICAgXG4gICAgLy8gQWdyZWdhciBtYXRlcmlhcyBjb24gYmFqbyByZW5kaW1pZW50b1xuICAgIHN1YmplY3RzXG4gICAgICAuZmlsdGVyKHN1YmplY3QgPT4gc3ViamVjdC5uZWVkc0F0dGVudGlvbilcbiAgICAgIC5mb3JFYWNoKHN1YmplY3QgPT4ge1xuICAgICAgICBhcmVhcy5wdXNoKGAke3N1YmplY3Quc3ViamVjdE5hbWV9OiAke3N1YmplY3Quc3BlY2lmaWNDaGFsbGVuZ2VzLmpvaW4oJywgJyl9YClcbiAgICAgIH0pXG5cbiAgICAvLyBTaSBubyBoYXkgw6FyZWFzIGVzcGVjw61maWNhcywgYnVzY2FyIHBhdHJvbmVzIGdlbmVyYWxlc1xuICAgIGlmIChhcmVhcy5sZW5ndGggPT09IDAgJiYgdGV4dC5sZW5ndGggPiAwKSB7XG4gICAgICBpZiAodGV4dC5pbmNsdWRlcygndGllbXBvJykpIGFyZWFzLnB1c2goJ0dlc3Rpw7NuIGRlbCB0aWVtcG8nKVxuICAgICAgaWYgKHRleHQuaW5jbHVkZXMoJ2NvbmNlbnRyJykpIGFyZWFzLnB1c2goJ0NvbmNlbnRyYWNpw7NuJylcbiAgICAgIGlmICh0ZXh0LmluY2x1ZGVzKCdtb3RpdicpKSBhcmVhcy5wdXNoKCdNb3RpdmFjacOzbicpXG4gICAgfVxuXG4gICAgcmV0dXJuIGFyZWFzLnNsaWNlKDAsIDMpXG4gIH1cblxuICAvKipcbiAgICogSWRlbnRpZmljYSBmb3J0YWxlemFzIGRlbCBlc3R1ZGlhbnRlXG4gICAqL1xuICBwcml2YXRlIHN0YXRpYyBpZGVudGlmeVN0cmVuZ3RocyhzdWJqZWN0czogU3ViamVjdEFuYWx5c2lzW10sIHRleHQ6IHN0cmluZyk6IHN0cmluZ1tdIHtcbiAgICBjb25zdCBzdHJlbmd0aHM6IHN0cmluZ1tdID0gW11cbiAgICBcbiAgICAvLyBBZ3JlZ2FyIG1hdGVyaWFzIGNvbiBidWVuIHJlbmRpbWllbnRvXG4gICAgc3ViamVjdHNcbiAgICAgIC5maWx0ZXIoc3ViamVjdCA9PiBzdWJqZWN0LnBlcmZvcm1hbmNlID4gNzUpXG4gICAgICAuZm9yRWFjaChzdWJqZWN0ID0+IHtcbiAgICAgICAgc3RyZW5ndGhzLnB1c2goYERvbWluaW8gZW4gJHtzdWJqZWN0LnN1YmplY3ROYW1lfWApXG4gICAgICB9KVxuXG4gICAgLy8gUGF0cm9uZXMgZGUgZm9ydGFsZXphIGdlbmVyYWxcbiAgICBpZiAodGV4dC5pbmNsdWRlcygnb3JnYW5peicpKSBzdHJlbmd0aHMucHVzaCgnQ2FwYWNpZGFkIGRlIG9yZ2FuaXphY2nDs24nKVxuICAgIGlmICh0ZXh0LmluY2x1ZGVzKCdwZXJzZXZlcicpIHx8IHRleHQuaW5jbHVkZXMoJ3BlcnNpc3QnKSkgc3RyZW5ndGhzLnB1c2goJ1BlcnNldmVyYW5jaWEnKVxuICAgIGlmICh0ZXh0LmluY2x1ZGVzKCdjcmVhdGl2JykpIHN0cmVuZ3Rocy5wdXNoKCdQZW5zYW1pZW50byBjcmVhdGl2bycpXG5cbiAgICByZXR1cm4gc3RyZW5ndGhzLmxlbmd0aCA+IDAgPyBzdHJlbmd0aHMuc2xpY2UoMCwgMykgOiBbJ0RlZGljYWNpw7NuIGFsIGFwcmVuZGl6YWplJ11cbiAgfVxuXG4gIC8qKlxuICAgKiBHZW5lcmEgcmVjb21lbmRhY2lvbmVzIGRlIHRlbWFzXG4gICAqL1xuICBwcml2YXRlIHN0YXRpYyBnZW5lcmF0ZVJlY29tbWVuZGF0aW9ucyhzdWJqZWN0czogU3ViamVjdEFuYWx5c2lzW10pOiBzdHJpbmdbXSB7XG4gICAgY29uc3QgcmVjb21tZW5kYXRpb25zOiBzdHJpbmdbXSA9IFtdXG4gICAgXG4gICAgc3ViamVjdHMuZm9yRWFjaChzdWJqZWN0ID0+IHtcbiAgICAgIGlmIChzdWJqZWN0Lm5lZWRzQXR0ZW50aW9uKSB7XG4gICAgICAgIHJlY29tbWVuZGF0aW9ucy5wdXNoKGBSZWZvcnphciBjb25jZXB0b3MgYsOhc2ljb3MgZGUgJHtzdWJqZWN0LnN1YmplY3ROYW1lfWApXG4gICAgICAgIFxuICAgICAgICBpZiAoc3ViamVjdC5zdHJ1Z2dsaW5nVG9waWNzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICByZWNvbW1lbmRhdGlvbnMucHVzaChgUHJhY3RpY2FyOiAke3N1YmplY3Quc3RydWdnbGluZ1RvcGljcy5qb2luKCcsICcpfWApXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KVxuXG4gICAgcmV0dXJuIHJlY29tbWVuZGF0aW9ucy5zbGljZSgwLCA0KVxuICB9XG5cbiAgLyoqXG4gICAqIElkZW50aWZpY2EgZWwgcGF0csOzbiBkZSBhcHJlbmRpemFqZVxuICAgKi9cbiAgcHJpdmF0ZSBzdGF0aWMgaWRlbnRpZnlMZWFybmluZ1BhdHRlcm4odGV4dDogc3RyaW5nKTogJ3Zpc3VhbCcgfCAnYW5hbHl0aWNhbCcgfCAncHJhY3RpY2FsJyB8ICdtaXhlZCcge1xuICAgIGNvbnN0IHZpc3VhbEtleXdvcmRzID0gWydncsOhZmljbycsICdkaWFncmFtYScsICdpbWFnZW4nLCAndmlzdWFsJywgJ2RpYnVqbyddXG4gICAgY29uc3QgYW5hbHl0aWNhbEtleXdvcmRzID0gWydhbsOhbGlzaXMnLCAnbMOzZ2ljYScsICdyYXpvbmFtaWVudG8nLCAndGVvcsOtYSddXG4gICAgY29uc3QgcHJhY3RpY2FsS2V5d29yZHMgPSBbJ3Byw6FjdGljYScsICdlamVyY2ljaW8nLCAnYXBsaWNhcicsICdoYWNlciddXG5cbiAgICBjb25zdCB2aXN1YWxDb3VudCA9IHZpc3VhbEtleXdvcmRzLnJlZHVjZSgoY291bnQsIHdvcmQpID0+IGNvdW50ICsgKHRleHQuaW5jbHVkZXMod29yZCkgPyAxIDogMCksIDApXG4gICAgY29uc3QgYW5hbHl0aWNhbENvdW50ID0gYW5hbHl0aWNhbEtleXdvcmRzLnJlZHVjZSgoY291bnQsIHdvcmQpID0+IGNvdW50ICsgKHRleHQuaW5jbHVkZXMod29yZCkgPyAxIDogMCksIDApXG4gICAgY29uc3QgcHJhY3RpY2FsQ291bnQgPSBwcmFjdGljYWxLZXl3b3Jkcy5yZWR1Y2UoKGNvdW50LCB3b3JkKSA9PiBjb3VudCArICh0ZXh0LmluY2x1ZGVzKHdvcmQpID8gMSA6IDApLCAwKVxuXG4gICAgaWYgKHZpc3VhbENvdW50ID4gYW5hbHl0aWNhbENvdW50ICYmIHZpc3VhbENvdW50ID4gcHJhY3RpY2FsQ291bnQpIHJldHVybiAndmlzdWFsJ1xuICAgIGlmIChhbmFseXRpY2FsQ291bnQgPiBwcmFjdGljYWxDb3VudCkgcmV0dXJuICdhbmFseXRpY2FsJ1xuICAgIGlmIChwcmFjdGljYWxDb3VudCA+IDApIHJldHVybiAncHJhY3RpY2FsJ1xuICAgIHJldHVybiAnbWl4ZWQnXG4gIH1cblxuICAvKipcbiAgICogT2J0aWVuZSBlbCBub21icmUgZGUgdmlzdWFsaXphY2nDs24gZGUgdW5hIG1hdGVyaWFcbiAgICovXG4gIHByaXZhdGUgc3RhdGljIGdldFN1YmplY3REaXNwbGF5TmFtZShzdWJqZWN0OiBBY2FkZW1pY1N1YmplY3QpOiBzdHJpbmcge1xuICAgIGNvbnN0IG5hbWVzID0ge1xuICAgICAgW0FjYWRlbWljU3ViamVjdC5NQVRIRU1BVElDU106ICdNYXRlbcOhdGljYXMnLFxuICAgICAgW0FjYWRlbWljU3ViamVjdC5QSFlTSUNTXTogJ0bDrXNpY2EnLCBcbiAgICAgIFtBY2FkZW1pY1N1YmplY3QuQ0hFTUlTVFJZXTogJ1F1w61taWNhJyxcbiAgICAgIFtBY2FkZW1pY1N1YmplY3QuQklPTE9HWV06ICdCaW9sb2fDrWEnLFxuICAgICAgW0FjYWRlbWljU3ViamVjdC5TUEFOSVNIXTogJ0xlbmd1YSB5IExpdGVyYXR1cmEnLFxuICAgICAgW0FjYWRlbWljU3ViamVjdC5FTkdMSVNIXTogJ0luZ2zDqXMnLFxuICAgICAgW0FjYWRlbWljU3ViamVjdC5ISVNUT1JZXTogJ0hpc3RvcmlhJyxcbiAgICAgIFtBY2FkZW1pY1N1YmplY3QuR0VPR1JBUEhZXTogJ0dlb2dyYWbDrWEnLFxuICAgICAgW0FjYWRlbWljU3ViamVjdC5HRU5FUkFMXTogJ0dlbmVyYWwnXG4gICAgfVxuICAgIHJldHVybiBuYW1lc1tzdWJqZWN0XSB8fCAnTWF0ZXJpYSdcbiAgfVxuXG4gIC8qKlxuICAgKiBPYnRpZW5lIHVuIHJlc3VtZW4gY29udGV4dHVhbCBwYXJhIGdlbmVyYXIgZWplcmNpY2lvc1xuICAgKi9cbiAgc3RhdGljIGdldEV4ZXJjaXNlQ29udGV4dChhbmFseXNpczogQWNhZGVtaWNBbmFseXNpcywgc3ViamVjdD86IEFjYWRlbWljU3ViamVjdCk6IHN0cmluZyB7XG4gICAgY29uc3QgdGFyZ2V0U3ViamVjdCA9IHN1YmplY3QgfHwgYW5hbHlzaXMuc3ViamVjdHNbMF0/LnN1YmplY3QgfHwgQWNhZGVtaWNTdWJqZWN0LkdFTkVSQUxcbiAgICBjb25zdCBzdWJqZWN0QW5hbHlzaXMgPSBhbmFseXNpcy5zdWJqZWN0cy5maW5kKHMgPT4gcy5zdWJqZWN0ID09PSB0YXJnZXRTdWJqZWN0KVxuICAgIFxuICAgIGlmICghc3ViamVjdEFuYWx5c2lzKSB7XG4gICAgICByZXR1cm4gYEVzdHVkaWFudGU6IG5pdmVsIGludGVybWVkaW8sIG5lY2VzaXRhIGV2YWx1YWNpw7NuIGluaWNpYWwgZW4gJHt0YXJnZXRTdWJqZWN0fWBcbiAgICB9XG5cbiAgICBjb25zdCBjb250ZXh0ID0gW1xuICAgICAgYE1hdGVyaWE6ICR7c3ViamVjdEFuYWx5c2lzLnN1YmplY3ROYW1lfWAsXG4gICAgICBgTml2ZWw6ICR7c3ViamVjdEFuYWx5c2lzLmRpZmZpY3VsdHlMZXZlbH1gLFxuICAgICAgYFJlbmRpbWllbnRvIGFjdHVhbDogJHtzdWJqZWN0QW5hbHlzaXMucGVyZm9ybWFuY2V9JWAsXG4gICAgICBzdWJqZWN0QW5hbHlzaXMuc3BlY2lmaWNDaGFsbGVuZ2VzLmxlbmd0aCA+IDAgXG4gICAgICAgID8gYERpZmljdWx0YWRlcyBlc3BlY8OtZmljYXM6ICR7c3ViamVjdEFuYWx5c2lzLnNwZWNpZmljQ2hhbGxlbmdlcy5qb2luKCcsICcpfWBcbiAgICAgICAgOiBudWxsLFxuICAgICAgc3ViamVjdEFuYWx5c2lzLnN0cnVnZ2xpbmdUb3BpY3MubGVuZ3RoID4gMFxuICAgICAgICA/IGBUZW1hcyBhIHJlZm9yemFyOiAke3N1YmplY3RBbmFseXNpcy5zdHJ1Z2dsaW5nVG9waWNzLmpvaW4oJywgJyl9YFxuICAgICAgICA6IG51bGwsXG4gICAgICBgUGF0csOzbiBkZSBhcHJlbmRpemFqZTogJHthbmFseXNpcy5sZWFybmluZ1BhdHRlcm59YFxuICAgIF0uZmlsdGVyKEJvb2xlYW4pLmpvaW4oJy4gJylcblxuICAgIHJldHVybiBjb250ZXh0XG4gIH1cbn0iXSwibmFtZXMiOlsidGVtcFdlZWtseVJlcG9ydHMiLCJBY2FkZW1pY1N1YmplY3QiLCJEaWZmaWN1bHR5TGV2ZWwiLCJTVUJKRUNUX1RPUElDUyIsIkRJRkZJQ1VMVFlfSU5ESUNBVE9SUyIsImhpZ2giLCJtZWRpdW0iLCJsb3ciLCJQUk9HUkVTU19JTkRJQ0FUT1JTIiwiZXhjZWxsZW50IiwiZ29vZCIsImZhaXIiLCJBY2FkZW1pY0FuYWx5emVyIiwiYW5hbHl6ZVN0dWRlbnQiLCJ1c2VySWQiLCJyZXBvcnRzIiwiZmlsdGVyIiwicmVwb3J0IiwibGVuZ3RoIiwiY3JlYXRlRGVmYXVsdEFuYWx5c2lzIiwicmVjZW50UmVwb3J0cyIsInNvcnQiLCJhIiwiYiIsIkRhdGUiLCJjcmVhdGVkQXQiLCJnZXRUaW1lIiwic2xpY2UiLCJhbGxSZXNwb25zZVRleHQiLCJmbGF0TWFwIiwiT2JqZWN0IiwidmFsdWVzIiwicmVzcG9uc2VzIiwiQm9vbGVhbiIsImpvaW4iLCJ0b0xvd2VyQ2FzZSIsInN1YmplY3RBbmFseXNlcyIsImFuYWx5emVTdWJqZWN0cyIsIm92ZXJhbGxQZXJmb3JtYW5jZSIsImNhbGN1bGF0ZU92ZXJhbGxQZXJmb3JtYW5jZSIsInN0cnVnZ2xpbmdBcmVhcyIsImlkZW50aWZ5U3RydWdnbGluZ0FyZWFzIiwic3RyZW5ndGhzIiwiaWRlbnRpZnlTdHJlbmd0aHMiLCJyZWNvbW1lbmRlZFRvcGljcyIsImdlbmVyYXRlUmVjb21tZW5kYXRpb25zIiwibGVhcm5pbmdQYXR0ZXJuIiwiaWRlbnRpZnlMZWFybmluZ1BhdHRlcm4iLCJzdWJqZWN0cyIsImxhc3RSZXBvcnREYXRlIiwibm93IiwidGV4dCIsImFuYWx5c2VzIiwic3ViamVjdEtleXdvcmRzIiwiZW50cmllcyIsImZvckVhY2giLCJzdWJqZWN0Iiwia2V5d29yZHMiLCJtZW50aW9ucyIsImtleXdvcmQiLCJpbmNsdWRlcyIsImFuYWx5c2lzIiwiYW5hbHl6ZVNwZWNpZmljU3ViamVjdCIsInB1c2giLCJjcmVhdGVHZW5lcmFsU3ViamVjdEFuYWx5c2lzIiwic3ViamVjdE5hbWUiLCJnZXRTdWJqZWN0RGlzcGxheU5hbWUiLCJ0b3BpY3MiLCJtZW50aW9uZWRUb3BpY3MiLCJ0b3BpYyIsInNwZWNpZmljQ2hhbGxlbmdlcyIsImV4dHJhY3RTcGVjaWZpY0NoYWxsZW5nZXMiLCJwZXJmb3JtYW5jZSIsImNhbGN1bGF0ZVN1YmplY3RQZXJmb3JtYW5jZSIsImRpZmZpY3VsdHlMZXZlbCIsImRldGVybWluZURpZmZpY3VsdHlMZXZlbCIsIm5lZWRzQXR0ZW50aW9uIiwic3RydWdnbGluZ1RvcGljcyIsIm1hc3RlcmVkVG9waWNzIiwicmVjZW50TWVudGlvbnMiLCJjaGFsbGVuZ2VzIiwiZGlmZmljdWx0eVBhdHRlcm5zIiwicGF0dGVybiIsIm1hdGNoIiwiZXhlYyIsInRyaW0iLCJjaGFsbGVuZ2VzQ291bnQiLCJzY29yZSIsImxldmVsIiwiaW5kaWNhdG9ycyIsIm11bHRpcGxpZXIiLCJpbmRpY2F0b3IiLCJwZW5hbHR5IiwiTWF0aCIsIm1heCIsIm1pbiIsImF2ZXJhZ2UiLCJyZWR1Y2UiLCJzdW0iLCJyb3VuZCIsImFyZWFzIiwicmVjb21tZW5kYXRpb25zIiwidmlzdWFsS2V5d29yZHMiLCJhbmFseXRpY2FsS2V5d29yZHMiLCJwcmFjdGljYWxLZXl3b3JkcyIsInZpc3VhbENvdW50IiwiY291bnQiLCJ3b3JkIiwiYW5hbHl0aWNhbENvdW50IiwicHJhY3RpY2FsQ291bnQiLCJuYW1lcyIsImdldEV4ZXJjaXNlQ29udGV4dCIsInRhcmdldFN1YmplY3QiLCJzdWJqZWN0QW5hbHlzaXMiLCJmaW5kIiwicyIsImNvbnRleHQiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/academic-analyzer.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/academic-search-engine.ts":
/*!*******************************************!*\
  !*** ./src/lib/academic-search-engine.ts ***!
  \*******************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   AcademicSearchEngine: () => (/* binding */ AcademicSearchEngine)\n/* harmony export */ });\n/* harmony import */ var _web_search_integration__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./web-search-integration */ \"(rsc)/./src/lib/web-search-integration.ts\");\n/* harmony import */ var _conversation_memory__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./conversation-memory */ \"(rsc)/./src/lib/conversation-memory.ts\");\n/* harmony import */ var _emotion_analyzer__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./emotion-analyzer */ \"(rsc)/./src/lib/emotion-analyzer.ts\");\n// Sistema de Búsqueda Académica Inteligente para Sara\n// Integra búsqueda web con análisis contextual y notificaciones proactivas\n\n\n\nclass AcademicSearchEngine {\n    static{\n        // Plantillas de búsqueda optimizadas para contenido académico\n        this.SEARCH_TEMPLATES = {\n            explanation: {\n                es: \"{topic} explicación {subject} concepto básico tutorial\",\n                en: \"{topic} explanation {subject} basic concept tutorial\"\n            },\n            examples: {\n                es: \"{topic} ejemplos {subject} casos prácticos ejercicios\",\n                en: \"{topic} examples {subject} practical cases exercises\"\n            },\n            exercises: {\n                es: \"{topic} ejercicios {subject} problemas resueltos práctica\",\n                en: \"{topic} exercises {subject} solved problems practice\"\n            },\n            resources: {\n                es: \"{topic} recursos {subject} material estudio herramientas\",\n                en: \"{topic} resources {subject} study materials tools\"\n            },\n            research: {\n                es: \"{topic} investigación {subject} papers académicos estudios\",\n                en: \"{topic} research {subject} academic papers studies\"\n            }\n        };\n    }\n    static{\n        // Palabras clave para mejorar búsquedas académicas\n        this.ACADEMIC_ENHANCERS = {\n            es: [\n                \"tutorial\",\n                \"explicación\",\n                \"concepto\",\n                \"aprender\",\n                \"estudiar\",\n                \"académico\",\n                \"educativo\"\n            ],\n            en: [\n                \"tutorial\",\n                \"explanation\",\n                \"concept\",\n                \"learn\",\n                \"study\",\n                \"academic\",\n                \"educational\"\n            ]\n        };\n    }\n    static{\n        // Filtros de calidad para contenido académico\n        this.QUALITY_INDICATORS = {\n            high: [\n                \"edu\",\n                \"academic\",\n                \"university\",\n                \"research\",\n                \"scholar\",\n                \"journal\"\n            ],\n            medium: [\n                \"tutorial\",\n                \"guide\",\n                \"course\",\n                \"lesson\",\n                \"explanation\"\n            ],\n            low: [\n                \"blog\",\n                \"forum\",\n                \"wiki\",\n                \"opinion\",\n                \"personal\"\n            ]\n        };\n    }\n    /**\n   * Realiza búsqueda académica inteligente\n   */ static async searchAcademicContent(query) {\n        const startTime = Date.now();\n        try {\n            // Optimizar query para búsqueda académica\n            const optimizedQuery = this.optimizeAcademicQuery(query);\n            // Realizar búsqueda web\n            const webSearchResults = await this.performWebSearch(optimizedQuery);\n            // Procesar y analizar resultados\n            const academicResults = await this.processSearchResults(webSearchResults, query);\n            // Generar recomendaciones personalizadas\n            const recommendations = await this.generatePersonalizedRecommendations(query, academicResults);\n            const searchTime = Date.now() - startTime;\n            return {\n                query,\n                results: academicResults,\n                searchSuccess: academicResults.length > 0,\n                totalResults: academicResults.length,\n                searchTime,\n                personalizedRecommendations: recommendations.suggestions,\n                followUpQuestions: recommendations.followUpQuestions,\n                suggestedActions: recommendations.actions\n            };\n        } catch (error) {\n            console.error('Error in academic search:', error);\n            return {\n                query,\n                results: [],\n                searchSuccess: false,\n                totalResults: 0,\n                searchTime: Date.now() - startTime,\n                personalizedRecommendations: this.generateFallbackRecommendations(query),\n                followUpQuestions: [],\n                suggestedActions: [\n                    \"Intentar con términos más específicos\",\n                    \"Verificar la conexión a internet\"\n                ]\n            };\n        }\n    }\n    /**\n   * Optimiza el query para búsqueda académica\n   */ static optimizeAcademicQuery(query) {\n        const { topic, subject, searchType, level, language = 'es' } = query;\n        // Obtener plantilla base\n        const template = this.SEARCH_TEMPLATES[searchType][language];\n        // Reemplazar variables\n        let optimizedQuery = template.replace('{topic}', topic).replace('{subject}', subject || '');\n        // Agregar indicadores de nivel\n        if (level) {\n            const levelTerms = {\n                es: {\n                    basic: 'básico principiante',\n                    intermediate: 'intermedio',\n                    advanced: 'avanzado experto'\n                },\n                en: {\n                    basic: 'basic beginner',\n                    intermediate: 'intermediate',\n                    advanced: 'advanced expert'\n                }\n            };\n            optimizedQuery += ` ${levelTerms[language][level]}`;\n        }\n        // Agregar términos académicos\n        const enhancers = this.ACADEMIC_ENHANCERS[language];\n        const selectedEnhancers = enhancers.slice(0, 2).join(' ');\n        optimizedQuery += ` ${selectedEnhancers}`;\n        return optimizedQuery.trim();\n    }\n    /**\n   * Realiza búsqueda web usando el sistema de integración web\n   */ static async performWebSearch(query) {\n        try {\n            // Usar la integración web real\n            const webResults = await _web_search_integration__WEBPACK_IMPORTED_MODULE_0__.WebSearchIntegration.performWebSearch(query);\n            return webResults;\n        } catch (error) {\n            console.error('Web search failed:', error);\n            // Fallback a resultados simulados\n            return this.generateSimulatedResults(query);\n        }\n    }\n    /**\n   * Genera resultados simulados para desarrollo\n   */ static generateSimulatedResults(query) {\n        const simulatedResults = [\n            {\n                title: `Guía completa: ${query}`,\n                content: `Explicación detallada sobre ${query} con ejemplos prácticos y ejercicios paso a paso.`,\n                url: \"https://ejemplo-academico.edu\",\n                source: \"Universidad Académica\"\n            },\n            {\n                title: `Tutorial interactivo: ${query}`,\n                content: `Aprende ${query} de manera visual e interactiva con herramientas modernas.`,\n                url: \"https://tutorial-educativo.com\",\n                source: \"Portal Educativo\"\n            },\n            {\n                title: `Ejercicios resueltos: ${query}`,\n                content: `Colección de problemas y ejercicios resueltos sobre ${query} con explicaciones.`,\n                url: \"https://ejercicios-academicos.org\",\n                source: \"Recursos Académicos\"\n            }\n        ];\n        return simulatedResults;\n    }\n    /**\n   * Procesa y analiza resultados de búsqueda\n   */ static async processSearchResults(rawResults, query) {\n        const processedResults = [];\n        for (const result of rawResults.slice(0, 5)){\n            try {\n                const academicResult = {\n                    title: result.title || 'Recurso Académico',\n                    content: result.content || result.snippet || '',\n                    source: result.source || this.extractDomain(result.url),\n                    relevanceScore: this.calculateRelevanceScore(result, query),\n                    difficulty: this.inferDifficulty(result.content || result.snippet || '', query.level),\n                    contentType: this.classifyContentType(result),\n                    summary: this.generateSummary(result.content || result.snippet || ''),\n                    keyPoints: this.extractKeyPoints(result.content || result.snippet || ''),\n                    relatedTopics: this.identifyRelatedTopics(result.content || result.snippet || '', query.topic),\n                    estimatedReadTime: this.estimateReadTime(result.content || result.snippet || '')\n                };\n                processedResults.push(academicResult);\n            } catch (error) {\n                console.error('Error processing result:', error);\n            }\n        }\n        // Ordenar por relevancia\n        processedResults.sort((a, b)=>b.relevanceScore - a.relevanceScore);\n        return processedResults;\n    }\n    /**\n   * Calcula puntuación de relevancia\n   */ static calculateRelevanceScore(result, query) {\n        let score = 0.5 // Base score\n        ;\n        const content = (result.content || result.snippet || '').toLowerCase();\n        const title = (result.title || '').toLowerCase();\n        const topic = query.topic.toLowerCase();\n        // Coincidencia en título (mayor peso)\n        if (title.includes(topic)) score += 0.3;\n        // Coincidencia en contenido\n        if (content.includes(topic)) score += 0.2;\n        // Calidad de la fuente\n        const domain = this.extractDomain(result.url || '');\n        if (this.QUALITY_INDICATORS.high.some((indicator)=>domain.includes(indicator))) {\n            score += 0.3;\n        } else if (this.QUALITY_INDICATORS.medium.some((indicator)=>content.includes(indicator))) {\n            score += 0.1;\n        }\n        // Longitud del contenido (más contenido = potencialmente más útil)\n        if (content.length > 200) score += 0.1;\n        return Math.min(1.0, score);\n    }\n    /**\n   * Infiere dificultad del contenido\n   */ static inferDifficulty(content, queryLevel) {\n        if (queryLevel) return queryLevel // Usar nivel especificado si está disponible\n        ;\n        const lowerContent = content.toLowerCase();\n        // Indicadores de nivel básico\n        const basicIndicators = [\n            'básico',\n            'principiante',\n            'introducción',\n            'simple',\n            'fácil'\n        ];\n        const basicCount = basicIndicators.filter((indicator)=>lowerContent.includes(indicator)).length;\n        // Indicadores de nivel avanzado\n        const advancedIndicators = [\n            'avanzado',\n            'complejo',\n            'profundo',\n            'investigación',\n            'análisis'\n        ];\n        const advancedCount = advancedIndicators.filter((indicator)=>lowerContent.includes(indicator)).length;\n        if (advancedCount > basicCount) return 'advanced';\n        if (basicCount > 0) return 'basic';\n        return 'intermediate';\n    }\n    /**\n   * Clasifica tipo de contenido\n   */ static classifyContentType(result) {\n        const content = (result.content || result.snippet || '').toLowerCase();\n        const title = (result.title || '').toLowerCase();\n        const url = (result.url || '').toLowerCase();\n        if (content.includes('video') || content.includes('youtube') || url.includes('youtube')) {\n            return 'video';\n        }\n        if (content.includes('ejercicio') || content.includes('problema') || title.includes('ejercicio')) {\n            return 'exercise';\n        }\n        if (content.includes('paper') || content.includes('investigación') || url.includes('scholar')) {\n            return 'academic_paper';\n        }\n        if (content.includes('tutorial') || content.includes('guía') || title.includes('tutorial')) {\n            return 'tutorial';\n        }\n        return 'article';\n    }\n    /**\n   * Genera resumen del contenido\n   */ static generateSummary(content) {\n        const sentences = content.split(/[.!?]+/).filter((s)=>s.trim().length > 20);\n        const firstTwoSentences = sentences.slice(0, 2).join('. ');\n        if (firstTwoSentences.length > 150) {\n            return firstTwoSentences.substring(0, 147) + '...';\n        }\n        return firstTwoSentences || 'Recurso académico sobre el tema solicitado.';\n    }\n    /**\n   * Extrae puntos clave del contenido\n   */ static extractKeyPoints(content) {\n        const keyPoints = [];\n        // Buscar listas numeradas o con viñetas\n        const listMatches = content.match(/(?:^\\s*[\\d\\-\\*\\•]\\s*.+$)/gm);\n        if (listMatches) {\n            keyPoints.push(...listMatches.slice(0, 3).map((item)=>item.replace(/^\\s*[\\d\\-\\*\\•]\\s*/, '').trim()));\n        }\n        // Si no hay listas, extraer oraciones importantes\n        if (keyPoints.length === 0) {\n            const sentences = content.split(/[.!?]+/);\n            const importantSentences = sentences.filter((s)=>s.length > 30 && s.length < 100).slice(0, 3);\n            keyPoints.push(...importantSentences.map((s)=>s.trim()));\n        }\n        return keyPoints.filter((point)=>point.length > 10);\n    }\n    /**\n   * Identifica temas relacionados\n   */ static identifyRelatedTopics(content, mainTopic) {\n        const relatedTopics = [];\n        // Diccionario de temas relacionados por materia\n        const topicRelations = {\n            'matemáticas': [\n                'álgebra',\n                'geometría',\n                'cálculo',\n                'estadística',\n                'trigonometría'\n            ],\n            'física': [\n                'mecánica',\n                'termodinámica',\n                'electromagnetismo',\n                'óptica',\n                'cuántica'\n            ],\n            'química': [\n                'orgánica',\n                'inorgánica',\n                'analítica',\n                'física química',\n                'bioquímica'\n            ],\n            'programación': [\n                'algoritmos',\n                'estructuras de datos',\n                'bases de datos',\n                'desarrollo web',\n                'inteligencia artificial'\n            ]\n        };\n        const lowerContent = content.toLowerCase();\n        const lowerTopic = mainTopic.toLowerCase();\n        // Buscar relaciones directas\n        for (const [subject, relations] of Object.entries(topicRelations)){\n            if (lowerTopic.includes(subject) || lowerContent.includes(subject)) {\n                const foundRelations = relations.filter((relation)=>lowerContent.includes(relation) && !lowerTopic.includes(relation));\n                relatedTopics.push(...foundRelations);\n            }\n        }\n        return Array.from(new Set(relatedTopics)).slice(0, 3);\n    }\n    /**\n   * Estima tiempo de lectura\n   */ static estimateReadTime(content) {\n        const wordsPerMinute = 200 // Promedio de lectura en español\n        ;\n        const wordCount = content.split(/\\s+/).length;\n        return Math.max(1, Math.ceil(wordCount / wordsPerMinute));\n    }\n    /**\n   * Extrae dominio de URL\n   */ static extractDomain(url) {\n        try {\n            const urlObj = new URL(url);\n            return urlObj.hostname;\n        } catch  {\n            return 'fuente desconocida';\n        }\n    }\n    /**\n   * Genera recomendaciones personalizadas\n   */ static async generatePersonalizedRecommendations(query, results) {\n        const suggestions = [];\n        const followUpQuestions = [];\n        const actions = [];\n        // Analizar resultados para generar sugerencias\n        if (results.length > 0) {\n            const hasBasicContent = results.some((r)=>r.difficulty === 'basic');\n            const hasAdvancedContent = results.some((r)=>r.difficulty === 'advanced');\n            if (hasBasicContent && query.level !== 'basic') {\n                suggestions.push(`Encontré contenido básico sobre ${query.topic} que puede ayudarte a reforzar fundamentos`);\n            }\n            if (hasAdvancedContent && query.level !== 'advanced') {\n                suggestions.push(`Hay material avanzado disponible cuando te sientas listo para profundizar`);\n            }\n            // Generar preguntas de seguimiento\n            followUpQuestions.push(`¿Te gustaría que busque ejercicios prácticos sobre ${query.topic}?`);\n            followUpQuestions.push(`¿Necesitas que encuentre videos explicativos sobre este tema?`);\n            // Generar acciones sugeridas\n            actions.push(\"Revisar los recursos encontrados por orden de relevancia\");\n            actions.push(\"Tomar notas de los puntos clave identificados\");\n            if (results.some((r)=>r.contentType === 'exercise')) {\n                actions.push(\"Practicar con los ejercicios encontrados\");\n            }\n        }\n        // Agregar recomendaciones basadas en memoria si está disponible\n        if (query.userId) {\n            const memoryBasedSuggestions = await this.getMemoryBasedRecommendations(query);\n            suggestions.push(...memoryBasedSuggestions);\n        }\n        return {\n            suggestions,\n            followUpQuestions,\n            actions\n        };\n    }\n    /**\n   * Obtiene recomendaciones basadas en memoria del usuario\n   */ static async getMemoryBasedRecommendations(query) {\n        if (!query.userId) return [];\n        try {\n            const memory = _conversation_memory__WEBPACK_IMPORTED_MODULE_1__.ConversationMemoryManager.getMemory(query.userId, query.sessionId);\n            const suggestions = [];\n            // Basado en materias difíciles\n            if (memory.preferences.difficultSubjects.includes(query.subject || '')) {\n                suggestions.push(`He notado que ${query.subject} te presenta desafíos. Te busqué recursos especialmente claros`);\n            }\n            // Basado en emociones recientes\n            if (memory.emotionalProfile.recentEmotions.includes(_emotion_analyzer__WEBPACK_IMPORTED_MODULE_2__.EmotionType.CONFUSED)) {\n                suggestions.push(\"Seleccioné explicaciones paso a paso considerando tu confusión reciente\");\n            }\n            if (memory.emotionalProfile.recentEmotions.includes(_emotion_analyzer__WEBPACK_IMPORTED_MODULE_2__.EmotionType.MOTIVATED)) {\n                suggestions.push(\"Vi que estás muy motivado, así que incluí material desafiante para aprovechar tu energía\");\n            }\n            return suggestions;\n        } catch (error) {\n            console.error('Error getting memory-based recommendations:', error);\n            return [];\n        }\n    }\n    /**\n   * Genera recomendaciones de respaldo cuando la búsqueda falla\n   */ static generateFallbackRecommendations(query) {\n        return [\n            `Intenta buscar \"${query.topic}\" en recursos académicos locales`,\n            `Consulta tu libro de texto sobre ${query.subject || 'la materia'}`,\n            `Pregunta a tu profesor sobre ${query.topic} en la próxima clase`,\n            \"Revisa tus apuntes previos sobre temas relacionados\"\n        ];\n    }\n    /**\n   * Realiza búsqueda inteligente basada en contexto conversacional\n   */ static async smartSearch(message, userId, sessionId) {\n        // Extraer información de búsqueda del mensaje\n        const searchQuery = this.extractSearchQuery(message);\n        if (!searchQuery) return null;\n        // Enriquecer query con información del usuario\n        if (userId) {\n            const memory = _conversation_memory__WEBPACK_IMPORTED_MODULE_1__.ConversationMemoryManager.getMemory(userId, sessionId);\n            // Inferir materia basándose en el contexto\n            if (!searchQuery.subject && memory.preferences.difficultSubjects.length > 0) {\n                searchQuery.subject = memory.preferences.difficultSubjects[0];\n            }\n            // Ajustar nivel basándose en el progreso\n            if (!searchQuery.level) {\n                searchQuery.level = memory.emotionalProfile.motivationLevel > 7 ? 'intermediate' : 'basic';\n            }\n            searchQuery.userId = userId;\n            searchQuery.sessionId = sessionId;\n        }\n        return await this.searchAcademicContent(searchQuery);\n    }\n    /**\n   * Extrae query de búsqueda del mensaje del usuario\n   */ static extractSearchQuery(message) {\n        const lowerMessage = message.toLowerCase();\n        // Patrones para detectar solicitudes de búsqueda\n        const searchPatterns = [\n            /busca(?:me)?\\s+(?:información|sobre|acerca\\s+de)\\s+(.+)/i,\n            /(?:qué\\s+es|explica(?:me)?)\\s+(.+)/i,\n            /(?:cómo|como)\\s+(?:se\\s+)?(.+)/i,\n            /necesito\\s+(?:información|ayuda|saber)\\s+(?:sobre|de|con)\\s+(.+)/i,\n            /(?:ejemplos|ejercicios)\\s+(?:de|sobre)\\s+(.+)/i\n        ];\n        for (const pattern of searchPatterns){\n            const match = message.match(pattern);\n            if (match) {\n                const topic = match[1].trim();\n                return {\n                    topic,\n                    searchType: this.inferSearchType(lowerMessage),\n                    language: 'es'\n                };\n            }\n        }\n        return null;\n    }\n    /**\n   * Infiere tipo de búsqueda basándose en el mensaje\n   */ static inferSearchType(message) {\n        if (/ejercicio|problema|práctica/.test(message)) return 'exercises';\n        if (/ejemplo|caso|muestra/.test(message)) return 'examples';\n        if (/recurso|material|herramienta/.test(message)) return 'resources';\n        if (/investigación|paper|estudio/.test(message)) return 'research';\n        return 'explanation';\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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T0FBTztJQUNUO0FBQ0YiLCJzb3VyY2VzIjpbIi9Vc2Vycy9yb2RyaWdvZGliZXJuYXJkbzMzZ21haWwuY29tL0RvY3VtZW50cy9BcHAgRGV2ZWxvcG1lbnQgUHJveWVjdHMvSW50ZWxsZWdvIFBsYXRmb3JtL3NyYy9saWIvYWNhZGVtaWMtc2VhcmNoLWVuZ2luZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBTaXN0ZW1hIGRlIELDunNxdWVkYSBBY2Fkw6ltaWNhIEludGVsaWdlbnRlIHBhcmEgU2FyYVxuLy8gSW50ZWdyYSBiw7pzcXVlZGEgd2ViIGNvbiBhbsOhbGlzaXMgY29udGV4dHVhbCB5IG5vdGlmaWNhY2lvbmVzIHByb2FjdGl2YXNcblxuaW1wb3J0IHsgV2ViU2VhcmNoSW50ZWdyYXRpb24gfSBmcm9tICcuL3dlYi1zZWFyY2gtaW50ZWdyYXRpb24nXG5pbXBvcnQgeyBDb252ZXJzYXRpb25NZW1vcnlNYW5hZ2VyIH0gZnJvbSAnLi9jb252ZXJzYXRpb24tbWVtb3J5J1xuaW1wb3J0IHsgRW1vdGlvblR5cGUgfSBmcm9tICcuL2Vtb3Rpb24tYW5hbHl6ZXInXG5cbmV4cG9ydCBpbnRlcmZhY2UgQWNhZGVtaWNTZWFyY2hRdWVyeSB7XG4gIHRvcGljOiBzdHJpbmdcbiAgc3ViamVjdD86IHN0cmluZ1xuICBsZXZlbD86ICdiYXNpYycgfCAnaW50ZXJtZWRpYXRlJyB8ICdhZHZhbmNlZCdcbiAgc2VhcmNoVHlwZTogJ2V4cGxhbmF0aW9uJyB8ICdleGFtcGxlcycgfCAnZXhlcmNpc2VzJyB8ICdyZXNvdXJjZXMnIHwgJ3Jlc2VhcmNoJ1xuICBsYW5ndWFnZT86ICdlcycgfCAnZW4nXG4gIHVzZXJJZD86IHN0cmluZ1xuICBzZXNzaW9uSWQ/OiBzdHJpbmdcbn1cblxuZXhwb3J0IGludGVyZmFjZSBBY2FkZW1pY1NlYXJjaFJlc3VsdCB7XG4gIHRpdGxlOiBzdHJpbmdcbiAgY29udGVudDogc3RyaW5nXG4gIHNvdXJjZTogc3RyaW5nXG4gIHJlbGV2YW5jZVNjb3JlOiBudW1iZXJcbiAgZGlmZmljdWx0eTogJ2Jhc2ljJyB8ICdpbnRlcm1lZGlhdGUnIHwgJ2FkdmFuY2VkJ1xuICBjb250ZW50VHlwZTogJ2FydGljbGUnIHwgJ3ZpZGVvJyB8ICd0dXRvcmlhbCcgfCAnYWNhZGVtaWNfcGFwZXInIHwgJ2V4ZXJjaXNlJ1xuICBzdW1tYXJ5OiBzdHJpbmdcbiAga2V5UG9pbnRzOiBzdHJpbmdbXVxuICByZWxhdGVkVG9waWNzOiBzdHJpbmdbXVxuICBlc3RpbWF0ZWRSZWFkVGltZTogbnVtYmVyXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgU2VhcmNoQW5hbHlzaXMge1xuICBxdWVyeTogQWNhZGVtaWNTZWFyY2hRdWVyeVxuICByZXN1bHRzOiBBY2FkZW1pY1NlYXJjaFJlc3VsdFtdXG4gIHNlYXJjaFN1Y2Nlc3M6IGJvb2xlYW5cbiAgdG90YWxSZXN1bHRzOiBudW1iZXJcbiAgc2VhcmNoVGltZTogbnVtYmVyXG4gIHBlcnNvbmFsaXplZFJlY29tbWVuZGF0aW9uczogc3RyaW5nW11cbiAgZm9sbG93VXBRdWVzdGlvbnM6IHN0cmluZ1tdXG4gIHN1Z2dlc3RlZEFjdGlvbnM6IHN0cmluZ1tdXG59XG5cbmV4cG9ydCBjbGFzcyBBY2FkZW1pY1NlYXJjaEVuZ2luZSB7XG4gIFxuICAvLyBQbGFudGlsbGFzIGRlIGLDunNxdWVkYSBvcHRpbWl6YWRhcyBwYXJhIGNvbnRlbmlkbyBhY2Fkw6ltaWNvXG4gIHByaXZhdGUgc3RhdGljIHJlYWRvbmx5IFNFQVJDSF9URU1QTEFURVMgPSB7XG4gICAgZXhwbGFuYXRpb246IHtcbiAgICAgIGVzOiBcInt0b3BpY30gZXhwbGljYWNpw7NuIHtzdWJqZWN0fSBjb25jZXB0byBiw6FzaWNvIHR1dG9yaWFsXCIsXG4gICAgICBlbjogXCJ7dG9waWN9IGV4cGxhbmF0aW9uIHtzdWJqZWN0fSBiYXNpYyBjb25jZXB0IHR1dG9yaWFsXCJcbiAgICB9LFxuICAgIGV4YW1wbGVzOiB7XG4gICAgICBlczogXCJ7dG9waWN9IGVqZW1wbG9zIHtzdWJqZWN0fSBjYXNvcyBwcsOhY3RpY29zIGVqZXJjaWNpb3NcIixcbiAgICAgIGVuOiBcInt0b3BpY30gZXhhbXBsZXMge3N1YmplY3R9IHByYWN0aWNhbCBjYXNlcyBleGVyY2lzZXNcIlxuICAgIH0sXG4gICAgZXhlcmNpc2VzOiB7XG4gICAgICBlczogXCJ7dG9waWN9IGVqZXJjaWNpb3Mge3N1YmplY3R9IHByb2JsZW1hcyByZXN1ZWx0b3MgcHLDoWN0aWNhXCIsXG4gICAgICBlbjogXCJ7dG9waWN9IGV4ZXJjaXNlcyB7c3ViamVjdH0gc29sdmVkIHByb2JsZW1zIHByYWN0aWNlXCJcbiAgICB9LFxuICAgIHJlc291cmNlczoge1xuICAgICAgZXM6IFwie3RvcGljfSByZWN1cnNvcyB7c3ViamVjdH0gbWF0ZXJpYWwgZXN0dWRpbyBoZXJyYW1pZW50YXNcIixcbiAgICAgIGVuOiBcInt0b3BpY30gcmVzb3VyY2VzIHtzdWJqZWN0fSBzdHVkeSBtYXRlcmlhbHMgdG9vbHNcIlxuICAgIH0sXG4gICAgcmVzZWFyY2g6IHtcbiAgICAgIGVzOiBcInt0b3BpY30gaW52ZXN0aWdhY2nDs24ge3N1YmplY3R9IHBhcGVycyBhY2Fkw6ltaWNvcyBlc3R1ZGlvc1wiLFxuICAgICAgZW46IFwie3RvcGljfSByZXNlYXJjaCB7c3ViamVjdH0gYWNhZGVtaWMgcGFwZXJzIHN0dWRpZXNcIlxuICAgIH1cbiAgfVxuXG4gIC8vIFBhbGFicmFzIGNsYXZlIHBhcmEgbWVqb3JhciBiw7pzcXVlZGFzIGFjYWTDqW1pY2FzXG4gIHByaXZhdGUgc3RhdGljIHJlYWRvbmx5IEFDQURFTUlDX0VOSEFOQ0VSUyA9IHtcbiAgICBlczogW1widHV0b3JpYWxcIiwgXCJleHBsaWNhY2nDs25cIiwgXCJjb25jZXB0b1wiLCBcImFwcmVuZGVyXCIsIFwiZXN0dWRpYXJcIiwgXCJhY2Fkw6ltaWNvXCIsIFwiZWR1Y2F0aXZvXCJdLFxuICAgIGVuOiBbXCJ0dXRvcmlhbFwiLCBcImV4cGxhbmF0aW9uXCIsIFwiY29uY2VwdFwiLCBcImxlYXJuXCIsIFwic3R1ZHlcIiwgXCJhY2FkZW1pY1wiLCBcImVkdWNhdGlvbmFsXCJdXG4gIH1cblxuICAvLyBGaWx0cm9zIGRlIGNhbGlkYWQgcGFyYSBjb250ZW5pZG8gYWNhZMOpbWljb1xuICBwcml2YXRlIHN0YXRpYyByZWFkb25seSBRVUFMSVRZX0lORElDQVRPUlMgPSB7XG4gICAgaGlnaDogW1wiZWR1XCIsIFwiYWNhZGVtaWNcIiwgXCJ1bml2ZXJzaXR5XCIsIFwicmVzZWFyY2hcIiwgXCJzY2hvbGFyXCIsIFwiam91cm5hbFwiXSxcbiAgICBtZWRpdW06IFtcInR1dG9yaWFsXCIsIFwiZ3VpZGVcIiwgXCJjb3Vyc2VcIiwgXCJsZXNzb25cIiwgXCJleHBsYW5hdGlvblwiXSxcbiAgICBsb3c6IFtcImJsb2dcIiwgXCJmb3J1bVwiLCBcIndpa2lcIiwgXCJvcGluaW9uXCIsIFwicGVyc29uYWxcIl1cbiAgfVxuXG4gIC8qKlxuICAgKiBSZWFsaXphIGLDunNxdWVkYSBhY2Fkw6ltaWNhIGludGVsaWdlbnRlXG4gICAqL1xuICBzdGF0aWMgYXN5bmMgc2VhcmNoQWNhZGVtaWNDb250ZW50KHF1ZXJ5OiBBY2FkZW1pY1NlYXJjaFF1ZXJ5KTogUHJvbWlzZTxTZWFyY2hBbmFseXNpcz4ge1xuICAgIGNvbnN0IHN0YXJ0VGltZSA9IERhdGUubm93KClcbiAgICBcbiAgICB0cnkge1xuICAgICAgLy8gT3B0aW1pemFyIHF1ZXJ5IHBhcmEgYsO6c3F1ZWRhIGFjYWTDqW1pY2FcbiAgICAgIGNvbnN0IG9wdGltaXplZFF1ZXJ5ID0gdGhpcy5vcHRpbWl6ZUFjYWRlbWljUXVlcnkocXVlcnkpXG4gICAgICBcbiAgICAgIC8vIFJlYWxpemFyIGLDunNxdWVkYSB3ZWJcbiAgICAgIGNvbnN0IHdlYlNlYXJjaFJlc3VsdHMgPSBhd2FpdCB0aGlzLnBlcmZvcm1XZWJTZWFyY2gob3B0aW1pemVkUXVlcnkpXG4gICAgICBcbiAgICAgIC8vIFByb2Nlc2FyIHkgYW5hbGl6YXIgcmVzdWx0YWRvc1xuICAgICAgY29uc3QgYWNhZGVtaWNSZXN1bHRzID0gYXdhaXQgdGhpcy5wcm9jZXNzU2VhcmNoUmVzdWx0cyh3ZWJTZWFyY2hSZXN1bHRzLCBxdWVyeSlcbiAgICAgIFxuICAgICAgLy8gR2VuZXJhciByZWNvbWVuZGFjaW9uZXMgcGVyc29uYWxpemFkYXNcbiAgICAgIGNvbnN0IHJlY29tbWVuZGF0aW9ucyA9IGF3YWl0IHRoaXMuZ2VuZXJhdGVQZXJzb25hbGl6ZWRSZWNvbW1lbmRhdGlvbnMocXVlcnksIGFjYWRlbWljUmVzdWx0cylcbiAgICAgIFxuICAgICAgY29uc3Qgc2VhcmNoVGltZSA9IERhdGUubm93KCkgLSBzdGFydFRpbWVcbiAgICAgIFxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgcXVlcnksXG4gICAgICAgIHJlc3VsdHM6IGFjYWRlbWljUmVzdWx0cyxcbiAgICAgICAgc2VhcmNoU3VjY2VzczogYWNhZGVtaWNSZXN1bHRzLmxlbmd0aCA+IDAsXG4gICAgICAgIHRvdGFsUmVzdWx0czogYWNhZGVtaWNSZXN1bHRzLmxlbmd0aCxcbiAgICAgICAgc2VhcmNoVGltZSxcbiAgICAgICAgcGVyc29uYWxpemVkUmVjb21tZW5kYXRpb25zOiByZWNvbW1lbmRhdGlvbnMuc3VnZ2VzdGlvbnMsXG4gICAgICAgIGZvbGxvd1VwUXVlc3Rpb25zOiByZWNvbW1lbmRhdGlvbnMuZm9sbG93VXBRdWVzdGlvbnMsXG4gICAgICAgIHN1Z2dlc3RlZEFjdGlvbnM6IHJlY29tbWVuZGF0aW9ucy5hY3Rpb25zXG4gICAgICB9XG4gICAgICBcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgaW4gYWNhZGVtaWMgc2VhcmNoOicsIGVycm9yKVxuICAgICAgXG4gICAgICByZXR1cm4ge1xuICAgICAgICBxdWVyeSxcbiAgICAgICAgcmVzdWx0czogW10sXG4gICAgICAgIHNlYXJjaFN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICB0b3RhbFJlc3VsdHM6IDAsXG4gICAgICAgIHNlYXJjaFRpbWU6IERhdGUubm93KCkgLSBzdGFydFRpbWUsXG4gICAgICAgIHBlcnNvbmFsaXplZFJlY29tbWVuZGF0aW9uczogdGhpcy5nZW5lcmF0ZUZhbGxiYWNrUmVjb21tZW5kYXRpb25zKHF1ZXJ5KSxcbiAgICAgICAgZm9sbG93VXBRdWVzdGlvbnM6IFtdLFxuICAgICAgICBzdWdnZXN0ZWRBY3Rpb25zOiBbXCJJbnRlbnRhciBjb24gdMOpcm1pbm9zIG3DoXMgZXNwZWPDrWZpY29zXCIsIFwiVmVyaWZpY2FyIGxhIGNvbmV4acOzbiBhIGludGVybmV0XCJdXG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIE9wdGltaXphIGVsIHF1ZXJ5IHBhcmEgYsO6c3F1ZWRhIGFjYWTDqW1pY2FcbiAgICovXG4gIHByaXZhdGUgc3RhdGljIG9wdGltaXplQWNhZGVtaWNRdWVyeShxdWVyeTogQWNhZGVtaWNTZWFyY2hRdWVyeSk6IHN0cmluZyB7XG4gICAgY29uc3QgeyB0b3BpYywgc3ViamVjdCwgc2VhcmNoVHlwZSwgbGV2ZWwsIGxhbmd1YWdlID0gJ2VzJyB9ID0gcXVlcnlcbiAgICBcbiAgICAvLyBPYnRlbmVyIHBsYW50aWxsYSBiYXNlXG4gICAgY29uc3QgdGVtcGxhdGUgPSB0aGlzLlNFQVJDSF9URU1QTEFURVNbc2VhcmNoVHlwZV1bbGFuZ3VhZ2VdXG4gICAgXG4gICAgLy8gUmVlbXBsYXphciB2YXJpYWJsZXNcbiAgICBsZXQgb3B0aW1pemVkUXVlcnkgPSB0ZW1wbGF0ZVxuICAgICAgLnJlcGxhY2UoJ3t0b3BpY30nLCB0b3BpYylcbiAgICAgIC5yZXBsYWNlKCd7c3ViamVjdH0nLCBzdWJqZWN0IHx8ICcnKVxuICAgIFxuICAgIC8vIEFncmVnYXIgaW5kaWNhZG9yZXMgZGUgbml2ZWxcbiAgICBpZiAobGV2ZWwpIHtcbiAgICAgIGNvbnN0IGxldmVsVGVybXMgPSB7XG4gICAgICAgIGVzOiB7IGJhc2ljOiAnYsOhc2ljbyBwcmluY2lwaWFudGUnLCBpbnRlcm1lZGlhdGU6ICdpbnRlcm1lZGlvJywgYWR2YW5jZWQ6ICdhdmFuemFkbyBleHBlcnRvJyB9LFxuICAgICAgICBlbjogeyBiYXNpYzogJ2Jhc2ljIGJlZ2lubmVyJywgaW50ZXJtZWRpYXRlOiAnaW50ZXJtZWRpYXRlJywgYWR2YW5jZWQ6ICdhZHZhbmNlZCBleHBlcnQnIH1cbiAgICAgIH1cbiAgICAgIG9wdGltaXplZFF1ZXJ5ICs9IGAgJHtsZXZlbFRlcm1zW2xhbmd1YWdlXVtsZXZlbF19YFxuICAgIH1cbiAgICBcbiAgICAvLyBBZ3JlZ2FyIHTDqXJtaW5vcyBhY2Fkw6ltaWNvc1xuICAgIGNvbnN0IGVuaGFuY2VycyA9IHRoaXMuQUNBREVNSUNfRU5IQU5DRVJTW2xhbmd1YWdlXVxuICAgIGNvbnN0IHNlbGVjdGVkRW5oYW5jZXJzID0gZW5oYW5jZXJzLnNsaWNlKDAsIDIpLmpvaW4oJyAnKVxuICAgIG9wdGltaXplZFF1ZXJ5ICs9IGAgJHtzZWxlY3RlZEVuaGFuY2Vyc31gXG4gICAgXG4gICAgcmV0dXJuIG9wdGltaXplZFF1ZXJ5LnRyaW0oKVxuICB9XG5cbiAgLyoqXG4gICAqIFJlYWxpemEgYsO6c3F1ZWRhIHdlYiB1c2FuZG8gZWwgc2lzdGVtYSBkZSBpbnRlZ3JhY2nDs24gd2ViXG4gICAqL1xuICBwcml2YXRlIHN0YXRpYyBhc3luYyBwZXJmb3JtV2ViU2VhcmNoKHF1ZXJ5OiBzdHJpbmcpOiBQcm9taXNlPGFueVtdPiB7XG4gICAgdHJ5IHtcbiAgICAgIC8vIFVzYXIgbGEgaW50ZWdyYWNpw7NuIHdlYiByZWFsXG4gICAgICBjb25zdCB3ZWJSZXN1bHRzID0gYXdhaXQgV2ViU2VhcmNoSW50ZWdyYXRpb24ucGVyZm9ybVdlYlNlYXJjaChxdWVyeSlcbiAgICAgIHJldHVybiB3ZWJSZXN1bHRzXG4gICAgICBcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignV2ViIHNlYXJjaCBmYWlsZWQ6JywgZXJyb3IpXG4gICAgICAvLyBGYWxsYmFjayBhIHJlc3VsdGFkb3Mgc2ltdWxhZG9zXG4gICAgICByZXR1cm4gdGhpcy5nZW5lcmF0ZVNpbXVsYXRlZFJlc3VsdHMocXVlcnkpXG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEdlbmVyYSByZXN1bHRhZG9zIHNpbXVsYWRvcyBwYXJhIGRlc2Fycm9sbG9cbiAgICovXG4gIHByaXZhdGUgc3RhdGljIGdlbmVyYXRlU2ltdWxhdGVkUmVzdWx0cyhxdWVyeTogc3RyaW5nKTogYW55W10ge1xuICAgIGNvbnN0IHNpbXVsYXRlZFJlc3VsdHMgPSBbXG4gICAgICB7XG4gICAgICAgIHRpdGxlOiBgR3XDrWEgY29tcGxldGE6ICR7cXVlcnl9YCxcbiAgICAgICAgY29udGVudDogYEV4cGxpY2FjacOzbiBkZXRhbGxhZGEgc29icmUgJHtxdWVyeX0gY29uIGVqZW1wbG9zIHByw6FjdGljb3MgeSBlamVyY2ljaW9zIHBhc28gYSBwYXNvLmAsXG4gICAgICAgIHVybDogXCJodHRwczovL2VqZW1wbG8tYWNhZGVtaWNvLmVkdVwiLFxuICAgICAgICBzb3VyY2U6IFwiVW5pdmVyc2lkYWQgQWNhZMOpbWljYVwiXG4gICAgICB9LFxuICAgICAge1xuICAgICAgICB0aXRsZTogYFR1dG9yaWFsIGludGVyYWN0aXZvOiAke3F1ZXJ5fWAsXG4gICAgICAgIGNvbnRlbnQ6IGBBcHJlbmRlICR7cXVlcnl9IGRlIG1hbmVyYSB2aXN1YWwgZSBpbnRlcmFjdGl2YSBjb24gaGVycmFtaWVudGFzIG1vZGVybmFzLmAsXG4gICAgICAgIHVybDogXCJodHRwczovL3R1dG9yaWFsLWVkdWNhdGl2by5jb21cIixcbiAgICAgICAgc291cmNlOiBcIlBvcnRhbCBFZHVjYXRpdm9cIlxuICAgICAgfSxcbiAgICAgIHtcbiAgICAgICAgdGl0bGU6IGBFamVyY2ljaW9zIHJlc3VlbHRvczogJHtxdWVyeX1gLFxuICAgICAgICBjb250ZW50OiBgQ29sZWNjacOzbiBkZSBwcm9ibGVtYXMgeSBlamVyY2ljaW9zIHJlc3VlbHRvcyBzb2JyZSAke3F1ZXJ5fSBjb24gZXhwbGljYWNpb25lcy5gLFxuICAgICAgICB1cmw6IFwiaHR0cHM6Ly9lamVyY2ljaW9zLWFjYWRlbWljb3Mub3JnXCIsXG4gICAgICAgIHNvdXJjZTogXCJSZWN1cnNvcyBBY2Fkw6ltaWNvc1wiXG4gICAgICB9XG4gICAgXVxuICAgIFxuICAgIHJldHVybiBzaW11bGF0ZWRSZXN1bHRzXG4gIH1cblxuICAvKipcbiAgICogUHJvY2VzYSB5IGFuYWxpemEgcmVzdWx0YWRvcyBkZSBiw7pzcXVlZGFcbiAgICovXG4gIHByaXZhdGUgc3RhdGljIGFzeW5jIHByb2Nlc3NTZWFyY2hSZXN1bHRzKHJhd1Jlc3VsdHM6IGFueVtdLCBxdWVyeTogQWNhZGVtaWNTZWFyY2hRdWVyeSk6IFByb21pc2U8QWNhZGVtaWNTZWFyY2hSZXN1bHRbXT4ge1xuICAgIGNvbnN0IHByb2Nlc3NlZFJlc3VsdHM6IEFjYWRlbWljU2VhcmNoUmVzdWx0W10gPSBbXVxuICAgIFxuICAgIGZvciAoY29uc3QgcmVzdWx0IG9mIHJhd1Jlc3VsdHMuc2xpY2UoMCwgNSkpIHsgLy8gTGltaXRhciBhIDUgcmVzdWx0YWRvc1xuICAgICAgdHJ5IHtcbiAgICAgICAgY29uc3QgYWNhZGVtaWNSZXN1bHQ6IEFjYWRlbWljU2VhcmNoUmVzdWx0ID0ge1xuICAgICAgICAgIHRpdGxlOiByZXN1bHQudGl0bGUgfHwgJ1JlY3Vyc28gQWNhZMOpbWljbycsXG4gICAgICAgICAgY29udGVudDogcmVzdWx0LmNvbnRlbnQgfHwgcmVzdWx0LnNuaXBwZXQgfHwgJycsXG4gICAgICAgICAgc291cmNlOiByZXN1bHQuc291cmNlIHx8IHRoaXMuZXh0cmFjdERvbWFpbihyZXN1bHQudXJsKSxcbiAgICAgICAgICByZWxldmFuY2VTY29yZTogdGhpcy5jYWxjdWxhdGVSZWxldmFuY2VTY29yZShyZXN1bHQsIHF1ZXJ5KSxcbiAgICAgICAgICBkaWZmaWN1bHR5OiB0aGlzLmluZmVyRGlmZmljdWx0eShyZXN1bHQuY29udGVudCB8fCByZXN1bHQuc25pcHBldCB8fCAnJywgcXVlcnkubGV2ZWwpLFxuICAgICAgICAgIGNvbnRlbnRUeXBlOiB0aGlzLmNsYXNzaWZ5Q29udGVudFR5cGUocmVzdWx0KSxcbiAgICAgICAgICBzdW1tYXJ5OiB0aGlzLmdlbmVyYXRlU3VtbWFyeShyZXN1bHQuY29udGVudCB8fCByZXN1bHQuc25pcHBldCB8fCAnJyksXG4gICAgICAgICAga2V5UG9pbnRzOiB0aGlzLmV4dHJhY3RLZXlQb2ludHMocmVzdWx0LmNvbnRlbnQgfHwgcmVzdWx0LnNuaXBwZXQgfHwgJycpLFxuICAgICAgICAgIHJlbGF0ZWRUb3BpY3M6IHRoaXMuaWRlbnRpZnlSZWxhdGVkVG9waWNzKHJlc3VsdC5jb250ZW50IHx8IHJlc3VsdC5zbmlwcGV0IHx8ICcnLCBxdWVyeS50b3BpYyksXG4gICAgICAgICAgZXN0aW1hdGVkUmVhZFRpbWU6IHRoaXMuZXN0aW1hdGVSZWFkVGltZShyZXN1bHQuY29udGVudCB8fCByZXN1bHQuc25pcHBldCB8fCAnJylcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgcHJvY2Vzc2VkUmVzdWx0cy5wdXNoKGFjYWRlbWljUmVzdWx0KVxuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgcHJvY2Vzc2luZyByZXN1bHQ6JywgZXJyb3IpXG4gICAgICB9XG4gICAgfVxuICAgIFxuICAgIC8vIE9yZGVuYXIgcG9yIHJlbGV2YW5jaWFcbiAgICBwcm9jZXNzZWRSZXN1bHRzLnNvcnQoKGEsIGIpID0+IGIucmVsZXZhbmNlU2NvcmUgLSBhLnJlbGV2YW5jZVNjb3JlKVxuICAgIFxuICAgIHJldHVybiBwcm9jZXNzZWRSZXN1bHRzXG4gIH1cblxuICAvKipcbiAgICogQ2FsY3VsYSBwdW50dWFjacOzbiBkZSByZWxldmFuY2lhXG4gICAqL1xuICBwcml2YXRlIHN0YXRpYyBjYWxjdWxhdGVSZWxldmFuY2VTY29yZShyZXN1bHQ6IGFueSwgcXVlcnk6IEFjYWRlbWljU2VhcmNoUXVlcnkpOiBudW1iZXIge1xuICAgIGxldCBzY29yZSA9IDAuNSAvLyBCYXNlIHNjb3JlXG4gICAgXG4gICAgY29uc3QgY29udGVudCA9IChyZXN1bHQuY29udGVudCB8fCByZXN1bHQuc25pcHBldCB8fCAnJykudG9Mb3dlckNhc2UoKVxuICAgIGNvbnN0IHRpdGxlID0gKHJlc3VsdC50aXRsZSB8fCAnJykudG9Mb3dlckNhc2UoKVxuICAgIGNvbnN0IHRvcGljID0gcXVlcnkudG9waWMudG9Mb3dlckNhc2UoKVxuICAgIFxuICAgIC8vIENvaW5jaWRlbmNpYSBlbiB0w610dWxvIChtYXlvciBwZXNvKVxuICAgIGlmICh0aXRsZS5pbmNsdWRlcyh0b3BpYykpIHNjb3JlICs9IDAuM1xuICAgIFxuICAgIC8vIENvaW5jaWRlbmNpYSBlbiBjb250ZW5pZG9cbiAgICBpZiAoY29udGVudC5pbmNsdWRlcyh0b3BpYykpIHNjb3JlICs9IDAuMlxuICAgIFxuICAgIC8vIENhbGlkYWQgZGUgbGEgZnVlbnRlXG4gICAgY29uc3QgZG9tYWluID0gdGhpcy5leHRyYWN0RG9tYWluKHJlc3VsdC51cmwgfHwgJycpXG4gICAgaWYgKHRoaXMuUVVBTElUWV9JTkRJQ0FUT1JTLmhpZ2guc29tZShpbmRpY2F0b3IgPT4gZG9tYWluLmluY2x1ZGVzKGluZGljYXRvcikpKSB7XG4gICAgICBzY29yZSArPSAwLjNcbiAgICB9IGVsc2UgaWYgKHRoaXMuUVVBTElUWV9JTkRJQ0FUT1JTLm1lZGl1bS5zb21lKGluZGljYXRvciA9PiBjb250ZW50LmluY2x1ZGVzKGluZGljYXRvcikpKSB7XG4gICAgICBzY29yZSArPSAwLjFcbiAgICB9XG4gICAgXG4gICAgLy8gTG9uZ2l0dWQgZGVsIGNvbnRlbmlkbyAobcOhcyBjb250ZW5pZG8gPSBwb3RlbmNpYWxtZW50ZSBtw6FzIMO6dGlsKVxuICAgIGlmIChjb250ZW50Lmxlbmd0aCA+IDIwMCkgc2NvcmUgKz0gMC4xXG4gICAgXG4gICAgcmV0dXJuIE1hdGgubWluKDEuMCwgc2NvcmUpXG4gIH1cblxuICAvKipcbiAgICogSW5maWVyZSBkaWZpY3VsdGFkIGRlbCBjb250ZW5pZG9cbiAgICovXG4gIHByaXZhdGUgc3RhdGljIGluZmVyRGlmZmljdWx0eShjb250ZW50OiBzdHJpbmcsIHF1ZXJ5TGV2ZWw/OiAnYmFzaWMnIHwgJ2ludGVybWVkaWF0ZScgfCAnYWR2YW5jZWQnKTogJ2Jhc2ljJyB8ICdpbnRlcm1lZGlhdGUnIHwgJ2FkdmFuY2VkJyB7XG4gICAgaWYgKHF1ZXJ5TGV2ZWwpIHJldHVybiBxdWVyeUxldmVsIC8vIFVzYXIgbml2ZWwgZXNwZWNpZmljYWRvIHNpIGVzdMOhIGRpc3BvbmlibGVcbiAgICBcbiAgICBjb25zdCBsb3dlckNvbnRlbnQgPSBjb250ZW50LnRvTG93ZXJDYXNlKClcbiAgICBcbiAgICAvLyBJbmRpY2Fkb3JlcyBkZSBuaXZlbCBiw6FzaWNvXG4gICAgY29uc3QgYmFzaWNJbmRpY2F0b3JzID0gWydiw6FzaWNvJywgJ3ByaW5jaXBpYW50ZScsICdpbnRyb2R1Y2Npw7NuJywgJ3NpbXBsZScsICdmw6FjaWwnXVxuICAgIGNvbnN0IGJhc2ljQ291bnQgPSBiYXNpY0luZGljYXRvcnMuZmlsdGVyKGluZGljYXRvciA9PiBsb3dlckNvbnRlbnQuaW5jbHVkZXMoaW5kaWNhdG9yKSkubGVuZ3RoXG4gICAgXG4gICAgLy8gSW5kaWNhZG9yZXMgZGUgbml2ZWwgYXZhbnphZG9cbiAgICBjb25zdCBhZHZhbmNlZEluZGljYXRvcnMgPSBbJ2F2YW56YWRvJywgJ2NvbXBsZWpvJywgJ3Byb2Z1bmRvJywgJ2ludmVzdGlnYWNpw7NuJywgJ2Fuw6FsaXNpcyddXG4gICAgY29uc3QgYWR2YW5jZWRDb3VudCA9IGFkdmFuY2VkSW5kaWNhdG9ycy5maWx0ZXIoaW5kaWNhdG9yID0+IGxvd2VyQ29udGVudC5pbmNsdWRlcyhpbmRpY2F0b3IpKS5sZW5ndGhcbiAgICBcbiAgICBpZiAoYWR2YW5jZWRDb3VudCA+IGJhc2ljQ291bnQpIHJldHVybiAnYWR2YW5jZWQnXG4gICAgaWYgKGJhc2ljQ291bnQgPiAwKSByZXR1cm4gJ2Jhc2ljJ1xuICAgIHJldHVybiAnaW50ZXJtZWRpYXRlJ1xuICB9XG5cbiAgLyoqXG4gICAqIENsYXNpZmljYSB0aXBvIGRlIGNvbnRlbmlkb1xuICAgKi9cbiAgcHJpdmF0ZSBzdGF0aWMgY2xhc3NpZnlDb250ZW50VHlwZShyZXN1bHQ6IGFueSk6IEFjYWRlbWljU2VhcmNoUmVzdWx0Wydjb250ZW50VHlwZSddIHtcbiAgICBjb25zdCBjb250ZW50ID0gKHJlc3VsdC5jb250ZW50IHx8IHJlc3VsdC5zbmlwcGV0IHx8ICcnKS50b0xvd2VyQ2FzZSgpXG4gICAgY29uc3QgdGl0bGUgPSAocmVzdWx0LnRpdGxlIHx8ICcnKS50b0xvd2VyQ2FzZSgpXG4gICAgY29uc3QgdXJsID0gKHJlc3VsdC51cmwgfHwgJycpLnRvTG93ZXJDYXNlKClcbiAgICBcbiAgICBpZiAoY29udGVudC5pbmNsdWRlcygndmlkZW8nKSB8fCBjb250ZW50LmluY2x1ZGVzKCd5b3V0dWJlJykgfHwgdXJsLmluY2x1ZGVzKCd5b3V0dWJlJykpIHtcbiAgICAgIHJldHVybiAndmlkZW8nXG4gICAgfVxuICAgIGlmIChjb250ZW50LmluY2x1ZGVzKCdlamVyY2ljaW8nKSB8fCBjb250ZW50LmluY2x1ZGVzKCdwcm9ibGVtYScpIHx8IHRpdGxlLmluY2x1ZGVzKCdlamVyY2ljaW8nKSkge1xuICAgICAgcmV0dXJuICdleGVyY2lzZSdcbiAgICB9XG4gICAgaWYgKGNvbnRlbnQuaW5jbHVkZXMoJ3BhcGVyJykgfHwgY29udGVudC5pbmNsdWRlcygnaW52ZXN0aWdhY2nDs24nKSB8fCB1cmwuaW5jbHVkZXMoJ3NjaG9sYXInKSkge1xuICAgICAgcmV0dXJuICdhY2FkZW1pY19wYXBlcidcbiAgICB9XG4gICAgaWYgKGNvbnRlbnQuaW5jbHVkZXMoJ3R1dG9yaWFsJykgfHwgY29udGVudC5pbmNsdWRlcygnZ3XDrWEnKSB8fCB0aXRsZS5pbmNsdWRlcygndHV0b3JpYWwnKSkge1xuICAgICAgcmV0dXJuICd0dXRvcmlhbCdcbiAgICB9XG4gICAgcmV0dXJuICdhcnRpY2xlJ1xuICB9XG5cbiAgLyoqXG4gICAqIEdlbmVyYSByZXN1bWVuIGRlbCBjb250ZW5pZG9cbiAgICovXG4gIHByaXZhdGUgc3RhdGljIGdlbmVyYXRlU3VtbWFyeShjb250ZW50OiBzdHJpbmcpOiBzdHJpbmcge1xuICAgIGNvbnN0IHNlbnRlbmNlcyA9IGNvbnRlbnQuc3BsaXQoL1suIT9dKy8pLmZpbHRlcihzID0+IHMudHJpbSgpLmxlbmd0aCA+IDIwKVxuICAgIGNvbnN0IGZpcnN0VHdvU2VudGVuY2VzID0gc2VudGVuY2VzLnNsaWNlKDAsIDIpLmpvaW4oJy4gJylcbiAgICBcbiAgICBpZiAoZmlyc3RUd29TZW50ZW5jZXMubGVuZ3RoID4gMTUwKSB7XG4gICAgICByZXR1cm4gZmlyc3RUd29TZW50ZW5jZXMuc3Vic3RyaW5nKDAsIDE0NykgKyAnLi4uJ1xuICAgIH1cbiAgICBcbiAgICByZXR1cm4gZmlyc3RUd29TZW50ZW5jZXMgfHwgJ1JlY3Vyc28gYWNhZMOpbWljbyBzb2JyZSBlbCB0ZW1hIHNvbGljaXRhZG8uJ1xuICB9XG5cbiAgLyoqXG4gICAqIEV4dHJhZSBwdW50b3MgY2xhdmUgZGVsIGNvbnRlbmlkb1xuICAgKi9cbiAgcHJpdmF0ZSBzdGF0aWMgZXh0cmFjdEtleVBvaW50cyhjb250ZW50OiBzdHJpbmcpOiBzdHJpbmdbXSB7XG4gICAgY29uc3Qga2V5UG9pbnRzOiBzdHJpbmdbXSA9IFtdXG4gICAgXG4gICAgLy8gQnVzY2FyIGxpc3RhcyBudW1lcmFkYXMgbyBjb24gdmnDsWV0YXNcbiAgICBjb25zdCBsaXN0TWF0Y2hlcyA9IGNvbnRlbnQubWF0Y2goLyg/Ol5cXHMqW1xcZFxcLVxcKlxc4oCiXVxccyouKyQpL2dtKVxuICAgIGlmIChsaXN0TWF0Y2hlcykge1xuICAgICAga2V5UG9pbnRzLnB1c2goLi4ubGlzdE1hdGNoZXMuc2xpY2UoMCwgMykubWFwKGl0ZW0gPT4gaXRlbS5yZXBsYWNlKC9eXFxzKltcXGRcXC1cXCpcXOKAol1cXHMqLywgJycpLnRyaW0oKSkpXG4gICAgfVxuICAgIFxuICAgIC8vIFNpIG5vIGhheSBsaXN0YXMsIGV4dHJhZXIgb3JhY2lvbmVzIGltcG9ydGFudGVzXG4gICAgaWYgKGtleVBvaW50cy5sZW5ndGggPT09IDApIHtcbiAgICAgIGNvbnN0IHNlbnRlbmNlcyA9IGNvbnRlbnQuc3BsaXQoL1suIT9dKy8pXG4gICAgICBjb25zdCBpbXBvcnRhbnRTZW50ZW5jZXMgPSBzZW50ZW5jZXNcbiAgICAgICAgLmZpbHRlcihzID0+IHMubGVuZ3RoID4gMzAgJiYgcy5sZW5ndGggPCAxMDApXG4gICAgICAgIC5zbGljZSgwLCAzKVxuICAgICAgXG4gICAgICBrZXlQb2ludHMucHVzaCguLi5pbXBvcnRhbnRTZW50ZW5jZXMubWFwKHMgPT4gcy50cmltKCkpKVxuICAgIH1cbiAgICBcbiAgICByZXR1cm4ga2V5UG9pbnRzLmZpbHRlcihwb2ludCA9PiBwb2ludC5sZW5ndGggPiAxMClcbiAgfVxuXG4gIC8qKlxuICAgKiBJZGVudGlmaWNhIHRlbWFzIHJlbGFjaW9uYWRvc1xuICAgKi9cbiAgcHJpdmF0ZSBzdGF0aWMgaWRlbnRpZnlSZWxhdGVkVG9waWNzKGNvbnRlbnQ6IHN0cmluZywgbWFpblRvcGljOiBzdHJpbmcpOiBzdHJpbmdbXSB7XG4gICAgY29uc3QgcmVsYXRlZFRvcGljczogc3RyaW5nW10gPSBbXVxuICAgIFxuICAgIC8vIERpY2Npb25hcmlvIGRlIHRlbWFzIHJlbGFjaW9uYWRvcyBwb3IgbWF0ZXJpYVxuICAgIGNvbnN0IHRvcGljUmVsYXRpb25zOiB7IFtrZXk6IHN0cmluZ106IHN0cmluZ1tdIH0gPSB7XG4gICAgICAnbWF0ZW3DoXRpY2FzJzogWyfDoWxnZWJyYScsICdnZW9tZXRyw61hJywgJ2PDoWxjdWxvJywgJ2VzdGFkw61zdGljYScsICd0cmlnb25vbWV0csOtYSddLFxuICAgICAgJ2bDrXNpY2EnOiBbJ21lY8OhbmljYScsICd0ZXJtb2RpbsOhbWljYScsICdlbGVjdHJvbWFnbmV0aXNtbycsICfDs3B0aWNhJywgJ2N1w6FudGljYSddLFxuICAgICAgJ3F1w61taWNhJzogWydvcmfDoW5pY2EnLCAnaW5vcmfDoW5pY2EnLCAnYW5hbMOtdGljYScsICdmw61zaWNhIHF1w61taWNhJywgJ2Jpb3F1w61taWNhJ10sXG4gICAgICAncHJvZ3JhbWFjacOzbic6IFsnYWxnb3JpdG1vcycsICdlc3RydWN0dXJhcyBkZSBkYXRvcycsICdiYXNlcyBkZSBkYXRvcycsICdkZXNhcnJvbGxvIHdlYicsICdpbnRlbGlnZW5jaWEgYXJ0aWZpY2lhbCddXG4gICAgfVxuICAgIFxuICAgIGNvbnN0IGxvd2VyQ29udGVudCA9IGNvbnRlbnQudG9Mb3dlckNhc2UoKVxuICAgIGNvbnN0IGxvd2VyVG9waWMgPSBtYWluVG9waWMudG9Mb3dlckNhc2UoKVxuICAgIFxuICAgIC8vIEJ1c2NhciByZWxhY2lvbmVzIGRpcmVjdGFzXG4gICAgZm9yIChjb25zdCBbc3ViamVjdCwgcmVsYXRpb25zXSBvZiBPYmplY3QuZW50cmllcyh0b3BpY1JlbGF0aW9ucykpIHtcbiAgICAgIGlmIChsb3dlclRvcGljLmluY2x1ZGVzKHN1YmplY3QpIHx8IGxvd2VyQ29udGVudC5pbmNsdWRlcyhzdWJqZWN0KSkge1xuICAgICAgICBjb25zdCBmb3VuZFJlbGF0aW9ucyA9IHJlbGF0aW9ucy5maWx0ZXIocmVsYXRpb24gPT4gXG4gICAgICAgICAgbG93ZXJDb250ZW50LmluY2x1ZGVzKHJlbGF0aW9uKSAmJiAhbG93ZXJUb3BpYy5pbmNsdWRlcyhyZWxhdGlvbilcbiAgICAgICAgKVxuICAgICAgICByZWxhdGVkVG9waWNzLnB1c2goLi4uZm91bmRSZWxhdGlvbnMpXG4gICAgICB9XG4gICAgfVxuICAgIFxuICAgIHJldHVybiBBcnJheS5mcm9tKG5ldyBTZXQocmVsYXRlZFRvcGljcykpLnNsaWNlKDAsIDMpXG4gIH1cblxuICAvKipcbiAgICogRXN0aW1hIHRpZW1wbyBkZSBsZWN0dXJhXG4gICAqL1xuICBwcml2YXRlIHN0YXRpYyBlc3RpbWF0ZVJlYWRUaW1lKGNvbnRlbnQ6IHN0cmluZyk6IG51bWJlciB7XG4gICAgY29uc3Qgd29yZHNQZXJNaW51dGUgPSAyMDAgLy8gUHJvbWVkaW8gZGUgbGVjdHVyYSBlbiBlc3Bhw7FvbFxuICAgIGNvbnN0IHdvcmRDb3VudCA9IGNvbnRlbnQuc3BsaXQoL1xccysvKS5sZW5ndGhcbiAgICByZXR1cm4gTWF0aC5tYXgoMSwgTWF0aC5jZWlsKHdvcmRDb3VudCAvIHdvcmRzUGVyTWludXRlKSlcbiAgfVxuXG4gIC8qKlxuICAgKiBFeHRyYWUgZG9taW5pbyBkZSBVUkxcbiAgICovXG4gIHByaXZhdGUgc3RhdGljIGV4dHJhY3REb21haW4odXJsOiBzdHJpbmcpOiBzdHJpbmcge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCB1cmxPYmogPSBuZXcgVVJMKHVybClcbiAgICAgIHJldHVybiB1cmxPYmouaG9zdG5hbWVcbiAgICB9IGNhdGNoIHtcbiAgICAgIHJldHVybiAnZnVlbnRlIGRlc2Nvbm9jaWRhJ1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBHZW5lcmEgcmVjb21lbmRhY2lvbmVzIHBlcnNvbmFsaXphZGFzXG4gICAqL1xuICBwcml2YXRlIHN0YXRpYyBhc3luYyBnZW5lcmF0ZVBlcnNvbmFsaXplZFJlY29tbWVuZGF0aW9ucyhcbiAgICBxdWVyeTogQWNhZGVtaWNTZWFyY2hRdWVyeSwgXG4gICAgcmVzdWx0czogQWNhZGVtaWNTZWFyY2hSZXN1bHRbXVxuICApOiBQcm9taXNlPHtcbiAgICBzdWdnZXN0aW9uczogc3RyaW5nW11cbiAgICBmb2xsb3dVcFF1ZXN0aW9uczogc3RyaW5nW11cbiAgICBhY3Rpb25zOiBzdHJpbmdbXVxuICB9PiB7XG4gICAgY29uc3Qgc3VnZ2VzdGlvbnM6IHN0cmluZ1tdID0gW11cbiAgICBjb25zdCBmb2xsb3dVcFF1ZXN0aW9uczogc3RyaW5nW10gPSBbXVxuICAgIGNvbnN0IGFjdGlvbnM6IHN0cmluZ1tdID0gW11cbiAgICBcbiAgICAvLyBBbmFsaXphciByZXN1bHRhZG9zIHBhcmEgZ2VuZXJhciBzdWdlcmVuY2lhc1xuICAgIGlmIChyZXN1bHRzLmxlbmd0aCA+IDApIHtcbiAgICAgIGNvbnN0IGhhc0Jhc2ljQ29udGVudCA9IHJlc3VsdHMuc29tZShyID0+IHIuZGlmZmljdWx0eSA9PT0gJ2Jhc2ljJylcbiAgICAgIGNvbnN0IGhhc0FkdmFuY2VkQ29udGVudCA9IHJlc3VsdHMuc29tZShyID0+IHIuZGlmZmljdWx0eSA9PT0gJ2FkdmFuY2VkJylcbiAgICAgIFxuICAgICAgaWYgKGhhc0Jhc2ljQ29udGVudCAmJiBxdWVyeS5sZXZlbCAhPT0gJ2Jhc2ljJykge1xuICAgICAgICBzdWdnZXN0aW9ucy5wdXNoKGBFbmNvbnRyw6kgY29udGVuaWRvIGLDoXNpY28gc29icmUgJHtxdWVyeS50b3BpY30gcXVlIHB1ZWRlIGF5dWRhcnRlIGEgcmVmb3J6YXIgZnVuZGFtZW50b3NgKVxuICAgICAgfVxuICAgICAgXG4gICAgICBpZiAoaGFzQWR2YW5jZWRDb250ZW50ICYmIHF1ZXJ5LmxldmVsICE9PSAnYWR2YW5jZWQnKSB7XG4gICAgICAgIHN1Z2dlc3Rpb25zLnB1c2goYEhheSBtYXRlcmlhbCBhdmFuemFkbyBkaXNwb25pYmxlIGN1YW5kbyB0ZSBzaWVudGFzIGxpc3RvIHBhcmEgcHJvZnVuZGl6YXJgKVxuICAgICAgfVxuICAgICAgXG4gICAgICAvLyBHZW5lcmFyIHByZWd1bnRhcyBkZSBzZWd1aW1pZW50b1xuICAgICAgZm9sbG93VXBRdWVzdGlvbnMucHVzaChgwr9UZSBndXN0YXLDrWEgcXVlIGJ1c3F1ZSBlamVyY2ljaW9zIHByw6FjdGljb3Mgc29icmUgJHtxdWVyeS50b3BpY30/YClcbiAgICAgIGZvbGxvd1VwUXVlc3Rpb25zLnB1c2goYMK/TmVjZXNpdGFzIHF1ZSBlbmN1ZW50cmUgdmlkZW9zIGV4cGxpY2F0aXZvcyBzb2JyZSBlc3RlIHRlbWE/YClcbiAgICAgIFxuICAgICAgLy8gR2VuZXJhciBhY2Npb25lcyBzdWdlcmlkYXNcbiAgICAgIGFjdGlvbnMucHVzaChcIlJldmlzYXIgbG9zIHJlY3Vyc29zIGVuY29udHJhZG9zIHBvciBvcmRlbiBkZSByZWxldmFuY2lhXCIpXG4gICAgICBhY3Rpb25zLnB1c2goXCJUb21hciBub3RhcyBkZSBsb3MgcHVudG9zIGNsYXZlIGlkZW50aWZpY2Fkb3NcIilcbiAgICAgIFxuICAgICAgaWYgKHJlc3VsdHMuc29tZShyID0+IHIuY29udGVudFR5cGUgPT09ICdleGVyY2lzZScpKSB7XG4gICAgICAgIGFjdGlvbnMucHVzaChcIlByYWN0aWNhciBjb24gbG9zIGVqZXJjaWNpb3MgZW5jb250cmFkb3NcIilcbiAgICAgIH1cbiAgICB9XG4gICAgXG4gICAgLy8gQWdyZWdhciByZWNvbWVuZGFjaW9uZXMgYmFzYWRhcyBlbiBtZW1vcmlhIHNpIGVzdMOhIGRpc3BvbmlibGVcbiAgICBpZiAocXVlcnkudXNlcklkKSB7XG4gICAgICBjb25zdCBtZW1vcnlCYXNlZFN1Z2dlc3Rpb25zID0gYXdhaXQgdGhpcy5nZXRNZW1vcnlCYXNlZFJlY29tbWVuZGF0aW9ucyhxdWVyeSlcbiAgICAgIHN1Z2dlc3Rpb25zLnB1c2goLi4ubWVtb3J5QmFzZWRTdWdnZXN0aW9ucylcbiAgICB9XG4gICAgXG4gICAgcmV0dXJuIHsgc3VnZ2VzdGlvbnMsIGZvbGxvd1VwUXVlc3Rpb25zLCBhY3Rpb25zIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBPYnRpZW5lIHJlY29tZW5kYWNpb25lcyBiYXNhZGFzIGVuIG1lbW9yaWEgZGVsIHVzdWFyaW9cbiAgICovXG4gIHByaXZhdGUgc3RhdGljIGFzeW5jIGdldE1lbW9yeUJhc2VkUmVjb21tZW5kYXRpb25zKHF1ZXJ5OiBBY2FkZW1pY1NlYXJjaFF1ZXJ5KTogUHJvbWlzZTxzdHJpbmdbXT4ge1xuICAgIGlmICghcXVlcnkudXNlcklkKSByZXR1cm4gW11cbiAgICBcbiAgICB0cnkge1xuICAgICAgY29uc3QgbWVtb3J5ID0gQ29udmVyc2F0aW9uTWVtb3J5TWFuYWdlci5nZXRNZW1vcnkocXVlcnkudXNlcklkLCBxdWVyeS5zZXNzaW9uSWQpXG4gICAgICBjb25zdCBzdWdnZXN0aW9uczogc3RyaW5nW10gPSBbXVxuICAgICAgXG4gICAgICAvLyBCYXNhZG8gZW4gbWF0ZXJpYXMgZGlmw61jaWxlc1xuICAgICAgaWYgKG1lbW9yeS5wcmVmZXJlbmNlcy5kaWZmaWN1bHRTdWJqZWN0cy5pbmNsdWRlcyhxdWVyeS5zdWJqZWN0IHx8ICcnKSkge1xuICAgICAgICBzdWdnZXN0aW9ucy5wdXNoKGBIZSBub3RhZG8gcXVlICR7cXVlcnkuc3ViamVjdH0gdGUgcHJlc2VudGEgZGVzYWbDrW9zLiBUZSBidXNxdcOpIHJlY3Vyc29zIGVzcGVjaWFsbWVudGUgY2xhcm9zYClcbiAgICAgIH1cbiAgICAgIFxuICAgICAgLy8gQmFzYWRvIGVuIGVtb2Npb25lcyByZWNpZW50ZXNcbiAgICAgIGlmIChtZW1vcnkuZW1vdGlvbmFsUHJvZmlsZS5yZWNlbnRFbW90aW9ucy5pbmNsdWRlcyhFbW90aW9uVHlwZS5DT05GVVNFRCkpIHtcbiAgICAgICAgc3VnZ2VzdGlvbnMucHVzaChcIlNlbGVjY2lvbsOpIGV4cGxpY2FjaW9uZXMgcGFzbyBhIHBhc28gY29uc2lkZXJhbmRvIHR1IGNvbmZ1c2nDs24gcmVjaWVudGVcIilcbiAgICAgIH1cbiAgICAgIFxuICAgICAgaWYgKG1lbW9yeS5lbW90aW9uYWxQcm9maWxlLnJlY2VudEVtb3Rpb25zLmluY2x1ZGVzKEVtb3Rpb25UeXBlLk1PVElWQVRFRCkpIHtcbiAgICAgICAgc3VnZ2VzdGlvbnMucHVzaChcIlZpIHF1ZSBlc3TDoXMgbXV5IG1vdGl2YWRvLCBhc8OtIHF1ZSBpbmNsdcOtIG1hdGVyaWFsIGRlc2FmaWFudGUgcGFyYSBhcHJvdmVjaGFyIHR1IGVuZXJnw61hXCIpXG4gICAgICB9XG4gICAgICBcbiAgICAgIHJldHVybiBzdWdnZXN0aW9uc1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBnZXR0aW5nIG1lbW9yeS1iYXNlZCByZWNvbW1lbmRhdGlvbnM6JywgZXJyb3IpXG4gICAgICByZXR1cm4gW11cbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogR2VuZXJhIHJlY29tZW5kYWNpb25lcyBkZSByZXNwYWxkbyBjdWFuZG8gbGEgYsO6c3F1ZWRhIGZhbGxhXG4gICAqL1xuICBwcml2YXRlIHN0YXRpYyBnZW5lcmF0ZUZhbGxiYWNrUmVjb21tZW5kYXRpb25zKHF1ZXJ5OiBBY2FkZW1pY1NlYXJjaFF1ZXJ5KTogc3RyaW5nW10ge1xuICAgIHJldHVybiBbXG4gICAgICBgSW50ZW50YSBidXNjYXIgXCIke3F1ZXJ5LnRvcGljfVwiIGVuIHJlY3Vyc29zIGFjYWTDqW1pY29zIGxvY2FsZXNgLFxuICAgICAgYENvbnN1bHRhIHR1IGxpYnJvIGRlIHRleHRvIHNvYnJlICR7cXVlcnkuc3ViamVjdCB8fCAnbGEgbWF0ZXJpYSd9YCxcbiAgICAgIGBQcmVndW50YSBhIHR1IHByb2Zlc29yIHNvYnJlICR7cXVlcnkudG9waWN9IGVuIGxhIHByw7N4aW1hIGNsYXNlYCxcbiAgICAgIFwiUmV2aXNhIHR1cyBhcHVudGVzIHByZXZpb3Mgc29icmUgdGVtYXMgcmVsYWNpb25hZG9zXCJcbiAgICBdXG4gIH1cblxuICAvKipcbiAgICogUmVhbGl6YSBiw7pzcXVlZGEgaW50ZWxpZ2VudGUgYmFzYWRhIGVuIGNvbnRleHRvIGNvbnZlcnNhY2lvbmFsXG4gICAqL1xuICBzdGF0aWMgYXN5bmMgc21hcnRTZWFyY2goXG4gICAgbWVzc2FnZTogc3RyaW5nLFxuICAgIHVzZXJJZD86IHN0cmluZyxcbiAgICBzZXNzaW9uSWQ/OiBzdHJpbmdcbiAgKTogUHJvbWlzZTxTZWFyY2hBbmFseXNpcyB8IG51bGw+IHtcbiAgICAvLyBFeHRyYWVyIGluZm9ybWFjacOzbiBkZSBiw7pzcXVlZGEgZGVsIG1lbnNhamVcbiAgICBjb25zdCBzZWFyY2hRdWVyeSA9IHRoaXMuZXh0cmFjdFNlYXJjaFF1ZXJ5KG1lc3NhZ2UpXG4gICAgXG4gICAgaWYgKCFzZWFyY2hRdWVyeSkgcmV0dXJuIG51bGxcbiAgICBcbiAgICAvLyBFbnJpcXVlY2VyIHF1ZXJ5IGNvbiBpbmZvcm1hY2nDs24gZGVsIHVzdWFyaW9cbiAgICBpZiAodXNlcklkKSB7XG4gICAgICBjb25zdCBtZW1vcnkgPSBDb252ZXJzYXRpb25NZW1vcnlNYW5hZ2VyLmdldE1lbW9yeSh1c2VySWQsIHNlc3Npb25JZClcbiAgICAgIFxuICAgICAgLy8gSW5mZXJpciBtYXRlcmlhIGJhc8OhbmRvc2UgZW4gZWwgY29udGV4dG9cbiAgICAgIGlmICghc2VhcmNoUXVlcnkuc3ViamVjdCAmJiBtZW1vcnkucHJlZmVyZW5jZXMuZGlmZmljdWx0U3ViamVjdHMubGVuZ3RoID4gMCkge1xuICAgICAgICBzZWFyY2hRdWVyeS5zdWJqZWN0ID0gbWVtb3J5LnByZWZlcmVuY2VzLmRpZmZpY3VsdFN1YmplY3RzWzBdXG4gICAgICB9XG4gICAgICBcbiAgICAgIC8vIEFqdXN0YXIgbml2ZWwgYmFzw6FuZG9zZSBlbiBlbCBwcm9ncmVzb1xuICAgICAgaWYgKCFzZWFyY2hRdWVyeS5sZXZlbCkge1xuICAgICAgICBzZWFyY2hRdWVyeS5sZXZlbCA9IG1lbW9yeS5lbW90aW9uYWxQcm9maWxlLm1vdGl2YXRpb25MZXZlbCA+IDcgPyAnaW50ZXJtZWRpYXRlJyA6ICdiYXNpYydcbiAgICAgIH1cbiAgICAgIFxuICAgICAgc2VhcmNoUXVlcnkudXNlcklkID0gdXNlcklkXG4gICAgICBzZWFyY2hRdWVyeS5zZXNzaW9uSWQgPSBzZXNzaW9uSWRcbiAgICB9XG4gICAgXG4gICAgcmV0dXJuIGF3YWl0IHRoaXMuc2VhcmNoQWNhZGVtaWNDb250ZW50KHNlYXJjaFF1ZXJ5KVxuICB9XG5cbiAgLyoqXG4gICAqIEV4dHJhZSBxdWVyeSBkZSBiw7pzcXVlZGEgZGVsIG1lbnNhamUgZGVsIHVzdWFyaW9cbiAgICovXG4gIHByaXZhdGUgc3RhdGljIGV4dHJhY3RTZWFyY2hRdWVyeShtZXNzYWdlOiBzdHJpbmcpOiBBY2FkZW1pY1NlYXJjaFF1ZXJ5IHwgbnVsbCB7XG4gICAgY29uc3QgbG93ZXJNZXNzYWdlID0gbWVzc2FnZS50b0xvd2VyQ2FzZSgpXG4gICAgXG4gICAgLy8gUGF0cm9uZXMgcGFyYSBkZXRlY3RhciBzb2xpY2l0dWRlcyBkZSBiw7pzcXVlZGFcbiAgICBjb25zdCBzZWFyY2hQYXR0ZXJucyA9IFtcbiAgICAgIC9idXNjYSg/Om1lKT9cXHMrKD86aW5mb3JtYWNpw7NufHNvYnJlfGFjZXJjYVxccytkZSlcXHMrKC4rKS9pLFxuICAgICAgLyg/OnF1w6lcXHMrZXN8ZXhwbGljYSg/Om1lKT8pXFxzKyguKykvaSxcbiAgICAgIC8oPzpjw7Ntb3xjb21vKVxccysoPzpzZVxccyspPyguKykvaSxcbiAgICAgIC9uZWNlc2l0b1xccysoPzppbmZvcm1hY2nDs258YXl1ZGF8c2FiZXIpXFxzKyg/OnNvYnJlfGRlfGNvbilcXHMrKC4rKS9pLFxuICAgICAgLyg/OmVqZW1wbG9zfGVqZXJjaWNpb3MpXFxzKyg/OmRlfHNvYnJlKVxccysoLispL2lcbiAgICBdXG4gICAgXG4gICAgZm9yIChjb25zdCBwYXR0ZXJuIG9mIHNlYXJjaFBhdHRlcm5zKSB7XG4gICAgICBjb25zdCBtYXRjaCA9IG1lc3NhZ2UubWF0Y2gocGF0dGVybilcbiAgICAgIGlmIChtYXRjaCkge1xuICAgICAgICBjb25zdCB0b3BpYyA9IG1hdGNoWzFdLnRyaW0oKVxuICAgICAgICBcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICB0b3BpYyxcbiAgICAgICAgICBzZWFyY2hUeXBlOiB0aGlzLmluZmVyU2VhcmNoVHlwZShsb3dlck1lc3NhZ2UpLFxuICAgICAgICAgIGxhbmd1YWdlOiAnZXMnXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICAgXG4gICAgcmV0dXJuIG51bGxcbiAgfVxuXG4gIC8qKlxuICAgKiBJbmZpZXJlIHRpcG8gZGUgYsO6c3F1ZWRhIGJhc8OhbmRvc2UgZW4gZWwgbWVuc2FqZVxuICAgKi9cbiAgcHJpdmF0ZSBzdGF0aWMgaW5mZXJTZWFyY2hUeXBlKG1lc3NhZ2U6IHN0cmluZyk6IEFjYWRlbWljU2VhcmNoUXVlcnlbJ3NlYXJjaFR5cGUnXSB7XG4gICAgaWYgKC9lamVyY2ljaW98cHJvYmxlbWF8cHLDoWN0aWNhLy50ZXN0KG1lc3NhZ2UpKSByZXR1cm4gJ2V4ZXJjaXNlcydcbiAgICBpZiAoL2VqZW1wbG98Y2Fzb3xtdWVzdHJhLy50ZXN0KG1lc3NhZ2UpKSByZXR1cm4gJ2V4YW1wbGVzJ1xuICAgIGlmICgvcmVjdXJzb3xtYXRlcmlhbHxoZXJyYW1pZW50YS8udGVzdChtZXNzYWdlKSkgcmV0dXJuICdyZXNvdXJjZXMnXG4gICAgaWYgKC9pbnZlc3RpZ2FjacOzbnxwYXBlcnxlc3R1ZGlvLy50ZXN0KG1lc3NhZ2UpKSByZXR1cm4gJ3Jlc2VhcmNoJ1xuICAgIHJldHVybiAnZXhwbGFuYXRpb24nXG4gIH1cbn0iXSwibmFtZXMiOlsiV2ViU2VhcmNoSW50ZWdyYXRpb24iLCJDb252ZXJzYXRpb25NZW1vcnlNYW5hZ2VyIiwiRW1vdGlvblR5cGUiLCJBY2FkZW1pY1NlYXJjaEVuZ2luZSIsIlNFQVJDSF9URU1QTEFURVMiLCJleHBsYW5hdGlvbiIsImVzIiwiZW4iLCJleGFtcGxlcyIsImV4ZXJjaXNlcyIsInJlc291cmNlcyIsInJlc2VhcmNoIiwiQUNBREVNSUNfRU5IQU5DRVJTIiwiUVVBTElUWV9JTkRJQ0FUT1JTIiwiaGlnaCIsIm1lZGl1bSIsImxvdyIsInNlYXJjaEFjYWRlbWljQ29udGVudCIsInF1ZXJ5Iiwic3RhcnRUaW1lIiwiRGF0ZSIsIm5vdyIsIm9wdGltaXplZFF1ZXJ5Iiwib3B0aW1pemVBY2FkZW1pY1F1ZXJ5Iiwid2ViU2VhcmNoUmVzdWx0cyIsInBlcmZvcm1XZWJTZWFyY2giLCJhY2FkZW1pY1Jlc3VsdHMiLCJwcm9jZXNzU2VhcmNoUmVzdWx0cyIsInJlY29tbWVuZGF0aW9ucyIsImdlbmVyYXRlUGVyc29uYWxpemVkUmVjb21tZW5kYXRpb25zIiwic2VhcmNoVGltZSIsInJlc3VsdHMiLCJzZWFyY2hTdWNjZXNzIiwibGVuZ3RoIiwidG90YWxSZXN1bHRzIiwicGVyc29uYWxpemVkUmVjb21tZW5kYXRpb25zIiwic3VnZ2VzdGlvbnMiLCJmb2xsb3dVcFF1ZXN0aW9ucyIsInN1Z2dlc3RlZEFjdGlvbnMiLCJhY3Rpb25zIiwiZXJyb3IiLCJjb25zb2xlIiwiZ2VuZXJhdGVGYWxsYmFja1JlY29tbWVuZGF0aW9ucyIsInRvcGljIiwic3ViamVjdCIsInNlYXJjaFR5cGUiLCJsZXZlbCIsImxhbmd1YWdlIiwidGVtcGxhdGUiLCJyZXBsYWNlIiwibGV2ZWxUZXJtcyIsImJhc2ljIiwiaW50ZXJtZWRpYXRlIiwiYWR2YW5jZWQiLCJlbmhhbmNlcnMiLCJzZWxlY3RlZEVuaGFuY2VycyIsInNsaWNlIiwiam9pbiIsInRyaW0iLCJ3ZWJSZXN1bHRzIiwiZ2VuZXJhdGVTaW11bGF0ZWRSZXN1bHRzIiwic2ltdWxhdGVkUmVzdWx0cyIsInRpdGxlIiwiY29udGVudCIsInVybCIsInNvdXJjZSIsInJhd1Jlc3VsdHMiLCJwcm9jZXNzZWRSZXN1bHRzIiwicmVzdWx0IiwiYWNhZGVtaWNSZXN1bHQiLCJzbmlwcGV0IiwiZXh0cmFjdERvbWFpbiIsInJlbGV2YW5jZVNjb3JlIiwiY2FsY3VsYXRlUmVsZXZhbmNlU2NvcmUiLCJkaWZmaWN1bHR5IiwiaW5mZXJEaWZmaWN1bHR5IiwiY29udGVudFR5cGUiLCJjbGFzc2lmeUNvbnRlbnRUeXBlIiwic3VtbWFyeSIsImdlbmVyYXRlU3VtbWFyeSIsImtleVBvaW50cyIsImV4dHJhY3RLZXlQb2ludHMiLCJyZWxhdGVkVG9waWNzIiwiaWRlbnRpZnlSZWxhdGVkVG9waWNzIiwiZXN0aW1hdGVkUmVhZFRpbWUiLCJlc3RpbWF0ZVJlYWRUaW1lIiwicHVzaCIsInNvcnQiLCJhIiwiYiIsInNjb3JlIiwidG9Mb3dlckNhc2UiLCJpbmNsdWRlcyIsImRvbWFpbiIsInNvbWUiLCJpbmRpY2F0b3IiLCJNYXRoIiwibWluIiwicXVlcnlMZXZlbCIsImxvd2VyQ29udGVudCIsImJhc2ljSW5kaWNhdG9ycyIsImJhc2ljQ291bnQiLCJmaWx0ZXIiLCJhZHZhbmNlZEluZGljYXRvcnMiLCJhZHZhbmNlZENvdW50Iiwic2VudGVuY2VzIiwic3BsaXQiLCJzIiwiZmlyc3RUd29TZW50ZW5jZXMiLCJzdWJzdHJpbmciLCJsaXN0TWF0Y2hlcyIsIm1hdGNoIiwibWFwIiwiaXRlbSIsImltcG9ydGFudFNlbnRlbmNlcyIsInBvaW50IiwibWFpblRvcGljIiwidG9waWNSZWxhdGlvbnMiLCJsb3dlclRvcGljIiwicmVsYXRpb25zIiwiT2JqZWN0IiwiZW50cmllcyIsImZvdW5kUmVsYXRpb25zIiwicmVsYXRpb24iLCJBcnJheSIsImZyb20iLCJTZXQiLCJ3b3Jkc1Blck1pbnV0ZSIsIndvcmRDb3VudCIsIm1heCIsImNlaWwiLCJ1cmxPYmoiLCJVUkwiLCJob3N0bmFtZSIsImhhc0Jhc2ljQ29udGVudCIsInIiLCJoYXNBZHZhbmNlZENvbnRlbnQiLCJ1c2VySWQiLCJtZW1vcnlCYXNlZFN1Z2dlc3Rpb25zIiwiZ2V0TWVtb3J5QmFzZWRSZWNvbW1lbmRhdGlvbnMiLCJtZW1vcnkiLCJnZXRNZW1vcnkiLCJzZXNzaW9uSWQiLCJwcmVmZXJlbmNlcyIsImRpZmZpY3VsdFN1YmplY3RzIiwiZW1vdGlvbmFsUHJvZmlsZSIsInJlY2VudEVtb3Rpb25zIiwiQ09ORlVTRUQiLCJNT1RJVkFURUQiLCJzbWFydFNlYXJjaCIsIm1lc3NhZ2UiLCJzZWFyY2hRdWVyeSIsImV4dHJhY3RTZWFyY2hRdWVyeSIsIm1vdGl2YXRpb25MZXZlbCIsImxvd2VyTWVzc2FnZSIsInNlYXJjaFBhdHRlcm5zIiwicGF0dGVybiIsImluZmVyU2VhcmNoVHlwZSIsInRlc3QiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/academic-search-engine.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/advanced-learning-profiles.ts":
/*!***********************************************!*\
  !*** ./src/lib/advanced-learning-profiles.ts ***!
  \***********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   AdvancedLearningProfileManager: () => (/* binding */ AdvancedLearningProfileManager),\n/* harmony export */   LearningStyle: () => (/* binding */ LearningStyle)\n/* harmony export */ });\n// Advanced Learning Profiles System for Sara AI\n// Implements VARK model (Visual, Auditory, Reading/Writing, Kinesthetic) with automatic detection\nvar LearningStyle = /*#__PURE__*/ function(LearningStyle) {\n    LearningStyle[\"VISUAL\"] = \"visual\";\n    LearningStyle[\"AUDITORY\"] = \"auditory\";\n    LearningStyle[\"READING_WRITING\"] = \"reading_writing\";\n    LearningStyle[\"KINESTHETIC\"] = \"kinesthetic\";\n    LearningStyle[\"MULTIMODAL\"] = \"multimodal\";\n    return LearningStyle;\n}({});\nclass AdvancedLearningProfileManager {\n    static{\n        // Storage for learning profiles\n        this.profiles = new Map();\n    }\n    static{\n        this.behaviors = [];\n    }\n    /**\n   * Analyzes user message for learning style indicators\n   */ static analyzeMessageForLearningStyle(message, userId) {\n        const msgLower = message.toLowerCase();\n        const indicators = [];\n        // VISUAL indicators\n        const visualKeywords = [\n            'ver',\n            'mirar',\n            'mostrar',\n            'imagen',\n            'gráfico',\n            'diagrama',\n            'visual',\n            'color',\n            'mapa',\n            'esquema',\n            'dibujo',\n            'ilustración',\n            'tabla',\n            'gráfica',\n            'visualizar',\n            'observar',\n            'demostrar',\n            'ejemplo visual',\n            'claramente'\n        ];\n        const visualPhrases = [\n            'me gusta ver',\n            'muéstrame',\n            'qué aspecto tiene',\n            'cómo se ve',\n            'necesito ver',\n            'puedes mostrar',\n            'ejemplo visual',\n            'de forma gráfica'\n        ];\n        let visualScore = this.calculateKeywordScore(msgLower, visualKeywords, visualPhrases);\n        if (visualScore > 0) {\n            indicators.push({\n                style: \"visual\",\n                weight: visualScore,\n                evidence: this.extractEvidence(msgLower, [\n                    ...visualKeywords,\n                    ...visualPhrases\n                ]),\n                confidence: Math.min(visualScore * 1.2, 1.0)\n            });\n        }\n        // AUDITORY indicators\n        const auditoryKeywords = [\n            'escuchar',\n            'oír',\n            'sonido',\n            'explicar',\n            'decir',\n            'contar',\n            'discutir',\n            'hablar',\n            'verbal',\n            'audio',\n            'pronunciar',\n            'repetir',\n            'preguntar'\n        ];\n        const auditoryPhrases = [\n            'explícame',\n            'cuéntame',\n            'me puedes decir',\n            'necesito que me expliques',\n            'repítelo',\n            'en palabras',\n            'de forma verbal',\n            'hablemos de'\n        ];\n        let auditoryScore = this.calculateKeywordScore(msgLower, auditoryKeywords, auditoryPhrases);\n        if (auditoryScore > 0) {\n            indicators.push({\n                style: \"auditory\",\n                weight: auditoryScore,\n                evidence: this.extractEvidence(msgLower, [\n                    ...auditoryKeywords,\n                    ...auditoryPhrases\n                ]),\n                confidence: Math.min(auditoryScore * 1.1, 1.0)\n            });\n        }\n        // READING/WRITING indicators\n        const readWriteKeywords = [\n            'leer',\n            'escribir',\n            'texto',\n            'nota',\n            'lista',\n            'definición',\n            'resumen',\n            'apuntes',\n            'documento',\n            'artículo',\n            'párrafo',\n            'descripción',\n            'detalles'\n        ];\n        const readWritePhrases = [\n            'en texto',\n            'por escrito',\n            'dame detalles',\n            'necesito leer',\n            'quiero estudiar',\n            'información detallada',\n            'paso a paso',\n            'lista de'\n        ];\n        let readWriteScore = this.calculateKeywordScore(msgLower, readWriteKeywords, readWritePhrases);\n        if (readWriteScore > 0) {\n            indicators.push({\n                style: \"reading_writing\",\n                weight: readWriteScore,\n                evidence: this.extractEvidence(msgLower, [\n                    ...readWriteKeywords,\n                    ...readWritePhrases\n                ]),\n                confidence: Math.min(readWriteScore, 1.0)\n            });\n        }\n        // KINESTHETIC indicators\n        const kinestheticKeywords = [\n            'hacer',\n            'practicar',\n            'ejercicio',\n            'actividad',\n            'mano',\n            'tocar',\n            'mover',\n            'experimentar',\n            'probar',\n            'manipular',\n            'construir',\n            'crear',\n            'interactivo'\n        ];\n        const kinestheticPhrases = [\n            'quiero hacer',\n            'necesito practicar',\n            'hands on',\n            'de forma práctica',\n            'experimentando',\n            'probando',\n            'haciendo ejercicios',\n            'actividades'\n        ];\n        let kinestheticScore = this.calculateKeywordScore(msgLower, kinestheticKeywords, kinestheticPhrases);\n        if (kinestheticScore > 0) {\n            indicators.push({\n                style: \"kinesthetic\",\n                weight: kinestheticScore,\n                evidence: this.extractEvidence(msgLower, [\n                    ...kinestheticKeywords,\n                    ...kinestheticPhrases\n                ]),\n                confidence: Math.min(kinestheticScore * 1.3, 1.0)\n            });\n        }\n        // Record behavior pattern\n        if (indicators.length > 0) {\n            this.recordBehaviorPattern(userId, 'message_analysis', message, indicators.map((i)=>i.style));\n        }\n        return indicators.sort((a, b)=>b.weight - a.weight);\n    }\n    /**\n   * Calculates score based on keyword and phrase matches\n   */ static calculateKeywordScore(text, keywords, phrases) {\n        let score = 0;\n        // Keyword matches (lower weight)\n        for (const keyword of keywords){\n            if (text.includes(keyword)) {\n                score += 0.1;\n            }\n        }\n        // Phrase matches (higher weight)\n        for (const phrase of phrases){\n            if (text.includes(phrase)) {\n                score += 0.3;\n            }\n        }\n        return Math.min(score, 1.0);\n    }\n    /**\n   * Extracts evidence from text\n   */ static extractEvidence(text, patterns) {\n        const evidence = [];\n        for (const pattern of patterns){\n            if (text.includes(pattern)) {\n                // Extract sentence containing the pattern\n                const sentences = text.split(/[.!?]+/);\n                const matchingSentence = sentences.find((sentence)=>sentence.toLowerCase().includes(pattern));\n                if (matchingSentence) {\n                    evidence.push(matchingSentence.trim());\n                }\n            }\n        }\n        return evidence.slice(0, 3) // Limit to 3 pieces of evidence\n        ;\n    }\n    /**\n   * Records a learning behavior pattern\n   */ static recordBehaviorPattern(userId, action, context, styleIndicators) {\n        this.behaviors.push({\n            userId,\n            timestamp: new Date(),\n            action,\n            context,\n            styleIndicators\n        });\n        // Keep only recent behaviors (last 100 per user)\n        const userBehaviors = this.behaviors.filter((b)=>b.userId === userId);\n        if (userBehaviors.length > 100) {\n            this.behaviors = this.behaviors.filter((b)=>b.userId !== userId).concat(userBehaviors.slice(-100));\n        }\n    }\n    /**\n   * Updates or creates learning profile for user\n   */ static updateLearningProfile(userId, indicators, context) {\n        let profile = this.profiles.get(userId) || this.createInitialProfile(userId);\n        // Update style distribution based on new indicators\n        for (const indicator of indicators){\n            const weight = indicator.weight * indicator.confidence;\n            switch(indicator.style){\n                case \"visual\":\n                    profile.styleDistribution.visual = Math.min(profile.styleDistribution.visual + weight * 0.1, 1.0);\n                    break;\n                case \"auditory\":\n                    profile.styleDistribution.auditory = Math.min(profile.styleDistribution.auditory + weight * 0.1, 1.0);\n                    break;\n                case \"reading_writing\":\n                    profile.styleDistribution.reading_writing = Math.min(profile.styleDistribution.reading_writing + weight * 0.1, 1.0);\n                    break;\n                case \"kinesthetic\":\n                    profile.styleDistribution.kinesthetic = Math.min(profile.styleDistribution.kinesthetic + weight * 0.1, 1.0);\n                    break;\n            }\n        }\n        // Normalize distribution\n        const total = profile.styleDistribution.visual + profile.styleDistribution.auditory + profile.styleDistribution.reading_writing + profile.styleDistribution.kinesthetic;\n        if (total > 0) {\n            profile.styleDistribution.visual /= total;\n            profile.styleDistribution.auditory /= total;\n            profile.styleDistribution.reading_writing /= total;\n            profile.styleDistribution.kinesthetic /= total;\n        }\n        // Determine primary and secondary styles\n        const styles = [\n            {\n                style: \"visual\",\n                score: profile.styleDistribution.visual\n            },\n            {\n                style: \"auditory\",\n                score: profile.styleDistribution.auditory\n            },\n            {\n                style: \"reading_writing\",\n                score: profile.styleDistribution.reading_writing\n            },\n            {\n                style: \"kinesthetic\",\n                score: profile.styleDistribution.kinesthetic\n            }\n        ].sort((a, b)=>b.score - a.score);\n        profile.primaryStyle = styles[0].score > 0.35 ? styles[0].style : \"multimodal\";\n        profile.secondaryStyle = styles[1].score > 0.25 ? styles[1].style : undefined;\n        // Update adaptation preferences\n        profile.adaptationPreferences = {\n            prefersDiagrams: profile.styleDistribution.visual > 0.3,\n            prefersStepByStep: profile.styleDistribution.reading_writing > 0.3,\n            prefersExamples: profile.styleDistribution.visual > 0.25 || profile.styleDistribution.kinesthetic > 0.25,\n            prefersInteraction: profile.styleDistribution.kinesthetic > 0.3,\n            prefersVisualAids: profile.styleDistribution.visual > 0.25,\n            prefersVerbalExplanation: profile.styleDistribution.auditory > 0.3\n        };\n        profile.lastUpdated = new Date();\n        profile.interactions++;\n        this.profiles.set(userId, profile);\n        console.log(`📊 Learning profile updated for ${userId}: Primary=${profile.primaryStyle}, Secondary=${profile.secondaryStyle || 'none'}`);\n        return profile;\n    }\n    /**\n   * Creates initial learning profile\n   */ static createInitialProfile(userId) {\n        return {\n            userId,\n            primaryStyle: \"multimodal\",\n            secondaryStyle: undefined,\n            styleDistribution: {\n                visual: 0.25,\n                auditory: 0.25,\n                reading_writing: 0.25,\n                kinesthetic: 0.25\n            },\n            adaptationPreferences: {\n                prefersDiagrams: false,\n                prefersStepByStep: true,\n                prefersExamples: true,\n                prefersInteraction: false,\n                prefersVisualAids: false,\n                prefersVerbalExplanation: false\n            },\n            detectedFrom: {\n                messageAnalysis: 0,\n                behaviorPatterns: 0,\n                explicitPreferences: 0\n            },\n            lastUpdated: new Date(),\n            interactions: 0\n        };\n    }\n    /**\n   * Gets learning profile for user\n   */ static getLearningProfile(userId) {\n        return this.profiles.get(userId) || this.createInitialProfile(userId);\n    }\n    /**\n   * Adapts response content based on learning profile\n   */ static adaptResponseToLearningStyle(content, profile) {\n        let adaptedContent = content;\n        // Visual learner adaptations\n        if (profile.adaptationPreferences.prefersVisualAids) {\n            adaptedContent = this.addVisualElements(adaptedContent, profile);\n        }\n        // Auditory learner adaptations\n        if (profile.adaptationPreferences.prefersVerbalExplanation) {\n            adaptedContent = this.addAuditoryElements(adaptedContent, profile);\n        }\n        // Reading/Writing learner adaptations\n        if (profile.adaptationPreferences.prefersStepByStep) {\n            adaptedContent = this.addStructuredElements(adaptedContent, profile);\n        }\n        // Kinesthetic learner adaptations\n        if (profile.adaptationPreferences.prefersInteraction) {\n            adaptedContent = this.addInteractiveElements(adaptedContent, profile);\n        }\n        return adaptedContent;\n    }\n    /**\n   * Adds visual elements for visual learners\n   */ static addVisualElements(content, profile) {\n        let enhanced = content;\n        // Add visual cues and formatting\n        enhanced = enhanced.replace(/importante:/gi, '🔍 **IMPORTANTE:**');\n        enhanced = enhanced.replace(/nota:/gi, '📝 **NOTA:**');\n        enhanced = enhanced.replace(/ejemplo:/gi, '💡 **EJEMPLO:**');\n        enhanced = enhanced.replace(/resultado:/gi, '✅ **RESULTADO:**');\n        // Add visual separators\n        if (enhanced.includes('paso') || enhanced.includes('step')) {\n            enhanced = enhanced.replace(/paso (\\d+)/gi, '\\n📍 **PASO $1**\\n');\n        }\n        return enhanced;\n    }\n    /**\n   * Adds auditory elements for auditory learners  \n   */ static addAuditoryElements(content, profile) {\n        let enhanced = content;\n        // Add conversational phrases\n        enhanced = \"🗣️ Te voy a explicar esto paso a paso:\\n\\n\" + enhanced;\n        // Add verbal transition phrases\n        enhanced = enhanced.replace(/\\. ([A-Z])/g, '. Ahora, $1');\n        enhanced = enhanced.replace(/:\\n/g, '. Escucha bien:\\n');\n        return enhanced;\n    }\n    /**\n   * Adds structured elements for reading/writing learners\n   */ static addStructuredElements(content, profile) {\n        let enhanced = content;\n        // Add clear structure and bullet points\n        if (!enhanced.includes('**') && enhanced.length > 200) {\n            const sentences = enhanced.split('.');\n            if (sentences.length > 3) {\n                enhanced = sentences.filter((s)=>s.trim().length > 10).map((sentence, index)=>`${index + 1}. ${sentence.trim()}`).join('\\n');\n            }\n        }\n        return enhanced;\n    }\n    /**\n   * Adds interactive elements for kinesthetic learners\n   */ static addInteractiveElements(content, profile) {\n        let enhanced = content;\n        // Add action-oriented language\n        enhanced += \"\\n\\n🎯 **Prueba esto:**\";\n        enhanced += \"\\n• Aplica este concepto a un problema real\";\n        enhanced += \"\\n• Experimenta cambiando los valores\";\n        enhanced += \"\\n• Practica con ejercicios similares\";\n        return enhanced;\n    }\n    /**\n   * Analyzes behavior patterns to enhance profile\n   */ static analyzeBehaviorPatterns(userId) {\n        const userBehaviors = this.behaviors.filter((b)=>b.userId === userId);\n        const profile = this.getLearningProfile(userId);\n        if (userBehaviors.length < 5) return profile;\n        // Analyze patterns in recent behaviors\n        const recentBehaviors = userBehaviors.slice(-20);\n        const styleFrequency = new Map();\n        for (const behavior of recentBehaviors){\n            for (const style of behavior.styleIndicators){\n                styleFrequency.set(style, (styleFrequency.get(style) || 0) + 1);\n            }\n        }\n        // Update profile based on behavioral patterns\n        const indicators = [];\n        for (const [style, frequency] of styleFrequency.entries()){\n            const weight = frequency / recentBehaviors.length;\n            if (weight > 0.1) {\n                indicators.push({\n                    style,\n                    weight,\n                    evidence: [\n                        `Detectado en ${frequency} de ${recentBehaviors.length} interacciones recientes`\n                    ],\n                    confidence: Math.min(weight * 2, 1.0)\n                });\n            }\n        }\n        return this.updateLearningProfile(userId, indicators, 'behavior_analysis');\n    }\n    /**\n   * Gets profile statistics\n   */ static getProfileStatistics(userId) {\n        if (userId) {\n            const profile = this.profiles.get(userId);\n            const behaviors = this.behaviors.filter((b)=>b.userId === userId);\n            return {\n                profile: profile || null,\n                behaviorCount: behaviors.length,\n                recentInteractions: behaviors.filter((b)=>b.timestamp > new Date(Date.now() - 7 * 24 * 60 * 60 * 1000)).length\n            };\n        }\n        return {\n            totalProfiles: this.profiles.size,\n            totalBehaviors: this.behaviors.length,\n            styleDistribution: this.getGlobalStyleDistribution()\n        };\n    }\n    /**\n   * Gets global style distribution\n   */ static getGlobalStyleDistribution() {\n        const distribution = {\n            visual: 0,\n            auditory: 0,\n            reading_writing: 0,\n            kinesthetic: 0,\n            multimodal: 0\n        };\n        for (const profile of this.profiles.values()){\n            switch(profile.primaryStyle){\n                case \"visual\":\n                    distribution.visual++;\n                    break;\n                case \"auditory\":\n                    distribution.auditory++;\n                    break;\n                case \"reading_writing\":\n                    distribution.reading_writing++;\n                    break;\n                case \"kinesthetic\":\n                    distribution.kinesthetic++;\n                    break;\n                case \"multimodal\":\n                    distribution.multimodal++;\n                    break;\n            }\n        }\n        return distribution;\n    }\n    /**\n   * Process user message and update learning profile\n   */ static processUserMessage(userId, message) {\n        // Analyze message for learning style indicators\n        const indicators = this.analyzeMessageForLearningStyle(message, userId);\n        // Update learning profile if indicators found\n        if (indicators.length > 0) {\n            return this.updateLearningProfile(userId, indicators, 'message_processing');\n        }\n        // Analyze behavior patterns periodically\n        const profile = this.getLearningProfile(userId);\n        if (profile.interactions % 10 === 0) {\n            return this.analyzeBehaviorPatterns(userId);\n        }\n        return profile;\n    }\n    /**\n   * Generates learning style recommendations for Sara\n   */ static generateStyleRecommendations(profile) {\n        const recommendations = [];\n        switch(profile.primaryStyle){\n            case \"visual\":\n                recommendations.push(\"Usar diagramas y esquemas cuando explico conceptos\");\n                recommendations.push(\"Incluir ejemplos visuales y gráficos\");\n                recommendations.push(\"Estructurar información con viñetas y colores\");\n                break;\n            case \"auditory\":\n                recommendations.push(\"Explicar conceptos con lenguaje conversacional\");\n                recommendations.push(\"Usar analogías y metáforas verbales\");\n                recommendations.push(\"Incluir discusiones y preguntas abiertas\");\n                break;\n            case \"reading_writing\":\n                recommendations.push(\"Proporcionar información detallada por escrito\");\n                recommendations.push(\"Crear listas y resúmenes estructurados\");\n                recommendations.push(\"Incluir definiciones y descripciones precisas\");\n                break;\n            case \"kinesthetic\":\n                recommendations.push(\"Incluir ejercicios prácticos y actividades\");\n                recommendations.push(\"Sugerir experimentos y aplicaciones reales\");\n                recommendations.push(\"Usar ejemplos concretos y manipulables\");\n                break;\n            case \"multimodal\":\n                recommendations.push(\"Combinar múltiples enfoques de enseñanza\");\n                recommendations.push(\"Adaptar explicaciones según el contexto\");\n                recommendations.push(\"Ofrecer opciones de aprendizaje variadas\");\n                break;\n        }\n        return recommendations;\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvbGliL2FkdmFuY2VkLWxlYXJuaW5nLXByb2ZpbGVzLnRzIiwibWFwcGluZ3MiOiI7Ozs7O0FBQUEsZ0RBQWdEO0FBQ2hELGtHQUFrRztBQUUzRiwyQ0FBS0E7Ozs7OztXQUFBQTtNQU1YO0FBNENNLE1BQU1DOztRQUVYLGdDQUFnQzthQUNqQkMsV0FBeUMsSUFBSUM7OzthQUM3Q0MsWUFBdUMsRUFBRTs7SUFFeEQ7O0dBRUMsR0FDRCxPQUFPQywrQkFBK0JDLE9BQWUsRUFBRUMsTUFBYyxFQUE0QjtRQUMvRixNQUFNQyxXQUFXRixRQUFRRyxXQUFXO1FBQ3BDLE1BQU1DLGFBQXVDLEVBQUU7UUFFL0Msb0JBQW9CO1FBQ3BCLE1BQU1DLGlCQUFpQjtZQUNyQjtZQUFPO1lBQVM7WUFBVztZQUFVO1lBQVc7WUFBWTtZQUFVO1lBQ3RFO1lBQVE7WUFBVztZQUFVO1lBQWU7WUFBUztZQUFXO1lBQ2hFO1lBQVk7WUFBYTtZQUFrQjtTQUM1QztRQUVELE1BQU1DLGdCQUFnQjtZQUNwQjtZQUFnQjtZQUFhO1lBQXFCO1lBQ2xEO1lBQWdCO1lBQWtCO1lBQWtCO1NBQ3JEO1FBRUQsSUFBSUMsY0FBYyxJQUFJLENBQUNDLHFCQUFxQixDQUFDTixVQUFVRyxnQkFBZ0JDO1FBQ3ZFLElBQUlDLGNBQWMsR0FBRztZQUNuQkgsV0FBV0ssSUFBSSxDQUFDO2dCQUNkQyxLQUFLO2dCQUNMQyxRQUFRSjtnQkFDUkssVUFBVSxJQUFJLENBQUNDLGVBQWUsQ0FBQ1gsVUFBVTt1QkFBSUc7dUJBQW1CQztpQkFBYztnQkFDOUVRLFlBQVlDLEtBQUtDLEdBQUcsQ0FBQ1QsY0FBYyxLQUFLO1lBQzFDO1FBQ0Y7UUFFQSxzQkFBc0I7UUFDdEIsTUFBTVUsbUJBQW1CO1lBQ3ZCO1lBQVk7WUFBTztZQUFVO1lBQVk7WUFBUztZQUFVO1lBQzVEO1lBQVU7WUFBVTtZQUFTO1lBQWM7WUFBVztTQUN2RDtRQUVELE1BQU1DLGtCQUFrQjtZQUN0QjtZQUFhO1lBQVk7WUFBbUI7WUFD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UUFBUVcsWUFBWTtZQUMxQjtnQkFDRW1ELGdCQUFnQi9HLElBQUksQ0FBQztnQkFDckIrRyxnQkFBZ0IvRyxJQUFJLENBQUM7Z0JBQ3JCK0csZ0JBQWdCL0csSUFBSSxDQUFDO2dCQUNyQjtZQUVGO2dCQUNFK0csZ0JBQWdCL0csSUFBSSxDQUFDO2dCQUNyQitHLGdCQUFnQi9HLElBQUksQ0FBQztnQkFDckIrRyxnQkFBZ0IvRyxJQUFJLENBQUM7Z0JBQ3JCO1lBRUY7Z0JBQ0UrRyxnQkFBZ0IvRyxJQUFJLENBQUM7Z0JBQ3JCK0csZ0JBQWdCL0csSUFBSSxDQUFDO2dCQUNyQitHLGdCQUFnQi9HLElBQUksQ0FBQztnQkFDckI7WUFFRjtnQkFDRStHLGdCQUFnQi9HLElBQUksQ0FBQztnQkFDckIrRyxnQkFBZ0IvRyxJQUFJLENBQUM7Z0JBQ3JCK0csZ0JBQWdCL0csSUFBSSxDQUFDO2dCQUNyQjtZQUVGO2dCQUNFK0csZ0JBQWdCL0csSUFBSSxDQUFDO2dCQUNyQitHLGdCQUFnQi9HLElBQUksQ0FBQztnQkFDckIrRyxnQkFBZ0IvRyxJQUFJLENBQUM7Z0JBQ3JCO1FBQ0o7UUFFQSxPQUFPK0c7SUFDVDtBQUNGIiwic291cmNlcyI6WyIvVXNlcnMvcm9kcmlnb2RpYmVybmFyZG8zM2dtYWlsLmNvbS9Eb2N1bWVudHMvQXBwIERldmVsb3BtZW50IFByb3llY3RzL0ludGVsbGVnbyBQbGF0Zm9ybS9zcmMvbGliL2FkdmFuY2VkLWxlYXJuaW5nLXByb2ZpbGVzLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIEFkdmFuY2VkIExlYXJuaW5nIFByb2ZpbGVzIFN5c3RlbSBmb3IgU2FyYSBBSVxuLy8gSW1wbGVtZW50cyBWQVJLIG1vZGVsIChWaXN1YWwsIEF1ZGl0b3J5LCBSZWFkaW5nL1dyaXRpbmcsIEtpbmVzdGhldGljKSB3aXRoIGF1dG9tYXRpYyBkZXRlY3Rpb25cblxuZXhwb3J0IGVudW0gTGVhcm5pbmdTdHlsZSB7XG4gIFZJU1VBTCA9ICd2aXN1YWwnLFxuICBBVURJVE9SWSA9ICdhdWRpdG9yeScsXG4gIFJFQURJTkdfV1JJVElORyA9ICdyZWFkaW5nX3dyaXRpbmcnLCBcbiAgS0lORVNUSEVUSUMgPSAna2luZXN0aGV0aWMnLFxuICBNVUxUSU1PREFMID0gJ211bHRpbW9kYWwnXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgTGVhcm5pbmdTdHlsZUluZGljYXRvciB7XG4gIHN0eWxlOiBMZWFybmluZ1N0eWxlXG4gIHdlaWdodDogbnVtYmVyIC8vIDAuMCB0byAxLjBcbiAgZXZpZGVuY2U6IHN0cmluZ1tdXG4gIGNvbmZpZGVuY2U6IG51bWJlciAvLyAwLjAgdG8gMS4wXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgTGVhcm5pbmdQcm9maWxlIHtcbiAgdXNlcklkOiBzdHJpbmdcbiAgcHJpbWFyeVN0eWxlOiBMZWFybmluZ1N0eWxlXG4gIHNlY29uZGFyeVN0eWxlPzogTGVhcm5pbmdTdHlsZVxuICBzdHlsZURpc3RyaWJ1dGlvbjoge1xuICAgIHZpc3VhbDogbnVtYmVyXG4gICAgYXVkaXRvcnk6IG51bWJlclxuICAgIHJlYWRpbmdfd3JpdGluZzogbnVtYmVyXG4gICAga2luZXN0aGV0aWM6IG51bWJlclxuICB9XG4gIGFkYXB0YXRpb25QcmVmZXJlbmNlczoge1xuICAgIHByZWZlcnNEaWFncmFtczogYm9vbGVhblxuICAgIHByZWZlcnNTdGVwQnlTdGVwOiBib29sZWFuXG4gICAgcHJlZmVyc0V4YW1wbGVzOiBib29sZWFuXG4gICAgcHJlZmVyc0ludGVyYWN0aW9uOiBib29sZWFuXG4gICAgcHJlZmVyc1Zpc3VhbEFpZHM6IGJvb2xlYW5cbiAgICBwcmVmZXJzVmVyYmFsRXhwbGFuYXRpb246IGJvb2xlYW5cbiAgfVxuICBkZXRlY3RlZEZyb206IHtcbiAgICBtZXNzYWdlQW5hbHlzaXM6IG51bWJlclxuICAgIGJlaGF2aW9yUGF0dGVybnM6IG51bWJlclxuICAgIGV4cGxpY2l0UHJlZmVyZW5jZXM6IG51bWJlclxuICB9XG4gIGxhc3RVcGRhdGVkOiBEYXRlXG4gIGludGVyYWN0aW9uczogbnVtYmVyXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgTGVhcm5pbmdCZWhhdmlvclBhdHRlcm4ge1xuICB1c2VySWQ6IHN0cmluZ1xuICB0aW1lc3RhbXA6IERhdGVcbiAgYWN0aW9uOiBzdHJpbmdcbiAgY29udGV4dDogc3RyaW5nXG4gIHN0eWxlSW5kaWNhdG9yczogTGVhcm5pbmdTdHlsZVtdXG59XG5cbmV4cG9ydCBjbGFzcyBBZHZhbmNlZExlYXJuaW5nUHJvZmlsZU1hbmFnZXIge1xuICBcbiAgLy8gU3RvcmFnZSBmb3IgbGVhcm5pbmcgcHJvZmlsZXNcbiAgcHJpdmF0ZSBzdGF0aWMgcHJvZmlsZXM6IE1hcDxzdHJpbmcsIExlYXJuaW5nUHJvZmlsZT4gPSBuZXcgTWFwKClcbiAgcHJpdmF0ZSBzdGF0aWMgYmVoYXZpb3JzOiBMZWFybmluZ0JlaGF2aW9yUGF0dGVybltdID0gW11cblxuICAvKipcbiAgICogQW5hbHl6ZXMgdXNlciBtZXNzYWdlIGZvciBsZWFybmluZyBzdHlsZSBpbmRpY2F0b3JzXG4gICAqL1xuICBzdGF0aWMgYW5hbHl6ZU1lc3NhZ2VGb3JMZWFybmluZ1N0eWxlKG1lc3NhZ2U6IHN0cmluZywgdXNlcklkOiBzdHJpbmcpOiBMZWFybmluZ1N0eWxlSW5kaWNhdG9yW10ge1xuICAgIGNvbnN0IG1zZ0xvd2VyID0gbWVzc2FnZS50b0xvd2VyQ2FzZSgpXG4gICAgY29uc3QgaW5kaWNhdG9yczogTGVhcm5pbmdTdHlsZUluZGljYXRvcltdID0gW11cblxuICAgIC8vIFZJU1VBTCBpbmRpY2F0b3JzXG4gICAgY29uc3QgdmlzdWFsS2V5d29yZHMgPSBbXG4gICAgICAndmVyJywgJ21pcmFyJywgJ21vc3RyYXInLCAnaW1hZ2VuJywgJ2dyw6FmaWNvJywgJ2RpYWdyYW1hJywgJ3Zpc3VhbCcsICdjb2xvcicsXG4gICAgICAnbWFwYScsICdlc3F1ZW1hJywgJ2RpYnVqbycsICdpbHVzdHJhY2nDs24nLCAndGFibGEnLCAnZ3LDoWZpY2EnLCAndmlzdWFsaXphcicsXG4gICAgICAnb2JzZXJ2YXInLCAnZGVtb3N0cmFyJywgJ2VqZW1wbG8gdmlzdWFsJywgJ2NsYXJhbWVudGUnXG4gICAgXVxuICAgIFxuICAgIGNvbnN0IHZpc3VhbFBocmFzZXMgPSBbXG4gICAgICAnbWUgZ3VzdGEgdmVyJywgJ211w6lzdHJhbWUnLCAncXXDqSBhc3BlY3RvIHRpZW5lJywgJ2PDs21vIHNlIHZlJyxcbiAgICAgICduZWNlc2l0byB2ZXInLCAncHVlZGVzIG1vc3RyYXInLCAnZWplbXBsbyB2aXN1YWwnLCAnZGUgZm9ybWEgZ3LDoWZpY2EnXG4gICAgXVxuICAgIFxuICAgIGxldCB2aXN1YWxTY29yZSA9IHRoaXMuY2FsY3VsYXRlS2V5d29yZFNjb3JlKG1zZ0xvd2VyLCB2aXN1YWxLZXl3b3JkcywgdmlzdWFsUGhyYXNlcylcbiAgICBpZiAodmlzdWFsU2NvcmUgPiAwKSB7XG4gICAgICBpbmRpY2F0b3JzLnB1c2goe1xuICAgICAgICBzdHlsZTogTGVhcm5pbmdTdHlsZS5WSVNVQUwsXG4gICAgICAgIHdlaWdodDogdmlzdWFsU2NvcmUsXG4gICAgICAgIGV2aWRlbmNlOiB0aGlzLmV4dHJhY3RFdmlkZW5jZShtc2dMb3dlciwgWy4uLnZpc3VhbEtleXdvcmRzLCAuLi52aXN1YWxQaHJhc2VzXSksXG4gICAgICAgIGNvbmZpZGVuY2U6IE1hdGgubWluKHZpc3VhbFNjb3JlICogMS4yLCAxLjApXG4gICAgICB9KVxuICAgIH1cblxuICAgIC8vIEFVRElUT1JZIGluZGljYXRvcnNcbiAgICBjb25zdCBhdWRpdG9yeUtleXdvcmRzID0gW1xuICAgICAgJ2VzY3VjaGFyJywgJ2/DrXInLCAnc29uaWRvJywgJ2V4cGxpY2FyJywgJ2RlY2lyJywgJ2NvbnRhcicsICdkaXNjdXRpcicsXG4gICAgICAnaGFibGFyJywgJ3ZlcmJhbCcsICdhdWRpbycsICdwcm9udW5jaWFyJywgJ3JlcGV0aXInLCAncHJlZ3VudGFyJ1xuICAgIF1cbiAgICBcbiAgICBjb25zdCBhdWRpdG9yeVBocmFzZXMgPSBbXG4gICAgICAnZXhwbMOtY2FtZScsICdjdcOpbnRhbWUnLCAnbWUgcHVlZGVzIGRlY2lyJywgJ25lY2VzaXRvIHF1ZSBtZSBleHBsaXF1ZXMnLFxuICAgICAgJ3JlcMOtdGVsbycsICdlbiBwYWxhYnJhcycsICdkZSBmb3JtYSB2ZXJiYWwnLCAnaGFibGVtb3MgZGUnXG4gICAgXVxuICAgIFxuICAgIGxldCBhdWRpdG9yeVNjb3JlID0gdGhpcy5jYWxjdWxhdGVLZXl3b3JkU2NvcmUobXNnTG93ZXIsIGF1ZGl0b3J5S2V5d29yZHMsIGF1ZGl0b3J5UGhyYXNlcylcbiAgICBpZiAoYXVkaXRvcnlTY29yZSA+IDApIHtcbiAgICAgIGluZGljYXRvcnMucHVzaCh7XG4gICAgICAgIHN0eWxlOiBMZWFybmluZ1N0eWxlLkFVRElUT1JZLFxuICAgICAgICB3ZWlnaHQ6IGF1ZGl0b3J5U2NvcmUsXG4gICAgICAgIGV2aWRlbmNlOiB0aGlzLmV4dHJhY3RFdmlkZW5jZShtc2dMb3dlciwgWy4uLmF1ZGl0b3J5S2V5d29yZHMsIC4uLmF1ZGl0b3J5UGhyYXNlc10pLFxuICAgICAgICBjb25maWRlbmNlOiBNYXRoLm1pbihhdWRpdG9yeVNjb3JlICogMS4xLCAxLjApXG4gICAgICB9KVxuICAgIH1cblxuICAgIC8vIFJFQURJTkcvV1JJVElORyBpbmRpY2F0b3JzXG4gICAgY29uc3QgcmVhZFdyaXRlS2V5d29yZHMgPSBbXG4gICAgICAnbGVlcicsICdlc2NyaWJpcicsICd0ZXh0bycsICdub3RhJywgJ2xpc3RhJywgJ2RlZmluaWNpw7NuJywgJ3Jlc3VtZW4nLFxuICAgICAgJ2FwdW50ZXMnLCAnZG9jdW1lbnRvJywgJ2FydMOtY3VsbycsICdww6FycmFmbycsICdkZXNjcmlwY2nDs24nLCAnZGV0YWxsZXMnXG4gICAgXVxuICAgIFxuICAgIGNvbnN0IHJlYWRXcml0ZVBocmFzZXMgPSBbXG4gICAgICAnZW4gdGV4dG8nLCAncG9yIGVzY3JpdG8nLCAnZGFtZSBkZXRhbGxlcycsICduZWNlc2l0byBsZWVyJyxcbiAgICAgICdxdWllcm8gZXN0dWRpYXInLCAnaW5mb3JtYWNpw7NuIGRldGFsbGFkYScsICdwYXNvIGEgcGFzbycsICdsaXN0YSBkZSdcbiAgICBdXG4gICAgXG4gICAgbGV0IHJlYWRXcml0ZVNjb3JlID0gdGhpcy5jYWxjdWxhdGVLZXl3b3JkU2NvcmUobXNnTG93ZXIsIHJlYWRXcml0ZUtleXdvcmRzLCByZWFkV3JpdGVQaHJhc2VzKVxuICAgIGlmIChyZWFkV3JpdGVTY29yZSA+IDApIHtcbiAgICAgIGluZGljYXRvcnMucHVzaCh7XG4gICAgICAgIHN0eWxlOiBMZWFybmluZ1N0eWxlLlJFQURJTkdfV1JJVElORyxcbiAgICAgICAgd2VpZ2h0OiByZWFkV3JpdGVTY29yZSxcbiAgICAgICAgZXZpZGVuY2U6IHRoaXMuZXh0cmFjdEV2aWRlbmNlKG1zZ0xvd2VyLCBbLi4ucmVhZFdyaXRlS2V5d29yZHMsIC4uLnJlYWRXcml0ZVBocmFzZXNdKSxcbiAgICAgICAgY29uZmlkZW5jZTogTWF0aC5taW4ocmVhZFdyaXRlU2NvcmUsIDEuMClcbiAgICAgIH0pXG4gICAgfVxuXG4gICAgLy8gS0lORVNUSEVUSUMgaW5kaWNhdG9yc1xuICAgIGNvbnN0IGtpbmVzdGhldGljS2V5d29yZHMgPSBbXG4gICAgICAnaGFjZXInLCAncHJhY3RpY2FyJywgJ2VqZXJjaWNpbycsICdhY3RpdmlkYWQnLCAnbWFubycsICd0b2NhcicsICdtb3ZlcicsXG4gICAgICAnZXhwZXJpbWVudGFyJywgJ3Byb2JhcicsICdtYW5pcHVsYXInLCAnY29uc3RydWlyJywgJ2NyZWFyJywgJ2ludGVyYWN0aXZvJ1xuICAgIF1cbiAgICBcbiAgICBjb25zdCBraW5lc3RoZXRpY1BocmFzZXMgPSBbXG4gICAgICAncXVpZXJvIGhhY2VyJywgJ25lY2VzaXRvIHByYWN0aWNhcicsICdoYW5kcyBvbicsICdkZSBmb3JtYSBwcsOhY3RpY2EnLFxuICAgICAgJ2V4cGVyaW1lbnRhbmRvJywgJ3Byb2JhbmRvJywgJ2hhY2llbmRvIGVqZXJjaWNpb3MnLCAnYWN0aXZpZGFkZXMnXG4gICAgXVxuICAgIFxuICAgIGxldCBraW5lc3RoZXRpY1Njb3JlID0gdGhpcy5jYWxjdWxhdGVLZXl3b3JkU2NvcmUobXNnTG93ZXIsIGtpbmVzdGhldGljS2V5d29yZHMsIGtpbmVzdGhldGljUGhyYXNlcylcbiAgICBpZiAoa2luZXN0aGV0aWNTY29yZSA+IDApIHtcbiAgICAgIGluZGljYXRvcnMucHVzaCh7XG4gICAgICAgIHN0eWxlOiBMZWFybmluZ1N0eWxlLktJTkVTVEhFVElDLFxuICAgICAgICB3ZWlnaHQ6IGtpbmVzdGhldGljU2NvcmUsXG4gICAgICAgIGV2aWRlbmNlOiB0aGlzLmV4dHJhY3RFdmlkZW5jZShtc2dMb3dlciwgWy4uLmtpbmVzdGhldGljS2V5d29yZHMsIC4uLmtpbmVzdGhldGljUGhyYXNlc10pLFxuICAgICAgICBjb25maWRlbmNlOiBNYXRoLm1pbihraW5lc3RoZXRpY1Njb3JlICogMS4zLCAxLjApXG4gICAgICB9KVxuICAgIH1cblxuICAgIC8vIFJlY29yZCBiZWhhdmlvciBwYXR0ZXJuXG4gICAgaWYgKGluZGljYXRvcnMubGVuZ3RoID4gMCkge1xuICAgICAgdGhpcy5yZWNvcmRCZWhhdmlvclBhdHRlcm4odXNlcklkLCAnbWVzc2FnZV9hbmFseXNpcycsIG1lc3NhZ2UsIFxuICAgICAgICBpbmRpY2F0b3JzLm1hcChpID0+IGkuc3R5bGUpKVxuICAgIH1cblxuICAgIHJldHVybiBpbmRpY2F0b3JzLnNvcnQoKGEsIGIpID0+IGIud2VpZ2h0IC0gYS53ZWlnaHQpXG4gIH1cblxuICAvKipcbiAgICogQ2FsY3VsYXRlcyBzY29yZSBiYXNlZCBvbiBrZXl3b3JkIGFuZCBwaHJhc2UgbWF0Y2hlc1xuICAgKi9cbiAgcHJpdmF0ZSBzdGF0aWMgY2FsY3VsYXRlS2V5d29yZFNjb3JlKHRleHQ6IHN0cmluZywga2V5d29yZHM6IHN0cmluZ1tdLCBwaHJhc2VzOiBzdHJpbmdbXSk6IG51bWJlciB7XG4gICAgbGV0IHNjb3JlID0gMFxuICAgIFxuICAgIC8vIEtleXdvcmQgbWF0Y2hlcyAobG93ZXIgd2VpZ2h0KVxuICAgIGZvciAoY29uc3Qga2V5d29yZCBvZiBrZXl3b3Jkcykge1xuICAgICAgaWYgKHRleHQuaW5jbHVkZXMoa2V5d29yZCkpIHtcbiAgICAgICAgc2NvcmUgKz0gMC4xXG4gICAgICB9XG4gICAgfVxuICAgIFxuICAgIC8vIFBocmFzZSBtYXRjaGVzIChoaWdoZXIgd2VpZ2h0KVxuICAgIGZvciAoY29uc3QgcGhyYXNlIG9mIHBocmFzZXMpIHtcbiAgICAgIGlmICh0ZXh0LmluY2x1ZGVzKHBocmFzZSkpIHtcbiAgICAgICAgc2NvcmUgKz0gMC4zXG4gICAgICB9XG4gICAgfVxuICAgIFxuICAgIHJldHVybiBNYXRoLm1pbihzY29yZSwgMS4wKVxuICB9XG5cbiAgLyoqXG4gICAqIEV4dHJhY3RzIGV2aWRlbmNlIGZyb20gdGV4dFxuICAgKi9cbiAgcHJpdmF0ZSBzdGF0aWMgZXh0cmFjdEV2aWRlbmNlKHRleHQ6IHN0cmluZywgcGF0dGVybnM6IHN0cmluZ1tdKTogc3RyaW5nW10ge1xuICAgIGNvbnN0IGV2aWRlbmNlOiBzdHJpbmdbXSA9IFtdXG4gICAgXG4gICAgZm9yIChjb25zdCBwYXR0ZXJuIG9mIHBhdHRlcm5zKSB7XG4gICAgICBpZiAodGV4dC5pbmNsdWRlcyhwYXR0ZXJuKSkge1xuICAgICAgICAvLyBFeHRyYWN0IHNlbnRlbmNlIGNvbnRhaW5pbmcgdGhlIHBhdHRlcm5cbiAgICAgICAgY29uc3Qgc2VudGVuY2VzID0gdGV4dC5zcGxpdCgvWy4hP10rLylcbiAgICAgICAgY29uc3QgbWF0Y2hpbmdTZW50ZW5jZSA9IHNlbnRlbmNlcy5maW5kKHNlbnRlbmNlID0+IFxuICAgICAgICAgIHNlbnRlbmNlLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMocGF0dGVybikpXG4gICAgICAgIGlmIChtYXRjaGluZ1NlbnRlbmNlKSB7XG4gICAgICAgICAgZXZpZGVuY2UucHVzaChtYXRjaGluZ1NlbnRlbmNlLnRyaW0oKSlcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICBcbiAgICByZXR1cm4gZXZpZGVuY2Uuc2xpY2UoMCwgMykgLy8gTGltaXQgdG8gMyBwaWVjZXMgb2YgZXZpZGVuY2VcbiAgfVxuXG4gIC8qKlxuICAgKiBSZWNvcmRzIGEgbGVhcm5pbmcgYmVoYXZpb3IgcGF0dGVyblxuICAgKi9cbiAgc3RhdGljIHJlY29yZEJlaGF2aW9yUGF0dGVybih1c2VySWQ6IHN0cmluZywgYWN0aW9uOiBzdHJpbmcsIGNvbnRleHQ6IHN0cmluZywgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3R5bGVJbmRpY2F0b3JzOiBMZWFybmluZ1N0eWxlW10pIHtcbiAgICB0aGlzLmJlaGF2aW9ycy5wdXNoKHtcbiAgICAgIHVzZXJJZCxcbiAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKSxcbiAgICAgIGFjdGlvbixcbiAgICAgIGNvbnRleHQsXG4gICAgICBzdHlsZUluZGljYXRvcnNcbiAgICB9KVxuXG4gICAgLy8gS2VlcCBvbmx5IHJlY2VudCBiZWhhdmlvcnMgKGxhc3QgMTAwIHBlciB1c2VyKVxuICAgIGNvbnN0IHVzZXJCZWhhdmlvcnMgPSB0aGlzLmJlaGF2aW9ycy5maWx0ZXIoYiA9PiBiLnVzZXJJZCA9PT0gdXNlcklkKVxuICAgIGlmICh1c2VyQmVoYXZpb3JzLmxlbmd0aCA+IDEwMCkge1xuICAgICAgdGhpcy5iZWhhdmlvcnMgPSB0aGlzLmJlaGF2aW9ycy5maWx0ZXIoYiA9PiBiLnVzZXJJZCAhPT0gdXNlcklkKVxuICAgICAgICAuY29uY2F0KHVzZXJCZWhhdmlvcnMuc2xpY2UoLTEwMCkpXG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFVwZGF0ZXMgb3IgY3JlYXRlcyBsZWFybmluZyBwcm9maWxlIGZvciB1c2VyXG4gICAqL1xuICBzdGF0aWMgdXBkYXRlTGVhcm5pbmdQcm9maWxlKHVzZXJJZDogc3RyaW5nLCBpbmRpY2F0b3JzOiBMZWFybmluZ1N0eWxlSW5kaWNhdG9yW10sIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRleHQ/OiBzdHJpbmcpOiBMZWFybmluZ1Byb2ZpbGUge1xuICAgIGxldCBwcm9maWxlID0gdGhpcy5wcm9maWxlcy5nZXQodXNlcklkKSB8fCB0aGlzLmNyZWF0ZUluaXRpYWxQcm9maWxlKHVzZXJJZClcblxuICAgIC8vIFVwZGF0ZSBzdHlsZSBkaXN0cmlidXRpb24gYmFzZWQgb24gbmV3IGluZGljYXRvcnNcbiAgICBmb3IgKGNvbnN0IGluZGljYXRvciBvZiBpbmRpY2F0b3JzKSB7XG4gICAgICBjb25zdCB3ZWlnaHQgPSBpbmRpY2F0b3Iud2VpZ2h0ICogaW5kaWNhdG9yLmNvbmZpZGVuY2VcbiAgICAgIFxuICAgICAgc3dpdGNoIChpbmRpY2F0b3Iuc3R5bGUpIHtcbiAgICAgICAgY2FzZSBMZWFybmluZ1N0eWxlLlZJU1VBTDpcbiAgICAgICAgICBwcm9maWxlLnN0eWxlRGlzdHJpYnV0aW9uLnZpc3VhbCA9IE1hdGgubWluKFxuICAgICAgICAgICAgcHJvZmlsZS5zdHlsZURpc3RyaWJ1dGlvbi52aXN1YWwgKyB3ZWlnaHQgKiAwLjEsIDEuMClcbiAgICAgICAgICBicmVha1xuICAgICAgICBjYXNlIExlYXJuaW5nU3R5bGUuQVVESVRPUlk6XG4gICAgICAgICAgcHJvZmlsZS5zdHlsZURpc3RyaWJ1dGlvbi5hdWRpdG9yeSA9IE1hdGgubWluKFxuICAgICAgICAgICAgcHJvZmlsZS5zdHlsZURpc3RyaWJ1dGlvbi5hdWRpdG9yeSArIHdlaWdodCAqIDAuMSwgMS4wKVxuICAgICAgICAgIGJyZWFrXG4gICAgICAgIGNhc2UgTGVhcm5pbmdTdHlsZS5SRUFESU5HX1dSSVRJTkc6XG4gICAgICAgICAgcHJvZmlsZS5zdHlsZURpc3RyaWJ1dGlvbi5yZWFkaW5nX3dyaXRpbmcgPSBNYXRoLm1pbihcbiAgICAgICAgICAgIHByb2ZpbGUuc3R5bGVEaXN0cmlidXRpb24ucmVhZGluZ193cml0aW5nICsgd2VpZ2h0ICogMC4xLCAxLjApXG4gICAgICAgICAgYnJlYWtcbiAgICAgICAgY2FzZSBMZWFybmluZ1N0eWxlLktJTkVTVEhFVElDOlxuICAgICAgICAgIHByb2ZpbGUuc3R5bGVEaXN0cmlidXRpb24ua2luZXN0aGV0aWMgPSBNYXRoLm1pbihcbiAgICAgICAgICAgIHByb2ZpbGUuc3R5bGVEaXN0cmlidXRpb24ua2luZXN0aGV0aWMgKyB3ZWlnaHQgKiAwLjEsIDEuMClcbiAgICAgICAgICBicmVha1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vIE5vcm1hbGl6ZSBkaXN0cmlidXRpb25cbiAgICBjb25zdCB0b3RhbCA9IHByb2ZpbGUuc3R5bGVEaXN0cmlidXRpb24udmlzdWFsICsgXG4gICAgICAgICAgICAgICAgICBwcm9maWxlLnN0eWxlRGlzdHJpYnV0aW9uLmF1ZGl0b3J5ICtcbiAgICAgICAgICAgICAgICAgIHByb2ZpbGUuc3R5bGVEaXN0cmlidXRpb24ucmVhZGluZ193cml0aW5nICsgXG4gICAgICAgICAgICAgICAgICBwcm9maWxlLnN0eWxlRGlzdHJpYnV0aW9uLmtpbmVzdGhldGljXG5cbiAgICBpZiAodG90YWwgPiAwKSB7XG4gICAgICBwcm9maWxlLnN0eWxlRGlzdHJpYnV0aW9uLnZpc3VhbCAvPSB0b3RhbFxuICAgICAgcHJvZmlsZS5zdHlsZURpc3RyaWJ1dGlvbi5hdWRpdG9yeSAvPSB0b3RhbFxuICAgICAgcHJvZmlsZS5zdHlsZURpc3RyaWJ1dGlvbi5yZWFkaW5nX3dyaXRpbmcgLz0gdG90YWxcbiAgICAgIHByb2ZpbGUuc3R5bGVEaXN0cmlidXRpb24ua2luZXN0aGV0aWMgLz0gdG90YWxcbiAgICB9XG5cbiAgICAvLyBEZXRlcm1pbmUgcHJpbWFyeSBhbmQgc2Vjb25kYXJ5IHN0eWxlc1xuICAgIGNvbnN0IHN0eWxlcyA9IFtcbiAgICAgIHsgc3R5bGU6IExlYXJuaW5nU3R5bGUuVklTVUFMLCBzY29yZTogcHJvZmlsZS5zdHlsZURpc3RyaWJ1dGlvbi52aXN1YWwgfSxcbiAgICAgIHsgc3R5bGU6IExlYXJuaW5nU3R5bGUuQVVESVRPUlksIHNjb3JlOiBwcm9maWxlLnN0eWxlRGlzdHJpYnV0aW9uLmF1ZGl0b3J5IH0sXG4gICAgICB7IHN0eWxlOiBMZWFybmluZ1N0eWxlLlJFQURJTkdfV1JJVElORywgc2NvcmU6IHByb2ZpbGUuc3R5bGVEaXN0cmlidXRpb24ucmVhZGluZ193cml0aW5nIH0sXG4gICAgICB7IHN0eWxlOiBMZWFybmluZ1N0eWxlLktJTkVTVEhFVElDLCBzY29yZTogcHJvZmlsZS5zdHlsZURpc3RyaWJ1dGlvbi5raW5lc3RoZXRpYyB9XG4gICAgXS5zb3J0KChhLCBiKSA9PiBiLnNjb3JlIC0gYS5zY29yZSlcblxuICAgIHByb2ZpbGUucHJpbWFyeVN0eWxlID0gc3R5bGVzWzBdLnNjb3JlID4gMC4zNSA/IHN0eWxlc1swXS5zdHlsZSA6IExlYXJuaW5nU3R5bGUuTVVMVElNT0RBTFxuICAgIHByb2ZpbGUuc2Vjb25kYXJ5U3R5bGUgPSBzdHlsZXNbMV0uc2NvcmUgPiAwLjI1ID8gc3R5bGVzWzFdLnN0eWxlIDogdW5kZWZpbmVkXG5cbiAgICAvLyBVcGRhdGUgYWRhcHRhdGlvbiBwcmVmZXJlbmNlc1xuICAgIHByb2ZpbGUuYWRhcHRhdGlvblByZWZlcmVuY2VzID0ge1xuICAgICAgcHJlZmVyc0RpYWdyYW1zOiBwcm9maWxlLnN0eWxlRGlzdHJpYnV0aW9uLnZpc3VhbCA+IDAuMyxcbiAgICAgIHByZWZlcnNTdGVwQnlTdGVwOiBwcm9maWxlLnN0eWxlRGlzdHJpYnV0aW9uLnJlYWRpbmdfd3JpdGluZyA+IDAuMyxcbiAgICAgIHByZWZlcnNFeGFtcGxlczogcHJvZmlsZS5zdHlsZURpc3RyaWJ1dGlvbi52aXN1YWwgPiAwLjI1IHx8IFxuICAgICAgICAgICAgICAgICAgICAgICBwcm9maWxlLnN0eWxlRGlzdHJpYnV0aW9uLmtpbmVzdGhldGljID4gMC4yNSxcbiAgICAgIHByZWZlcnNJbnRlcmFjdGlvbjogcHJvZmlsZS5zdHlsZURpc3RyaWJ1dGlvbi5raW5lc3RoZXRpYyA+IDAuMyxcbiAgICAgIHByZWZlcnNWaXN1YWxBaWRzOiBwcm9maWxlLnN0eWxlRGlzdHJpYnV0aW9uLnZpc3VhbCA+IDAuMjUsXG4gICAgICBwcmVmZXJzVmVyYmFsRXhwbGFuYXRpb246IHByb2ZpbGUuc3R5bGVEaXN0cmlidXRpb24uYXVkaXRvcnkgPiAwLjNcbiAgICB9XG5cbiAgICBwcm9maWxlLmxhc3RVcGRhdGVkID0gbmV3IERhdGUoKVxuICAgIHByb2ZpbGUuaW50ZXJhY3Rpb25zKytcbiAgICBcbiAgICB0aGlzLnByb2ZpbGVzLnNldCh1c2VySWQsIHByb2ZpbGUpXG4gICAgXG4gICAgY29uc29sZS5sb2coYPCfk4ogTGVhcm5pbmcgcHJvZmlsZSB1cGRhdGVkIGZvciAke3VzZXJJZH06IFByaW1hcnk9JHtwcm9maWxlLnByaW1hcnlTdHlsZX0sIFNlY29uZGFyeT0ke3Byb2ZpbGUuc2Vjb25kYXJ5U3R5bGUgfHwgJ25vbmUnfWApXG4gICAgXG4gICAgcmV0dXJuIHByb2ZpbGVcbiAgfVxuXG4gIC8qKlxuICAgKiBDcmVhdGVzIGluaXRpYWwgbGVhcm5pbmcgcHJvZmlsZVxuICAgKi9cbiAgcHJpdmF0ZSBzdGF0aWMgY3JlYXRlSW5pdGlhbFByb2ZpbGUodXNlcklkOiBzdHJpbmcpOiBMZWFybmluZ1Byb2ZpbGUge1xuICAgIHJldHVybiB7XG4gICAgICB1c2VySWQsXG4gICAgICBwcmltYXJ5U3R5bGU6IExlYXJuaW5nU3R5bGUuTVVMVElNT0RBTCxcbiAgICAgIHNlY29uZGFyeVN0eWxlOiB1bmRlZmluZWQsXG4gICAgICBzdHlsZURpc3RyaWJ1dGlvbjoge1xuICAgICAgICB2aXN1YWw6IDAuMjUsXG4gICAgICAgIGF1ZGl0b3J5OiAwLjI1LFxuICAgICAgICByZWFkaW5nX3dyaXRpbmc6IDAuMjUsXG4gICAgICAgIGtpbmVzdGhldGljOiAwLjI1XG4gICAgICB9LFxuICAgICAgYWRhcHRhdGlvblByZWZlcmVuY2VzOiB7XG4gICAgICAgIHByZWZlcnNEaWFncmFtczogZmFsc2UsXG4gICAgICAgIHByZWZlcnNTdGVwQnlTdGVwOiB0cnVlLFxuICAgICAgICBwcmVmZXJzRXhhbXBsZXM6IHRydWUsXG4gICAgICAgIHByZWZlcnNJbnRlcmFjdGlvbjogZmFsc2UsXG4gICAgICAgIHByZWZlcnNWaXN1YWxBaWRzOiBmYWxzZSxcbiAgICAgICAgcHJlZmVyc1ZlcmJhbEV4cGxhbmF0aW9uOiBmYWxzZVxuICAgICAgfSxcbiAgICAgIGRldGVjdGVkRnJvbToge1xuICAgICAgICBtZXNzYWdlQW5hbHlzaXM6IDAsXG4gICAgICAgIGJlaGF2aW9yUGF0dGVybnM6IDAsXG4gICAgICAgIGV4cGxpY2l0UHJlZmVyZW5jZXM6IDBcbiAgICAgIH0sXG4gICAgICBsYXN0VXBkYXRlZDogbmV3IERhdGUoKSxcbiAgICAgIGludGVyYWN0aW9uczogMFxuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBHZXRzIGxlYXJuaW5nIHByb2ZpbGUgZm9yIHVzZXJcbiAgICovXG4gIHN0YXRpYyBnZXRMZWFybmluZ1Byb2ZpbGUodXNlcklkOiBzdHJpbmcpOiBMZWFybmluZ1Byb2ZpbGUge1xuICAgIHJldHVybiB0aGlzLnByb2ZpbGVzLmdldCh1c2VySWQpIHx8IHRoaXMuY3JlYXRlSW5pdGlhbFByb2ZpbGUodXNlcklkKVxuICB9XG5cbiAgLyoqXG4gICAqIEFkYXB0cyByZXNwb25zZSBjb250ZW50IGJhc2VkIG9uIGxlYXJuaW5nIHByb2ZpbGVcbiAgICovXG4gIHN0YXRpYyBhZGFwdFJlc3BvbnNlVG9MZWFybmluZ1N0eWxlKGNvbnRlbnQ6IHN0cmluZywgcHJvZmlsZTogTGVhcm5pbmdQcm9maWxlKTogc3RyaW5nIHtcbiAgICBsZXQgYWRhcHRlZENvbnRlbnQgPSBjb250ZW50XG5cbiAgICAvLyBWaXN1YWwgbGVhcm5lciBhZGFwdGF0aW9uc1xuICAgIGlmIChwcm9maWxlLmFkYXB0YXRpb25QcmVmZXJlbmNlcy5wcmVmZXJzVmlzdWFsQWlkcykge1xuICAgICAgYWRhcHRlZENvbnRlbnQgPSB0aGlzLmFkZFZpc3VhbEVsZW1lbnRzKGFkYXB0ZWRDb250ZW50LCBwcm9maWxlKVxuICAgIH1cblxuICAgIC8vIEF1ZGl0b3J5IGxlYXJuZXIgYWRhcHRhdGlvbnNcbiAgICBpZiAocHJvZmlsZS5hZGFwdGF0aW9uUHJlZmVyZW5jZXMucHJlZmVyc1ZlcmJhbEV4cGxhbmF0aW9uKSB7XG4gICAgICBhZGFwdGVkQ29udGVudCA9IHRoaXMuYWRkQXVkaXRvcnlFbGVtZW50cyhhZGFwdGVkQ29udGVudCwgcHJvZmlsZSlcbiAgICB9XG5cbiAgICAvLyBSZWFkaW5nL1dyaXRpbmcgbGVhcm5lciBhZGFwdGF0aW9uc1xuICAgIGlmIChwcm9maWxlLmFkYXB0YXRpb25QcmVmZXJlbmNlcy5wcmVmZXJzU3RlcEJ5U3RlcCkge1xuICAgICAgYWRhcHRlZENvbnRlbnQgPSB0aGlzLmFkZFN0cnVjdHVyZWRFbGVtZW50cyhhZGFwdGVkQ29udGVudCwgcHJvZmlsZSlcbiAgICB9XG5cbiAgICAvLyBLaW5lc3RoZXRpYyBsZWFybmVyIGFkYXB0YXRpb25zXG4gICAgaWYgKHByb2ZpbGUuYWRhcHRhdGlvblByZWZlcmVuY2VzLnByZWZlcnNJbnRlcmFjdGlvbikge1xuICAgICAgYWRhcHRlZENvbnRlbnQgPSB0aGlzLmFkZEludGVyYWN0aXZlRWxlbWVudHMoYWRhcHRlZENvbnRlbnQsIHByb2ZpbGUpXG4gICAgfVxuXG4gICAgcmV0dXJuIGFkYXB0ZWRDb250ZW50XG4gIH1cblxuICAvKipcbiAgICogQWRkcyB2aXN1YWwgZWxlbWVudHMgZm9yIHZpc3VhbCBsZWFybmVyc1xuICAgKi9cbiAgcHJpdmF0ZSBzdGF0aWMgYWRkVmlzdWFsRWxlbWVudHMoY29udGVudDogc3RyaW5nLCBwcm9maWxlOiBMZWFybmluZ1Byb2ZpbGUpOiBzdHJpbmcge1xuICAgIGxldCBlbmhhbmNlZCA9IGNvbnRlbnRcblxuICAgIC8vIEFkZCB2aXN1YWwgY3VlcyBhbmQgZm9ybWF0dGluZ1xuICAgIGVuaGFuY2VkID0gZW5oYW5jZWQucmVwbGFjZSgvaW1wb3J0YW50ZTovZ2ksICfwn5SNICoqSU1QT1JUQU5URToqKicpXG4gICAgZW5oYW5jZWQgPSBlbmhhbmNlZC5yZXBsYWNlKC9ub3RhOi9naSwgJ/Cfk50gKipOT1RBOioqJylcbiAgICBlbmhhbmNlZCA9IGVuaGFuY2VkLnJlcGxhY2UoL2VqZW1wbG86L2dpLCAn8J+SoSAqKkVKRU1QTE86KionKVxuICAgIGVuaGFuY2VkID0gZW5oYW5jZWQucmVwbGFjZSgvcmVzdWx0YWRvOi9naSwgJ+KchSAqKlJFU1VMVEFETzoqKicpXG5cbiAgICAvLyBBZGQgdmlzdWFsIHNlcGFyYXRvcnNcbiAgICBpZiAoZW5oYW5jZWQuaW5jbHVkZXMoJ3Bhc28nKSB8fCBlbmhhbmNlZC5pbmNsdWRlcygnc3RlcCcpKSB7XG4gICAgICBlbmhhbmNlZCA9IGVuaGFuY2VkLnJlcGxhY2UoL3Bhc28gKFxcZCspL2dpLCAnXFxu8J+TjSAqKlBBU08gJDEqKlxcbicpXG4gICAgfVxuXG4gICAgcmV0dXJuIGVuaGFuY2VkXG4gIH1cblxuICAvKipcbiAgICogQWRkcyBhdWRpdG9yeSBlbGVtZW50cyBmb3IgYXVkaXRvcnkgbGVhcm5lcnMgIFxuICAgKi9cbiAgcHJpdmF0ZSBzdGF0aWMgYWRkQXVkaXRvcnlFbGVtZW50cyhjb250ZW50OiBzdHJpbmcsIHByb2ZpbGU6IExlYXJuaW5nUHJvZmlsZSk6IHN0cmluZyB7XG4gICAgbGV0IGVuaGFuY2VkID0gY29udGVudFxuXG4gICAgLy8gQWRkIGNvbnZlcnNhdGlvbmFsIHBocmFzZXNcbiAgICBlbmhhbmNlZCA9IFwi8J+Xo++4jyBUZSB2b3kgYSBleHBsaWNhciBlc3RvIHBhc28gYSBwYXNvOlxcblxcblwiICsgZW5oYW5jZWRcbiAgICBcbiAgICAvLyBBZGQgdmVyYmFsIHRyYW5zaXRpb24gcGhyYXNlc1xuICAgIGVuaGFuY2VkID0gZW5oYW5jZWQucmVwbGFjZSgvXFwuIChbQS1aXSkvZywgJy4gQWhvcmEsICQxJylcbiAgICBlbmhhbmNlZCA9IGVuaGFuY2VkLnJlcGxhY2UoLzpcXG4vZywgJy4gRXNjdWNoYSBiaWVuOlxcbicpXG5cbiAgICByZXR1cm4gZW5oYW5jZWRcbiAgfVxuXG4gIC8qKlxuICAgKiBBZGRzIHN0cnVjdHVyZWQgZWxlbWVudHMgZm9yIHJlYWRpbmcvd3JpdGluZyBsZWFybmVyc1xuICAgKi9cbiAgcHJpdmF0ZSBzdGF0aWMgYWRkU3RydWN0dXJlZEVsZW1lbnRzKGNvbnRlbnQ6IHN0cmluZywgcHJvZmlsZTogTGVhcm5pbmdQcm9maWxlKTogc3RyaW5nIHtcbiAgICBsZXQgZW5oYW5jZWQgPSBjb250ZW50XG5cbiAgICAvLyBBZGQgY2xlYXIgc3RydWN0dXJlIGFuZCBidWxsZXQgcG9pbnRzXG4gICAgaWYgKCFlbmhhbmNlZC5pbmNsdWRlcygnKionKSAmJiBlbmhhbmNlZC5sZW5ndGggPiAyMDApIHtcbiAgICAgIGNvbnN0IHNlbnRlbmNlcyA9IGVuaGFuY2VkLnNwbGl0KCcuJylcbiAgICAgIGlmIChzZW50ZW5jZXMubGVuZ3RoID4gMykge1xuICAgICAgICBlbmhhbmNlZCA9IHNlbnRlbmNlc1xuICAgICAgICAgIC5maWx0ZXIocyA9PiBzLnRyaW0oKS5sZW5ndGggPiAxMClcbiAgICAgICAgICAubWFwKChzZW50ZW5jZSwgaW5kZXgpID0+IGAke2luZGV4ICsgMX0uICR7c2VudGVuY2UudHJpbSgpfWApXG4gICAgICAgICAgLmpvaW4oJ1xcbicpXG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIGVuaGFuY2VkXG4gIH1cblxuICAvKipcbiAgICogQWRkcyBpbnRlcmFjdGl2ZSBlbGVtZW50cyBmb3Iga2luZXN0aGV0aWMgbGVhcm5lcnNcbiAgICovXG4gIHByaXZhdGUgc3RhdGljIGFkZEludGVyYWN0aXZlRWxlbWVudHMoY29udGVudDogc3RyaW5nLCBwcm9maWxlOiBMZWFybmluZ1Byb2ZpbGUpOiBzdHJpbmcge1xuICAgIGxldCBlbmhhbmNlZCA9IGNvbnRlbnRcblxuICAgIC8vIEFkZCBhY3Rpb24tb3JpZW50ZWQgbGFuZ3VhZ2VcbiAgICBlbmhhbmNlZCArPSBcIlxcblxcbvCfjq8gKipQcnVlYmEgZXN0bzoqKlwiXG4gICAgZW5oYW5jZWQgKz0gXCJcXG7igKIgQXBsaWNhIGVzdGUgY29uY2VwdG8gYSB1biBwcm9ibGVtYSByZWFsXCJcbiAgICBlbmhhbmNlZCArPSBcIlxcbuKAoiBFeHBlcmltZW50YSBjYW1iaWFuZG8gbG9zIHZhbG9yZXNcIlxuICAgIGVuaGFuY2VkICs9IFwiXFxu4oCiIFByYWN0aWNhIGNvbiBlamVyY2ljaW9zIHNpbWlsYXJlc1wiXG5cbiAgICByZXR1cm4gZW5oYW5jZWRcbiAgfVxuXG4gIC8qKlxuICAgKiBBbmFseXplcyBiZWhhdmlvciBwYXR0ZXJucyB0byBlbmhhbmNlIHByb2ZpbGVcbiAgICovXG4gIHN0YXRpYyBhbmFseXplQmVoYXZpb3JQYXR0ZXJucyh1c2VySWQ6IHN0cmluZyk6IExlYXJuaW5nUHJvZmlsZSB7XG4gICAgY29uc3QgdXNlckJlaGF2aW9ycyA9IHRoaXMuYmVoYXZpb3JzLmZpbHRlcihiID0+IGIudXNlcklkID09PSB1c2VySWQpXG4gICAgY29uc3QgcHJvZmlsZSA9IHRoaXMuZ2V0TGVhcm5pbmdQcm9maWxlKHVzZXJJZClcblxuICAgIGlmICh1c2VyQmVoYXZpb3JzLmxlbmd0aCA8IDUpIHJldHVybiBwcm9maWxlXG5cbiAgICAvLyBBbmFseXplIHBhdHRlcm5zIGluIHJlY2VudCBiZWhhdmlvcnNcbiAgICBjb25zdCByZWNlbnRCZWhhdmlvcnMgPSB1c2VyQmVoYXZpb3JzLnNsaWNlKC0yMClcbiAgICBjb25zdCBzdHlsZUZyZXF1ZW5jeSA9IG5ldyBNYXA8TGVhcm5pbmdTdHlsZSwgbnVtYmVyPigpXG5cbiAgICBmb3IgKGNvbnN0IGJlaGF2aW9yIG9mIHJlY2VudEJlaGF2aW9ycykge1xuICAgICAgZm9yIChjb25zdCBzdHlsZSBvZiBiZWhhdmlvci5zdHlsZUluZGljYXRvcnMpIHtcbiAgICAgICAgc3R5bGVGcmVxdWVuY3kuc2V0KHN0eWxlLCAoc3R5bGVGcmVxdWVuY3kuZ2V0KHN0eWxlKSB8fCAwKSArIDEpXG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gVXBkYXRlIHByb2ZpbGUgYmFzZWQgb24gYmVoYXZpb3JhbCBwYXR0ZXJuc1xuICAgIGNvbnN0IGluZGljYXRvcnM6IExlYXJuaW5nU3R5bGVJbmRpY2F0b3JbXSA9IFtdXG4gICAgZm9yIChjb25zdCBbc3R5bGUsIGZyZXF1ZW5jeV0gb2Ygc3R5bGVGcmVxdWVuY3kuZW50cmllcygpKSB7XG4gICAgICBjb25zdCB3ZWlnaHQgPSBmcmVxdWVuY3kgLyByZWNlbnRCZWhhdmlvcnMubGVuZ3RoXG4gICAgICBpZiAod2VpZ2h0ID4gMC4xKSB7XG4gICAgICAgIGluZGljYXRvcnMucHVzaCh7XG4gICAgICAgICAgc3R5bGUsXG4gICAgICAgICAgd2VpZ2h0LFxuICAgICAgICAgIGV2aWRlbmNlOiBbYERldGVjdGFkbyBlbiAke2ZyZXF1ZW5jeX0gZGUgJHtyZWNlbnRCZWhhdmlvcnMubGVuZ3RofSBpbnRlcmFjY2lvbmVzIHJlY2llbnRlc2BdLFxuICAgICAgICAgIGNvbmZpZGVuY2U6IE1hdGgubWluKHdlaWdodCAqIDIsIDEuMClcbiAgICAgICAgfSlcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gdGhpcy51cGRhdGVMZWFybmluZ1Byb2ZpbGUodXNlcklkLCBpbmRpY2F0b3JzLCAnYmVoYXZpb3JfYW5hbHlzaXMnKVxuICB9XG5cbiAgLyoqXG4gICAqIEdldHMgcHJvZmlsZSBzdGF0aXN0aWNzXG4gICAqL1xuICBzdGF0aWMgZ2V0UHJvZmlsZVN0YXRpc3RpY3ModXNlcklkPzogc3RyaW5nKTogYW55IHtcbiAgICBpZiAodXNlcklkKSB7XG4gICAgICBjb25zdCBwcm9maWxlID0gdGhpcy5wcm9maWxlcy5nZXQodXNlcklkKVxuICAgICAgY29uc3QgYmVoYXZpb3JzID0gdGhpcy5iZWhhdmlvcnMuZmlsdGVyKGIgPT4gYi51c2VySWQgPT09IHVzZXJJZClcbiAgICAgIFxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgcHJvZmlsZTogcHJvZmlsZSB8fCBudWxsLFxuICAgICAgICBiZWhhdmlvckNvdW50OiBiZWhhdmlvcnMubGVuZ3RoLFxuICAgICAgICByZWNlbnRJbnRlcmFjdGlvbnM6IGJlaGF2aW9ycy5maWx0ZXIoYiA9PiBcbiAgICAgICAgICBiLnRpbWVzdGFtcCA+IG5ldyBEYXRlKERhdGUubm93KCkgLSA3ICogMjQgKiA2MCAqIDYwICogMTAwMClcbiAgICAgICAgKS5sZW5ndGhcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4ge1xuICAgICAgdG90YWxQcm9maWxlczogdGhpcy5wcm9maWxlcy5zaXplLFxuICAgICAgdG90YWxCZWhhdmlvcnM6IHRoaXMuYmVoYXZpb3JzLmxlbmd0aCxcbiAgICAgIHN0eWxlRGlzdHJpYnV0aW9uOiB0aGlzLmdldEdsb2JhbFN0eWxlRGlzdHJpYnV0aW9uKClcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogR2V0cyBnbG9iYWwgc3R5bGUgZGlzdHJpYnV0aW9uXG4gICAqL1xuICBwcml2YXRlIHN0YXRpYyBnZXRHbG9iYWxTdHlsZURpc3RyaWJ1dGlvbigpOiBhbnkge1xuICAgIGNvbnN0IGRpc3RyaWJ1dGlvbiA9IHtcbiAgICAgIHZpc3VhbDogMCxcbiAgICAgIGF1ZGl0b3J5OiAwLFxuICAgICAgcmVhZGluZ193cml0aW5nOiAwLFxuICAgICAga2luZXN0aGV0aWM6IDAsXG4gICAgICBtdWx0aW1vZGFsOiAwXG4gICAgfVxuXG4gICAgZm9yIChjb25zdCBwcm9maWxlIG9mIHRoaXMucHJvZmlsZXMudmFsdWVzKCkpIHtcbiAgICAgIHN3aXRjaCAocHJvZmlsZS5wcmltYXJ5U3R5bGUpIHtcbiAgICAgICAgY2FzZSBMZWFybmluZ1N0eWxlLlZJU1VBTDpcbiAgICAgICAgICBkaXN0cmlidXRpb24udmlzdWFsKytcbiAgICAgICAgICBicmVha1xuICAgICAgICBjYXNlIExlYXJuaW5nU3R5bGUuQVVESVRPUlk6XG4gICAgICAgICAgZGlzdHJpYnV0aW9uLmF1ZGl0b3J5KytcbiAgICAgICAgICBicmVha1xuICAgICAgICBjYXNlIExlYXJuaW5nU3R5bGUuUkVBRElOR19XUklUSU5HOlxuICAgICAgICAgIGRpc3RyaWJ1dGlvbi5yZWFkaW5nX3dyaXRpbmcrK1xuICAgICAgICAgIGJyZWFrXG4gICAgICAgIGNhc2UgTGVhcm5pbmdTdHlsZS5LSU5FU1RIRVRJQzpcbiAgICAgICAgICBkaXN0cmlidXRpb24ua2luZXN0aGV0aWMrK1xuICAgICAgICAgIGJyZWFrXG4gICAgICAgIGNhc2UgTGVhcm5pbmdTdHlsZS5NVUxUSU1PREFMOlxuICAgICAgICAgIGRpc3RyaWJ1dGlvbi5tdWx0aW1vZGFsKytcbiAgICAgICAgICBicmVha1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBkaXN0cmlidXRpb25cbiAgfVxuXG4gIC8qKlxuICAgKiBQcm9jZXNzIHVzZXIgbWVzc2FnZSBhbmQgdXBkYXRlIGxlYXJuaW5nIHByb2ZpbGVcbiAgICovXG4gIHN0YXRpYyBwcm9jZXNzVXNlck1lc3NhZ2UodXNlcklkOiBzdHJpbmcsIG1lc3NhZ2U6IHN0cmluZyk6IExlYXJuaW5nUHJvZmlsZSB7XG4gICAgLy8gQW5hbHl6ZSBtZXNzYWdlIGZvciBsZWFybmluZyBzdHlsZSBpbmRpY2F0b3JzXG4gICAgY29uc3QgaW5kaWNhdG9ycyA9IHRoaXMuYW5hbHl6ZU1lc3NhZ2VGb3JMZWFybmluZ1N0eWxlKG1lc3NhZ2UsIHVzZXJJZClcbiAgICBcbiAgICAvLyBVcGRhdGUgbGVhcm5pbmcgcHJvZmlsZSBpZiBpbmRpY2F0b3JzIGZvdW5kXG4gICAgaWYgKGluZGljYXRvcnMubGVuZ3RoID4gMCkge1xuICAgICAgcmV0dXJuIHRoaXMudXBkYXRlTGVhcm5pbmdQcm9maWxlKHVzZXJJZCwgaW5kaWNhdG9ycywgJ21lc3NhZ2VfcHJvY2Vzc2luZycpXG4gICAgfVxuICAgIFxuICAgIC8vIEFuYWx5emUgYmVoYXZpb3IgcGF0dGVybnMgcGVyaW9kaWNhbGx5XG4gICAgY29uc3QgcHJvZmlsZSA9IHRoaXMuZ2V0TGVhcm5pbmdQcm9maWxlKHVzZXJJZClcbiAgICBpZiAocHJvZmlsZS5pbnRlcmFjdGlvbnMgJSAxMCA9PT0gMCkge1xuICAgICAgcmV0dXJuIHRoaXMuYW5hbHl6ZUJlaGF2aW9yUGF0dGVybnModXNlcklkKVxuICAgIH1cbiAgICBcbiAgICByZXR1cm4gcHJvZmlsZVxuICB9XG5cbiAgLyoqXG4gICAqIEdlbmVyYXRlcyBsZWFybmluZyBzdHlsZSByZWNvbW1lbmRhdGlvbnMgZm9yIFNhcmFcbiAgICovXG4gIHN0YXRpYyBnZW5lcmF0ZVN0eWxlUmVjb21tZW5kYXRpb25zKHByb2ZpbGU6IExlYXJuaW5nUHJvZmlsZSk6IHN0cmluZ1tdIHtcbiAgICBjb25zdCByZWNvbW1lbmRhdGlvbnM6IHN0cmluZ1tdID0gW11cbiAgICBcbiAgICBzd2l0Y2ggKHByb2ZpbGUucHJpbWFyeVN0eWxlKSB7XG4gICAgICBjYXNlIExlYXJuaW5nU3R5bGUuVklTVUFMOlxuICAgICAgICByZWNvbW1lbmRhdGlvbnMucHVzaChcIlVzYXIgZGlhZ3JhbWFzIHkgZXNxdWVtYXMgY3VhbmRvIGV4cGxpY28gY29uY2VwdG9zXCIpXG4gICAgICAgIHJlY29tbWVuZGF0aW9ucy5wdXNoKFwiSW5jbHVpciBlamVtcGxvcyB2aXN1YWxlcyB5IGdyw6FmaWNvc1wiKVxuICAgICAgICByZWNvbW1lbmRhdGlvbnMucHVzaChcIkVzdHJ1Y3R1cmFyIGluZm9ybWFjacOzbiBjb24gdmnDsWV0YXMgeSBjb2xvcmVzXCIpXG4gICAgICAgIGJyZWFrXG4gICAgICAgIFxuICAgICAgY2FzZSBMZWFybmluZ1N0eWxlLkFVRElUT1JZOlxuICAgICAgICByZWNvbW1lbmRhdGlvbnMucHVzaChcIkV4cGxpY2FyIGNvbmNlcHRvcyBjb24gbGVuZ3VhamUgY29udmVyc2FjaW9uYWxcIilcbiAgICAgICAgcmVjb21tZW5kYXRpb25zLnB1c2goXCJVc2FyIGFuYWxvZ8OtYXMgeSBtZXTDoWZvcmFzIHZlcmJhbGVzXCIpXG4gICAgICAgIHJlY29tbWVuZGF0aW9ucy5wdXNoKFwiSW5jbHVpciBkaXNjdXNpb25lcyB5IHByZWd1bnRhcyBhYmllcnRhc1wiKVxuICAgICAgICBicmVha1xuICAgICAgICBcbiAgICAgIGNhc2UgTGVhcm5pbmdTdHlsZS5SRUFESU5HX1dSSVRJTkc6XG4gICAgICAgIHJlY29tbWVuZGF0aW9ucy5wdXNoKFwiUHJvcG9yY2lvbmFyIGluZm9ybWFjacOzbiBkZXRhbGxhZGEgcG9yIGVzY3JpdG9cIilcbiAgICAgICAgcmVjb21tZW5kYXRpb25zLnB1c2goXCJDcmVhciBsaXN0YXMgeSByZXPDum1lbmVzIGVzdHJ1Y3R1cmFkb3NcIilcbiAgICAgICAgcmVjb21tZW5kYXRpb25zLnB1c2goXCJJbmNsdWlyIGRlZmluaWNpb25lcyB5IGRlc2NyaXBjaW9uZXMgcHJlY2lzYXNcIilcbiAgICAgICAgYnJlYWtcbiAgICAgICAgXG4gICAgICBjYXNlIExlYXJuaW5nU3R5bGUuS0lORVNUSEVUSUM6XG4gICAgICAgIHJlY29tbWVuZGF0aW9ucy5wdXNoKFwiSW5jbHVpciBlamVyY2ljaW9zIHByw6FjdGljb3MgeSBhY3RpdmlkYWRlc1wiKVxuICAgICAgICByZWNvbW1lbmRhdGlvbnMucHVzaChcIlN1Z2VyaXIgZXhwZXJpbWVudG9zIHkgYXBsaWNhY2lvbmVzIHJlYWxlc1wiKVxuICAgICAgICByZWNvbW1lbmRhdGlvbnMucHVzaChcIlVzYXIgZWplbXBsb3MgY29uY3JldG9zIHkgbWFuaXB1bGFibGVzXCIpXG4gICAgICAgIGJyZWFrXG4gICAgICAgIFxuICAgICAgY2FzZSBMZWFybmluZ1N0eWxlLk1VTFRJTU9EQUw6XG4gICAgICAgIHJlY29tbWVuZGF0aW9ucy5wdXNoKFwiQ29tYmluYXIgbcO6bHRpcGxlcyBlbmZvcXVlcyBkZSBlbnNlw7FhbnphXCIpXG4gICAgICAgIHJlY29tbWVuZGF0aW9ucy5wdXNoKFwiQWRhcHRhciBleHBsaWNhY2lvbmVzIHNlZ8O6biBlbCBjb250ZXh0b1wiKVxuICAgICAgICByZWNvbW1lbmRhdGlvbnMucHVzaChcIk9mcmVjZXIgb3BjaW9uZXMgZGUgYXByZW5kaXphamUgdmFyaWFkYXNcIilcbiAgICAgICAgYnJlYWtcbiAgICB9XG4gICAgXG4gICAgcmV0dXJuIHJlY29tbWVuZGF0aW9uc1xuICB9XG59Il0sIm5hbWVzIjpbIkxlYXJuaW5nU3R5bGUiLCJBZHZhbmNlZExlYXJuaW5nUHJvZmlsZU1hbmFnZXIiLCJwcm9maWxlcyIsIk1hcCIsImJlaGF2aW9ycyIsImFuYWx5emVNZXNzYWdlRm9yTGVhcm5pbmdTdHlsZSIsIm1lc3NhZ2UiLCJ1c2VySWQiLCJtc2dMb3dlciIsInRvTG93ZXJDYXNlIiwiaW5kaWNhdG9ycyIsInZpc3VhbEtleXdvcmRzIiwidmlzdWFsUGhyYXNlcyIsInZpc3VhbFNjb3JlIiwiY2FsY3VsYXRlS2V5d29yZFNjb3JlIiwicHVzaCIsInN0eWxlIiwid2VpZ2h0IiwiZXZpZGVuY2UiLCJleHRyYWN0RXZpZGVuY2UiLCJjb25maWRlbmNlIiwiTWF0aCIsIm1pbiIsImF1ZGl0b3J5S2V5d29yZHMiLCJhdWRpdG9yeVBocmFzZXMiLCJhdWRpdG9yeVNjb3JlIiwicmVhZFdyaXRlS2V5d29yZHMiLCJyZWFkV3JpdGVQaHJhc2VzIiwicmVhZFdyaXRlU2NvcmUiLCJraW5lc3RoZXRpY0tleXdvcmRzIiwia2luZXN0aGV0aWNQaHJhc2VzIiwia2luZXN0aGV0aWNTY29yZSIsImxlbmd0aCIsInJlY29yZEJlaGF2aW9yUGF0dGVybiIsIm1hcCIsImkiLCJzb3J0IiwiYSIsImIiLCJ0ZXh0Iiwia2V5d29yZHMiLCJwaHJhc2VzIiwic2NvcmUiLCJrZXl3b3JkIiwiaW5jbHVkZXMiLCJwaHJhc2UiLCJwYXR0ZXJucyIsInBhdHRlcm4iLCJzZW50ZW5jZXMiLCJzcGxpdCIsIm1hdGNoaW5nU2VudGVuY2UiLCJmaW5kIiwic2VudGVuY2UiLCJ0cmltIiwic2xpY2UiLCJhY3Rpb24iLCJjb250ZXh0Iiwic3R5bGVJbmRpY2F0b3JzIiwidGltZXN0YW1wIiwiRGF0ZSIsInVzZXJCZWhhdmlvcnMiLCJmaWx0ZXIiLCJjb25jYXQiLCJ1cGRhdGVMZWFybmluZ1Byb2ZpbGUiLCJwcm9maWxlIiwiZ2V0IiwiY3JlYXRlSW5pdGlhbFByb2ZpbGUiLCJpbmRpY2F0b3IiLCJzdHlsZURpc3RyaWJ1dGlvbiIsInZpc3VhbCIsImF1ZGl0b3J5IiwicmVhZGluZ193cml0aW5nIiwia2luZXN0aGV0aWMiLCJ0b3RhbCIsInN0eWxlcyIsInByaW1hcnlTdHlsZSIsInNlY29uZGFyeVN0eWxlIiwidW5kZWZpbmVkIiwiYWRhcHRhdGlvblByZWZlcmVuY2VzIiwicHJlZmVyc0RpYWdyYW1zIiwicHJlZmVyc1N0ZXBCeVN0ZXAiLCJwcmVmZXJzRXhhbXBsZXMiLCJwcmVmZXJzSW50ZXJhY3Rpb24iLCJwcmVmZXJzVmlzdWFsQWlkcyIsInByZWZlcnNWZXJiYWxFeHBsYW5hdGlvbiIsImxhc3RVcGRhdGVkIiwiaW50ZXJhY3Rpb25zIiwic2V0IiwiY29uc29sZSIsImxvZyIsImRldGVjdGVkRnJvbSIsIm1lc3NhZ2VBbmFseXNpcyIsImJlaGF2aW9yUGF0dGVybnMiLCJleHBsaWNpdFByZWZlcmVuY2VzIiwiZ2V0TGVhcm5pbmdQcm9maWxlIiwiYWRhcHRSZXNwb25zZVRvTGVhcm5pbmdTdHlsZSIsImNvbnRlbnQiLCJhZGFwdGVkQ29udGVudCIsImFkZFZpc3VhbEVsZW1lbnRzIiwiYWRkQXVkaXRvcnlFbGVtZW50cyIsImFkZFN0cnVjdHVyZWRFbGVtZW50cyIsImFkZEludGVyYWN0aXZlRWxlbWVudHMiLCJlbmhhbmNlZCIsInJlcGxhY2UiLCJzIiwiaW5kZXgiLCJqb2luIiwiYW5hbHl6ZUJlaGF2aW9yUGF0dGVybnMiLCJyZWNlbnRCZWhhdmlvcnMiLCJzdHlsZUZyZXF1ZW5jeSIsImJlaGF2aW9yIiwiZnJlcXVlbmN5IiwiZW50cmllcyIsImdldFByb2ZpbGVTdGF0aXN0aWNzIiwiYmVoYXZpb3JDb3VudCIsInJlY2VudEludGVyYWN0aW9ucyIsIm5vdyIsInRvdGFsUHJvZmlsZXMiLCJzaXplIiwidG90YWxCZWhhdmlvcnMiLCJnZXRHbG9iYWxTdHlsZURpc3RyaWJ1dGlvbiIsImRpc3RyaWJ1dGlvbiIsIm11bHRpbW9kYWwiLCJ2YWx1ZXMiLCJwcm9jZXNzVXNlck1lc3NhZ2UiLCJnZW5lcmF0ZVN0eWxlUmVjb21tZW5kYXRpb25zIiwicmVjb21tZW5kYXRpb25zIl0sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/advanced-learning-profiles.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/ai-providers.ts":
/*!*********************************!*\
  !*** ./src/lib/ai-providers.ts ***!
  \*********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   AIProvider: () => (/* binding */ AIProvider),\n/* harmony export */   AIProviderFactory: () => (/* binding */ AIProviderFactory),\n/* harmony export */   AIService: () => (/* binding */ AIService),\n/* harmony export */   AI_CONFIG: () => (/* binding */ AI_CONFIG),\n/* harmony export */   BaseAIProvider: () => (/* binding */ BaseAIProvider),\n/* harmony export */   GoogleGeminiProvider: () => (/* binding */ GoogleGeminiProvider),\n/* harmony export */   GroqProvider: () => (/* binding */ GroqProvider),\n/* harmony export */   HuggingFaceProvider: () => (/* binding */ HuggingFaceProvider),\n/* harmony export */   OllamaProvider: () => (/* binding */ OllamaProvider),\n/* harmony export */   TemplateProvider: () => (/* binding */ TemplateProvider),\n/* harmony export */   TransformersJSProvider: () => (/* binding */ TransformersJSProvider),\n/* harmony export */   aiService: () => (/* binding */ aiService)\n/* harmony export */ });\n// AI Providers Configuration\n// Supports multiple AI providers with fallback system\nvar AIProvider = /*#__PURE__*/ function(AIProvider) {\n    AIProvider[\"GOOGLE_GEMINI\"] = \"google_gemini\";\n    AIProvider[\"GROQ\"] = \"groq\";\n    AIProvider[\"HUGGING_FACE\"] = \"huggingface\";\n    AIProvider[\"OLLAMA_LOCAL\"] = \"ollama_local\";\n    AIProvider[\"TRANSFORMERS_JS\"] = \"transformers_js\";\n    AIProvider[\"TEMPLATES_ONLY\"] = \"templates_only\";\n    return AIProvider;\n}({});\n// Default configuration - Groq first for ultra-fast responses\nconst AI_CONFIG = [\n    {\n        provider: \"groq\",\n        apiKey: process.env.GROQ_API_KEY,\n        baseUrl: 'https://api.groq.com/openai/v1',\n        model: 'llama-3.3-70b-versatile',\n        enabled: !!process.env.GROQ_API_KEY\n    },\n    {\n        provider: \"google_gemini\",\n        apiKey: process.env.GOOGLE_AI_API_KEY,\n        model: 'gemini-1.5-flash',\n        enabled: !!process.env.GOOGLE_AI_API_KEY\n    },\n    {\n        provider: \"huggingface\",\n        apiKey: process.env.HUGGING_FACE_API_KEY,\n        baseUrl: 'https://api-inference.huggingface.co/models',\n        model: 'microsoft/DialoGPT-large',\n        enabled: !!process.env.HUGGING_FACE_API_KEY\n    },\n    {\n        provider: \"ollama_local\",\n        baseUrl: process.env.OLLAMA_URL || 'http://localhost:11434',\n        model: process.env.OLLAMA_MODEL || 'llama3.1:8b',\n        enabled: process.env.OLLAMA_ENABLED === 'true'\n    },\n    {\n        provider: \"transformers_js\",\n        enabled: process.env.TRANSFORMERS_JS_ENABLED === 'true'\n    },\n    {\n        provider: \"templates_only\",\n        enabled: true // Always available as final fallback\n    }\n];\n// Abstract AI Provider Interface\nclass BaseAIProvider {\n    constructor(config){\n        this.config = config;\n    }\n}\n// Google Gemini Provider\nclass GoogleGeminiProvider extends BaseAIProvider {\n    async generateExercise(prompt) {\n        if (!this.config.apiKey) {\n            throw new Error('Google AI API key not configured');\n        }\n        const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/${this.config.model}:generateContent?key=${this.config.apiKey}`, {\n            method: 'POST',\n            headers: {\n                'Content-Type': 'application/json'\n            },\n            body: JSON.stringify({\n                contents: [\n                    {\n                        parts: [\n                            {\n                                text: prompt\n                            }\n                        ]\n                    }\n                ],\n                generationConfig: {\n                    temperature: 0.7,\n                    topK: 1,\n                    topP: 1,\n                    maxOutputTokens: 500\n                }\n            })\n        });\n        if (!response.ok) {\n            throw new Error(`Google AI API error: ${response.status}`);\n        }\n        const data = await response.json();\n        return data.candidates[0]?.content?.parts[0]?.text || 'Error generating content';\n    }\n    async isAvailable() {\n        return !!this.config.apiKey;\n    }\n}\n// Hugging Face Provider\nclass HuggingFaceProvider extends BaseAIProvider {\n    async generateExercise(prompt) {\n        if (!this.config.apiKey) {\n            throw new Error('Hugging Face API key not configured');\n        }\n        const response = await fetch(`${this.config.baseUrl}/${this.config.model}`, {\n            method: 'POST',\n            headers: {\n                'Authorization': `Bearer ${this.config.apiKey}`,\n                'Content-Type': 'application/json'\n            },\n            body: JSON.stringify({\n                inputs: prompt,\n                parameters: {\n                    max_new_tokens: 300,\n                    temperature: 0.7,\n                    return_full_text: false\n                }\n            })\n        });\n        if (!response.ok) {\n            throw new Error(`Hugging Face API error: ${response.status}`);\n        }\n        const data = await response.json();\n        return data[0]?.generated_text || 'Error generating content';\n    }\n    async isAvailable() {\n        return !!this.config.apiKey;\n    }\n}\n// Ollama Local Provider\nclass OllamaProvider extends BaseAIProvider {\n    async generateExercise(prompt) {\n        try {\n            const response = await fetch(`${this.config.baseUrl}/api/generate`, {\n                method: 'POST',\n                headers: {\n                    'Content-Type': 'application/json'\n                },\n                body: JSON.stringify({\n                    model: this.config.model,\n                    prompt: prompt,\n                    stream: false,\n                    options: {\n                        temperature: 0.7,\n                        num_predict: 300\n                    }\n                })\n            });\n            if (!response.ok) {\n                throw new Error(`Ollama API error: ${response.status}`);\n            }\n            const data = await response.json();\n            return data.response || 'Error generating content';\n        } catch (error) {\n            throw new Error(`Ollama connection failed: ${error}`);\n        }\n    }\n    async isAvailable() {\n        try {\n            const response = await fetch(`${this.config.baseUrl}/api/version`, {\n                method: 'GET',\n                signal: AbortSignal.timeout(3000) // 3 second timeout\n            });\n            return response.ok;\n        } catch  {\n            return false;\n        }\n    }\n}\n// Transformers.js Provider (Browser-based)\nclass TransformersJSProvider extends BaseAIProvider {\n    async generateExercise(prompt) {\n        if (!this.pipeline) {\n            const { pipeline } = await Promise.resolve(/*! import() */).then(__webpack_require__.bind(__webpack_require__, /*! @xenova/transformers */ \"@xenova/transformers\"));\n            this.pipeline = await pipeline('text-generation', 'Xenova/gpt2');\n        }\n        const result = await this.pipeline(prompt, {\n            max_new_tokens: 150,\n            temperature: 0.7\n        });\n        return result[0]?.generated_text?.replace(prompt, '').trim() || 'Error generating content';\n    }\n    async isAvailable() {\n        try {\n            await Promise.resolve(/*! import() */).then(__webpack_require__.bind(__webpack_require__, /*! @xenova/transformers */ \"@xenova/transformers\"));\n            return true;\n        } catch  {\n            return false;\n        }\n    }\n    constructor(...args){\n        super(...args), this.pipeline = null;\n    }\n}\n// Groq Provider\nclass GroqProvider extends BaseAIProvider {\n    async generateExercise(prompt) {\n        if (!this.config.apiKey) {\n            throw new Error('Groq API key not configured');\n        }\n        const response = await fetch(`${this.config.baseUrl}/chat/completions`, {\n            method: 'POST',\n            headers: {\n                'Authorization': `Bearer ${this.config.apiKey}`,\n                'Content-Type': 'application/json'\n            },\n            body: JSON.stringify({\n                model: this.config.model,\n                messages: [\n                    {\n                        role: 'system',\n                        content: 'Eres Sara, un asistente personal académico especializado en ayudar a estudiantes con organización, planificación y aprendizaje. Responde de manera clara, práctica y motivacional.'\n                    },\n                    {\n                        role: 'user',\n                        content: prompt\n                    }\n                ],\n                temperature: 0.7,\n                max_tokens: 500,\n                top_p: 0.9\n            })\n        });\n        if (!response.ok) {\n            const errorData = await response.text();\n            throw new Error(`Groq API error (${response.status}): ${errorData}`);\n        }\n        const data = await response.json();\n        return data.choices[0]?.message?.content || 'Error generating content';\n    }\n    async isAvailable() {\n        if (!this.config.apiKey) return false;\n        try {\n            const response = await fetch(`${this.config.baseUrl}/models`, {\n                method: 'GET',\n                headers: {\n                    'Authorization': `Bearer ${this.config.apiKey}`\n                },\n                signal: AbortSignal.timeout(5000) // 5 second timeout\n            });\n            return response.ok;\n        } catch  {\n            return false;\n        }\n    }\n}\n// Template Provider (Always Available Fallback)\nclass TemplateProvider extends BaseAIProvider {\n    async generateExercise(prompt) {\n        // This will use the existing template system\n        return 'TEMPLATE_FALLBACK';\n    }\n    async isAvailable() {\n        return true;\n    }\n}\n// Provider Factory\nclass AIProviderFactory {\n    static createProvider(config) {\n        switch(config.provider){\n            case \"google_gemini\":\n                return new GoogleGeminiProvider(config);\n            case \"groq\":\n                return new GroqProvider(config);\n            case \"huggingface\":\n                return new HuggingFaceProvider(config);\n            case \"ollama_local\":\n                return new OllamaProvider(config);\n            case \"transformers_js\":\n                return new TransformersJSProvider(config);\n            case \"templates_only\":\n                return new TemplateProvider(config);\n            default:\n                throw new Error(`Unknown AI provider: ${config.provider}`);\n        }\n    }\n}\n// Main AI Service with Fallback System\nclass AIService {\n    constructor(){\n        this.providers = [];\n        this.currentProviderIndex = 0;\n        this.initializeProviders();\n    }\n    initializeProviders() {\n        this.providers = AI_CONFIG.filter((config)=>config.enabled).map((config)=>AIProviderFactory.createProvider(config));\n    }\n    async generateExercise(prompt) {\n        for(let i = this.currentProviderIndex; i < this.providers.length; i++){\n            const provider = this.providers[i];\n            try {\n                const isAvailable = await provider.isAvailable();\n                if (!isAvailable) {\n                    console.log(`Provider ${i} not available, trying next...`);\n                    continue;\n                }\n                const result = await provider.generateExercise(prompt);\n                if (result === 'TEMPLATE_FALLBACK') {\n                    return result // Special marker for template system\n                    ;\n                }\n                if (result && result.length > 10) {\n                    this.currentProviderIndex = i // Remember working provider\n                    ;\n                    return result;\n                }\n            } catch (error) {\n                console.error(`Provider ${i} failed:`, error);\n                continue;\n            }\n        }\n        // If all providers fail, return template fallback marker\n        return 'TEMPLATE_FALLBACK';\n    }\n    async getAvailableProviders() {\n        const available = [];\n        for(let i = 0; i < this.providers.length; i++){\n            try {\n                const isAvailable = await this.providers[i].isAvailable();\n                if (isAvailable) {\n                    available.push(AI_CONFIG[i].provider);\n                }\n            } catch  {\n            // Provider not available\n            }\n        }\n        return available;\n    }\n}\n// Export singleton instance\nconst aiService = new AIService();\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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RUFBRUQsSUFBSztZQUM5QyxJQUFJO2dCQUNGLE1BQU1yQyxjQUFjLE1BQU0sSUFBSSxDQUFDZ0MsU0FBUyxDQUFDSyxFQUFFLENBQUNyQyxXQUFXO2dCQUN2RCxJQUFJQSxhQUFhO29CQUNmMEMsVUFBVUMsSUFBSSxDQUFDdEYsU0FBUyxDQUFDZ0YsRUFBRSxDQUFDL0UsUUFBUTtnQkFDdEM7WUFDRixFQUFFLE9BQU07WUFDTix5QkFBeUI7WUFDM0I7UUFDRjtRQUNBLE9BQU9vRjtJQUNUO0FBQ0Y7QUFFQSw0QkFBNEI7QUFDckIsTUFBTUUsWUFBWSxJQUFJYixZQUFXIiwic291cmNlcyI6WyIvVXNlcnMvcm9kcmlnb2RpYmVybmFyZG8zM2dtYWlsLmNvbS9Eb2N1bWVudHMvQXBwIERldmVsb3BtZW50IFByb3llY3RzL0ludGVsbGVnbyBQbGF0Zm9ybS9zcmMvbGliL2FpLXByb3ZpZGVycy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBBSSBQcm92aWRlcnMgQ29uZmlndXJhdGlvblxuLy8gU3VwcG9ydHMgbXVsdGlwbGUgQUkgcHJvdmlkZXJzIHdpdGggZmFsbGJhY2sgc3lzdGVtXG5cbmV4cG9ydCBlbnVtIEFJUHJvdmlkZXIge1xuICBHT09HTEVfR0VNSU5JID0gJ2dvb2dsZV9nZW1pbmknLFxuICBHUk9RID0gJ2dyb3EnLFxuICBIVUdHSU5HX0ZBQ0UgPSAnaHVnZ2luZ2ZhY2UnLFxuICBPTExBTUFfTE9DQUwgPSAnb2xsYW1hX2xvY2FsJyxcbiAgVFJBTlNGT1JNRVJTX0pTID0gJ3RyYW5zZm9ybWVyc19qcycsXG4gIFRFTVBMQVRFU19PTkxZID0gJ3RlbXBsYXRlc19vbmx5J1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIEFJQ29uZmlnIHtcbiAgcHJvdmlkZXI6IEFJUHJvdmlkZXJcbiAgYXBpS2V5Pzogc3RyaW5nXG4gIGJhc2VVcmw/OiBzdHJpbmdcbiAgbW9kZWw/OiBzdHJpbmdcbiAgZW5hYmxlZDogYm9vbGVhblxufVxuXG4vLyBEZWZhdWx0IGNvbmZpZ3VyYXRpb24gLSBHcm9xIGZpcnN0IGZvciB1bHRyYS1mYXN0IHJlc3BvbnNlc1xuZXhwb3J0IGNvbnN0IEFJX0NPTkZJRzogQUlDb25maWdbXSA9IFtcbiAge1xuICAgIHByb3ZpZGVyOiBBSVByb3ZpZGVyLkdST1EsXG4gICAgYXBpS2V5OiBwcm9jZXNzLmVudi5HUk9RX0FQSV9LRVksXG4gICAgYmFzZVVybDogJ2h0dHBzOi8vYXBpLmdyb3EuY29tL29wZW5haS92MScsXG4gICAgbW9kZWw6ICdsbGFtYS0zLjMtNzBiLXZlcnNhdGlsZScsIC8vIFVsdHJhLWZhc3Q6IDI0OSB0b2tlbnMvc2VjXG4gICAgZW5hYmxlZDogISFwcm9jZXNzLmVudi5HUk9RX0FQSV9LRVlcbiAgfSxcbiAge1xuICAgIHByb3ZpZGVyOiBBSVByb3ZpZGVyLkdPT0dMRV9HRU1JTkksXG4gICAgYXBpS2V5OiBwcm9jZXNzLmVudi5HT09HTEVfQUlfQVBJX0tFWSxcbiAgICBtb2RlbDogJ2dlbWluaS0xLjUtZmxhc2gnLCAvLyBGcmVlIHRpZXIgbW9kZWwgLSBiYWNrdXBcbiAgICBlbmFibGVkOiAhIXByb2Nlc3MuZW52LkdPT0dMRV9BSV9BUElfS0VZXG4gIH0sXG4gIHtcbiAgICBwcm92aWRlcjogQUlQcm92aWRlci5IVUdHSU5HX0ZBQ0UsXG4gICAgYXBpS2V5OiBwcm9jZXNzLmVudi5IVUdHSU5HX0ZBQ0VfQVBJX0tFWSxcbiAgICBiYXNlVXJsOiAnaHR0cHM6Ly9hcGktaW5mZXJlbmNlLmh1Z2dpbmdmYWNlLmNvL21vZGVscycsXG4gICAgbW9kZWw6ICdtaWNyb3NvZnQvRGlhbG9HUFQtbGFyZ2UnLCAvLyBHb29kIGZvciBlZHVjYXRpb25hbCBjb250ZW50XG4gICAgZW5hYmxlZDogISFwcm9jZXNzLmVudi5IVUdHSU5HX0ZBQ0VfQVBJX0tFWVxuICB9LFxuICB7XG4gICAgcHJvdmlkZXI6IEFJUHJvdmlkZXIuT0xMQU1BX0xPQ0FMLFxuICAgIGJhc2VVcmw6IHByb2Nlc3MuZW52Lk9MTEFNQV9VUkwgfHwgJ2h0dHA6Ly9sb2NhbGhvc3Q6MTE0MzQnLFxuICAgIG1vZGVsOiBwcm9jZXNzLmVudi5PTExBTUFfTU9ERUwgfHwgJ2xsYW1hMy4xOjhiJyxcbiAgICBlbmFibGVkOiBwcm9jZXNzLmVudi5PTExBTUFfRU5BQkxFRCA9PT0gJ3RydWUnXG4gIH0sXG4gIHtcbiAgICBwcm92aWRlcjogQUlQcm92aWRlci5UUkFOU0ZPUk1FUlNfSlMsXG4gICAgZW5hYmxlZDogcHJvY2Vzcy5lbnYuVFJBTlNGT1JNRVJTX0pTX0VOQUJMRUQgPT09ICd0cnVlJ1xuICB9LFxuICB7XG4gICAgcHJvdmlkZXI6IEFJUHJvdmlkZXIuVEVNUExBVEVTX09OTFksXG4gICAgZW5hYmxlZDogdHJ1ZSAvLyBBbHdheXMgYXZhaWxhYmxlIGFzIGZpbmFsIGZhbGxiYWNrXG4gIH1cbl1cblxuLy8gQWJzdHJhY3QgQUkgUHJvdmlkZXIgSW50ZXJmYWNlXG5leHBvcnQgYWJzdHJhY3QgY2xhc3MgQmFzZUFJUHJvdmlkZXIge1xuICBwcm90ZWN0ZWQgY29uZmlnOiBBSUNvbmZpZ1xuXG4gIGNvbnN0cnVjdG9yKGNvbmZpZzogQUlDb25maWcpIHtcbiAgICB0aGlzLmNvbmZpZyA9IGNvbmZpZ1xuICB9XG5cbiAgYWJzdHJhY3QgZ2VuZXJhdGVFeGVyY2lzZShwcm9tcHQ6IHN0cmluZyk6IFByb21pc2U8c3RyaW5nPlxuICBhYnN0cmFjdCBpc0F2YWlsYWJsZSgpOiBQcm9taXNlPGJvb2xlYW4+XG59XG5cbi8vIEdvb2dsZSBHZW1pbmkgUHJvdmlkZXJcbmV4cG9ydCBjbGFzcyBHb29nbGVHZW1pbmlQcm92aWRlciBleHRlbmRzIEJhc2VBSVByb3ZpZGVyIHtcbiAgYXN5bmMgZ2VuZXJhdGVFeGVyY2lzZShwcm9tcHQ6IHN0cmluZyk6IFByb21pc2U8c3RyaW5nPiB7XG4gICAgaWYgKCF0aGlzLmNvbmZpZy5hcGlLZXkpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignR29vZ2xlIEFJIEFQSSBrZXkgbm90IGNvbmZpZ3VyZWQnKVxuICAgIH1cblxuICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2goYGh0dHBzOi8vZ2VuZXJhdGl2ZWxhbmd1YWdlLmdvb2dsZWFwaXMuY29tL3YxYmV0YS9tb2RlbHMvJHt0aGlzLmNvbmZpZy5tb2RlbH06Z2VuZXJhdGVDb250ZW50P2tleT0ke3RoaXMuY29uZmlnLmFwaUtleX1gLCB7XG4gICAgICBtZXRob2Q6ICdQT1NUJyxcbiAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJyxcbiAgICAgIH0sXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgIGNvbnRlbnRzOiBbe1xuICAgICAgICAgIHBhcnRzOiBbe1xuICAgICAgICAgICAgdGV4dDogcHJvbXB0XG4gICAgICAgICAgfV1cbiAgICAgICAgfV0sXG4gICAgICAgIGdlbmVyYXRpb25Db25maWc6IHtcbiAgICAgICAgICB0ZW1wZXJhdHVyZTogMC43LFxuICAgICAgICAgIHRvcEs6IDEsXG4gICAgICAgICAgdG9wUDogMSxcbiAgICAgICAgICBtYXhPdXRwdXRUb2tlbnM6IDUwMCxcbiAgICAgICAgfVxuICAgICAgfSlcbiAgICB9KVxuXG4gICAgaWYgKCFyZXNwb25zZS5vaykge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBHb29nbGUgQUkgQVBJIGVycm9yOiAke3Jlc3BvbnNlLnN0YXR1c31gKVxuICAgIH1cblxuICAgIGNvbnN0IGRhdGEgPSBhd2FpdCByZXNwb25zZS5qc29uKClcbiAgICByZXR1cm4gZGF0YS5jYW5kaWRhdGVzWzBdPy5jb250ZW50Py5wYXJ0c1swXT8udGV4dCB8fCAnRXJyb3IgZ2VuZXJhdGluZyBjb250ZW50J1xuICB9XG5cbiAgYXN5bmMgaXNBdmFpbGFibGUoKTogUHJvbWlzZTxib29sZWFuPiB7XG4gICAgcmV0dXJuICEhdGhpcy5jb25maWcuYXBpS2V5XG4gIH1cbn1cblxuLy8gSHVnZ2luZyBGYWNlIFByb3ZpZGVyXG5leHBvcnQgY2xhc3MgSHVnZ2luZ0ZhY2VQcm92aWRlciBleHRlbmRzIEJhc2VBSVByb3ZpZGVyIHtcbiAgYXN5bmMgZ2VuZXJhdGVFeGVyY2lzZShwcm9tcHQ6IHN0cmluZyk6IFByb21pc2U8c3RyaW5nPiB7XG4gICAgaWYgKCF0aGlzLmNvbmZpZy5hcGlLZXkpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignSHVnZ2luZyBGYWNlIEFQSSBrZXkgbm90IGNvbmZpZ3VyZWQnKVxuICAgIH1cblxuICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2goYCR7dGhpcy5jb25maWcuYmFzZVVybH0vJHt0aGlzLmNvbmZpZy5tb2RlbH1gLCB7XG4gICAgICBtZXRob2Q6ICdQT1NUJyxcbiAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgJ0F1dGhvcml6YXRpb24nOiBgQmVhcmVyICR7dGhpcy5jb25maWcuYXBpS2V5fWAsXG4gICAgICAgICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicsXG4gICAgICB9LFxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICBpbnB1dHM6IHByb21wdCxcbiAgICAgICAgcGFyYW1ldGVyczoge1xuICAgICAgICAgIG1heF9uZXdfdG9rZW5zOiAzMDAsXG4gICAgICAgICAgdGVtcGVyYXR1cmU6IDAuNyxcbiAgICAgICAgICByZXR1cm5fZnVsbF90ZXh0OiBmYWxzZVxuICAgICAgICB9XG4gICAgICB9KVxuICAgIH0pXG5cbiAgICBpZiAoIXJlc3BvbnNlLm9rKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYEh1Z2dpbmcgRmFjZSBBUEkgZXJyb3I6ICR7cmVzcG9uc2Uuc3RhdHVzfWApXG4gICAgfVxuXG4gICAgY29uc3QgZGF0YSA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKVxuICAgIHJldHVybiBkYXRhWzBdPy5nZW5lcmF0ZWRfdGV4dCB8fCAnRXJyb3IgZ2VuZXJhdGluZyBjb250ZW50J1xuICB9XG5cbiAgYXN5bmMgaXNBdmFpbGFibGUoKTogUHJvbWlzZTxib29sZWFuPiB7XG4gICAgcmV0dXJuICEhdGhpcy5jb25maWcuYXBpS2V5XG4gIH1cbn1cblxuLy8gT2xsYW1hIExvY2FsIFByb3ZpZGVyXG5leHBvcnQgY2xhc3MgT2xsYW1hUHJvdmlkZXIgZXh0ZW5kcyBCYXNlQUlQcm92aWRlciB7XG4gIGFzeW5jIGdlbmVyYXRlRXhlcmNpc2UocHJvbXB0OiBzdHJpbmcpOiBQcm9taXNlPHN0cmluZz4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKGAke3RoaXMuY29uZmlnLmJhc2VVcmx9L2FwaS9nZW5lcmF0ZWAsIHtcbiAgICAgICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nLFxuICAgICAgICB9LFxuICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgICAgbW9kZWw6IHRoaXMuY29uZmlnLm1vZGVsLFxuICAgICAgICAgIHByb21wdDogcHJvbXB0LFxuICAgICAgICAgIHN0cmVhbTogZmFsc2UsXG4gICAgICAgICAgb3B0aW9uczoge1xuICAgICAgICAgICAgdGVtcGVyYXR1cmU6IDAuNyxcbiAgICAgICAgICAgIG51bV9wcmVkaWN0OiAzMDBcbiAgICAgICAgICB9XG4gICAgICAgIH0pXG4gICAgICB9KVxuXG4gICAgICBpZiAoIXJlc3BvbnNlLm9rKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihgT2xsYW1hIEFQSSBlcnJvcjogJHtyZXNwb25zZS5zdGF0dXN9YClcbiAgICAgIH1cblxuICAgICAgY29uc3QgZGF0YSA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKVxuICAgICAgcmV0dXJuIGRhdGEucmVzcG9uc2UgfHwgJ0Vycm9yIGdlbmVyYXRpbmcgY29udGVudCdcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBPbGxhbWEgY29ubmVjdGlvbiBmYWlsZWQ6ICR7ZXJyb3J9YClcbiAgICB9XG4gIH1cblxuICBhc3luYyBpc0F2YWlsYWJsZSgpOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaChgJHt0aGlzLmNvbmZpZy5iYXNlVXJsfS9hcGkvdmVyc2lvbmAsIHtcbiAgICAgICAgbWV0aG9kOiAnR0VUJyxcbiAgICAgICAgc2lnbmFsOiBBYm9ydFNpZ25hbC50aW1lb3V0KDMwMDApIC8vIDMgc2Vjb25kIHRpbWVvdXRcbiAgICAgIH0pXG4gICAgICByZXR1cm4gcmVzcG9uc2Uub2tcbiAgICB9IGNhdGNoIHtcbiAgICAgIHJldHVybiBmYWxzZVxuICAgIH1cbiAgfVxufVxuXG4vLyBUcmFuc2Zvcm1lcnMuanMgUHJvdmlkZXIgKEJyb3dzZXItYmFzZWQpXG5leHBvcnQgY2xhc3MgVHJhbnNmb3JtZXJzSlNQcm92aWRlciBleHRlbmRzIEJhc2VBSVByb3ZpZGVyIHtcbiAgcHJpdmF0ZSBwaXBlbGluZTogYW55ID0gbnVsbFxuXG4gIGFzeW5jIGdlbmVyYXRlRXhlcmNpc2UocHJvbXB0OiBzdHJpbmcpOiBQcm9taXNlPHN0cmluZz4ge1xuICAgIGlmICghdGhpcy5waXBlbGluZSkge1xuICAgICAgY29uc3QgeyBwaXBlbGluZSB9ID0gYXdhaXQgaW1wb3J0KCdAeGVub3ZhL3RyYW5zZm9ybWVycycpXG4gICAgICB0aGlzLnBpcGVsaW5lID0gYXdhaXQgcGlwZWxpbmUoJ3RleHQtZ2VuZXJhdGlvbicsICdYZW5vdmEvZ3B0MicpXG4gICAgfVxuXG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5waXBlbGluZShwcm9tcHQsIHtcbiAgICAgIG1heF9uZXdfdG9rZW5zOiAxNTAsXG4gICAgICB0ZW1wZXJhdHVyZTogMC43XG4gICAgfSlcblxuICAgIHJldHVybiByZXN1bHRbMF0/LmdlbmVyYXRlZF90ZXh0Py5yZXBsYWNlKHByb21wdCwgJycpLnRyaW0oKSB8fCAnRXJyb3IgZ2VuZXJhdGluZyBjb250ZW50J1xuICB9XG5cbiAgYXN5bmMgaXNBdmFpbGFibGUoKTogUHJvbWlzZTxib29sZWFuPiB7XG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IGltcG9ydCgnQHhlbm92YS90cmFuc2Zvcm1lcnMnKVxuICAgICAgcmV0dXJuIHRydWVcbiAgICB9IGNhdGNoIHtcbiAgICAgIHJldHVybiBmYWxzZVxuICAgIH1cbiAgfVxufVxuXG4vLyBHcm9xIFByb3ZpZGVyXG5leHBvcnQgY2xhc3MgR3JvcVByb3ZpZGVyIGV4dGVuZHMgQmFzZUFJUHJvdmlkZXIge1xuICBhc3luYyBnZW5lcmF0ZUV4ZXJjaXNlKHByb21wdDogc3RyaW5nKTogUHJvbWlzZTxzdHJpbmc+IHtcbiAgICBpZiAoIXRoaXMuY29uZmlnLmFwaUtleSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdHcm9xIEFQSSBrZXkgbm90IGNvbmZpZ3VyZWQnKVxuICAgIH1cblxuICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2goYCR7dGhpcy5jb25maWcuYmFzZVVybH0vY2hhdC9jb21wbGV0aW9uc2AsIHtcbiAgICAgIG1ldGhvZDogJ1BPU1QnLFxuICAgICAgaGVhZGVyczoge1xuICAgICAgICAnQXV0aG9yaXphdGlvbic6IGBCZWFyZXIgJHt0aGlzLmNvbmZpZy5hcGlLZXl9YCxcbiAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJyxcbiAgICAgIH0sXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgIG1vZGVsOiB0aGlzLmNvbmZpZy5tb2RlbCxcbiAgICAgICAgbWVzc2FnZXM6IFtcbiAgICAgICAgICB7XG4gICAgICAgICAgICByb2xlOiAnc3lzdGVtJyxcbiAgICAgICAgICAgIGNvbnRlbnQ6ICdFcmVzIFNhcmEsIHVuIGFzaXN0ZW50ZSBwZXJzb25hbCBhY2Fkw6ltaWNvIGVzcGVjaWFsaXphZG8gZW4gYXl1ZGFyIGEgZXN0dWRpYW50ZXMgY29uIG9yZ2FuaXphY2nDs24sIHBsYW5pZmljYWNpw7NuIHkgYXByZW5kaXphamUuIFJlc3BvbmRlIGRlIG1hbmVyYSBjbGFyYSwgcHLDoWN0aWNhIHkgbW90aXZhY2lvbmFsLidcbiAgICAgICAgICB9LFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIHJvbGU6ICd1c2VyJyxcbiAgICAgICAgICAgIGNvbnRlbnQ6IHByb21wdFxuICAgICAgICAgIH1cbiAgICAgICAgXSxcbiAgICAgICAgdGVtcGVyYXR1cmU6IDAuNyxcbiAgICAgICAgbWF4X3Rva2VuczogNTAwLFxuICAgICAgICB0b3BfcDogMC45XG4gICAgICB9KVxuICAgIH0pXG5cbiAgICBpZiAoIXJlc3BvbnNlLm9rKSB7XG4gICAgICBjb25zdCBlcnJvckRhdGEgPSBhd2FpdCByZXNwb25zZS50ZXh0KClcbiAgICAgIHRocm93IG5ldyBFcnJvcihgR3JvcSBBUEkgZXJyb3IgKCR7cmVzcG9uc2Uuc3RhdHVzfSk6ICR7ZXJyb3JEYXRhfWApXG4gICAgfVxuXG4gICAgY29uc3QgZGF0YSA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKVxuICAgIHJldHVybiBkYXRhLmNob2ljZXNbMF0/Lm1lc3NhZ2U/LmNvbnRlbnQgfHwgJ0Vycm9yIGdlbmVyYXRpbmcgY29udGVudCdcbiAgfVxuXG4gIGFzeW5jIGlzQXZhaWxhYmxlKCk6IFByb21pc2U8Ym9vbGVhbj4ge1xuICAgIGlmICghdGhpcy5jb25maWcuYXBpS2V5KSByZXR1cm4gZmFsc2VcbiAgICBcbiAgICB0cnkge1xuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaChgJHt0aGlzLmNvbmZpZy5iYXNlVXJsfS9tb2RlbHNgLCB7XG4gICAgICAgIG1ldGhvZDogJ0dFVCcsXG4gICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICAnQXV0aG9yaXphdGlvbic6IGBCZWFyZXIgJHt0aGlzLmNvbmZpZy5hcGlLZXl9YCxcbiAgICAgICAgfSxcbiAgICAgICAgc2lnbmFsOiBBYm9ydFNpZ25hbC50aW1lb3V0KDUwMDApIC8vIDUgc2Vjb25kIHRpbWVvdXRcbiAgICAgIH0pXG4gICAgICByZXR1cm4gcmVzcG9uc2Uub2tcbiAgICB9IGNhdGNoIHtcbiAgICAgIHJldHVybiBmYWxzZVxuICAgIH1cbiAgfVxufVxuXG4vLyBUZW1wbGF0ZSBQcm92aWRlciAoQWx3YXlzIEF2YWlsYWJsZSBGYWxsYmFjaylcbmV4cG9ydCBjbGFzcyBUZW1wbGF0ZVByb3ZpZGVyIGV4dGVuZHMgQmFzZUFJUHJvdmlkZXIge1xuICBhc3luYyBnZW5lcmF0ZUV4ZXJjaXNlKHByb21wdDogc3RyaW5nKTogUHJvbWlzZTxzdHJpbmc+IHtcbiAgICAvLyBUaGlzIHdpbGwgdXNlIHRoZSBleGlzdGluZyB0ZW1wbGF0ZSBzeXN0ZW1cbiAgICByZXR1cm4gJ1RFTVBMQVRFX0ZBTExCQUNLJ1xuICB9XG5cbiAgYXN5bmMgaXNBdmFpbGFibGUoKTogUHJvbWlzZTxib29sZWFuPiB7XG4gICAgcmV0dXJuIHRydWVcbiAgfVxufVxuXG4vLyBQcm92aWRlciBGYWN0b3J5XG5leHBvcnQgY2xhc3MgQUlQcm92aWRlckZhY3Rvcnkge1xuICBzdGF0aWMgY3JlYXRlUHJvdmlkZXIoY29uZmlnOiBBSUNvbmZpZyk6IEJhc2VBSVByb3ZpZGVyIHtcbiAgICBzd2l0Y2ggKGNvbmZpZy5wcm92aWRlcikge1xuICAgICAgY2FzZSBBSVByb3ZpZGVyLkdPT0dMRV9HRU1JTkk6XG4gICAgICAgIHJldHVybiBuZXcgR29vZ2xlR2VtaW5pUHJvdmlkZXIoY29uZmlnKVxuICAgICAgY2FzZSBBSVByb3ZpZGVyLkdST1E6XG4gICAgICAgIHJldHVybiBuZXcgR3JvcVByb3ZpZGVyKGNvbmZpZylcbiAgICAgIGNhc2UgQUlQcm92aWRlci5IVUdHSU5HX0ZBQ0U6XG4gICAgICAgIHJldHVybiBuZXcgSHVnZ2luZ0ZhY2VQcm92aWRlcihjb25maWcpXG4gICAgICBjYXNlIEFJUHJvdmlkZXIuT0xMQU1BX0xPQ0FMOlxuICAgICAgICByZXR1cm4gbmV3IE9sbGFtYVByb3ZpZGVyKGNvbmZpZylcbiAgICAgIGNhc2UgQUlQcm92aWRlci5UUkFOU0ZPUk1FUlNfSlM6XG4gICAgICAgIHJldHVybiBuZXcgVHJhbnNmb3JtZXJzSlNQcm92aWRlcihjb25maWcpXG4gICAgICBjYXNlIEFJUHJvdmlkZXIuVEVNUExBVEVTX09OTFk6XG4gICAgICAgIHJldHVybiBuZXcgVGVtcGxhdGVQcm92aWRlcihjb25maWcpXG4gICAgICBkZWZhdWx0OlxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYFVua25vd24gQUkgcHJvdmlkZXI6ICR7Y29uZmlnLnByb3ZpZGVyfWApXG4gICAgfVxuICB9XG59XG5cbi8vIE1haW4gQUkgU2VydmljZSB3aXRoIEZhbGxiYWNrIFN5c3RlbVxuZXhwb3J0IGNsYXNzIEFJU2VydmljZSB7XG4gIHByaXZhdGUgcHJvdmlkZXJzOiBCYXNlQUlQcm92aWRlcltdID0gW11cbiAgcHJpdmF0ZSBjdXJyZW50UHJvdmlkZXJJbmRleCA9IDBcblxuICBjb25zdHJ1Y3RvcigpIHtcbiAgICB0aGlzLmluaXRpYWxpemVQcm92aWRlcnMoKVxuICB9XG5cbiAgcHJpdmF0ZSBpbml0aWFsaXplUHJvdmlkZXJzKCkge1xuICAgIHRoaXMucHJvdmlkZXJzID0gQUlfQ09ORklHXG4gICAgICAuZmlsdGVyKGNvbmZpZyA9PiBjb25maWcuZW5hYmxlZClcbiAgICAgIC5tYXAoY29uZmlnID0+IEFJUHJvdmlkZXJGYWN0b3J5LmNyZWF0ZVByb3ZpZGVyKGNvbmZpZykpXG4gIH1cblxuICBhc3luYyBnZW5lcmF0ZUV4ZXJjaXNlKHByb21wdDogc3RyaW5nKTogUHJvbWlzZTxzdHJpbmc+IHtcbiAgICBmb3IgKGxldCBpID0gdGhpcy5jdXJyZW50UHJvdmlkZXJJbmRleDsgaSA8IHRoaXMucHJvdmlkZXJzLmxlbmd0aDsgaSsrKSB7XG4gICAgICBjb25zdCBwcm92aWRlciA9IHRoaXMucHJvdmlkZXJzW2ldXG4gICAgICBcbiAgICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IGlzQXZhaWxhYmxlID0gYXdhaXQgcHJvdmlkZXIuaXNBdmFpbGFibGUoKVxuICAgICAgICBpZiAoIWlzQXZhaWxhYmxlKSB7XG4gICAgICAgICAgY29uc29sZS5sb2coYFByb3ZpZGVyICR7aX0gbm90IGF2YWlsYWJsZSwgdHJ5aW5nIG5leHQuLi5gKVxuICAgICAgICAgIGNvbnRpbnVlXG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBwcm92aWRlci5nZW5lcmF0ZUV4ZXJjaXNlKHByb21wdClcbiAgICAgICAgXG4gICAgICAgIGlmIChyZXN1bHQgPT09ICdURU1QTEFURV9GQUxMQkFDSycpIHtcbiAgICAgICAgICByZXR1cm4gcmVzdWx0IC8vIFNwZWNpYWwgbWFya2VyIGZvciB0ZW1wbGF0ZSBzeXN0ZW1cbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgaWYgKHJlc3VsdCAmJiByZXN1bHQubGVuZ3RoID4gMTApIHsgLy8gQmFzaWMgcXVhbGl0eSBjaGVja1xuICAgICAgICAgIHRoaXMuY3VycmVudFByb3ZpZGVySW5kZXggPSBpIC8vIFJlbWVtYmVyIHdvcmtpbmcgcHJvdmlkZXJcbiAgICAgICAgICByZXR1cm4gcmVzdWx0XG4gICAgICAgIH1cbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoYFByb3ZpZGVyICR7aX0gZmFpbGVkOmAsIGVycm9yKVxuICAgICAgICBjb250aW51ZVxuICAgICAgfVxuICAgIH1cblxuICAgIC8vIElmIGFsbCBwcm92aWRlcnMgZmFpbCwgcmV0dXJuIHRlbXBsYXRlIGZhbGxiYWNrIG1hcmtlclxuICAgIHJldHVybiAnVEVNUExBVEVfRkFMTEJBQ0snXG4gIH1cblxuICBhc3luYyBnZXRBdmFpbGFibGVQcm92aWRlcnMoKTogUHJvbWlzZTxzdHJpbmdbXT4ge1xuICAgIGNvbnN0IGF2YWlsYWJsZSA9IFtdXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLnByb3ZpZGVycy5sZW5ndGg7IGkrKykge1xuICAgICAgdHJ5IHtcbiAgICAgICAgY29uc3QgaXNBdmFpbGFibGUgPSBhd2FpdCB0aGlzLnByb3ZpZGVyc1tpXS5pc0F2YWlsYWJsZSgpXG4gICAgICAgIGlmIChpc0F2YWlsYWJsZSkge1xuICAgICAgICAgIGF2YWlsYWJsZS5wdXNoKEFJX0NPTkZJR1tpXS5wcm92aWRlcilcbiAgICAgICAgfVxuICAgICAgfSBjYXRjaCB7XG4gICAgICAgIC8vIFByb3ZpZGVyIG5vdCBhdmFpbGFibGVcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGF2YWlsYWJsZVxuICB9XG59XG5cbi8vIEV4cG9ydCBzaW5nbGV0b24gaW5zdGFuY2VcbmV4cG9ydCBjb25zdCBhaVNlcnZpY2UgPSBuZXcgQUlTZXJ2aWNlKCkiXSwibmFtZXMiOlsiQUlQcm92aWRlciIsIkFJX0NPTkZJRyIsInByb3ZpZGVyIiwiYXBpS2V5IiwicHJvY2VzcyIsImVudiIsIkdST1FfQVBJX0tFWSIsImJhc2VVcmwiLCJtb2RlbCIsImVuYWJsZWQiLCJHT09HTEVfQUlfQVBJX0tFWSIsIkhVR0dJTkdfRkFDRV9BUElfS0VZIiwiT0xMQU1BX1VSTCIsIk9MTEFNQV9NT0RFTCIsIk9MTEFNQV9FTkFCTEVEIiwiVFJBTlNGT1JNRVJTX0pTX0VOQUJMRUQiLCJCYXNlQUlQcm92aWRlciIsImNvbnN0cnVjdG9yIiwiY29uZmlnIiwiR29vZ2xlR2VtaW5pUHJvdmlkZXIiLCJnZW5lcmF0ZUV4ZXJjaXNlIiwicHJvbXB0IiwiRXJyb3IiLCJyZXNwb25zZSIsImZldGNoIiwibWV0aG9kIiwiaGVhZGVycyIsImJvZHkiLCJKU09OIiwic3RyaW5naWZ5IiwiY29udGVudHMiLCJwYXJ0cyIsInRleHQiLCJnZW5lcmF0aW9uQ29uZmlnIiwidGVtcGVyYXR1cmUiLCJ0b3BLIiwidG9wUCIsIm1heE91dHB1dFRva2VucyIsIm9rIiwic3RhdHVzIiwiZGF0YSIsImpzb24iLCJjYW5kaWRhdGVzIiwiY29udGVudCIsImlzQXZhaWxhYmxlIiwiSHVnZ2luZ0ZhY2VQcm92aWRlciIsImlucHV0cyIsInBhcmFtZXRlcnMiLCJtYXhfbmV3X3Rva2VucyIsInJldHVybl9mdWxsX3RleHQiLCJnZW5lcmF0ZWRfdGV4dCIsIk9sbGFtYVByb3ZpZGVyIiwic3RyZWFtIiwib3B0aW9ucyIsIm51bV9wcmVkaWN0IiwiZXJyb3IiLCJzaWduYWwiLCJBYm9ydFNpZ25hbCIsInRpbWVvdXQiLCJUcmFuc2Zvcm1lcnNKU1Byb3ZpZGVyIiwicGlwZWxpbmUiLCJyZXN1bHQiLCJyZXBsYWNlIiwidHJpbSIsIkdyb3FQcm92aWRlciIsIm1lc3NhZ2VzIiwicm9sZSIsIm1heF90b2tlbnMiLCJ0b3BfcCIsImVycm9yRGF0YSIsImNob2ljZXMiLCJtZXNzYWdlIiwiVGVtcGxhdGVQcm92aWRlciIsIkFJUHJvdmlkZXJGYWN0b3J5IiwiY3JlYXRlUHJvdmlkZXIiLCJBSVNlcnZpY2UiLCJwcm92aWRlcnMiLCJjdXJyZW50UHJvdmlkZXJJbmRleCIsImluaXRpYWxpemVQcm92aWRlcnMiLCJmaWx0ZXIiLCJtYXAiLCJpIiwibGVuZ3RoIiwiY29uc29sZSIsImxvZyIsImdldEF2YWlsYWJsZVByb3ZpZGVycyIsImF2YWlsYWJsZSIsInB1c2giLCJhaVNlcnZpY2UiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/ai-providers.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/auth.ts":
/*!*************************!*\
  !*** ./src/lib/auth.ts ***!
  \*************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   authOptions: () => (/* binding */ authOptions)\n/* harmony export */ });\n/* harmony import */ var next_auth_providers_credentials__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next-auth/providers/credentials */ \"(rsc)/./node_modules/next-auth/providers/credentials.js\");\n/* harmony import */ var bcryptjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! bcryptjs */ \"(rsc)/./node_modules/bcryptjs/index.js\");\n/* harmony import */ var _hybrid_storage__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./hybrid-storage */ \"(rsc)/./src/lib/hybrid-storage.ts\");\n\n\n\nconst authOptions = {\n    providers: [\n        (0,next_auth_providers_credentials__WEBPACK_IMPORTED_MODULE_0__[\"default\"])({\n            name: \"credentials\",\n            credentials: {\n                email: {\n                    label: \"Email\",\n                    type: \"email\"\n                },\n                password: {\n                    label: \"Password\",\n                    type: \"password\"\n                }\n            },\n            async authorize (credentials) {\n                if (!credentials?.email || !credentials?.password) {\n                    return null;\n                }\n                // Find user in database\n                const user = await (0,_hybrid_storage__WEBPACK_IMPORTED_MODULE_2__.findUserByEmail)(credentials.email);\n                if (!user || !user.password) {\n                    return null;\n                }\n                const isPasswordValid = await bcryptjs__WEBPACK_IMPORTED_MODULE_1__[\"default\"].compare(credentials.password, user.password);\n                if (!isPasswordValid) {\n                    return null;\n                }\n                return {\n                    id: user.id,\n                    email: user.email,\n                    name: user.name,\n                    role: user.role,\n                    studentId: user.studentId || undefined\n                };\n            }\n        })\n    ],\n    session: {\n        strategy: \"jwt\"\n    },\n    callbacks: {\n        async jwt ({ token, user }) {\n            if (user) {\n                token.role = user.role;\n                token.studentId = user.studentId;\n            }\n            return token;\n        },\n        async session ({ session, token }) {\n            if (token) {\n                session.user.id = token.sub;\n                session.user.role = token.role;\n                session.user.studentId = token.studentId;\n            }\n            return session;\n        },\n        async redirect ({ url, baseUrl }) {\n            // Handle internal redirects\n            if (url.startsWith(\"/\")) return `${baseUrl}${url}`;\n            else if (new URL(url).origin === baseUrl) return url;\n            // Default to home page for external redirects\n            return baseUrl;\n        },\n        async signIn ({ user, account, profile }) {\n            return true;\n        }\n    },\n    pages: {\n        signIn: \"/auth/signin\"\n    }\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvbGliL2F1dGgudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUNpRTtBQUNwQztBQUNxQjtBQUUzQyxNQUFNRyxjQUErQjtJQUMxQ0MsV0FBVztRQUNUSiwyRUFBbUJBLENBQUM7WUFDbEJLLE1BQU07WUFDTkMsYUFBYTtnQkFDWEMsT0FBTztvQkFBRUMsT0FBTztvQkFBU0MsTUFBTTtnQkFBUTtnQkFDdkNDLFVBQVU7b0JBQUVGLE9BQU87b0JBQVlDLE1BQU07Z0JBQVc7WUFDbEQ7WUFDQSxNQUFNRSxXQUFVTCxXQUFXO2dCQUN6QixJQUFJLENBQUNBLGFBQWFDLFNBQVMsQ0FBQ0QsYUFBYUksVUFBVTtvQkFDakQsT0FBTztnQkFDVDtnQkFFQSx3QkFBd0I7Z0JBQ3hCLE1BQU1FLE9BQU8sTUFBTVYsZ0VBQWVBLENBQUNJLFlBQVlDLEtBQUs7Z0JBRXBELElBQUksQ0FBQ0ssUUFBUSxDQUFDQSxLQUFLRixRQUFRLEVBQUU7b0JBQzNCLE9BQU87Z0JBQ1Q7Z0JBRUEsTUFBTUcsa0JBQWtCLE1BQU1aLHdEQUFjLENBQzFDSyxZQUFZSSxRQUFRLEVBQ3BCRSxLQUFLRixRQUFRO2dCQUdmLElBQUksQ0FBQ0csaUJBQWlCO29CQUNwQixPQUFPO2dCQUNUO2dCQUVBLE9BQU87b0JBQ0xFLElBQUlILEtBQUtHLEVBQUU7b0JBQ1hSLE9BQU9LLEtBQUtMLEtBQUs7b0JBQ2pCRixNQUFNTyxLQUFLUCxJQUFJO29CQUNmVyxNQUFNSixLQUFLSSxJQUFJO29CQUNmQyxXQUFXTCxLQUFLSyxTQUFTLElBQUlDO2dCQUMvQjtZQUNGO1FBQ0Y7S0FDRDtJQUNEQyxTQUFTO1FBQ1BDLFVBQVU7SUFDWjtJQUNBQyxXQUFXO1FBQ1QsTUFBTUMsS0FBSSxFQUFFQyxLQUFLLEVBQUVYLElBQUksRUFBRTtZQUN2QixJQUFJQSxNQUFNO2dCQUNSVyxNQUFNUCxJQUFJLEdBQUdKLEtBQUtJLElBQUk7Z0JBQ3RCTyxNQUFNTixTQUFTLEdBQUdMLEtBQUtLLFNBQVM7WUFDbEM7WUFDQSxPQUFPTTtRQUNUO1FBQ0EsTUFBTUosU0FBUSxFQUFFQSxPQUFPLEVBQUVJLEtBQUssRUFBRTtZQUM5QixJQUFJQSxPQUFPO2dCQUNUSixRQUFRUCxJQUFJLENBQUNHLEVBQUUsR0FBR1EsTUFBTUMsR0FBRztnQkFDM0JMLFFBQVFQLElBQUksQ0FBQ0ksSUFBSSxHQUFHTyxNQUFNUCxJQUFJO2dCQUM5QkcsUUFBUVAsSUFBSSxDQUFDSyxTQUFTLEdBQUdNLE1BQU1OLFNBQVM7WUFDMUM7WUFDQSxPQUFPRTtRQUNUO1FBQ0EsTUFBTU0sVUFBUyxFQUFFQyxHQUFHLEVBQUVDLE9BQU8sRUFBRTtZQUM3Qiw0QkFBNEI7WUFDNUIsSUFBSUQsSUFBSUUsVUFBVSxDQUFDLE1BQU0sT0FBTyxHQUFHRCxVQUFVRCxLQUFLO2lCQUM3QyxJQUFJLElBQUlHLElBQUlILEtBQUtJLE1BQU0sS0FBS0gsU0FBUyxPQUFPRDtZQUVqRCw4Q0FBOEM7WUFDOUMsT0FBT0M7UUFDVDtRQUNBLE1BQU1JLFFBQU8sRUFBRW5CLElBQUksRUFBRW9CLE9BQU8sRUFBRUMsT0FBTyxFQUFFO1lBQ3JDLE9BQU87UUFDVDtJQUNGO0lBQ0FDLE9BQU87UUFDTEgsUUFBUTtJQUNWO0FBQ0YsRUFBQyIsInNvdXJjZXMiOlsiL1VzZXJzL3JvZHJpZ29kaWJlcm5hcmRvMzNnbWFpbC5jb20vRG9jdW1lbnRzL0FwcCBEZXZlbG9wbWVudCBQcm95ZWN0cy9JbnRlbGxlZ28gUGxhdGZvcm0vc3JjL2xpYi9hdXRoLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IE5leHRBdXRoT3B0aW9ucyB9IGZyb20gXCJuZXh0LWF1dGhcIlxuaW1wb3J0IENyZWRlbnRpYWxzUHJvdmlkZXIgZnJvbSBcIm5leHQtYXV0aC9wcm92aWRlcnMvY3JlZGVudGlhbHNcIlxuaW1wb3J0IGJjcnlwdCBmcm9tIFwiYmNyeXB0anNcIlxuaW1wb3J0IHsgZmluZFVzZXJCeUVtYWlsIH0gZnJvbSBcIi4vaHlicmlkLXN0b3JhZ2VcIlxuXG5leHBvcnQgY29uc3QgYXV0aE9wdGlvbnM6IE5leHRBdXRoT3B0aW9ucyA9IHtcbiAgcHJvdmlkZXJzOiBbXG4gICAgQ3JlZGVudGlhbHNQcm92aWRlcih7XG4gICAgICBuYW1lOiBcImNyZWRlbnRpYWxzXCIsXG4gICAgICBjcmVkZW50aWFsczoge1xuICAgICAgICBlbWFpbDogeyBsYWJlbDogXCJFbWFpbFwiLCB0eXBlOiBcImVtYWlsXCIgfSxcbiAgICAgICAgcGFzc3dvcmQ6IHsgbGFiZWw6IFwiUGFzc3dvcmRcIiwgdHlwZTogXCJwYXNzd29yZFwiIH1cbiAgICAgIH0sXG4gICAgICBhc3luYyBhdXRob3JpemUoY3JlZGVudGlhbHMpIHtcbiAgICAgICAgaWYgKCFjcmVkZW50aWFscz8uZW1haWwgfHwgIWNyZWRlbnRpYWxzPy5wYXNzd29yZCkge1xuICAgICAgICAgIHJldHVybiBudWxsXG4gICAgICAgIH1cblxuICAgICAgICAvLyBGaW5kIHVzZXIgaW4gZGF0YWJhc2VcbiAgICAgICAgY29uc3QgdXNlciA9IGF3YWl0IGZpbmRVc2VyQnlFbWFpbChjcmVkZW50aWFscy5lbWFpbClcblxuICAgICAgICBpZiAoIXVzZXIgfHwgIXVzZXIucGFzc3dvcmQpIHtcbiAgICAgICAgICByZXR1cm4gbnVsbFxuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgaXNQYXNzd29yZFZhbGlkID0gYXdhaXQgYmNyeXB0LmNvbXBhcmUoXG4gICAgICAgICAgY3JlZGVudGlhbHMucGFzc3dvcmQsXG4gICAgICAgICAgdXNlci5wYXNzd29yZFxuICAgICAgICApXG5cbiAgICAgICAgaWYgKCFpc1Bhc3N3b3JkVmFsaWQpIHtcbiAgICAgICAgICByZXR1cm4gbnVsbFxuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBpZDogdXNlci5pZCxcbiAgICAgICAgICBlbWFpbDogdXNlci5lbWFpbCxcbiAgICAgICAgICBuYW1lOiB1c2VyLm5hbWUsXG4gICAgICAgICAgcm9sZTogdXNlci5yb2xlLFxuICAgICAgICAgIHN0dWRlbnRJZDogdXNlci5zdHVkZW50SWQgfHwgdW5kZWZpbmVkLFxuICAgICAgICB9XG4gICAgICB9XG4gICAgfSlcbiAgXSxcbiAgc2Vzc2lvbjoge1xuICAgIHN0cmF0ZWd5OiBcImp3dFwiLFxuICB9LFxuICBjYWxsYmFja3M6IHtcbiAgICBhc3luYyBqd3QoeyB0b2tlbiwgdXNlciB9KSB7XG4gICAgICBpZiAodXNlcikge1xuICAgICAgICB0b2tlbi5yb2xlID0gdXNlci5yb2xlXG4gICAgICAgIHRva2VuLnN0dWRlbnRJZCA9IHVzZXIuc3R1ZGVudElkXG4gICAgICB9XG4gICAgICByZXR1cm4gdG9rZW5cbiAgICB9LFxuICAgIGFzeW5jIHNlc3Npb24oeyBzZXNzaW9uLCB0b2tlbiB9KSB7XG4gICAgICBpZiAodG9rZW4pIHtcbiAgICAgICAgc2Vzc2lvbi51c2VyLmlkID0gdG9rZW4uc3ViIVxuICAgICAgICBzZXNzaW9uLnVzZXIucm9sZSA9IHRva2VuLnJvbGUgYXMgc3RyaW5nXG4gICAgICAgIHNlc3Npb24udXNlci5zdHVkZW50SWQgPSB0b2tlbi5zdHVkZW50SWQgYXMgc3RyaW5nXG4gICAgICB9XG4gICAgICByZXR1cm4gc2Vzc2lvblxuICAgIH0sXG4gICAgYXN5bmMgcmVkaXJlY3QoeyB1cmwsIGJhc2VVcmwgfSkge1xuICAgICAgLy8gSGFuZGxlIGludGVybmFsIHJlZGlyZWN0c1xuICAgICAgaWYgKHVybC5zdGFydHNXaXRoKFwiL1wiKSkgcmV0dXJuIGAke2Jhc2VVcmx9JHt1cmx9YFxuICAgICAgZWxzZSBpZiAobmV3IFVSTCh1cmwpLm9yaWdpbiA9PT0gYmFzZVVybCkgcmV0dXJuIHVybFxuICAgICAgXG4gICAgICAvLyBEZWZhdWx0IHRvIGhvbWUgcGFnZSBmb3IgZXh0ZXJuYWwgcmVkaXJlY3RzXG4gICAgICByZXR1cm4gYmFzZVVybFxuICAgIH0sXG4gICAgYXN5bmMgc2lnbkluKHsgdXNlciwgYWNjb3VudCwgcHJvZmlsZSB9KSB7XG4gICAgICByZXR1cm4gdHJ1ZVxuICAgIH1cbiAgfSxcbiAgcGFnZXM6IHtcbiAgICBzaWduSW46IFwiL2F1dGgvc2lnbmluXCIsXG4gIH0sXG59Il0sIm5hbWVzIjpbIkNyZWRlbnRpYWxzUHJvdmlkZXIiLCJiY3J5cHQiLCJmaW5kVXNlckJ5RW1haWwiLCJhdXRoT3B0aW9ucyIsInByb3ZpZGVycyIsIm5hbWUiLCJjcmVkZW50aWFscyIsImVtYWlsIiwibGFiZWwiLCJ0eXBlIiwicGFzc3dvcmQiLCJhdXRob3JpemUiLCJ1c2VyIiwiaXNQYXNzd29yZFZhbGlkIiwiY29tcGFyZSIsImlkIiwicm9sZSIsInN0dWRlbnRJZCIsInVuZGVmaW5lZCIsInNlc3Npb24iLCJzdHJhdGVneSIsImNhbGxiYWNrcyIsImp3dCIsInRva2VuIiwic3ViIiwicmVkaXJlY3QiLCJ1cmwiLCJiYXNlVXJsIiwic3RhcnRzV2l0aCIsIlVSTCIsIm9yaWdpbiIsInNpZ25JbiIsImFjY291bnQiLCJwcm9maWxlIiwicGFnZXMiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/auth.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/calendar-ai-integration.ts":
/*!********************************************!*\
  !*** ./src/lib/calendar-ai-integration.ts ***!
  \********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   AICalendarIntegration: () => (/* binding */ AICalendarIntegration),\n/* harmony export */   analyzeConversationForEvents: () => (/* binding */ analyzeConversationForEvents),\n/* harmony export */   convertSuggestionToCalendarEvent: () => (/* binding */ convertSuggestionToCalendarEvent),\n/* harmony export */   createEventFromAI: () => (/* binding */ createEventFromAI),\n/* harmony export */   deleteEventFromAI: () => (/* binding */ deleteEventFromAI),\n/* harmony export */   editEventFromAI: () => (/* binding */ editEventFromAI),\n/* harmony export */   findUserEvents: () => (/* binding */ findUserEvents),\n/* harmony export */   generateEventQuestions: () => (/* binding */ generateEventQuestions),\n/* harmony export */   generateEventSuggestionResponse: () => (/* binding */ generateEventSuggestionResponse)\n/* harmony export */ });\n/* harmony import */ var _calendar_data__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./calendar-data */ \"(rsc)/./src/lib/calendar-data.ts\");\n// Calendar AI Integration Service\n// Integra el sistema de IA tutora con el calendario para crear eventos automáticamente\n\n/**\n * Analiza una conversación con la IA para detectar menciones de eventos\n */ function analyzeConversationForEvents(conversationHistory) {\n    const userMessages = conversationHistory.filter((msg)=>msg.role === 'user').map((msg)=>msg.content).join(' ');\n    const analysis = {\n        hasEventMention: false,\n        eventSuggestions: [],\n        questions: [],\n        missingInfo: []\n    };\n    // Análisis más inteligente del último mensaje del usuario\n    const lastUserMessage = conversationHistory.length > 0 ? conversationHistory[conversationHistory.length - 1]?.content || userMessages : userMessages;\n    const msgLower = lastUserMessage.toLowerCase();\n    // Detectar intención de agendar/crear evento\n    const agendarPatterns = /agendes?|agend[aá]|cre[ae]|programa|anot[ae]|agrega/i;\n    const isRequestingToSchedule = agendarPatterns.test(lastUserMessage);\n    // Detectar intención de editar evento\n    const editarPatterns = /edit[ae]|modific[ae]|cambi[ae]|actualiz[ae]|reprograma/i;\n    const isRequestingToEdit = editarPatterns.test(lastUserMessage);\n    // Detectar intención de eliminar evento\n    const eliminarPatterns = /elimin[ae]|borr[ae]|quit[ae]|cancel[ae]|suprimi/i;\n    const isRequestingToDelete = eliminarPatterns.test(lastUserMessage);\n    // Detectar menciones de exámenes con mejor parsing\n    if (/(examen|evaluaci[oó]n|parcial|final|prueba|test)/i.test(lastUserMessage)) {\n        const eventData = extractEventDataFromMessage(lastUserMessage, 'exam');\n        if (eventData.hasEvent) {\n            // Normalizar subject con acentos correctos\n            const normalizedSubject = normalizeSubjectName(eventData.subject);\n            analysis.eventSuggestions.push({\n                type: 'exam',\n                title: normalizedSubject ? `Examen de ${normalizedSubject}` : 'Examen',\n                subject: normalizedSubject,\n                date: eventData.date,\n                startTime: eventData.startTime,\n                duration: eventData.duration || 120,\n                location: eventData.location,\n                description: eventData.description,\n                priority: 'high',\n                confidence: 0.9\n            });\n            analysis.hasEventMention = true;\n        }\n    } else if (/(estudiar|repasar|preparar|practicar|sesi[oó]n.*estudio)/i.test(lastUserMessage)) {\n        const eventData = extractEventDataFromMessage(lastUserMessage, 'study_session');\n        if (eventData.hasEvent) {\n            // Normalizar subject con acentos correctos\n            const normalizedSubject = normalizeSubjectName(eventData.subject) || 'Revisión General';\n            analysis.eventSuggestions.push({\n                type: 'study_session',\n                title: `Sesión de Estudio - ${normalizedSubject}`,\n                subject: normalizedSubject,\n                date: eventData.date,\n                startTime: eventData.startTime,\n                duration: eventData.duration || 90,\n                location: eventData.location,\n                description: eventData.description,\n                priority: 'medium',\n                confidence: 0.8\n            });\n            analysis.hasEventMention = true;\n        }\n    }\n    // Solo generar preguntas para información realmente faltante\n    if (analysis.eventSuggestions.length > 0) {\n        const suggestion = analysis.eventSuggestions[0];\n        const questions = [];\n        const missingInfo = [];\n        if (!suggestion.date) {\n            questions.push(\"📅 ¿Para qué fecha es?\");\n            missingInfo.push(\"fecha\");\n        }\n        if (!suggestion.startTime) {\n            questions.push(\"🕐 ¿A qué hora?\");\n            missingInfo.push(\"hora\");\n        }\n        if (suggestion.type === 'exam' && !suggestion.subject) {\n            questions.push(\"📚 ¿De qué materia es el examen?\");\n            missingInfo.push(\"materia\");\n        }\n        if (suggestion.type === 'exam' && !suggestion.location) {\n            questions.push(\"📍 ¿En qué aula será?\");\n            missingInfo.push(\"ubicación\");\n        }\n        // Solo agregar preguntas si realmente falta información\n        analysis.questions = questions;\n        analysis.missingInfo = missingInfo;\n    }\n    return analysis;\n}\n/**\n * Extrae datos específicos del evento desde el mensaje\n */ function extractEventDataFromMessage(message, eventType) {\n    const msgLower = message.toLowerCase();\n    // Extraer materia de manera más inteligente\n    let subject = null;\n    const subjectPatterns = [\n        /(?:examen|evaluaci[oó]n|parcial|final|prueba|test).*?(?:de|en)\\s+([a-záéíóúñ]+)/i,\n        /([a-záéíóúñ]+).*?(?:examen|evaluaci[oó]n|parcial|final|prueba|test)/i,\n        /(?:estudiar|repasar|preparar|practicar)\\s+([a-záéíóúñ]+)/i,\n        /(?:sesi[oó]n.*?(?:de|en)\\s+([a-záéíóúñ]+))/i\n    ];\n    for (const pattern of subjectPatterns){\n        const match = message.match(pattern);\n        if (match && match[1]) {\n            // Capitalizar primera letra\n            subject = match[1].charAt(0).toUpperCase() + match[1].slice(1).toLowerCase();\n            break;\n        }\n    }\n    // Extraer fecha de manera más inteligente\n    let date = null;\n    let startTime = null;\n    // Detectar fechas específicas (dd de mes, dd/mm, etc.)\n    const specificDatePatterns = [\n        /(\\d{1,2})\\s+de\\s+(enero|febrero|marzo|abril|mayo|junio|julio|agosto|septiembre|octubre|noviembre|diciembre)/i,\n        /(\\d{1,2})\\/(\\d{1,2})(?:\\/(\\d{2,4}))?/,\n        /(\\d{1,2})-(\\d{1,2})(?:-(\\d{2,4}))?/,\n        /el\\s+(\\d{1,2})/i\n    ];\n    for (const pattern of specificDatePatterns){\n        const match = message.match(pattern);\n        if (match) {\n            if (pattern.source.includes('de')) {\n                // \"10 de julio\"\n                const day = parseInt(match[1]);\n                const monthName = match[2].toLowerCase();\n                const monthMap = {\n                    'enero': 0,\n                    'febrero': 1,\n                    'marzo': 2,\n                    'abril': 3,\n                    'mayo': 4,\n                    'junio': 5,\n                    'julio': 6,\n                    'agosto': 7,\n                    'septiembre': 8,\n                    'octubre': 9,\n                    'noviembre': 10,\n                    'diciembre': 11\n                };\n                if (monthMap[monthName] !== undefined) {\n                    const now = new Date();\n                    const eventDate = new Date(now.getFullYear(), monthMap[monthName], day);\n                    date = eventDate.toISOString().split('T')[0];\n                }\n            } else if (match[1] && !isNaN(parseInt(match[1]))) {\n                // Formato dd/mm o dd-mm o \"el 10\"\n                const day = parseInt(match[1]);\n                const month = match[2] ? parseInt(match[2]) - 1 : new Date().getMonth();\n                const year = match[3] ? parseInt(match[3]) : new Date().getFullYear();\n                const eventDate = new Date(year, month, day);\n                date = eventDate.toISOString().split('T')[0];\n            }\n            break;\n        }\n    }\n    // Si no se encontró fecha específica, buscar días relativos\n    if (!date) {\n        const relativeDatePatterns = [\n            {\n                pattern: /ma[ñn]ana/i,\n                days: 1\n            },\n            {\n                pattern: /hoy/i,\n                days: 0\n            },\n            {\n                pattern: /pasado.*ma[ñn]ana/i,\n                days: 2\n            },\n            {\n                pattern: /lunes/i,\n                targetDay: 1\n            },\n            {\n                pattern: /martes/i,\n                targetDay: 2\n            },\n            {\n                pattern: /mi[eé]rcoles/i,\n                targetDay: 3\n            },\n            {\n                pattern: /jueves/i,\n                targetDay: 4\n            },\n            {\n                pattern: /viernes/i,\n                targetDay: 5\n            },\n            {\n                pattern: /s[aá]bado/i,\n                targetDay: 6\n            },\n            {\n                pattern: /domingo/i,\n                targetDay: 0\n            }\n        ];\n        for (const { pattern, days, targetDay } of relativeDatePatterns){\n            if (pattern.test(message)) {\n                const now = new Date();\n                let eventDate;\n                if (days !== undefined) {\n                    eventDate = new Date(now.getTime() + days * 24 * 60 * 60 * 1000);\n                } else if (targetDay !== undefined) {\n                    const currentDay = now.getDay();\n                    let daysToAdd = targetDay - currentDay;\n                    if (daysToAdd <= 0) daysToAdd += 7 // Próxima semana\n                    ;\n                    eventDate = new Date(now.getTime() + daysToAdd * 24 * 60 * 60 * 1000);\n                } else {\n                    continue;\n                }\n                date = eventDate.toISOString().split('T')[0];\n                break;\n            }\n        }\n    }\n    // Extraer hora de manera más inteligente\n    const timePatterns = [\n        /(?:a\\s+las?\\s+)?(\\d{1,2})(?::(\\d{2}))?\\s*(am|pm|a\\.?m\\.?|p\\.?m\\.?)/i,\n        /(?:a\\s+las?\\s+)?(\\d{1,2})(?::(\\d{2}))?\\s*h(?:oras?)?/i,\n        /(\\d{1,2})(?::(\\d{2}))?\\s*(?:de\\s+la\\s+)?(ma[ñn]ana|tarde|noche)/i\n    ];\n    for (const pattern of timePatterns){\n        const match = message.match(pattern);\n        if (match) {\n            let hour = parseInt(match[1]);\n            const minute = match[2] ? parseInt(match[2]) : 0;\n            const period = match[3]?.toLowerCase();\n            // Convertir a formato 24h\n            if (period) {\n                if ((period.includes('pm') || period.includes('p.m') || period === 'tarde' || period === 'noche') && hour < 12) {\n                    hour += 12;\n                } else if ((period.includes('am') || period.includes('a.m') || period === 'ma[ñn]ana') && hour === 12) {\n                    hour = 0;\n                } else if (period === 'noche' && hour < 6) {\n                    hour += 12 // Para casos como \"3 de la noche\" = 15:00\n                    ;\n                }\n            }\n            startTime = `${hour.toString().padStart(2, '0')}:${minute.toString().padStart(2, '0')}`;\n            break;\n        }\n    }\n    // Extraer ubicación\n    let location = null;\n    const locationPatterns = [\n        /(?:en\\s+el?\\s+)?(aula|laboratorio|sala|auditorio)\\s+([a-zA-Z0-9]+)/i,\n        /(?:en\\s+)([a-zA-Z\\s]+(?:aula|laboratorio|sala|auditorio)[a-zA-Z0-9\\s]*)/i\n    ];\n    for (const pattern of locationPatterns){\n        const match = message.match(pattern);\n        if (match) {\n            location = match[0].replace(/^en\\s+/i, '').trim();\n            break;\n        }\n    }\n    // Extraer duración\n    let duration = null;\n    const durationMatch = message.match(/(?:durante\\s+)?(\\d+)\\s*(horas?|minutos?|min)/i);\n    if (durationMatch) {\n        const value = parseInt(durationMatch[1]);\n        const unit = durationMatch[2].toLowerCase();\n        duration = unit.includes('hora') ? value * 60 : value;\n    }\n    // Extraer descripción/tema específico si se menciona\n    let description = null;\n    const topicPatterns = [\n        /(?:sobre|tema|temas?)\\s+([a-záéíóúñ\\s]+?)(?:\\s+para|\\s+el|\\s+a|$)/i,\n        /(?:sobre)\\s+el\\s+tema\\s+([a-záéíóúñ\\s]+?)(?:\\s+para|\\s+el|\\s+a|$)/i\n    ];\n    for (const pattern of topicPatterns){\n        const match = message.match(pattern);\n        if (match && match[1] && match[1].trim().length > 3) {\n            description = match[1].trim();\n            break;\n        }\n    }\n    return {\n        hasEvent: true,\n        subject,\n        date,\n        startTime,\n        location,\n        duration,\n        description\n    };\n}\n/**\n * Genera preguntas para completar la información de un evento\n */ function generateEventQuestions(suggestion) {\n    const questions = [];\n    if (!suggestion.date) {\n        questions.push(\"📅 ¿Para qué fecha es?\");\n    }\n    if (!suggestion.startTime) {\n        questions.push(\"🕐 ¿A qué hora?\");\n    }\n    if (suggestion.type === 'exam') {\n        if (!suggestion.subject) {\n            questions.push(\"📚 ¿De qué materia es el examen?\");\n        }\n        if (!suggestion.location) {\n            questions.push(\"📍 ¿En qué aula o laboratorio será?\");\n        }\n        if (!suggestion.duration) {\n            questions.push(\"⏱️ ¿Cuánto tiempo durará?\");\n        }\n    }\n    if (suggestion.type === 'study_session') {\n        if (!suggestion.subject) {\n            questions.push(\"📖 ¿Qué tema vas a estudiar?\");\n        }\n        if (!suggestion.duration) {\n            questions.push(\"⏰ ¿Cuántas horas planeas estudiar?\");\n        }\n    }\n    if (suggestion.type === 'personal' || suggestion.type === 'extracurricular') {\n        if (!suggestion.location) {\n            questions.push(\"📍 ¿Dónde será?\");\n        }\n    }\n    return questions;\n}\n/**\n * Convierte una sugerencia de evento en un evento de calendario\n */ function convertSuggestionToCalendarEvent(suggestion, userId, additionalInfo) {\n    const merged = {\n        ...suggestion,\n        ...additionalInfo\n    };\n    // Procesar fecha\n    let eventDate = new Date();\n    if (merged.date) {\n        eventDate = parseDateFromText(merged.date);\n    }\n    // Procesar hora\n    let startTime = merged.startTime || '15:00';\n    let endTime = merged.startTime || '16:00';\n    if (merged.duration && merged.startTime) {\n        const start = new Date(`2000-01-01T${merged.startTime}:00`);\n        const end = new Date(start.getTime() + merged.duration * 60000);\n        endTime = end.toTimeString().substring(0, 5);\n    }\n    const event = {\n        id: `ai-event-${Date.now()}`,\n        title: merged.title,\n        date: eventDate,\n        startTime: startTime,\n        endTime: endTime,\n        type: merged.type,\n        color: (0,_calendar_data__WEBPACK_IMPORTED_MODULE_0__.getEventTypeColor)(merged.type),\n        subject: merged.subject,\n        location: merged.location,\n        description: merged.description || 'Creado automáticamente por IA Tutora',\n        priority: merged.priority || 'medium',\n        duration: merged.duration || 60\n    };\n    return event;\n}\n/**\n * Crea un evento automáticamente desde la IA usando el API endpoint dedicado\n */ async function createEventFromAI(suggestion, userId, additionalInfo) {\n    try {\n        const merged = {\n            ...suggestion,\n            ...additionalInfo\n        };\n        // Procesar fecha\n        let eventDate = new Date();\n        if (merged.date) {\n            eventDate = parseDateFromText(merged.date);\n        }\n        // Calcular endTime basado en duration y startTime\n        let endTime = merged.startTime || '16:00';\n        if (merged.duration && merged.startTime) {\n            const start = new Date(`2000-01-01T${merged.startTime}:00`);\n            const end = new Date(start.getTime() + merged.duration * 60000);\n            endTime = end.toTimeString().substring(0, 5);\n        }\n        const eventData = {\n            title: merged.title,\n            type: merged.type,\n            subject: merged.subject,\n            date: eventDate.toISOString(),\n            startTime: merged.startTime || '15:00',\n            endTime: endTime,\n            duration: merged.duration || 60,\n            location: merged.location,\n            description: merged.description || `Creado automáticamente por IA Tutora`,\n            priority: merged.priority || 'medium'\n        };\n        // For server-side execution, call the function directly instead of HTTP fetch\n        try {\n            const { createCalendarEvent } = __webpack_require__(/*! ../app/api/ai-calendar/create-event/route */ \"(rsc)/./src/app/api/ai-calendar/create-event/route.ts\");\n            const mockRequest = {\n                json: async ()=>eventData\n            };\n            const response1 = await createCalendarEvent(mockRequest);\n            const result = await response1.json();\n            return {\n                success: result.success,\n                event: result.event,\n                message: result.message\n            };\n        } catch (directCallError) {\n            console.log('Direct API call failed, trying alternative approach:', directCallError);\n            // Alternative: Use calendar-data functions directly\n            const { addCalendarEvent, getUserCalendarData, createUserCalendarData } = __webpack_require__(/*! ./calendar-data */ \"(rsc)/./src/lib/calendar-data.ts\");\n            // Ensure user has calendar data\n            let userData = getUserCalendarData(userId);\n            if (!userData) {\n                console.log(`🆕 Creating calendar data for user ${userId}`);\n                userData = createUserCalendarData(userId);\n            }\n            const calendarEvent = {\n                id: `ai-event-${Date.now()}`,\n                title: eventData.title,\n                date: new Date(eventData.date),\n                startTime: eventData.startTime,\n                endTime: eventData.endTime,\n                type: eventData.type,\n                color: '#3B82F6',\n                subject: eventData.subject,\n                location: eventData.location,\n                description: eventData.description,\n                priority: eventData.priority,\n                duration: eventData.duration\n            };\n            console.log(`📅 Creating event: ${calendarEvent.title} for ${eventData.date} at ${eventData.startTime}`);\n            const success = addCalendarEvent(userId, calendarEvent);\n            return {\n                success,\n                event: success ? calendarEvent : undefined,\n                message: success ? 'Evento creado exitosamente' : 'Error al crear evento'\n            };\n        }\n        const result = await response.json();\n        if (result.success) {\n            console.log(`🤖 IA confirmó creación: ${result.event.title}`);\n            // Disparar evento del lado del cliente para notificar componentes\n            if (false) {}\n            return {\n                success: true,\n                event: result.event,\n                message: result.message\n            };\n        } else {\n            console.error('❌ IA falló al crear evento:', result.error);\n            return {\n                success: false,\n                message: result.error || 'Error desconocido'\n            };\n        }\n    } catch (error) {\n        console.error('❌ Error in AI event creation:', error);\n        return {\n            success: false,\n            message: 'Error de conexión al crear evento'\n        };\n    }\n}\n/**\n * Parsea fechas desde texto natural\n */ function parseDateFromText(dateText) {\n    const text = dateText.toLowerCase();\n    const today = new Date();\n    if (text.includes('hoy')) {\n        return today;\n    }\n    if (text.includes('mañana') || text.includes('ma[ñn]ana')) {\n        const tomorrow = new Date(today);\n        tomorrow.setDate(today.getDate() + 1);\n        return tomorrow;\n    }\n    if (text.includes('pasado')) {\n        const dayAfterTomorrow = new Date(today);\n        dayAfterTomorrow.setDate(today.getDate() + 2);\n        return dayAfterTomorrow;\n    }\n    // Días de la semana\n    const dayMap = {\n        'lunes': 1,\n        'martes': 2,\n        'miércoles': 3,\n        'miercoles': 3,\n        'jueves': 4,\n        'viernes': 5,\n        'sábado': 6,\n        'sabado': 6,\n        'domingo': 0\n    };\n    for (const [dayName, dayNumber] of Object.entries(dayMap)){\n        if (text.includes(dayName)) {\n            const targetDate = new Date(today);\n            const currentDay = today.getDay();\n            let daysToAdd = dayNumber - currentDay;\n            if (daysToAdd <= 0) {\n                daysToAdd += 7 // Próxima semana\n                ;\n            }\n            targetDate.setDate(today.getDate() + daysToAdd);\n            return targetDate;\n        }\n    }\n    // Si incluye números (ej: \"en 3 días\")\n    const daysMatch = text.match(/en\\s+(\\d+)\\s+d[ií]as?/);\n    if (daysMatch) {\n        const days = parseInt(daysMatch[1]);\n        const futureDate = new Date(today);\n        futureDate.setDate(today.getDate() + days);\n        return futureDate;\n    }\n    // Por defecto, devolver mañana\n    const defaultDate = new Date(today);\n    defaultDate.setDate(today.getDate() + 1);\n    return defaultDate;\n}\n/**\n * Genera respuesta de la IA para sugerir crear eventos\n */ function generateEventSuggestionResponse(analysis) {\n    if (!analysis.hasEventMention || analysis.eventSuggestions.length === 0) {\n        return \"\";\n    }\n    const suggestion = analysis.eventSuggestions[0] // Tomar la primera sugerencia\n    ;\n    let response1 = `📅 Perfecto! Veo que quieres agendar: **${suggestion.title}**\\n\\n`;\n    // Mostrar información detectada\n    const detectedInfo = [];\n    if (suggestion.subject) detectedInfo.push(`📚 Materia: ${suggestion.subject}`);\n    if (suggestion.date) {\n        const dateObj = new Date(suggestion.date);\n        const formattedDate = dateObj.toLocaleDateString('es-ES', {\n            weekday: 'long',\n            day: 'numeric',\n            month: 'long'\n        });\n        detectedInfo.push(`📅 Fecha: ${formattedDate}`);\n    }\n    if (suggestion.startTime) detectedInfo.push(`🕐 Hora: ${suggestion.startTime}`);\n    if (suggestion.location) detectedInfo.push(`📍 Ubicación: ${suggestion.location}`);\n    if (detectedInfo.length > 0) {\n        response1 += `**Información detectada:**\\n${detectedInfo.join('\\n')}\\n\\n`;\n    }\n    if (analysis.questions.length > 0) {\n        response1 += `Para completar el evento necesito:\\n`;\n        analysis.questions.forEach((question, index)=>{\n            response1 += `${index + 1}. ${question}\\n`;\n        });\n        response1 += `\\n¿Podrías darme estos detalles?`;\n    } else {\n        response1 += `¡Tengo toda la información necesaria! ¿Confirmas que lo agregue a tu calendario?`;\n    }\n    return response1;\n}\n/**\n * Interfaz para el workflow completo de creación de eventos por IA\n */ class AICalendarIntegration {\n    constructor(userId){\n        this.pendingSuggestion = null;\n        this.collectedInfo = {};\n        this.userId = userId;\n    }\n    /**\n   * Procesa un mensaje del usuario y detecta si necesita crear eventos\n   */ async processMessage(message, conversationHistory) {\n        const analysis = analyzeConversationForEvents([\n            ...conversationHistory,\n            {\n                role: 'user',\n                content: message\n            }\n        ]);\n        if (analysis.hasEventMention && analysis.eventSuggestions.length > 0) {\n            this.pendingSuggestion = analysis.eventSuggestions[0];\n            if (analysis.questions.length > 0) {\n                return {\n                    needsEventCreation: true,\n                    response: generateEventSuggestionResponse(analysis),\n                    questions: analysis.questions\n                };\n            } else {\n                // Información completa, crear evento directamente\n                const result = await this.createPendingEvent();\n                return {\n                    needsEventCreation: true,\n                    response: result.success ? this.generateSuccessMessage(result.event) : `❌ ${result.message || 'Hubo un error al crear el evento. Por favor intenta nuevamente.'}`,\n                    event: result.event\n                };\n            }\n        }\n        return {\n            needsEventCreation: false\n        };\n    }\n    /**\n   * Recopila información adicional del usuario\n   */ collectAdditionalInfo(infoType, value) {\n        if (!this.pendingSuggestion) return false;\n        switch(infoType.toLowerCase()){\n            case 'fecha':\n                this.collectedInfo.date = value;\n                break;\n            case 'hora':\n                this.collectedInfo.startTime = value;\n                break;\n            case 'materia':\n            case 'tema':\n                this.collectedInfo.subject = value;\n                break;\n            case 'ubicación':\n            case 'ubicacion':\n                this.collectedInfo.location = value;\n                break;\n            case 'duración':\n            case 'duracion':\n                this.collectedInfo.duration = parseInt(value);\n                break;\n        }\n        return true;\n    }\n    /**\n   * Crea el evento pendiente con la información recopilada\n   */ async createPendingEvent() {\n        if (!this.pendingSuggestion) {\n            return {\n                success: false,\n                message: 'No hay evento pendiente'\n            };\n        }\n        const result = await createEventFromAI(this.pendingSuggestion, this.userId, this.collectedInfo);\n        if (result.success) {\n            this.pendingSuggestion = null;\n            this.collectedInfo = {};\n        }\n        return result;\n    }\n    /**\n   * Cancela la creación del evento pendiente\n   */ cancelPendingEvent() {\n        this.pendingSuggestion = null;\n        this.collectedInfo = {};\n    }\n    /**\n   * Obtiene la sugerencia pendiente\n   */ getPendingSuggestion() {\n        return this.pendingSuggestion;\n    }\n    /**\n   * Genera mensaje de éxito con detalles del evento creado\n   */ generateSuccessMessage(event) {\n        let message = `✅ ¡Perfecto! He creado \"${event.title}\" en tu calendario.`;\n        // Agregar detalles específicos\n        const details = [];\n        if (event.date) {\n            const dateStr = event.date.toLocaleDateString('es-ES', {\n                weekday: 'long',\n                day: 'numeric',\n                month: 'long'\n            });\n            details.push(`📅 **Fecha**: ${dateStr}`);\n        }\n        if (event.startTime) {\n            details.push(`🕐 **Hora**: ${event.startTime}`);\n        }\n        if (event.location) {\n            details.push(`📍 **Ubicación**: ${event.location}`);\n        }\n        if (event.subject && event.type === 'exam') {\n            details.push(`📚 **Materia**: ${event.subject}`);\n        }\n        if (event.description && !event.description.includes('Creado automáticamente')) {\n            details.push(`📝 **Tema**: ${event.description}`);\n        }\n        if (details.length > 0) {\n            message += `\\n\\n**Detalles del evento:**\\n${details.join('\\n')}`;\n        }\n        message += `\\n\\n🎯 Puedes ver todos tus eventos en la sección \"Organizador Inteligente\" de tu calendario.`;\n        return message;\n    }\n}\n/**\n * Busca eventos del usuario por texto de búsqueda\n */ function findUserEvents(userId, searchText) {\n    const userData = (0,_calendar_data__WEBPACK_IMPORTED_MODULE_0__.getUserCalendarData)(userId);\n    if (!userData) return [];\n    const search = searchText.toLowerCase();\n    return userData.events.filter((event)=>{\n        return event.title.toLowerCase().includes(search) || event.subject?.toLowerCase().includes(search) || event.description?.toLowerCase().includes(search) || event.location?.toLowerCase().includes(search);\n    });\n}\n/**\n * Edita un evento usando el API endpoint\n */ async function editEventFromAI(eventId, updates) {\n    try {\n        // For server-side execution, call the function directly\n        try {\n            const { updateCalendarEvent } = __webpack_require__(/*! ./calendar-data */ \"(rsc)/./src/lib/calendar-data.ts\");\n            const success = updateCalendarEvent(eventId, updates);\n            return {\n                success,\n                event: success ? {\n                    id: eventId,\n                    ...updates\n                } : undefined,\n                message: success ? 'Evento actualizado exitosamente' : 'Error al actualizar evento'\n            };\n        } catch (error) {\n            console.error('Error updating event:', error);\n            return {\n                success: false,\n                message: 'Error al actualizar evento'\n            };\n        }\n        const result = await response.json();\n        if (result.success) {\n            console.log(`🤖 IA editó evento: ${result.event.title}`);\n            // Disparar evento del lado del cliente\n            if (false) {}\n            return {\n                success: true,\n                event: result.event,\n                message: result.message\n            };\n        } else {\n            return {\n                success: false,\n                message: result.error || 'Error desconocido al editar'\n            };\n        }\n    } catch (error) {\n        console.error('❌ Error editing event from AI:', error);\n        return {\n            success: false,\n            message: 'Error de conexión al editar evento'\n        };\n    }\n}\n/**\n * Elimina un evento usando el API endpoint\n */ async function deleteEventFromAI(eventId) {\n    try {\n        // For server-side execution, call the function directly\n        try {\n            const { deleteCalendarEvent } = __webpack_require__(/*! ./calendar-data */ \"(rsc)/./src/lib/calendar-data.ts\");\n            const deletedEvent = deleteCalendarEvent(eventId);\n            return {\n                success: !!deletedEvent,\n                message: deletedEvent ? `Evento \"${deletedEvent.title}\" eliminado exitosamente` : 'Evento no encontrado'\n            };\n        } catch (error) {\n            console.error('Error deleting event:', error);\n            return {\n                success: false,\n                message: 'Error al eliminar evento'\n            };\n        }\n        const result = await response.json();\n        if (result.success) {\n            console.log(`🤖 IA eliminó evento: ${result.deletedEvent.title}`);\n            // Disparar evento del lado del cliente\n            if (false) {}\n            return {\n                success: true,\n                message: result.message\n            };\n        } else {\n            return {\n                success: false,\n                message: result.error || 'Error desconocido al eliminar'\n            };\n        }\n    } catch (error) {\n        console.error('❌ Error deleting event from AI:', error);\n        return {\n            success: false,\n            message: 'Error de conexión al eliminar evento'\n        };\n    }\n}\n/**\n * Normaliza nombres de materias con acentos y mayúsculas correctas\n */ function normalizeSubjectName(subject) {\n    if (!subject) return null;\n    const normalized = subject.toLowerCase().trim();\n    const subjectMap = {\n        'quimica': 'Química',\n        'química': 'Química',\n        'fisica': 'Física',\n        'física': 'Física',\n        'matematica': 'Matemática',\n        'matemáticas': 'Matemáticas',\n        'matematicas': 'Matemáticas',\n        'biologia': 'Biología',\n        'biología': 'Biología',\n        'historia': 'Historia',\n        'geografia': 'Geografía',\n        'geografía': 'Geografía',\n        'ingles': 'Inglés',\n        'inglés': 'Inglés',\n        'lengua': 'Lengua y Literatura',\n        'literatura': 'Lengua y Literatura',\n        'filosofia': 'Filosofía',\n        'filosofía': 'Filosofía',\n        'economia': 'Economía',\n        'economía': 'Economía',\n        'educacion fisica': 'Educación Física',\n        'educación física': 'Educación Física',\n        'ed fisica': 'Educación Física',\n        'arte': 'Arte',\n        'musica': 'Música',\n        'música': 'Música'\n    };\n    // Buscar coincidencia exacta primero\n    if (subjectMap[normalized]) {\n        return subjectMap[normalized];\n    }\n    // Buscar coincidencia parcial\n    for (const [key, value] of Object.entries(subjectMap)){\n        if (key.includes(normalized) || normalized.includes(key)) {\n            return value;\n        }\n    }\n    // Si no se encuentra, capitalizar primera letra\n    return subject.charAt(0).toUpperCase() + subject.slice(1).toLowerCase();\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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O1FBQ2RYLFFBQVFXLEtBQUssQ0FBQyxtQ0FBbUNBO1FBQ2pELE9BQU87WUFDTGIsU0FBUztZQUNUbkUsU0FBUztRQUNYO0lBQ0Y7QUFDRjtBQUVBOztDQUVDLEdBQ0QsU0FBU2IscUJBQXFCQyxPQUF1QjtJQUNuRCxJQUFJLENBQUNBLFNBQVMsT0FBTztJQUVyQixNQUFNK0ksYUFBYS9JLFFBQVFiLFdBQVcsR0FBR2tFLElBQUk7SUFFN0MsTUFBTTJGLGFBQXFDO1FBQ3pDLFdBQVc7UUFDWCxXQUFXO1FBQ1gsVUFBVTtRQUNWLFVBQVU7UUFDVixjQUFjO1FBQ2QsZUFBZTtRQUNmLGVBQWU7UUFDZixZQUFZO1FBQ1osWUFBWTtRQUNaLFlBQVk7UUFDWixhQUFhO1FBQ2IsYUFBYTtRQUNiLFVBQVU7UUFDVixVQUFVO1FBQ1YsVUFBVTtRQUNWLGNBQWM7UUFDZCxhQUFhO1FBQ2IsYUFBYTtRQUNiLFlBQVk7UUFDWixZQUFZO1FBQ1osb0JBQW9CO1FBQ3BCLG9CQUFvQjtRQUNwQixhQUFhO1FBQ2IsUUFBUTtRQUNSLFVBQVU7UUFDVixVQUFVO0lBQ1o7SUFFQSxxQ0FBcUM7SUFDckMsSUFBSUEsVUFBVSxDQUFDRCxXQUFXLEVBQUU7UUFDMUIsT0FBT0MsVUFBVSxDQUFDRCxXQUFXO0lBQy9CO0lBRUEsOEJBQThCO0lBQzlCLEtBQUssTUFBTSxDQUFDRSxLQUFLMUYsTUFBTSxJQUFJZ0QsT0FBT0MsT0FBTyxDQUFDd0MsWUFBYTtRQUNyRCxJQUFJQyxJQUFJM0gsUUFBUSxDQUFDeUgsZUFBZUEsV0FBV3pILFFBQVEsQ0FBQzJILE1BQU07WUFDeEQsT0FBTzFGO1FBQ1Q7SUFDRjtJQUVBLGdEQUFnRDtJQUNoRCxPQUFPdkQsUUFBUWlCLE1BQU0sQ0FBQyxHQUFHQyxXQUFXLEtBQUtsQixRQUFRbUIsS0FBSyxDQUFDLEdBQUdoQyxXQUFXO0FBQ3ZFIiwic291cmNlcyI6WyIvVXNlcnMvcm9kcmlnb2RpYmVybmFyZG8zM2dtYWlsLmNvbS9Eb2N1bWVudHMvQXBwIERldmVsb3BtZW50IFByb3llY3RzL0ludGVsbGVnbyBQbGF0Zm9ybS9zcmMvbGliL2NhbGVuZGFyLWFpLWludGVncmF0aW9uLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIENhbGVuZGFyIEFJIEludGVncmF0aW9uIFNlcnZpY2Vcbi8vIEludGVncmEgZWwgc2lzdGVtYSBkZSBJQSB0dXRvcmEgY29uIGVsIGNhbGVuZGFyaW8gcGFyYSBjcmVhciBldmVudG9zIGF1dG9tw6F0aWNhbWVudGVcblxuaW1wb3J0IHsgQ2FsZW5kYXJFdmVudCwgYWRkQ2FsZW5kYXJFdmVudCwgZ2V0RXZlbnRUeXBlQ29sb3IsIGdldFVzZXJDYWxlbmRhckRhdGEgfSBmcm9tICcuL2NhbGVuZGFyLWRhdGEnXG5pbXBvcnQgeyBjb252ZXJzYXRpb25FbmdpbmUgfSBmcm9tICcuL2NvbnZlcnNhdGlvbi1lbmdpbmUnXG5cbmV4cG9ydCBpbnRlcmZhY2UgRXZlbnRTdWdnZXN0aW9uIHtcbiAgdHlwZTogJ2V4YW0nIHwgJ3N0dWR5X3Nlc3Npb24nIHwgJ3BlcnNvbmFsJyB8ICdleHRyYWN1cnJpY3VsYXInXG4gIHRpdGxlOiBzdHJpbmdcbiAgc3ViamVjdD86IHN0cmluZ1xuICBkYXRlPzogc3RyaW5nXG4gIHN0YXJ0VGltZT86IHN0cmluZ1xuICBkdXJhdGlvbj86IG51bWJlclxuICBsb2NhdGlvbj86IHN0cmluZ1xuICBkZXNjcmlwdGlvbj86IHN0cmluZ1xuICBwcmlvcml0eT86ICdoaWdoJyB8ICdtZWRpdW0nIHwgJ2xvdydcbiAgY29uZmlkZW5jZTogbnVtYmVyIC8vIDAtMSBuaXZlbCBkZSBjb25maWFuemEgZW4gbGEgc3VnZXJlbmNpYVxufVxuXG5leHBvcnQgaW50ZXJmYWNlIENvbnZlcnNhdGlvbkFuYWx5c2lzIHtcbiAgaGFzRXZlbnRNZW50aW9uOiBib29sZWFuXG4gIGV2ZW50U3VnZ2VzdGlvbnM6IEV2ZW50U3VnZ2VzdGlvbltdXG4gIHF1ZXN0aW9uczogc3RyaW5nW11cbiAgbWlzc2luZ0luZm86IHN0cmluZ1tdXG59XG5cbi8qKlxuICogQW5hbGl6YSB1bmEgY29udmVyc2FjacOzbiBjb24gbGEgSUEgcGFyYSBkZXRlY3RhciBtZW5jaW9uZXMgZGUgZXZlbnRvc1xuICovXG5leHBvcnQgZnVuY3Rpb24gYW5hbHl6ZUNvbnZlcnNhdGlvbkZvckV2ZW50cyhcbiAgY29udmVyc2F0aW9uSGlzdG9yeTogQXJyYXk8eyByb2xlOiAndXNlcicgfCAnYXNzaXN0YW50JywgY29udGVudDogc3RyaW5nIH0+XG4pOiBDb252ZXJzYXRpb25BbmFseXNpcyB7XG4gIGNvbnN0IHVzZXJNZXNzYWdlcyA9IGNvbnZlcnNhdGlvbkhpc3RvcnlcbiAgICAuZmlsdGVyKG1zZyA9PiBtc2cucm9sZSA9PT0gJ3VzZXInKVxuICAgIC5tYXAobXNnID0+IG1zZy5jb250ZW50KVxuICAgIC5qb2luKCcgJylcblxuICBjb25zdCBhbmFseXNpczogQ29udmVyc2F0aW9uQW5hbHlzaXMgPSB7XG4gICAgaGFzRXZlbnRNZW50aW9uOiBmYWxzZSxcbiAgICBldmVudFN1Z2dlc3Rpb25zOiBbXSxcbiAgICBxdWVzdGlvbnM6IFtdLFxuICAgIG1pc3NpbmdJbmZvOiBbXVxuICB9XG5cbiAgLy8gQW7DoWxpc2lzIG3DoXMgaW50ZWxpZ2VudGUgZGVsIMO6bHRpbW8gbWVuc2FqZSBkZWwgdXN1YXJpb1xuICBjb25zdCBsYXN0VXNlck1lc3NhZ2UgPSBjb252ZXJzYXRpb25IaXN0b3J5Lmxlbmd0aCA+IDAgXG4gICAgPyBjb252ZXJzYXRpb25IaXN0b3J5W2NvbnZlcnNhdGlvbkhpc3RvcnkubGVuZ3RoIC0gMV0/LmNvbnRlbnQgfHwgdXNlck1lc3NhZ2VzXG4gICAgOiB1c2VyTWVzc2FnZXNcblxuICBjb25zdCBtc2dMb3dlciA9IGxhc3RVc2VyTWVzc2FnZS50b0xvd2VyQ2FzZSgpXG5cbiAgLy8gRGV0ZWN0YXIgaW50ZW5jacOzbiBkZSBhZ2VuZGFyL2NyZWFyIGV2ZW50b1xuICBjb25zdCBhZ2VuZGFyUGF0dGVybnMgPSAvYWdlbmRlcz98YWdlbmRbYcOhXXxjcmVbYWVdfHByb2dyYW1hfGFub3RbYWVdfGFncmVnYS9pXG4gIGNvbnN0IGlzUmVxdWVzdGluZ1RvU2NoZWR1bGUgPSBhZ2VuZGFyUGF0dGVybnMudGVzdChsYXN0VXNlck1lc3NhZ2UpXG4gIFxuICAvLyBEZXRlY3RhciBpbnRlbmNpw7NuIGRlIGVkaXRhciBldmVudG9cbiAgY29uc3QgZWRpdGFyUGF0dGVybnMgPSAvZWRpdFthZV18bW9kaWZpY1thZV18Y2FtYmlbYWVdfGFjdHVhbGl6W2FlXXxyZXByb2dyYW1hL2lcbiAgY29uc3QgaXNSZXF1ZXN0aW5nVG9FZGl0ID0gZWRpdGFyUGF0dGVybnMudGVzdChsYXN0VXNlck1lc3NhZ2UpXG4gIFxuICAvLyBEZXRlY3RhciBpbnRlbmNpw7NuIGRlIGVsaW1pbmFyIGV2ZW50b1xuICBjb25zdCBlbGltaW5hclBhdHRlcm5zID0gL2VsaW1pblthZV18Ym9yclthZV18cXVpdFthZV18Y2FuY2VsW2FlXXxzdXByaW1pL2lcbiAgY29uc3QgaXNSZXF1ZXN0aW5nVG9EZWxldGUgPSBlbGltaW5hclBhdHRlcm5zLnRlc3QobGFzdFVzZXJNZXNzYWdlKVxuXG4gIC8vIERldGVjdGFyIG1lbmNpb25lcyBkZSBleMOhbWVuZXMgY29uIG1lam9yIHBhcnNpbmdcbiAgaWYgKC8oZXhhbWVufGV2YWx1YWNpW2/Ds11ufHBhcmNpYWx8ZmluYWx8cHJ1ZWJhfHRlc3QpL2kudGVzdChsYXN0VXNlck1lc3NhZ2UpKSB7XG4gICAgY29uc3QgZXZlbnREYXRhID0gZXh0cmFjdEV2ZW50RGF0YUZyb21NZXNzYWdlKGxhc3RVc2VyTWVzc2FnZSwgJ2V4YW0nKVxuICAgIFxuICAgIGlmIChldmVudERhdGEuaGFzRXZlbnQpIHtcbiAgICAgIC8vIE5vcm1hbGl6YXIgc3ViamVjdCBjb24gYWNlbnRvcyBjb3JyZWN0b3NcbiAgICAgIGNvbnN0IG5vcm1hbGl6ZWRTdWJqZWN0ID0gbm9ybWFsaXplU3ViamVjdE5hbWUoZXZlbnREYXRhLnN1YmplY3QpXG4gICAgICBcbiAgICAgIGFuYWx5c2lzLmV2ZW50U3VnZ2VzdGlvbnMucHVzaCh7XG4gICAgICAgIHR5cGU6ICdleGFtJyxcbiAgICAgICAgdGl0bGU6IG5vcm1hbGl6ZWRTdWJqZWN0ID8gYEV4YW1lbiBkZSAke25vcm1hbGl6ZWRTdWJqZWN0fWAgOiAnRXhhbWVuJyxcbiAgICAgICAgc3ViamVjdDogbm9ybWFsaXplZFN1YmplY3QsXG4gICAgICAgIGRhdGU6IGV2ZW50RGF0YS5kYXRlLFxuICAgICAgICBzdGFydFRpbWU6IGV2ZW50RGF0YS5zdGFydFRpbWUsXG4gICAgICAgIGR1cmF0aW9uOiBldmVudERhdGEuZHVyYXRpb24gfHwgMTIwLFxuICAgICAgICBsb2NhdGlvbjogZXZlbnREYXRhLmxvY2F0aW9uLFxuICAgICAgICBkZXNjcmlwdGlvbjogZXZlbnREYXRhLmRlc2NyaXB0aW9uLFxuICAgICAgICBwcmlvcml0eTogJ2hpZ2gnLFxuICAgICAgICBjb25maWRlbmNlOiAwLjlcbiAgICAgIH0pXG4gICAgICBhbmFseXNpcy5oYXNFdmVudE1lbnRpb24gPSB0cnVlXG4gICAgfVxuICB9XG5cbiAgLy8gRGV0ZWN0YXIgbWVuY2lvbmVzIGRlIGVzdHVkaW9cbiAgZWxzZSBpZiAoLyhlc3R1ZGlhcnxyZXBhc2FyfHByZXBhcmFyfHByYWN0aWNhcnxzZXNpW2/Ds11uLiplc3R1ZGlvKS9pLnRlc3QobGFzdFVzZXJNZXNzYWdlKSkge1xuICAgIGNvbnN0IGV2ZW50RGF0YSA9IGV4dHJhY3RFdmVudERhdGFGcm9tTWVzc2FnZShsYXN0VXNlck1lc3NhZ2UsICdzdHVkeV9zZXNzaW9uJylcbiAgICBcbiAgICBpZiAoZXZlbnREYXRhLmhhc0V2ZW50KSB7XG4gICAgICAvLyBOb3JtYWxpemFyIHN1YmplY3QgY29uIGFjZW50b3MgY29ycmVjdG9zXG4gICAgICBjb25zdCBub3JtYWxpemVkU3ViamVjdCA9IG5vcm1hbGl6ZVN1YmplY3ROYW1lKGV2ZW50RGF0YS5zdWJqZWN0KSB8fCAnUmV2aXNpw7NuIEdlbmVyYWwnXG4gICAgICBcbiAgICAgIGFuYWx5c2lzLmV2ZW50U3VnZ2VzdGlvbnMucHVzaCh7XG4gICAgICAgIHR5cGU6ICdzdHVkeV9zZXNzaW9uJyxcbiAgICAgICAgdGl0bGU6IGBTZXNpw7NuIGRlIEVzdHVkaW8gLSAke25vcm1hbGl6ZWRTdWJqZWN0fWAsXG4gICAgICAgIHN1YmplY3Q6IG5vcm1hbGl6ZWRTdWJqZWN0LFxuICAgICAgICBkYXRlOiBldmVudERhdGEuZGF0ZSxcbiAgICAgICAgc3RhcnRUaW1lOiBldmVudERhdGEuc3RhcnRUaW1lLFxuICAgICAgICBkdXJhdGlvbjogZXZlbnREYXRhLmR1cmF0aW9uIHx8IDkwLFxuICAgICAgICBsb2NhdGlvbjogZXZlbnREYXRhLmxvY2F0aW9uLFxuICAgICAgICBkZXNjcmlwdGlvbjogZXZlbnREYXRhLmRlc2NyaXB0aW9uLFxuICAgICAgICBwcmlvcml0eTogJ21lZGl1bScsXG4gICAgICAgIGNvbmZpZGVuY2U6IDAuOFxuICAgICAgfSlcbiAgICAgIGFuYWx5c2lzLmhhc0V2ZW50TWVudGlvbiA9IHRydWVcbiAgICB9XG4gIH1cblxuICAvLyBTb2xvIGdlbmVyYXIgcHJlZ3VudGFzIHBhcmEgaW5mb3JtYWNpw7NuIHJlYWxtZW50ZSBmYWx0YW50ZVxuICBpZiAoYW5hbHlzaXMuZXZlbnRTdWdnZXN0aW9ucy5sZW5ndGggPiAwKSB7XG4gICAgY29uc3Qgc3VnZ2VzdGlvbiA9IGFuYWx5c2lzLmV2ZW50U3VnZ2VzdGlvbnNbMF1cbiAgICBjb25zdCBxdWVzdGlvbnM6IHN0cmluZ1tdID0gW11cbiAgICBjb25zdCBtaXNzaW5nSW5mbzogc3RyaW5nW10gPSBbXVxuXG4gICAgaWYgKCFzdWdnZXN0aW9uLmRhdGUpIHtcbiAgICAgIHF1ZXN0aW9ucy5wdXNoKFwi8J+ThSDCv1BhcmEgcXXDqSBmZWNoYSBlcz9cIilcbiAgICAgIG1pc3NpbmdJbmZvLnB1c2goXCJmZWNoYVwiKVxuICAgIH1cblxuICAgIGlmICghc3VnZ2VzdGlvbi5zdGFydFRpbWUpIHtcbiAgICAgIHF1ZXN0aW9ucy5wdXNoKFwi8J+VkCDCv0EgcXXDqSBob3JhP1wiKVxuICAgICAgbWlzc2luZ0luZm8ucHVzaChcImhvcmFcIilcbiAgICB9XG5cbiAgICBpZiAoc3VnZ2VzdGlvbi50eXBlID09PSAnZXhhbScgJiYgIXN1Z2dlc3Rpb24uc3ViamVjdCkge1xuICAgICAgcXVlc3Rpb25zLnB1c2goXCLwn5OaIMK/RGUgcXXDqSBtYXRlcmlhIGVzIGVsIGV4YW1lbj9cIilcbiAgICAgIG1pc3NpbmdJbmZvLnB1c2goXCJtYXRlcmlhXCIpXG4gICAgfVxuXG4gICAgaWYgKHN1Z2dlc3Rpb24udHlwZSA9PT0gJ2V4YW0nICYmICFzdWdnZXN0aW9uLmxvY2F0aW9uKSB7XG4gICAgICBxdWVzdGlvbnMucHVzaChcIvCfk40gwr9FbiBxdcOpIGF1bGEgc2Vyw6E/XCIpXG4gICAgICBtaXNzaW5nSW5mby5wdXNoKFwidWJpY2FjacOzblwiKVxuICAgIH1cblxuICAgIC8vIFNvbG8gYWdyZWdhciBwcmVndW50YXMgc2kgcmVhbG1lbnRlIGZhbHRhIGluZm9ybWFjacOzblxuICAgIGFuYWx5c2lzLnF1ZXN0aW9ucyA9IHF1ZXN0aW9uc1xuICAgIGFuYWx5c2lzLm1pc3NpbmdJbmZvID0gbWlzc2luZ0luZm9cbiAgfVxuXG4gIHJldHVybiBhbmFseXNpc1xufVxuXG4vKipcbiAqIEV4dHJhZSBkYXRvcyBlc3BlY8OtZmljb3MgZGVsIGV2ZW50byBkZXNkZSBlbCBtZW5zYWplXG4gKi9cbmZ1bmN0aW9uIGV4dHJhY3RFdmVudERhdGFGcm9tTWVzc2FnZShtZXNzYWdlOiBzdHJpbmcsIGV2ZW50VHlwZTogJ2V4YW0nIHwgJ3N0dWR5X3Nlc3Npb24nIHwgJ3BlcnNvbmFsJyB8ICdleHRyYWN1cnJpY3VsYXInKSB7XG4gIGNvbnN0IG1zZ0xvd2VyID0gbWVzc2FnZS50b0xvd2VyQ2FzZSgpXG4gIFxuICAvLyBFeHRyYWVyIG1hdGVyaWEgZGUgbWFuZXJhIG3DoXMgaW50ZWxpZ2VudGVcbiAgbGV0IHN1YmplY3QgPSBudWxsXG4gIGNvbnN0IHN1YmplY3RQYXR0ZXJucyA9IFtcbiAgICAvKD86ZXhhbWVufGV2YWx1YWNpW2/Ds11ufHBhcmNpYWx8ZmluYWx8cHJ1ZWJhfHRlc3QpLio/KD86ZGV8ZW4pXFxzKyhbYS16w6HDqcOtw7PDusOxXSspL2ksXG4gICAgLyhbYS16w6HDqcOtw7PDusOxXSspLio/KD86ZXhhbWVufGV2YWx1YWNpW2/Ds11ufHBhcmNpYWx8ZmluYWx8cHJ1ZWJhfHRlc3QpL2ksXG4gICAgLyg/OmVzdHVkaWFyfHJlcGFzYXJ8cHJlcGFyYXJ8cHJhY3RpY2FyKVxccysoW2EtesOhw6nDrcOzw7rDsV0rKS9pLFxuICAgIC8oPzpzZXNpW2/Ds11uLio/KD86ZGV8ZW4pXFxzKyhbYS16w6HDqcOtw7PDusOxXSspKS9pXG4gIF1cbiAgXG4gIGZvciAoY29uc3QgcGF0dGVybiBvZiBzdWJqZWN0UGF0dGVybnMpIHtcbiAgICBjb25zdCBtYXRjaCA9IG1lc3NhZ2UubWF0Y2gocGF0dGVybilcbiAgICBpZiAobWF0Y2ggJiYgbWF0Y2hbMV0pIHtcbiAgICAgIC8vIENhcGl0YWxpemFyIHByaW1lcmEgbGV0cmFcbiAgICAgIHN1YmplY3QgPSBtYXRjaFsxXS5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSArIG1hdGNoWzFdLnNsaWNlKDEpLnRvTG93ZXJDYXNlKClcbiAgICAgIGJyZWFrXG4gICAgfVxuICB9XG5cbiAgLy8gRXh0cmFlciBmZWNoYSBkZSBtYW5lcmEgbcOhcyBpbnRlbGlnZW50ZVxuICBsZXQgZGF0ZSA9IG51bGxcbiAgbGV0IHN0YXJ0VGltZSA9IG51bGxcbiAgXG4gIC8vIERldGVjdGFyIGZlY2hhcyBlc3BlY8OtZmljYXMgKGRkIGRlIG1lcywgZGQvbW0sIGV0Yy4pXG4gIGNvbnN0IHNwZWNpZmljRGF0ZVBhdHRlcm5zID0gW1xuICAgIC8oXFxkezEsMn0pXFxzK2RlXFxzKyhlbmVyb3xmZWJyZXJvfG1hcnpvfGFicmlsfG1heW98anVuaW98anVsaW98YWdvc3RvfHNlcHRpZW1icmV8b2N0dWJyZXxub3ZpZW1icmV8ZGljaWVtYnJlKS9pLFxuICAgIC8oXFxkezEsMn0pXFwvKFxcZHsxLDJ9KSg/OlxcLyhcXGR7Miw0fSkpPy8sXG4gICAgLyhcXGR7MSwyfSktKFxcZHsxLDJ9KSg/Oi0oXFxkezIsNH0pKT8vLFxuICAgIC9lbFxccysoXFxkezEsMn0pL2lcbiAgXVxuICBcbiAgZm9yIChjb25zdCBwYXR0ZXJuIG9mIHNwZWNpZmljRGF0ZVBhdHRlcm5zKSB7XG4gICAgY29uc3QgbWF0Y2ggPSBtZXNzYWdlLm1hdGNoKHBhdHRlcm4pXG4gICAgaWYgKG1hdGNoKSB7XG4gICAgICBpZiAocGF0dGVybi5zb3VyY2UuaW5jbHVkZXMoJ2RlJykpIHtcbiAgICAgICAgLy8gXCIxMCBkZSBqdWxpb1wiXG4gICAgICAgIGNvbnN0IGRheSA9IHBhcnNlSW50KG1hdGNoWzFdKVxuICAgICAgICBjb25zdCBtb250aE5hbWUgPSBtYXRjaFsyXS50b0xvd2VyQ2FzZSgpXG4gICAgICAgIGNvbnN0IG1vbnRoTWFwOiBSZWNvcmQ8c3RyaW5nLCBudW1iZXI+ID0ge1xuICAgICAgICAgICdlbmVybyc6IDAsICdmZWJyZXJvJzogMSwgJ21hcnpvJzogMiwgJ2FicmlsJzogMyxcbiAgICAgICAgICAnbWF5byc6IDQsICdqdW5pbyc6IDUsICdqdWxpbyc6IDYsICdhZ29zdG8nOiA3LFxuICAgICAgICAgICdzZXB0aWVtYnJlJzogOCwgJ29jdHVicmUnOiA5LCAnbm92aWVtYnJlJzogMTAsICdkaWNpZW1icmUnOiAxMVxuICAgICAgICB9XG4gICAgICAgIGlmIChtb250aE1hcFttb250aE5hbWVdICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICBjb25zdCBub3cgPSBuZXcgRGF0ZSgpXG4gICAgICAgICAgY29uc3QgZXZlbnREYXRlID0gbmV3IERhdGUobm93LmdldEZ1bGxZZWFyKCksIG1vbnRoTWFwW21vbnRoTmFtZV0sIGRheSlcbiAgICAgICAgICBkYXRlID0gZXZlbnREYXRlLnRvSVNPU3RyaW5nKCkuc3BsaXQoJ1QnKVswXVxuICAgICAgICB9XG4gICAgICB9IGVsc2UgaWYgKG1hdGNoWzFdICYmICFpc05hTihwYXJzZUludChtYXRjaFsxXSkpKSB7XG4gICAgICAgIC8vIEZvcm1hdG8gZGQvbW0gbyBkZC1tbSBvIFwiZWwgMTBcIlxuICAgICAgICBjb25zdCBkYXkgPSBwYXJzZUludChtYXRjaFsxXSlcbiAgICAgICAgY29uc3QgbW9udGggPSBtYXRjaFsyXSA/IHBhcnNlSW50KG1hdGNoWzJdKSAtIDEgOiBuZXcgRGF0ZSgpLmdldE1vbnRoKClcbiAgICAgICAgY29uc3QgeWVhciA9IG1hdGNoWzNdID8gcGFyc2VJbnQobWF0Y2hbM10pIDogbmV3IERhdGUoKS5nZXRGdWxsWWVhcigpXG4gICAgICAgIGNvbnN0IGV2ZW50RGF0ZSA9IG5ldyBEYXRlKHllYXIsIG1vbnRoLCBkYXkpXG4gICAgICAgIGRhdGUgPSBldmVudERhdGUudG9JU09TdHJpbmcoKS5zcGxpdCgnVCcpWzBdXG4gICAgICB9XG4gICAgICBicmVha1xuICAgIH1cbiAgfVxuXG4gIC8vIFNpIG5vIHNlIGVuY29udHLDsyBmZWNoYSBlc3BlY8OtZmljYSwgYnVzY2FyIGTDrWFzIHJlbGF0aXZvc1xuICBpZiAoIWRhdGUpIHtcbiAgICBjb25zdCByZWxhdGl2ZURhdGVQYXR0ZXJucyA9IFtcbiAgICAgIHsgcGF0dGVybjogL21hW8Oxbl1hbmEvaSwgZGF5czogMSB9LFxuICAgICAgeyBwYXR0ZXJuOiAvaG95L2ksIGRheXM6IDAgfSxcbiAgICAgIHsgcGF0dGVybjogL3Bhc2Fkby4qbWFbw7FuXWFuYS9pLCBkYXlzOiAyIH0sXG4gICAgICB7IHBhdHRlcm46IC9sdW5lcy9pLCB0YXJnZXREYXk6IDEgfSxcbiAgICAgIHsgcGF0dGVybjogL21hcnRlcy9pLCB0YXJnZXREYXk6IDIgfSxcbiAgICAgIHsgcGF0dGVybjogL21pW2XDqV1yY29sZXMvaSwgdGFyZ2V0RGF5OiAzIH0sXG4gICAgICB7IHBhdHRlcm46IC9qdWV2ZXMvaSwgdGFyZ2V0RGF5OiA0IH0sXG4gICAgICB7IHBhdHRlcm46IC92aWVybmVzL2ksIHRhcmdldERheTogNSB9LFxuICAgICAgeyBwYXR0ZXJuOiAvc1thw6FdYmFkby9pLCB0YXJnZXREYXk6IDYgfSxcbiAgICAgIHsgcGF0dGVybjogL2RvbWluZ28vaSwgdGFyZ2V0RGF5OiAwIH1cbiAgICBdXG5cbiAgICBmb3IgKGNvbnN0IHsgcGF0dGVybiwgZGF5cywgdGFyZ2V0RGF5IH0gb2YgcmVsYXRpdmVEYXRlUGF0dGVybnMpIHtcbiAgICAgIGlmIChwYXR0ZXJuLnRlc3QobWVzc2FnZSkpIHtcbiAgICAgICAgY29uc3Qgbm93ID0gbmV3IERhdGUoKVxuICAgICAgICBsZXQgZXZlbnREYXRlOiBEYXRlXG5cbiAgICAgICAgaWYgKGRheXMgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgIGV2ZW50RGF0ZSA9IG5ldyBEYXRlKG5vdy5nZXRUaW1lKCkgKyBkYXlzICogMjQgKiA2MCAqIDYwICogMTAwMClcbiAgICAgICAgfSBlbHNlIGlmICh0YXJnZXREYXkgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgIGNvbnN0IGN1cnJlbnREYXkgPSBub3cuZ2V0RGF5KClcbiAgICAgICAgICBsZXQgZGF5c1RvQWRkID0gdGFyZ2V0RGF5IC0gY3VycmVudERheVxuICAgICAgICAgIGlmIChkYXlzVG9BZGQgPD0gMCkgZGF5c1RvQWRkICs9IDcgLy8gUHLDs3hpbWEgc2VtYW5hXG4gICAgICAgICAgZXZlbnREYXRlID0gbmV3IERhdGUobm93LmdldFRpbWUoKSArIGRheXNUb0FkZCAqIDI0ICogNjAgKiA2MCAqIDEwMDApXG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgY29udGludWVcbiAgICAgICAgfVxuXG4gICAgICAgIGRhdGUgPSBldmVudERhdGUudG9JU09TdHJpbmcoKS5zcGxpdCgnVCcpWzBdXG4gICAgICAgIGJyZWFrXG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgLy8gRXh0cmFlciBob3JhIGRlIG1hbmVyYSBtw6FzIGludGVsaWdlbnRlXG4gIGNvbnN0IHRpbWVQYXR0ZXJucyA9IFtcbiAgICAvKD86YVxccytsYXM/XFxzKyk/KFxcZHsxLDJ9KSg/OjooXFxkezJ9KSk/XFxzKihhbXxwbXxhXFwuP21cXC4/fHBcXC4/bVxcLj8pL2ksXG4gICAgLyg/OmFcXHMrbGFzP1xccyspPyhcXGR7MSwyfSkoPzo6KFxcZHsyfSkpP1xccypoKD86b3Jhcz8pPy9pLFxuICAgIC8oXFxkezEsMn0pKD86OihcXGR7Mn0pKT9cXHMqKD86ZGVcXHMrbGFcXHMrKT8obWFbw7FuXWFuYXx0YXJkZXxub2NoZSkvaVxuICBdXG5cbiAgZm9yIChjb25zdCBwYXR0ZXJuIG9mIHRpbWVQYXR0ZXJucykge1xuICAgIGNvbnN0IG1hdGNoID0gbWVzc2FnZS5tYXRjaChwYXR0ZXJuKVxuICAgIGlmIChtYXRjaCkge1xuICAgICAgbGV0IGhvdXIgPSBwYXJzZUludChtYXRjaFsxXSlcbiAgICAgIGNvbnN0IG1pbnV0ZSA9IG1hdGNoWzJdID8gcGFyc2VJbnQobWF0Y2hbMl0pIDogMFxuICAgICAgY29uc3QgcGVyaW9kID0gbWF0Y2hbM10/LnRvTG93ZXJDYXNlKClcblxuICAgICAgLy8gQ29udmVydGlyIGEgZm9ybWF0byAyNGhcbiAgICAgIGlmIChwZXJpb2QpIHtcbiAgICAgICAgaWYgKChwZXJpb2QuaW5jbHVkZXMoJ3BtJykgfHwgcGVyaW9kLmluY2x1ZGVzKCdwLm0nKSB8fCBwZXJpb2QgPT09ICd0YXJkZScgfHwgcGVyaW9kID09PSAnbm9jaGUnKSAmJiBob3VyIDwgMTIpIHtcbiAgICAgICAgICBob3VyICs9IDEyXG4gICAgICAgIH0gZWxzZSBpZiAoKHBlcmlvZC5pbmNsdWRlcygnYW0nKSB8fCBwZXJpb2QuaW5jbHVkZXMoJ2EubScpIHx8IHBlcmlvZCA9PT0gJ21hW8Oxbl1hbmEnKSAmJiBob3VyID09PSAxMikge1xuICAgICAgICAgIGhvdXIgPSAwXG4gICAgICAgIH0gZWxzZSBpZiAocGVyaW9kID09PSAnbm9jaGUnICYmIGhvdXIgPCA2KSB7XG4gICAgICAgICAgaG91ciArPSAxMiAvLyBQYXJhIGNhc29zIGNvbW8gXCIzIGRlIGxhIG5vY2hlXCIgPSAxNTowMFxuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIHN0YXJ0VGltZSA9IGAke2hvdXIudG9TdHJpbmcoKS5wYWRTdGFydCgyLCAnMCcpfToke21pbnV0ZS50b1N0cmluZygpLnBhZFN0YXJ0KDIsICcwJyl9YFxuICAgICAgYnJlYWtcbiAgICB9XG4gIH1cblxuICAvLyBFeHRyYWVyIHViaWNhY2nDs25cbiAgbGV0IGxvY2F0aW9uID0gbnVsbFxuICBjb25zdCBsb2NhdGlvblBhdHRlcm5zID0gW1xuICAgIC8oPzplblxccytlbD9cXHMrKT8oYXVsYXxsYWJvcmF0b3Jpb3xzYWxhfGF1ZGl0b3JpbylcXHMrKFthLXpBLVowLTldKykvaSxcbiAgICAvKD86ZW5cXHMrKShbYS16QS1aXFxzXSsoPzphdWxhfGxhYm9yYXRvcmlvfHNhbGF8YXVkaXRvcmlvKVthLXpBLVowLTlcXHNdKikvaVxuICBdXG5cbiAgZm9yIChjb25zdCBwYXR0ZXJuIG9mIGxvY2F0aW9uUGF0dGVybnMpIHtcbiAgICBjb25zdCBtYXRjaCA9IG1lc3NhZ2UubWF0Y2gocGF0dGVybilcbiAgICBpZiAobWF0Y2gpIHtcbiAgICAgIGxvY2F0aW9uID0gbWF0Y2hbMF0ucmVwbGFjZSgvXmVuXFxzKy9pLCAnJykudHJpbSgpXG4gICAgICBicmVha1xuICAgIH1cbiAgfVxuXG4gIC8vIEV4dHJhZXIgZHVyYWNpw7NuXG4gIGxldCBkdXJhdGlvbiA9IG51bGxcbiAgY29uc3QgZHVyYXRpb25NYXRjaCA9IG1lc3NhZ2UubWF0Y2goLyg/OmR1cmFudGVcXHMrKT8oXFxkKylcXHMqKGhvcmFzP3xtaW51dG9zP3xtaW4pL2kpXG4gIGlmIChkdXJhdGlvbk1hdGNoKSB7XG4gICAgY29uc3QgdmFsdWUgPSBwYXJzZUludChkdXJhdGlvbk1hdGNoWzFdKVxuICAgIGNvbnN0IHVuaXQgPSBkdXJhdGlvbk1hdGNoWzJdLnRvTG93ZXJDYXNlKClcbiAgICBkdXJhdGlvbiA9IHVuaXQuaW5jbHVkZXMoJ2hvcmEnKSA/IHZhbHVlICogNjAgOiB2YWx1ZVxuICB9XG5cbiAgLy8gRXh0cmFlciBkZXNjcmlwY2nDs24vdGVtYSBlc3BlY8OtZmljbyBzaSBzZSBtZW5jaW9uYVxuICBsZXQgZGVzY3JpcHRpb24gPSBudWxsXG4gIGNvbnN0IHRvcGljUGF0dGVybnMgPSBbXG4gICAgLyg/OnNvYnJlfHRlbWF8dGVtYXM/KVxccysoW2EtesOhw6nDrcOzw7rDsVxcc10rPykoPzpcXHMrcGFyYXxcXHMrZWx8XFxzK2F8JCkvaSxcbiAgICAvKD86c29icmUpXFxzK2VsXFxzK3RlbWFcXHMrKFthLXrDocOpw63Ds8O6w7FcXHNdKz8pKD86XFxzK3BhcmF8XFxzK2VsfFxccythfCQpL2lcbiAgXVxuICBcbiAgZm9yIChjb25zdCBwYXR0ZXJuIG9mIHRvcGljUGF0dGVybnMpIHtcbiAgICBjb25zdCBtYXRjaCA9IG1lc3NhZ2UubWF0Y2gocGF0dGVybilcbiAgICBpZiAobWF0Y2ggJiYgbWF0Y2hbMV0gJiYgbWF0Y2hbMV0udHJpbSgpLmxlbmd0aCA+IDMpIHtcbiAgICAgIGRlc2NyaXB0aW9uID0gbWF0Y2hbMV0udHJpbSgpXG4gICAgICBicmVha1xuICAgIH1cbiAgfVxuXG4gIHJldHVybiB7XG4gICAgaGFzRXZlbnQ6IHRydWUsXG4gICAgc3ViamVjdCxcbiAgICBkYXRlLFxuICAgIHN0YXJ0VGltZSxcbiAgICBsb2NhdGlvbixcbiAgICBkdXJhdGlvbixcbiAgICBkZXNjcmlwdGlvblxuICB9XG59XG5cbi8qKlxuICogR2VuZXJhIHByZWd1bnRhcyBwYXJhIGNvbXBsZXRhciBsYSBpbmZvcm1hY2nDs24gZGUgdW4gZXZlbnRvXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBnZW5lcmF0ZUV2ZW50UXVlc3Rpb25zKHN1Z2dlc3Rpb246IEV2ZW50U3VnZ2VzdGlvbik6IHN0cmluZ1tdIHtcbiAgY29uc3QgcXVlc3Rpb25zOiBzdHJpbmdbXSA9IFtdXG5cbiAgaWYgKCFzdWdnZXN0aW9uLmRhdGUpIHtcbiAgICBxdWVzdGlvbnMucHVzaChcIvCfk4Ugwr9QYXJhIHF1w6kgZmVjaGEgZXM/XCIpXG4gIH1cblxuICBpZiAoIXN1Z2dlc3Rpb24uc3RhcnRUaW1lKSB7XG4gICAgcXVlc3Rpb25zLnB1c2goXCLwn5WQIMK/QSBxdcOpIGhvcmE/XCIpXG4gIH1cblxuICBpZiAoc3VnZ2VzdGlvbi50eXBlID09PSAnZXhhbScpIHtcbiAgICBpZiAoIXN1Z2dlc3Rpb24uc3ViamVjdCkge1xuICAgICAgcXVlc3Rpb25zLnB1c2goXCLwn5OaIMK/RGUgcXXDqSBtYXRlcmlhIGVzIGVsIGV4YW1lbj9cIilcbiAgICB9XG4gICAgaWYgKCFzdWdnZXN0aW9uLmxvY2F0aW9uKSB7XG4gICAgICBxdWVzdGlvbnMucHVzaChcIvCfk40gwr9FbiBxdcOpIGF1bGEgbyBsYWJvcmF0b3JpbyBzZXLDoT9cIilcbiAgICB9XG4gICAgaWYgKCFzdWdnZXN0aW9uLmR1cmF0aW9uKSB7XG4gICAgICBxdWVzdGlvbnMucHVzaChcIuKPse+4jyDCv0N1w6FudG8gdGllbXBvIGR1cmFyw6E/XCIpXG4gICAgfVxuICB9XG5cbiAgaWYgKHN1Z2dlc3Rpb24udHlwZSA9PT0gJ3N0dWR5X3Nlc3Npb24nKSB7XG4gICAgaWYgKCFzdWdnZXN0aW9uLnN1YmplY3QpIHtcbiAgICAgIHF1ZXN0aW9ucy5wdXNoKFwi8J+TliDCv1F1w6kgdGVtYSB2YXMgYSBlc3R1ZGlhcj9cIilcbiAgICB9XG4gICAgaWYgKCFzdWdnZXN0aW9uLmR1cmF0aW9uKSB7XG4gICAgICBxdWVzdGlvbnMucHVzaChcIuKPsCDCv0N1w6FudGFzIGhvcmFzIHBsYW5lYXMgZXN0dWRpYXI/XCIpXG4gICAgfVxuICB9XG5cbiAgaWYgKHN1Z2dlc3Rpb24udHlwZSA9PT0gJ3BlcnNvbmFsJyB8fCBzdWdnZXN0aW9uLnR5cGUgPT09ICdleHRyYWN1cnJpY3VsYXInKSB7XG4gICAgaWYgKCFzdWdnZXN0aW9uLmxvY2F0aW9uKSB7XG4gICAgICBxdWVzdGlvbnMucHVzaChcIvCfk40gwr9Ew7NuZGUgc2Vyw6E/XCIpXG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIHF1ZXN0aW9uc1xufVxuXG4vKipcbiAqIENvbnZpZXJ0ZSB1bmEgc3VnZXJlbmNpYSBkZSBldmVudG8gZW4gdW4gZXZlbnRvIGRlIGNhbGVuZGFyaW9cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGNvbnZlcnRTdWdnZXN0aW9uVG9DYWxlbmRhckV2ZW50KFxuICBzdWdnZXN0aW9uOiBFdmVudFN1Z2dlc3Rpb24sXG4gIHVzZXJJZDogc3RyaW5nLFxuICBhZGRpdGlvbmFsSW5mbz86IFBhcnRpYWw8RXZlbnRTdWdnZXN0aW9uPlxuKTogQ2FsZW5kYXJFdmVudCB7XG4gIGNvbnN0IG1lcmdlZCA9IHsgLi4uc3VnZ2VzdGlvbiwgLi4uYWRkaXRpb25hbEluZm8gfVxuICBcbiAgLy8gUHJvY2VzYXIgZmVjaGFcbiAgbGV0IGV2ZW50RGF0ZSA9IG5ldyBEYXRlKClcbiAgaWYgKG1lcmdlZC5kYXRlKSB7XG4gICAgZXZlbnREYXRlID0gcGFyc2VEYXRlRnJvbVRleHQobWVyZ2VkLmRhdGUpXG4gIH1cblxuICAvLyBQcm9jZXNhciBob3JhXG4gIGxldCBzdGFydFRpbWUgPSBtZXJnZWQuc3RhcnRUaW1lIHx8ICcxNTowMCdcbiAgbGV0IGVuZFRpbWUgPSBtZXJnZWQuc3RhcnRUaW1lIHx8ICcxNjowMCdcbiAgXG4gIGlmIChtZXJnZWQuZHVyYXRpb24gJiYgbWVyZ2VkLnN0YXJ0VGltZSkge1xuICAgIGNvbnN0IHN0YXJ0ID0gbmV3IERhdGUoYDIwMDAtMDEtMDFUJHttZXJnZWQuc3RhcnRUaW1lfTowMGApXG4gICAgY29uc3QgZW5kID0gbmV3IERhdGUoc3RhcnQuZ2V0VGltZSgpICsgbWVyZ2VkLmR1cmF0aW9uICogNjAwMDApXG4gICAgZW5kVGltZSA9IGVuZC50b1RpbWVTdHJpbmcoKS5zdWJzdHJpbmcoMCwgNSlcbiAgfVxuXG4gIGNvbnN0IGV2ZW50OiBDYWxlbmRhckV2ZW50ID0ge1xuICAgIGlkOiBgYWktZXZlbnQtJHtEYXRlLm5vdygpfWAsXG4gICAgdGl0bGU6IG1lcmdlZC50aXRsZSxcbiAgICBkYXRlOiBldmVudERhdGUsXG4gICAgc3RhcnRUaW1lOiBzdGFydFRpbWUsXG4gICAgZW5kVGltZTogZW5kVGltZSxcbiAgICB0eXBlOiBtZXJnZWQudHlwZSxcbiAgICBjb2xvcjogZ2V0RXZlbnRUeXBlQ29sb3IobWVyZ2VkLnR5cGUpLFxuICAgIHN1YmplY3Q6IG1lcmdlZC5zdWJqZWN0LFxuICAgIGxvY2F0aW9uOiBtZXJnZWQubG9jYXRpb24sXG4gICAgZGVzY3JpcHRpb246IG1lcmdlZC5kZXNjcmlwdGlvbiB8fCAnQ3JlYWRvIGF1dG9tw6F0aWNhbWVudGUgcG9yIElBIFR1dG9yYScsXG4gICAgcHJpb3JpdHk6IG1lcmdlZC5wcmlvcml0eSB8fCAnbWVkaXVtJyxcbiAgICBkdXJhdGlvbjogbWVyZ2VkLmR1cmF0aW9uIHx8IDYwXG4gIH1cblxuICByZXR1cm4gZXZlbnRcbn1cblxuLyoqXG4gKiBDcmVhIHVuIGV2ZW50byBhdXRvbcOhdGljYW1lbnRlIGRlc2RlIGxhIElBIHVzYW5kbyBlbCBBUEkgZW5kcG9pbnQgZGVkaWNhZG9cbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGNyZWF0ZUV2ZW50RnJvbUFJKFxuICBzdWdnZXN0aW9uOiBFdmVudFN1Z2dlc3Rpb24sXG4gIHVzZXJJZDogc3RyaW5nLFxuICBhZGRpdGlvbmFsSW5mbz86IFBhcnRpYWw8RXZlbnRTdWdnZXN0aW9uPlxuKTogUHJvbWlzZTx7IHN1Y2Nlc3M6IGJvb2xlYW47IGV2ZW50PzogQ2FsZW5kYXJFdmVudDsgbWVzc2FnZT86IHN0cmluZyB9PiB7XG4gIHRyeSB7XG4gICAgY29uc3QgbWVyZ2VkID0geyAuLi5zdWdnZXN0aW9uLCAuLi5hZGRpdGlvbmFsSW5mbyB9XG4gICAgXG4gICAgLy8gUHJvY2VzYXIgZmVjaGFcbiAgICBsZXQgZXZlbnREYXRlID0gbmV3IERhdGUoKVxuICAgIGlmIChtZXJnZWQuZGF0ZSkge1xuICAgICAgZXZlbnREYXRlID0gcGFyc2VEYXRlRnJvbVRleHQobWVyZ2VkLmRhdGUpXG4gICAgfVxuICAgIFxuICAgIC8vIENhbGN1bGFyIGVuZFRpbWUgYmFzYWRvIGVuIGR1cmF0aW9uIHkgc3RhcnRUaW1lXG4gICAgbGV0IGVuZFRpbWUgPSBtZXJnZWQuc3RhcnRUaW1lIHx8ICcxNjowMCdcbiAgICBpZiAobWVyZ2VkLmR1cmF0aW9uICYmIG1lcmdlZC5zdGFydFRpbWUpIHtcbiAgICAgIGNvbnN0IHN0YXJ0ID0gbmV3IERhdGUoYDIwMDAtMDEtMDFUJHttZXJnZWQuc3RhcnRUaW1lfTowMGApXG4gICAgICBjb25zdCBlbmQgPSBuZXcgRGF0ZShzdGFydC5nZXRUaW1lKCkgKyBtZXJnZWQuZHVyYXRpb24gKiA2MDAwMClcbiAgICAgIGVuZFRpbWUgPSBlbmQudG9UaW1lU3RyaW5nKCkuc3Vic3RyaW5nKDAsIDUpXG4gICAgfVxuXG4gICAgY29uc3QgZXZlbnREYXRhID0ge1xuICAgICAgdGl0bGU6IG1lcmdlZC50aXRsZSxcbiAgICAgIHR5cGU6IG1lcmdlZC50eXBlLFxuICAgICAgc3ViamVjdDogbWVyZ2VkLnN1YmplY3QsXG4gICAgICBkYXRlOiBldmVudERhdGUudG9JU09TdHJpbmcoKSxcbiAgICAgIHN0YXJ0VGltZTogbWVyZ2VkLnN0YXJ0VGltZSB8fCAnMTU6MDAnLFxuICAgICAgZW5kVGltZTogZW5kVGltZSxcbiAgICAgIGR1cmF0aW9uOiBtZXJnZWQuZHVyYXRpb24gfHwgNjAsXG4gICAgICBsb2NhdGlvbjogbWVyZ2VkLmxvY2F0aW9uLFxuICAgICAgZGVzY3JpcHRpb246IG1lcmdlZC5kZXNjcmlwdGlvbiB8fCBgQ3JlYWRvIGF1dG9tw6F0aWNhbWVudGUgcG9yIElBIFR1dG9yYWAsXG4gICAgICBwcmlvcml0eTogbWVyZ2VkLnByaW9yaXR5IHx8ICdtZWRpdW0nXG4gICAgfVxuXG4gICAgLy8gRm9yIHNlcnZlci1zaWRlIGV4ZWN1dGlvbiwgY2FsbCB0aGUgZnVuY3Rpb24gZGlyZWN0bHkgaW5zdGVhZCBvZiBIVFRQIGZldGNoXG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHsgY3JlYXRlQ2FsZW5kYXJFdmVudCB9ID0gcmVxdWlyZSgnLi4vYXBwL2FwaS9haS1jYWxlbmRhci9jcmVhdGUtZXZlbnQvcm91dGUnKVxuICAgICAgY29uc3QgbW9ja1JlcXVlc3QgPSB7XG4gICAgICAgIGpzb246IGFzeW5jICgpID0+IGV2ZW50RGF0YVxuICAgICAgfVxuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBjcmVhdGVDYWxlbmRhckV2ZW50KG1vY2tSZXF1ZXN0IGFzIGFueSlcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKVxuICAgICAgXG4gICAgICByZXR1cm4ge1xuICAgICAgICBzdWNjZXNzOiByZXN1bHQuc3VjY2VzcyxcbiAgICAgICAgZXZlbnQ6IHJlc3VsdC5ldmVudCxcbiAgICAgICAgbWVzc2FnZTogcmVzdWx0Lm1lc3NhZ2VcbiAgICAgIH1cbiAgICB9IGNhdGNoIChkaXJlY3RDYWxsRXJyb3IpIHtcbiAgICAgIGNvbnNvbGUubG9nKCdEaXJlY3QgQVBJIGNhbGwgZmFpbGVkLCB0cnlpbmcgYWx0ZXJuYXRpdmUgYXBwcm9hY2g6JywgZGlyZWN0Q2FsbEVycm9yKVxuICAgICAgXG4gICAgICAvLyBBbHRlcm5hdGl2ZTogVXNlIGNhbGVuZGFyLWRhdGEgZnVuY3Rpb25zIGRpcmVjdGx5XG4gICAgICBjb25zdCB7IGFkZENhbGVuZGFyRXZlbnQsIGdldFVzZXJDYWxlbmRhckRhdGEsIGNyZWF0ZVVzZXJDYWxlbmRhckRhdGEgfSA9IHJlcXVpcmUoJy4vY2FsZW5kYXItZGF0YScpXG4gICAgICBcbiAgICAgIC8vIEVuc3VyZSB1c2VyIGhhcyBjYWxlbmRhciBkYXRhXG4gICAgICBsZXQgdXNlckRhdGEgPSBnZXRVc2VyQ2FsZW5kYXJEYXRhKHVzZXJJZClcbiAgICAgIGlmICghdXNlckRhdGEpIHtcbiAgICAgICAgY29uc29sZS5sb2coYPCfhpUgQ3JlYXRpbmcgY2FsZW5kYXIgZGF0YSBmb3IgdXNlciAke3VzZXJJZH1gKVxuICAgICAgICB1c2VyRGF0YSA9IGNyZWF0ZVVzZXJDYWxlbmRhckRhdGEodXNlcklkKVxuICAgICAgfVxuICAgICAgXG4gICAgICBjb25zdCBjYWxlbmRhckV2ZW50ID0ge1xuICAgICAgICBpZDogYGFpLWV2ZW50LSR7RGF0ZS5ub3coKX1gLFxuICAgICAgICB0aXRsZTogZXZlbnREYXRhLnRpdGxlLFxuICAgICAgICBkYXRlOiBuZXcgRGF0ZShldmVudERhdGEuZGF0ZSksXG4gICAgICAgIHN0YXJ0VGltZTogZXZlbnREYXRhLnN0YXJ0VGltZSxcbiAgICAgICAgZW5kVGltZTogZXZlbnREYXRhLmVuZFRpbWUsXG4gICAgICAgIHR5cGU6IGV2ZW50RGF0YS50eXBlLFxuICAgICAgICBjb2xvcjogJyMzQjgyRjYnLCAvLyBEZWZhdWx0IGNvbG9yXG4gICAgICAgIHN1YmplY3Q6IGV2ZW50RGF0YS5zdWJqZWN0LFxuICAgICAgICBsb2NhdGlvbjogZXZlbnREYXRhLmxvY2F0aW9uLFxuICAgICAgICBkZXNjcmlwdGlvbjogZXZlbnREYXRhLmRlc2NyaXB0aW9uLFxuICAgICAgICBwcmlvcml0eTogZXZlbnREYXRhLnByaW9yaXR5LFxuICAgICAgICBkdXJhdGlvbjogZXZlbnREYXRhLmR1cmF0aW9uXG4gICAgICB9XG4gICAgICBcbiAgICAgIGNvbnNvbGUubG9nKGDwn5OFIENyZWF0aW5nIGV2ZW50OiAke2NhbGVuZGFyRXZlbnQudGl0bGV9IGZvciAke2V2ZW50RGF0YS5kYXRlfSBhdCAke2V2ZW50RGF0YS5zdGFydFRpbWV9YClcbiAgICAgIGNvbnN0IHN1Y2Nlc3MgPSBhZGRDYWxlbmRhckV2ZW50KHVzZXJJZCwgY2FsZW5kYXJFdmVudClcbiAgICAgIFxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3VjY2VzcyxcbiAgICAgICAgZXZlbnQ6IHN1Y2Nlc3MgPyBjYWxlbmRhckV2ZW50IDogdW5kZWZpbmVkLFxuICAgICAgICBtZXNzYWdlOiBzdWNjZXNzID8gJ0V2ZW50byBjcmVhZG8gZXhpdG9zYW1lbnRlJyA6ICdFcnJvciBhbCBjcmVhciBldmVudG8nXG4gICAgICB9XG4gICAgfVxuXG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgcmVzcG9uc2UuanNvbigpXG4gICAgXG4gICAgaWYgKHJlc3VsdC5zdWNjZXNzKSB7XG4gICAgICBjb25zb2xlLmxvZyhg8J+kliBJQSBjb25maXJtw7MgY3JlYWNpw7NuOiAke3Jlc3VsdC5ldmVudC50aXRsZX1gKVxuICAgICAgXG4gICAgICAvLyBEaXNwYXJhciBldmVudG8gZGVsIGxhZG8gZGVsIGNsaWVudGUgcGFyYSBub3RpZmljYXIgY29tcG9uZW50ZXNcbiAgICAgIGlmICh0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICB3aW5kb3cuZGlzcGF0Y2hFdmVudChuZXcgQ3VzdG9tRXZlbnQoJ2NhbGVuZGFyRXZlbnRDcmVhdGVkJywge1xuICAgICAgICAgICAgZGV0YWlsOiB7IGV2ZW50OiByZXN1bHQuZXZlbnQsIHVzZXJJZCB9XG4gICAgICAgICAgfSkpXG4gICAgICAgIH0sIDIwMClcbiAgICAgIH1cbiAgICAgIFxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgZXZlbnQ6IHJlc3VsdC5ldmVudCxcbiAgICAgICAgbWVzc2FnZTogcmVzdWx0Lm1lc3NhZ2VcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgY29uc29sZS5lcnJvcign4p2MIElBIGZhbGzDsyBhbCBjcmVhciBldmVudG86JywgcmVzdWx0LmVycm9yKVxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIG1lc3NhZ2U6IHJlc3VsdC5lcnJvciB8fCAnRXJyb3IgZGVzY29ub2NpZG8nXG4gICAgICB9XG4gICAgfVxuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBFcnJvciBpbiBBSSBldmVudCBjcmVhdGlvbjonLCBlcnJvcilcbiAgICByZXR1cm4ge1xuICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICBtZXNzYWdlOiAnRXJyb3IgZGUgY29uZXhpw7NuIGFsIGNyZWFyIGV2ZW50bydcbiAgICB9XG4gIH1cbn1cblxuLyoqXG4gKiBQYXJzZWEgZmVjaGFzIGRlc2RlIHRleHRvIG5hdHVyYWxcbiAqL1xuZnVuY3Rpb24gcGFyc2VEYXRlRnJvbVRleHQoZGF0ZVRleHQ6IHN0cmluZyk6IERhdGUge1xuICBjb25zdCB0ZXh0ID0gZGF0ZVRleHQudG9Mb3dlckNhc2UoKVxuICBjb25zdCB0b2RheSA9IG5ldyBEYXRlKClcbiAgXG4gIGlmICh0ZXh0LmluY2x1ZGVzKCdob3knKSkge1xuICAgIHJldHVybiB0b2RheVxuICB9XG4gIFxuICBpZiAodGV4dC5pbmNsdWRlcygnbWHDsWFuYScpIHx8IHRleHQuaW5jbHVkZXMoJ21hW8Oxbl1hbmEnKSkge1xuICAgIGNvbnN0IHRvbW9ycm93ID0gbmV3IERhdGUodG9kYXkpXG4gICAgdG9tb3Jyb3cuc2V0RGF0ZSh0b2RheS5nZXREYXRlKCkgKyAxKVxuICAgIHJldHVybiB0b21vcnJvd1xuICB9XG4gIFxuICBpZiAodGV4dC5pbmNsdWRlcygncGFzYWRvJykpIHtcbiAgICBjb25zdCBkYXlBZnRlclRvbW9ycm93ID0gbmV3IERhdGUodG9kYXkpXG4gICAgZGF5QWZ0ZXJUb21vcnJvdy5zZXREYXRlKHRvZGF5LmdldERhdGUoKSArIDIpXG4gICAgcmV0dXJuIGRheUFmdGVyVG9tb3Jyb3dcbiAgfVxuXG4gIC8vIETDrWFzIGRlIGxhIHNlbWFuYVxuICBjb25zdCBkYXlNYXA6IFJlY29yZDxzdHJpbmcsIG51bWJlcj4gPSB7XG4gICAgJ2x1bmVzJzogMSwgJ21hcnRlcyc6IDIsICdtacOpcmNvbGVzJzogMywgJ21pZXJjb2xlcyc6IDMsXG4gICAgJ2p1ZXZlcyc6IDQsICd2aWVybmVzJzogNSwgJ3PDoWJhZG8nOiA2LCAnc2FiYWRvJzogNiwgJ2RvbWluZ28nOiAwXG4gIH1cblxuICBmb3IgKGNvbnN0IFtkYXlOYW1lLCBkYXlOdW1iZXJdIG9mIE9iamVjdC5lbnRyaWVzKGRheU1hcCkpIHtcbiAgICBpZiAodGV4dC5pbmNsdWRlcyhkYXlOYW1lKSkge1xuICAgICAgY29uc3QgdGFyZ2V0RGF0ZSA9IG5ldyBEYXRlKHRvZGF5KVxuICAgICAgY29uc3QgY3VycmVudERheSA9IHRvZGF5LmdldERheSgpXG4gICAgICBsZXQgZGF5c1RvQWRkID0gZGF5TnVtYmVyIC0gY3VycmVudERheVxuICAgICAgXG4gICAgICBpZiAoZGF5c1RvQWRkIDw9IDApIHtcbiAgICAgICAgZGF5c1RvQWRkICs9IDcgLy8gUHLDs3hpbWEgc2VtYW5hXG4gICAgICB9XG4gICAgICBcbiAgICAgIHRhcmdldERhdGUuc2V0RGF0ZSh0b2RheS5nZXREYXRlKCkgKyBkYXlzVG9BZGQpXG4gICAgICByZXR1cm4gdGFyZ2V0RGF0ZVxuICAgIH1cbiAgfVxuXG4gIC8vIFNpIGluY2x1eWUgbsO6bWVyb3MgKGVqOiBcImVuIDMgZMOtYXNcIilcbiAgY29uc3QgZGF5c01hdGNoID0gdGV4dC5tYXRjaCgvZW5cXHMrKFxcZCspXFxzK2RbacOtXWFzPy8pXG4gIGlmIChkYXlzTWF0Y2gpIHtcbiAgICBjb25zdCBkYXlzID0gcGFyc2VJbnQoZGF5c01hdGNoWzFdKVxuICAgIGNvbnN0IGZ1dHVyZURhdGUgPSBuZXcgRGF0ZSh0b2RheSlcbiAgICBmdXR1cmVEYXRlLnNldERhdGUodG9kYXkuZ2V0RGF0ZSgpICsgZGF5cylcbiAgICByZXR1cm4gZnV0dXJlRGF0ZVxuICB9XG5cbiAgLy8gUG9yIGRlZmVjdG8sIGRldm9sdmVyIG1hw7FhbmFcbiAgY29uc3QgZGVmYXVsdERhdGUgPSBuZXcgRGF0ZSh0b2RheSlcbiAgZGVmYXVsdERhdGUuc2V0RGF0ZSh0b2RheS5nZXREYXRlKCkgKyAxKVxuICByZXR1cm4gZGVmYXVsdERhdGVcbn1cblxuLyoqXG4gKiBHZW5lcmEgcmVzcHVlc3RhIGRlIGxhIElBIHBhcmEgc3VnZXJpciBjcmVhciBldmVudG9zXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBnZW5lcmF0ZUV2ZW50U3VnZ2VzdGlvblJlc3BvbnNlKGFuYWx5c2lzOiBDb252ZXJzYXRpb25BbmFseXNpcyk6IHN0cmluZyB7XG4gIGlmICghYW5hbHlzaXMuaGFzRXZlbnRNZW50aW9uIHx8IGFuYWx5c2lzLmV2ZW50U3VnZ2VzdGlvbnMubGVuZ3RoID09PSAwKSB7XG4gICAgcmV0dXJuIFwiXCJcbiAgfVxuXG4gIGNvbnN0IHN1Z2dlc3Rpb24gPSBhbmFseXNpcy5ldmVudFN1Z2dlc3Rpb25zWzBdIC8vIFRvbWFyIGxhIHByaW1lcmEgc3VnZXJlbmNpYVxuICBcbiAgbGV0IHJlc3BvbnNlID0gYPCfk4UgUGVyZmVjdG8hIFZlbyBxdWUgcXVpZXJlcyBhZ2VuZGFyOiAqKiR7c3VnZ2VzdGlvbi50aXRsZX0qKlxcblxcbmBcbiAgXG4gIC8vIE1vc3RyYXIgaW5mb3JtYWNpw7NuIGRldGVjdGFkYVxuICBjb25zdCBkZXRlY3RlZEluZm86IHN0cmluZ1tdID0gW11cbiAgaWYgKHN1Z2dlc3Rpb24uc3ViamVjdCkgZGV0ZWN0ZWRJbmZvLnB1c2goYPCfk5ogTWF0ZXJpYTogJHtzdWdnZXN0aW9uLnN1YmplY3R9YClcbiAgaWYgKHN1Z2dlc3Rpb24uZGF0ZSkge1xuICAgIGNvbnN0IGRhdGVPYmogPSBuZXcgRGF0ZShzdWdnZXN0aW9uLmRhdGUpXG4gICAgY29uc3QgZm9ybWF0dGVkRGF0ZSA9IGRhdGVPYmoudG9Mb2NhbGVEYXRlU3RyaW5nKCdlcy1FUycsIHtcbiAgICAgIHdlZWtkYXk6ICdsb25nJyxcbiAgICAgIGRheTogJ251bWVyaWMnLCBcbiAgICAgIG1vbnRoOiAnbG9uZydcbiAgICB9KVxuICAgIGRldGVjdGVkSW5mby5wdXNoKGDwn5OFIEZlY2hhOiAke2Zvcm1hdHRlZERhdGV9YClcbiAgfVxuICBpZiAoc3VnZ2VzdGlvbi5zdGFydFRpbWUpIGRldGVjdGVkSW5mby5wdXNoKGDwn5WQIEhvcmE6ICR7c3VnZ2VzdGlvbi5zdGFydFRpbWV9YClcbiAgaWYgKHN1Z2dlc3Rpb24ubG9jYXRpb24pIGRldGVjdGVkSW5mby5wdXNoKGDwn5ONIFViaWNhY2nDs246ICR7c3VnZ2VzdGlvbi5sb2NhdGlvbn1gKVxuICBcbiAgaWYgKGRldGVjdGVkSW5mby5sZW5ndGggPiAwKSB7XG4gICAgcmVzcG9uc2UgKz0gYCoqSW5mb3JtYWNpw7NuIGRldGVjdGFkYToqKlxcbiR7ZGV0ZWN0ZWRJbmZvLmpvaW4oJ1xcbicpfVxcblxcbmBcbiAgfVxuICBcbiAgaWYgKGFuYWx5c2lzLnF1ZXN0aW9ucy5sZW5ndGggPiAwKSB7XG4gICAgcmVzcG9uc2UgKz0gYFBhcmEgY29tcGxldGFyIGVsIGV2ZW50byBuZWNlc2l0bzpcXG5gXG4gICAgYW5hbHlzaXMucXVlc3Rpb25zLmZvckVhY2goKHF1ZXN0aW9uLCBpbmRleCkgPT4ge1xuICAgICAgcmVzcG9uc2UgKz0gYCR7aW5kZXggKyAxfS4gJHtxdWVzdGlvbn1cXG5gXG4gICAgfSlcbiAgICByZXNwb25zZSArPSBgXFxuwr9Qb2Ryw61hcyBkYXJtZSBlc3RvcyBkZXRhbGxlcz9gXG4gIH0gZWxzZSB7XG4gICAgcmVzcG9uc2UgKz0gYMKhVGVuZ28gdG9kYSBsYSBpbmZvcm1hY2nDs24gbmVjZXNhcmlhISDCv0NvbmZpcm1hcyBxdWUgbG8gYWdyZWd1ZSBhIHR1IGNhbGVuZGFyaW8/YFxuICB9XG5cbiAgcmV0dXJuIHJlc3BvbnNlXG59XG5cbi8qKlxuICogSW50ZXJmYXogcGFyYSBlbCB3b3JrZmxvdyBjb21wbGV0byBkZSBjcmVhY2nDs24gZGUgZXZlbnRvcyBwb3IgSUFcbiAqL1xuZXhwb3J0IGNsYXNzIEFJQ2FsZW5kYXJJbnRlZ3JhdGlvbiB7XG4gIHByaXZhdGUgdXNlcklkOiBzdHJpbmdcbiAgcHJpdmF0ZSBwZW5kaW5nU3VnZ2VzdGlvbjogRXZlbnRTdWdnZXN0aW9uIHwgbnVsbCA9IG51bGxcbiAgcHJpdmF0ZSBjb2xsZWN0ZWRJbmZvOiBQYXJ0aWFsPEV2ZW50U3VnZ2VzdGlvbj4gPSB7fVxuXG4gIGNvbnN0cnVjdG9yKHVzZXJJZDogc3RyaW5nKSB7XG4gICAgdGhpcy51c2VySWQgPSB1c2VySWRcbiAgfVxuXG4gIC8qKlxuICAgKiBQcm9jZXNhIHVuIG1lbnNhamUgZGVsIHVzdWFyaW8geSBkZXRlY3RhIHNpIG5lY2VzaXRhIGNyZWFyIGV2ZW50b3NcbiAgICovXG4gIGFzeW5jIHByb2Nlc3NNZXNzYWdlKG1lc3NhZ2U6IHN0cmluZywgY29udmVyc2F0aW9uSGlzdG9yeTogQXJyYXk8eyByb2xlOiAndXNlcicgfCAnYXNzaXN0YW50JywgY29udGVudDogc3RyaW5nIH0+KTogUHJvbWlzZTx7XG4gICAgbmVlZHNFdmVudENyZWF0aW9uOiBib29sZWFuXG4gICAgcmVzcG9uc2U/OiBzdHJpbmdcbiAgICBxdWVzdGlvbnM/OiBzdHJpbmdbXVxuICAgIGV2ZW50PzogQ2FsZW5kYXJFdmVudFxuICB9PiB7XG4gICAgY29uc3QgYW5hbHlzaXMgPSBhbmFseXplQ29udmVyc2F0aW9uRm9yRXZlbnRzKFsuLi5jb252ZXJzYXRpb25IaXN0b3J5LCB7IHJvbGU6ICd1c2VyJywgY29udGVudDogbWVzc2FnZSB9XSlcblxuICAgIGlmIChhbmFseXNpcy5oYXNFdmVudE1lbnRpb24gJiYgYW5hbHlzaXMuZXZlbnRTdWdnZXN0aW9ucy5sZW5ndGggPiAwKSB7XG4gICAgICB0aGlzLnBlbmRpbmdTdWdnZXN0aW9uID0gYW5hbHlzaXMuZXZlbnRTdWdnZXN0aW9uc1swXVxuICAgICAgXG4gICAgICBpZiAoYW5hbHlzaXMucXVlc3Rpb25zLmxlbmd0aCA+IDApIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBuZWVkc0V2ZW50Q3JlYXRpb246IHRydWUsXG4gICAgICAgICAgcmVzcG9uc2U6IGdlbmVyYXRlRXZlbnRTdWdnZXN0aW9uUmVzcG9uc2UoYW5hbHlzaXMpLFxuICAgICAgICAgIHF1ZXN0aW9uczogYW5hbHlzaXMucXVlc3Rpb25zXG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIEluZm9ybWFjacOzbiBjb21wbGV0YSwgY3JlYXIgZXZlbnRvIGRpcmVjdGFtZW50ZVxuICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB0aGlzLmNyZWF0ZVBlbmRpbmdFdmVudCgpXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgbmVlZHNFdmVudENyZWF0aW9uOiB0cnVlLFxuICAgICAgICAgIHJlc3BvbnNlOiByZXN1bHQuc3VjY2VzcyBcbiAgICAgICAgICAgID8gdGhpcy5nZW5lcmF0ZVN1Y2Nlc3NNZXNzYWdlKHJlc3VsdC5ldmVudCEpXG4gICAgICAgICAgICA6IGDinYwgJHtyZXN1bHQubWVzc2FnZSB8fCAnSHVibyB1biBlcnJvciBhbCBjcmVhciBlbCBldmVudG8uIFBvciBmYXZvciBpbnRlbnRhIG51ZXZhbWVudGUuJ31gLFxuICAgICAgICAgIGV2ZW50OiByZXN1bHQuZXZlbnRcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiB7IG5lZWRzRXZlbnRDcmVhdGlvbjogZmFsc2UgfVxuICB9XG5cbiAgLyoqXG4gICAqIFJlY29waWxhIGluZm9ybWFjacOzbiBhZGljaW9uYWwgZGVsIHVzdWFyaW9cbiAgICovXG4gIGNvbGxlY3RBZGRpdGlvbmFsSW5mbyhpbmZvVHlwZTogc3RyaW5nLCB2YWx1ZTogc3RyaW5nKTogYm9vbGVhbiB7XG4gICAgaWYgKCF0aGlzLnBlbmRpbmdTdWdnZXN0aW9uKSByZXR1cm4gZmFsc2VcblxuICAgIHN3aXRjaCAoaW5mb1R5cGUudG9Mb3dlckNhc2UoKSkge1xuICAgICAgY2FzZSAnZmVjaGEnOlxuICAgICAgICB0aGlzLmNvbGxlY3RlZEluZm8uZGF0ZSA9IHZhbHVlXG4gICAgICAgIGJyZWFrXG4gICAgICBjYXNlICdob3JhJzpcbiAgICAgICAgdGhpcy5jb2xsZWN0ZWRJbmZvLnN0YXJ0VGltZSA9IHZhbHVlXG4gICAgICAgIGJyZWFrXG4gICAgICBjYXNlICdtYXRlcmlhJzpcbiAgICAgIGNhc2UgJ3RlbWEnOlxuICAgICAgICB0aGlzLmNvbGxlY3RlZEluZm8uc3ViamVjdCA9IHZhbHVlXG4gICAgICAgIGJyZWFrXG4gICAgICBjYXNlICd1YmljYWNpw7NuJzpcbiAgICAgIGNhc2UgJ3ViaWNhY2lvbic6XG4gICAgICAgIHRoaXMuY29sbGVjdGVkSW5mby5sb2NhdGlvbiA9IHZhbHVlXG4gICAgICAgIGJyZWFrXG4gICAgICBjYXNlICdkdXJhY2nDs24nOlxuICAgICAgY2FzZSAnZHVyYWNpb24nOlxuICAgICAgICB0aGlzLmNvbGxlY3RlZEluZm8uZHVyYXRpb24gPSBwYXJzZUludCh2YWx1ZSlcbiAgICAgICAgYnJlYWtcbiAgICB9XG5cbiAgICByZXR1cm4gdHJ1ZVxuICB9XG5cbiAgLyoqXG4gICAqIENyZWEgZWwgZXZlbnRvIHBlbmRpZW50ZSBjb24gbGEgaW5mb3JtYWNpw7NuIHJlY29waWxhZGFcbiAgICovXG4gIGFzeW5jIGNyZWF0ZVBlbmRpbmdFdmVudCgpOiBQcm9taXNlPHsgc3VjY2VzczogYm9vbGVhbjsgbWVzc2FnZT86IHN0cmluZzsgZXZlbnQ/OiBDYWxlbmRhckV2ZW50IH0+IHtcbiAgICBpZiAoIXRoaXMucGVuZGluZ1N1Z2dlc3Rpb24pIHtcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBtZXNzYWdlOiAnTm8gaGF5IGV2ZW50byBwZW5kaWVudGUnIH1cbiAgICB9XG5cbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjcmVhdGVFdmVudEZyb21BSSh0aGlzLnBlbmRpbmdTdWdnZXN0aW9uLCB0aGlzLnVzZXJJZCwgdGhpcy5jb2xsZWN0ZWRJbmZvKVxuICAgIFxuICAgIGlmIChyZXN1bHQuc3VjY2Vzcykge1xuICAgICAgdGhpcy5wZW5kaW5nU3VnZ2VzdGlvbiA9IG51bGxcbiAgICAgIHRoaXMuY29sbGVjdGVkSW5mbyA9IHt9XG4gICAgfVxuXG4gICAgcmV0dXJuIHJlc3VsdFxuICB9XG5cbiAgLyoqXG4gICAqIENhbmNlbGEgbGEgY3JlYWNpw7NuIGRlbCBldmVudG8gcGVuZGllbnRlXG4gICAqL1xuICBjYW5jZWxQZW5kaW5nRXZlbnQoKTogdm9pZCB7XG4gICAgdGhpcy5wZW5kaW5nU3VnZ2VzdGlvbiA9IG51bGxcbiAgICB0aGlzLmNvbGxlY3RlZEluZm8gPSB7fVxuICB9XG5cbiAgLyoqXG4gICAqIE9idGllbmUgbGEgc3VnZXJlbmNpYSBwZW5kaWVudGVcbiAgICovXG4gIGdldFBlbmRpbmdTdWdnZXN0aW9uKCk6IEV2ZW50U3VnZ2VzdGlvbiB8IG51bGwge1xuICAgIHJldHVybiB0aGlzLnBlbmRpbmdTdWdnZXN0aW9uXG4gIH1cbiAgXG4gIC8qKlxuICAgKiBHZW5lcmEgbWVuc2FqZSBkZSDDqXhpdG8gY29uIGRldGFsbGVzIGRlbCBldmVudG8gY3JlYWRvXG4gICAqL1xuICBwcml2YXRlIGdlbmVyYXRlU3VjY2Vzc01lc3NhZ2UoZXZlbnQ6IENhbGVuZGFyRXZlbnQpOiBzdHJpbmcge1xuICAgIGxldCBtZXNzYWdlID0gYOKchSDCoVBlcmZlY3RvISBIZSBjcmVhZG8gXCIke2V2ZW50LnRpdGxlfVwiIGVuIHR1IGNhbGVuZGFyaW8uYFxuICAgIFxuICAgIC8vIEFncmVnYXIgZGV0YWxsZXMgZXNwZWPDrWZpY29zXG4gICAgY29uc3QgZGV0YWlsczogc3RyaW5nW10gPSBbXVxuICAgIFxuICAgIGlmIChldmVudC5kYXRlKSB7XG4gICAgICBjb25zdCBkYXRlU3RyID0gZXZlbnQuZGF0ZS50b0xvY2FsZURhdGVTdHJpbmcoJ2VzLUVTJywge1xuICAgICAgICB3ZWVrZGF5OiAnbG9uZycsXG4gICAgICAgIGRheTogJ251bWVyaWMnLFxuICAgICAgICBtb250aDogJ2xvbmcnXG4gICAgICB9KVxuICAgICAgZGV0YWlscy5wdXNoKGDwn5OFICoqRmVjaGEqKjogJHtkYXRlU3RyfWApXG4gICAgfVxuICAgIFxuICAgIGlmIChldmVudC5zdGFydFRpbWUpIHtcbiAgICAgIGRldGFpbHMucHVzaChg8J+VkCAqKkhvcmEqKjogJHtldmVudC5zdGFydFRpbWV9YClcbiAgICB9XG4gICAgXG4gICAgaWYgKGV2ZW50LmxvY2F0aW9uKSB7XG4gICAgICBkZXRhaWxzLnB1c2goYPCfk40gKipVYmljYWNpw7NuKio6ICR7ZXZlbnQubG9jYXRpb259YClcbiAgICB9XG4gICAgXG4gICAgaWYgKGV2ZW50LnN1YmplY3QgJiYgZXZlbnQudHlwZSA9PT0gJ2V4YW0nKSB7XG4gICAgICBkZXRhaWxzLnB1c2goYPCfk5ogKipNYXRlcmlhKio6ICR7ZXZlbnQuc3ViamVjdH1gKVxuICAgIH1cbiAgICBcbiAgICBpZiAoZXZlbnQuZGVzY3JpcHRpb24gJiYgIWV2ZW50LmRlc2NyaXB0aW9uLmluY2x1ZGVzKCdDcmVhZG8gYXV0b23DoXRpY2FtZW50ZScpKSB7XG4gICAgICBkZXRhaWxzLnB1c2goYPCfk50gKipUZW1hKio6ICR7ZXZlbnQuZGVzY3JpcHRpb259YClcbiAgICB9XG4gICAgXG4gICAgaWYgKGRldGFpbHMubGVuZ3RoID4gMCkge1xuICAgICAgbWVzc2FnZSArPSBgXFxuXFxuKipEZXRhbGxlcyBkZWwgZXZlbnRvOioqXFxuJHtkZXRhaWxzLmpvaW4oJ1xcbicpfWBcbiAgICB9XG4gICAgXG4gICAgbWVzc2FnZSArPSBgXFxuXFxu8J+OryBQdWVkZXMgdmVyIHRvZG9zIHR1cyBldmVudG9zIGVuIGxhIHNlY2Npw7NuIFwiT3JnYW5pemFkb3IgSW50ZWxpZ2VudGVcIiBkZSB0dSBjYWxlbmRhcmlvLmBcbiAgICBcbiAgICByZXR1cm4gbWVzc2FnZVxuICB9XG59XG5cbi8qKlxuICogQnVzY2EgZXZlbnRvcyBkZWwgdXN1YXJpbyBwb3IgdGV4dG8gZGUgYsO6c3F1ZWRhXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBmaW5kVXNlckV2ZW50cyh1c2VySWQ6IHN0cmluZywgc2VhcmNoVGV4dDogc3RyaW5nKTogQ2FsZW5kYXJFdmVudFtdIHtcbiAgY29uc3QgdXNlckRhdGEgPSBnZXRVc2VyQ2FsZW5kYXJEYXRhKHVzZXJJZClcbiAgaWYgKCF1c2VyRGF0YSkgcmV0dXJuIFtdXG4gIFxuICBjb25zdCBzZWFyY2ggPSBzZWFyY2hUZXh0LnRvTG93ZXJDYXNlKClcbiAgcmV0dXJuIHVzZXJEYXRhLmV2ZW50cy5maWx0ZXIoZXZlbnQgPT4ge1xuICAgIHJldHVybiBldmVudC50aXRsZS50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKHNlYXJjaCkgfHxcbiAgICAgICAgICAgZXZlbnQuc3ViamVjdD8udG9Mb3dlckNhc2UoKS5pbmNsdWRlcyhzZWFyY2gpIHx8XG4gICAgICAgICAgIGV2ZW50LmRlc2NyaXB0aW9uPy50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKHNlYXJjaCkgfHxcbiAgICAgICAgICAgZXZlbnQubG9jYXRpb24/LnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMoc2VhcmNoKVxuICB9KVxufVxuXG4vKipcbiAqIEVkaXRhIHVuIGV2ZW50byB1c2FuZG8gZWwgQVBJIGVuZHBvaW50XG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBlZGl0RXZlbnRGcm9tQUkoXG4gIGV2ZW50SWQ6IHN0cmluZyxcbiAgdXBkYXRlczogUGFydGlhbDxDYWxlbmRhckV2ZW50PlxuKTogUHJvbWlzZTx7IHN1Y2Nlc3M6IGJvb2xlYW47IGV2ZW50PzogQ2FsZW5kYXJFdmVudDsgbWVzc2FnZT86IHN0cmluZyB9PiB7XG4gIHRyeSB7XG4gICAgLy8gRm9yIHNlcnZlci1zaWRlIGV4ZWN1dGlvbiwgY2FsbCB0aGUgZnVuY3Rpb24gZGlyZWN0bHlcbiAgICB0cnkge1xuICAgICAgY29uc3QgeyB1cGRhdGVDYWxlbmRhckV2ZW50IH0gPSByZXF1aXJlKCcuL2NhbGVuZGFyLWRhdGEnKVxuICAgICAgY29uc3Qgc3VjY2VzcyA9IHVwZGF0ZUNhbGVuZGFyRXZlbnQoZXZlbnRJZCwgdXBkYXRlcylcbiAgICAgIFxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3VjY2VzcyxcbiAgICAgICAgZXZlbnQ6IHN1Y2Nlc3MgPyB7IGlkOiBldmVudElkLCAuLi51cGRhdGVzIH0gOiB1bmRlZmluZWQsXG4gICAgICAgIG1lc3NhZ2U6IHN1Y2Nlc3MgPyAnRXZlbnRvIGFjdHVhbGl6YWRvIGV4aXRvc2FtZW50ZScgOiAnRXJyb3IgYWwgYWN0dWFsaXphciBldmVudG8nXG4gICAgICB9XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIHVwZGF0aW5nIGV2ZW50OicsIGVycm9yKVxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIG1lc3NhZ2U6ICdFcnJvciBhbCBhY3R1YWxpemFyIGV2ZW50bydcbiAgICAgIH1cbiAgICB9XG5cbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCByZXNwb25zZS5qc29uKClcbiAgICBcbiAgICBpZiAocmVzdWx0LnN1Y2Nlc3MpIHtcbiAgICAgIGNvbnNvbGUubG9nKGDwn6SWIElBIGVkaXTDsyBldmVudG86ICR7cmVzdWx0LmV2ZW50LnRpdGxlfWApXG4gICAgICBcbiAgICAgIC8vIERpc3BhcmFyIGV2ZW50byBkZWwgbGFkbyBkZWwgY2xpZW50ZVxuICAgICAgaWYgKHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgIHdpbmRvdy5kaXNwYXRjaEV2ZW50KG5ldyBDdXN0b21FdmVudCgnY2FsZW5kYXJFdmVudFVwZGF0ZWQnLCB7XG4gICAgICAgICAgICBkZXRhaWw6IHsgZXZlbnQ6IHJlc3VsdC5ldmVudCwgZXZlbnRJZCB9XG4gICAgICAgICAgfSkpXG4gICAgICAgIH0sIDIwMClcbiAgICAgIH1cbiAgICAgIFxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgZXZlbnQ6IHJlc3VsdC5ldmVudCxcbiAgICAgICAgbWVzc2FnZTogcmVzdWx0Lm1lc3NhZ2VcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIG1lc3NhZ2U6IHJlc3VsdC5lcnJvciB8fCAnRXJyb3IgZGVzY29ub2NpZG8gYWwgZWRpdGFyJ1xuICAgICAgfVxuICAgIH1cbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCfinYwgRXJyb3IgZWRpdGluZyBldmVudCBmcm9tIEFJOicsIGVycm9yKVxuICAgIHJldHVybiB7XG4gICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgIG1lc3NhZ2U6ICdFcnJvciBkZSBjb25leGnDs24gYWwgZWRpdGFyIGV2ZW50bydcbiAgICB9XG4gIH1cbn1cblxuLyoqXG4gKiBFbGltaW5hIHVuIGV2ZW50byB1c2FuZG8gZWwgQVBJIGVuZHBvaW50XG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBkZWxldGVFdmVudEZyb21BSShcbiAgZXZlbnRJZDogc3RyaW5nXG4pOiBQcm9taXNlPHsgc3VjY2VzczogYm9vbGVhbjsgbWVzc2FnZT86IHN0cmluZyB9PiB7XG4gIHRyeSB7XG4gICAgLy8gRm9yIHNlcnZlci1zaWRlIGV4ZWN1dGlvbiwgY2FsbCB0aGUgZnVuY3Rpb24gZGlyZWN0bHlcbiAgICB0cnkge1xuICAgICAgY29uc3QgeyBkZWxldGVDYWxlbmRhckV2ZW50IH0gPSByZXF1aXJlKCcuL2NhbGVuZGFyLWRhdGEnKVxuICAgICAgY29uc3QgZGVsZXRlZEV2ZW50ID0gZGVsZXRlQ2FsZW5kYXJFdmVudChldmVudElkKVxuICAgICAgXG4gICAgICByZXR1cm4ge1xuICAgICAgICBzdWNjZXNzOiAhIWRlbGV0ZWRFdmVudCxcbiAgICAgICAgbWVzc2FnZTogZGVsZXRlZEV2ZW50ID8gXG4gICAgICAgICAgYEV2ZW50byBcIiR7ZGVsZXRlZEV2ZW50LnRpdGxlfVwiIGVsaW1pbmFkbyBleGl0b3NhbWVudGVgIDogXG4gICAgICAgICAgJ0V2ZW50byBubyBlbmNvbnRyYWRvJ1xuICAgICAgfVxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBkZWxldGluZyBldmVudDonLCBlcnJvcilcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBtZXNzYWdlOiAnRXJyb3IgYWwgZWxpbWluYXIgZXZlbnRvJ1xuICAgICAgfVxuICAgIH1cblxuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKVxuICAgIFxuICAgIGlmIChyZXN1bHQuc3VjY2Vzcykge1xuICAgICAgY29uc29sZS5sb2coYPCfpJYgSUEgZWxpbWluw7MgZXZlbnRvOiAke3Jlc3VsdC5kZWxldGVkRXZlbnQudGl0bGV9YClcbiAgICAgIFxuICAgICAgLy8gRGlzcGFyYXIgZXZlbnRvIGRlbCBsYWRvIGRlbCBjbGllbnRlXG4gICAgICBpZiAodHlwZW9mIHdpbmRvdyAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgd2luZG93LmRpc3BhdGNoRXZlbnQobmV3IEN1c3RvbUV2ZW50KCdjYWxlbmRhckV2ZW50RGVsZXRlZCcsIHtcbiAgICAgICAgICAgIGRldGFpbDogeyBldmVudElkLCB0aXRsZTogcmVzdWx0LmRlbGV0ZWRFdmVudC50aXRsZSB9XG4gICAgICAgICAgfSkpXG4gICAgICAgIH0sIDIwMClcbiAgICAgIH1cbiAgICAgIFxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgbWVzc2FnZTogcmVzdWx0Lm1lc3NhZ2VcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIG1lc3NhZ2U6IHJlc3VsdC5lcnJvciB8fCAnRXJyb3IgZGVzY29ub2NpZG8gYWwgZWxpbWluYXInXG4gICAgICB9XG4gICAgfVxuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBFcnJvciBkZWxldGluZyBldmVudCBmcm9tIEFJOicsIGVycm9yKVxuICAgIHJldHVybiB7XG4gICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgIG1lc3NhZ2U6ICdFcnJvciBkZSBjb25leGnDs24gYWwgZWxpbWluYXIgZXZlbnRvJ1xuICAgIH1cbiAgfVxufVxuXG4vKipcbiAqIE5vcm1hbGl6YSBub21icmVzIGRlIG1hdGVyaWFzIGNvbiBhY2VudG9zIHkgbWF5w7pzY3VsYXMgY29ycmVjdGFzXG4gKi9cbmZ1bmN0aW9uIG5vcm1hbGl6ZVN1YmplY3ROYW1lKHN1YmplY3Q/OiBzdHJpbmcgfCBudWxsKTogc3RyaW5nIHwgbnVsbCB7XG4gIGlmICghc3ViamVjdCkgcmV0dXJuIG51bGxcbiAgXG4gIGNvbnN0IG5vcm1hbGl6ZWQgPSBzdWJqZWN0LnRvTG93ZXJDYXNlKCkudHJpbSgpXG4gIFxuICBjb25zdCBzdWJqZWN0TWFwOiBSZWNvcmQ8c3RyaW5nLCBzdHJpbmc+ID0ge1xuICAgICdxdWltaWNhJzogJ1F1w61taWNhJyxcbiAgICAncXXDrW1pY2EnOiAnUXXDrW1pY2EnLFxuICAgICdmaXNpY2EnOiAnRsOtc2ljYScsXG4gICAgJ2bDrXNpY2EnOiAnRsOtc2ljYScsXG4gICAgJ21hdGVtYXRpY2EnOiAnTWF0ZW3DoXRpY2EnLFxuICAgICdtYXRlbcOhdGljYXMnOiAnTWF0ZW3DoXRpY2FzJyxcbiAgICAnbWF0ZW1hdGljYXMnOiAnTWF0ZW3DoXRpY2FzJyxcbiAgICAnYmlvbG9naWEnOiAnQmlvbG9nw61hJyxcbiAgICAnYmlvbG9nw61hJzogJ0Jpb2xvZ8OtYScsXG4gICAgJ2hpc3RvcmlhJzogJ0hpc3RvcmlhJyxcbiAgICAnZ2VvZ3JhZmlhJzogJ0dlb2dyYWbDrWEnLFxuICAgICdnZW9ncmFmw61hJzogJ0dlb2dyYWbDrWEnLFxuICAgICdpbmdsZXMnOiAnSW5nbMOpcycsXG4gICAgJ2luZ2zDqXMnOiAnSW5nbMOpcycsXG4gICAgJ2xlbmd1YSc6ICdMZW5ndWEgeSBMaXRlcmF0dXJhJyxcbiAgICAnbGl0ZXJhdHVyYSc6ICdMZW5ndWEgeSBMaXRlcmF0dXJhJyxcbiAgICAnZmlsb3NvZmlhJzogJ0ZpbG9zb2bDrWEnLFxuICAgICdmaWxvc29mw61hJzogJ0ZpbG9zb2bDrWEnLFxuICAgICdlY29ub21pYSc6ICdFY29ub23DrWEnLFxuICAgICdlY29ub23DrWEnOiAnRWNvbm9tw61hJyxcbiAgICAnZWR1Y2FjaW9uIGZpc2ljYSc6ICdFZHVjYWNpw7NuIEbDrXNpY2EnLFxuICAgICdlZHVjYWNpw7NuIGbDrXNpY2EnOiAnRWR1Y2FjacOzbiBGw61zaWNhJyxcbiAgICAnZWQgZmlzaWNhJzogJ0VkdWNhY2nDs24gRsOtc2ljYScsXG4gICAgJ2FydGUnOiAnQXJ0ZScsXG4gICAgJ211c2ljYSc6ICdNw7pzaWNhJyxcbiAgICAnbcO6c2ljYSc6ICdNw7pzaWNhJ1xuICB9XG4gIFxuICAvLyBCdXNjYXIgY29pbmNpZGVuY2lhIGV4YWN0YSBwcmltZXJvXG4gIGlmIChzdWJqZWN0TWFwW25vcm1hbGl6ZWRdKSB7XG4gICAgcmV0dXJuIHN1YmplY3RNYXBbbm9ybWFsaXplZF1cbiAgfVxuICBcbiAgLy8gQnVzY2FyIGNvaW5jaWRlbmNpYSBwYXJjaWFsXG4gIGZvciAoY29uc3QgW2tleSwgdmFsdWVdIG9mIE9iamVjdC5lbnRyaWVzKHN1YmplY3RNYXApKSB7XG4gICAgaWYgKGtleS5pbmNsdWRlcyhub3JtYWxpemVkKSB8fCBub3JtYWxpemVkLmluY2x1ZGVzKGtleSkpIHtcbiAgICAgIHJldHVybiB2YWx1ZVxuICAgIH1cbiAgfVxuICBcbiAgLy8gU2kgbm8gc2UgZW5jdWVudHJhLCBjYXBpdGFsaXphciBwcmltZXJhIGxldHJhXG4gIHJldHVybiBzdWJqZWN0LmNoYXJBdCgwKS50b1VwcGVyQ2FzZSgpICsgc3ViamVjdC5zbGljZSgxKS50b0xvd2VyQ2FzZSgpXG59Il0sIm5hbWVzIjpbImdldEV2ZW50VHlwZUNvbG9yIiwiZ2V0VXNlckNhbGVuZGFyRGF0YSIsImFuYWx5emVDb252ZXJzYXRpb25Gb3JFdmVudHMiLCJjb252ZXJzYXRpb25IaXN0b3J5IiwidXNlck1lc3NhZ2VzIiwiZmlsdGVyIiwibXNnIiwicm9sZSIsIm1hcCIsImNvbnRlbnQiLCJqb2luIiwiYW5hbHlzaXMiLCJoYXNFdmVudE1lbnRpb24iLCJldmVudFN1Z2dlc3Rpb25zIiwicXVlc3Rpb25zIiwibWlzc2luZ0luZm8iLCJsYXN0VXNlck1lc3NhZ2UiLCJsZW5ndGgiLCJtc2dMb3dlciIsInRvTG93ZXJDYXNlIiwiYWdlbmRhclBhdHRlcm5zIiwiaXNSZXF1ZXN0aW5nVG9TY2hlZHVsZSIsInRlc3QiLCJlZGl0YXJQYXR0ZXJucyIsImlzUmVxdWVzdGluZ1RvRWRpdCIsImVsaW1pbmFyUGF0dGVybnMiLCJpc1JlcXVlc3RpbmdUb0RlbGV0ZSIsImV2ZW50RGF0YSIsImV4dHJhY3RFdmVudERhdGFGcm9tTWVzc2FnZSIsImhhc0V2ZW50Iiwibm9ybWFsaXplZFN1YmplY3QiLCJub3JtYWxpemVTdWJqZWN0TmFtZSIsInN1YmplY3QiLCJwdXNoIiwidHlwZSIsInRpdGxlIiwiZGF0ZSIsInN0YXJ0VGltZSIsImR1cmF0aW9uIiwibG9jYXRpb24iLCJkZXNjcmlwdGlvbiIsInByaW9yaXR5IiwiY29uZmlkZW5jZSIsInN1Z2dlc3Rpb24iLCJtZXNzYWdlIiwiZXZlbnRUeXBlIiwic3ViamVjdFBhdHRlcm5zIiwicGF0dGVybiIsIm1hdGNoIiwiY2hhckF0IiwidG9VcHBlckNhc2UiLCJzbGljZSIsInNwZWNpZmljRGF0ZVBhdHRlcm5zIiwic291cmNlIiwiaW5jbHVkZXMiLCJkYXkiLCJwYXJzZUludCIsIm1vbnRoTmFtZSIsIm1vbnRoTWFwIiwidW5kZWZpbmVkIiwibm93IiwiRGF0ZSIsImV2ZW50RGF0ZSIsImdldEZ1bGxZZWFyIiwidG9JU09TdHJpbmciLCJzcGxpdCIsImlzTmFOIiwibW9udGgiLCJnZXRNb250aCIsInllYXIiLCJyZWxhdGl2ZURhdGVQYXR0ZXJucyIsImRheXMiLCJ0YXJnZXREYXkiLCJnZXRUaW1lIiwiY3VycmVudERheSIsImdldERheSIsImRheXNUb0FkZCIsInRpbWVQYXR0ZXJucyIsImhvdXIiLCJtaW51dGUiLCJwZXJpb2QiLCJ0b1N0cmluZyIsInBhZFN0YXJ0IiwibG9jYXRpb25QYXR0ZXJucyIsInJlcGxhY2UiLCJ0cmltIiwiZHVyYXRpb25NYXRjaCIsInZhbHVlIiwidW5pdCIsInRvcGljUGF0dGVybnMiLCJnZW5lcmF0ZUV2ZW50UXVlc3Rpb25zIiwiY29udmVydFN1Z2dlc3Rpb25Ub0NhbGVuZGFyRXZlbnQiLCJ1c2VySWQiLCJhZGRpdGlvbmFsSW5mbyIsIm1lcmdlZCIsInBhcnNlRGF0ZUZyb21UZXh0IiwiZW5kVGltZSIsInN0YXJ0IiwiZW5kIiwidG9UaW1lU3RyaW5nIiwic3Vic3RyaW5nIiwiZXZlbnQiLCJpZCIsImNvbG9yIiwiY3JlYXRlRXZlbnRGcm9tQUkiLCJjcmVhdGVDYWxlbmRhckV2ZW50IiwicmVxdWlyZSIsIm1vY2tSZXF1ZXN0IiwianNvbiIsInJlc3BvbnNlIiwicmVzdWx0Iiwic3VjY2VzcyIsImRpcmVjdENhbGxFcnJvciIsImNvbnNvbGUiLCJsb2ciLCJhZGRDYWxlbmRhckV2ZW50IiwiY3JlYXRlVXNlckNhbGVuZGFyRGF0YSIsInVzZXJEYXRhIiwiY2FsZW5kYXJFdmVudCIsInNldFRpbWVvdXQiLCJ3aW5kb3ciLCJkaXNwYXRjaEV2ZW50IiwiQ3VzdG9tRXZlbnQiLCJkZXRhaWwiLCJlcnJvciIsImRhdGVUZXh0IiwidGV4dCIsInRvZGF5IiwidG9tb3Jyb3ciLCJzZXREYXRlIiwiZ2V0RGF0ZSIsImRheUFmdGVyVG9tb3Jyb3ciLCJkYXlNYXAiLCJkYXlOYW1lIiwiZGF5TnVtYmVyIiwiT2JqZWN0IiwiZW50cmllcyIsInRhcmdldERhdGUiLCJkYXlzTWF0Y2giLCJmdXR1cmVEYXRlIiwiZGVmYXVsdERhdGUiLCJnZW5lcmF0ZUV2ZW50U3VnZ2VzdGlvblJlc3BvbnNlIiwiZGV0ZWN0ZWRJbmZvIiwiZGF0ZU9iaiIsImZvcm1hdHRlZERhdGUiLCJ0b0xvY2FsZURhdGVTdHJpbmciLCJ3ZWVrZGF5IiwiZm9yRWFjaCIsInF1ZXN0aW9uIiwiaW5kZXgiLCJBSUNhbGVuZGFySW50ZWdyYXRpb24iLCJjb25zdHJ1Y3RvciIsInBlbmRpbmdTdWdnZXN0aW9uIiwiY29sbGVjdGVkSW5mbyIsInByb2Nlc3NNZXNzYWdlIiwibmVlZHNFdmVudENyZWF0aW9uIiwiY3JlYXRlUGVuZGluZ0V2ZW50IiwiZ2VuZXJhdGVTdWNjZXNzTWVzc2FnZSIsImNvbGxlY3RBZGRpdGlvbmFsSW5mbyIsImluZm9UeXBlIiwiY2FuY2VsUGVuZGluZ0V2ZW50IiwiZ2V0UGVuZGluZ1N1Z2dlc3Rpb24iLCJkZXRhaWxzIiwiZGF0ZVN0ciIsImZpbmRVc2VyRXZlbnRzIiwic2VhcmNoVGV4dCIsInNlYXJjaCIsImV2ZW50cyIsImVkaXRFdmVudEZyb21BSSIsImV2ZW50SWQiLCJ1cGRhdGVzIiwidXBkYXRlQ2FsZW5kYXJFdmVudCIsImRlbGV0ZUV2ZW50RnJvbUFJIiwiZGVsZXRlQ2FsZW5kYXJFdmVudCIsImRlbGV0ZWRFdmVudCIsIm5vcm1hbGl6ZWQiLCJzdWJqZWN0TWFwIiwia2V5Il0sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/calendar-ai-integration.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/calendar-data.ts":
/*!**********************************!*\
  !*** ./src/lib/calendar-data.ts ***!
  \**********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   addCalendarEvent: () => (/* binding */ addCalendarEvent),\n/* harmony export */   createUserCalendarData: () => (/* binding */ createUserCalendarData),\n/* harmony export */   deleteCalendarEvent: () => (/* binding */ deleteCalendarEvent),\n/* harmony export */   findAvailableTimeSlots: () => (/* binding */ findAvailableTimeSlots),\n/* harmony export */   getEventTypeColor: () => (/* binding */ getEventTypeColor),\n/* harmony export */   getEventTypeIcon: () => (/* binding */ getEventTypeIcon),\n/* harmony export */   getEventsForDate: () => (/* binding */ getEventsForDate),\n/* harmony export */   getEventsForDateRange: () => (/* binding */ getEventsForDateRange),\n/* harmony export */   getUserCalendarData: () => (/* binding */ getUserCalendarData),\n/* harmony export */   isTimeSlotAvailable: () => (/* binding */ isTimeSlotAvailable),\n/* harmony export */   tempCalendarData: () => (/* binding */ tempCalendarData),\n/* harmony export */   updateCalendarEvent: () => (/* binding */ updateCalendarEvent),\n/* harmony export */   updateUserCalendarData: () => (/* binding */ updateUserCalendarData)\n/* harmony export */ });\n// Calendar Data Models for Smart Calendar\n// Temporary storage for calendar data\nconst globalForCalendarData = globalThis;\nconst tempCalendarData = globalForCalendarData.tempCalendarData ?? [];\nglobalForCalendarData.tempCalendarData = tempCalendarData;\n// Calendar Data Management Functions\nfunction getUserCalendarData(userId) {\n    return tempCalendarData.find((data)=>data.userId === userId);\n}\nfunction createUserCalendarData(userId) {\n    const newData = {\n        userId,\n        schoolSchedule: {\n            monday: [],\n            tuesday: [],\n            wednesday: [],\n            thursday: [],\n            friday: []\n        },\n        studyPreferences: {\n            preferredStudyTime: 'afternoon',\n            dailyStudyHours: 3,\n            maxSessionDuration: 90,\n            breakBetweenSessions: 15,\n            weekendStudyHours: 4,\n            noStudyDays: [\n                0\n            ] // Sunday\n        },\n        events: [],\n        isSetupComplete: false,\n        lastUpdated: new Date()\n    };\n    tempCalendarData.push(newData);\n    return newData;\n}\nfunction updateUserCalendarData(userId, updates) {\n    const index = tempCalendarData.findIndex((data)=>data.userId === userId);\n    if (index !== -1) {\n        tempCalendarData[index] = {\n            ...tempCalendarData[index],\n            ...updates,\n            lastUpdated: new Date()\n        };\n        return true;\n    }\n    return false;\n}\nfunction addCalendarEvent(userId, event) {\n    const userData = getUserCalendarData(userId);\n    if (userData) {\n        userData.events.push(event);\n        userData.lastUpdated = new Date();\n        // Force update in global storage\n        const index = tempCalendarData.findIndex((data)=>data.userId === userId);\n        if (index !== -1) {\n            tempCalendarData[index] = userData;\n        }\n        console.log(`📅 Evento agregado: ${event.title} - Total eventos: ${userData.events.length}`);\n        return true;\n    }\n    return false;\n}\nfunction updateCalendarEvent(userId, eventId, updates) {\n    const userData = getUserCalendarData(userId);\n    if (userData) {\n        const eventIndex = userData.events.findIndex((e)=>e.id === eventId);\n        if (eventIndex !== -1) {\n            userData.events[eventIndex] = {\n                ...userData.events[eventIndex],\n                ...updates\n            };\n            userData.lastUpdated = new Date();\n            // Force update in global storage\n            const index = tempCalendarData.findIndex((data)=>data.userId === userId);\n            if (index !== -1) {\n                tempCalendarData[index] = userData;\n            }\n            console.log(`📅 Evento actualizado: ${userData.events[eventIndex].title}`);\n            return true;\n        }\n    }\n    return false;\n}\nfunction deleteCalendarEvent(userId, eventId) {\n    const userData = getUserCalendarData(userId);\n    if (userData) {\n        const eventIndex = userData.events.findIndex((e)=>e.id === eventId);\n        if (eventIndex !== -1) {\n            const deletedEvent = userData.events[eventIndex];\n            userData.events.splice(eventIndex, 1);\n            userData.lastUpdated = new Date();\n            // Force update in global storage\n            const index = tempCalendarData.findIndex((data)=>data.userId === userId);\n            if (index !== -1) {\n                tempCalendarData[index] = userData;\n            }\n            console.log(`📅 Evento eliminado: ${deletedEvent.title} - Total eventos: ${userData.events.length}`);\n            return true;\n        }\n    }\n    return false;\n}\nfunction getEventsForDate(userId, date) {\n    const userData = getUserCalendarData(userId);\n    if (!userData) return [];\n    const targetDate = new Date(date);\n    targetDate.setHours(0, 0, 0, 0);\n    return userData.events.filter((event)=>{\n        const eventDate = new Date(event.date);\n        eventDate.setHours(0, 0, 0, 0);\n        return eventDate.getTime() === targetDate.getTime();\n    });\n}\nfunction getEventsForDateRange(userId, startDate, endDate) {\n    const userData = getUserCalendarData(userId);\n    if (!userData) return [];\n    return userData.events.filter((event)=>{\n        const eventDate = new Date(event.date);\n        return eventDate >= startDate && eventDate <= endDate;\n    });\n}\n// Utility functions for calendar operations\nfunction isTimeSlotAvailable(userId, date, startTime, endTime) {\n    const userData = getUserCalendarData(userId);\n    if (!userData) return true;\n    const dayName = getDayName(date.getDay());\n    const schoolSlots = userData.schoolSchedule[dayName] || [];\n    // Check school schedule conflicts\n    for (const slot of schoolSlots){\n        if (timeOverlaps(startTime, endTime, slot.start, slot.end)) {\n            return false;\n        }\n    }\n    // Check existing events\n    const dayEvents = getEventsForDate(userId, date);\n    for (const event of dayEvents){\n        if (event.startTime && event.endTime) {\n            if (timeOverlaps(startTime, endTime, event.startTime, event.endTime)) {\n                return false;\n            }\n        }\n    }\n    return true;\n}\nfunction findAvailableTimeSlots(userId, date, duration, preferredTime) {\n    const userData = getUserCalendarData(userId);\n    if (!userData) return [];\n    const slots = [];\n    // Define time ranges based on preference\n    const timeRanges = {\n        morning: [\n            '08:00',\n            '12:00'\n        ],\n        afternoon: [\n            '14:00',\n            '18:00'\n        ],\n        evening: [\n            '19:00',\n            '22:00'\n        ]\n    };\n    const searchRange = preferredTime ? timeRanges[preferredTime] : [\n        '08:00',\n        '22:00'\n    ];\n    const [searchStart, searchEnd] = searchRange;\n    // Generate potential slots every 30 minutes\n    const startMinutes = timeToMinutes(searchStart);\n    const endMinutes = timeToMinutes(searchEnd);\n    for(let minutes = startMinutes; minutes <= endMinutes - duration; minutes += 30){\n        const slotStart = minutesToTime(minutes);\n        const slotEnd = minutesToTime(minutes + duration);\n        if (isTimeSlotAvailable(userId, date, slotStart, slotEnd)) {\n            slots.push({\n                start: slotStart,\n                end: slotEnd\n            });\n        }\n    }\n    return slots;\n}\nfunction getEventTypeColor(type) {\n    const colors = {\n        exam: '#EF4444',\n        study_session: '#3B82F6',\n        class: '#10B981',\n        personal: '#8B5CF6',\n        extracurricular: '#F59E0B' // Orange\n    };\n    return colors[type] || '#64748B';\n}\nfunction getEventTypeIcon(type) {\n    const icons = {\n        exam: '📝',\n        study_session: '📚',\n        class: '🎓',\n        personal: '👤',\n        extracurricular: '🏃‍♀️'\n    };\n    return icons[type] || '📅';\n}\n// Helper functions\nfunction getDayName(dayIndex) {\n    const days = [\n        'sunday',\n        'monday',\n        'tuesday',\n        'wednesday',\n        'thursday',\n        'friday',\n        'saturday'\n    ];\n    return days[dayIndex];\n}\nfunction timeToMinutes(time) {\n    const [hours, minutes] = time.split(':').map(Number);\n    return hours * 60 + minutes;\n}\nfunction minutesToTime(minutes) {\n    const hours = Math.floor(minutes / 60);\n    const mins = minutes % 60;\n    return `${hours.toString().padStart(2, '0')}:${mins.toString().padStart(2, '0')}`;\n}\nfunction timeOverlaps(start1, end1, start2, end2) {\n    const start1Minutes = timeToMinutes(start1);\n    const end1Minutes = timeToMinutes(end1);\n    const start2Minutes = timeToMinutes(start2);\n    const end2Minutes = timeToMinutes(end2);\n    return start1Minutes < end2Minutes && end1Minutes > start2Minutes;\n}\n// Initialize demo data\nfunction initDemoCalendarData() {\n    const demoUserId = \"demo-student-fixed\";\n    if (!getUserCalendarData(demoUserId)) {\n        console.log(\"📅 Inicializando datos de calendario demo...\");\n        const demoData = createUserCalendarData(demoUserId);\n        // Demo school schedule\n        demoData.schoolSchedule = {\n            monday: [\n                {\n                    start: '08:00',\n                    end: '09:30',\n                    subject: 'Matemáticas',\n                    location: 'Aula 201',\n                    color: '#3B82F6'\n                },\n                {\n                    start: '09:45',\n                    end: '11:15',\n                    subject: 'Química',\n                    location: 'Laboratorio A',\n                    color: '#EF4444'\n                },\n                {\n                    start: '11:30',\n                    end: '13:00',\n                    subject: 'Historia',\n                    location: 'Aula 105',\n                    color: '#8B5CF6'\n                }\n            ],\n            tuesday: [\n                {\n                    start: '08:00',\n                    end: '09:30',\n                    subject: 'Física',\n                    location: 'Laboratorio B',\n                    color: '#10B981'\n                },\n                {\n                    start: '09:45',\n                    end: '11:15',\n                    subject: 'Literatura',\n                    location: 'Aula 203',\n                    color: '#F59E0B'\n                },\n                {\n                    start: '11:30',\n                    end: '13:00',\n                    subject: 'Biología',\n                    location: 'Laboratorio C',\n                    color: '#EC4899'\n                }\n            ],\n            wednesday: [\n                {\n                    start: '08:00',\n                    end: '09:30',\n                    subject: 'Matemáticas',\n                    location: 'Aula 201',\n                    color: '#3B82F6'\n                },\n                {\n                    start: '09:45',\n                    end: '11:15',\n                    subject: 'Educación Física',\n                    location: 'Gimnasio',\n                    color: '#06B6D4'\n                },\n                {\n                    start: '11:30',\n                    end: '13:00',\n                    subject: 'Arte',\n                    location: 'Taller',\n                    color: '#F97316'\n                }\n            ],\n            thursday: [\n                {\n                    start: '08:00',\n                    end: '09:30',\n                    subject: 'Química',\n                    location: 'Laboratorio A',\n                    color: '#EF4444'\n                },\n                {\n                    start: '09:45',\n                    end: '11:15',\n                    subject: 'Física',\n                    location: 'Laboratorio B',\n                    color: '#10B981'\n                },\n                {\n                    start: '11:30',\n                    end: '13:00',\n                    subject: 'Historia',\n                    location: 'Aula 105',\n                    color: '#8B5CF6'\n                }\n            ],\n            friday: [\n                {\n                    start: '08:00',\n                    end: '09:30',\n                    subject: 'Biología',\n                    location: 'Laboratorio C',\n                    color: '#EC4899'\n                },\n                {\n                    start: '09:45',\n                    end: '11:15',\n                    subject: 'Literatura',\n                    location: 'Aula 203',\n                    color: '#F59E0B'\n                },\n                {\n                    start: '11:30',\n                    end: '13:00',\n                    subject: 'Matemáticas',\n                    location: 'Aula 201',\n                    color: '#3B82F6'\n                }\n            ]\n        };\n        // Demo events\n        const now = new Date();\n        const demoEvents = [\n            {\n                id: 'exam-1',\n                title: 'Examen Química Orgánica',\n                date: new Date(now.getTime() + 7 * 24 * 60 * 60 * 1000),\n                startTime: '10:00',\n                endTime: '12:00',\n                type: 'exam',\n                color: getEventTypeColor('exam'),\n                description: 'Examen parcial de química orgánica',\n                subject: 'Química',\n                location: 'Laboratorio A'\n            },\n            {\n                id: 'study-1',\n                title: 'Sesión de Estudio - Matemáticas',\n                date: new Date(now.getTime() + 1 * 24 * 60 * 60 * 1000),\n                startTime: '15:00',\n                endTime: '16:30',\n                type: 'study_session',\n                color: getEventTypeColor('study_session'),\n                description: 'Repaso de cálculo integral',\n                subject: 'Matemáticas'\n            },\n            {\n                id: 'personal-1',\n                title: 'Entrenamiento Fútbol',\n                date: new Date(now.getTime() + 2 * 24 * 60 * 60 * 1000),\n                startTime: '17:00',\n                endTime: '18:30',\n                type: 'extracurricular',\n                color: getEventTypeColor('extracurricular'),\n                description: 'Entrenamiento de fútbol',\n                location: 'Campo deportivo'\n            }\n        ];\n        demoEvents.forEach((event)=>{\n            demoData.events.push(event);\n        });\n        demoData.isSetupComplete = true;\n        demoData.lastUpdated = new Date();\n        console.log(\"✅ Datos de calendario demo inicializados\");\n    } else {\n        console.log(\"✅ Datos de calendario demo ya existen\");\n    }\n}\n// Initialize demo data on module load\ninitDemoCalendarData();\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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LEtBQUs7Z0JBQ2xESyxXQUFXO2dCQUNYQyxTQUFTO2dCQUNUNkIsTUFBTTtnQkFDTmtDLE9BQU9uQyxrQkFBa0I7Z0JBQ3pCc0MsYUFBYTtnQkFDYkosVUFBVTtZQUNaO1NBQ0Q7UUFFREcsV0FBV0UsT0FBTyxDQUFDN0YsQ0FBQUE7WUFDakJzRixTQUFTaEcsTUFBTSxDQUFDSSxJQUFJLENBQUNNO1FBQ3ZCO1FBRUFzRixTQUFTL0YsZUFBZSxHQUFHO1FBQzNCK0YsU0FBUzlGLFdBQVcsR0FBRyxJQUFJQztRQUUzQlMsUUFBUUMsR0FBRyxDQUFDO0lBQ2QsT0FBTztRQUNMRCxRQUFRQyxHQUFHLENBQUM7SUFDZDtBQUNGO0FBRUEsc0NBQXNDO0FBQ3RDaUYiLCJzb3VyY2VzIjpbIi9Vc2Vycy9yb2RyaWdvZGliZXJuYXJkbzMzZ21haWwuY29tL0RvY3VtZW50cy9BcHAgRGV2ZWxvcG1lbnQgUHJveWVjdHMvSW50ZWxsZWdvIFBsYXRmb3JtL3NyYy9saWIvY2FsZW5kYXItZGF0YS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDYWxlbmRhciBEYXRhIE1vZGVscyBmb3IgU21hcnQgQ2FsZW5kYXJcblxuZXhwb3J0IGludGVyZmFjZSBUaW1lU2xvdCB7XG4gIHN0YXJ0OiBzdHJpbmcgLy8gXCIwODowMFwiXG4gIGVuZDogc3RyaW5nICAgLy8gXCIwOTozMFwiXG4gIHN1YmplY3Q6IHN0cmluZ1xuICBsb2NhdGlvbj86IHN0cmluZ1xuICBjb2xvcj86IHN0cmluZ1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIFNjaG9vbFNjaGVkdWxlIHtcbiAgbW9uZGF5OiBUaW1lU2xvdFtdXG4gIHR1ZXNkYXk6IFRpbWVTbG90W11cbiAgd2VkbmVzZGF5OiBUaW1lU2xvdFtdXG4gIHRodXJzZGF5OiBUaW1lU2xvdFtdXG4gIGZyaWRheTogVGltZVNsb3RbXVxuICBzYXR1cmRheT86IFRpbWVTbG90W11cbn1cblxuZXhwb3J0IGludGVyZmFjZSBDYWxlbmRhckV2ZW50IHtcbiAgaWQ6IHN0cmluZ1xuICB0aXRsZTogc3RyaW5nXG4gIGRhdGU6IERhdGVcbiAgc3RhcnRUaW1lPzogc3RyaW5nXG4gIGVuZFRpbWU/OiBzdHJpbmdcbiAgdHlwZTogJ2V4YW0nIHwgJ3N0dWR5X3Nlc3Npb24nIHwgJ2NsYXNzJyB8ICdwZXJzb25hbCcgfCAnZXh0cmFjdXJyaWN1bGFyJ1xuICBjb2xvcjogc3RyaW5nXG4gIGRlc2NyaXB0aW9uPzogc3RyaW5nXG4gIHN1YmplY3Q/OiBzdHJpbmdcbiAgbG9jYXRpb24/OiBzdHJpbmdcbiAgcHJpb3JpdHk/OiAnaGlnaCcgfCAnbWVkaXVtJyB8ICdsb3cnXG4gIGR1cmF0aW9uPzogbnVtYmVyIC8vIGluIG1pbnV0ZXNcbiAgaXNSZWN1cnJpbmc/OiBib29sZWFuXG4gIHJlY3VycmluZ1BhdHRlcm4/OiB7XG4gICAgZnJlcXVlbmN5OiAnZGFpbHknIHwgJ3dlZWtseScgfCAnbW9udGhseSdcbiAgICBkYXlzPzogbnVtYmVyW10gLy8gMD1TdW5kYXksIDE9TW9uZGF5LCBldGMuXG4gICAgZW5kRGF0ZT86IERhdGVcbiAgfVxufVxuXG5leHBvcnQgaW50ZXJmYWNlIFN0dWR5UHJlZmVyZW5jZXMge1xuICBwcmVmZXJyZWRTdHVkeVRpbWU6ICdtb3JuaW5nJyB8ICdhZnRlcm5vb24nIHwgJ2V2ZW5pbmcnIHwgJ2ZsZXhpYmxlJ1xuICBkYWlseVN0dWR5SG91cnM6IG51bWJlclxuICBtYXhTZXNzaW9uRHVyYXRpb246IG51bWJlclxuICBicmVha0JldHdlZW5TZXNzaW9uczogbnVtYmVyXG4gIHdlZWtlbmRTdHVkeUhvdXJzOiBudW1iZXJcbiAgbm9TdHVkeURheXM6IG51bWJlcltdIC8vIERheXMgb2Ygd2VlayB0byBhdm9pZCBzdHVkeWluZ1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIFVzZXJDYWxlbmRhckRhdGEge1xuICB1c2VySWQ6IHN0cmluZ1xuICBzY2hvb2xTY2hlZHVsZTogU2Nob29sU2NoZWR1bGVcbiAgc3R1ZHlQcmVmZXJlbmNlczogU3R1ZHlQcmVmZXJlbmNlc1xuICBldmVudHM6IENhbGVuZGFyRXZlbnRbXVxuICBpc1NldHVwQ29tcGxldGU6IGJvb2xlYW5cbiAgbGFzdFVwZGF0ZWQ6IERhdGVcbn1cblxuLy8gVGVtcG9yYXJ5IHN0b3JhZ2UgZm9yIGNhbGVuZGFyIGRhdGFcbmNvbnN0IGdsb2JhbEZvckNhbGVuZGFyRGF0YSA9IGdsb2JhbFRoaXMgYXMgdW5rbm93biBhcyB7XG4gIHRlbXBDYWxlbmRhckRhdGE6IFVzZXJDYWxlbmRhckRhdGFbXSB8IHVuZGVmaW5lZFxufVxuXG5leHBvcnQgY29uc3QgdGVtcENhbGVuZGFyRGF0YTogVXNlckNhbGVuZGFyRGF0YVtdID0gZ2xvYmFsRm9yQ2FsZW5kYXJEYXRhLnRlbXBDYWxlbmRhckRhdGEgPz8gW11cbmdsb2JhbEZvckNhbGVuZGFyRGF0YS50ZW1wQ2FsZW5kYXJEYXRhID0gdGVtcENhbGVuZGFyRGF0YVxuXG4vLyBDYWxlbmRhciBEYXRhIE1hbmFnZW1lbnQgRnVuY3Rpb25zXG5leHBvcnQgZnVuY3Rpb24gZ2V0VXNlckNhbGVuZGFyRGF0YSh1c2VySWQ6IHN0cmluZyk6IFVzZXJDYWxlbmRhckRhdGEgfCB1bmRlZmluZWQge1xuICByZXR1cm4gdGVtcENhbGVuZGFyRGF0YS5maW5kKGRhdGEgPT4gZGF0YS51c2VySWQgPT09IHVzZXJJZClcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZVVzZXJDYWxlbmRhckRhdGEodXNlcklkOiBzdHJpbmcpOiBVc2VyQ2FsZW5kYXJEYXRhIHtcbiAgY29uc3QgbmV3RGF0YTogVXNlckNhbGVuZGFyRGF0YSA9IHtcbiAgICB1c2VySWQsXG4gICAgc2Nob29sU2NoZWR1bGU6IHtcbiAgICAgIG1vbmRheTogW10sXG4gICAgICB0dWVzZGF5OiBbXSxcbiAgICAgIHdlZG5lc2RheTogW10sXG4gICAgICB0aHVyc2RheTogW10sXG4gICAgICBmcmlkYXk6IFtdXG4gICAgfSxcbiAgICBzdHVkeVByZWZlcmVuY2VzOiB7XG4gICAgICBwcmVmZXJyZWRTdHVkeVRpbWU6ICdhZnRlcm5vb24nLFxuICAgICAgZGFpbHlTdHVkeUhvdXJzOiAzLFxuICAgICAgbWF4U2Vzc2lvbkR1cmF0aW9uOiA5MCxcbiAgICAgIGJyZWFrQmV0d2VlblNlc3Npb25zOiAxNSxcbiAgICAgIHdlZWtlbmRTdHVkeUhvdXJzOiA0LFxuICAgICAgbm9TdHVkeURheXM6IFswXSAvLyBTdW5kYXlcbiAgICB9LFxuICAgIGV2ZW50czogW10sXG4gICAgaXNTZXR1cENvbXBsZXRlOiBmYWxzZSxcbiAgICBsYXN0VXBkYXRlZDogbmV3IERhdGUoKVxuICB9XG4gIFxuICB0ZW1wQ2FsZW5kYXJEYXRhLnB1c2gobmV3RGF0YSlcbiAgcmV0dXJuIG5ld0RhdGFcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHVwZGF0ZVVzZXJDYWxlbmRhckRhdGEodXNlcklkOiBzdHJpbmcsIHVwZGF0ZXM6IFBhcnRpYWw8VXNlckNhbGVuZGFyRGF0YT4pOiBib29sZWFuIHtcbiAgY29uc3QgaW5kZXggPSB0ZW1wQ2FsZW5kYXJEYXRhLmZpbmRJbmRleChkYXRhID0+IGRhdGEudXNlcklkID09PSB1c2VySWQpXG4gIGlmIChpbmRleCAhPT0gLTEpIHtcbiAgICB0ZW1wQ2FsZW5kYXJEYXRhW2luZGV4XSA9IHtcbiAgICAgIC4uLnRlbXBDYWxlbmRhckRhdGFbaW5kZXhdLFxuICAgICAgLi4udXBkYXRlcyxcbiAgICAgIGxhc3RVcGRhdGVkOiBuZXcgRGF0ZSgpXG4gICAgfVxuICAgIHJldHVybiB0cnVlXG4gIH1cbiAgcmV0dXJuIGZhbHNlXG59XG5cbmV4cG9ydCBmdW5jdGlvbiBhZGRDYWxlbmRhckV2ZW50KHVzZXJJZDogc3RyaW5nLCBldmVudDogQ2FsZW5kYXJFdmVudCk6IGJvb2xlYW4ge1xuICBjb25zdCB1c2VyRGF0YSA9IGdldFVzZXJDYWxlbmRhckRhdGEodXNlcklkKVxuICBpZiAodXNlckRhdGEpIHtcbiAgICB1c2VyRGF0YS5ldmVudHMucHVzaChldmVudClcbiAgICB1c2VyRGF0YS5sYXN0VXBkYXRlZCA9IG5ldyBEYXRlKClcbiAgICBcbiAgICAvLyBGb3JjZSB1cGRhdGUgaW4gZ2xvYmFsIHN0b3JhZ2VcbiAgICBjb25zdCBpbmRleCA9IHRlbXBDYWxlbmRhckRhdGEuZmluZEluZGV4KGRhdGEgPT4gZGF0YS51c2VySWQgPT09IHVzZXJJZClcbiAgICBpZiAoaW5kZXggIT09IC0xKSB7XG4gICAgICB0ZW1wQ2FsZW5kYXJEYXRhW2luZGV4XSA9IHVzZXJEYXRhXG4gICAgfVxuICAgIFxuICAgIGNvbnNvbGUubG9nKGDwn5OFIEV2ZW50byBhZ3JlZ2FkbzogJHtldmVudC50aXRsZX0gLSBUb3RhbCBldmVudG9zOiAke3VzZXJEYXRhLmV2ZW50cy5sZW5ndGh9YClcbiAgICByZXR1cm4gdHJ1ZVxuICB9XG4gIHJldHVybiBmYWxzZVxufVxuXG5leHBvcnQgZnVuY3Rpb24gdXBkYXRlQ2FsZW5kYXJFdmVudCh1c2VySWQ6IHN0cmluZywgZXZlbnRJZDogc3RyaW5nLCB1cGRhdGVzOiBQYXJ0aWFsPENhbGVuZGFyRXZlbnQ+KTogYm9vbGVhbiB7XG4gIGNvbnN0IHVzZXJEYXRhID0gZ2V0VXNlckNhbGVuZGFyRGF0YSh1c2VySWQpXG4gIGlmICh1c2VyRGF0YSkge1xuICAgIGNvbnN0IGV2ZW50SW5kZXggPSB1c2VyRGF0YS5ldmVudHMuZmluZEluZGV4KGUgPT4gZS5pZCA9PT0gZXZlbnRJZClcbiAgICBpZiAoZXZlbnRJbmRleCAhPT0gLTEpIHtcbiAgICAgIHVzZXJEYXRhLmV2ZW50c1tldmVudEluZGV4XSA9IHtcbiAgICAgICAgLi4udXNlckRhdGEuZXZlbnRzW2V2ZW50SW5kZXhdLFxuICAgICAgICAuLi51cGRhdGVzXG4gICAgICB9XG4gICAgICB1c2VyRGF0YS5sYXN0VXBkYXRlZCA9IG5ldyBEYXRlKClcbiAgICAgIFxuICAgICAgLy8gRm9yY2UgdXBkYXRlIGluIGdsb2JhbCBzdG9yYWdlXG4gICAgICBjb25zdCBpbmRleCA9IHRlbXBDYWxlbmRhckRhdGEuZmluZEluZGV4KGRhdGEgPT4gZGF0YS51c2VySWQgPT09IHVzZXJJZClcbiAgICAgIGlmIChpbmRleCAhPT0gLTEpIHtcbiAgICAgICAgdGVtcENhbGVuZGFyRGF0YVtpbmRleF0gPSB1c2VyRGF0YVxuICAgICAgfVxuICAgICAgXG4gICAgICBjb25zb2xlLmxvZyhg8J+ThSBFdmVudG8gYWN0dWFsaXphZG86ICR7dXNlckRhdGEuZXZlbnRzW2V2ZW50SW5kZXhdLnRpdGxlfWApXG4gICAgICByZXR1cm4gdHJ1ZVxuICAgIH1cbiAgfVxuICByZXR1cm4gZmFsc2Vcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGRlbGV0ZUNhbGVuZGFyRXZlbnQodXNlcklkOiBzdHJpbmcsIGV2ZW50SWQ6IHN0cmluZyk6IGJvb2xlYW4ge1xuICBjb25zdCB1c2VyRGF0YSA9IGdldFVzZXJDYWxlbmRhckRhdGEodXNlcklkKVxuICBpZiAodXNlckRhdGEpIHtcbiAgICBjb25zdCBldmVudEluZGV4ID0gdXNlckRhdGEuZXZlbnRzLmZpbmRJbmRleChlID0+IGUuaWQgPT09IGV2ZW50SWQpXG4gICAgaWYgKGV2ZW50SW5kZXggIT09IC0xKSB7XG4gICAgICBjb25zdCBkZWxldGVkRXZlbnQgPSB1c2VyRGF0YS5ldmVudHNbZXZlbnRJbmRleF1cbiAgICAgIHVzZXJEYXRhLmV2ZW50cy5zcGxpY2UoZXZlbnRJbmRleCwgMSlcbiAgICAgIHVzZXJEYXRhLmxhc3RVcGRhdGVkID0gbmV3IERhdGUoKVxuICAgICAgXG4gICAgICAvLyBGb3JjZSB1cGRhdGUgaW4gZ2xvYmFsIHN0b3JhZ2VcbiAgICAgIGNvbnN0IGluZGV4ID0gdGVtcENhbGVuZGFyRGF0YS5maW5kSW5kZXgoZGF0YSA9PiBkYXRhLnVzZXJJZCA9PT0gdXNlcklkKVxuICAgICAgaWYgKGluZGV4ICE9PSAtMSkge1xuICAgICAgICB0ZW1wQ2FsZW5kYXJEYXRhW2luZGV4XSA9IHVzZXJEYXRhXG4gICAgICB9XG4gICAgICBcbiAgICAgIGNvbnNvbGUubG9nKGDwn5OFIEV2ZW50byBlbGltaW5hZG86ICR7ZGVsZXRlZEV2ZW50LnRpdGxlfSAtIFRvdGFsIGV2ZW50b3M6ICR7dXNlckRhdGEuZXZlbnRzLmxlbmd0aH1gKVxuICAgICAgcmV0dXJuIHRydWVcbiAgICB9XG4gIH1cbiAgcmV0dXJuIGZhbHNlXG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRFdmVudHNGb3JEYXRlKHVzZXJJZDogc3RyaW5nLCBkYXRlOiBEYXRlKTogQ2FsZW5kYXJFdmVudFtdIHtcbiAgY29uc3QgdXNlckRhdGEgPSBnZXRVc2VyQ2FsZW5kYXJEYXRhKHVzZXJJZClcbiAgaWYgKCF1c2VyRGF0YSkgcmV0dXJuIFtdXG4gIFxuICBjb25zdCB0YXJnZXREYXRlID0gbmV3IERhdGUoZGF0ZSlcbiAgdGFyZ2V0RGF0ZS5zZXRIb3VycygwLCAwLCAwLCAwKVxuICBcbiAgcmV0dXJuIHVzZXJEYXRhLmV2ZW50cy5maWx0ZXIoZXZlbnQgPT4ge1xuICAgIGNvbnN0IGV2ZW50RGF0ZSA9IG5ldyBEYXRlKGV2ZW50LmRhdGUpXG4gICAgZXZlbnREYXRlLnNldEhvdXJzKDAsIDAsIDAsIDApXG4gICAgcmV0dXJuIGV2ZW50RGF0ZS5nZXRUaW1lKCkgPT09IHRhcmdldERhdGUuZ2V0VGltZSgpXG4gIH0pXG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRFdmVudHNGb3JEYXRlUmFuZ2UodXNlcklkOiBzdHJpbmcsIHN0YXJ0RGF0ZTogRGF0ZSwgZW5kRGF0ZTogRGF0ZSk6IENhbGVuZGFyRXZlbnRbXSB7XG4gIGNvbnN0IHVzZXJEYXRhID0gZ2V0VXNlckNhbGVuZGFyRGF0YSh1c2VySWQpXG4gIGlmICghdXNlckRhdGEpIHJldHVybiBbXVxuICBcbiAgcmV0dXJuIHVzZXJEYXRhLmV2ZW50cy5maWx0ZXIoZXZlbnQgPT4ge1xuICAgIGNvbnN0IGV2ZW50RGF0ZSA9IG5ldyBEYXRlKGV2ZW50LmRhdGUpXG4gICAgcmV0dXJuIGV2ZW50RGF0ZSA+PSBzdGFydERhdGUgJiYgZXZlbnREYXRlIDw9IGVuZERhdGVcbiAgfSlcbn1cblxuLy8gVXRpbGl0eSBmdW5jdGlvbnMgZm9yIGNhbGVuZGFyIG9wZXJhdGlvbnNcbmV4cG9ydCBmdW5jdGlvbiBpc1RpbWVTbG90QXZhaWxhYmxlKFxuICB1c2VySWQ6IHN0cmluZywgXG4gIGRhdGU6IERhdGUsIFxuICBzdGFydFRpbWU6IHN0cmluZywgXG4gIGVuZFRpbWU6IHN0cmluZ1xuKTogYm9vbGVhbiB7XG4gIGNvbnN0IHVzZXJEYXRhID0gZ2V0VXNlckNhbGVuZGFyRGF0YSh1c2VySWQpXG4gIGlmICghdXNlckRhdGEpIHJldHVybiB0cnVlXG4gIFxuICBjb25zdCBkYXlOYW1lID0gZ2V0RGF5TmFtZShkYXRlLmdldERheSgpKVxuICBjb25zdCBzY2hvb2xTbG90cyA9IHVzZXJEYXRhLnNjaG9vbFNjaGVkdWxlW2RheU5hbWVdIHx8IFtdXG4gIFxuICAvLyBDaGVjayBzY2hvb2wgc2NoZWR1bGUgY29uZmxpY3RzXG4gIGZvciAoY29uc3Qgc2xvdCBvZiBzY2hvb2xTbG90cykge1xuICAgIGlmICh0aW1lT3ZlcmxhcHMoc3RhcnRUaW1lLCBlbmRUaW1lLCBzbG90LnN0YXJ0LCBzbG90LmVuZCkpIHtcbiAgICAgIHJldHVybiBmYWxzZVxuICAgIH1cbiAgfVxuICBcbiAgLy8gQ2hlY2sgZXhpc3RpbmcgZXZlbnRzXG4gIGNvbnN0IGRheUV2ZW50cyA9IGdldEV2ZW50c0ZvckRhdGUodXNlcklkLCBkYXRlKVxuICBmb3IgKGNvbnN0IGV2ZW50IG9mIGRheUV2ZW50cykge1xuICAgIGlmIChldmVudC5zdGFydFRpbWUgJiYgZXZlbnQuZW5kVGltZSkge1xuICAgICAgaWYgKHRpbWVPdmVybGFwcyhzdGFydFRpbWUsIGVuZFRpbWUsIGV2ZW50LnN0YXJ0VGltZSwgZXZlbnQuZW5kVGltZSkpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlXG4gICAgICB9XG4gICAgfVxuICB9XG4gIFxuICByZXR1cm4gdHJ1ZVxufVxuXG5leHBvcnQgZnVuY3Rpb24gZmluZEF2YWlsYWJsZVRpbWVTbG90cyhcbiAgdXNlcklkOiBzdHJpbmcsXG4gIGRhdGU6IERhdGUsXG4gIGR1cmF0aW9uOiBudW1iZXIsIC8vIGluIG1pbnV0ZXNcbiAgcHJlZmVycmVkVGltZT86ICdtb3JuaW5nJyB8ICdhZnRlcm5vb24nIHwgJ2V2ZW5pbmcnXG4pOiB7IHN0YXJ0OiBzdHJpbmc7IGVuZDogc3RyaW5nIH1bXSB7XG4gIGNvbnN0IHVzZXJEYXRhID0gZ2V0VXNlckNhbGVuZGFyRGF0YSh1c2VySWQpXG4gIGlmICghdXNlckRhdGEpIHJldHVybiBbXVxuICBcbiAgY29uc3Qgc2xvdHM6IHsgc3RhcnQ6IHN0cmluZzsgZW5kOiBzdHJpbmcgfVtdID0gW11cbiAgXG4gIC8vIERlZmluZSB0aW1lIHJhbmdlcyBiYXNlZCBvbiBwcmVmZXJlbmNlXG4gIGNvbnN0IHRpbWVSYW5nZXMgPSB7XG4gICAgbW9ybmluZzogWycwODowMCcsICcxMjowMCddLFxuICAgIGFmdGVybm9vbjogWycxNDowMCcsICcxODowMCddLFxuICAgIGV2ZW5pbmc6IFsnMTk6MDAnLCAnMjI6MDAnXVxuICB9XG4gIFxuICBjb25zdCBzZWFyY2hSYW5nZSA9IHByZWZlcnJlZFRpbWUgPyB0aW1lUmFuZ2VzW3ByZWZlcnJlZFRpbWVdIDogWycwODowMCcsICcyMjowMCddXG4gIGNvbnN0IFtzZWFyY2hTdGFydCwgc2VhcmNoRW5kXSA9IHNlYXJjaFJhbmdlXG4gIFxuICAvLyBHZW5lcmF0ZSBwb3RlbnRpYWwgc2xvdHMgZXZlcnkgMzAgbWludXRlc1xuICBjb25zdCBzdGFydE1pbnV0ZXMgPSB0aW1lVG9NaW51dGVzKHNlYXJjaFN0YXJ0KVxuICBjb25zdCBlbmRNaW51dGVzID0gdGltZVRvTWludXRlcyhzZWFyY2hFbmQpXG4gIFxuICBmb3IgKGxldCBtaW51dGVzID0gc3RhcnRNaW51dGVzOyBtaW51dGVzIDw9IGVuZE1pbnV0ZXMgLSBkdXJhdGlvbjsgbWludXRlcyArPSAzMCkge1xuICAgIGNvbnN0IHNsb3RTdGFydCA9IG1pbnV0ZXNUb1RpbWUobWludXRlcylcbiAgICBjb25zdCBzbG90RW5kID0gbWludXRlc1RvVGltZShtaW51dGVzICsgZHVyYXRpb24pXG4gICAgXG4gICAgaWYgKGlzVGltZVNsb3RBdmFpbGFibGUodXNlcklkLCBkYXRlLCBzbG90U3RhcnQsIHNsb3RFbmQpKSB7XG4gICAgICBzbG90cy5wdXNoKHsgc3RhcnQ6IHNsb3RTdGFydCwgZW5kOiBzbG90RW5kIH0pXG4gICAgfVxuICB9XG4gIFxuICByZXR1cm4gc2xvdHNcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGdldEV2ZW50VHlwZUNvbG9yKHR5cGU6IENhbGVuZGFyRXZlbnRbJ3R5cGUnXSk6IHN0cmluZyB7XG4gIGNvbnN0IGNvbG9ycyA9IHtcbiAgICBleGFtOiAnI0VGNDQ0NCcsICAgICAgICAgIC8vIFJlZFxuICAgIHN0dWR5X3Nlc3Npb246ICcjM0I4MkY2JywgLy8gQmx1ZVxuICAgIGNsYXNzOiAnIzEwQjk4MScsICAgICAgICAgLy8gR3JlZW5cbiAgICBwZXJzb25hbDogJyM4QjVDRjYnLCAgICAgIC8vIFB1cnBsZVxuICAgIGV4dHJhY3VycmljdWxhcjogJyNGNTlFMEInIC8vIE9yYW5nZVxuICB9XG4gIHJldHVybiBjb2xvcnNbdHlwZV0gfHwgJyM2NDc0OEInXG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRFdmVudFR5cGVJY29uKHR5cGU6IENhbGVuZGFyRXZlbnRbJ3R5cGUnXSk6IHN0cmluZyB7XG4gIGNvbnN0IGljb25zID0ge1xuICAgIGV4YW06ICfwn5OdJyxcbiAgICBzdHVkeV9zZXNzaW9uOiAn8J+TmicsXG4gICAgY2xhc3M6ICfwn46TJyxcbiAgICBwZXJzb25hbDogJ/CfkaQnLFxuICAgIGV4dHJhY3VycmljdWxhcjogJ/Cfj4PigI3imYDvuI8nXG4gIH1cbiAgcmV0dXJuIGljb25zW3R5cGVdIHx8ICfwn5OFJ1xufVxuXG4vLyBIZWxwZXIgZnVuY3Rpb25zXG5mdW5jdGlvbiBnZXREYXlOYW1lKGRheUluZGV4OiBudW1iZXIpOiBrZXlvZiBTY2hvb2xTY2hlZHVsZSB7XG4gIGNvbnN0IGRheXMgPSBbJ3N1bmRheScsICdtb25kYXknLCAndHVlc2RheScsICd3ZWRuZXNkYXknLCAndGh1cnNkYXknLCAnZnJpZGF5JywgJ3NhdHVyZGF5J11cbiAgcmV0dXJuIGRheXNbZGF5SW5kZXhdIGFzIGtleW9mIFNjaG9vbFNjaGVkdWxlXG59XG5cbmZ1bmN0aW9uIHRpbWVUb01pbnV0ZXModGltZTogc3RyaW5nKTogbnVtYmVyIHtcbiAgY29uc3QgW2hvdXJzLCBtaW51dGVzXSA9IHRpbWUuc3BsaXQoJzonKS5tYXAoTnVtYmVyKVxuICByZXR1cm4gaG91cnMgKiA2MCArIG1pbnV0ZXNcbn1cblxuZnVuY3Rpb24gbWludXRlc1RvVGltZShtaW51dGVzOiBudW1iZXIpOiBzdHJpbmcge1xuICBjb25zdCBob3VycyA9IE1hdGguZmxvb3IobWludXRlcyAvIDYwKVxuICBjb25zdCBtaW5zID0gbWludXRlcyAlIDYwXG4gIHJldHVybiBgJHtob3Vycy50b1N0cmluZygpLnBhZFN0YXJ0KDIsICcwJyl9OiR7bWlucy50b1N0cmluZygpLnBhZFN0YXJ0KDIsICcwJyl9YFxufVxuXG5mdW5jdGlvbiB0aW1lT3ZlcmxhcHMoc3RhcnQxOiBzdHJpbmcsIGVuZDE6IHN0cmluZywgc3RhcnQyOiBzdHJpbmcsIGVuZDI6IHN0cmluZyk6IGJvb2xlYW4ge1xuICBjb25zdCBzdGFydDFNaW51dGVzID0gdGltZVRvTWludXRlcyhzdGFydDEpXG4gIGNvbnN0IGVuZDFNaW51dGVzID0gdGltZVRvTWludXRlcyhlbmQxKVxuICBjb25zdCBzdGFydDJNaW51dGVzID0gdGltZVRvTWludXRlcyhzdGFydDIpXG4gIGNvbnN0IGVuZDJNaW51dGVzID0gdGltZVRvTWludXRlcyhlbmQyKVxuICBcbiAgcmV0dXJuIHN0YXJ0MU1pbnV0ZXMgPCBlbmQyTWludXRlcyAmJiBlbmQxTWludXRlcyA+IHN0YXJ0Mk1pbnV0ZXNcbn1cblxuLy8gSW5pdGlhbGl6ZSBkZW1vIGRhdGFcbmZ1bmN0aW9uIGluaXREZW1vQ2FsZW5kYXJEYXRhKCkge1xuICBjb25zdCBkZW1vVXNlcklkID0gXCJkZW1vLXN0dWRlbnQtZml4ZWRcIlxuICBcbiAgaWYgKCFnZXRVc2VyQ2FsZW5kYXJEYXRhKGRlbW9Vc2VySWQpKSB7XG4gICAgY29uc29sZS5sb2coXCLwn5OFIEluaWNpYWxpemFuZG8gZGF0b3MgZGUgY2FsZW5kYXJpbyBkZW1vLi4uXCIpXG4gICAgXG4gICAgY29uc3QgZGVtb0RhdGEgPSBjcmVhdGVVc2VyQ2FsZW5kYXJEYXRhKGRlbW9Vc2VySWQpXG4gICAgXG4gICAgLy8gRGVtbyBzY2hvb2wgc2NoZWR1bGVcbiAgICBkZW1vRGF0YS5zY2hvb2xTY2hlZHVsZSA9IHtcbiAgICAgIG1vbmRheTogW1xuICAgICAgICB7IHN0YXJ0OiAnMDg6MDAnLCBlbmQ6ICcwOTozMCcsIHN1YmplY3Q6ICdNYXRlbcOhdGljYXMnLCBsb2NhdGlvbjogJ0F1bGEgMjAxJywgY29sb3I6ICcjM0I4MkY2JyB9LFxuICAgICAgICB7IHN0YXJ0OiAnMDk6NDUnLCBlbmQ6ICcxMToxNScsIHN1YmplY3Q6ICdRdcOtbWljYScsIGxvY2F0aW9uOiAnTGFib3JhdG9yaW8gQScsIGNvbG9yOiAnI0VGNDQ0NCcgfSxcbiAgICAgICAgeyBzdGFydDogJzExOjMwJywgZW5kOiAnMTM6MDAnLCBzdWJqZWN0OiAnSGlzdG9yaWEnLCBsb2NhdGlvbjogJ0F1bGEgMTA1JywgY29sb3I6ICcjOEI1Q0Y2JyB9XG4gICAgICBdLFxuICAgICAgdHVlc2RheTogW1xuICAgICAgICB7IHN0YXJ0OiAnMDg6MDAnLCBlbmQ6ICcwOTozMCcsIHN1YmplY3Q6ICdGw61zaWNhJywgbG9jYXRpb246ICdMYWJvcmF0b3JpbyBCJywgY29sb3I6ICcjMTBCOTgxJyB9LFxuICAgICAgICB7IHN0YXJ0OiAnMDk6NDUnLCBlbmQ6ICcxMToxNScsIHN1YmplY3Q6ICdMaXRlcmF0dXJhJywgbG9jYXRpb246ICdBdWxhIDIwMycsIGNvbG9yOiAnI0Y1OUUwQicgfSxcbiAgICAgICAgeyBzdGFydDogJzExOjMwJywgZW5kOiAnMTM6MDAnLCBzdWJqZWN0OiAnQmlvbG9nw61hJywgbG9jYXRpb246ICdMYWJvcmF0b3JpbyBDJywgY29sb3I6ICcjRUM0ODk5JyB9XG4gICAgICBdLFxuICAgICAgd2VkbmVzZGF5OiBbXG4gICAgICAgIHsgc3RhcnQ6ICcwODowMCcsIGVuZDogJzA5OjMwJywgc3ViamVjdDogJ01hdGVtw6F0aWNhcycsIGxvY2F0aW9uOiAnQXVsYSAyMDEnLCBjb2xvcjogJyMzQjgyRjYnIH0sXG4gICAgICAgIHsgc3RhcnQ6ICcwOTo0NScsIGVuZDogJzExOjE1Jywgc3ViamVjdDogJ0VkdWNhY2nDs24gRsOtc2ljYScsIGxvY2F0aW9uOiAnR2ltbmFzaW8nLCBjb2xvcjogJyMwNkI2RDQnIH0sXG4gICAgICAgIHsgc3RhcnQ6ICcxMTozMCcsIGVuZDogJzEzOjAwJywgc3ViamVjdDogJ0FydGUnLCBsb2NhdGlvbjogJ1RhbGxlcicsIGNvbG9yOiAnI0Y5NzMxNicgfVxuICAgICAgXSxcbiAgICAgIHRodXJzZGF5OiBbXG4gICAgICAgIHsgc3RhcnQ6ICcwODowMCcsIGVuZDogJzA5OjMwJywgc3ViamVjdDogJ1F1w61taWNhJywgbG9jYXRpb246ICdMYWJvcmF0b3JpbyBBJywgY29sb3I6ICcjRUY0NDQ0JyB9LFxuICAgICAgICB7IHN0YXJ0OiAnMDk6NDUnLCBlbmQ6ICcxMToxNScsIHN1YmplY3Q6ICdGw61zaWNhJywgbG9jYXRpb246ICdMYWJvcmF0b3JpbyBCJywgY29sb3I6ICcjMTBCOTgxJyB9LFxuICAgICAgICB7IHN0YXJ0OiAnMTE6MzAnLCBlbmQ6ICcxMzowMCcsIHN1YmplY3Q6ICdIaXN0b3JpYScsIGxvY2F0aW9uOiAnQXVsYSAxMDUnLCBjb2xvcjogJyM4QjVDRjYnIH1cbiAgICAgIF0sXG4gICAgICBmcmlkYXk6IFtcbiAgICAgICAgeyBzdGFydDogJzA4OjAwJywgZW5kOiAnMDk6MzAnLCBzdWJqZWN0OiAnQmlvbG9nw61hJywgbG9jYXRpb246ICdMYWJvcmF0b3JpbyBDJywgY29sb3I6ICcjRUM0ODk5JyB9LFxuICAgICAgICB7IHN0YXJ0OiAnMDk6NDUnLCBlbmQ6ICcxMToxNScsIHN1YmplY3Q6ICdMaXRlcmF0dXJhJywgbG9jYXRpb246ICdBdWxhIDIwMycsIGNvbG9yOiAnI0Y1OUUwQicgfSxcbiAgICAgICAgeyBzdGFydDogJzExOjMwJywgZW5kOiAnMTM6MDAnLCBzdWJqZWN0OiAnTWF0ZW3DoXRpY2FzJywgbG9jYXRpb246ICdBdWxhIDIwMScsIGNvbG9yOiAnIzNCODJGNicgfVxuICAgICAgXVxuICAgIH1cbiAgICBcbiAgICAvLyBEZW1vIGV2ZW50c1xuICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKClcbiAgICBjb25zdCBkZW1vRXZlbnRzOiBDYWxlbmRhckV2ZW50W10gPSBbXG4gICAgICB7XG4gICAgICAgIGlkOiAnZXhhbS0xJyxcbiAgICAgICAgdGl0bGU6ICdFeGFtZW4gUXXDrW1pY2EgT3Jnw6FuaWNhJyxcbiAgICAgICAgZGF0ZTogbmV3IERhdGUobm93LmdldFRpbWUoKSArIDcgKiAyNCAqIDYwICogNjAgKiAxMDAwKSxcbiAgICAgICAgc3RhcnRUaW1lOiAnMTA6MDAnLFxuICAgICAgICBlbmRUaW1lOiAnMTI6MDAnLFxuICAgICAgICB0eXBlOiAnZXhhbScsXG4gICAgICAgIGNvbG9yOiBnZXRFdmVudFR5cGVDb2xvcignZXhhbScpLFxuICAgICAgICBkZXNjcmlwdGlvbjogJ0V4YW1lbiBwYXJjaWFsIGRlIHF1w61taWNhIG9yZ8OhbmljYScsXG4gICAgICAgIHN1YmplY3Q6ICdRdcOtbWljYScsXG4gICAgICAgIGxvY2F0aW9uOiAnTGFib3JhdG9yaW8gQSdcbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgIGlkOiAnc3R1ZHktMScsXG4gICAgICAgIHRpdGxlOiAnU2VzacOzbiBkZSBFc3R1ZGlvIC0gTWF0ZW3DoXRpY2FzJyxcbiAgICAgICAgZGF0ZTogbmV3IERhdGUobm93LmdldFRpbWUoKSArIDEgKiAyNCAqIDYwICogNjAgKiAxMDAwKSxcbiAgICAgICAgc3RhcnRUaW1lOiAnMTU6MDAnLFxuICAgICAgICBlbmRUaW1lOiAnMTY6MzAnLFxuICAgICAgICB0eXBlOiAnc3R1ZHlfc2Vzc2lvbicsXG4gICAgICAgIGNvbG9yOiBnZXRFdmVudFR5cGVDb2xvcignc3R1ZHlfc2Vzc2lvbicpLFxuICAgICAgICBkZXNjcmlwdGlvbjogJ1JlcGFzbyBkZSBjw6FsY3VsbyBpbnRlZ3JhbCcsXG4gICAgICAgIHN1YmplY3Q6ICdNYXRlbcOhdGljYXMnXG4gICAgICB9LFxuICAgICAge1xuICAgICAgICBpZDogJ3BlcnNvbmFsLTEnLFxuICAgICAgICB0aXRsZTogJ0VudHJlbmFtaWVudG8gRsO6dGJvbCcsXG4gICAgICAgIGRhdGU6IG5ldyBEYXRlKG5vdy5nZXRUaW1lKCkgKyAyICogMjQgKiA2MCAqIDYwICogMTAwMCksXG4gICAgICAgIHN0YXJ0VGltZTogJzE3OjAwJyxcbiAgICAgICAgZW5kVGltZTogJzE4OjMwJyxcbiAgICAgICAgdHlwZTogJ2V4dHJhY3VycmljdWxhcicsXG4gICAgICAgIGNvbG9yOiBnZXRFdmVudFR5cGVDb2xvcignZXh0cmFjdXJyaWN1bGFyJyksXG4gICAgICAgIGRlc2NyaXB0aW9uOiAnRW50cmVuYW1pZW50byBkZSBmw7p0Ym9sJyxcbiAgICAgICAgbG9jYXRpb246ICdDYW1wbyBkZXBvcnRpdm8nXG4gICAgICB9XG4gICAgXVxuICAgIFxuICAgIGRlbW9FdmVudHMuZm9yRWFjaChldmVudCA9PiB7XG4gICAgICBkZW1vRGF0YS5ldmVudHMucHVzaChldmVudClcbiAgICB9KVxuICAgIFxuICAgIGRlbW9EYXRhLmlzU2V0dXBDb21wbGV0ZSA9IHRydWVcbiAgICBkZW1vRGF0YS5sYXN0VXBkYXRlZCA9IG5ldyBEYXRlKClcbiAgICBcbiAgICBjb25zb2xlLmxvZyhcIuKchSBEYXRvcyBkZSBjYWxlbmRhcmlvIGRlbW8gaW5pY2lhbGl6YWRvc1wiKVxuICB9IGVsc2Uge1xuICAgIGNvbnNvbGUubG9nKFwi4pyFIERhdG9zIGRlIGNhbGVuZGFyaW8gZGVtbyB5YSBleGlzdGVuXCIpXG4gIH1cbn1cblxuLy8gSW5pdGlhbGl6ZSBkZW1vIGRhdGEgb24gbW9kdWxlIGxvYWRcbmluaXREZW1vQ2FsZW5kYXJEYXRhKCkiXSwibmFtZXMiOlsiZ2xvYmFsRm9yQ2FsZW5kYXJEYXRhIiwiZ2xvYmFsVGhpcyIsInRlbXBDYWxlbmRhckRhdGEiLCJnZXRVc2VyQ2FsZW5kYXJEYXRhIiwidXNlcklkIiwiZmluZCIsImRhdGEiLCJjcmVhdGVVc2VyQ2FsZW5kYXJEYXRhIiwibmV3RGF0YSIsInNjaG9vbFNjaGVkdWxlIiwibW9uZGF5IiwidHVlc2RheSIsIndlZG5lc2RheSIsInRodXJzZGF5IiwiZnJpZGF5Iiwic3R1ZHlQcmVmZXJlbmNlcyIsInByZWZlcnJlZFN0dWR5VGltZSIsImRhaWx5U3R1ZHlIb3VycyIsIm1heFNlc3Npb25EdXJhdGlvbiIsImJyZWFrQmV0d2VlblNlc3Npb25zIiwid2Vla2VuZFN0dWR5SG91cnMiLCJub1N0dWR5RGF5cyIsImV2ZW50cyIsImlzU2V0dXBDb21wbGV0ZSIsImxhc3RVcGRhdGVkIiwiRGF0ZSIsInB1c2giLCJ1cGRhdGVVc2VyQ2FsZW5kYXJEYXRhIiwidXBkYXRlcyIsImluZGV4IiwiZmluZEluZGV4IiwiYWRkQ2FsZW5kYXJFdmVudCIsImV2ZW50IiwidXNlckRhdGEiLCJjb25zb2xlIiwibG9nIiwidGl0bGUiLCJsZW5ndGgiLCJ1cGRhdGVDYWxlbmRhckV2ZW50IiwiZXZlbnRJZCIsImV2ZW50SW5kZXgiLCJlIiwiaWQiLCJkZWxldGVDYWxlbmRhckV2ZW50IiwiZGVsZXRlZEV2ZW50Iiwic3BsaWNlIiwiZ2V0RXZlbnRzRm9yRGF0ZSIsImRhdGUiLCJ0YXJnZXREYXRlIiwic2V0SG91cnMiLCJmaWx0ZXIiLCJldmVudERhdGUiLCJnZXRUaW1lIiwiZ2V0RXZlbnRzRm9yRGF0ZVJhbmdlIiwic3RhcnREYXRlIiwiZW5kRGF0ZSIsImlzVGltZVNsb3RBdmFpbGFibGUiLCJzdGFydFRpbWUiLCJlbmRUaW1lIiwiZGF5TmFtZSIsImdldERheU5hbWUiLCJnZXREYXkiLCJzY2hvb2xTbG90cyIsInNsb3QiLCJ0aW1lT3ZlcmxhcHMiLCJzdGFydCIsImVuZCIsImRheUV2ZW50cyIsImZpbmRBdmFpbGFibGVUaW1lU2xvdHMiLCJkdXJhdGlvbiIsInByZWZlcnJlZFRpbWUiLCJzbG90cyIsInRpbWVSYW5nZXMiLCJtb3JuaW5nIiwiYWZ0ZXJub29uIiwiZXZlbmluZyIsInNlYXJjaFJhbmdlIiwic2VhcmNoU3RhcnQiLCJzZWFyY2hFbmQiLCJzdGFydE1pbnV0ZXMiLCJ0aW1lVG9NaW51dGVzIiwiZW5kTWludXRlcyIsIm1pbnV0ZXMiLCJzbG90U3RhcnQiLCJtaW51dGVzVG9UaW1lIiwic2xvdEVuZCIsImdldEV2ZW50VHlwZUNvbG9yIiwidHlwZSIsImNvbG9ycyIsImV4YW0iLCJzdHVkeV9zZXNzaW9uIiwiY2xhc3MiLCJwZXJzb25hbCIsImV4dHJhY3VycmljdWxhciIsImdldEV2ZW50VHlwZUljb24iLCJpY29ucyIsImRheUluZGV4IiwiZGF5cyIsInRpbWUiLCJob3VycyIsInNwbGl0IiwibWFwIiwiTnVtYmVyIiwiTWF0aCIsImZsb29yIiwibWlucyIsInRvU3RyaW5nIiwicGFkU3RhcnQiLCJzdGFydDEiLCJlbmQxIiwic3RhcnQyIiwiZW5kMiIsInN0YXJ0MU1pbnV0ZXMiLCJlbmQxTWludXRlcyIsInN0YXJ0Mk1pbnV0ZXMiLCJlbmQyTWludXRlcyIsImluaXREZW1vQ2FsZW5kYXJEYXRhIiwiZGVtb1VzZXJJZCIsImRlbW9EYXRhIiwic3ViamVjdCIsImxvY2F0aW9uIiwiY29sb3IiLCJub3ciLCJkZW1vRXZlbnRzIiwiZGVzY3JpcHRpb24iLCJmb3JFYWNoIl0sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/calendar-data.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/contextual-conversation-manager.ts":
/*!****************************************************!*\
  !*** ./src/lib/contextual-conversation-manager.ts ***!
  \****************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   ContextualConversationManager: () => (/* binding */ ContextualConversationManager)\n/* harmony export */ });\n/* harmony import */ var _advanced_learning_profiles__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./advanced-learning-profiles */ \"(rsc)/./src/lib/advanced-learning-profiles.ts\");\n/* harmony import */ var _visual_learning_engine__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./visual-learning-engine */ \"(rsc)/./src/lib/visual-learning-engine.ts\");\n/* harmony import */ var _calendar_ai_integration__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./calendar-ai-integration */ \"(rsc)/./src/lib/calendar-ai-integration.ts\");\n// Contextual Conversation Manager for Sara AI\n// Provides intelligent context management and conversation coherence\n\n\n\nclass ContextualConversationManager {\n    static{\n        // Configuration for persistent conversation management\n        this.MAX_TURNS_RETAINED = 20;\n    }\n    static{\n        this.MAX_REFERENCES = 10;\n    }\n    static{\n        this.CONTEXT_DECAY_HOURS = 24;\n    }\n    /**\n   * Processes user message with full contextual awareness\n   */ static async processContextualMessage(userId, message, sessionId, userName) {\n        const actualSessionId = sessionId || `session_${userId}_${Date.now()}`;\n        // Import persistent storage functions\n        const { getConversationSession, createConversationSession, addConversationTurn, addPendingTask, getPendingTasks } = __webpack_require__(/*! ./temp-storage */ \"(rsc)/./src/lib/temp-storage.ts\");\n        // Get or create persistent conversation session\n        let session = getConversationSession(userId, actualSessionId);\n        if (!session) {\n            session = createConversationSession(userId, actualSessionId);\n        }\n        console.log(`💬 Processing message for session ${actualSessionId}: \"${message.substring(0, 50)}...\"`);\n        console.log(`📊 Session has ${session.turns.length} previous turns, ${session.pendingTasks.filter((t)=>!t.completed).length} pending tasks`);\n        // Analyze message metadata\n        const messageMetadata = this.analyzeMessageMetadata(message);\n        // Add user turn to persistent storage\n        session = addConversationTurn(userId, actualSessionId, 'user', message, messageMetadata);\n        // Check for pending tasks that might relate to this message\n        const pendingTasks = getPendingTasks(userId, actualSessionId);\n        // Build context from persistent data\n        const context = {\n            userId,\n            sessionId: actualSessionId,\n            currentTopic: session.currentTopic,\n            currentSubject: session.currentSubject,\n            conversationFlow: session.turns.map((turn)=>({\n                    id: turn.id,\n                    timestamp: turn.timestamp,\n                    role: turn.role,\n                    content: turn.content,\n                    metadata: turn.metadata\n                })),\n            contextSummary: this.buildContextSummary(session),\n            activeIntentions: this.extractActiveIntentions(session.turns.slice(-5)),\n            pendingQuestions: [],\n            referenceMemory: this.buildReferenceMemory(session.turns),\n            lastUpdate: new Date()\n        };\n        // Generate contextually aware response\n        const response = await this.generateContextualResponse(context, userName, pendingTasks);\n        // Add assistant turn to persistent storage\n        const assistantMetadata = {\n            confidence: response.continuityScore,\n            visualsGenerated: !!response.visualRecommendation,\n            searchPerformed: response.personalizations.includes('academic_search'),\n            taskCompleted: response.personalizations.includes('task_completed')\n        };\n        addConversationTurn(userId, actualSessionId, 'assistant', response.content, assistantMetadata);\n        return response;\n    }\n    /**\n   * Build context summary from persistent conversation data\n   */ static buildContextSummary(session) {\n        const recentTurns = session.turns.slice(-6);\n        const keyTopics = [\n            ...new Set(recentTurns.map((turn)=>turn.metadata.topic).filter(Boolean))\n        ];\n        const keySubjects = [\n            ...new Set(recentTurns.map((turn)=>turn.metadata.subject).filter(Boolean))\n        ];\n        const summaryParts = [];\n        if (keySubjects.length > 0) {\n            summaryParts.push(`Materias: ${keySubjects.join(', ')}`);\n        }\n        if (keyTopics.length > 0) {\n            summaryParts.push(`Temas: ${keyTopics.join(', ')}`);\n        }\n        return summaryParts.join(' | ') || 'Conversación general';\n    }\n    /**\n   * Extract active intentions from recent conversation turns\n   */ static extractActiveIntentions(recentTurns) {\n        const intentions = recentTurns.map((turn)=>turn.metadata.intention).filter(Boolean).slice(-3);\n        return [\n            ...new Set(intentions)\n        ];\n    }\n    /**\n   * Build reference memory from conversation turns\n   */ static buildReferenceMemory(turns) {\n        const references = [];\n        const recentTurns = turns.slice(-10);\n        recentTurns.forEach((turn, index)=>{\n            if (turn.metadata.confidence && turn.metadata.confidence > 0.7) {\n                references.push({\n                    id: `ref_${turn.id}`,\n                    type: this.determineReferenceTypeFromMetadata(turn.metadata),\n                    content: turn.content.substring(0, 100) + '...',\n                    relevanceScore: turn.metadata.confidence,\n                    turnIndex: index,\n                    timestamp: turn.timestamp\n                });\n            }\n        });\n        return references.slice(-5) // Keep only last 5 references\n        ;\n    }\n    /**\n   * Helper to determine reference type from metadata\n   */ static determineReferenceTypeFromMetadata(metadata) {\n        if (metadata.intention === 'continuation') return 'topic_continuation';\n        if (metadata.intention === 'problem_solving') return 'problem_solving';\n        if (metadata.intention === 'explanation') return 'explanation_followup';\n        return 'subject_reference';\n    }\n    /**\n   * Handles calendar task execution with real event creation\n   */ static async handleCalendarTasks(userId, message, conversationHistory, pendingTasks) {\n        console.log(`🔍 Checking for calendar tasks in message: \"${message.substring(0, 50)}...\"`);\n        // Initialize calendar integration\n        const calendarIntegration = new _calendar_ai_integration__WEBPACK_IMPORTED_MODULE_2__.AICalendarIntegration(userId);\n        // Analyze message for calendar events\n        const calendarResult = await calendarIntegration.processMessage(message, conversationHistory);\n        if (calendarResult.needsEventCreation) {\n            console.log(`🎯 Calendar task detected and executed!`);\n            // Mark any related pending task as completed\n            if (pendingTasks.length > 0) {\n                const calendarTask = pendingTasks.find((t)=>t.type === 'calendar_event');\n                if (calendarTask) {\n                    const { markTaskCompleted } = __webpack_require__(/*! ./temp-storage */ \"(rsc)/./src/lib/temp-storage.ts\");\n                    markTaskCompleted(userId, 'current-session', calendarTask.id, calendarResult);\n                }\n            }\n            return {\n                type: 'calendar_event_creation',\n                content: calendarResult.response || 'Evento creado exitosamente',\n                metadata: {\n                    suggestedActions: calendarResult.event ? [\n                        'Ver en calendario',\n                        'Editar evento',\n                        'Eliminar evento'\n                    ] : [\n                        'Reintentar',\n                        'Proporcionar más detalles'\n                    ],\n                    eventCreated: !!calendarResult.event\n                }\n            };\n        }\n        return null;\n    }\n    /**\n   * Builds educational prompt based on conversation context\n   */ static buildEducationalPrompt(context, message, userName) {\n        const recentTurns = context.conversationFlow.slice(-3);\n        const conversationContext = recentTurns.map((turn)=>`${turn.role === 'user' ? 'Estudiante' : 'Tutor'}: ${turn.content}`).join('\\n');\n        let prompt = `Eres Sara, una tutora de IA especializada en educación secundaria. `;\n        if (userName) {\n            prompt += `El estudiante se llama ${userName}. `;\n        }\n        if (context.currentSubject) {\n            prompt += `Actualmente estás ayudando con ${context.currentSubject}. `;\n        }\n        if (context.contextSummary && context.contextSummary !== 'Conversación general') {\n            prompt += `Contexto de la conversación: ${context.contextSummary}. `;\n        }\n        prompt += `\\n\\nConversación reciente:\\n${conversationContext}`;\n        prompt += `\\n\\nNuevo mensaje del estudiante: \"${message}\"`;\n        prompt += `\\n\\nInstrucciones:\\n`;\n        prompt += `- Responde como Sara, la tutora de IA amigable y experta\\n`;\n        prompt += `- Mantén coherencia con la conversación anterior\\n`;\n        prompt += `- Si detectas que el estudiante quiere agendar algo (examen, sesión de estudio), menciona que puedes ayudar con eso\\n`;\n        prompt += `- Usa ejemplos concretos y un lenguaje claro para estudiantes de secundaria\\n`;\n        prompt += `- Si es una pregunta académica, proporciona explicaciones paso a paso\\n`;\n        prompt += `- Mantén un tono motivador y positivo\\n\\n`;\n        prompt += `Respuesta de Sara:`;\n        return prompt;\n    }\n    /**\n   * Generates contextual fallback response when AI services fail\n   */ static generateContextualFallback(context, message, userName) {\n        const msgLower = message.toLowerCase();\n        // Calendar-related fallback\n        if (/agendes?|agend[aá]|cre[ae]|programa|anot[ae]|agrega.*(?:examen|evento|sesión)/i.test(message)) {\n            return `¡Hola${userName ? ' ' + userName : ''}! Veo que quieres agendar algo en tu calendario.\\n\\n` + `Por favor proporciona estos detalles:\\n` + `📅 **Fecha**: ¿Para cuándo es?\\n` + `🕐 **Hora**: ¿A qué hora?\\n` + `📚 **Tema**: ¿De qué se trata?\\n\\n` + `Una vez que me des estos datos, podré agregarlo a tu calendario automáticamente.`;\n        }\n        // Academic question fallback\n        if (/¿|qué.*es|cómo|explica|no.*entiendo/i.test(message)) {\n            let response = `Entiendo tu pregunta${userName ? ', ' + userName : ''}.\\n\\n`;\n            if (context.currentSubject) {\n                response += `Para ayudarte mejor con ${context.currentSubject}, `;\n            }\n            response += `¿podrías ser más específico sobre qué parte necesitas que te explique?\\n\\n`;\n            response += `Mientras tanto, puedo:\\n`;\n            response += `• Explicarte conceptos paso a paso\\n`;\n            response += `• Ayudarte a resolver ejercicios\\n`;\n            response += `• Crear recordatorios de estudio\\n`;\n            response += `• Agendar sesiones de repaso`;\n            return response;\n        }\n        // General fallback with context\n        let response = `¡Hola${userName ? ' ' + userName : ''}! 👋\\n\\n`;\n        if (context.currentSubject) {\n            response += `Veo que hemos estado trabajando con ${context.currentSubject}. `;\n        }\n        response += `¿En qué más puedo ayudarte hoy?\\n\\n`;\n        response += `Puedo ayudarte con:\\n`;\n        response += `📚 **Explicar conceptos** de tus materias\\n`;\n        response += `📝 **Resolver ejercicios** paso a paso\\n`;\n        response += `📅 **Agendar eventos** en tu calendario\\n`;\n        response += `🎯 **Hacer evaluaciones** adaptativas\\n`;\n        response += `🔍 **Buscar información** académica`;\n        return response;\n    }\n    /**\n   * Analyzes message metadata for context\n   */ static analyzeMessageMetadata(message) {\n        const msgLower = message.toLowerCase();\n        // Subject detection\n        let subject;\n        if (/matemáticas?|álgebra|geometría|cálculo/.test(msgLower)) {\n            subject = 'matemáticas';\n        } else if (/física|mecánica|cinemática|energía/.test(msgLower)) {\n            subject = 'física';\n        } else if (/química|reacción|átomo|molécula/.test(msgLower)) {\n            subject = 'química';\n        }\n        // Topic detection\n        let topic;\n        const topicMatches = msgLower.match(/(ecuación|función|derivada|integral|fórmula|problema)/gi);\n        if (topicMatches) {\n            topic = topicMatches[0];\n        }\n        // Intention detection\n        let intention;\n        if (/explica|qué es|cómo funciona/.test(msgLower)) {\n            intention = 'explanation';\n        } else if (/resuelve|calcula|encuentra/.test(msgLower)) {\n            intention = 'problem_solving';\n        } else if (/ayuda|no entiendo|estoy confundido/.test(msgLower)) {\n            intention = 'help_request';\n        } else if (/continúa|sigue|y después/.test(msgLower)) {\n            intention = 'continuation';\n        }\n        // Confidence based on clarity and specificity\n        let confidence = 0.5;\n        if (subject) confidence += 0.2;\n        if (topic) confidence += 0.2;\n        if (intention) confidence += 0.1;\n        return {\n            subject,\n            topic,\n            intention,\n            confidence: Math.min(confidence, 1.0)\n        };\n    }\n    /**\n   * Updates contextual information based on new message\n   */ static async updateContextualInformation(context, message) {\n        const recentTurns = context.conversationFlow.slice(-5);\n        const metadata = recentTurns[recentTurns.length - 1]?.metadata;\n        // Update current topic/subject if detected\n        if (metadata?.subject) {\n            context.currentSubject = metadata.subject;\n        }\n        if (metadata?.topic) {\n            context.currentTopic = metadata.topic;\n        }\n        // Detect conversation continuity patterns\n        if (metadata?.intention === 'continuation') {\n            const lastAssistantTurn = recentTurns.slice().reverse().find((turn)=>turn.role === 'assistant');\n            if (lastAssistantTurn?.metadata?.subject) {\n                context.currentSubject = lastAssistantTurn.metadata.subject;\n            }\n        }\n        // Update active intentions\n        if (metadata?.intention && !context.activeIntentions.includes(metadata.intention)) {\n            context.activeIntentions.push(metadata.intention);\n            // Keep only recent intentions\n            if (context.activeIntentions.length > 3) {\n                context.activeIntentions.shift();\n            }\n        }\n        // Create context references for important information\n        if (metadata?.confidence && metadata.confidence > 0.7) {\n            const reference = {\n                id: `ref_${Date.now()}`,\n                type: this.determineReferenceType(metadata),\n                content: message,\n                relevanceScore: metadata.confidence,\n                turnIndex: context.conversationFlow.length - 1,\n                timestamp: new Date()\n            };\n            context.referenceMemory.push(reference);\n            // Keep only most relevant references\n            if (context.referenceMemory.length > this.MAX_REFERENCES) {\n                context.referenceMemory.sort((a, b)=>b.relevanceScore - a.relevanceScore);\n                context.referenceMemory = context.referenceMemory.slice(0, this.MAX_REFERENCES);\n            }\n        }\n        // Update context summary\n        await this.updateContextSummary(context);\n    }\n    /**\n   * Determines reference type based on metadata\n   */ static determineReferenceType(metadata) {\n        if (metadata.intention === 'continuation') return 'topic_continuation';\n        if (metadata.intention === 'problem_solving') return 'problem_solving';\n        if (metadata.intention === 'explanation') return 'explanation_followup';\n        return 'subject_reference';\n    }\n    /**\n   * Updates context summary with key conversation points\n   */ static async updateContextSummary(context) {\n        const recentTurns = context.conversationFlow.slice(-6);\n        const keyTopics = [\n            ...new Set(recentTurns.map((turn)=>turn.metadata.topic).filter(Boolean))\n        ];\n        const keySubjects = [\n            ...new Set(recentTurns.map((turn)=>turn.metadata.subject).filter(Boolean))\n        ];\n        const summaryParts = [];\n        if (keySubjects.length > 0) {\n            summaryParts.push(`Materias: ${keySubjects.join(', ')}`);\n        }\n        if (keyTopics.length > 0) {\n            summaryParts.push(`Temas: ${keyTopics.join(', ')}`);\n        }\n        if (context.activeIntentions.length > 0) {\n            summaryParts.push(`Intenciones: ${context.activeIntentions.join(', ')}`);\n        }\n        context.contextSummary = summaryParts.join(' | ') || 'Conversación general';\n    }\n    /**\n   * Generates contextually aware response using persistent storage\n   */ static async generateContextualResponse(context, userName, pendingTasks = []) {\n        // Get learning profile for personalization\n        const learningProfile = _advanced_learning_profiles__WEBPACK_IMPORTED_MODULE_0__.AdvancedLearningProfileManager.getLearningProfile(context.userId);\n        // Update learning profile based on current message\n        const latestMessage = context.conversationFlow[context.conversationFlow.length - 1]?.content || '';\n        _advanced_learning_profiles__WEBPACK_IMPORTED_MODULE_0__.AdvancedLearningProfileManager.processUserMessage(context.userId, latestMessage);\n        // Analyze conversation for continuity\n        const continuityAnalysis = this.analyzeContinuity(context);\n        // 🎯 FIRST PRIORITY: Check for calendar task execution\n        const calendarResult = await this.handleCalendarTasks(context.userId, latestMessage, this.formatConversationHistory(context), pendingTasks);\n        if (calendarResult) {\n            console.log(`📅 Calendar task executed: ${calendarResult.type}`);\n            return {\n                content: calendarResult.content,\n                context,\n                continuityScore: 0.9,\n                personalizations: [\n                    'calendar_task_executed'\n                ],\n                suggestedFollowups: calendarResult.metadata?.suggestedActions || []\n            };\n        }\n        // Generate base response using AI providers directly\n        const { aiService } = __webpack_require__(/*! ./ai-providers */ \"(rsc)/./src/lib/ai-providers.ts\");\n        let baseContent = '';\n        try {\n            // Create educational prompt based on context\n            const educationalPrompt = this.buildEducationalPrompt(context, latestMessage, userName);\n            baseContent = await aiService.generateExercise(educationalPrompt);\n            // If AI service returns fallback template, use contextual fallback\n            if (baseContent === 'TEMPLATE_FALLBACK') {\n                baseContent = this.generateContextualFallback(context, latestMessage, userName);\n            }\n        } catch (error) {\n            console.error('AI service error, using contextual fallback:', error);\n            baseContent = this.generateContextualFallback(context, latestMessage, userName);\n        }\n        // Enhance response with contextual information\n        let enhancedContent = baseContent;\n        // Add continuity references if relevant\n        if (continuityAnalysis.shouldReference) {\n            enhancedContent = this.addContinuityReferences(enhancedContent, context);\n        }\n        // Apply learning style adaptations\n        enhancedContent = _advanced_learning_profiles__WEBPACK_IMPORTED_MODULE_0__.AdvancedLearningProfileManager.adaptResponseToLearningStyle(enhancedContent, learningProfile);\n        // Determine personalizations applied\n        const personalizations = [];\n        if (continuityAnalysis.shouldReference) personalizations.push('context_reference');\n        if (learningProfile.primaryStyle !== 'multimodal') personalizations.push('learning_style_adaptation');\n        if (pendingTasks.length > 0) personalizations.push('task_aware');\n        // Generate visual recommendations\n        let visualRecommendation;\n        if (learningProfile.adaptationPreferences.prefersVisualAids && (context.currentSubject || context.currentTopic)) {\n            visualRecommendation = {\n                type: _visual_learning_engine__WEBPACK_IMPORTED_MODULE_1__.VisualLearningEngine.detectOptimalVisualType(enhancedContent, context.currentSubject),\n                reason: `Recomendado para tu perfil de aprendizaje ${learningProfile.primaryStyle}`\n            };\n        }\n        // Generate follow-up suggestions\n        const followups = this.generateContextualFollowups(context, learningProfile);\n        return {\n            content: enhancedContent,\n            context,\n            continuityScore: continuityAnalysis.score,\n            personalizations,\n            suggestedFollowups: followups,\n            visualRecommendation\n        };\n    }\n    /**\n   * Analyzes conversation continuity\n   */ static analyzeContinuity(context) {\n        const recentTurns = context.conversationFlow.slice(-4);\n        let score = 0.5 // Base score\n        ;\n        let shouldReference = false;\n        let referenceType;\n        // Check for topic continuity\n        const topics = recentTurns.map((turn)=>turn.metadata.topic).filter(Boolean);\n        if (topics.length > 1 && topics[topics.length - 1] === topics[topics.length - 2]) {\n            score += 0.2;\n            shouldReference = true;\n            referenceType = 'topic_continuity';\n        }\n        // Check for subject continuity\n        const subjects = recentTurns.map((turn)=>turn.metadata.subject).filter(Boolean);\n        if (subjects.length > 1 && subjects[subjects.length - 1] === subjects[subjects.length - 2]) {\n            score += 0.15;\n            shouldReference = true;\n            referenceType = 'subject_continuity';\n        }\n        // Check for continuation indicators\n        const latestMessage = recentTurns[recentTurns.length - 1]?.content?.toLowerCase() || '';\n        if (/continúa|sigue|y después|también|además/.test(latestMessage)) {\n            score += 0.25;\n            shouldReference = true;\n            referenceType = 'explicit_continuation';\n        }\n        // Check for question follow-up patterns\n        const hasQuestionFollowup = recentTurns.some((turn, index)=>index > 0 && turn.role === 'user' && /por qué|cómo|cuándo|dónde|explica/.test(turn.content.toLowerCase()) && recentTurns[index - 1]?.role === 'assistant');\n        if (hasQuestionFollowup) {\n            score += 0.1;\n            shouldReference = true;\n            referenceType = 'followup_question';\n        }\n        return {\n            score: Math.min(score, 1.0),\n            shouldReference,\n            referenceType\n        };\n    }\n    /**\n   * Adds continuity references to response\n   */ static addContinuityReferences(content, context) {\n        const recentAssistantTurns = context.conversationFlow.filter((turn)=>turn.role === 'assistant').slice(-2);\n        if (recentAssistantTurns.length === 0) return content;\n        const lastTopic = context.currentTopic;\n        const lastSubject = context.currentSubject;\n        let referencePrefix = '';\n        if (lastTopic && lastSubject) {\n            referencePrefix = `Continuando con ${lastTopic} en ${lastSubject}: `;\n        } else if (lastTopic) {\n            referencePrefix = `Siguiendo con el tema de ${lastTopic}: `;\n        } else if (lastSubject) {\n            referencePrefix = `Continuando con ${lastSubject}: `;\n        } else {\n            referencePrefix = `Como mencioné anteriormente: `;\n        }\n        return referencePrefix + content;\n    }\n    /**\n   * Generates contextual follow-up suggestions\n   */ static generateContextualFollowups(context, learningProfile) {\n        const followups = [];\n        // Based on current topic/subject\n        if (context.currentTopic) {\n            followups.push(`¿Tienes más preguntas sobre ${context.currentTopic}?`);\n        }\n        if (context.currentSubject) {\n            followups.push(`¿Te gustaría ver ejercicios de ${context.currentSubject}?`);\n        }\n        // Based on learning style\n        if (learningProfile.adaptationPreferences.prefersVisualAids) {\n            followups.push('¿Te ayudaría ver un diagrama de esto?');\n        }\n        if (learningProfile.adaptationPreferences.prefersInteraction) {\n            followups.push('¿Quieres practicar con un ejercicio?');\n        }\n        // Based on active intentions\n        if (context.activeIntentions.includes('explanation')) {\n            followups.push('¿Necesitas que profundice en algún aspecto específico?');\n        }\n        if (context.activeIntentions.includes('problem_solving')) {\n            followups.push('¿Quieres que resolvamos otro problema similar?');\n        }\n        // Generic contextual followups\n        if (context.conversationFlow.length > 3) {\n            followups.push('¿Hay algo que no quedó claro?');\n        }\n        return followups.slice(0, 3) // Limit to 3 suggestions\n        ;\n    }\n    /**\n   * Formats conversation history for external engines\n   */ static formatConversationHistory(context) {\n        return context.conversationFlow.slice(-10) // Last 10 turns\n        .map((turn)=>({\n                role: turn.role,\n                content: turn.content\n            }));\n    }\n    /**\n   * Maintains context memory by cleaning old data\n   */ static maintainContextMemory(context) {\n        // Keep only recent turns\n        if (context.conversationFlow.length > this.MAX_TURNS_RETAINED) {\n            context.conversationFlow = context.conversationFlow.slice(-this.MAX_TURNS_RETAINED);\n        }\n        // Clean old references\n        const cutoffTime = new Date(Date.now() - 12 * 60 * 60 * 1000) // 12 hours\n        ;\n        context.referenceMemory = context.referenceMemory.filter((ref)=>ref.timestamp > cutoffTime);\n        // Clean old intentions\n        if (context.activeIntentions.length > 3) {\n            context.activeIntentions = context.activeIntentions.slice(-3);\n        }\n    }\n    /**\n   * Gets conversation statistics using persistent storage\n   */ static getConversationStats(userId) {\n        const { getUserActiveSessions } = __webpack_require__(/*! ./temp-storage */ \"(rsc)/./src/lib/temp-storage.ts\");\n        if (userId) {\n            const userSessions = getUserActiveSessions(userId);\n            return {\n                activeContexts: userSessions.length,\n                totalTurns: userSessions.reduce((sum, session)=>sum + session.turns.length, 0),\n                currentTopics: [\n                    ...new Set(userSessions.map((session)=>session.currentTopic).filter(Boolean))\n                ],\n                currentSubjects: [\n                    ...new Set(userSessions.map((session)=>session.currentSubject).filter(Boolean))\n                ]\n            };\n        }\n        // For global stats, we need to import the conversations array\n        const { tempConversations } = __webpack_require__(/*! ./temp-storage */ \"(rsc)/./src/lib/temp-storage.ts\");\n        const activeConversations = tempConversations.filter((session)=>{\n            const oneHourAgo = new Date(Date.now() - 60 * 60 * 1000);\n            return session.lastUpdate > oneHourAgo;\n        });\n        return {\n            totalActiveContexts: activeConversations.length,\n            totalUsers: new Set(activeConversations.map((session)=>session.userId)).size,\n            averageContextAge: this.calculateAverageContextAgeFromSessions(activeConversations)\n        };\n    }\n    /**\n   * Calculates average context age from persistent sessions\n   */ static calculateAverageContextAgeFromSessions(sessions) {\n        if (sessions.length === 0) return 0;\n        const now = Date.now();\n        const totalAge = sessions.reduce((sum, session)=>sum + (now - new Date(session.lastUpdate).getTime()), 0);\n        return Math.round(totalAge / sessions.length / (60 * 1000)) // Average age in minutes\n        ;\n    }\n    /**\n   * Forces cleanup of all contexts (useful for testing)\n   */ static clearAllContexts() {\n        const { cleanupOldConversations } = __webpack_require__(/*! ./temp-storage */ \"(rsc)/./src/lib/temp-storage.ts\");\n        cleanupOldConversations();\n        console.log('🧹 All conversation contexts cleared using persistent storage');\n    }\n    /**\n   * Gets active context for user (useful for debugging)\n   */ static getActiveContext(userId, sessionId) {\n        const { getConversationSession, getUserActiveSessions } = __webpack_require__(/*! ./temp-storage */ \"(rsc)/./src/lib/temp-storage.ts\");\n        if (sessionId) {\n            const session = getConversationSession(userId, sessionId);\n            if (session) {\n                return {\n                    userId: session.userId,\n                    sessionId: session.sessionId,\n                    currentTopic: session.currentTopic,\n                    currentSubject: session.currentSubject,\n                    conversationFlow: session.turns,\n                    contextSummary: this.buildContextSummary(session),\n                    activeIntentions: this.extractActiveIntentions(session.turns.slice(-5)),\n                    pendingQuestions: [],\n                    referenceMemory: this.buildReferenceMemory(session.turns),\n                    lastUpdate: session.lastUpdate\n                };\n            }\n        }\n        // Find any active session for user\n        const activeSessions = getUserActiveSessions(userId);\n        if (activeSessions.length > 0) {\n            const session = activeSessions[0];\n            return {\n                userId: session.userId,\n                sessionId: session.sessionId,\n                currentTopic: session.currentTopic,\n                currentSubject: session.currentSubject,\n                conversationFlow: session.turns,\n                contextSummary: this.buildContextSummary(session),\n                activeIntentions: this.extractActiveIntentions(session.turns.slice(-5)),\n                pendingQuestions: [],\n                referenceMemory: this.buildReferenceMemory(session.turns),\n                lastUpdate: session.lastUpdate\n            };\n        }\n        return null;\n    }\n} // Persistent storage cleanup is handled by temp-storage.ts\n // No need for additional cleanup intervals\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvbGliL2NvbnRleHR1YWwtY29udmVyc2F0aW9uLW1hbmFnZXIudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUFBLDhDQUE4QztBQUM5QyxxRUFBcUU7QUFHUTtBQUNkO0FBRWdDO0FBb0R4RixNQUFNRzs7UUFFWCx1REFBdUQ7YUFDL0JDLHFCQUFxQjs7O2FBQ3JCQyxpQkFBaUI7OzthQUNqQkMsc0JBQXNCOztJQUU5Qzs7R0FFQyxHQUNELGFBQWFDLHlCQUNYQyxNQUFjLEVBQ2RDLE9BQWUsRUFDZkMsU0FBa0IsRUFDbEJDLFFBQWlCLEVBQ1k7UUFFN0IsTUFBTUMsa0JBQWtCRixhQUFhLENBQUMsUUFBUSxFQUFFRixPQUFPLENBQUMsRUFBRUssS0FBS0MsR0FBRyxJQUFJO1FBRXRFLHNDQUFzQztRQUN0QyxNQUFNLEVBQ0pDLHNCQUFzQixFQUN0QkMseUJBQXlCLEVBQ3pCQyxtQkFBbUIsRUFDbkJDLGNBQWMsRUFDZEMsZUFBZSxFQUNoQixHQUFHQyxtQkFBT0EsQ0FBQyx1REFBZ0I7UUFFNUIsZ0RBQWdEO1FBQ2hELElBQUlDLFVBQVVOLHVCQUF1QlAsUUFBUUk7UUFDN0MsSUFBSSxDQUFDUyxTQUFTO1lBQ1pBLFVBQVVMLDBCQUEwQlIsUUFBUUk7UUFDOUM7UUFFQVUsUUFBUUMsR0FBRyxDQUFDLENBQUMsa0NBQWtDLEVBQUVYLGdCQUFnQixHQUFHLEVBQUVILFFBQVFlLFNBQVMsQ0FBQyxHQUFHLElBQUksSUFBSSxDQUFDO1FBQ3BHRixRQUFRQyxHQUFHLENBQUMsQ0FBQyxlQUFlLEVBQUVGLFFBQVFJLEtBQUssQ0FBQ0MsTUFBTSxDQUFDLGlCQUFpQixFQUFFTCxRQUFRTSxZQUFZLENBQUNDLE1BQU0sQ0FBQ0MsQ0FBQUEsSUFBSyxDQUFDQSxFQUFFQyxTQUFTLEVBQUVKLE1BQU0sQ0FBQyxjQUFjLENBQUM7UUFFM0ksMkJBQTJCO1FBQzNCLE1BQU1LLGtCQUFrQixJQUFJLENBQUNDLHNCQUFzQixDQUFDdkI7UUFFcEQsc0NBQXNDO1FB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QyxrQkFBa0IsRUFBRTtvQkFDcEJDLGlCQUFpQixJQUFJLENBQUNDLG9CQUFvQixDQUFDOUIsUUFBUUksS0FBSztvQkFDeEQyQixZQUFZL0IsUUFBUStCLFVBQVU7Z0JBQ2hDO1lBQ0Y7UUFDRjtRQUVBLG1DQUFtQztRQUNuQyxNQUFNOEgsaUJBQWlCdkIsc0JBQXNCbko7UUFDN0MsSUFBSTBLLGVBQWV4SixNQUFNLEdBQUcsR0FBRztZQUM3QixNQUFNTCxVQUFVNkosY0FBYyxDQUFDLEVBQUU7WUFDakMsT0FBTztnQkFDTDFLLFFBQVFhLFFBQVFiLE1BQU07Z0JBQ3RCRSxXQUFXVyxRQUFRWCxTQUFTO2dCQUM1QndCLGNBQWNiLFFBQVFhLFlBQVk7Z0JBQ2xDQyxnQkFBZ0JkLFFBQVFjLGNBQWM7Z0JBQ3RDQyxrQkFBa0JmLFFBQVFJLEtBQUs7Z0JBQy9CbUIsZ0JBQWdCLElBQUksQ0FBQ0MsbUJBQW1CLENBQUN4QjtnQkFDekN5QixrQkFBa0IsSUFBSSxDQUFDQyx1QkFBdUIsQ0FBQzFCLFFBQVFJLEtBQUssQ0FBQ3VCLEtBQUssQ0FBQyxDQUFDO2dCQUNwRUMsa0JBQWtCLEVBQUU7Z0JBQ3BCQyxpQkFBaUIsSUFBSSxDQUFDQyxvQkFBb0IsQ0FBQzlCLFFBQVFJLEtBQUs7Z0JBQ3hEMkIsWUFBWS9CLFFBQVErQixVQUFVO1lBQ2hDO1FBQ0Y7UUFFQSxPQUFPO0lBQ1Q7QUFDRixFQUVBLDJEQUEyRDtDQUMzRCwyQ0FBMkMiLCJzb3VyY2VzIjpbIi9Vc2Vycy9yb2RyaWdvZGliZXJuYXJkbzMzZ21haWwuY29tL0RvY3VtZW50cy9BcHAgRGV2ZWxvcG1lbnQgUHJveWVjdHMvSW50ZWxsZWdvIFBsYXRmb3JtL3NyYy9saWIvY29udGV4dHVhbC1jb252ZXJzYXRpb24tbWFuYWdlci50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb250ZXh0dWFsIENvbnZlcnNhdGlvbiBNYW5hZ2VyIGZvciBTYXJhIEFJXG4vLyBQcm92aWRlcyBpbnRlbGxpZ2VudCBjb250ZXh0IG1hbmFnZW1lbnQgYW5kIGNvbnZlcnNhdGlvbiBjb2hlcmVuY2VcblxuaW1wb3J0IHsgQ29udmVyc2F0aW9uTWVtb3J5TWFuYWdlciB9IGZyb20gJy4vY29udmVyc2F0aW9uLW1lbW9yeSdcbmltcG9ydCB7IEFkdmFuY2VkTGVhcm5pbmdQcm9maWxlTWFuYWdlciB9IGZyb20gJy4vYWR2YW5jZWQtbGVhcm5pbmctcHJvZmlsZXMnXG5pbXBvcnQgeyBWaXN1YWxMZWFybmluZ0VuZ2luZSB9IGZyb20gJy4vdmlzdWFsLWxlYXJuaW5nLWVuZ2luZSdcbmltcG9ydCB7IEFjYWRlbWljU2VhcmNoRW5naW5lIH0gZnJvbSAnLi9hY2FkZW1pYy1zZWFyY2gtZW5naW5lJ1xuaW1wb3J0IHsgQUlDYWxlbmRhckludGVncmF0aW9uLCBhbmFseXplQ29udmVyc2F0aW9uRm9yRXZlbnRzIH0gZnJvbSAnLi9jYWxlbmRhci1haS1pbnRlZ3JhdGlvbidcblxuZXhwb3J0IGludGVyZmFjZSBDb252ZXJzYXRpb25Db250ZXh0IHtcbiAgdXNlcklkOiBzdHJpbmdcbiAgc2Vzc2lvbklkOiBzdHJpbmdcbiAgY3VycmVudFRvcGljPzogc3RyaW5nXG4gIGN1cnJlbnRTdWJqZWN0Pzogc3RyaW5nXG4gIGNvbnZlcnNhdGlvbkZsb3c6IENvbnZlcnNhdGlvblR1cm5bXVxuICBjb250ZXh0U3VtbWFyeTogc3RyaW5nXG4gIGFjdGl2ZUludGVudGlvbnM6IHN0cmluZ1tdXG4gIHBlbmRpbmdRdWVzdGlvbnM6IHN0cmluZ1tdXG4gIHJlZmVyZW5jZU1lbW9yeTogQ29udGV4dFJlZmVyZW5jZVtdXG4gIGxhc3RVcGRhdGU6IERhdGVcbn1cblxuZXhwb3J0IGludGVyZmFjZSBDb252ZXJzYXRpb25UdXJuIHtcbiAgaWQ6IHN0cmluZ1xuICB0aW1lc3RhbXA6IERhdGVcbiAgcm9sZTogJ3VzZXInIHwgJ2Fzc2lzdGFudCdcbiAgY29udGVudDogc3RyaW5nXG4gIG1ldGFkYXRhOiB7XG4gICAgc3ViamVjdD86IHN0cmluZ1xuICAgIHRvcGljPzogc3RyaW5nXG4gICAgaW50ZW50aW9uPzogc3RyaW5nXG4gICAgZW1vdGlvbj86IHN0cmluZ1xuICAgIGNvbmZpZGVuY2U/OiBudW1iZXJcbiAgICB2aXN1YWxzR2VuZXJhdGVkPzogYm9vbGVhblxuICAgIHNlYXJjaFBlcmZvcm1lZD86IGJvb2xlYW5cbiAgfVxufVxuXG5leHBvcnQgaW50ZXJmYWNlIENvbnRleHRSZWZlcmVuY2Uge1xuICBpZDogc3RyaW5nXG4gIHR5cGU6ICd0b3BpY19jb250aW51YXRpb24nIHwgJ3N1YmplY3RfcmVmZXJlbmNlJyB8ICdwcm9ibGVtX3NvbHZpbmcnIHwgJ2V4cGxhbmF0aW9uX2ZvbGxvd3VwJ1xuICBjb250ZW50OiBzdHJpbmdcbiAgcmVsZXZhbmNlU2NvcmU6IG51bWJlclxuICB0dXJuSW5kZXg6IG51bWJlclxuICB0aW1lc3RhbXA6IERhdGVcbn1cblxuZXhwb3J0IGludGVyZmFjZSBDb250ZXh0dWFsUmVzcG9uc2Uge1xuICBjb250ZW50OiBzdHJpbmdcbiAgY29udGV4dDogQ29udmVyc2F0aW9uQ29udGV4dFxuICBjb250aW51aXR5U2NvcmU6IG51bWJlclxuICBwZXJzb25hbGl6YXRpb25zOiBzdHJpbmdbXVxuICBzdWdnZXN0ZWRGb2xsb3d1cHM6IHN0cmluZ1tdXG4gIHZpc3VhbFJlY29tbWVuZGF0aW9uPzoge1xuICAgIHR5cGU6IHN0cmluZ1xuICAgIHJlYXNvbjogc3RyaW5nXG4gIH1cbn1cblxuZXhwb3J0IGNsYXNzIENvbnRleHR1YWxDb252ZXJzYXRpb25NYW5hZ2VyIHtcbiAgXG4gIC8vIENvbmZpZ3VyYXRpb24gZm9yIHBlcnNpc3RlbnQgY29udmVyc2F0aW9uIG1hbmFnZW1lbnRcbiAgcHJpdmF0ZSBzdGF0aWMgcmVhZG9ubHkgTUFYX1RVUk5TX1JFVEFJTkVEID0gMjBcbiAgcHJpdmF0ZSBzdGF0aWMgcmVhZG9ubHkgTUFYX1JFRkVSRU5DRVMgPSAxMFxuICBwcml2YXRlIHN0YXRpYyByZWFkb25seSBDT05URVhUX0RFQ0FZX0hPVVJTID0gMjRcblxuICAvKipcbiAgICogUHJvY2Vzc2VzIHVzZXIgbWVzc2FnZSB3aXRoIGZ1bGwgY29udGV4dHVhbCBhd2FyZW5lc3NcbiAgICovXG4gIHN0YXRpYyBhc3luYyBwcm9jZXNzQ29udGV4dHVhbE1lc3NhZ2UoXG4gICAgdXNlcklkOiBzdHJpbmcsIFxuICAgIG1lc3NhZ2U6IHN0cmluZywgXG4gICAgc2Vzc2lvbklkPzogc3RyaW5nLFxuICAgIHVzZXJOYW1lPzogc3RyaW5nXG4gICk6IFByb21pc2U8Q29udGV4dHVhbFJlc3BvbnNlPiB7XG4gICAgXG4gICAgY29uc3QgYWN0dWFsU2Vzc2lvbklkID0gc2Vzc2lvbklkIHx8IGBzZXNzaW9uXyR7dXNlcklkfV8ke0RhdGUubm93KCl9YFxuICAgIFxuICAgIC8vIEltcG9ydCBwZXJzaXN0ZW50IHN0b3JhZ2UgZnVuY3Rpb25zXG4gICAgY29uc3QgeyBcbiAgICAgIGdldENvbnZlcnNhdGlvblNlc3Npb24sIFxuICAgICAgY3JlYXRlQ29udmVyc2F0aW9uU2Vzc2lvbiwgXG4gICAgICBhZGRDb252ZXJzYXRpb25UdXJuLCBcbiAgICAgIGFkZFBlbmRpbmdUYXNrLFxuICAgICAgZ2V0UGVuZGluZ1Rhc2tzIFxuICAgIH0gPSByZXF1aXJlKCcuL3RlbXAtc3RvcmFnZScpXG4gICAgXG4gICAgLy8gR2V0IG9yIGNyZWF0ZSBwZXJzaXN0ZW50IGNvbnZlcnNhdGlvbiBzZXNzaW9uXG4gICAgbGV0IHNlc3Npb24gPSBnZXRDb252ZXJzYXRpb25TZXNzaW9uKHVzZXJJZCwgYWN0dWFsU2Vzc2lvbklkKVxuICAgIGlmICghc2Vzc2lvbikge1xuICAgICAgc2Vzc2lvbiA9IGNyZWF0ZUNvbnZlcnNhdGlvblNlc3Npb24odXNlcklkLCBhY3R1YWxTZXNzaW9uSWQpXG4gICAgfVxuICAgIFxuICAgIGNvbnNvbGUubG9nKGDwn5KsIFByb2Nlc3NpbmcgbWVzc2FnZSBmb3Igc2Vzc2lvbiAke2FjdHVhbFNlc3Npb25JZH06IFwiJHttZXNzYWdlLnN1YnN0cmluZygwLCA1MCl9Li4uXCJgKVxuICAgIGNvbnNvbGUubG9nKGDwn5OKIFNlc3Npb24gaGFzICR7c2Vzc2lvbi50dXJucy5sZW5ndGh9IHByZXZpb3VzIHR1cm5zLCAke3Nlc3Npb24ucGVuZGluZ1Rhc2tzLmZpbHRlcih0ID0+ICF0LmNvbXBsZXRlZCkubGVuZ3RofSBwZW5kaW5nIHRhc2tzYClcbiAgICBcbiAgICAvLyBBbmFseXplIG1lc3NhZ2UgbWV0YWRhdGFcbiAgICBjb25zdCBtZXNzYWdlTWV0YWRhdGEgPSB0aGlzLmFuYWx5emVNZXNzYWdlTWV0YWRhdGEobWVzc2FnZSlcbiAgICBcbiAgICAvLyBBZGQgdXNlciB0dXJuIHRvIHBlcnNpc3RlbnQgc3RvcmFnZVxuICAgIHNlc3Npb24gPSBhZGRDb252ZXJzYXRpb25UdXJuKHVzZXJJZCwgYWN0dWFsU2Vzc2lvbklkLCAndXNlcicsIG1lc3NhZ2UsIG1lc3NhZ2VNZXRhZGF0YSlcbiAgICBcbiAgICAvLyBDaGVjayBmb3IgcGVuZGluZyB0YXNrcyB0aGF0IG1pZ2h0IHJlbGF0ZSB0byB0aGlzIG1lc3NhZ2VcbiAgICBjb25zdCBwZW5kaW5nVGFza3MgPSBnZXRQZW5kaW5nVGFza3ModXNlcklkLCBhY3R1YWxTZXNzaW9uSWQpXG4gICAgXG4gICAgLy8gQnVpbGQgY29udGV4dCBmcm9tIHBlcnNpc3RlbnQgZGF0YVxuICAgIGNvbnN0IGNvbnRleHQ6IENvbnZlcnNhdGlvbkNvbnRleHQgPSB7XG4gICAgICB1c2VySWQsXG4gICAgICBzZXNzaW9uSWQ6IGFjdHVhbFNlc3Npb25JZCxcbiAgICAgIGN1cnJlbnRUb3BpYzogc2Vzc2lvbi5jdXJyZW50VG9waWMsXG4gICAgICBjdXJyZW50U3ViamVjdDogc2Vzc2lvbi5jdXJyZW50U3ViamVjdCxcbiAgICAgIGNvbnZlcnNhdGlvbkZsb3c6IHNlc3Npb24udHVybnMubWFwKHR1cm4gPT4gKHtcbiAgICAgICAgaWQ6IHR1cm4uaWQsXG4gICAgICAgIHRpbWVzdGFtcDogdHVybi50aW1lc3RhbXAsXG4gICAgICAgIHJvbGU6IHR1cm4ucm9sZSxcbiAgICAgICAgY29udGVudDogdHVybi5jb250ZW50LFxuICAgICAgICBtZXRhZGF0YTogdHVybi5tZXRhZGF0YVxuICAgICAgfSkpLFxuICAgICAgY29udGV4dFN1bW1hcnk6IHRoaXMuYnVpbGRDb250ZXh0U3VtbWFyeShzZXNzaW9uKSxcbiAgICAgIGFjdGl2ZUludGVudGlvbnM6IHRoaXMuZXh0cmFjdEFjdGl2ZUludGVudGlvbnMoc2Vzc2lvbi50dXJucy5zbGljZSgtNSkpLFxuICAgICAgcGVuZGluZ1F1ZXN0aW9uczogW10sXG4gICAgICByZWZlcmVuY2VNZW1vcnk6IHRoaXMuYnVpbGRSZWZlcmVuY2VNZW1vcnkoc2Vzc2lvbi50dXJucyksXG4gICAgICBsYXN0VXBkYXRlOiBuZXcgRGF0ZSgpXG4gICAgfVxuICAgIFxuICAgIC8vIEdlbmVyYXRlIGNvbnRleHR1YWxseSBhd2FyZSByZXNwb25zZVxuICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgdGhpcy5nZW5lcmF0ZUNvbnRleHR1YWxSZXNwb25zZShjb250ZXh0LCB1c2VyTmFtZSwgcGVuZGluZ1Rhc2tzKVxuICAgIFxuICAgIC8vIEFkZCBhc3Npc3RhbnQgdHVybiB0byBwZXJzaXN0ZW50IHN0b3JhZ2VcbiAgICBjb25zdCBhc3Npc3RhbnRNZXRhZGF0YSA9IHtcbiAgICAgIGNvbmZpZGVuY2U6IHJlc3BvbnNlLmNvbnRpbnVpdHlTY29yZSxcbiAgICAgIHZpc3VhbHNHZW5lcmF0ZWQ6ICEhcmVzcG9uc2UudmlzdWFsUmVjb21tZW5kYXRpb24sXG4gICAgICBzZWFyY2hQZXJmb3JtZWQ6IHJlc3BvbnNlLnBlcnNvbmFsaXphdGlvbnMuaW5jbHVkZXMoJ2FjYWRlbWljX3NlYXJjaCcpLFxuICAgICAgdGFza0NvbXBsZXRlZDogcmVzcG9uc2UucGVyc29uYWxpemF0aW9ucy5pbmNsdWRlcygndGFza19jb21wbGV0ZWQnKVxuICAgIH1cbiAgICBcbiAgICBhZGRDb252ZXJzYXRpb25UdXJuKHVzZXJJZCwgYWN0dWFsU2Vzc2lvbklkLCAnYXNzaXN0YW50JywgcmVzcG9uc2UuY29udGVudCwgYXNzaXN0YW50TWV0YWRhdGEpXG4gICAgXG4gICAgcmV0dXJuIHJlc3BvbnNlXG4gIH1cblxuICAvKipcbiAgICogQnVpbGQgY29udGV4dCBzdW1tYXJ5IGZyb20gcGVyc2lzdGVudCBjb252ZXJzYXRpb24gZGF0YVxuICAgKi9cbiAgcHJpdmF0ZSBzdGF0aWMgYnVpbGRDb250ZXh0U3VtbWFyeShzZXNzaW9uOiBhbnkpOiBzdHJpbmcge1xuICAgIGNvbnN0IHJlY2VudFR1cm5zID0gc2Vzc2lvbi50dXJucy5zbGljZSgtNilcbiAgICBjb25zdCBrZXlUb3BpY3MgPSBbLi4ubmV3IFNldChyZWNlbnRUdXJuc1xuICAgICAgLm1hcCgodHVybjogYW55KSA9PiB0dXJuLm1ldGFkYXRhLnRvcGljKVxuICAgICAgLmZpbHRlcihCb29sZWFuKSldXG4gICAgXG4gICAgY29uc3Qga2V5U3ViamVjdHMgPSBbLi4ubmV3IFNldChyZWNlbnRUdXJuc1xuICAgICAgLm1hcCgodHVybjogYW55KSA9PiB0dXJuLm1ldGFkYXRhLnN1YmplY3QpXG4gICAgICAuZmlsdGVyKEJvb2xlYW4pKV1cbiAgICBcbiAgICBjb25zdCBzdW1tYXJ5UGFydHM6IHN0cmluZ1tdID0gW11cbiAgICBcbiAgICBpZiAoa2V5U3ViamVjdHMubGVuZ3RoID4gMCkge1xuICAgICAgc3VtbWFyeVBhcnRzLnB1c2goYE1hdGVyaWFzOiAke2tleVN1YmplY3RzLmpvaW4oJywgJyl9YClcbiAgICB9XG4gICAgXG4gICAgaWYgKGtleVRvcGljcy5sZW5ndGggPiAwKSB7XG4gICAgICBzdW1tYXJ5UGFydHMucHVzaChgVGVtYXM6ICR7a2V5VG9waWNzLmpvaW4oJywgJyl9YClcbiAgICB9XG4gICAgXG4gICAgcmV0dXJuIHN1bW1hcnlQYXJ0cy5qb2luKCcgfCAnKSB8fCAnQ29udmVyc2FjacOzbiBnZW5lcmFsJ1xuICB9XG5cbiAgLyoqXG4gICAqIEV4dHJhY3QgYWN0aXZlIGludGVudGlvbnMgZnJvbSByZWNlbnQgY29udmVyc2F0aW9uIHR1cm5zXG4gICAqL1xuICBwcml2YXRlIHN0YXRpYyBleHRyYWN0QWN0aXZlSW50ZW50aW9ucyhyZWNlbnRUdXJuczogYW55W10pOiBzdHJpbmdbXSB7XG4gICAgY29uc3QgaW50ZW50aW9ucyA9IHJlY2VudFR1cm5zXG4gICAgICAubWFwKCh0dXJuOiBhbnkpID0+IHR1cm4ubWV0YWRhdGEuaW50ZW50aW9uKVxuICAgICAgLmZpbHRlcihCb29sZWFuKVxuICAgICAgLnNsaWNlKC0zKVxuICAgIFxuICAgIHJldHVybiBbLi4ubmV3IFNldChpbnRlbnRpb25zKV1cbiAgfVxuXG4gIC8qKlxuICAgKiBCdWlsZCByZWZlcmVuY2UgbWVtb3J5IGZyb20gY29udmVyc2F0aW9uIHR1cm5zXG4gICAqL1xuICBwcml2YXRlIHN0YXRpYyBidWlsZFJlZmVyZW5jZU1lbW9yeSh0dXJuczogYW55W10pOiBDb250ZXh0UmVmZXJlbmNlW10ge1xuICAgIGNvbnN0IHJlZmVyZW5jZXM6IENvbnRleHRSZWZlcmVuY2VbXSA9IFtdXG4gICAgY29uc3QgcmVjZW50VHVybnMgPSB0dXJucy5zbGljZSgtMTApXG4gICAgXG4gICAgcmVjZW50VHVybnMuZm9yRWFjaCgodHVybiwgaW5kZXgpID0+IHtcbiAgICAgIGlmICh0dXJuLm1ldGFkYXRhLmNvbmZpZGVuY2UgJiYgdHVybi5tZXRhZGF0YS5jb25maWRlbmNlID4gMC43KSB7XG4gICAgICAgIHJlZmVyZW5jZXMucHVzaCh7XG4gICAgICAgICAgaWQ6IGByZWZfJHt0dXJuLmlkfWAsXG4gICAgICAgICAgdHlwZTogdGhpcy5kZXRlcm1pbmVSZWZlcmVuY2VUeXBlRnJvbU1ldGFkYXRhKHR1cm4ubWV0YWRhdGEpLFxuICAgICAgICAgIGNvbnRlbnQ6IHR1cm4uY29udGVudC5zdWJzdHJpbmcoMCwgMTAwKSArICcuLi4nLFxuICAgICAgICAgIHJlbGV2YW5jZVNjb3JlOiB0dXJuLm1ldGFkYXRhLmNvbmZpZGVuY2UsXG4gICAgICAgICAgdHVybkluZGV4OiBpbmRleCxcbiAgICAgICAgICB0aW1lc3RhbXA6IHR1cm4udGltZXN0YW1wXG4gICAgICAgIH0pXG4gICAgICB9XG4gICAgfSlcbiAgICBcbiAgICByZXR1cm4gcmVmZXJlbmNlcy5zbGljZSgtNSkgLy8gS2VlcCBvbmx5IGxhc3QgNSByZWZlcmVuY2VzXG4gIH1cblxuICAvKipcbiAgICogSGVscGVyIHRvIGRldGVybWluZSByZWZlcmVuY2UgdHlwZSBmcm9tIG1ldGFkYXRhXG4gICAqL1xuICBwcml2YXRlIHN0YXRpYyBkZXRlcm1pbmVSZWZlcmVuY2VUeXBlRnJvbU1ldGFkYXRhKG1ldGFkYXRhOiBhbnkpOiBDb250ZXh0UmVmZXJlbmNlWyd0eXBlJ10ge1xuICAgIGlmIChtZXRhZGF0YS5pbnRlbnRpb24gPT09ICdjb250aW51YXRpb24nKSByZXR1cm4gJ3RvcGljX2NvbnRpbnVhdGlvbidcbiAgICBpZiAobWV0YWRhdGEuaW50ZW50aW9uID09PSAncHJvYmxlbV9zb2x2aW5nJykgcmV0dXJuICdwcm9ibGVtX3NvbHZpbmcnXG4gICAgaWYgKG1ldGFkYXRhLmludGVudGlvbiA9PT0gJ2V4cGxhbmF0aW9uJykgcmV0dXJuICdleHBsYW5hdGlvbl9mb2xsb3d1cCdcbiAgICByZXR1cm4gJ3N1YmplY3RfcmVmZXJlbmNlJ1xuICB9XG5cbiAgLyoqXG4gICAqIEhhbmRsZXMgY2FsZW5kYXIgdGFzayBleGVjdXRpb24gd2l0aCByZWFsIGV2ZW50IGNyZWF0aW9uXG4gICAqL1xuICBwcml2YXRlIHN0YXRpYyBhc3luYyBoYW5kbGVDYWxlbmRhclRhc2tzKFxuICAgIHVzZXJJZDogc3RyaW5nLFxuICAgIG1lc3NhZ2U6IHN0cmluZyxcbiAgICBjb252ZXJzYXRpb25IaXN0b3J5OiBBcnJheTx7IHJvbGU6ICd1c2VyJyB8ICdhc3Npc3RhbnQnLCBjb250ZW50OiBzdHJpbmcgfT4sXG4gICAgcGVuZGluZ1Rhc2tzOiBhbnlbXVxuICApOiBQcm9taXNlPHsgdHlwZTogc3RyaW5nOyBjb250ZW50OiBzdHJpbmc7IG1ldGFkYXRhPzogYW55IH0gfCBudWxsPiB7XG4gICAgXG4gICAgY29uc29sZS5sb2coYPCflI0gQ2hlY2tpbmcgZm9yIGNhbGVuZGFyIHRhc2tzIGluIG1lc3NhZ2U6IFwiJHttZXNzYWdlLnN1YnN0cmluZygwLCA1MCl9Li4uXCJgKVxuICAgIFxuICAgIC8vIEluaXRpYWxpemUgY2FsZW5kYXIgaW50ZWdyYXRpb25cbiAgICBjb25zdCBjYWxlbmRhckludGVncmF0aW9uID0gbmV3IEFJQ2FsZW5kYXJJbnRlZ3JhdGlvbih1c2VySWQpXG4gICAgXG4gICAgLy8gQW5hbHl6ZSBtZXNzYWdlIGZvciBjYWxlbmRhciBldmVudHNcbiAgICBjb25zdCBjYWxlbmRhclJlc3VsdCA9IGF3YWl0IGNhbGVuZGFySW50ZWdyYXRpb24ucHJvY2Vzc01lc3NhZ2UobWVzc2FnZSwgY29udmVyc2F0aW9uSGlzdG9yeSlcbiAgICBcbiAgICBpZiAoY2FsZW5kYXJSZXN1bHQubmVlZHNFdmVudENyZWF0aW9uKSB7XG4gICAgICBjb25zb2xlLmxvZyhg8J+OryBDYWxlbmRhciB0YXNrIGRldGVjdGVkIGFuZCBleGVjdXRlZCFgKVxuICAgICAgXG4gICAgICAvLyBNYXJrIGFueSByZWxhdGVkIHBlbmRpbmcgdGFzayBhcyBjb21wbGV0ZWRcbiAgICAgIGlmIChwZW5kaW5nVGFza3MubGVuZ3RoID4gMCkge1xuICAgICAgICBjb25zdCBjYWxlbmRhclRhc2sgPSBwZW5kaW5nVGFza3MuZmluZCh0ID0+IHQudHlwZSA9PT0gJ2NhbGVuZGFyX2V2ZW50JylcbiAgICAgICAgaWYgKGNhbGVuZGFyVGFzaykge1xuICAgICAgICAgIGNvbnN0IHsgbWFya1Rhc2tDb21wbGV0ZWQgfSA9IHJlcXVpcmUoJy4vdGVtcC1zdG9yYWdlJylcbiAgICAgICAgICBtYXJrVGFza0NvbXBsZXRlZCh1c2VySWQsICdjdXJyZW50LXNlc3Npb24nLCBjYWxlbmRhclRhc2suaWQsIGNhbGVuZGFyUmVzdWx0KVxuICAgICAgICB9XG4gICAgICB9XG4gICAgICBcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHR5cGU6ICdjYWxlbmRhcl9ldmVudF9jcmVhdGlvbicsXG4gICAgICAgIGNvbnRlbnQ6IGNhbGVuZGFyUmVzdWx0LnJlc3BvbnNlIHx8ICdFdmVudG8gY3JlYWRvIGV4aXRvc2FtZW50ZScsXG4gICAgICAgIG1ldGFkYXRhOiB7XG4gICAgICAgICAgc3VnZ2VzdGVkQWN0aW9uczogY2FsZW5kYXJSZXN1bHQuZXZlbnQgXG4gICAgICAgICAgICA/IFsnVmVyIGVuIGNhbGVuZGFyaW8nLCAnRWRpdGFyIGV2ZW50bycsICdFbGltaW5hciBldmVudG8nXVxuICAgICAgICAgICAgOiBbJ1JlaW50ZW50YXInLCAnUHJvcG9yY2lvbmFyIG3DoXMgZGV0YWxsZXMnXSxcbiAgICAgICAgICBldmVudENyZWF0ZWQ6ICEhY2FsZW5kYXJSZXN1bHQuZXZlbnRcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICBcbiAgICByZXR1cm4gbnVsbFxuICB9XG5cbiAgLyoqXG4gICAqIEJ1aWxkcyBlZHVjYXRpb25hbCBwcm9tcHQgYmFzZWQgb24gY29udmVyc2F0aW9uIGNvbnRleHRcbiAgICovXG4gIHByaXZhdGUgc3RhdGljIGJ1aWxkRWR1Y2F0aW9uYWxQcm9tcHQoXG4gICAgY29udGV4dDogQ29udmVyc2F0aW9uQ29udGV4dCxcbiAgICBtZXNzYWdlOiBzdHJpbmcsXG4gICAgdXNlck5hbWU/OiBzdHJpbmdcbiAgKTogc3RyaW5nIHtcbiAgICBjb25zdCByZWNlbnRUdXJucyA9IGNvbnRleHQuY29udmVyc2F0aW9uRmxvdy5zbGljZSgtMylcbiAgICBjb25zdCBjb252ZXJzYXRpb25Db250ZXh0ID0gcmVjZW50VHVybnNcbiAgICAgIC5tYXAodHVybiA9PiBgJHt0dXJuLnJvbGUgPT09ICd1c2VyJyA/ICdFc3R1ZGlhbnRlJyA6ICdUdXRvcid9OiAke3R1cm4uY29udGVudH1gKVxuICAgICAgLmpvaW4oJ1xcbicpXG4gICAgXG4gICAgbGV0IHByb21wdCA9IGBFcmVzIFNhcmEsIHVuYSB0dXRvcmEgZGUgSUEgZXNwZWNpYWxpemFkYSBlbiBlZHVjYWNpw7NuIHNlY3VuZGFyaWEuIGBcbiAgICBcbiAgICBpZiAodXNlck5hbWUpIHtcbiAgICAgIHByb21wdCArPSBgRWwgZXN0dWRpYW50ZSBzZSBsbGFtYSAke3VzZXJOYW1lfS4gYFxuICAgIH1cbiAgICBcbiAgICBpZiAoY29udGV4dC5jdXJyZW50U3ViamVjdCkge1xuICAgICAgcHJvbXB0ICs9IGBBY3R1YWxtZW50ZSBlc3TDoXMgYXl1ZGFuZG8gY29uICR7Y29udGV4dC5jdXJyZW50U3ViamVjdH0uIGBcbiAgICB9XG4gICAgXG4gICAgaWYgKGNvbnRleHQuY29udGV4dFN1bW1hcnkgJiYgY29udGV4dC5jb250ZXh0U3VtbWFyeSAhPT0gJ0NvbnZlcnNhY2nDs24gZ2VuZXJhbCcpIHtcbiAgICAgIHByb21wdCArPSBgQ29udGV4dG8gZGUgbGEgY29udmVyc2FjacOzbjogJHtjb250ZXh0LmNvbnRleHRTdW1tYXJ5fS4gYFxuICAgIH1cbiAgICBcbiAgICBwcm9tcHQgKz0gYFxcblxcbkNvbnZlcnNhY2nDs24gcmVjaWVudGU6XFxuJHtjb252ZXJzYXRpb25Db250ZXh0fWBcbiAgICBwcm9tcHQgKz0gYFxcblxcbk51ZXZvIG1lbnNhamUgZGVsIGVzdHVkaWFudGU6IFwiJHttZXNzYWdlfVwiYFxuICAgIFxuICAgIHByb21wdCArPSBgXFxuXFxuSW5zdHJ1Y2Npb25lczpcXG5gXG4gICAgcHJvbXB0ICs9IGAtIFJlc3BvbmRlIGNvbW8gU2FyYSwgbGEgdHV0b3JhIGRlIElBIGFtaWdhYmxlIHkgZXhwZXJ0YVxcbmBcbiAgICBwcm9tcHQgKz0gYC0gTWFudMOpbiBjb2hlcmVuY2lhIGNvbiBsYSBjb252ZXJzYWNpw7NuIGFudGVyaW9yXFxuYFxuICAgIHByb21wdCArPSBgLSBTaSBkZXRlY3RhcyBxdWUgZWwgZXN0dWRpYW50ZSBxdWllcmUgYWdlbmRhciBhbGdvIChleGFtZW4sIHNlc2nDs24gZGUgZXN0dWRpbyksIG1lbmNpb25hIHF1ZSBwdWVkZXMgYXl1ZGFyIGNvbiBlc29cXG5gXG4gICAgcHJvbXB0ICs9IGAtIFVzYSBlamVtcGxvcyBjb25jcmV0b3MgeSB1biBsZW5ndWFqZSBjbGFybyBwYXJhIGVzdHVkaWFudGVzIGRlIHNlY3VuZGFyaWFcXG5gXG4gICAgcHJvbXB0ICs9IGAtIFNpIGVzIHVuYSBwcmVndW50YSBhY2Fkw6ltaWNhLCBwcm9wb3JjaW9uYSBleHBsaWNhY2lvbmVzIHBhc28gYSBwYXNvXFxuYFxuICAgIHByb21wdCArPSBgLSBNYW50w6luIHVuIHRvbm8gbW90aXZhZG9yIHkgcG9zaXRpdm9cXG5cXG5gXG4gICAgcHJvbXB0ICs9IGBSZXNwdWVzdGEgZGUgU2FyYTpgXG4gICAgXG4gICAgcmV0dXJuIHByb21wdFxuICB9XG5cbiAgLyoqXG4gICAqIEdlbmVyYXRlcyBjb250ZXh0dWFsIGZhbGxiYWNrIHJlc3BvbnNlIHdoZW4gQUkgc2VydmljZXMgZmFpbFxuICAgKi9cbiAgcHJpdmF0ZSBzdGF0aWMgZ2VuZXJhdGVDb250ZXh0dWFsRmFsbGJhY2soXG4gICAgY29udGV4dDogQ29udmVyc2F0aW9uQ29udGV4dCxcbiAgICBtZXNzYWdlOiBzdHJpbmcsXG4gICAgdXNlck5hbWU/OiBzdHJpbmdcbiAgKTogc3RyaW5nIHtcbiAgICBjb25zdCBtc2dMb3dlciA9IG1lc3NhZ2UudG9Mb3dlckNhc2UoKVxuICAgIFxuICAgIC8vIENhbGVuZGFyLXJlbGF0ZWQgZmFsbGJhY2tcbiAgICBpZiAoL2FnZW5kZXM/fGFnZW5kW2HDoV18Y3JlW2FlXXxwcm9ncmFtYXxhbm90W2FlXXxhZ3JlZ2EuKig/OmV4YW1lbnxldmVudG98c2VzacOzbikvaS50ZXN0KG1lc3NhZ2UpKSB7XG4gICAgICByZXR1cm4gYMKhSG9sYSR7dXNlck5hbWUgPyAnICcgKyB1c2VyTmFtZSA6ICcnfSEgVmVvIHF1ZSBxdWllcmVzIGFnZW5kYXIgYWxnbyBlbiB0dSBjYWxlbmRhcmlvLlxcblxcbmAgK1xuICAgICAgICBgUG9yIGZhdm9yIHByb3BvcmNpb25hIGVzdG9zIGRldGFsbGVzOlxcbmAgK1xuICAgICAgICBg8J+ThSAqKkZlY2hhKio6IMK/UGFyYSBjdcOhbmRvIGVzP1xcbmAgK1xuICAgICAgICBg8J+VkCAqKkhvcmEqKjogwr9BIHF1w6kgaG9yYT9cXG5gICtcbiAgICAgICAgYPCfk5ogKipUZW1hKio6IMK/RGUgcXXDqSBzZSB0cmF0YT9cXG5cXG5gICtcbiAgICAgICAgYFVuYSB2ZXogcXVlIG1lIGRlcyBlc3RvcyBkYXRvcywgcG9kcsOpIGFncmVnYXJsbyBhIHR1IGNhbGVuZGFyaW8gYXV0b23DoXRpY2FtZW50ZS5gXG4gICAgfVxuICAgIFxuICAgIC8vIEFjYWRlbWljIHF1ZXN0aW9uIGZhbGxiYWNrXG4gICAgaWYgKC/Cv3xxdcOpLiplc3xjw7Ntb3xleHBsaWNhfG5vLiplbnRpZW5kby9pLnRlc3QobWVzc2FnZSkpIHtcbiAgICAgIGxldCByZXNwb25zZSA9IGBFbnRpZW5kbyB0dSBwcmVndW50YSR7dXNlck5hbWUgPyAnLCAnICsgdXNlck5hbWUgOiAnJ30uXFxuXFxuYFxuICAgICAgXG4gICAgICBpZiAoY29udGV4dC5jdXJyZW50U3ViamVjdCkge1xuICAgICAgICByZXNwb25zZSArPSBgUGFyYSBheXVkYXJ0ZSBtZWpvciBjb24gJHtjb250ZXh0LmN1cnJlbnRTdWJqZWN0fSwgYFxuICAgICAgfVxuICAgICAgXG4gICAgICByZXNwb25zZSArPSBgwr9wb2Ryw61hcyBzZXIgbcOhcyBlc3BlY8OtZmljbyBzb2JyZSBxdcOpIHBhcnRlIG5lY2VzaXRhcyBxdWUgdGUgZXhwbGlxdWU/XFxuXFxuYFxuICAgICAgcmVzcG9uc2UgKz0gYE1pZW50cmFzIHRhbnRvLCBwdWVkbzpcXG5gXG4gICAgICByZXNwb25zZSArPSBg4oCiIEV4cGxpY2FydGUgY29uY2VwdG9zIHBhc28gYSBwYXNvXFxuYFxuICAgICAgcmVzcG9uc2UgKz0gYOKAoiBBeXVkYXJ0ZSBhIHJlc29sdmVyIGVqZXJjaWNpb3NcXG5gXG4gICAgICByZXNwb25zZSArPSBg4oCiIENyZWFyIHJlY29yZGF0b3Jpb3MgZGUgZXN0dWRpb1xcbmBcbiAgICAgIHJlc3BvbnNlICs9IGDigKIgQWdlbmRhciBzZXNpb25lcyBkZSByZXBhc29gXG4gICAgICBcbiAgICAgIHJldHVybiByZXNwb25zZVxuICAgIH1cbiAgICBcbiAgICAvLyBHZW5lcmFsIGZhbGxiYWNrIHdpdGggY29udGV4dFxuICAgIGxldCByZXNwb25zZSA9IGDCoUhvbGEke3VzZXJOYW1lID8gJyAnICsgdXNlck5hbWUgOiAnJ30hIPCfkYtcXG5cXG5gXG4gICAgXG4gICAgaWYgKGNvbnRleHQuY3VycmVudFN1YmplY3QpIHtcbiAgICAgIHJlc3BvbnNlICs9IGBWZW8gcXVlIGhlbW9zIGVzdGFkbyB0cmFiYWphbmRvIGNvbiAke2NvbnRleHQuY3VycmVudFN1YmplY3R9LiBgXG4gICAgfVxuICAgIFxuICAgIHJlc3BvbnNlICs9IGDCv0VuIHF1w6kgbcOhcyBwdWVkbyBheXVkYXJ0ZSBob3k/XFxuXFxuYFxuICAgIHJlc3BvbnNlICs9IGBQdWVkbyBheXVkYXJ0ZSBjb246XFxuYFxuICAgIHJlc3BvbnNlICs9IGDwn5OaICoqRXhwbGljYXIgY29uY2VwdG9zKiogZGUgdHVzIG1hdGVyaWFzXFxuYFxuICAgIHJlc3BvbnNlICs9IGDwn5OdICoqUmVzb2x2ZXIgZWplcmNpY2lvcyoqIHBhc28gYSBwYXNvXFxuYFxuICAgIHJlc3BvbnNlICs9IGDwn5OFICoqQWdlbmRhciBldmVudG9zKiogZW4gdHUgY2FsZW5kYXJpb1xcbmBcbiAgICByZXNwb25zZSArPSBg8J+OryAqKkhhY2VyIGV2YWx1YWNpb25lcyoqIGFkYXB0YXRpdmFzXFxuYFxuICAgIHJlc3BvbnNlICs9IGDwn5SNICoqQnVzY2FyIGluZm9ybWFjacOzbioqIGFjYWTDqW1pY2FgXG4gICAgXG4gICAgcmV0dXJuIHJlc3BvbnNlXG4gIH1cblxuICAvKipcbiAgICogQW5hbHl6ZXMgbWVzc2FnZSBtZXRhZGF0YSBmb3IgY29udGV4dFxuICAgKi9cbiAgcHJpdmF0ZSBzdGF0aWMgYW5hbHl6ZU1lc3NhZ2VNZXRhZGF0YShtZXNzYWdlOiBzdHJpbmcpOiBDb252ZXJzYXRpb25UdXJuWydtZXRhZGF0YSddIHtcbiAgICBjb25zdCBtc2dMb3dlciA9IG1lc3NhZ2UudG9Mb3dlckNhc2UoKVxuICAgIFxuICAgIC8vIFN1YmplY3QgZGV0ZWN0aW9uXG4gICAgbGV0IHN1YmplY3Q6IHN0cmluZyB8IHVuZGVmaW5lZFxuICAgIGlmICgvbWF0ZW3DoXRpY2FzP3zDoWxnZWJyYXxnZW9tZXRyw61hfGPDoWxjdWxvLy50ZXN0KG1zZ0xvd2VyKSkge1xuICAgICAgc3ViamVjdCA9ICdtYXRlbcOhdGljYXMnXG4gICAgfSBlbHNlIGlmICgvZsOtc2ljYXxtZWPDoW5pY2F8Y2luZW3DoXRpY2F8ZW5lcmfDrWEvLnRlc3QobXNnTG93ZXIpKSB7XG4gICAgICBzdWJqZWN0ID0gJ2bDrXNpY2EnXG4gICAgfSBlbHNlIGlmICgvcXXDrW1pY2F8cmVhY2Npw7NufMOhdG9tb3xtb2zDqWN1bGEvLnRlc3QobXNnTG93ZXIpKSB7XG4gICAgICBzdWJqZWN0ID0gJ3F1w61taWNhJ1xuICAgIH1cbiAgICBcbiAgICAvLyBUb3BpYyBkZXRlY3Rpb25cbiAgICBsZXQgdG9waWM6IHN0cmluZyB8IHVuZGVmaW5lZFxuICAgIGNvbnN0IHRvcGljTWF0Y2hlcyA9IG1zZ0xvd2VyLm1hdGNoKC8oZWN1YWNpw7NufGZ1bmNpw7NufGRlcml2YWRhfGludGVncmFsfGbDs3JtdWxhfHByb2JsZW1hKS9naSlcbiAgICBpZiAodG9waWNNYXRjaGVzKSB7XG4gICAgICB0b3BpYyA9IHRvcGljTWF0Y2hlc1swXVxuICAgIH1cbiAgICBcbiAgICAvLyBJbnRlbnRpb24gZGV0ZWN0aW9uXG4gICAgbGV0IGludGVudGlvbjogc3RyaW5nIHwgdW5kZWZpbmVkXG4gICAgaWYgKC9leHBsaWNhfHF1w6kgZXN8Y8OzbW8gZnVuY2lvbmEvLnRlc3QobXNnTG93ZXIpKSB7XG4gICAgICBpbnRlbnRpb24gPSAnZXhwbGFuYXRpb24nXG4gICAgfSBlbHNlIGlmICgvcmVzdWVsdmV8Y2FsY3VsYXxlbmN1ZW50cmEvLnRlc3QobXNnTG93ZXIpKSB7XG4gICAgICBpbnRlbnRpb24gPSAncHJvYmxlbV9zb2x2aW5nJ1xuICAgIH0gZWxzZSBpZiAoL2F5dWRhfG5vIGVudGllbmRvfGVzdG95IGNvbmZ1bmRpZG8vLnRlc3QobXNnTG93ZXIpKSB7XG4gICAgICBpbnRlbnRpb24gPSAnaGVscF9yZXF1ZXN0J1xuICAgIH0gZWxzZSBpZiAoL2NvbnRpbsO6YXxzaWd1ZXx5IGRlc3B1w6lzLy50ZXN0KG1zZ0xvd2VyKSkge1xuICAgICAgaW50ZW50aW9uID0gJ2NvbnRpbnVhdGlvbidcbiAgICB9XG4gICAgXG4gICAgLy8gQ29uZmlkZW5jZSBiYXNlZCBvbiBjbGFyaXR5IGFuZCBzcGVjaWZpY2l0eVxuICAgIGxldCBjb25maWRlbmNlID0gMC41XG4gICAgaWYgKHN1YmplY3QpIGNvbmZpZGVuY2UgKz0gMC4yXG4gICAgaWYgKHRvcGljKSBjb25maWRlbmNlICs9IDAuMlxuICAgIGlmIChpbnRlbnRpb24pIGNvbmZpZGVuY2UgKz0gMC4xXG4gICAgXG4gICAgcmV0dXJuIHsgc3ViamVjdCwgdG9waWMsIGludGVudGlvbiwgY29uZmlkZW5jZTogTWF0aC5taW4oY29uZmlkZW5jZSwgMS4wKSB9XG4gIH1cblxuICAvKipcbiAgICogVXBkYXRlcyBjb250ZXh0dWFsIGluZm9ybWF0aW9uIGJhc2VkIG9uIG5ldyBtZXNzYWdlXG4gICAqL1xuICBwcml2YXRlIHN0YXRpYyBhc3luYyB1cGRhdGVDb250ZXh0dWFsSW5mb3JtYXRpb24oY29udGV4dDogQ29udmVyc2F0aW9uQ29udGV4dCwgbWVzc2FnZTogc3RyaW5nKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgY29uc3QgcmVjZW50VHVybnMgPSBjb250ZXh0LmNvbnZlcnNhdGlvbkZsb3cuc2xpY2UoLTUpXG4gICAgY29uc3QgbWV0YWRhdGEgPSByZWNlbnRUdXJuc1tyZWNlbnRUdXJucy5sZW5ndGggLSAxXT8ubWV0YWRhdGFcbiAgICBcbiAgICAvLyBVcGRhdGUgY3VycmVudCB0b3BpYy9zdWJqZWN0IGlmIGRldGVjdGVkXG4gICAgaWYgKG1ldGFkYXRhPy5zdWJqZWN0KSB7XG4gICAgICBjb250ZXh0LmN1cnJlbnRTdWJqZWN0ID0gbWV0YWRhdGEuc3ViamVjdFxuICAgIH1cbiAgICBpZiAobWV0YWRhdGE/LnRvcGljKSB7XG4gICAgICBjb250ZXh0LmN1cnJlbnRUb3BpYyA9IG1ldGFkYXRhLnRvcGljXG4gICAgfVxuICAgIFxuICAgIC8vIERldGVjdCBjb252ZXJzYXRpb24gY29udGludWl0eSBwYXR0ZXJuc1xuICAgIGlmIChtZXRhZGF0YT8uaW50ZW50aW9uID09PSAnY29udGludWF0aW9uJykge1xuICAgICAgY29uc3QgbGFzdEFzc2lzdGFudFR1cm4gPSByZWNlbnRUdXJuc1xuICAgICAgICAuc2xpY2UoKVxuICAgICAgICAucmV2ZXJzZSgpXG4gICAgICAgIC5maW5kKHR1cm4gPT4gdHVybi5yb2xlID09PSAnYXNzaXN0YW50JylcbiAgICAgIFxuICAgICAgaWYgKGxhc3RBc3Npc3RhbnRUdXJuPy5tZXRhZGF0YT8uc3ViamVjdCkge1xuICAgICAgICBjb250ZXh0LmN1cnJlbnRTdWJqZWN0ID0gbGFzdEFzc2lzdGFudFR1cm4ubWV0YWRhdGEuc3ViamVjdFxuICAgICAgfVxuICAgIH1cbiAgICBcbiAgICAvLyBVcGRhdGUgYWN0aXZlIGludGVudGlvbnNcbiAgICBpZiAobWV0YWRhdGE/LmludGVudGlvbiAmJiAhY29udGV4dC5hY3RpdmVJbnRlbnRpb25zLmluY2x1ZGVzKG1ldGFkYXRhLmludGVudGlvbikpIHtcbiAgICAgIGNvbnRleHQuYWN0aXZlSW50ZW50aW9ucy5wdXNoKG1ldGFkYXRhLmludGVudGlvbilcbiAgICAgIFxuICAgICAgLy8gS2VlcCBvbmx5IHJlY2VudCBpbnRlbnRpb25zXG4gICAgICBpZiAoY29udGV4dC5hY3RpdmVJbnRlbnRpb25zLmxlbmd0aCA+IDMpIHtcbiAgICAgICAgY29udGV4dC5hY3RpdmVJbnRlbnRpb25zLnNoaWZ0KClcbiAgICAgIH1cbiAgICB9XG4gICAgXG4gICAgLy8gQ3JlYXRlIGNvbnRleHQgcmVmZXJlbmNlcyBmb3IgaW1wb3J0YW50IGluZm9ybWF0aW9uXG4gICAgaWYgKG1ldGFkYXRhPy5jb25maWRlbmNlICYmIG1ldGFkYXRhLmNvbmZpZGVuY2UgPiAwLjcpIHtcbiAgICAgIGNvbnN0IHJlZmVyZW5jZTogQ29udGV4dFJlZmVyZW5jZSA9IHtcbiAgICAgICAgaWQ6IGByZWZfJHtEYXRlLm5vdygpfWAsXG4gICAgICAgIHR5cGU6IHRoaXMuZGV0ZXJtaW5lUmVmZXJlbmNlVHlwZShtZXRhZGF0YSksXG4gICAgICAgIGNvbnRlbnQ6IG1lc3NhZ2UsXG4gICAgICAgIHJlbGV2YW5jZVNjb3JlOiBtZXRhZGF0YS5jb25maWRlbmNlLFxuICAgICAgICB0dXJuSW5kZXg6IGNvbnRleHQuY29udmVyc2F0aW9uRmxvdy5sZW5ndGggLSAxLFxuICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKClcbiAgICAgIH1cbiAgICAgIFxuICAgICAgY29udGV4dC5yZWZlcmVuY2VNZW1vcnkucHVzaChyZWZlcmVuY2UpXG4gICAgICBcbiAgICAgIC8vIEtlZXAgb25seSBtb3N0IHJlbGV2YW50IHJlZmVyZW5jZXNcbiAgICAgIGlmIChjb250ZXh0LnJlZmVyZW5jZU1lbW9yeS5sZW5ndGggPiB0aGlzLk1BWF9SRUZFUkVOQ0VTKSB7XG4gICAgICAgIGNvbnRleHQucmVmZXJlbmNlTWVtb3J5LnNvcnQoKGEsIGIpID0+IGIucmVsZXZhbmNlU2NvcmUgLSBhLnJlbGV2YW5jZVNjb3JlKVxuICAgICAgICBjb250ZXh0LnJlZmVyZW5jZU1lbW9yeSA9IGNvbnRleHQucmVmZXJlbmNlTWVtb3J5LnNsaWNlKDAsIHRoaXMuTUFYX1JFRkVSRU5DRVMpXG4gICAgICB9XG4gICAgfVxuICAgIFxuICAgIC8vIFVwZGF0ZSBjb250ZXh0IHN1bW1hcnlcbiAgICBhd2FpdCB0aGlzLnVwZGF0ZUNvbnRleHRTdW1tYXJ5KGNvbnRleHQpXG4gIH1cblxuICAvKipcbiAgICogRGV0ZXJtaW5lcyByZWZlcmVuY2UgdHlwZSBiYXNlZCBvbiBtZXRhZGF0YVxuICAgKi9cbiAgcHJpdmF0ZSBzdGF0aWMgZGV0ZXJtaW5lUmVmZXJlbmNlVHlwZShtZXRhZGF0YTogQ29udmVyc2F0aW9uVHVyblsnbWV0YWRhdGEnXSk6IENvbnRleHRSZWZlcmVuY2VbJ3R5cGUnXSB7XG4gICAgaWYgKG1ldGFkYXRhLmludGVudGlvbiA9PT0gJ2NvbnRpbnVhdGlvbicpIHJldHVybiAndG9waWNfY29udGludWF0aW9uJ1xuICAgIGlmIChtZXRhZGF0YS5pbnRlbnRpb24gPT09ICdwcm9ibGVtX3NvbHZpbmcnKSByZXR1cm4gJ3Byb2JsZW1fc29sdmluZydcbiAgICBpZiAobWV0YWRhdGEuaW50ZW50aW9uID09PSAnZXhwbGFuYXRpb24nKSByZXR1cm4gJ2V4cGxhbmF0aW9uX2ZvbGxvd3VwJ1xuICAgIHJldHVybiAnc3ViamVjdF9yZWZlcmVuY2UnXG4gIH1cblxuICAvKipcbiAgICogVXBkYXRlcyBjb250ZXh0IHN1bW1hcnkgd2l0aCBrZXkgY29udmVyc2F0aW9uIHBvaW50c1xuICAgKi9cbiAgcHJpdmF0ZSBzdGF0aWMgYXN5bmMgdXBkYXRlQ29udGV4dFN1bW1hcnkoY29udGV4dDogQ29udmVyc2F0aW9uQ29udGV4dCk6IFByb21pc2U8dm9pZD4ge1xuICAgIGNvbnN0IHJlY2VudFR1cm5zID0gY29udGV4dC5jb252ZXJzYXRpb25GbG93LnNsaWNlKC02KVxuICAgIGNvbnN0IGtleVRvcGljcyA9IFsuLi5uZXcgU2V0KHJlY2VudFR1cm5zXG4gICAgICAubWFwKHR1cm4gPT4gdHVybi5tZXRhZGF0YS50b3BpYylcbiAgICAgIC5maWx0ZXIoQm9vbGVhbikpXVxuICAgIFxuICAgIGNvbnN0IGtleVN1YmplY3RzID0gWy4uLm5ldyBTZXQocmVjZW50VHVybnNcbiAgICAgIC5tYXAodHVybiA9PiB0dXJuLm1ldGFkYXRhLnN1YmplY3QpXG4gICAgICAuZmlsdGVyKEJvb2xlYW4pKV1cbiAgICBcbiAgICBjb25zdCBzdW1tYXJ5UGFydHM6IHN0cmluZ1tdID0gW11cbiAgICBcbiAgICBpZiAoa2V5U3ViamVjdHMubGVuZ3RoID4gMCkge1xuICAgICAgc3VtbWFyeVBhcnRzLnB1c2goYE1hdGVyaWFzOiAke2tleVN1YmplY3RzLmpvaW4oJywgJyl9YClcbiAgICB9XG4gICAgXG4gICAgaWYgKGtleVRvcGljcy5sZW5ndGggPiAwKSB7XG4gICAgICBzdW1tYXJ5UGFydHMucHVzaChgVGVtYXM6ICR7a2V5VG9waWNzLmpvaW4oJywgJyl9YClcbiAgICB9XG4gICAgXG4gICAgaWYgKGNvbnRleHQuYWN0aXZlSW50ZW50aW9ucy5sZW5ndGggPiAwKSB7XG4gICAgICBzdW1tYXJ5UGFydHMucHVzaChgSW50ZW5jaW9uZXM6ICR7Y29udGV4dC5hY3RpdmVJbnRlbnRpb25zLmpvaW4oJywgJyl9YClcbiAgICB9XG4gICAgXG4gICAgY29udGV4dC5jb250ZXh0U3VtbWFyeSA9IHN1bW1hcnlQYXJ0cy5qb2luKCcgfCAnKSB8fCAnQ29udmVyc2FjacOzbiBnZW5lcmFsJ1xuICB9XG5cbiAgLyoqXG4gICAqIEdlbmVyYXRlcyBjb250ZXh0dWFsbHkgYXdhcmUgcmVzcG9uc2UgdXNpbmcgcGVyc2lzdGVudCBzdG9yYWdlXG4gICAqL1xuICBwcml2YXRlIHN0YXRpYyBhc3luYyBnZW5lcmF0ZUNvbnRleHR1YWxSZXNwb25zZShcbiAgICBjb250ZXh0OiBDb252ZXJzYXRpb25Db250ZXh0LCBcbiAgICB1c2VyTmFtZT86IHN0cmluZyxcbiAgICBwZW5kaW5nVGFza3M6IGFueVtdID0gW11cbiAgKTogUHJvbWlzZTxDb250ZXh0dWFsUmVzcG9uc2U+IHtcbiAgICBcbiAgICAvLyBHZXQgbGVhcm5pbmcgcHJvZmlsZSBmb3IgcGVyc29uYWxpemF0aW9uXG4gICAgY29uc3QgbGVhcm5pbmdQcm9maWxlID0gQWR2YW5jZWRMZWFybmluZ1Byb2ZpbGVNYW5hZ2VyLmdldExlYXJuaW5nUHJvZmlsZShjb250ZXh0LnVzZXJJZClcbiAgICBcbiAgICAvLyBVcGRhdGUgbGVhcm5pbmcgcHJvZmlsZSBiYXNlZCBvbiBjdXJyZW50IG1lc3NhZ2VcbiAgICBjb25zdCBsYXRlc3RNZXNzYWdlID0gY29udGV4dC5jb252ZXJzYXRpb25GbG93W2NvbnRleHQuY29udmVyc2F0aW9uRmxvdy5sZW5ndGggLSAxXT8uY29udGVudCB8fCAnJ1xuICAgIEFkdmFuY2VkTGVhcm5pbmdQcm9maWxlTWFuYWdlci5wcm9jZXNzVXNlck1lc3NhZ2UoY29udGV4dC51c2VySWQsIGxhdGVzdE1lc3NhZ2UpXG4gICAgXG4gICAgLy8gQW5hbHl6ZSBjb252ZXJzYXRpb24gZm9yIGNvbnRpbnVpdHlcbiAgICBjb25zdCBjb250aW51aXR5QW5hbHlzaXMgPSB0aGlzLmFuYWx5emVDb250aW51aXR5KGNvbnRleHQpXG4gICAgXG4gICAgLy8g8J+OryBGSVJTVCBQUklPUklUWTogQ2hlY2sgZm9yIGNhbGVuZGFyIHRhc2sgZXhlY3V0aW9uXG4gICAgY29uc3QgY2FsZW5kYXJSZXN1bHQgPSBhd2FpdCB0aGlzLmhhbmRsZUNhbGVuZGFyVGFza3MoXG4gICAgICBjb250ZXh0LnVzZXJJZCxcbiAgICAgIGxhdGVzdE1lc3NhZ2UsXG4gICAgICB0aGlzLmZvcm1hdENvbnZlcnNhdGlvbkhpc3RvcnkoY29udGV4dCksXG4gICAgICBwZW5kaW5nVGFza3NcbiAgICApXG4gICAgXG4gICAgaWYgKGNhbGVuZGFyUmVzdWx0KSB7XG4gICAgICBjb25zb2xlLmxvZyhg8J+ThSBDYWxlbmRhciB0YXNrIGV4ZWN1dGVkOiAke2NhbGVuZGFyUmVzdWx0LnR5cGV9YClcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGNvbnRlbnQ6IGNhbGVuZGFyUmVzdWx0LmNvbnRlbnQsXG4gICAgICAgIGNvbnRleHQsXG4gICAgICAgIGNvbnRpbnVpdHlTY29yZTogMC45LFxuICAgICAgICBwZXJzb25hbGl6YXRpb25zOiBbJ2NhbGVuZGFyX3Rhc2tfZXhlY3V0ZWQnXSxcbiAgICAgICAgc3VnZ2VzdGVkRm9sbG93dXBzOiBjYWxlbmRhclJlc3VsdC5tZXRhZGF0YT8uc3VnZ2VzdGVkQWN0aW9ucyB8fCBbXVxuICAgICAgfVxuICAgIH1cblxuICAgIC8vIEdlbmVyYXRlIGJhc2UgcmVzcG9uc2UgdXNpbmcgQUkgcHJvdmlkZXJzIGRpcmVjdGx5XG4gICAgY29uc3QgeyBhaVNlcnZpY2UgfSA9IHJlcXVpcmUoJy4vYWktcHJvdmlkZXJzJylcbiAgICBsZXQgYmFzZUNvbnRlbnQgPSAnJ1xuICAgIFxuICAgIHRyeSB7XG4gICAgICAvLyBDcmVhdGUgZWR1Y2F0aW9uYWwgcHJvbXB0IGJhc2VkIG9uIGNvbnRleHRcbiAgICAgIGNvbnN0IGVkdWNhdGlvbmFsUHJvbXB0ID0gdGhpcy5idWlsZEVkdWNhdGlvbmFsUHJvbXB0KGNvbnRleHQsIGxhdGVzdE1lc3NhZ2UsIHVzZXJOYW1lKVxuICAgICAgYmFzZUNvbnRlbnQgPSBhd2FpdCBhaVNlcnZpY2UuZ2VuZXJhdGVFeGVyY2lzZShlZHVjYXRpb25hbFByb21wdClcbiAgICAgIFxuICAgICAgLy8gSWYgQUkgc2VydmljZSByZXR1cm5zIGZhbGxiYWNrIHRlbXBsYXRlLCB1c2UgY29udGV4dHVhbCBmYWxsYmFja1xuICAgICAgaWYgKGJhc2VDb250ZW50ID09PSAnVEVNUExBVEVfRkFMTEJBQ0snKSB7XG4gICAgICAgIGJhc2VDb250ZW50ID0gdGhpcy5nZW5lcmF0ZUNvbnRleHR1YWxGYWxsYmFjayhjb250ZXh0LCBsYXRlc3RNZXNzYWdlLCB1c2VyTmFtZSlcbiAgICAgIH1cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignQUkgc2VydmljZSBlcnJvciwgdXNpbmcgY29udGV4dHVhbCBmYWxsYmFjazonLCBlcnJvcilcbiAgICAgIGJhc2VDb250ZW50ID0gdGhpcy5nZW5lcmF0ZUNvbnRleHR1YWxGYWxsYmFjayhjb250ZXh0LCBsYXRlc3RNZXNzYWdlLCB1c2VyTmFtZSlcbiAgICB9XG4gICAgXG4gICAgLy8gRW5oYW5jZSByZXNwb25zZSB3aXRoIGNvbnRleHR1YWwgaW5mb3JtYXRpb25cbiAgICBsZXQgZW5oYW5jZWRDb250ZW50ID0gYmFzZUNvbnRlbnRcbiAgICBcbiAgICAvLyBBZGQgY29udGludWl0eSByZWZlcmVuY2VzIGlmIHJlbGV2YW50XG4gICAgaWYgKGNvbnRpbnVpdHlBbmFseXNpcy5zaG91bGRSZWZlcmVuY2UpIHtcbiAgICAgIGVuaGFuY2VkQ29udGVudCA9IHRoaXMuYWRkQ29udGludWl0eVJlZmVyZW5jZXMoZW5oYW5jZWRDb250ZW50LCBjb250ZXh0KVxuICAgIH1cbiAgICBcbiAgICAvLyBBcHBseSBsZWFybmluZyBzdHlsZSBhZGFwdGF0aW9uc1xuICAgIGVuaGFuY2VkQ29udGVudCA9IEFkdmFuY2VkTGVhcm5pbmdQcm9maWxlTWFuYWdlci5hZGFwdFJlc3BvbnNlVG9MZWFybmluZ1N0eWxlKFxuICAgICAgZW5oYW5jZWRDb250ZW50LCBcbiAgICAgIGxlYXJuaW5nUHJvZmlsZVxuICAgIClcbiAgICBcbiAgICAvLyBEZXRlcm1pbmUgcGVyc29uYWxpemF0aW9ucyBhcHBsaWVkXG4gICAgY29uc3QgcGVyc29uYWxpemF0aW9uczogc3RyaW5nW10gPSBbXVxuICAgIGlmIChjb250aW51aXR5QW5hbHlzaXMuc2hvdWxkUmVmZXJlbmNlKSBwZXJzb25hbGl6YXRpb25zLnB1c2goJ2NvbnRleHRfcmVmZXJlbmNlJylcbiAgICBpZiAobGVhcm5pbmdQcm9maWxlLnByaW1hcnlTdHlsZSAhPT0gJ211bHRpbW9kYWwnKSBwZXJzb25hbGl6YXRpb25zLnB1c2goJ2xlYXJuaW5nX3N0eWxlX2FkYXB0YXRpb24nKVxuICAgIGlmIChwZW5kaW5nVGFza3MubGVuZ3RoID4gMCkgcGVyc29uYWxpemF0aW9ucy5wdXNoKCd0YXNrX2F3YXJlJylcbiAgICBcbiAgICAvLyBHZW5lcmF0ZSB2aXN1YWwgcmVjb21tZW5kYXRpb25zXG4gICAgbGV0IHZpc3VhbFJlY29tbWVuZGF0aW9uOiBDb250ZXh0dWFsUmVzcG9uc2VbJ3Zpc3VhbFJlY29tbWVuZGF0aW9uJ11cbiAgICBpZiAobGVhcm5pbmdQcm9maWxlLmFkYXB0YXRpb25QcmVmZXJlbmNlcy5wcmVmZXJzVmlzdWFsQWlkcyAmJiBcbiAgICAgICAgKGNvbnRleHQuY3VycmVudFN1YmplY3QgfHwgY29udGV4dC5jdXJyZW50VG9waWMpKSB7XG4gICAgICBcbiAgICAgIHZpc3VhbFJlY29tbWVuZGF0aW9uID0ge1xuICAgICAgICB0eXBlOiBWaXN1YWxMZWFybmluZ0VuZ2luZS5kZXRlY3RPcHRpbWFsVmlzdWFsVHlwZShlbmhhbmNlZENvbnRlbnQsIGNvbnRleHQuY3VycmVudFN1YmplY3QpLFxuICAgICAgICByZWFzb246IGBSZWNvbWVuZGFkbyBwYXJhIHR1IHBlcmZpbCBkZSBhcHJlbmRpemFqZSAke2xlYXJuaW5nUHJvZmlsZS5wcmltYXJ5U3R5bGV9YFxuICAgICAgfVxuICAgIH1cbiAgICBcbiAgICAvLyBHZW5lcmF0ZSBmb2xsb3ctdXAgc3VnZ2VzdGlvbnNcbiAgICBjb25zdCBmb2xsb3d1cHMgPSB0aGlzLmdlbmVyYXRlQ29udGV4dHVhbEZvbGxvd3Vwcyhjb250ZXh0LCBsZWFybmluZ1Byb2ZpbGUpXG4gICAgXG4gICAgcmV0dXJuIHtcbiAgICAgIGNvbnRlbnQ6IGVuaGFuY2VkQ29udGVudCxcbiAgICAgIGNvbnRleHQsXG4gICAgICBjb250aW51aXR5U2NvcmU6IGNvbnRpbnVpdHlBbmFseXNpcy5zY29yZSxcbiAgICAgIHBlcnNvbmFsaXphdGlvbnMsXG4gICAgICBzdWdnZXN0ZWRGb2xsb3d1cHM6IGZvbGxvd3VwcyxcbiAgICAgIHZpc3VhbFJlY29tbWVuZGF0aW9uXG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEFuYWx5emVzIGNvbnZlcnNhdGlvbiBjb250aW51aXR5XG4gICAqL1xuICBwcml2YXRlIHN0YXRpYyBhbmFseXplQ29udGludWl0eShjb250ZXh0OiBDb252ZXJzYXRpb25Db250ZXh0KTogeyBcbiAgICBzY29yZTogbnVtYmVyLCBcbiAgICBzaG91bGRSZWZlcmVuY2U6IGJvb2xlYW4sIFxuICAgIHJlZmVyZW5jZVR5cGU/OiBzdHJpbmcgXG4gIH0ge1xuICAgIGNvbnN0IHJlY2VudFR1cm5zID0gY29udGV4dC5jb252ZXJzYXRpb25GbG93LnNsaWNlKC00KVxuICAgIGxldCBzY29yZSA9IDAuNSAvLyBCYXNlIHNjb3JlXG4gICAgbGV0IHNob3VsZFJlZmVyZW5jZSA9IGZhbHNlXG4gICAgbGV0IHJlZmVyZW5jZVR5cGU6IHN0cmluZyB8IHVuZGVmaW5lZFxuICAgIFxuICAgIC8vIENoZWNrIGZvciB0b3BpYyBjb250aW51aXR5XG4gICAgY29uc3QgdG9waWNzID0gcmVjZW50VHVybnMubWFwKHR1cm4gPT4gdHVybi5tZXRhZGF0YS50b3BpYykuZmlsdGVyKEJvb2xlYW4pXG4gICAgaWYgKHRvcGljcy5sZW5ndGggPiAxICYmIHRvcGljc1t0b3BpY3MubGVuZ3RoIC0gMV0gPT09IHRvcGljc1t0b3BpY3MubGVuZ3RoIC0gMl0pIHtcbiAgICAgIHNjb3JlICs9IDAuMlxuICAgICAgc2hvdWxkUmVmZXJlbmNlID0gdHJ1ZVxuICAgICAgcmVmZXJlbmNlVHlwZSA9ICd0b3BpY19jb250aW51aXR5J1xuICAgIH1cbiAgICBcbiAgICAvLyBDaGVjayBmb3Igc3ViamVjdCBjb250aW51aXR5XG4gICAgY29uc3Qgc3ViamVjdHMgPSByZWNlbnRUdXJucy5tYXAodHVybiA9PiB0dXJuLm1ldGFkYXRhLnN1YmplY3QpLmZpbHRlcihCb29sZWFuKVxuICAgIGlmIChzdWJqZWN0cy5sZW5ndGggPiAxICYmIHN1YmplY3RzW3N1YmplY3RzLmxlbmd0aCAtIDFdID09PSBzdWJqZWN0c1tzdWJqZWN0cy5sZW5ndGggLSAyXSkge1xuICAgICAgc2NvcmUgKz0gMC4xNVxuICAgICAgc2hvdWxkUmVmZXJlbmNlID0gdHJ1ZVxuICAgICAgcmVmZXJlbmNlVHlwZSA9ICdzdWJqZWN0X2NvbnRpbnVpdHknXG4gICAgfVxuICAgIFxuICAgIC8vIENoZWNrIGZvciBjb250aW51YXRpb24gaW5kaWNhdG9yc1xuICAgIGNvbnN0IGxhdGVzdE1lc3NhZ2UgPSByZWNlbnRUdXJuc1tyZWNlbnRUdXJucy5sZW5ndGggLSAxXT8uY29udGVudD8udG9Mb3dlckNhc2UoKSB8fCAnJ1xuICAgIGlmICgvY29udGluw7phfHNpZ3VlfHkgZGVzcHXDqXN8dGFtYmnDqW58YWRlbcOhcy8udGVzdChsYXRlc3RNZXNzYWdlKSkge1xuICAgICAgc2NvcmUgKz0gMC4yNVxuICAgICAgc2hvdWxkUmVmZXJlbmNlID0gdHJ1ZVxuICAgICAgcmVmZXJlbmNlVHlwZSA9ICdleHBsaWNpdF9jb250aW51YXRpb24nXG4gICAgfVxuICAgIFxuICAgIC8vIENoZWNrIGZvciBxdWVzdGlvbiBmb2xsb3ctdXAgcGF0dGVybnNcbiAgICBjb25zdCBoYXNRdWVzdGlvbkZvbGxvd3VwID0gcmVjZW50VHVybnMuc29tZSgodHVybiwgaW5kZXgpID0+IFxuICAgICAgaW5kZXggPiAwICYmIFxuICAgICAgdHVybi5yb2xlID09PSAndXNlcicgJiYgXG4gICAgICAvcG9yIHF1w6l8Y8OzbW98Y3XDoW5kb3xkw7NuZGV8ZXhwbGljYS8udGVzdCh0dXJuLmNvbnRlbnQudG9Mb3dlckNhc2UoKSkgJiZcbiAgICAgIHJlY2VudFR1cm5zW2luZGV4IC0gMV0/LnJvbGUgPT09ICdhc3Npc3RhbnQnXG4gICAgKVxuICAgIFxuICAgIGlmIChoYXNRdWVzdGlvbkZvbGxvd3VwKSB7XG4gICAgICBzY29yZSArPSAwLjFcbiAgICAgIHNob3VsZFJlZmVyZW5jZSA9IHRydWVcbiAgICAgIHJlZmVyZW5jZVR5cGUgPSAnZm9sbG93dXBfcXVlc3Rpb24nXG4gICAgfVxuICAgIFxuICAgIHJldHVybiB7IFxuICAgICAgc2NvcmU6IE1hdGgubWluKHNjb3JlLCAxLjApLCBcbiAgICAgIHNob3VsZFJlZmVyZW5jZSwgXG4gICAgICByZWZlcmVuY2VUeXBlIFxuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBBZGRzIGNvbnRpbnVpdHkgcmVmZXJlbmNlcyB0byByZXNwb25zZVxuICAgKi9cbiAgcHJpdmF0ZSBzdGF0aWMgYWRkQ29udGludWl0eVJlZmVyZW5jZXMoY29udGVudDogc3RyaW5nLCBjb250ZXh0OiBDb252ZXJzYXRpb25Db250ZXh0KTogc3RyaW5nIHtcbiAgICBjb25zdCByZWNlbnRBc3Npc3RhbnRUdXJucyA9IGNvbnRleHQuY29udmVyc2F0aW9uRmxvd1xuICAgICAgLmZpbHRlcih0dXJuID0+IHR1cm4ucm9sZSA9PT0gJ2Fzc2lzdGFudCcpXG4gICAgICAuc2xpY2UoLTIpXG4gICAgXG4gICAgaWYgKHJlY2VudEFzc2lzdGFudFR1cm5zLmxlbmd0aCA9PT0gMCkgcmV0dXJuIGNvbnRlbnRcbiAgICBcbiAgICBjb25zdCBsYXN0VG9waWMgPSBjb250ZXh0LmN1cnJlbnRUb3BpY1xuICAgIGNvbnN0IGxhc3RTdWJqZWN0ID0gY29udGV4dC5jdXJyZW50U3ViamVjdFxuICAgIFxuICAgIGxldCByZWZlcmVuY2VQcmVmaXggPSAnJ1xuICAgIFxuICAgIGlmIChsYXN0VG9waWMgJiYgbGFzdFN1YmplY3QpIHtcbiAgICAgIHJlZmVyZW5jZVByZWZpeCA9IGBDb250aW51YW5kbyBjb24gJHtsYXN0VG9waWN9IGVuICR7bGFzdFN1YmplY3R9OiBgXG4gICAgfSBlbHNlIGlmIChsYXN0VG9waWMpIHtcbiAgICAgIHJlZmVyZW5jZVByZWZpeCA9IGBTaWd1aWVuZG8gY29uIGVsIHRlbWEgZGUgJHtsYXN0VG9waWN9OiBgXG4gICAgfSBlbHNlIGlmIChsYXN0U3ViamVjdCkge1xuICAgICAgcmVmZXJlbmNlUHJlZml4ID0gYENvbnRpbnVhbmRvIGNvbiAke2xhc3RTdWJqZWN0fTogYFxuICAgIH0gZWxzZSB7XG4gICAgICByZWZlcmVuY2VQcmVmaXggPSBgQ29tbyBtZW5jaW9uw6kgYW50ZXJpb3JtZW50ZTogYFxuICAgIH1cbiAgICBcbiAgICByZXR1cm4gcmVmZXJlbmNlUHJlZml4ICsgY29udGVudFxuICB9XG5cbiAgLyoqXG4gICAqIEdlbmVyYXRlcyBjb250ZXh0dWFsIGZvbGxvdy11cCBzdWdnZXN0aW9uc1xuICAgKi9cbiAgcHJpdmF0ZSBzdGF0aWMgZ2VuZXJhdGVDb250ZXh0dWFsRm9sbG93dXBzKFxuICAgIGNvbnRleHQ6IENvbnZlcnNhdGlvbkNvbnRleHQsIFxuICAgIGxlYXJuaW5nUHJvZmlsZTogYW55XG4gICk6IHN0cmluZ1tdIHtcbiAgICBjb25zdCBmb2xsb3d1cHM6IHN0cmluZ1tdID0gW11cbiAgICBcbiAgICAvLyBCYXNlZCBvbiBjdXJyZW50IHRvcGljL3N1YmplY3RcbiAgICBpZiAoY29udGV4dC5jdXJyZW50VG9waWMpIHtcbiAgICAgIGZvbGxvd3Vwcy5wdXNoKGDCv1RpZW5lcyBtw6FzIHByZWd1bnRhcyBzb2JyZSAke2NvbnRleHQuY3VycmVudFRvcGljfT9gKVxuICAgIH1cbiAgICBcbiAgICBpZiAoY29udGV4dC5jdXJyZW50U3ViamVjdCkge1xuICAgICAgZm9sbG93dXBzLnB1c2goYMK/VGUgZ3VzdGFyw61hIHZlciBlamVyY2ljaW9zIGRlICR7Y29udGV4dC5jdXJyZW50U3ViamVjdH0/YClcbiAgICB9XG4gICAgXG4gICAgLy8gQmFzZWQgb24gbGVhcm5pbmcgc3R5bGVcbiAgICBpZiAobGVhcm5pbmdQcm9maWxlLmFkYXB0YXRpb25QcmVmZXJlbmNlcy5wcmVmZXJzVmlzdWFsQWlkcykge1xuICAgICAgZm9sbG93dXBzLnB1c2goJ8K/VGUgYXl1ZGFyw61hIHZlciB1biBkaWFncmFtYSBkZSBlc3RvPycpXG4gICAgfVxuICAgIFxuICAgIGlmIChsZWFybmluZ1Byb2ZpbGUuYWRhcHRhdGlvblByZWZlcmVuY2VzLnByZWZlcnNJbnRlcmFjdGlvbikge1xuICAgICAgZm9sbG93dXBzLnB1c2goJ8K/UXVpZXJlcyBwcmFjdGljYXIgY29uIHVuIGVqZXJjaWNpbz8nKVxuICAgIH1cbiAgICBcbiAgICAvLyBCYXNlZCBvbiBhY3RpdmUgaW50ZW50aW9uc1xuICAgIGlmIChjb250ZXh0LmFjdGl2ZUludGVudGlvbnMuaW5jbHVkZXMoJ2V4cGxhbmF0aW9uJykpIHtcbiAgICAgIGZvbGxvd3Vwcy5wdXNoKCfCv05lY2VzaXRhcyBxdWUgcHJvZnVuZGljZSBlbiBhbGfDum4gYXNwZWN0byBlc3BlY8OtZmljbz8nKVxuICAgIH1cbiAgICBcbiAgICBpZiAoY29udGV4dC5hY3RpdmVJbnRlbnRpb25zLmluY2x1ZGVzKCdwcm9ibGVtX3NvbHZpbmcnKSkge1xuICAgICAgZm9sbG93dXBzLnB1c2goJ8K/UXVpZXJlcyBxdWUgcmVzb2x2YW1vcyBvdHJvIHByb2JsZW1hIHNpbWlsYXI/JylcbiAgICB9XG4gICAgXG4gICAgLy8gR2VuZXJpYyBjb250ZXh0dWFsIGZvbGxvd3Vwc1xuICAgIGlmIChjb250ZXh0LmNvbnZlcnNhdGlvbkZsb3cubGVuZ3RoID4gMykge1xuICAgICAgZm9sbG93dXBzLnB1c2goJ8K/SGF5IGFsZ28gcXVlIG5vIHF1ZWTDsyBjbGFybz8nKVxuICAgIH1cbiAgICBcbiAgICByZXR1cm4gZm9sbG93dXBzLnNsaWNlKDAsIDMpIC8vIExpbWl0IHRvIDMgc3VnZ2VzdGlvbnNcbiAgfVxuXG4gIC8qKlxuICAgKiBGb3JtYXRzIGNvbnZlcnNhdGlvbiBoaXN0b3J5IGZvciBleHRlcm5hbCBlbmdpbmVzXG4gICAqL1xuICBwcml2YXRlIHN0YXRpYyBmb3JtYXRDb252ZXJzYXRpb25IaXN0b3J5KGNvbnRleHQ6IENvbnZlcnNhdGlvbkNvbnRleHQpOiBBcnJheTx7IHJvbGU6ICd1c2VyJyB8ICdhc3Npc3RhbnQnLCBjb250ZW50OiBzdHJpbmcgfT4ge1xuICAgIHJldHVybiBjb250ZXh0LmNvbnZlcnNhdGlvbkZsb3dcbiAgICAgIC5zbGljZSgtMTApIC8vIExhc3QgMTAgdHVybnNcbiAgICAgIC5tYXAodHVybiA9PiAoe1xuICAgICAgICByb2xlOiB0dXJuLnJvbGUsXG4gICAgICAgIGNvbnRlbnQ6IHR1cm4uY29udGVudFxuICAgICAgfSkpXG4gIH1cblxuICAvKipcbiAgICogTWFpbnRhaW5zIGNvbnRleHQgbWVtb3J5IGJ5IGNsZWFuaW5nIG9sZCBkYXRhXG4gICAqL1xuICBwcml2YXRlIHN0YXRpYyBtYWludGFpbkNvbnRleHRNZW1vcnkoY29udGV4dDogQ29udmVyc2F0aW9uQ29udGV4dCk6IHZvaWQge1xuICAgIC8vIEtlZXAgb25seSByZWNlbnQgdHVybnNcbiAgICBpZiAoY29udGV4dC5jb252ZXJzYXRpb25GbG93Lmxlbmd0aCA+IHRoaXMuTUFYX1RVUk5TX1JFVEFJTkVEKSB7XG4gICAgICBjb250ZXh0LmNvbnZlcnNhdGlvbkZsb3cgPSBjb250ZXh0LmNvbnZlcnNhdGlvbkZsb3cuc2xpY2UoLXRoaXMuTUFYX1RVUk5TX1JFVEFJTkVEKVxuICAgIH1cbiAgICBcbiAgICAvLyBDbGVhbiBvbGQgcmVmZXJlbmNlc1xuICAgIGNvbnN0IGN1dG9mZlRpbWUgPSBuZXcgRGF0ZShEYXRlLm5vdygpIC0gKDEyICogNjAgKiA2MCAqIDEwMDApKSAvLyAxMiBob3Vyc1xuICAgIGNvbnRleHQucmVmZXJlbmNlTWVtb3J5ID0gY29udGV4dC5yZWZlcmVuY2VNZW1vcnkuZmlsdGVyKFxuICAgICAgcmVmID0+IHJlZi50aW1lc3RhbXAgPiBjdXRvZmZUaW1lXG4gICAgKVxuICAgIFxuICAgIC8vIENsZWFuIG9sZCBpbnRlbnRpb25zXG4gICAgaWYgKGNvbnRleHQuYWN0aXZlSW50ZW50aW9ucy5sZW5ndGggPiAzKSB7XG4gICAgICBjb250ZXh0LmFjdGl2ZUludGVudGlvbnMgPSBjb250ZXh0LmFjdGl2ZUludGVudGlvbnMuc2xpY2UoLTMpXG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEdldHMgY29udmVyc2F0aW9uIHN0YXRpc3RpY3MgdXNpbmcgcGVyc2lzdGVudCBzdG9yYWdlXG4gICAqL1xuICBzdGF0aWMgZ2V0Q29udmVyc2F0aW9uU3RhdHModXNlcklkPzogc3RyaW5nKTogYW55IHtcbiAgICBjb25zdCB7IGdldFVzZXJBY3RpdmVTZXNzaW9ucyB9ID0gcmVxdWlyZSgnLi90ZW1wLXN0b3JhZ2UnKVxuICAgIFxuICAgIGlmICh1c2VySWQpIHtcbiAgICAgIGNvbnN0IHVzZXJTZXNzaW9ucyA9IGdldFVzZXJBY3RpdmVTZXNzaW9ucyh1c2VySWQpXG4gICAgICBcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGFjdGl2ZUNvbnRleHRzOiB1c2VyU2Vzc2lvbnMubGVuZ3RoLFxuICAgICAgICB0b3RhbFR1cm5zOiB1c2VyU2Vzc2lvbnMucmVkdWNlKChzdW06IG51bWJlciwgc2Vzc2lvbjogYW55KSA9PiBzdW0gKyBzZXNzaW9uLnR1cm5zLmxlbmd0aCwgMCksXG4gICAgICAgIGN1cnJlbnRUb3BpY3M6IFsuLi5uZXcgU2V0KHVzZXJTZXNzaW9ucy5tYXAoKHNlc3Npb246IGFueSkgPT4gc2Vzc2lvbi5jdXJyZW50VG9waWMpLmZpbHRlcihCb29sZWFuKSldLFxuICAgICAgICBjdXJyZW50U3ViamVjdHM6IFsuLi5uZXcgU2V0KHVzZXJTZXNzaW9ucy5tYXAoKHNlc3Npb246IGFueSkgPT4gc2Vzc2lvbi5jdXJyZW50U3ViamVjdCkuZmlsdGVyKEJvb2xlYW4pKV1cbiAgICAgIH1cbiAgICB9XG4gICAgXG4gICAgLy8gRm9yIGdsb2JhbCBzdGF0cywgd2UgbmVlZCB0byBpbXBvcnQgdGhlIGNvbnZlcnNhdGlvbnMgYXJyYXlcbiAgICBjb25zdCB7IHRlbXBDb252ZXJzYXRpb25zIH0gPSByZXF1aXJlKCcuL3RlbXAtc3RvcmFnZScpXG4gICAgY29uc3QgYWN0aXZlQ29udmVyc2F0aW9ucyA9IHRlbXBDb252ZXJzYXRpb25zLmZpbHRlcigoc2Vzc2lvbjogYW55KSA9PiB7XG4gICAgICBjb25zdCBvbmVIb3VyQWdvID0gbmV3IERhdGUoRGF0ZS5ub3coKSAtICg2MCAqIDYwICogMTAwMCkpXG4gICAgICByZXR1cm4gc2Vzc2lvbi5sYXN0VXBkYXRlID4gb25lSG91ckFnb1xuICAgIH0pXG4gICAgXG4gICAgcmV0dXJuIHtcbiAgICAgIHRvdGFsQWN0aXZlQ29udGV4dHM6IGFjdGl2ZUNvbnZlcnNhdGlvbnMubGVuZ3RoLFxuICAgICAgdG90YWxVc2VyczogbmV3IFNldChhY3RpdmVDb252ZXJzYXRpb25zLm1hcCgoc2Vzc2lvbjogYW55KSA9PiBzZXNzaW9uLnVzZXJJZCkpLnNpemUsXG4gICAgICBhdmVyYWdlQ29udGV4dEFnZTogdGhpcy5jYWxjdWxhdGVBdmVyYWdlQ29udGV4dEFnZUZyb21TZXNzaW9ucyhhY3RpdmVDb252ZXJzYXRpb25zKVxuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBDYWxjdWxhdGVzIGF2ZXJhZ2UgY29udGV4dCBhZ2UgZnJvbSBwZXJzaXN0ZW50IHNlc3Npb25zXG4gICAqL1xuICBwcml2YXRlIHN0YXRpYyBjYWxjdWxhdGVBdmVyYWdlQ29udGV4dEFnZUZyb21TZXNzaW9ucyhzZXNzaW9uczogYW55W10pOiBudW1iZXIge1xuICAgIGlmIChzZXNzaW9ucy5sZW5ndGggPT09IDApIHJldHVybiAwXG4gICAgXG4gICAgY29uc3Qgbm93ID0gRGF0ZS5ub3coKVxuICAgIGNvbnN0IHRvdGFsQWdlID0gc2Vzc2lvbnMucmVkdWNlKChzdW06IG51bWJlciwgc2Vzc2lvbjogYW55KSA9PiBcbiAgICAgIHN1bSArIChub3cgLSBuZXcgRGF0ZShzZXNzaW9uLmxhc3RVcGRhdGUpLmdldFRpbWUoKSksIDApXG4gICAgXG4gICAgcmV0dXJuIE1hdGgucm91bmQodG90YWxBZ2UgLyBzZXNzaW9ucy5sZW5ndGggLyAoNjAgKiAxMDAwKSkgLy8gQXZlcmFnZSBhZ2UgaW4gbWludXRlc1xuICB9XG5cbiAgLyoqXG4gICAqIEZvcmNlcyBjbGVhbnVwIG9mIGFsbCBjb250ZXh0cyAodXNlZnVsIGZvciB0ZXN0aW5nKVxuICAgKi9cbiAgc3RhdGljIGNsZWFyQWxsQ29udGV4dHMoKTogdm9pZCB7XG4gICAgY29uc3QgeyBjbGVhbnVwT2xkQ29udmVyc2F0aW9ucyB9ID0gcmVxdWlyZSgnLi90ZW1wLXN0b3JhZ2UnKVxuICAgIGNsZWFudXBPbGRDb252ZXJzYXRpb25zKClcbiAgICBjb25zb2xlLmxvZygn8J+nuSBBbGwgY29udmVyc2F0aW9uIGNvbnRleHRzIGNsZWFyZWQgdXNpbmcgcGVyc2lzdGVudCBzdG9yYWdlJylcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXRzIGFjdGl2ZSBjb250ZXh0IGZvciB1c2VyICh1c2VmdWwgZm9yIGRlYnVnZ2luZylcbiAgICovXG4gIHN0YXRpYyBnZXRBY3RpdmVDb250ZXh0KHVzZXJJZDogc3RyaW5nLCBzZXNzaW9uSWQ/OiBzdHJpbmcpOiBDb252ZXJzYXRpb25Db250ZXh0IHwgbnVsbCB7XG4gICAgY29uc3QgeyBnZXRDb252ZXJzYXRpb25TZXNzaW9uLCBnZXRVc2VyQWN0aXZlU2Vzc2lvbnMgfSA9IHJlcXVpcmUoJy4vdGVtcC1zdG9yYWdlJylcbiAgICBcbiAgICBpZiAoc2Vzc2lvbklkKSB7XG4gICAgICBjb25zdCBzZXNzaW9uID0gZ2V0Q29udmVyc2F0aW9uU2Vzc2lvbih1c2VySWQsIHNlc3Npb25JZClcbiAgICAgIGlmIChzZXNzaW9uKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgdXNlcklkOiBzZXNzaW9uLnVzZXJJZCxcbiAgICAgICAgICBzZXNzaW9uSWQ6IHNlc3Npb24uc2Vzc2lvbklkLFxuICAgICAgICAgIGN1cnJlbnRUb3BpYzogc2Vzc2lvbi5jdXJyZW50VG9waWMsXG4gICAgICAgICAgY3VycmVudFN1YmplY3Q6IHNlc3Npb24uY3VycmVudFN1YmplY3QsXG4gICAgICAgICAgY29udmVyc2F0aW9uRmxvdzogc2Vzc2lvbi50dXJucyxcbiAgICAgICAgICBjb250ZXh0U3VtbWFyeTogdGhpcy5idWlsZENvbnRleHRTdW1tYXJ5KHNlc3Npb24pLFxuICAgICAgICAgIGFjdGl2ZUludGVudGlvbnM6IHRoaXMuZXh0cmFjdEFjdGl2ZUludGVudGlvbnMoc2Vzc2lvbi50dXJucy5zbGljZSgtNSkpLFxuICAgICAgICAgIHBlbmRpbmdRdWVzdGlvbnM6IFtdLFxuICAgICAgICAgIHJlZmVyZW5jZU1lbW9yeTogdGhpcy5idWlsZFJlZmVyZW5jZU1lbW9yeShzZXNzaW9uLnR1cm5zKSxcbiAgICAgICAgICBsYXN0VXBkYXRlOiBzZXNzaW9uLmxhc3RVcGRhdGVcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICBcbiAgICAvLyBGaW5kIGFueSBhY3RpdmUgc2Vzc2lvbiBmb3IgdXNlclxuICAgIGNvbnN0IGFjdGl2ZVNlc3Npb25zID0gZ2V0VXNlckFjdGl2ZVNlc3Npb25zKHVzZXJJZClcbiAgICBpZiAoYWN0aXZlU2Vzc2lvbnMubGVuZ3RoID4gMCkge1xuICAgICAgY29uc3Qgc2Vzc2lvbiA9IGFjdGl2ZVNlc3Npb25zWzBdXG4gICAgICByZXR1cm4ge1xuICAgICAgICB1c2VySWQ6IHNlc3Npb24udXNlcklkLFxuICAgICAgICBzZXNzaW9uSWQ6IHNlc3Npb24uc2Vzc2lvbklkLFxuICAgICAgICBjdXJyZW50VG9waWM6IHNlc3Npb24uY3VycmVudFRvcGljLFxuICAgICAgICBjdXJyZW50U3ViamVjdDogc2Vzc2lvbi5jdXJyZW50U3ViamVjdCxcbiAgICAgICAgY29udmVyc2F0aW9uRmxvdzogc2Vzc2lvbi50dXJucyxcbiAgICAgICAgY29udGV4dFN1bW1hcnk6IHRoaXMuYnVpbGRDb250ZXh0U3VtbWFyeShzZXNzaW9uKSxcbiAgICAgICAgYWN0aXZlSW50ZW50aW9uczogdGhpcy5leHRyYWN0QWN0aXZlSW50ZW50aW9ucyhzZXNzaW9uLnR1cm5zLnNsaWNlKC01KSksXG4gICAgICAgIHBlbmRpbmdRdWVzdGlvbnM6IFtdLFxuICAgICAgICByZWZlcmVuY2VNZW1vcnk6IHRoaXMuYnVpbGRSZWZlcmVuY2VNZW1vcnkoc2Vzc2lvbi50dXJucyksXG4gICAgICAgIGxhc3RVcGRhdGU6IHNlc3Npb24ubGFzdFVwZGF0ZVxuICAgICAgfVxuICAgIH1cbiAgICBcbiAgICByZXR1cm4gbnVsbFxuICB9XG59XG5cbi8vIFBlcnNpc3RlbnQgc3RvcmFnZSBjbGVhbnVwIGlzIGhhbmRsZWQgYnkgdGVtcC1zdG9yYWdlLnRzXG4vLyBObyBuZWVkIGZvciBhZGRpdGlvbmFsIGNsZWFudXAgaW50ZXJ2YWxzIl0sIm5hbWVzIjpbIkFkdmFuY2VkTGVhcm5pbmdQcm9maWxlTWFuYWdlciIsIlZpc3VhbExlYXJuaW5nRW5naW5lIiwiQUlDYWxlbmRhckludGVncmF0aW9uIiwiQ29udGV4dHVhbENvbnZlcnNhdGlvbk1hbmFnZXIiLCJNQVhfVFVSTlNfUkVUQUlORUQiLCJNQVhfUkVGRVJFTkNFUyIsIkNPTlRFWFRfREVDQVlfSE9VUlMiLCJwcm9jZXNzQ29udGV4dHVhbE1lc3NhZ2UiLCJ1c2VySWQiLCJtZXNzYWdlIiwic2Vzc2lvbklkIiwidXNlck5hbWUiLCJhY3R1YWxTZXNzaW9uSWQiLCJEYXRlIiwibm93IiwiZ2V0Q29udmVyc2F0aW9uU2Vzc2lvbiIsImNyZWF0ZUNvbnZlcnNhdGlvblNlc3Npb24iLCJhZGRDb252ZXJzYXRpb25UdXJuIiwiYWRkUGVuZGluZ1Rhc2siLCJnZXRQZW5kaW5nVGFza3MiLCJyZXF1aXJlIiwic2Vzc2lvbiIsImNvbnNvbGUiLCJsb2ciLCJzdWJzdHJpbmciLCJ0dXJucyIsImxlbmd0aCIsInBlbmRpbmdUYXNrcyIsImZpbHRlciIsInQiLCJjb21wbGV0ZWQiLCJtZXNzYWdlTWV0YWRhdGEiLCJhbmFseXplTWVzc2FnZU1ldGFkYXRhIiwiY29udGV4dCIsImN1cnJlbnRUb3BpYyIsImN1cnJlbnRTdWJqZWN0IiwiY29udmVyc2F0aW9uRmxvdyIsIm1hcCIsInR1cm4iLCJpZCIsInRpbWVzdGFtcCIsInJvbGUiLCJjb250ZW50IiwibWV0YWRhdGEiLCJjb250ZXh0U3VtbWFyeSIsImJ1aWxkQ29udGV4dFN1bW1hcnkiLCJhY3RpdmVJbnRlbnRpb25zIiwiZXh0cmFjdEFjdGl2ZUludGVudGlvbnMiLCJzbGljZSIsInBlbmRpbmdRdWVzdGlvbnMiLCJyZWZlcmVuY2VNZW1vcnkiLCJidWlsZFJlZmVyZW5jZU1lbW9yeSIsImxhc3RVcGRhdGUiLCJyZXNwb25zZSIsImdlbmVyYXRlQ29udGV4dHVhbFJlc3BvbnNlIiwiYXNzaXN0YW50TWV0YWRhdGEiLCJjb25maWRlbmNlIiwiY29udGludWl0eVNjb3JlIiwidmlzdWFsc0dlbmVyYXRlZCIsInZpc3VhbFJlY29tbWVuZGF0aW9uIiwic2VhcmNoUGVyZm9ybWVkIiwicGVyc29uYWxpemF0aW9ucyIsImluY2x1ZGVzIiwidGFza0NvbXBsZXRlZCIsInJlY2VudFR1cm5zIiwia2V5VG9waWNzIiwiU2V0IiwidG9waWMiLCJCb29sZWFuIiwia2V5U3ViamVjdHMiLCJzdWJqZWN0Iiwic3VtbWFyeVBhcnRzIiwicHVzaCIsImpvaW4iLCJpbnRlbnRpb25zIiwiaW50ZW50aW9uIiwicmVmZXJlbmNlcyIsImZvckVhY2giLCJpbmRleCIsInR5cGUiLCJkZXRlcm1pbmVSZWZlcmVuY2VUeXBlRnJvbU1ldGFkYXRhIiwicmVsZXZhbmNlU2NvcmUiLCJ0dXJuSW5kZXgiLCJoYW5kbGVDYWxlbmRhclRhc2tzIiwiY29udmVyc2F0aW9uSGlzdG9yeSIsImNhbGVuZGFySW50ZWdyYXRpb24iLCJjYWxlbmRhclJlc3VsdCIsInByb2Nlc3NNZXNzYWdlIiwibmVlZHNFdmVudENyZWF0aW9uIiwiY2FsZW5kYXJUYXNrIiwiZmluZCIsIm1hcmtUYXNrQ29tcGxldGVkIiwic3VnZ2VzdGVkQWN0aW9ucyIsImV2ZW50IiwiZXZlbnRDcmVhdGVkIiwiYnVpbGRFZHVjYXRpb25hbFByb21wdCIsImNvbnZlcnNhdGlvbkNvbnRleHQiLCJwcm9tcHQiLCJnZW5lcmF0ZUNvbnRleHR1YWxGYWxsYmFjayIsIm1zZ0xvd2VyIiwidG9Mb3dlckNhc2UiLCJ0ZXN0IiwidG9waWNNYXRjaGVzIiwibWF0Y2giLCJNYXRoIiwibWluIiwidXBkYXRlQ29udGV4dHVhbEluZm9ybWF0aW9uIiwibGFzdEFzc2lzdGFudFR1cm4iLCJyZXZlcnNlIiwic2hpZnQiLCJyZWZlcmVuY2UiLCJkZXRlcm1pbmVSZWZlcmVuY2VUeXBlIiwic29ydCIsImEiLCJiIiwidXBkYXRlQ29udGV4dFN1bW1hcnkiLCJsZWFybmluZ1Byb2ZpbGUiLCJnZXRMZWFybmluZ1Byb2ZpbGUiLCJsYXRlc3RNZXNzYWdlIiwicHJvY2Vzc1VzZXJNZXNzYWdlIiwiY29udGludWl0eUFuYWx5c2lzIiwiYW5hbHl6ZUNvbnRpbnVpdHkiLCJmb3JtYXRDb252ZXJzYXRpb25IaXN0b3J5Iiwic3VnZ2VzdGVkRm9sbG93dXBzIiwiYWlTZXJ2aWNlIiwiYmFzZUNvbnRlbnQiLCJlZHVjYXRpb25hbFByb21wdCIsImdlbmVyYXRlRXhlcmNpc2UiLCJlcnJvciIsImVuaGFuY2VkQ29udGVudCIsInNob3VsZFJlZmVyZW5jZSIsImFkZENvbnRpbnVpdHlSZWZlcmVuY2VzIiwiYWRhcHRSZXNwb25zZVRvTGVhcm5pbmdTdHlsZSIsInByaW1hcnlTdHlsZSIsImFkYXB0YXRpb25QcmVmZXJlbmNlcyIsInByZWZlcnNWaXN1YWxBaWRzIiwiZGV0ZWN0T3B0aW1hbFZpc3VhbFR5cGUiLCJyZWFzb24iLCJmb2xsb3d1cHMiLCJnZW5lcmF0ZUNvbnRleHR1YWxGb2xsb3d1cHMiLCJzY29yZSIsInJlZmVyZW5jZVR5cGUiLCJ0b3BpY3MiLCJzdWJqZWN0cyIsImhhc1F1ZXN0aW9uRm9sbG93dXAiLCJzb21lIiwicmVjZW50QXNzaXN0YW50VHVybnMiLCJsYXN0VG9waWMiLCJsYXN0U3ViamVjdCIsInJlZmVyZW5jZVByZWZpeCIsInByZWZlcnNJbnRlcmFjdGlvbiIsIm1haW50YWluQ29udGV4dE1lbW9yeSIsImN1dG9mZlRpbWUiLCJyZWYiLCJnZXRDb252ZXJzYXRpb25TdGF0cyIsImdldFVzZXJBY3RpdmVTZXNzaW9ucyIsInVzZXJTZXNzaW9ucyIsImFjdGl2ZUNvbnRleHRzIiwidG90YWxUdXJucyIsInJlZHVjZSIsInN1bSIsImN1cnJlbnRUb3BpY3MiLCJjdXJyZW50U3ViamVjdHMiLCJ0ZW1wQ29udmVyc2F0aW9ucyIsImFjdGl2ZUNvbnZlcnNhdGlvbnMiLCJvbmVIb3VyQWdvIiwidG90YWxBY3RpdmVDb250ZXh0cyIsInRvdGFsVXNlcnMiLCJzaXplIiwiYXZlcmFnZUNvbnRleHRBZ2UiLCJjYWxjdWxhdGVBdmVyYWdlQ29udGV4dEFnZUZyb21TZXNzaW9ucyIsInNlc3Npb25zIiwidG90YWxBZ2UiLCJnZXRUaW1lIiwicm91bmQiLCJjbGVhckFsbENvbnRleHRzIiwiY2xlYW51cE9sZENvbnZlcnNhdGlvbnMiLCJnZXRBY3RpdmVDb250ZXh0IiwiYWN0aXZlU2Vzc2lvbnMiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/contextual-conversation-manager.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/conversation-engine.ts":
/*!****************************************!*\
  !*** ./src/lib/conversation-engine.ts ***!
  \****************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   ConversationEngine: () => (/* binding */ ConversationEngine)\n/* harmony export */ });\n/* harmony import */ var _academic_analyzer__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./academic-analyzer */ \"(rsc)/./src/lib/academic-analyzer.ts\");\n/* harmony import */ var _ai_providers__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./ai-providers */ \"(rsc)/./src/lib/ai-providers.ts\");\n/* harmony import */ var _exercise_solver__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./exercise-solver */ \"(rsc)/./src/lib/exercise-solver.ts\");\n/* harmony import */ var _calendar_ai_integration__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./calendar-ai-integration */ \"(rsc)/./src/lib/calendar-ai-integration.ts\");\n/* harmony import */ var _notification_service__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./notification-service */ \"(rsc)/./src/lib/notification-service.ts\");\n/* harmony import */ var _academic_search_engine__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./academic-search-engine */ \"(rsc)/./src/lib/academic-search-engine.ts\");\n\n\n\n\n\n\nclass ConversationEngine {\n    /**\n   * Procesa un mensaje del usuario de forma stateless\n   */ static async processUserMessage(userId, message, userName, conversationHistory) {\n        // Use contextual conversation manager for better coherence\n        try {\n            const { ContextualConversationManager } = __webpack_require__(/*! ./contextual-conversation-manager */ \"(rsc)/./src/lib/contextual-conversation-manager.ts\");\n            const contextualResponse = await ContextualConversationManager.processContextualMessage(userId, message, undefined, userName);\n            return {\n                id: `ai_${Date.now()}`,\n                type: 'ai',\n                content: contextualResponse.content,\n                timestamp: new Date(),\n                metadata: {\n                    subject: contextualResponse.context.currentSubject,\n                    suggestedActions: contextualResponse.suggestedFollowups.concat(contextualResponse.visualRecommendation ? [\n                        `Generar ${contextualResponse.visualRecommendation.type}`\n                    ] : [])\n                }\n            };\n        } catch (error) {\n            console.log('Fallback to basic conversation engine:', error);\n        // Fallback to original stateless processing\n        }\n        // Cargar análisis académico en cada request (stateless)\n        const academicAnalysis = await _academic_analyzer__WEBPACK_IMPORTED_MODULE_0__.AcademicAnalyzer.analyzeStudent(userId);\n        // Verificar comandos de calendario (editar, eliminar, listar)\n        const calendarAdminResult = await this.handleCalendarAdminCommands(userId, message);\n        if (calendarAdminResult) {\n            return calendarAdminResult;\n        }\n        // Verificar si hay un calendario de integración en curso\n        const calendarIntegration = new _calendar_ai_integration__WEBPACK_IMPORTED_MODULE_3__.AICalendarIntegration(userId);\n        // Analizar si se mencionan eventos que requieren creación en calendario\n        const conversationForCalendar = conversationHistory || [];\n        const calendarResult = await calendarIntegration.processMessage(message, conversationForCalendar);\n        if (calendarResult.needsEventCreation) {\n            return {\n                id: `ai_${Date.now()}`,\n                type: 'ai',\n                content: calendarResult.response || '',\n                timestamp: new Date(),\n                metadata: {\n                    suggestedActions: calendarResult.event ? [\n                        'Ver en calendario',\n                        'Editar evento',\n                        'Eliminar evento'\n                    ] : [\n                        'Reintentar',\n                        'Proporcionar más detalles'\n                    ]\n                }\n            };\n        }\n        // Analizar intención del usuario (stateless)\n        const intent = this.analyzeUserIntent(message, academicAnalysis);\n        // Generar respuesta basada en la intención\n        let aiResponse;\n        switch(intent.type){\n            case 'solve_exercise':\n                aiResponse = await this.handleExerciseSolution(message, intent.subject, academicAnalysis, userName);\n                break;\n            case 'request_assessment':\n                aiResponse = await this.handleAssessmentRequest(intent.subject, academicAnalysis, userName);\n                break;\n            case 'ask_question':\n                aiResponse = await this.handleEducationalQuestion(message, intent.subject, academicAnalysis, userName);\n                break;\n            case 'academic_search':\n                aiResponse = await this.handleAcademicSearch(message, intent.subject, intent.topic, userId, userName);\n                break;\n            case 'request_help':\n                aiResponse = await this.handleHelpRequest(intent.topic, academicAnalysis, userName);\n                break;\n            case 'casual_chat':\n                aiResponse = await this.handleCasualChat(message, userName);\n                break;\n            default:\n                aiResponse = await this.handleGeneralResponse(message);\n        }\n        // This fallback should never be reached due to the try/catch above\n        console.error('❌ CRITICAL: Reached unreachable fallback code in conversation engine');\n        throw new Error('Fallback code should not be reachable');\n    }\n    /**\n   * Legacy method for backward compatibility - redirects to contextual manager\n   */ static async processUserMessageLegacy(userId, message, userName, conversationHistory) {\n        console.log('⚠️ Using legacy method - redirecting to main processUserMessage');\n        return this.processUserMessage(userId, message, userName, conversationHistory);\n    }\n    /**\n   * Analiza la intención del usuario (stateless)\n   */ static analyzeUserIntent(message, academicAnalysis) {\n        const msgLower = message.toLowerCase();\n        // PRIMERA PRIORIDAD: Detectar si es un ejercicio para resolver\n        const exerciseDetection = _exercise_solver__WEBPACK_IMPORTED_MODULE_2__.ExerciseSolver.detectExercise(message);\n        if (exerciseDetection.hasExercise && exerciseDetection.confidence > 0.6) {\n            // Mapear subjects del ExerciseSolver a AcademicSubject\n            const subjectMap = {\n                'physics': _academic_analyzer__WEBPACK_IMPORTED_MODULE_0__.AcademicSubject.PHYSICS,\n                'chemistry': _academic_analyzer__WEBPACK_IMPORTED_MODULE_0__.AcademicSubject.CHEMISTRY,\n                'mathematics': _academic_analyzer__WEBPACK_IMPORTED_MODULE_0__.AcademicSubject.MATHEMATICS,\n                'general': _academic_analyzer__WEBPACK_IMPORTED_MODULE_0__.AcademicSubject.GENERAL\n            };\n            return {\n                type: 'solve_exercise',\n                subject: subjectMap[exerciseDetection.subject],\n                confidence: exerciseDetection.confidence\n            };\n        }\n        // Detectar solicitud de evaluación\n        if (msgLower.includes('evaluación') || msgLower.includes('evaluar') || msgLower.includes('examen') || msgLower.includes('prueba') || msgLower.includes('ejercicio') || msgLower.includes('practicar')) {\n            const subject = this.detectSubject(message);\n            return {\n                type: 'request_assessment',\n                subject,\n                confidence: 0.8\n            };\n        }\n        // Detectar pregunta educativa\n        if (msgLower.includes('¿') || msgLower.includes('cómo') || msgLower.includes('qué es') || msgLower.includes('explica') || msgLower.includes('no entiendo')) {\n            const subject = this.detectSubject(message);\n            return {\n                type: 'ask_question',\n                subject,\n                confidence: 0.7\n            };\n        }\n        // Detectar búsqueda académica\n        if (msgLower.includes('busca') || msgLower.includes('buscar') || msgLower.includes('encuentra') || msgLower.includes('encontrar') || msgLower.includes('necesito información') || msgLower.includes('recursos sobre') || msgLower.includes('material de') || msgLower.includes('ejemplos de')) {\n            const subject = this.detectSubject(message);\n            const topic = this.extractTopic(message);\n            return {\n                type: 'academic_search',\n                subject,\n                topic,\n                confidence: 0.8\n            };\n        }\n        // Detectar solicitud de ayuda\n        if (msgLower.includes('ayuda') || msgLower.includes('difícil') || msgLower.includes('no puedo') || msgLower.includes('me cuesta')) {\n            const topic = this.extractTopic(message);\n            return {\n                type: 'request_help',\n                topic,\n                confidence: 0.6\n            };\n        }\n        // Detectar charla casual\n        if (msgLower.includes('hola') || msgLower.includes('gracias') || msgLower.includes('bien') || msgLower.includes('mal')) {\n            return {\n                type: 'casual_chat',\n                confidence: 0.5\n            };\n        }\n        return {\n            type: 'general',\n            confidence: 0.3\n        };\n    }\n    /**\n   * Detecta la materia mencionada en el mensaje\n   */ static detectSubject(message) {\n        const msgLower = message.toLowerCase();\n        if (msgLower.includes('matemática') || msgLower.includes('álgebra') || msgLower.includes('geometría') || msgLower.includes('cálculo')) {\n            return _academic_analyzer__WEBPACK_IMPORTED_MODULE_0__.AcademicSubject.MATHEMATICS;\n        }\n        if (msgLower.includes('física') || msgLower.includes('mecánica') || msgLower.includes('energía') || msgLower.includes('fuerza')) {\n            return _academic_analyzer__WEBPACK_IMPORTED_MODULE_0__.AcademicSubject.PHYSICS;\n        }\n        if (msgLower.includes('química') || msgLower.includes('átomo') || msgLower.includes('reacción') || msgLower.includes('elemento')) {\n            return _academic_analyzer__WEBPACK_IMPORTED_MODULE_0__.AcademicSubject.CHEMISTRY;\n        }\n        return undefined;\n    }\n    /**\n   * Extrae el tema específico del mensaje\n   */ static extractTopic(message) {\n        // Extraer palabras clave que podrían ser temas\n        const words = message.toLowerCase().split(' ');\n        const topics = [\n            'ecuaciones',\n            'funciones',\n            'derivadas',\n            'integrales',\n            'geometría',\n            'cinemática',\n            'dinámica',\n            'termodinámica',\n            'electricidad',\n            'átomos',\n            'moléculas',\n            'enlaces',\n            'reacciones'\n        ];\n        const foundTopic = topics.find((topic)=>words.includes(topic));\n        return foundTopic || 'tema general';\n    }\n    /**\n   * Maneja la resolución de ejercicios paso a paso (stateless)\n   */ static async handleExerciseSolution(message, subject, academicAnalysis, userName) {\n        // Mapear AcademicSubject a los subjects del ExerciseSolver\n        const subjectMap = {\n            [_academic_analyzer__WEBPACK_IMPORTED_MODULE_0__.AcademicSubject.PHYSICS]: 'physics',\n            [_academic_analyzer__WEBPACK_IMPORTED_MODULE_0__.AcademicSubject.CHEMISTRY]: 'chemistry',\n            [_academic_analyzer__WEBPACK_IMPORTED_MODULE_0__.AcademicSubject.MATHEMATICS]: 'mathematics',\n            [_academic_analyzer__WEBPACK_IMPORTED_MODULE_0__.AcademicSubject.GENERAL]: 'general'\n        };\n        const solverSubject = subjectMap[subject] || 'general';\n        // Obtener contexto del estudiante\n        const studentContext = _academic_analyzer__WEBPACK_IMPORTED_MODULE_0__.AcademicAnalyzer.getExerciseContext(academicAnalysis, subject);\n        try {\n            const solution = await _exercise_solver__WEBPACK_IMPORTED_MODULE_2__.ExerciseSolver.solveExercise(message, solverSubject, studentContext);\n            return {\n                id: `ai_${Date.now()}`,\n                type: 'ai',\n                content: solution.solution,\n                timestamp: new Date(),\n                metadata: {\n                    subject: this.getSubjectName(subject),\n                    suggestedActions: [\n                        'Explicar un paso específico',\n                        'Resolver otro ejercicio similar',\n                        'Verificar mi solución',\n                        'Practicar más ejercicios'\n                    ]\n                }\n            };\n        } catch (error) {\n            console.error('Error solving exercise:', error);\n            return {\n                id: `ai_${Date.now()}`,\n                type: 'ai',\n                content: `He detectado que quieres resolver un ejercicio de ${this.getSubjectName(subject)}.\\n\\n` + `Estoy teniendo dificultades técnicas para resolverlo ahora mismo, pero puedo ayudarte de otras maneras:\\n\\n` + `• Te puedo guiar paso a paso en la metodología\\n` + `• Puedo explicarte los conceptos que necesitas\\n` + `• Te ayudo a organizar los datos del problema\\n\\n` + `¿Te gustaría que empecemos con alguno de estos enfoques?`,\n                timestamp: new Date(),\n                metadata: {\n                    subject: this.getSubjectName(subject),\n                    suggestedActions: [\n                        'Guiar metodología',\n                        'Explicar conceptos',\n                        'Organizar datos'\n                    ]\n                }\n            };\n        }\n    }\n    /**\n   * Maneja solicitudes de evaluación (stateless)\n   */ static async handleAssessmentRequest(subject, academicAnalysis, userName) {\n        const subjectAnalysis = academicAnalysis.subjects.find((s)=>s.subject === subject);\n        let content = `¡Perfecto! Vamos a hacer una evaluación adaptativa de ${this.getSubjectName(subject)}.\\n\\n`;\n        if (subjectAnalysis) {\n            content += `Basándome en tu progreso actual (${subjectAnalysis.performance}%), `;\n            if (subjectAnalysis.needsAttention) {\n                content += `veo que has tenido algunas dificultades con: ${subjectAnalysis.specificChallenges.join(', ')}.\\n\\n`;\n                content += `Empezaremos con ejercicios de refuerzo para fortalecer estos conceptos.`;\n            } else {\n                content += `tienes un buen dominio. Te propongo ejercicios que te desafíen un poco más.`;\n            }\n        } else {\n            content += `Como no tengo datos previos sobre tu desempeño en esta materia, empezaremos con una evaluación diagnóstica.`;\n        }\n        content += `\\n\\n¿Estás listo para comenzar? Puedes decirme si prefieres:\\n`;\n        content += `• Ejercicios paso a paso\\n`;\n        content += `• Preguntas de opción múltiple\\n`;\n        content += `• Problemas para resolver`;\n        return {\n            id: `ai_${Date.now()}`,\n            type: 'ai',\n            content,\n            timestamp: new Date(),\n            metadata: {\n                subject,\n                suggestedActions: [\n                    'Comenzar ejercicios paso a paso',\n                    'Preguntas opción múltiple',\n                    'Problemas para resolver'\n                ]\n            }\n        };\n    }\n    /**\n   * Maneja preguntas educativas (stateless)\n   */ static async handleEducationalQuestion(question, subject, academicAnalysis, userName) {\n        // Crear prompt contextualizado para la IA\n        const analysisContext = _academic_analyzer__WEBPACK_IMPORTED_MODULE_0__.AcademicAnalyzer.getExerciseContext(academicAnalysis, subject);\n        const prompt = `Eres un tutor educativo experto. Responde esta pregunta de un estudiante de secundaria:\n\nPregunta: \"${question}\"\n\nContexto del estudiante: ${analysisContext}\n\nInstrucciones:\n- Responde de manera clara y didáctica\n- Usa ejemplos concretos y relevantes\n- Adapta el lenguaje al nivel del estudiante\n- Si es un concepto complejo, divídelo en pasos simples\n- Ofrece al final preguntarle si quiere practicar con ejercicios\n\nRespuesta:`;\n        try {\n            const aiResponse = await _ai_providers__WEBPACK_IMPORTED_MODULE_1__.aiService.generateExercise(prompt);\n            return {\n                id: `ai_${Date.now()}`,\n                type: 'ai',\n                content: aiResponse === 'TEMPLATE_FALLBACK' ? this.getFallbackEducationalResponse(question, subject) : aiResponse,\n                timestamp: new Date(),\n                metadata: {\n                    subject,\n                    suggestedActions: [\n                        'Practicar con ejercicios',\n                        'Hacer más preguntas',\n                        'Explicación más detallada'\n                    ]\n                }\n            };\n        } catch (error) {\n            return {\n                id: `ai_${Date.now()}`,\n                type: 'ai',\n                content: this.getFallbackEducationalResponse(question, subject),\n                timestamp: new Date(),\n                metadata: {\n                    subject\n                }\n            };\n        }\n    }\n    /**\n   * Maneja solicitudes de ayuda (stateless)\n   */ static async handleHelpRequest(topic, academicAnalysis, userName) {\n        let content = `Entiendo que necesitas ayuda con ${topic}. `;\n        const strugglingAreas = academicAnalysis.strugglingAreas;\n        if (strugglingAreas.some((area)=>area.toLowerCase().includes(topic.toLowerCase()))) {\n            content += `Veo que has mencionado dificultades similares en tus reportes anteriores.\\n\\n`;\n        }\n        content += `Vamos a abordar esto paso a paso:\\n\\n`;\n        content += `1. **Primero**: ¿Podrías contarme específicamente qué parte de ${topic} te resulta más confusa?\\n`;\n        content += `2. **Segundo**: Te ayudaré con explicaciones simples y ejemplos\\n`;\n        content += `3. **Tercero**: Practicaremos con ejercicios graduales\\n\\n`;\n        content += `¿Por dónde te gustaría empezar?`;\n        return {\n            id: `ai_${Date.now()}`,\n            type: 'ai',\n            content,\n            timestamp: new Date(),\n            metadata: {\n                suggestedActions: [\n                    'Explicar mi dificultad específica',\n                    'Ver ejemplos simples',\n                    'Empezar con lo básico'\n                ]\n            }\n        };\n    }\n    /**\n   * Maneja charla casual (stateless)\n   */ static async handleCasualChat(message, userName) {\n        const msgLower = message.toLowerCase();\n        let content = '';\n        if (msgLower.includes('hola')) {\n            content = `¡Hola${userName ? ' ' + userName : ''}! 😊 `;\n            content += `¿En qué puedo ayudarte hoy? Puedo ayudarte con tus materias, resolver dudas o hacer ejercicios juntos.`;\n        } else if (msgLower.includes('gracias')) {\n            content = `¡De nada! Es un placer ayudarte. 😊 `;\n            content += `¿Hay algo más en lo que pueda apoyarte? Estoy aquí para que aprendas y te diviertas haciéndolo.`;\n        } else if (msgLower.includes('bien') || msgLower.includes('genial')) {\n            content = `¡Qué bueno escuchar eso! 🎉 `;\n            content += `¿Te gustaría aprovechar este buen momento para practicar algún tema o resolver alguna duda?`;\n        } else if (msgLower.includes('mal') || msgLower.includes('difícil')) {\n            content = `Entiendo que te sientes así. Es normal tener días más desafiantes. 💪 `;\n            content += `¿Quieres contarme qué está siendo difícil? Juntos podemos encontrar la manera de hacerlo más fácil.`;\n        } else {\n            content = `Gracias por compartir eso conmigo. ¿Cómo puedo ayudarte mejor hoy?`;\n        }\n        return {\n            id: `ai_${Date.now()}`,\n            type: 'ai',\n            content,\n            timestamp: new Date(),\n            metadata: {\n                suggestedActions: [\n                    'Ver mis materias',\n                    'Hacer una evaluación',\n                    'Resolver una duda'\n                ]\n            }\n        };\n    }\n    /**\n   * Maneja búsquedas académicas (stateless)\n   */ static async handleAcademicSearch(message, subject, topic, userId, userName) {\n        try {\n            // Realizar búsqueda inteligente usando el motor académico\n            const searchResult = await _academic_search_engine__WEBPACK_IMPORTED_MODULE_5__.AcademicSearchEngine.smartSearch(message, userId);\n            if (!searchResult) {\n                // Si no se detectó una búsqueda válida, responder con sugerencias\n                return {\n                    id: `ai_${Date.now()}`,\n                    type: 'ai',\n                    content: `No pude identificar exactamente qué estás buscando. ¿Podrías ser más específico?\\n\\n` + `Por ejemplo:\\n` + `• \"Busca información sobre ecuaciones cuadráticas\"\\n` + `• \"Necesito ejemplos de reacciones químicas\"\\n` + `• \"Encuentra recursos sobre la Segunda Guerra Mundial\"`,\n                    timestamp: new Date(),\n                    metadata: {\n                        suggestedActions: [\n                            'Reformular búsqueda',\n                            'Especificar tema',\n                            'Elegir materia'\n                        ]\n                    }\n                };\n            }\n            // Generar notificación proactiva\n            const notification = await _notification_service__WEBPACK_IMPORTED_MODULE_4__.NotificationService.createAcademicNotification(userId, searchResult.query, _notification_service__WEBPACK_IMPORTED_MODULE_4__.NotificationTrigger.KNOWLEDGE_GAP, '🔍 Búsqueda Académica Completada', `Encontré recursos valiosos sobre ${searchResult.query.topic} que pueden ayudarte.`);\n            // Construir respuesta con resultados\n            let content = `🔍 **Búsqueda Académica Completada**\\n\\n`;\n            content += `He encontrado **${searchResult.totalResults}** recursos sobre **${searchResult.query.topic}**:\\n\\n`;\n            // Mostrar los mejores resultados\n            const topResults = searchResult.results.slice(0, 3);\n            topResults.forEach((result, index)=>{\n                content += `**${index + 1}. ${result.title}**\\n`;\n                content += `📖 ${result.summary}\\n`;\n                content += `⭐ Relevancia: ${(result.relevanceScore * 100).toFixed(0)}% | `;\n                content += `📚 Nivel: ${result.difficulty} | `;\n                content += `⏱️ Lectura: ${result.estimatedReadTime} min\\n\\n`;\n            });\n            // Agregar recomendaciones personalizadas\n            if (searchResult.personalizedRecommendations.length > 0) {\n                content += `💡 **Recomendaciones Personalizadas:**\\n`;\n                searchResult.personalizedRecommendations.forEach((rec)=>{\n                    content += `• ${rec}\\n`;\n                });\n                content += `\\n`;\n            }\n            // Agregar preguntas de seguimiento\n            if (searchResult.followUpQuestions.length > 0) {\n                content += `❓ **¿Te interesa saber más sobre:**\\n`;\n                searchResult.followUpQuestions.slice(0, 2).forEach((question)=>{\n                    content += `• ${question}\\n`;\n                });\n            }\n            return {\n                id: `ai_${Date.now()}`,\n                type: 'ai',\n                content,\n                timestamp: new Date(),\n                metadata: {\n                    subject,\n                    suggestedActions: [\n                        'Ver detalles de resultados',\n                        'Buscar tema relacionado',\n                        'Generar ejercicios',\n                        'Crear recordatorio'\n                    ],\n                    searchResults: searchResult,\n                    notification\n                }\n            };\n        } catch (error) {\n            console.error('Error in academic search:', error);\n            return {\n                id: `ai_${Date.now()}`,\n                type: 'ai',\n                content: `Hubo un problema al buscar información sobre \"${topic || 'tu consulta'}\". ` + `Esto puede deberse a problemas de conectividad.\\n\\n` + `Mientras tanto, puedo ayudarte con:\\n` + `• Explicaciones sobre conceptos específicos\\n` + `• Ejercicios sobre temas que ya domino\\n` + `• Repaso de material previo`,\n                timestamp: new Date(),\n                metadata: {\n                    subject,\n                    suggestedActions: [\n                        'Reintentar búsqueda',\n                        'Explicar conceptos',\n                        'Hacer ejercicios'\n                    ]\n                }\n            };\n        }\n    }\n    /**\n   * Maneja respuestas generales (stateless)\n   */ static async handleGeneralResponse(message) {\n        const content = `Entiendo tu mensaje. ¿Podrías ser más específico sobre cómo puedo ayudarte?\\n\\n` + `Puedo ayudarte con:\\n` + `• Resolver dudas sobre tus materias\\n` + `• Hacer ejercicios y evaluaciones\\n` + `• Explicar conceptos difíciles\\n` + `• Buscar información académica\\n` + `• Revisar tu progreso académico\\n\\n` + `¿Qué te interesa más?`;\n        return {\n            id: `ai_${Date.now()}`,\n            type: 'ai',\n            content,\n            timestamp: new Date(),\n            metadata: {\n                suggestedActions: [\n                    'Resolver dudas',\n                    'Hacer ejercicios',\n                    'Buscar información',\n                    'Ver mi progreso'\n                ]\n            }\n        };\n    }\n    /**\n   * Crea mensaje de bienvenida personalizado (stateless)\n   */ static async createWelcomeMessage(userId, userName) {\n        const analysis = await _academic_analyzer__WEBPACK_IMPORTED_MODULE_0__.AcademicAnalyzer.analyzeStudent(userId);\n        let content = `¡Hola${userName ? ' ' + userName : ''}! 👋 Soy tu tutor personal de IA.\\n\\n`;\n        if (analysis.subjects.length > 0) {\n            content += `He revisado tu progreso académico y veo que tienes:\\n`;\n            const strongSubjects = analysis.subjects.filter((s)=>s.performance > 75);\n            const strugglingSubjects = analysis.subjects.filter((s)=>s.needsAttention);\n            if (strongSubjects.length > 0) {\n                content += `✅ **Fortalezas**: ${strongSubjects.map((s)=>s.subjectName).join(', ')}\\n`;\n            }\n            if (strugglingSubjects.length > 0) {\n                content += `🎯 **Áreas de mejora**: ${strugglingSubjects.map((s)=>s.subjectName).join(', ')}\\n`;\n            }\n            content += `\\n`;\n        }\n        content += `¿En qué puedo ayudarte hoy?\\n`;\n        content += `• **Resolver ejercicios**: Paso a paso con explicaciones detalladas\\n`;\n        content += `• **Evaluación**: Hacer ejercicios adaptativos\\n`;\n        content += `• **Dudas**: Resolver preguntas específicas\\n`;\n        content += `• **Repaso**: Revisar conceptos importantes`;\n        // Obtener acciones sugeridas\n        const actions = [];\n        const strugglingSubjects = analysis.subjects.filter((s)=>s.needsAttention);\n        if (strugglingSubjects.length > 0) {\n            actions.push(`Practicar ${strugglingSubjects[0].subjectName}`);\n        }\n        actions.push('Hacer una evaluación');\n        actions.push('Resolver una duda');\n        actions.push('Ver mi progreso');\n        return {\n            id: `welcome_${Date.now()}`,\n            type: 'ai',\n            content,\n            timestamp: new Date(),\n            metadata: {\n                suggestedActions: actions\n            }\n        };\n    }\n    /**\n   * Obtiene el nombre legible de una materia\n   */ static getSubjectName(subject) {\n        const names = {\n            [_academic_analyzer__WEBPACK_IMPORTED_MODULE_0__.AcademicSubject.MATHEMATICS]: 'Matemáticas',\n            [_academic_analyzer__WEBPACK_IMPORTED_MODULE_0__.AcademicSubject.PHYSICS]: 'Física',\n            [_academic_analyzer__WEBPACK_IMPORTED_MODULE_0__.AcademicSubject.CHEMISTRY]: 'Química',\n            [_academic_analyzer__WEBPACK_IMPORTED_MODULE_0__.AcademicSubject.BIOLOGY]: 'Biología',\n            [_academic_analyzer__WEBPACK_IMPORTED_MODULE_0__.AcademicSubject.SPANISH]: 'Lengua y Literatura',\n            [_academic_analyzer__WEBPACK_IMPORTED_MODULE_0__.AcademicSubject.ENGLISH]: 'Inglés',\n            [_academic_analyzer__WEBPACK_IMPORTED_MODULE_0__.AcademicSubject.HISTORY]: 'Historia',\n            [_academic_analyzer__WEBPACK_IMPORTED_MODULE_0__.AcademicSubject.GEOGRAPHY]: 'Geografía',\n            [_academic_analyzer__WEBPACK_IMPORTED_MODULE_0__.AcademicSubject.GENERAL]: 'General'\n        };\n        return names[subject];\n    }\n    /**\n   * Respuesta de fallback para preguntas educativas\n   */ static getFallbackEducationalResponse(question, subject) {\n        return `Esa es una excelente pregunta sobre ${subject ? this.getSubjectName(subject) : 'el tema'}.\\n\\n` + `Te ayudo a pensar sobre esto paso a paso:\\n\\n` + `1. **Identifica los conceptos clave** en tu pregunta\\n` + `2. **Piensa en ejemplos concretos** que conozcas\\n` + `3. **Conecta con lo que ya sabes** de temas anteriores\\n\\n` + `¿Te gustaría que te ayude con ejercicios prácticos sobre este tema?`;\n    }\n    /**\n   * Maneja comandos administrativos del calendario (editar, eliminar, listar)\n   */ static async handleCalendarAdminCommands(userId, message) {\n        const msgLower = message.toLowerCase();\n        // Comando: Listar eventos\n        if (/(?:muestra|lista|ver).*(?:eventos?|calendario)/i.test(message) || /(?:eventos?|calendario).*(?:de\\s+)?(?:esta\\s+semana|hoy|mañana)/i.test(message)) {\n            const events = (0,_calendar_ai_integration__WEBPACK_IMPORTED_MODULE_3__.findUserEvents)(userId, '');\n            const today = new Date();\n            const oneWeek = new Date(today.getTime() + 7 * 24 * 60 * 60 * 1000);\n            const upcomingEvents = events.filter((event)=>{\n                const eventDate = new Date(event.date);\n                return eventDate >= today && eventDate <= oneWeek;\n            });\n            if (upcomingEvents.length === 0) {\n                return {\n                    id: `ai_${Date.now()}`,\n                    type: 'ai',\n                    content: `📅 No tienes eventos programados para esta semana.\\n\\n¿Te gustaría que te ayude a agendar alguno?`,\n                    timestamp: new Date(),\n                    metadata: {\n                        suggestedActions: [\n                            'Agendar examen',\n                            'Agendar sesión de estudio',\n                            'Ver calendario completo'\n                        ]\n                    }\n                };\n            }\n            const eventList = upcomingEvents.map((event)=>{\n                const dateStr = event.date.toLocaleDateString('es-ES', {\n                    weekday: 'short',\n                    day: 'numeric',\n                    month: 'short'\n                });\n                return `• **${event.title}** - ${dateStr} a las ${event.startTime}${event.location ? ` (${event.location})` : ''}`;\n            }).join('\\n');\n            return {\n                id: `ai_${Date.now()}`,\n                type: 'ai',\n                content: `📅 **Tus próximos eventos:**\\n\\n${eventList}\\n\\n¿Necesitas editar o eliminar alguno?`,\n                timestamp: new Date(),\n                metadata: {\n                    suggestedActions: [\n                        'Editar evento',\n                        'Eliminar evento',\n                        'Agendar nuevo evento'\n                    ]\n                }\n            };\n        }\n        // Comando: Eliminar evento\n        if (/(?:elimin[ae]|borr[ae]|quit[ae]|cancel[ae])/i.test(message)) {\n            const searchTerms = message.match(/(?:examen|evento|sesión).*?(?:de\\s+)?([a-záéíóúñ]+)/i);\n            if (searchTerms) {\n                const searchTerm = searchTerms[1] || searchTerms[0];\n                const foundEvents = (0,_calendar_ai_integration__WEBPACK_IMPORTED_MODULE_3__.findUserEvents)(userId, searchTerm);\n                if (foundEvents.length === 0) {\n                    return {\n                        id: `ai_${Date.now()}`,\n                        type: 'ai',\n                        content: `❌ No encontré eventos relacionados con \"${searchTerm}\".\\n\\n¿Podrías ser más específico sobre qué evento quieres eliminar?`,\n                        timestamp: new Date(),\n                        metadata: {\n                            suggestedActions: [\n                                'Ver todos mis eventos',\n                                'Ser más específico'\n                            ]\n                        }\n                    };\n                }\n                if (foundEvents.length === 1) {\n                    const event = foundEvents[0];\n                    const deleteResult = await (0,_calendar_ai_integration__WEBPACK_IMPORTED_MODULE_3__.deleteEventFromAI)(event.id);\n                    return {\n                        id: `ai_${Date.now()}`,\n                        type: 'ai',\n                        content: deleteResult.success ? `✅ ${deleteResult.message}` : `❌ ${deleteResult.message}`,\n                        timestamp: new Date(),\n                        metadata: {\n                            suggestedActions: deleteResult.success ? [\n                                'Ver calendario',\n                                'Agendar nuevo evento'\n                            ] : [\n                                'Reintentar',\n                                'Ver eventos'\n                            ]\n                        }\n                    };\n                } else {\n                    const eventList = foundEvents.slice(0, 3).map((e)=>`• ${e.title}`).join('\\n');\n                    return {\n                        id: `ai_${Date.now()}`,\n                        type: 'ai',\n                        content: `🔍 Encontré varios eventos relacionados:\\n\\n${eventList}\\n\\n¿Cuál quieres eliminar específicamente?`,\n                        timestamp: new Date(),\n                        metadata: {\n                            suggestedActions: foundEvents.slice(0, 3).map((e)=>`Eliminar: ${e.title}`)\n                        }\n                    };\n                }\n            }\n        }\n        return null;\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUcsSUFBSTt3QkFDdEJDLE1BQU07d0JBQ05DLFNBQVN3SSxhQUFhQyxPQUFPLEdBQ3pCLENBQUMsRUFBRSxFQUFFRCxhQUFhcEosT0FBTyxFQUFFLEdBQzNCLENBQUMsRUFBRSxFQUFFb0osYUFBYXBKLE9BQU8sRUFBRTt3QkFDL0JhLFdBQVcsSUFBSUo7d0JBQ2ZLLFVBQVU7NEJBQ1JJLGtCQUFrQmtJLGFBQWFDLE9BQU8sR0FDbEM7Z0NBQUM7Z0NBQWtCOzZCQUF1QixHQUMxQztnQ0FBQztnQ0FBYzs2QkFBYzt3QkFDbkM7b0JBQ0Y7Z0JBQ0YsT0FBTztvQkFDTCxNQUFNYixZQUFZVyxZQUFZakQsS0FBSyxDQUFDLEdBQUcsR0FBR29CLEdBQUcsQ0FBQ2dDLENBQUFBLElBQUssQ0FBQyxFQUFFLEVBQUVBLEVBQUVoRCxLQUFLLEVBQUUsRUFBRXRCLElBQUksQ0FBQztvQkFDeEUsT0FBTzt3QkFDTHhFLElBQUksQ0FBQyxHQUFHLEVBQUVDLEtBQUtDLEdBQUcsSUFBSTt3QkFDdEJDLE1BQU07d0JBQ05DLFNBQVMsQ0FBQyw0Q0FBNEMsRUFBRTRILFVBQVUsMkNBQTJDLENBQUM7d0JBQzlHM0gsV0FBVyxJQUFJSjt3QkFDZkssVUFBVTs0QkFDUkksa0JBQWtCaUksWUFBWWpELEtBQUssQ0FBQyxHQUFHLEdBQUdvQixHQUFHLENBQUNnQyxDQUFBQSxJQUFLLENBQUMsVUFBVSxFQUFFQSxFQUFFaEQsS0FBSyxFQUFFO3dCQUMzRTtvQkFDRjtnQkFDRjtZQUNGO1FBQ0Y7UUFFQSxPQUFPO0lBQ1Q7QUFFRiIsInNvdXJjZXMiOlsiL1VzZXJzL3JvZHJpZ29kaWJlcm5hcmRvMzNnbWFpbC5jb20vRG9jdW1lbnRzL0FwcCBEZXZlbG9wbWVudCBQcm95ZWN0cy9JbnRlbGxlZ28gUGxhdGZvcm0vc3JjL2xpYi9jb252ZXJzYXRpb24tZW5naW5lLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEFjYWRlbWljQW5hbHl6ZXIsIEFjYWRlbWljU3ViamVjdCwgdHlwZSBBY2FkZW1pY0FuYWx5c2lzIH0gZnJvbSAnLi9hY2FkZW1pYy1hbmFseXplcidcbmltcG9ydCB7IGFpU2VydmljZSB9IGZyb20gJy4vYWktcHJvdmlkZXJzJ1xuaW1wb3J0IHsgRXhlcmNpc2VTb2x2ZXIgfSBmcm9tICcuL2V4ZXJjaXNlLXNvbHZlcidcbmltcG9ydCB7IFxuICBBSUNhbGVuZGFySW50ZWdyYXRpb24sIFxuICBhbmFseXplQ29udmVyc2F0aW9uRm9yRXZlbnRzLCBcbiAgZmluZFVzZXJFdmVudHMsIFxuICBlZGl0RXZlbnRGcm9tQUksIFxuICBkZWxldGVFdmVudEZyb21BSSBcbn0gZnJvbSAnLi9jYWxlbmRhci1haS1pbnRlZ3JhdGlvbidcbmltcG9ydCB7IE5vdGlmaWNhdGlvblNlcnZpY2UsIE5vdGlmaWNhdGlvblRyaWdnZXIsIE5vdGlmaWNhdGlvblByaW9yaXR5IH0gZnJvbSAnLi9ub3RpZmljYXRpb24tc2VydmljZSdcbmltcG9ydCB7IEFjYWRlbWljU2VhcmNoRW5naW5lIH0gZnJvbSAnLi9hY2FkZW1pYy1zZWFyY2gtZW5naW5lJ1xuXG5leHBvcnQgaW50ZXJmYWNlIENoYXRNZXNzYWdlIHtcbiAgaWQ6IHN0cmluZ1xuICB0eXBlOiAndXNlcicgfCAnYWknIHwgJ3N5c3RlbSdcbiAgY29udGVudDogc3RyaW5nXG4gIHRpbWVzdGFtcDogRGF0ZVxuICBtZXRhZGF0YT86IHtcbiAgICBzdWJqZWN0PzogQWNhZGVtaWNTdWJqZWN0XG4gICAgZXhlcmNpc2VJZD86IHN0cmluZ1xuICAgIHN1Z2dlc3RlZEFjdGlvbnM/OiBzdHJpbmdbXVxuICB9XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgQ29udmVyc2F0aW9uQ29udGV4dCB7XG4gIHVzZXJJZDogc3RyaW5nXG4gIHVzZXJOYW1lPzogc3RyaW5nXG4gIGN1cnJlbnRTdWJqZWN0PzogQWNhZGVtaWNTdWJqZWN0XG4gIGFjYWRlbWljQW5hbHlzaXM/OiBBY2FkZW1pY0FuYWx5c2lzXG4gIGNvbnZlcnNhdGlvbkhpc3Rvcnk6IENoYXRNZXNzYWdlW11cbiAgbGFzdEludGVyYWN0aW9uOiBEYXRlXG4gIGN1cnJlbnRNb2RlOiAnY2hhdCcgfCAnYXNzZXNzbWVudCcgfCAnZXhlcmNpc2UnIHwgJ2V4cGxhbmF0aW9uJyB8ICdjYWxlbmRhcl9pbnRlZ3JhdGlvbidcbiAgY2FsZW5kYXJJbnRlZ3JhdGlvbj86IEFJQ2FsZW5kYXJJbnRlZ3JhdGlvblxufVxuXG5leHBvcnQgaW50ZXJmYWNlIEFzc2Vzc21lbnRRdWVzdGlvbiB7XG4gIGlkOiBzdHJpbmdcbiAgc3ViamVjdDogQWNhZGVtaWNTdWJqZWN0XG4gIHRvcGljOiBzdHJpbmdcbiAgcXVlc3Rpb246IHN0cmluZ1xuICB0eXBlOiAnbXVsdGlwbGVfY2hvaWNlJyB8ICdvcGVuX2VuZGVkJyB8ICdwcm9ibGVtX3NvbHZpbmcnXG4gIG9wdGlvbnM/OiBzdHJpbmdbXVxuICBjb3JyZWN0QW5zd2VyPzogc3RyaW5nXG4gIGV4cGxhbmF0aW9uOiBzdHJpbmdcbiAgZGlmZmljdWx0eTogJ2Jhc2ljJyB8ICdpbnRlcm1lZGlhdGUnIHwgJ2FkdmFuY2VkJ1xufVxuXG5leHBvcnQgY2xhc3MgQ29udmVyc2F0aW9uRW5naW5lIHtcbiAgXG4gIC8qKlxuICAgKiBQcm9jZXNhIHVuIG1lbnNhamUgZGVsIHVzdWFyaW8gZGUgZm9ybWEgc3RhdGVsZXNzXG4gICAqL1xuICBzdGF0aWMgYXN5bmMgcHJvY2Vzc1VzZXJNZXNzYWdlKFxuICAgIHVzZXJJZDogc3RyaW5nLCBcbiAgICBtZXNzYWdlOiBzdHJpbmcsIFxuICAgIHVzZXJOYW1lPzogc3RyaW5nLFxuICAgIGNvbnZlcnNhdGlvbkhpc3Rvcnk/OiBBcnJheTx7IHJvbGU6ICd1c2VyJyB8ICdhc3Npc3RhbnQnLCBjb250ZW50OiBzdHJpbmcgfT5cbiAgKTogUHJvbWlzZTxDaGF0TWVzc2FnZT4ge1xuICAgIC8vIFVzZSBjb250ZXh0dWFsIGNvbnZlcnNhdGlvbiBtYW5hZ2VyIGZvciBiZXR0ZXIgY29oZXJlbmNlXG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHsgQ29udGV4dHVhbENvbnZlcnNhdGlvbk1hbmFnZXIgfSA9IHJlcXVpcmUoJy4vY29udGV4dHVhbC1jb252ZXJzYXRpb24tbWFuYWdlcicpXG4gICAgICBjb25zdCBjb250ZXh0dWFsUmVzcG9uc2UgPSBhd2FpdCBDb250ZXh0dWFsQ29udmVyc2F0aW9uTWFuYWdlci5wcm9jZXNzQ29udGV4dHVhbE1lc3NhZ2UoXG4gICAgICAgIHVzZXJJZCwgbWVzc2FnZSwgdW5kZWZpbmVkLCB1c2VyTmFtZVxuICAgICAgKVxuICAgICAgXG4gICAgICByZXR1cm4ge1xuICAgICAgICBpZDogYGFpXyR7RGF0ZS5ub3coKX1gLFxuICAgICAgICB0eXBlOiAnYWknLFxuICAgICAgICBjb250ZW50OiBjb250ZXh0dWFsUmVzcG9uc2UuY29udGVudCxcbiAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLFxuICAgICAgICBtZXRhZGF0YToge1xuICAgICAgICAgIHN1YmplY3Q6IGNvbnRleHR1YWxSZXNwb25zZS5jb250ZXh0LmN1cnJlbnRTdWJqZWN0LFxuICAgICAgICAgIHN1Z2dlc3RlZEFjdGlvbnM6IGNvbnRleHR1YWxSZXNwb25zZS5zdWdnZXN0ZWRGb2xsb3d1cHMuY29uY2F0KFxuICAgICAgICAgICAgY29udGV4dHVhbFJlc3BvbnNlLnZpc3VhbFJlY29tbWVuZGF0aW9uID8gXG4gICAgICAgICAgICBbYEdlbmVyYXIgJHtjb250ZXh0dWFsUmVzcG9uc2UudmlzdWFsUmVjb21tZW5kYXRpb24udHlwZX1gXSA6IFtdXG4gICAgICAgICAgKVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUubG9nKCdGYWxsYmFjayB0byBiYXNpYyBjb252ZXJzYXRpb24gZW5naW5lOicsIGVycm9yKVxuICAgICAgLy8gRmFsbGJhY2sgdG8gb3JpZ2luYWwgc3RhdGVsZXNzIHByb2Nlc3NpbmdcbiAgICB9XG5cbiAgICAvLyBDYXJnYXIgYW7DoWxpc2lzIGFjYWTDqW1pY28gZW4gY2FkYSByZXF1ZXN0IChzdGF0ZWxlc3MpXG4gICAgY29uc3QgYWNhZGVtaWNBbmFseXNpcyA9IGF3YWl0IEFjYWRlbWljQW5hbHl6ZXIuYW5hbHl6ZVN0dWRlbnQodXNlcklkKVxuXG4gICAgLy8gVmVyaWZpY2FyIGNvbWFuZG9zIGRlIGNhbGVuZGFyaW8gKGVkaXRhciwgZWxpbWluYXIsIGxpc3RhcilcbiAgICBjb25zdCBjYWxlbmRhckFkbWluUmVzdWx0ID0gYXdhaXQgdGhpcy5oYW5kbGVDYWxlbmRhckFkbWluQ29tbWFuZHModXNlcklkLCBtZXNzYWdlKVxuICAgIGlmIChjYWxlbmRhckFkbWluUmVzdWx0KSB7XG4gICAgICByZXR1cm4gY2FsZW5kYXJBZG1pblJlc3VsdFxuICAgIH1cblxuICAgIC8vIFZlcmlmaWNhciBzaSBoYXkgdW4gY2FsZW5kYXJpbyBkZSBpbnRlZ3JhY2nDs24gZW4gY3Vyc29cbiAgICBjb25zdCBjYWxlbmRhckludGVncmF0aW9uID0gbmV3IEFJQ2FsZW5kYXJJbnRlZ3JhdGlvbih1c2VySWQpXG4gICAgXG4gICAgLy8gQW5hbGl6YXIgc2kgc2UgbWVuY2lvbmFuIGV2ZW50b3MgcXVlIHJlcXVpZXJlbiBjcmVhY2nDs24gZW4gY2FsZW5kYXJpb1xuICAgIGNvbnN0IGNvbnZlcnNhdGlvbkZvckNhbGVuZGFyID0gY29udmVyc2F0aW9uSGlzdG9yeSB8fCBbXVxuICAgIGNvbnN0IGNhbGVuZGFyUmVzdWx0ID0gYXdhaXQgY2FsZW5kYXJJbnRlZ3JhdGlvbi5wcm9jZXNzTWVzc2FnZShtZXNzYWdlLCBjb252ZXJzYXRpb25Gb3JDYWxlbmRhcilcbiAgICBcbiAgICBpZiAoY2FsZW5kYXJSZXN1bHQubmVlZHNFdmVudENyZWF0aW9uKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBpZDogYGFpXyR7RGF0ZS5ub3coKX1gLFxuICAgICAgICB0eXBlOiAnYWknLFxuICAgICAgICBjb250ZW50OiBjYWxlbmRhclJlc3VsdC5yZXNwb25zZSB8fCAnJyxcbiAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLFxuICAgICAgICBtZXRhZGF0YToge1xuICAgICAgICAgIHN1Z2dlc3RlZEFjdGlvbnM6IGNhbGVuZGFyUmVzdWx0LmV2ZW50IFxuICAgICAgICAgICAgPyBbJ1ZlciBlbiBjYWxlbmRhcmlvJywgJ0VkaXRhciBldmVudG8nLCAnRWxpbWluYXIgZXZlbnRvJ11cbiAgICAgICAgICAgIDogWydSZWludGVudGFyJywgJ1Byb3BvcmNpb25hciBtw6FzIGRldGFsbGVzJ11cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIC8vIEFuYWxpemFyIGludGVuY2nDs24gZGVsIHVzdWFyaW8gKHN0YXRlbGVzcylcbiAgICBjb25zdCBpbnRlbnQgPSB0aGlzLmFuYWx5emVVc2VySW50ZW50KG1lc3NhZ2UsIGFjYWRlbWljQW5hbHlzaXMpXG4gICAgXG4gICAgLy8gR2VuZXJhciByZXNwdWVzdGEgYmFzYWRhIGVuIGxhIGludGVuY2nDs25cbiAgICBsZXQgYWlSZXNwb25zZTogQ2hhdE1lc3NhZ2VcbiAgICBcbiAgICBzd2l0Y2ggKGludGVudC50eXBlKSB7XG4gICAgICBjYXNlICdzb2x2ZV9leGVyY2lzZSc6XG4gICAgICAgIGFpUmVzcG9uc2UgPSBhd2FpdCB0aGlzLmhhbmRsZUV4ZXJjaXNlU29sdXRpb24obWVzc2FnZSwgaW50ZW50LnN1YmplY3QhLCBhY2FkZW1pY0FuYWx5c2lzLCB1c2VyTmFtZSlcbiAgICAgICAgYnJlYWtcbiAgICAgIGNhc2UgJ3JlcXVlc3RfYXNzZXNzbWVudCc6XG4gICAgICAgIGFpUmVzcG9uc2UgPSBhd2FpdCB0aGlzLmhhbmRsZUFzc2Vzc21lbnRSZXF1ZXN0KGludGVudC5zdWJqZWN0ISwgYWNhZGVtaWNBbmFseXNpcywgdXNlck5hbWUpXG4gICAgICAgIGJyZWFrXG4gICAgICBjYXNlICdhc2tfcXVlc3Rpb24nOlxuICAgICAgICBhaVJlc3BvbnNlID0gYXdhaXQgdGhpcy5oYW5kbGVFZHVjYXRpb25hbFF1ZXN0aW9uKG1lc3NhZ2UsIGludGVudC5zdWJqZWN0LCBhY2FkZW1pY0FuYWx5c2lzLCB1c2VyTmFtZSlcbiAgICAgICAgYnJlYWtcbiAgICAgIGNhc2UgJ2FjYWRlbWljX3NlYXJjaCc6XG4gICAgICAgIGFpUmVzcG9uc2UgPSBhd2FpdCB0aGlzLmhhbmRsZUFjYWRlbWljU2VhcmNoKG1lc3NhZ2UsIGludGVudC5zdWJqZWN0LCBpbnRlbnQudG9waWMsIHVzZXJJZCwgdXNlck5hbWUpXG4gICAgICAgIGJyZWFrXG4gICAgICBjYXNlICdyZXF1ZXN0X2hlbHAnOlxuICAgICAgICBhaVJlc3BvbnNlID0gYXdhaXQgdGhpcy5oYW5kbGVIZWxwUmVxdWVzdChpbnRlbnQudG9waWMhLCBhY2FkZW1pY0FuYWx5c2lzLCB1c2VyTmFtZSlcbiAgICAgICAgYnJlYWtcbiAgICAgIGNhc2UgJ2Nhc3VhbF9jaGF0JzpcbiAgICAgICAgYWlSZXNwb25zZSA9IGF3YWl0IHRoaXMuaGFuZGxlQ2FzdWFsQ2hhdChtZXNzYWdlLCB1c2VyTmFtZSlcbiAgICAgICAgYnJlYWtcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIGFpUmVzcG9uc2UgPSBhd2FpdCB0aGlzLmhhbmRsZUdlbmVyYWxSZXNwb25zZShtZXNzYWdlKVxuICAgIH1cbiAgICBcbiAgICAvLyBUaGlzIGZhbGxiYWNrIHNob3VsZCBuZXZlciBiZSByZWFjaGVkIGR1ZSB0byB0aGUgdHJ5L2NhdGNoIGFib3ZlXG4gICAgY29uc29sZS5lcnJvcign4p2MIENSSVRJQ0FMOiBSZWFjaGVkIHVucmVhY2hhYmxlIGZhbGxiYWNrIGNvZGUgaW4gY29udmVyc2F0aW9uIGVuZ2luZScpXG4gICAgdGhyb3cgbmV3IEVycm9yKCdGYWxsYmFjayBjb2RlIHNob3VsZCBub3QgYmUgcmVhY2hhYmxlJylcbiAgfVxuXG4gIC8qKlxuICAgKiBMZWdhY3kgbWV0aG9kIGZvciBiYWNrd2FyZCBjb21wYXRpYmlsaXR5IC0gcmVkaXJlY3RzIHRvIGNvbnRleHR1YWwgbWFuYWdlclxuICAgKi9cbiAgc3RhdGljIGFzeW5jIHByb2Nlc3NVc2VyTWVzc2FnZUxlZ2FjeShcbiAgICB1c2VySWQ6IHN0cmluZywgXG4gICAgbWVzc2FnZTogc3RyaW5nLCBcbiAgICB1c2VyTmFtZT86IHN0cmluZyxcbiAgICBjb252ZXJzYXRpb25IaXN0b3J5PzogQXJyYXk8eyByb2xlOiAndXNlcicgfCAnYXNzaXN0YW50JywgY29udGVudDogc3RyaW5nIH0+XG4gICk6IFByb21pc2U8Q2hhdE1lc3NhZ2U+IHtcbiAgICBjb25zb2xlLmxvZygn4pqg77iPIFVzaW5nIGxlZ2FjeSBtZXRob2QgLSByZWRpcmVjdGluZyB0byBtYWluIHByb2Nlc3NVc2VyTWVzc2FnZScpXG4gICAgcmV0dXJuIHRoaXMucHJvY2Vzc1VzZXJNZXNzYWdlKHVzZXJJZCwgbWVzc2FnZSwgdXNlck5hbWUsIGNvbnZlcnNhdGlvbkhpc3RvcnkpXG4gIH1cblxuICAvKipcbiAgICogQW5hbGl6YSBsYSBpbnRlbmNpw7NuIGRlbCB1c3VhcmlvIChzdGF0ZWxlc3MpXG4gICAqL1xuICBwcml2YXRlIHN0YXRpYyBhbmFseXplVXNlckludGVudChtZXNzYWdlOiBzdHJpbmcsIGFjYWRlbWljQW5hbHlzaXM6IEFjYWRlbWljQW5hbHlzaXMpOiB7XG4gICAgdHlwZTogJ3NvbHZlX2V4ZXJjaXNlJyB8ICdyZXF1ZXN0X2Fzc2Vzc21lbnQnIHwgJ2Fza19xdWVzdGlvbicgfCAncmVxdWVzdF9oZWxwJyB8ICdhY2FkZW1pY19zZWFyY2gnIHwgJ2Nhc3VhbF9jaGF0JyB8ICdnZW5lcmFsJ1xuICAgIHN1YmplY3Q/OiBBY2FkZW1pY1N1YmplY3RcbiAgICB0b3BpYz86IHN0cmluZ1xuICAgIGNvbmZpZGVuY2U6IG51bWJlclxuICB9IHtcbiAgICBjb25zdCBtc2dMb3dlciA9IG1lc3NhZ2UudG9Mb3dlckNhc2UoKVxuXG4gICAgLy8gUFJJTUVSQSBQUklPUklEQUQ6IERldGVjdGFyIHNpIGVzIHVuIGVqZXJjaWNpbyBwYXJhIHJlc29sdmVyXG4gICAgY29uc3QgZXhlcmNpc2VEZXRlY3Rpb24gPSBFeGVyY2lzZVNvbHZlci5kZXRlY3RFeGVyY2lzZShtZXNzYWdlKVxuICAgIGlmIChleGVyY2lzZURldGVjdGlvbi5oYXNFeGVyY2lzZSAmJiBleGVyY2lzZURldGVjdGlvbi5jb25maWRlbmNlID4gMC42KSB7XG4gICAgICAvLyBNYXBlYXIgc3ViamVjdHMgZGVsIEV4ZXJjaXNlU29sdmVyIGEgQWNhZGVtaWNTdWJqZWN0XG4gICAgICBjb25zdCBzdWJqZWN0TWFwID0ge1xuICAgICAgICAncGh5c2ljcyc6IEFjYWRlbWljU3ViamVjdC5QSFlTSUNTLFxuICAgICAgICAnY2hlbWlzdHJ5JzogQWNhZGVtaWNTdWJqZWN0LkNIRU1JU1RSWSwgXG4gICAgICAgICdtYXRoZW1hdGljcyc6IEFjYWRlbWljU3ViamVjdC5NQVRIRU1BVElDUyxcbiAgICAgICAgJ2dlbmVyYWwnOiBBY2FkZW1pY1N1YmplY3QuR0VORVJBTFxuICAgICAgfVxuICAgICAgcmV0dXJuIHsgXG4gICAgICAgIHR5cGU6ICdzb2x2ZV9leGVyY2lzZScsIFxuICAgICAgICBzdWJqZWN0OiBzdWJqZWN0TWFwW2V4ZXJjaXNlRGV0ZWN0aW9uLnN1YmplY3RdLCBcbiAgICAgICAgY29uZmlkZW5jZTogZXhlcmNpc2VEZXRlY3Rpb24uY29uZmlkZW5jZSBcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBEZXRlY3RhciBzb2xpY2l0dWQgZGUgZXZhbHVhY2nDs25cbiAgICBpZiAobXNnTG93ZXIuaW5jbHVkZXMoJ2V2YWx1YWNpw7NuJykgfHwgbXNnTG93ZXIuaW5jbHVkZXMoJ2V2YWx1YXInKSB8fCBcbiAgICAgICAgbXNnTG93ZXIuaW5jbHVkZXMoJ2V4YW1lbicpIHx8IG1zZ0xvd2VyLmluY2x1ZGVzKCdwcnVlYmEnKSB8fFxuICAgICAgICBtc2dMb3dlci5pbmNsdWRlcygnZWplcmNpY2lvJykgfHwgbXNnTG93ZXIuaW5jbHVkZXMoJ3ByYWN0aWNhcicpKSB7XG4gICAgICBjb25zdCBzdWJqZWN0ID0gdGhpcy5kZXRlY3RTdWJqZWN0KG1lc3NhZ2UpXG4gICAgICByZXR1cm4geyB0eXBlOiAncmVxdWVzdF9hc3Nlc3NtZW50Jywgc3ViamVjdCwgY29uZmlkZW5jZTogMC44IH1cbiAgICB9XG5cbiAgICAvLyBEZXRlY3RhciBwcmVndW50YSBlZHVjYXRpdmFcbiAgICBpZiAobXNnTG93ZXIuaW5jbHVkZXMoJ8K/JykgfHwgbXNnTG93ZXIuaW5jbHVkZXMoJ2PDs21vJykgfHwgXG4gICAgICAgIG1zZ0xvd2VyLmluY2x1ZGVzKCdxdcOpIGVzJykgfHwgbXNnTG93ZXIuaW5jbHVkZXMoJ2V4cGxpY2EnKSB8fFxuICAgICAgICBtc2dMb3dlci5pbmNsdWRlcygnbm8gZW50aWVuZG8nKSkge1xuICAgICAgY29uc3Qgc3ViamVjdCA9IHRoaXMuZGV0ZWN0U3ViamVjdChtZXNzYWdlKVxuICAgICAgcmV0dXJuIHsgdHlwZTogJ2Fza19xdWVzdGlvbicsIHN1YmplY3QsIGNvbmZpZGVuY2U6IDAuNyB9XG4gICAgfVxuXG4gICAgLy8gRGV0ZWN0YXIgYsO6c3F1ZWRhIGFjYWTDqW1pY2FcbiAgICBpZiAobXNnTG93ZXIuaW5jbHVkZXMoJ2J1c2NhJykgfHwgbXNnTG93ZXIuaW5jbHVkZXMoJ2J1c2NhcicpIHx8IFxuICAgICAgICBtc2dMb3dlci5pbmNsdWRlcygnZW5jdWVudHJhJykgfHwgbXNnTG93ZXIuaW5jbHVkZXMoJ2VuY29udHJhcicpIHx8XG4gICAgICAgIG1zZ0xvd2VyLmluY2x1ZGVzKCduZWNlc2l0byBpbmZvcm1hY2nDs24nKSB8fCBtc2dMb3dlci5pbmNsdWRlcygncmVjdXJzb3Mgc29icmUnKSB8fFxuICAgICAgICBtc2dMb3dlci5pbmNsdWRlcygnbWF0ZXJpYWwgZGUnKSB8fCBtc2dMb3dlci5pbmNsdWRlcygnZWplbXBsb3MgZGUnKSkge1xuICAgICAgY29uc3Qgc3ViamVjdCA9IHRoaXMuZGV0ZWN0U3ViamVjdChtZXNzYWdlKVxuICAgICAgY29uc3QgdG9waWMgPSB0aGlzLmV4dHJhY3RUb3BpYyhtZXNzYWdlKVxuICAgICAgcmV0dXJuIHsgdHlwZTogJ2FjYWRlbWljX3NlYXJjaCcsIHN1YmplY3QsIHRvcGljLCBjb25maWRlbmNlOiAwLjggfVxuICAgIH1cblxuICAgIC8vIERldGVjdGFyIHNvbGljaXR1ZCBkZSBheXVkYVxuICAgIGlmIChtc2dMb3dlci5pbmNsdWRlcygnYXl1ZGEnKSB8fCBtc2dMb3dlci5pbmNsdWRlcygnZGlmw61jaWwnKSB8fFxuICAgICAgICBtc2dMb3dlci5pbmNsdWRlcygnbm8gcHVlZG8nKSB8fCBtc2dMb3dlci5pbmNsdWRlcygnbWUgY3Vlc3RhJykpIHtcbiAgICAgIGNvbnN0IHRvcGljID0gdGhpcy5leHRyYWN0VG9waWMobWVzc2FnZSlcbiAgICAgIHJldHVybiB7IHR5cGU6ICdyZXF1ZXN0X2hlbHAnLCB0b3BpYywgY29uZmlkZW5jZTogMC42IH1cbiAgICB9XG5cbiAgICAvLyBEZXRlY3RhciBjaGFybGEgY2FzdWFsXG4gICAgaWYgKG1zZ0xvd2VyLmluY2x1ZGVzKCdob2xhJykgfHwgbXNnTG93ZXIuaW5jbHVkZXMoJ2dyYWNpYXMnKSB8fFxuICAgICAgICBtc2dMb3dlci5pbmNsdWRlcygnYmllbicpIHx8IG1zZ0xvd2VyLmluY2x1ZGVzKCdtYWwnKSkge1xuICAgICAgcmV0dXJuIHsgdHlwZTogJ2Nhc3VhbF9jaGF0JywgY29uZmlkZW5jZTogMC41IH1cbiAgICB9XG5cbiAgICByZXR1cm4geyB0eXBlOiAnZ2VuZXJhbCcsIGNvbmZpZGVuY2U6IDAuMyB9XG4gIH1cblxuICAvKipcbiAgICogRGV0ZWN0YSBsYSBtYXRlcmlhIG1lbmNpb25hZGEgZW4gZWwgbWVuc2FqZVxuICAgKi9cbiAgcHJpdmF0ZSBzdGF0aWMgZGV0ZWN0U3ViamVjdChtZXNzYWdlOiBzdHJpbmcpOiBBY2FkZW1pY1N1YmplY3QgfCB1bmRlZmluZWQge1xuICAgIGNvbnN0IG1zZ0xvd2VyID0gbWVzc2FnZS50b0xvd2VyQ2FzZSgpXG4gICAgXG4gICAgaWYgKG1zZ0xvd2VyLmluY2x1ZGVzKCdtYXRlbcOhdGljYScpIHx8IG1zZ0xvd2VyLmluY2x1ZGVzKCfDoWxnZWJyYScpIHx8IFxuICAgICAgICBtc2dMb3dlci5pbmNsdWRlcygnZ2VvbWV0csOtYScpIHx8IG1zZ0xvd2VyLmluY2x1ZGVzKCdjw6FsY3VsbycpKSB7XG4gICAgICByZXR1cm4gQWNhZGVtaWNTdWJqZWN0Lk1BVEhFTUFUSUNTXG4gICAgfVxuICAgIGlmIChtc2dMb3dlci5pbmNsdWRlcygnZsOtc2ljYScpIHx8IG1zZ0xvd2VyLmluY2x1ZGVzKCdtZWPDoW5pY2EnKSB8fCBcbiAgICAgICAgbXNnTG93ZXIuaW5jbHVkZXMoJ2VuZXJnw61hJykgfHwgbXNnTG93ZXIuaW5jbHVkZXMoJ2Z1ZXJ6YScpKSB7XG4gICAgICByZXR1cm4gQWNhZGVtaWNTdWJqZWN0LlBIWVNJQ1NcbiAgICB9XG4gICAgaWYgKG1zZ0xvd2VyLmluY2x1ZGVzKCdxdcOtbWljYScpIHx8IG1zZ0xvd2VyLmluY2x1ZGVzKCfDoXRvbW8nKSB8fCBcbiAgICAgICAgbXNnTG93ZXIuaW5jbHVkZXMoJ3JlYWNjacOzbicpIHx8IG1zZ0xvd2VyLmluY2x1ZGVzKCdlbGVtZW50bycpKSB7XG4gICAgICByZXR1cm4gQWNhZGVtaWNTdWJqZWN0LkNIRU1JU1RSWVxuICAgIH1cbiAgICBcbiAgICByZXR1cm4gdW5kZWZpbmVkXG4gIH1cblxuICAvKipcbiAgICogRXh0cmFlIGVsIHRlbWEgZXNwZWPDrWZpY28gZGVsIG1lbnNhamVcbiAgICovXG4gIHByaXZhdGUgc3RhdGljIGV4dHJhY3RUb3BpYyhtZXNzYWdlOiBzdHJpbmcpOiBzdHJpbmcge1xuICAgIC8vIEV4dHJhZXIgcGFsYWJyYXMgY2xhdmUgcXVlIHBvZHLDrWFuIHNlciB0ZW1hc1xuICAgIGNvbnN0IHdvcmRzID0gbWVzc2FnZS50b0xvd2VyQ2FzZSgpLnNwbGl0KCcgJylcbiAgICBjb25zdCB0b3BpY3MgPSBbJ2VjdWFjaW9uZXMnLCAnZnVuY2lvbmVzJywgJ2Rlcml2YWRhcycsICdpbnRlZ3JhbGVzJywgJ2dlb21ldHLDrWEnLFxuICAgICAgICAgICAgICAgICAgICdjaW5lbcOhdGljYScsICdkaW7DoW1pY2EnLCAndGVybW9kaW7DoW1pY2EnLCAnZWxlY3RyaWNpZGFkJyxcbiAgICAgICAgICAgICAgICAgICAnw6F0b21vcycsICdtb2zDqWN1bGFzJywgJ2VubGFjZXMnLCAncmVhY2Npb25lcyddXG4gICAgXG4gICAgY29uc3QgZm91bmRUb3BpYyA9IHRvcGljcy5maW5kKHRvcGljID0+IHdvcmRzLmluY2x1ZGVzKHRvcGljKSlcbiAgICByZXR1cm4gZm91bmRUb3BpYyB8fCAndGVtYSBnZW5lcmFsJ1xuICB9XG5cbiAgLyoqXG4gICAqIE1hbmVqYSBsYSByZXNvbHVjacOzbiBkZSBlamVyY2ljaW9zIHBhc28gYSBwYXNvIChzdGF0ZWxlc3MpXG4gICAqL1xuICBwcml2YXRlIHN0YXRpYyBhc3luYyBoYW5kbGVFeGVyY2lzZVNvbHV0aW9uKG1lc3NhZ2U6IHN0cmluZywgc3ViamVjdDogQWNhZGVtaWNTdWJqZWN0LCBhY2FkZW1pY0FuYWx5c2lzOiBBY2FkZW1pY0FuYWx5c2lzLCB1c2VyTmFtZT86IHN0cmluZyk6IFByb21pc2U8Q2hhdE1lc3NhZ2U+IHtcbiAgICAvLyBNYXBlYXIgQWNhZGVtaWNTdWJqZWN0IGEgbG9zIHN1YmplY3RzIGRlbCBFeGVyY2lzZVNvbHZlclxuICAgIGNvbnN0IHN1YmplY3RNYXAgPSB7XG4gICAgICBbQWNhZGVtaWNTdWJqZWN0LlBIWVNJQ1NdOiAncGh5c2ljcycgYXMgY29uc3QsXG4gICAgICBbQWNhZGVtaWNTdWJqZWN0LkNIRU1JU1RSWV06ICdjaGVtaXN0cnknIGFzIGNvbnN0LFxuICAgICAgW0FjYWRlbWljU3ViamVjdC5NQVRIRU1BVElDU106ICdtYXRoZW1hdGljcycgYXMgY29uc3QsXG4gICAgICBbQWNhZGVtaWNTdWJqZWN0LkdFTkVSQUxdOiAnZ2VuZXJhbCcgYXMgY29uc3RcbiAgICB9XG5cbiAgICBjb25zdCBzb2x2ZXJTdWJqZWN0ID0gc3ViamVjdE1hcFtzdWJqZWN0XSB8fCAnZ2VuZXJhbCdcbiAgICBcbiAgICAvLyBPYnRlbmVyIGNvbnRleHRvIGRlbCBlc3R1ZGlhbnRlXG4gICAgY29uc3Qgc3R1ZGVudENvbnRleHQgPSBBY2FkZW1pY0FuYWx5emVyLmdldEV4ZXJjaXNlQ29udGV4dChhY2FkZW1pY0FuYWx5c2lzLCBzdWJqZWN0KVxuXG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHNvbHV0aW9uID0gYXdhaXQgRXhlcmNpc2VTb2x2ZXIuc29sdmVFeGVyY2lzZShtZXNzYWdlLCBzb2x2ZXJTdWJqZWN0LCBzdHVkZW50Q29udGV4dClcbiAgICAgIFxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgaWQ6IGBhaV8ke0RhdGUubm93KCl9YCxcbiAgICAgICAgdHlwZTogJ2FpJyxcbiAgICAgICAgY29udGVudDogc29sdXRpb24uc29sdXRpb24sXG4gICAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKSxcbiAgICAgICAgbWV0YWRhdGE6IHtcbiAgICAgICAgICBzdWJqZWN0OiB0aGlzLmdldFN1YmplY3ROYW1lKHN1YmplY3QpLFxuICAgICAgICAgIHN1Z2dlc3RlZEFjdGlvbnM6IFtcbiAgICAgICAgICAgICdFeHBsaWNhciB1biBwYXNvIGVzcGVjw61maWNvJyxcbiAgICAgICAgICAgICdSZXNvbHZlciBvdHJvIGVqZXJjaWNpbyBzaW1pbGFyJywgXG4gICAgICAgICAgICAnVmVyaWZpY2FyIG1pIHNvbHVjacOzbicsXG4gICAgICAgICAgICAnUHJhY3RpY2FyIG3DoXMgZWplcmNpY2lvcydcbiAgICAgICAgICBdXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignRXJyb3Igc29sdmluZyBleGVyY2lzZTonLCBlcnJvcilcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGlkOiBgYWlfJHtEYXRlLm5vdygpfWAsXG4gICAgICAgIHR5cGU6ICdhaScsXG4gICAgICAgIGNvbnRlbnQ6IGBIZSBkZXRlY3RhZG8gcXVlIHF1aWVyZXMgcmVzb2x2ZXIgdW4gZWplcmNpY2lvIGRlICR7dGhpcy5nZXRTdWJqZWN0TmFtZShzdWJqZWN0KX0uXFxuXFxuYCArXG4gICAgICAgICAgYEVzdG95IHRlbmllbmRvIGRpZmljdWx0YWRlcyB0w6ljbmljYXMgcGFyYSByZXNvbHZlcmxvIGFob3JhIG1pc21vLCBwZXJvIHB1ZWRvIGF5dWRhcnRlIGRlIG90cmFzIG1hbmVyYXM6XFxuXFxuYCArXG4gICAgICAgICAgYOKAoiBUZSBwdWVkbyBndWlhciBwYXNvIGEgcGFzbyBlbiBsYSBtZXRvZG9sb2fDrWFcXG5gICtcbiAgICAgICAgICBg4oCiIFB1ZWRvIGV4cGxpY2FydGUgbG9zIGNvbmNlcHRvcyBxdWUgbmVjZXNpdGFzXFxuYCArXG4gICAgICAgICAgYOKAoiBUZSBheXVkbyBhIG9yZ2FuaXphciBsb3MgZGF0b3MgZGVsIHByb2JsZW1hXFxuXFxuYCArXG4gICAgICAgICAgYMK/VGUgZ3VzdGFyw61hIHF1ZSBlbXBlY2Vtb3MgY29uIGFsZ3VubyBkZSBlc3RvcyBlbmZvcXVlcz9gLFxuICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCksXG4gICAgICAgIG1ldGFkYXRhOiB7XG4gICAgICAgICAgc3ViamVjdDogdGhpcy5nZXRTdWJqZWN0TmFtZShzdWJqZWN0KSxcbiAgICAgICAgICBzdWdnZXN0ZWRBY3Rpb25zOiBbJ0d1aWFyIG1ldG9kb2xvZ8OtYScsICdFeHBsaWNhciBjb25jZXB0b3MnLCAnT3JnYW5pemFyIGRhdG9zJ11cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBNYW5lamEgc29saWNpdHVkZXMgZGUgZXZhbHVhY2nDs24gKHN0YXRlbGVzcylcbiAgICovXG4gIHByaXZhdGUgc3RhdGljIGFzeW5jIGhhbmRsZUFzc2Vzc21lbnRSZXF1ZXN0KHN1YmplY3Q6IEFjYWRlbWljU3ViamVjdCwgYWNhZGVtaWNBbmFseXNpczogQWNhZGVtaWNBbmFseXNpcywgdXNlck5hbWU/OiBzdHJpbmcpOiBQcm9taXNlPENoYXRNZXNzYWdlPiB7XG4gICAgY29uc3Qgc3ViamVjdEFuYWx5c2lzID0gYWNhZGVtaWNBbmFseXNpcy5zdWJqZWN0cy5maW5kKHMgPT4gcy5zdWJqZWN0ID09PSBzdWJqZWN0KVxuICAgIFxuICAgIGxldCBjb250ZW50ID0gYMKhUGVyZmVjdG8hIFZhbW9zIGEgaGFjZXIgdW5hIGV2YWx1YWNpw7NuIGFkYXB0YXRpdmEgZGUgJHt0aGlzLmdldFN1YmplY3ROYW1lKHN1YmplY3QpfS5cXG5cXG5gXG4gICAgXG4gICAgaWYgKHN1YmplY3RBbmFseXNpcykge1xuICAgICAgY29udGVudCArPSBgQmFzw6FuZG9tZSBlbiB0dSBwcm9ncmVzbyBhY3R1YWwgKCR7c3ViamVjdEFuYWx5c2lzLnBlcmZvcm1hbmNlfSUpLCBgXG4gICAgICBcbiAgICAgIGlmIChzdWJqZWN0QW5hbHlzaXMubmVlZHNBdHRlbnRpb24pIHtcbiAgICAgICAgY29udGVudCArPSBgdmVvIHF1ZSBoYXMgdGVuaWRvIGFsZ3VuYXMgZGlmaWN1bHRhZGVzIGNvbjogJHtzdWJqZWN0QW5hbHlzaXMuc3BlY2lmaWNDaGFsbGVuZ2VzLmpvaW4oJywgJyl9LlxcblxcbmBcbiAgICAgICAgY29udGVudCArPSBgRW1wZXphcmVtb3MgY29uIGVqZXJjaWNpb3MgZGUgcmVmdWVyem8gcGFyYSBmb3J0YWxlY2VyIGVzdG9zIGNvbmNlcHRvcy5gXG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjb250ZW50ICs9IGB0aWVuZXMgdW4gYnVlbiBkb21pbmlvLiBUZSBwcm9wb25nbyBlamVyY2ljaW9zIHF1ZSB0ZSBkZXNhZsOtZW4gdW4gcG9jbyBtw6FzLmBcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgY29udGVudCArPSBgQ29tbyBubyB0ZW5nbyBkYXRvcyBwcmV2aW9zIHNvYnJlIHR1IGRlc2VtcGXDsW8gZW4gZXN0YSBtYXRlcmlhLCBlbXBlemFyZW1vcyBjb24gdW5hIGV2YWx1YWNpw7NuIGRpYWduw7NzdGljYS5gXG4gICAgfVxuXG4gICAgY29udGVudCArPSBgXFxuXFxuwr9Fc3TDoXMgbGlzdG8gcGFyYSBjb21lbnphcj8gUHVlZGVzIGRlY2lybWUgc2kgcHJlZmllcmVzOlxcbmBcbiAgICBjb250ZW50ICs9IGDigKIgRWplcmNpY2lvcyBwYXNvIGEgcGFzb1xcbmBcbiAgICBjb250ZW50ICs9IGDigKIgUHJlZ3VudGFzIGRlIG9wY2nDs24gbcO6bHRpcGxlXFxuYFxuICAgIGNvbnRlbnQgKz0gYOKAoiBQcm9ibGVtYXMgcGFyYSByZXNvbHZlcmBcblxuICAgIHJldHVybiB7XG4gICAgICBpZDogYGFpXyR7RGF0ZS5ub3coKX1gLFxuICAgICAgdHlwZTogJ2FpJyxcbiAgICAgIGNvbnRlbnQsXG4gICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCksXG4gICAgICBtZXRhZGF0YToge1xuICAgICAgICBzdWJqZWN0LFxuICAgICAgICBzdWdnZXN0ZWRBY3Rpb25zOiBbJ0NvbWVuemFyIGVqZXJjaWNpb3MgcGFzbyBhIHBhc28nLCAnUHJlZ3VudGFzIG9wY2nDs24gbcO6bHRpcGxlJywgJ1Byb2JsZW1hcyBwYXJhIHJlc29sdmVyJ11cbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogTWFuZWphIHByZWd1bnRhcyBlZHVjYXRpdmFzIChzdGF0ZWxlc3MpXG4gICAqL1xuICBwcml2YXRlIHN0YXRpYyBhc3luYyBoYW5kbGVFZHVjYXRpb25hbFF1ZXN0aW9uKHF1ZXN0aW9uOiBzdHJpbmcsIHN1YmplY3Q6IEFjYWRlbWljU3ViamVjdCB8IHVuZGVmaW5lZCwgYWNhZGVtaWNBbmFseXNpczogQWNhZGVtaWNBbmFseXNpcywgdXNlck5hbWU/OiBzdHJpbmcpOiBQcm9taXNlPENoYXRNZXNzYWdlPiB7XG4gICAgLy8gQ3JlYXIgcHJvbXB0IGNvbnRleHR1YWxpemFkbyBwYXJhIGxhIElBXG4gICAgY29uc3QgYW5hbHlzaXNDb250ZXh0ID0gQWNhZGVtaWNBbmFseXplci5nZXRFeGVyY2lzZUNvbnRleHQoYWNhZGVtaWNBbmFseXNpcywgc3ViamVjdClcblxuICAgIGNvbnN0IHByb21wdCA9IGBFcmVzIHVuIHR1dG9yIGVkdWNhdGl2byBleHBlcnRvLiBSZXNwb25kZSBlc3RhIHByZWd1bnRhIGRlIHVuIGVzdHVkaWFudGUgZGUgc2VjdW5kYXJpYTpcblxuUHJlZ3VudGE6IFwiJHtxdWVzdGlvbn1cIlxuXG5Db250ZXh0byBkZWwgZXN0dWRpYW50ZTogJHthbmFseXNpc0NvbnRleHR9XG5cbkluc3RydWNjaW9uZXM6XG4tIFJlc3BvbmRlIGRlIG1hbmVyYSBjbGFyYSB5IGRpZMOhY3RpY2Fcbi0gVXNhIGVqZW1wbG9zIGNvbmNyZXRvcyB5IHJlbGV2YW50ZXNcbi0gQWRhcHRhIGVsIGxlbmd1YWplIGFsIG5pdmVsIGRlbCBlc3R1ZGlhbnRlXG4tIFNpIGVzIHVuIGNvbmNlcHRvIGNvbXBsZWpvLCBkaXbDrWRlbG8gZW4gcGFzb3Mgc2ltcGxlc1xuLSBPZnJlY2UgYWwgZmluYWwgcHJlZ3VudGFybGUgc2kgcXVpZXJlIHByYWN0aWNhciBjb24gZWplcmNpY2lvc1xuXG5SZXNwdWVzdGE6YFxuXG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGFpUmVzcG9uc2UgPSBhd2FpdCBhaVNlcnZpY2UuZ2VuZXJhdGVFeGVyY2lzZShwcm9tcHQpXG4gICAgICBcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGlkOiBgYWlfJHtEYXRlLm5vdygpfWAsXG4gICAgICAgIHR5cGU6ICdhaScsXG4gICAgICAgIGNvbnRlbnQ6IGFpUmVzcG9uc2UgPT09ICdURU1QTEFURV9GQUxMQkFDSycgPyBcbiAgICAgICAgICB0aGlzLmdldEZhbGxiYWNrRWR1Y2F0aW9uYWxSZXNwb25zZShxdWVzdGlvbiwgc3ViamVjdCkgOiBcbiAgICAgICAgICBhaVJlc3BvbnNlLFxuICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCksXG4gICAgICAgIG1ldGFkYXRhOiB7XG4gICAgICAgICAgc3ViamVjdCxcbiAgICAgICAgICBzdWdnZXN0ZWRBY3Rpb25zOiBbJ1ByYWN0aWNhciBjb24gZWplcmNpY2lvcycsICdIYWNlciBtw6FzIHByZWd1bnRhcycsICdFeHBsaWNhY2nDs24gbcOhcyBkZXRhbGxhZGEnXVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGlkOiBgYWlfJHtEYXRlLm5vdygpfWAsXG4gICAgICAgIHR5cGU6ICdhaScsXG4gICAgICAgIGNvbnRlbnQ6IHRoaXMuZ2V0RmFsbGJhY2tFZHVjYXRpb25hbFJlc3BvbnNlKHF1ZXN0aW9uLCBzdWJqZWN0KSxcbiAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLFxuICAgICAgICBtZXRhZGF0YTogeyBzdWJqZWN0IH1cbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogTWFuZWphIHNvbGljaXR1ZGVzIGRlIGF5dWRhIChzdGF0ZWxlc3MpXG4gICAqL1xuICBwcml2YXRlIHN0YXRpYyBhc3luYyBoYW5kbGVIZWxwUmVxdWVzdCh0b3BpYzogc3RyaW5nLCBhY2FkZW1pY0FuYWx5c2lzOiBBY2FkZW1pY0FuYWx5c2lzLCB1c2VyTmFtZT86IHN0cmluZyk6IFByb21pc2U8Q2hhdE1lc3NhZ2U+IHtcbiAgICBsZXQgY29udGVudCA9IGBFbnRpZW5kbyBxdWUgbmVjZXNpdGFzIGF5dWRhIGNvbiAke3RvcGljfS4gYFxuICAgIFxuICAgIGNvbnN0IHN0cnVnZ2xpbmdBcmVhcyA9IGFjYWRlbWljQW5hbHlzaXMuc3RydWdnbGluZ0FyZWFzXG4gICAgaWYgKHN0cnVnZ2xpbmdBcmVhcy5zb21lKGFyZWEgPT4gYXJlYS50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKHRvcGljLnRvTG93ZXJDYXNlKCkpKSkge1xuICAgICAgY29udGVudCArPSBgVmVvIHF1ZSBoYXMgbWVuY2lvbmFkbyBkaWZpY3VsdGFkZXMgc2ltaWxhcmVzIGVuIHR1cyByZXBvcnRlcyBhbnRlcmlvcmVzLlxcblxcbmBcbiAgICB9XG5cbiAgICBjb250ZW50ICs9IGBWYW1vcyBhIGFib3JkYXIgZXN0byBwYXNvIGEgcGFzbzpcXG5cXG5gXG4gICAgY29udGVudCArPSBgMS4gKipQcmltZXJvKio6IMK/UG9kcsOtYXMgY29udGFybWUgZXNwZWPDrWZpY2FtZW50ZSBxdcOpIHBhcnRlIGRlICR7dG9waWN9IHRlIHJlc3VsdGEgbcOhcyBjb25mdXNhP1xcbmBcbiAgICBjb250ZW50ICs9IGAyLiAqKlNlZ3VuZG8qKjogVGUgYXl1ZGFyw6kgY29uIGV4cGxpY2FjaW9uZXMgc2ltcGxlcyB5IGVqZW1wbG9zXFxuYFxuICAgIGNvbnRlbnQgKz0gYDMuICoqVGVyY2VybyoqOiBQcmFjdGljYXJlbW9zIGNvbiBlamVyY2ljaW9zIGdyYWR1YWxlc1xcblxcbmBcbiAgICBjb250ZW50ICs9IGDCv1BvciBkw7NuZGUgdGUgZ3VzdGFyw61hIGVtcGV6YXI/YFxuXG4gICAgcmV0dXJuIHtcbiAgICAgIGlkOiBgYWlfJHtEYXRlLm5vdygpfWAsXG4gICAgICB0eXBlOiAnYWknLFxuICAgICAgY29udGVudCxcbiAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKSxcbiAgICAgIG1ldGFkYXRhOiB7XG4gICAgICAgIHN1Z2dlc3RlZEFjdGlvbnM6IFsnRXhwbGljYXIgbWkgZGlmaWN1bHRhZCBlc3BlY8OtZmljYScsICdWZXIgZWplbXBsb3Mgc2ltcGxlcycsICdFbXBlemFyIGNvbiBsbyBiw6FzaWNvJ11cbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogTWFuZWphIGNoYXJsYSBjYXN1YWwgKHN0YXRlbGVzcylcbiAgICovXG4gIHByaXZhdGUgc3RhdGljIGFzeW5jIGhhbmRsZUNhc3VhbENoYXQobWVzc2FnZTogc3RyaW5nLCB1c2VyTmFtZT86IHN0cmluZyk6IFByb21pc2U8Q2hhdE1lc3NhZ2U+IHtcbiAgICBjb25zdCBtc2dMb3dlciA9IG1lc3NhZ2UudG9Mb3dlckNhc2UoKVxuICAgIFxuICAgIGxldCBjb250ZW50ID0gJydcbiAgICBcbiAgICBpZiAobXNnTG93ZXIuaW5jbHVkZXMoJ2hvbGEnKSkge1xuICAgICAgY29udGVudCA9IGDCoUhvbGEke3VzZXJOYW1lID8gJyAnICsgdXNlck5hbWUgOiAnJ30hIPCfmIogYFxuICAgICAgY29udGVudCArPSBgwr9FbiBxdcOpIHB1ZWRvIGF5dWRhcnRlIGhveT8gUHVlZG8gYXl1ZGFydGUgY29uIHR1cyBtYXRlcmlhcywgcmVzb2x2ZXIgZHVkYXMgbyBoYWNlciBlamVyY2ljaW9zIGp1bnRvcy5gXG4gICAgfSBlbHNlIGlmIChtc2dMb3dlci5pbmNsdWRlcygnZ3JhY2lhcycpKSB7XG4gICAgICBjb250ZW50ID0gYMKhRGUgbmFkYSEgRXMgdW4gcGxhY2VyIGF5dWRhcnRlLiDwn5iKIGBcbiAgICAgIGNvbnRlbnQgKz0gYMK/SGF5IGFsZ28gbcOhcyBlbiBsbyBxdWUgcHVlZGEgYXBveWFydGU/IEVzdG95IGFxdcOtIHBhcmEgcXVlIGFwcmVuZGFzIHkgdGUgZGl2aWVydGFzIGhhY2nDqW5kb2xvLmBcbiAgICB9IGVsc2UgaWYgKG1zZ0xvd2VyLmluY2x1ZGVzKCdiaWVuJykgfHwgbXNnTG93ZXIuaW5jbHVkZXMoJ2dlbmlhbCcpKSB7XG4gICAgICBjb250ZW50ID0gYMKhUXXDqSBidWVubyBlc2N1Y2hhciBlc28hIPCfjokgYFxuICAgICAgY29udGVudCArPSBgwr9UZSBndXN0YXLDrWEgYXByb3ZlY2hhciBlc3RlIGJ1ZW4gbW9tZW50byBwYXJhIHByYWN0aWNhciBhbGfDum4gdGVtYSBvIHJlc29sdmVyIGFsZ3VuYSBkdWRhP2BcbiAgICB9IGVsc2UgaWYgKG1zZ0xvd2VyLmluY2x1ZGVzKCdtYWwnKSB8fCBtc2dMb3dlci5pbmNsdWRlcygnZGlmw61jaWwnKSkge1xuICAgICAgY29udGVudCA9IGBFbnRpZW5kbyBxdWUgdGUgc2llbnRlcyBhc8OtLiBFcyBub3JtYWwgdGVuZXIgZMOtYXMgbcOhcyBkZXNhZmlhbnRlcy4g8J+SqiBgXG4gICAgICBjb250ZW50ICs9IGDCv1F1aWVyZXMgY29udGFybWUgcXXDqSBlc3TDoSBzaWVuZG8gZGlmw61jaWw/IEp1bnRvcyBwb2RlbW9zIGVuY29udHJhciBsYSBtYW5lcmEgZGUgaGFjZXJsbyBtw6FzIGbDoWNpbC5gXG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnRlbnQgPSBgR3JhY2lhcyBwb3IgY29tcGFydGlyIGVzbyBjb25taWdvLiDCv0PDs21vIHB1ZWRvIGF5dWRhcnRlIG1lam9yIGhveT9gXG4gICAgfVxuXG4gICAgcmV0dXJuIHtcbiAgICAgIGlkOiBgYWlfJHtEYXRlLm5vdygpfWAsXG4gICAgICB0eXBlOiAnYWknLFxuICAgICAgY29udGVudCxcbiAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKSxcbiAgICAgIG1ldGFkYXRhOiB7XG4gICAgICAgIHN1Z2dlc3RlZEFjdGlvbnM6IFsnVmVyIG1pcyBtYXRlcmlhcycsICdIYWNlciB1bmEgZXZhbHVhY2nDs24nLCAnUmVzb2x2ZXIgdW5hIGR1ZGEnXVxuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBNYW5lamEgYsO6c3F1ZWRhcyBhY2Fkw6ltaWNhcyAoc3RhdGVsZXNzKVxuICAgKi9cbiAgcHJpdmF0ZSBzdGF0aWMgYXN5bmMgaGFuZGxlQWNhZGVtaWNTZWFyY2goXG4gICAgbWVzc2FnZTogc3RyaW5nLCBcbiAgICBzdWJqZWN0OiBBY2FkZW1pY1N1YmplY3QgfCB1bmRlZmluZWQsIFxuICAgIHRvcGljOiBzdHJpbmcgfCB1bmRlZmluZWQsIFxuICAgIHVzZXJJZDogc3RyaW5nLFxuICAgIHVzZXJOYW1lPzogc3RyaW5nXG4gICk6IFByb21pc2U8Q2hhdE1lc3NhZ2U+IHtcbiAgICB0cnkge1xuICAgICAgLy8gUmVhbGl6YXIgYsO6c3F1ZWRhIGludGVsaWdlbnRlIHVzYW5kbyBlbCBtb3RvciBhY2Fkw6ltaWNvXG4gICAgICBjb25zdCBzZWFyY2hSZXN1bHQgPSBhd2FpdCBBY2FkZW1pY1NlYXJjaEVuZ2luZS5zbWFydFNlYXJjaChtZXNzYWdlLCB1c2VySWQpXG4gICAgICBcbiAgICAgIGlmICghc2VhcmNoUmVzdWx0KSB7XG4gICAgICAgIC8vIFNpIG5vIHNlIGRldGVjdMOzIHVuYSBiw7pzcXVlZGEgdsOhbGlkYSwgcmVzcG9uZGVyIGNvbiBzdWdlcmVuY2lhc1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIGlkOiBgYWlfJHtEYXRlLm5vdygpfWAsXG4gICAgICAgICAgdHlwZTogJ2FpJyxcbiAgICAgICAgICBjb250ZW50OiBgTm8gcHVkZSBpZGVudGlmaWNhciBleGFjdGFtZW50ZSBxdcOpIGVzdMOhcyBidXNjYW5kby4gwr9Qb2Ryw61hcyBzZXIgbcOhcyBlc3BlY8OtZmljbz9cXG5cXG5gICtcbiAgICAgICAgICAgIGBQb3IgZWplbXBsbzpcXG5gICtcbiAgICAgICAgICAgIGDigKIgXCJCdXNjYSBpbmZvcm1hY2nDs24gc29icmUgZWN1YWNpb25lcyBjdWFkcsOhdGljYXNcIlxcbmAgK1xuICAgICAgICAgICAgYOKAoiBcIk5lY2VzaXRvIGVqZW1wbG9zIGRlIHJlYWNjaW9uZXMgcXXDrW1pY2FzXCJcXG5gICtcbiAgICAgICAgICAgIGDigKIgXCJFbmN1ZW50cmEgcmVjdXJzb3Mgc29icmUgbGEgU2VndW5kYSBHdWVycmEgTXVuZGlhbFwiYCxcbiAgICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCksXG4gICAgICAgICAgbWV0YWRhdGE6IHtcbiAgICAgICAgICAgIHN1Z2dlc3RlZEFjdGlvbnM6IFsnUmVmb3JtdWxhciBiw7pzcXVlZGEnLCAnRXNwZWNpZmljYXIgdGVtYScsICdFbGVnaXIgbWF0ZXJpYSddXG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIC8vIEdlbmVyYXIgbm90aWZpY2FjacOzbiBwcm9hY3RpdmFcbiAgICAgIGNvbnN0IG5vdGlmaWNhdGlvbiA9IGF3YWl0IE5vdGlmaWNhdGlvblNlcnZpY2UuY3JlYXRlQWNhZGVtaWNOb3RpZmljYXRpb24oXG4gICAgICAgIHVzZXJJZCxcbiAgICAgICAgc2VhcmNoUmVzdWx0LnF1ZXJ5LFxuICAgICAgICBOb3RpZmljYXRpb25UcmlnZ2VyLktOT1dMRURHRV9HQVAsXG4gICAgICAgICfwn5SNIELDunNxdWVkYSBBY2Fkw6ltaWNhIENvbXBsZXRhZGEnLFxuICAgICAgICBgRW5jb250csOpIHJlY3Vyc29zIHZhbGlvc29zIHNvYnJlICR7c2VhcmNoUmVzdWx0LnF1ZXJ5LnRvcGljfSBxdWUgcHVlZGVuIGF5dWRhcnRlLmBcbiAgICAgIClcblxuICAgICAgLy8gQ29uc3RydWlyIHJlc3B1ZXN0YSBjb24gcmVzdWx0YWRvc1xuICAgICAgbGV0IGNvbnRlbnQgPSBg8J+UjSAqKkLDunNxdWVkYSBBY2Fkw6ltaWNhIENvbXBsZXRhZGEqKlxcblxcbmBcbiAgICAgIGNvbnRlbnQgKz0gYEhlIGVuY29udHJhZG8gKioke3NlYXJjaFJlc3VsdC50b3RhbFJlc3VsdHN9KiogcmVjdXJzb3Mgc29icmUgKioke3NlYXJjaFJlc3VsdC5xdWVyeS50b3BpY30qKjpcXG5cXG5gXG5cbiAgICAgIC8vIE1vc3RyYXIgbG9zIG1lam9yZXMgcmVzdWx0YWRvc1xuICAgICAgY29uc3QgdG9wUmVzdWx0cyA9IHNlYXJjaFJlc3VsdC5yZXN1bHRzLnNsaWNlKDAsIDMpXG4gICAgICB0b3BSZXN1bHRzLmZvckVhY2goKHJlc3VsdCwgaW5kZXgpID0+IHtcbiAgICAgICAgY29udGVudCArPSBgKioke2luZGV4ICsgMX0uICR7cmVzdWx0LnRpdGxlfSoqXFxuYFxuICAgICAgICBjb250ZW50ICs9IGDwn5OWICR7cmVzdWx0LnN1bW1hcnl9XFxuYFxuICAgICAgICBjb250ZW50ICs9IGDirZAgUmVsZXZhbmNpYTogJHsocmVzdWx0LnJlbGV2YW5jZVNjb3JlICogMTAwKS50b0ZpeGVkKDApfSUgfCBgXG4gICAgICAgIGNvbnRlbnQgKz0gYPCfk5ogTml2ZWw6ICR7cmVzdWx0LmRpZmZpY3VsdHl9IHwgYFxuICAgICAgICBjb250ZW50ICs9IGDij7HvuI8gTGVjdHVyYTogJHtyZXN1bHQuZXN0aW1hdGVkUmVhZFRpbWV9IG1pblxcblxcbmBcbiAgICAgIH0pXG5cbiAgICAgIC8vIEFncmVnYXIgcmVjb21lbmRhY2lvbmVzIHBlcnNvbmFsaXphZGFzXG4gICAgICBpZiAoc2VhcmNoUmVzdWx0LnBlcnNvbmFsaXplZFJlY29tbWVuZGF0aW9ucy5sZW5ndGggPiAwKSB7XG4gICAgICAgIGNvbnRlbnQgKz0gYPCfkqEgKipSZWNvbWVuZGFjaW9uZXMgUGVyc29uYWxpemFkYXM6KipcXG5gXG4gICAgICAgIHNlYXJjaFJlc3VsdC5wZXJzb25hbGl6ZWRSZWNvbW1lbmRhdGlvbnMuZm9yRWFjaChyZWMgPT4ge1xuICAgICAgICAgIGNvbnRlbnQgKz0gYOKAoiAke3JlY31cXG5gXG4gICAgICAgIH0pXG4gICAgICAgIGNvbnRlbnQgKz0gYFxcbmBcbiAgICAgIH1cblxuICAgICAgLy8gQWdyZWdhciBwcmVndW50YXMgZGUgc2VndWltaWVudG9cbiAgICAgIGlmIChzZWFyY2hSZXN1bHQuZm9sbG93VXBRdWVzdGlvbnMubGVuZ3RoID4gMCkge1xuICAgICAgICBjb250ZW50ICs9IGDinZMgKirCv1RlIGludGVyZXNhIHNhYmVyIG3DoXMgc29icmU6KipcXG5gXG4gICAgICAgIHNlYXJjaFJlc3VsdC5mb2xsb3dVcFF1ZXN0aW9ucy5zbGljZSgwLCAyKS5mb3JFYWNoKHF1ZXN0aW9uID0+IHtcbiAgICAgICAgICBjb250ZW50ICs9IGDigKIgJHtxdWVzdGlvbn1cXG5gXG4gICAgICAgIH0pXG4gICAgICB9XG5cbiAgICAgIHJldHVybiB7XG4gICAgICAgIGlkOiBgYWlfJHtEYXRlLm5vdygpfWAsXG4gICAgICAgIHR5cGU6ICdhaScsXG4gICAgICAgIGNvbnRlbnQsXG4gICAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKSxcbiAgICAgICAgbWV0YWRhdGE6IHtcbiAgICAgICAgICBzdWJqZWN0LFxuICAgICAgICAgIHN1Z2dlc3RlZEFjdGlvbnM6IFtcbiAgICAgICAgICAgICdWZXIgZGV0YWxsZXMgZGUgcmVzdWx0YWRvcycsXG4gICAgICAgICAgICAnQnVzY2FyIHRlbWEgcmVsYWNpb25hZG8nLFxuICAgICAgICAgICAgJ0dlbmVyYXIgZWplcmNpY2lvcycsXG4gICAgICAgICAgICAnQ3JlYXIgcmVjb3JkYXRvcmlvJ1xuICAgICAgICAgIF0sXG4gICAgICAgICAgc2VhcmNoUmVzdWx0czogc2VhcmNoUmVzdWx0LFxuICAgICAgICAgIG5vdGlmaWNhdGlvblxuICAgICAgICB9XG4gICAgICB9XG5cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgaW4gYWNhZGVtaWMgc2VhcmNoOicsIGVycm9yKVxuICAgICAgXG4gICAgICByZXR1cm4ge1xuICAgICAgICBpZDogYGFpXyR7RGF0ZS5ub3coKX1gLFxuICAgICAgICB0eXBlOiAnYWknLFxuICAgICAgICBjb250ZW50OiBgSHVibyB1biBwcm9ibGVtYSBhbCBidXNjYXIgaW5mb3JtYWNpw7NuIHNvYnJlIFwiJHt0b3BpYyB8fCAndHUgY29uc3VsdGEnfVwiLiBgICtcbiAgICAgICAgICBgRXN0byBwdWVkZSBkZWJlcnNlIGEgcHJvYmxlbWFzIGRlIGNvbmVjdGl2aWRhZC5cXG5cXG5gICtcbiAgICAgICAgICBgTWllbnRyYXMgdGFudG8sIHB1ZWRvIGF5dWRhcnRlIGNvbjpcXG5gICtcbiAgICAgICAgICBg4oCiIEV4cGxpY2FjaW9uZXMgc29icmUgY29uY2VwdG9zIGVzcGVjw61maWNvc1xcbmAgK1xuICAgICAgICAgIGDigKIgRWplcmNpY2lvcyBzb2JyZSB0ZW1hcyBxdWUgeWEgZG9taW5vXFxuYCArXG4gICAgICAgICAgYOKAoiBSZXBhc28gZGUgbWF0ZXJpYWwgcHJldmlvYCxcbiAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLFxuICAgICAgICBtZXRhZGF0YToge1xuICAgICAgICAgIHN1YmplY3QsXG4gICAgICAgICAgc3VnZ2VzdGVkQWN0aW9uczogWydSZWludGVudGFyIGLDunNxdWVkYScsICdFeHBsaWNhciBjb25jZXB0b3MnLCAnSGFjZXIgZWplcmNpY2lvcyddXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogTWFuZWphIHJlc3B1ZXN0YXMgZ2VuZXJhbGVzIChzdGF0ZWxlc3MpXG4gICAqL1xuICBwcml2YXRlIHN0YXRpYyBhc3luYyBoYW5kbGVHZW5lcmFsUmVzcG9uc2UobWVzc2FnZTogc3RyaW5nKTogUHJvbWlzZTxDaGF0TWVzc2FnZT4ge1xuICAgIGNvbnN0IGNvbnRlbnQgPSBgRW50aWVuZG8gdHUgbWVuc2FqZS4gwr9Qb2Ryw61hcyBzZXIgbcOhcyBlc3BlY8OtZmljbyBzb2JyZSBjw7NtbyBwdWVkbyBheXVkYXJ0ZT9cXG5cXG5gICtcbiAgICAgIGBQdWVkbyBheXVkYXJ0ZSBjb246XFxuYCArXG4gICAgICBg4oCiIFJlc29sdmVyIGR1ZGFzIHNvYnJlIHR1cyBtYXRlcmlhc1xcbmAgK1xuICAgICAgYOKAoiBIYWNlciBlamVyY2ljaW9zIHkgZXZhbHVhY2lvbmVzXFxuYCArXG4gICAgICBg4oCiIEV4cGxpY2FyIGNvbmNlcHRvcyBkaWbDrWNpbGVzXFxuYCArXG4gICAgICBg4oCiIEJ1c2NhciBpbmZvcm1hY2nDs24gYWNhZMOpbWljYVxcbmAgK1xuICAgICAgYOKAoiBSZXZpc2FyIHR1IHByb2dyZXNvIGFjYWTDqW1pY29cXG5cXG5gICtcbiAgICAgIGDCv1F1w6kgdGUgaW50ZXJlc2EgbcOhcz9gXG5cbiAgICByZXR1cm4ge1xuICAgICAgaWQ6IGBhaV8ke0RhdGUubm93KCl9YCxcbiAgICAgIHR5cGU6ICdhaScsXG4gICAgICBjb250ZW50LFxuICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLFxuICAgICAgbWV0YWRhdGE6IHtcbiAgICAgICAgc3VnZ2VzdGVkQWN0aW9uczogWydSZXNvbHZlciBkdWRhcycsICdIYWNlciBlamVyY2ljaW9zJywgJ0J1c2NhciBpbmZvcm1hY2nDs24nLCAnVmVyIG1pIHByb2dyZXNvJ11cbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogQ3JlYSBtZW5zYWplIGRlIGJpZW52ZW5pZGEgcGVyc29uYWxpemFkbyAoc3RhdGVsZXNzKVxuICAgKi9cbiAgc3RhdGljIGFzeW5jIGNyZWF0ZVdlbGNvbWVNZXNzYWdlKHVzZXJJZDogc3RyaW5nLCB1c2VyTmFtZT86IHN0cmluZyk6IFByb21pc2U8Q2hhdE1lc3NhZ2U+IHtcbiAgICBjb25zdCBhbmFseXNpcyA9IGF3YWl0IEFjYWRlbWljQW5hbHl6ZXIuYW5hbHl6ZVN0dWRlbnQodXNlcklkKVxuICAgIFxuICAgIGxldCBjb250ZW50ID0gYMKhSG9sYSR7dXNlck5hbWUgPyAnICcgKyB1c2VyTmFtZSA6ICcnfSEg8J+RiyBTb3kgdHUgdHV0b3IgcGVyc29uYWwgZGUgSUEuXFxuXFxuYFxuICAgIFxuICAgIGlmIChhbmFseXNpcy5zdWJqZWN0cy5sZW5ndGggPiAwKSB7XG4gICAgICBjb250ZW50ICs9IGBIZSByZXZpc2FkbyB0dSBwcm9ncmVzbyBhY2Fkw6ltaWNvIHkgdmVvIHF1ZSB0aWVuZXM6XFxuYFxuICAgICAgXG4gICAgICBjb25zdCBzdHJvbmdTdWJqZWN0cyA9IGFuYWx5c2lzLnN1YmplY3RzLmZpbHRlcihzID0+IHMucGVyZm9ybWFuY2UgPiA3NSlcbiAgICAgIGNvbnN0IHN0cnVnZ2xpbmdTdWJqZWN0cyA9IGFuYWx5c2lzLnN1YmplY3RzLmZpbHRlcihzID0+IHMubmVlZHNBdHRlbnRpb24pXG4gICAgICBcbiAgICAgIGlmIChzdHJvbmdTdWJqZWN0cy5sZW5ndGggPiAwKSB7XG4gICAgICAgIGNvbnRlbnQgKz0gYOKchSAqKkZvcnRhbGV6YXMqKjogJHtzdHJvbmdTdWJqZWN0cy5tYXAocyA9PiBzLnN1YmplY3ROYW1lKS5qb2luKCcsICcpfVxcbmBcbiAgICAgIH1cbiAgICAgIFxuICAgICAgaWYgKHN0cnVnZ2xpbmdTdWJqZWN0cy5sZW5ndGggPiAwKSB7XG4gICAgICAgIGNvbnRlbnQgKz0gYPCfjq8gKirDgXJlYXMgZGUgbWVqb3JhKio6ICR7c3RydWdnbGluZ1N1YmplY3RzLm1hcChzID0+IHMuc3ViamVjdE5hbWUpLmpvaW4oJywgJyl9XFxuYFxuICAgICAgfVxuICAgICAgXG4gICAgICBjb250ZW50ICs9IGBcXG5gXG4gICAgfVxuICAgIFxuICAgIGNvbnRlbnQgKz0gYMK/RW4gcXXDqSBwdWVkbyBheXVkYXJ0ZSBob3k/XFxuYFxuICAgIGNvbnRlbnQgKz0gYOKAoiAqKlJlc29sdmVyIGVqZXJjaWNpb3MqKjogUGFzbyBhIHBhc28gY29uIGV4cGxpY2FjaW9uZXMgZGV0YWxsYWRhc1xcbmBcbiAgICBjb250ZW50ICs9IGDigKIgKipFdmFsdWFjacOzbioqOiBIYWNlciBlamVyY2ljaW9zIGFkYXB0YXRpdm9zXFxuYFxuICAgIGNvbnRlbnQgKz0gYOKAoiAqKkR1ZGFzKio6IFJlc29sdmVyIHByZWd1bnRhcyBlc3BlY8OtZmljYXNcXG5gXG4gICAgY29udGVudCArPSBg4oCiICoqUmVwYXNvKio6IFJldmlzYXIgY29uY2VwdG9zIGltcG9ydGFudGVzYFxuXG4gICAgLy8gT2J0ZW5lciBhY2Npb25lcyBzdWdlcmlkYXNcbiAgICBjb25zdCBhY3Rpb25zOiBzdHJpbmdbXSA9IFtdXG4gICAgY29uc3Qgc3RydWdnbGluZ1N1YmplY3RzID0gYW5hbHlzaXMuc3ViamVjdHMuZmlsdGVyKHMgPT4gcy5uZWVkc0F0dGVudGlvbilcbiAgICBpZiAoc3RydWdnbGluZ1N1YmplY3RzLmxlbmd0aCA+IDApIHtcbiAgICAgIGFjdGlvbnMucHVzaChgUHJhY3RpY2FyICR7c3RydWdnbGluZ1N1YmplY3RzWzBdLnN1YmplY3ROYW1lfWApXG4gICAgfVxuICAgIGFjdGlvbnMucHVzaCgnSGFjZXIgdW5hIGV2YWx1YWNpw7NuJylcbiAgICBhY3Rpb25zLnB1c2goJ1Jlc29sdmVyIHVuYSBkdWRhJylcbiAgICBhY3Rpb25zLnB1c2goJ1ZlciBtaSBwcm9ncmVzbycpXG5cbiAgICByZXR1cm4ge1xuICAgICAgaWQ6IGB3ZWxjb21lXyR7RGF0ZS5ub3coKX1gLFxuICAgICAgdHlwZTogJ2FpJyxcbiAgICAgIGNvbnRlbnQsXG4gICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCksXG4gICAgICBtZXRhZGF0YToge1xuICAgICAgICBzdWdnZXN0ZWRBY3Rpb25zOiBhY3Rpb25zXG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIE9idGllbmUgZWwgbm9tYnJlIGxlZ2libGUgZGUgdW5hIG1hdGVyaWFcbiAgICovXG4gIHByaXZhdGUgc3RhdGljIGdldFN1YmplY3ROYW1lKHN1YmplY3Q6IEFjYWRlbWljU3ViamVjdCk6IHN0cmluZyB7XG4gICAgY29uc3QgbmFtZXMgPSB7XG4gICAgICBbQWNhZGVtaWNTdWJqZWN0Lk1BVEhFTUFUSUNTXTogJ01hdGVtw6F0aWNhcycsXG4gICAgICBbQWNhZGVtaWNTdWJqZWN0LlBIWVNJQ1NdOiAnRsOtc2ljYScsXG4gICAgICBbQWNhZGVtaWNTdWJqZWN0LkNIRU1JU1RSWV06ICdRdcOtbWljYScsXG4gICAgICBbQWNhZGVtaWNTdWJqZWN0LkJJT0xPR1ldOiAnQmlvbG9nw61hJyxcbiAgICAgIFtBY2FkZW1pY1N1YmplY3QuU1BBTklTSF06ICdMZW5ndWEgeSBMaXRlcmF0dXJhJyxcbiAgICAgIFtBY2FkZW1pY1N1YmplY3QuRU5HTElTSF06ICdJbmdsw6lzJyxcbiAgICAgIFtBY2FkZW1pY1N1YmplY3QuSElTVE9SWV06ICdIaXN0b3JpYScsXG4gICAgICBbQWNhZGVtaWNTdWJqZWN0LkdFT0dSQVBIWV06ICdHZW9ncmFmw61hJyxcbiAgICAgIFtBY2FkZW1pY1N1YmplY3QuR0VORVJBTF06ICdHZW5lcmFsJ1xuICAgIH1cbiAgICByZXR1cm4gbmFtZXNbc3ViamVjdF1cbiAgfVxuXG4gIC8qKlxuICAgKiBSZXNwdWVzdGEgZGUgZmFsbGJhY2sgcGFyYSBwcmVndW50YXMgZWR1Y2F0aXZhc1xuICAgKi9cbiAgcHJpdmF0ZSBzdGF0aWMgZ2V0RmFsbGJhY2tFZHVjYXRpb25hbFJlc3BvbnNlKHF1ZXN0aW9uOiBzdHJpbmcsIHN1YmplY3Q/OiBBY2FkZW1pY1N1YmplY3QpOiBzdHJpbmcge1xuICAgIHJldHVybiBgRXNhIGVzIHVuYSBleGNlbGVudGUgcHJlZ3VudGEgc29icmUgJHtzdWJqZWN0ID8gdGhpcy5nZXRTdWJqZWN0TmFtZShzdWJqZWN0KSA6ICdlbCB0ZW1hJ30uXFxuXFxuYCArXG4gICAgICBgVGUgYXl1ZG8gYSBwZW5zYXIgc29icmUgZXN0byBwYXNvIGEgcGFzbzpcXG5cXG5gICtcbiAgICAgIGAxLiAqKklkZW50aWZpY2EgbG9zIGNvbmNlcHRvcyBjbGF2ZSoqIGVuIHR1IHByZWd1bnRhXFxuYCArXG4gICAgICBgMi4gKipQaWVuc2EgZW4gZWplbXBsb3MgY29uY3JldG9zKiogcXVlIGNvbm96Y2FzXFxuYCArXG4gICAgICBgMy4gKipDb25lY3RhIGNvbiBsbyBxdWUgeWEgc2FiZXMqKiBkZSB0ZW1hcyBhbnRlcmlvcmVzXFxuXFxuYCArXG4gICAgICBgwr9UZSBndXN0YXLDrWEgcXVlIHRlIGF5dWRlIGNvbiBlamVyY2ljaW9zIHByw6FjdGljb3Mgc29icmUgZXN0ZSB0ZW1hP2BcbiAgfVxuXG4gIC8qKlxuICAgKiBNYW5lamEgY29tYW5kb3MgYWRtaW5pc3RyYXRpdm9zIGRlbCBjYWxlbmRhcmlvIChlZGl0YXIsIGVsaW1pbmFyLCBsaXN0YXIpXG4gICAqL1xuICBwcml2YXRlIHN0YXRpYyBhc3luYyBoYW5kbGVDYWxlbmRhckFkbWluQ29tbWFuZHMoXG4gICAgdXNlcklkOiBzdHJpbmcsIFxuICAgIG1lc3NhZ2U6IHN0cmluZ1xuICApOiBQcm9taXNlPENoYXRNZXNzYWdlIHwgbnVsbD4ge1xuICAgIGNvbnN0IG1zZ0xvd2VyID0gbWVzc2FnZS50b0xvd2VyQ2FzZSgpXG4gICAgXG4gICAgLy8gQ29tYW5kbzogTGlzdGFyIGV2ZW50b3NcbiAgICBpZiAoLyg/Om11ZXN0cmF8bGlzdGF8dmVyKS4qKD86ZXZlbnRvcz98Y2FsZW5kYXJpbykvaS50ZXN0KG1lc3NhZ2UpIHx8XG4gICAgICAgIC8oPzpldmVudG9zP3xjYWxlbmRhcmlvKS4qKD86ZGVcXHMrKT8oPzplc3RhXFxzK3NlbWFuYXxob3l8bWHDsWFuYSkvaS50ZXN0KG1lc3NhZ2UpKSB7XG4gICAgICBcbiAgICAgIGNvbnN0IGV2ZW50cyA9IGZpbmRVc2VyRXZlbnRzKHVzZXJJZCwgJycpXG4gICAgICBjb25zdCB0b2RheSA9IG5ldyBEYXRlKClcbiAgICAgIGNvbnN0IG9uZVdlZWsgPSBuZXcgRGF0ZSh0b2RheS5nZXRUaW1lKCkgKyA3ICogMjQgKiA2MCAqIDYwICogMTAwMClcbiAgICAgIFxuICAgICAgY29uc3QgdXBjb21pbmdFdmVudHMgPSBldmVudHMuZmlsdGVyKGV2ZW50ID0+IHtcbiAgICAgICAgY29uc3QgZXZlbnREYXRlID0gbmV3IERhdGUoZXZlbnQuZGF0ZSlcbiAgICAgICAgcmV0dXJuIGV2ZW50RGF0ZSA+PSB0b2RheSAmJiBldmVudERhdGUgPD0gb25lV2Vla1xuICAgICAgfSlcbiAgICAgIFxuICAgICAgaWYgKHVwY29taW5nRXZlbnRzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIGlkOiBgYWlfJHtEYXRlLm5vdygpfWAsXG4gICAgICAgICAgdHlwZTogJ2FpJyxcbiAgICAgICAgICBjb250ZW50OiBg8J+ThSBObyB0aWVuZXMgZXZlbnRvcyBwcm9ncmFtYWRvcyBwYXJhIGVzdGEgc2VtYW5hLlxcblxcbsK/VGUgZ3VzdGFyw61hIHF1ZSB0ZSBheXVkZSBhIGFnZW5kYXIgYWxndW5vP2AsXG4gICAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLFxuICAgICAgICAgIG1ldGFkYXRhOiB7XG4gICAgICAgICAgICBzdWdnZXN0ZWRBY3Rpb25zOiBbJ0FnZW5kYXIgZXhhbWVuJywgJ0FnZW5kYXIgc2VzacOzbiBkZSBlc3R1ZGlvJywgJ1ZlciBjYWxlbmRhcmlvIGNvbXBsZXRvJ11cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIFxuICAgICAgY29uc3QgZXZlbnRMaXN0ID0gdXBjb21pbmdFdmVudHMubWFwKGV2ZW50ID0+IHtcbiAgICAgICAgY29uc3QgZGF0ZVN0ciA9IGV2ZW50LmRhdGUudG9Mb2NhbGVEYXRlU3RyaW5nKCdlcy1FUycsIHsgXG4gICAgICAgICAgd2Vla2RheTogJ3Nob3J0JywgXG4gICAgICAgICAgZGF5OiAnbnVtZXJpYycsIFxuICAgICAgICAgIG1vbnRoOiAnc2hvcnQnIFxuICAgICAgICB9KVxuICAgICAgICByZXR1cm4gYOKAoiAqKiR7ZXZlbnQudGl0bGV9KiogLSAke2RhdGVTdHJ9IGEgbGFzICR7ZXZlbnQuc3RhcnRUaW1lfSR7ZXZlbnQubG9jYXRpb24gPyBgICgke2V2ZW50LmxvY2F0aW9ufSlgIDogJyd9YFxuICAgICAgfSkuam9pbignXFxuJylcbiAgICAgIFxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgaWQ6IGBhaV8ke0RhdGUubm93KCl9YCxcbiAgICAgICAgdHlwZTogJ2FpJyxcbiAgICAgICAgY29udGVudDogYPCfk4UgKipUdXMgcHLDs3hpbW9zIGV2ZW50b3M6KipcXG5cXG4ke2V2ZW50TGlzdH1cXG5cXG7Cv05lY2VzaXRhcyBlZGl0YXIgbyBlbGltaW5hciBhbGd1bm8/YCxcbiAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLFxuICAgICAgICBtZXRhZGF0YToge1xuICAgICAgICAgIHN1Z2dlc3RlZEFjdGlvbnM6IFsnRWRpdGFyIGV2ZW50bycsICdFbGltaW5hciBldmVudG8nLCAnQWdlbmRhciBudWV2byBldmVudG8nXVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIFxuICAgIC8vIENvbWFuZG86IEVsaW1pbmFyIGV2ZW50b1xuICAgIGlmICgvKD86ZWxpbWluW2FlXXxib3JyW2FlXXxxdWl0W2FlXXxjYW5jZWxbYWVdKS9pLnRlc3QobWVzc2FnZSkpIHtcbiAgICAgIGNvbnN0IHNlYXJjaFRlcm1zID0gbWVzc2FnZS5tYXRjaCgvKD86ZXhhbWVufGV2ZW50b3xzZXNpw7NuKS4qPyg/OmRlXFxzKyk/KFthLXrDocOpw63Ds8O6w7FdKykvaSlcbiAgICAgIFxuICAgICAgaWYgKHNlYXJjaFRlcm1zKSB7XG4gICAgICAgIGNvbnN0IHNlYXJjaFRlcm0gPSBzZWFyY2hUZXJtc1sxXSB8fCBzZWFyY2hUZXJtc1swXVxuICAgICAgICBjb25zdCBmb3VuZEV2ZW50cyA9IGZpbmRVc2VyRXZlbnRzKHVzZXJJZCwgc2VhcmNoVGVybSlcbiAgICAgICAgXG4gICAgICAgIGlmIChmb3VuZEV2ZW50cy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgaWQ6IGBhaV8ke0RhdGUubm93KCl9YCxcbiAgICAgICAgICAgIHR5cGU6ICdhaScsXG4gICAgICAgICAgICBjb250ZW50OiBg4p2MIE5vIGVuY29udHLDqSBldmVudG9zIHJlbGFjaW9uYWRvcyBjb24gXCIke3NlYXJjaFRlcm19XCIuXFxuXFxuwr9Qb2Ryw61hcyBzZXIgbcOhcyBlc3BlY8OtZmljbyBzb2JyZSBxdcOpIGV2ZW50byBxdWllcmVzIGVsaW1pbmFyP2AsXG4gICAgICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCksXG4gICAgICAgICAgICBtZXRhZGF0YToge1xuICAgICAgICAgICAgICBzdWdnZXN0ZWRBY3Rpb25zOiBbJ1ZlciB0b2RvcyBtaXMgZXZlbnRvcycsICdTZXIgbcOhcyBlc3BlY8OtZmljbyddXG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICBpZiAoZm91bmRFdmVudHMubGVuZ3RoID09PSAxKSB7XG4gICAgICAgICAgY29uc3QgZXZlbnQgPSBmb3VuZEV2ZW50c1swXVxuICAgICAgICAgIGNvbnN0IGRlbGV0ZVJlc3VsdCA9IGF3YWl0IGRlbGV0ZUV2ZW50RnJvbUFJKGV2ZW50LmlkKVxuICAgICAgICAgIFxuICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBpZDogYGFpXyR7RGF0ZS5ub3coKX1gLFxuICAgICAgICAgICAgdHlwZTogJ2FpJyxcbiAgICAgICAgICAgIGNvbnRlbnQ6IGRlbGV0ZVJlc3VsdC5zdWNjZXNzIFxuICAgICAgICAgICAgICA/IGDinIUgJHtkZWxldGVSZXN1bHQubWVzc2FnZX1gXG4gICAgICAgICAgICAgIDogYOKdjCAke2RlbGV0ZVJlc3VsdC5tZXNzYWdlfWAsXG4gICAgICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCksXG4gICAgICAgICAgICBtZXRhZGF0YToge1xuICAgICAgICAgICAgICBzdWdnZXN0ZWRBY3Rpb25zOiBkZWxldGVSZXN1bHQuc3VjY2VzcyBcbiAgICAgICAgICAgICAgICA/IFsnVmVyIGNhbGVuZGFyaW8nLCAnQWdlbmRhciBudWV2byBldmVudG8nXVxuICAgICAgICAgICAgICAgIDogWydSZWludGVudGFyJywgJ1ZlciBldmVudG9zJ11cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgY29uc3QgZXZlbnRMaXN0ID0gZm91bmRFdmVudHMuc2xpY2UoMCwgMykubWFwKGUgPT4gYOKAoiAke2UudGl0bGV9YCkuam9pbignXFxuJylcbiAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgaWQ6IGBhaV8ke0RhdGUubm93KCl9YCxcbiAgICAgICAgICAgIHR5cGU6ICdhaScsXG4gICAgICAgICAgICBjb250ZW50OiBg8J+UjSBFbmNvbnRyw6kgdmFyaW9zIGV2ZW50b3MgcmVsYWNpb25hZG9zOlxcblxcbiR7ZXZlbnRMaXN0fVxcblxcbsK/Q3XDoWwgcXVpZXJlcyBlbGltaW5hciBlc3BlY8OtZmljYW1lbnRlP2AsXG4gICAgICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCksXG4gICAgICAgICAgICBtZXRhZGF0YToge1xuICAgICAgICAgICAgICBzdWdnZXN0ZWRBY3Rpb25zOiBmb3VuZEV2ZW50cy5zbGljZSgwLCAzKS5tYXAoZSA9PiBgRWxpbWluYXI6ICR7ZS50aXRsZX1gKVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICBcbiAgICByZXR1cm4gbnVsbFxuICB9XG5cbn0iXSwibmFtZXMiOlsiQWNhZGVtaWNBbmFseXplciIsIkFjYWRlbWljU3ViamVjdCIsImFpU2VydmljZSIsIkV4ZXJjaXNlU29sdmVyIiwiQUlDYWxlbmRhckludGVncmF0aW9uIiwiZmluZFVzZXJFdmVudHMiLCJkZWxldGVFdmVudEZyb21BSSIsIk5vdGlmaWNhdGlvblNlcnZpY2UiLCJOb3RpZmljYXRpb25UcmlnZ2VyIiwiQWNhZGVtaWNTZWFyY2hFbmdpbmUiLCJDb252ZXJzYXRpb25FbmdpbmUiLCJwcm9jZXNzVXNlck1lc3NhZ2UiLCJ1c2VySWQiLCJtZXNzYWdlIiwidXNlck5hbWUiLCJjb252ZXJzYXRpb25IaXN0b3J5IiwiQ29udGV4dHVhbENvbnZlcnNhdGlvbk1hbmFnZXIiLCJyZXF1aXJlIiwiY29udGV4dHVhbFJlc3BvbnNlIiwicHJvY2Vzc0NvbnRleHR1YWxNZXNzYWdlIiwidW5kZWZpbmVkIiwiaWQiLCJEYXRlIiwibm93IiwidHlwZSIsImNvbnRlbnQiLCJ0aW1lc3RhbXAiLCJtZXRhZGF0YSIsInN1YmplY3QiLCJjb250ZXh0IiwiY3VycmVudFN1YmplY3QiLCJzdWdnZXN0ZWRBY3Rpb25zIiwic3VnZ2VzdGVkRm9sbG93dXBzIiwiY29uY2F0IiwidmlzdWFsUmVjb21tZW5kYXRpb24iLCJlcnJvciIsImNvbnNvbGUiLCJsb2ciLCJhY2FkZW1pY0FuYWx5c2lzIiwiYW5hbHl6ZVN0dWRlbnQiLCJjYWxlbmRhckFkbWluUmVzdWx0IiwiaGFuZGxlQ2FsZW5kYXJBZG1pbkNvbW1hbmRzIiwiY2FsZW5kYXJJbnRlZ3JhdGlvbiIsImNvbnZlcnNhdGlvbkZvckNhbGVuZGFyIiwiY2FsZW5kYXJSZXN1bHQiLCJwcm9jZXNzTWVzc2FnZSIsIm5lZWRzRXZlbnRDcmVhdGlvbiIsInJlc3BvbnNlIiwiZXZlbnQiLCJpbnRlbnQiLCJhbmFseXplVXNlckludGVudCIsImFpUmVzcG9uc2UiLCJoYW5kbGVFeGVyY2lzZVNvbHV0aW9uIiwiaGFuZGxlQXNzZXNzbWVudFJlcXVlc3QiLCJoYW5kbGVFZHVjYXRpb25hbFF1ZXN0aW9uIiwiaGFuZGxlQWNhZGVtaWNTZWFyY2giLCJ0b3BpYyIsImhhbmRsZUhlbHBSZXF1ZXN0IiwiaGFuZGxlQ2FzdWFsQ2hhdCIsImhhbmRsZUdlbmVyYWxSZXNwb25zZSIsIkVycm9yIiwicHJvY2Vzc1VzZXJNZXNzYWdlTGVnYWN5IiwibXNnTG93ZXIiLCJ0b0xvd2VyQ2FzZSIsImV4ZXJjaXNlRGV0ZWN0aW9uIiwiZGV0ZWN0RXhlcmNpc2UiLCJoYXNFeGVyY2lzZSIsImNvbmZpZGVuY2UiLCJzdWJqZWN0TWFwIiwiUEhZU0lDUyIsIkNIRU1JU1RSWSIsIk1BVEhFTUFUSUNTIiwiR0VORVJBTCIsImluY2x1ZGVzIiwiZGV0ZWN0U3ViamVjdCIsImV4dHJhY3RUb3BpYyIsIndvcmRzIiwic3BsaXQiLCJ0b3BpY3MiLCJmb3VuZFRvcGljIiwiZmluZCIsInNvbHZlclN1YmplY3QiLCJzdHVkZW50Q29udGV4dCIsImdldEV4ZXJjaXNlQ29udGV4dCIsInNvbHV0aW9uIiwic29sdmVFeGVyY2lzZSIsImdldFN1YmplY3ROYW1lIiwic3ViamVjdEFuYWx5c2lzIiwic3ViamVjdHMiLCJzIiwicGVyZm9ybWFuY2UiLCJuZWVkc0F0dGVudGlvbiIsInNwZWNpZmljQ2hhbGxlbmdlcyIsImpvaW4iLCJxdWVzdGlvbiIsImFuYWx5c2lzQ29udGV4dCIsInByb21wdCIsImdlbmVyYXRlRXhlcmNpc2UiLCJnZXRGYWxsYmFja0VkdWNhdGlvbmFsUmVzcG9uc2UiLCJzdHJ1Z2dsaW5nQXJlYXMiLCJzb21lIiwiYXJlYSIsInNlYXJjaFJlc3VsdCIsInNtYXJ0U2VhcmNoIiwibm90aWZpY2F0aW9uIiwiY3JlYXRlQWNhZGVtaWNOb3RpZmljYXRpb24iLCJxdWVyeSIsIktOT1dMRURHRV9HQVAiLCJ0b3RhbFJlc3VsdHMiLCJ0b3BSZXN1bHRzIiwicmVzdWx0cyIsInNsaWNlIiwiZm9yRWFjaCIsInJlc3VsdCIsImluZGV4IiwidGl0bGUiLCJzdW1tYXJ5IiwicmVsZXZhbmNlU2NvcmUiLCJ0b0ZpeGVkIiwiZGlmZmljdWx0eSIsImVzdGltYXRlZFJlYWRUaW1lIiwicGVyc29uYWxpemVkUmVjb21tZW5kYXRpb25zIiwibGVuZ3RoIiwicmVjIiwiZm9sbG93VXBRdWVzdGlvbnMiLCJzZWFyY2hSZXN1bHRzIiwiY3JlYXRlV2VsY29tZU1lc3NhZ2UiLCJhbmFseXNpcyIsInN0cm9uZ1N1YmplY3RzIiwiZmlsdGVyIiwic3RydWdnbGluZ1N1YmplY3RzIiwibWFwIiwic3ViamVjdE5hbWUiLCJhY3Rpb25zIiwicHVzaCIsIm5hbWVzIiwiQklPTE9HWSIsIlNQQU5JU0giLCJFTkdMSVNIIiwiSElTVE9SWSIsIkdFT0dSQVBIWSIsInRlc3QiLCJldmVudHMiLCJ0b2RheSIsIm9uZVdlZWsiLCJnZXRUaW1lIiwidXBjb21pbmdFdmVudHMiLCJldmVudERhdGUiLCJkYXRlIiwiZXZlbnRMaXN0IiwiZGF0ZVN0ciIsInRvTG9jYWxlRGF0ZVN0cmluZyIsIndlZWtkYXkiLCJkYXkiLCJtb250aCIsInN0YXJ0VGltZSIsImxvY2F0aW9uIiwic2VhcmNoVGVybXMiLCJtYXRjaCIsInNlYXJjaFRlcm0iLCJmb3VuZEV2ZW50cyIsImRlbGV0ZVJlc3VsdCIsInN1Y2Nlc3MiLCJlIl0sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/conversation-engine.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/conversation-memory.ts":
/*!****************************************!*\
  !*** ./src/lib/conversation-memory.ts ***!
  \****************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   ConversationMemoryManager: () => (/* binding */ ConversationMemoryManager)\n/* harmony export */ });\n/* harmony import */ var _emotion_analyzer__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./emotion-analyzer */ \"(rsc)/./src/lib/emotion-analyzer.ts\");\n// Sistema de Memoria Conversacional para Sara\n// Permite recordar conversaciones, preferencias y contexto del estudiante\n\nclass ConversationMemoryManager {\n    static{\n        this.memories = new Map();\n    }\n    /**\n   * Obtiene o crea la memoria conversacional para un usuario\n   */ static getMemory(userId, sessionId) {\n        const memoryKey = `${userId}_${sessionId || 'default'}`;\n        if (!this.memories.has(memoryKey)) {\n            this.memories.set(memoryKey, this.createNewMemory(userId, sessionId));\n        }\n        return this.memories.get(memoryKey);\n    }\n    /**\n   * Guarda un nuevo intercambio conversacional\n   */ static saveConversationTurn(userId, userMessage, saraResponse, mode, intent, sessionId) {\n        const memory = this.getMemory(userId, sessionId);\n        const turn = {\n            id: `turn_${Date.now()}_${Math.random().toString(36).substr(2, 8)}`,\n            timestamp: new Date(),\n            userMessage,\n            saraResponse,\n            mode,\n            intent,\n            topics: this.extractTopics(userMessage),\n            emotions: this.detectEmotions(userMessage, {\n                subject: this.extractSubjectFromMessage(userMessage),\n                previousEmotion: memory.emotionalProfile?.currentMood\n            }),\n            context: this.analyzeContext(userMessage, saraResponse)\n        };\n        // Agregar al historial\n        memory.conversationHistory.push(turn);\n        memory.totalTurns++;\n        memory.lastActivity = new Date();\n        // Mantener solo los últimos 50 intercambios para eficiencia\n        if (memory.conversationHistory.length > 50) {\n            memory.conversationHistory = memory.conversationHistory.slice(-50);\n        }\n        // Actualizar perfiles basándose en la nueva conversación\n        this.updatePreferences(memory, turn);\n        this.updateEmotionalProfile(memory, turn);\n        this.updateRecurringTopics(memory, turn);\n        this.updateProgressTracking(memory, turn);\n        return turn;\n    }\n    /**\n   * Genera un resumen contextual para Sara basado en la memoria\n   */ static generateContextualSummary(userId, sessionId) {\n        const memory = this.getMemory(userId, sessionId);\n        if (memory.conversationHistory.length === 0) {\n            return \"Esta es nuestra primera conversación. Estoy aquí para conocerte y ayudarte con tus objetivos académicos.\";\n        }\n        const recentTurns = memory.conversationHistory.slice(-5);\n        const summary = [];\n        // Información sobre sesión actual\n        const daysSinceLastChat = Math.floor((Date.now() - memory.lastActivity.getTime()) / (1000 * 60 * 60 * 24));\n        if (daysSinceLastChat > 7) {\n            summary.push(`Han pasado ${daysSinceLastChat} días desde nuestra última conversación.`);\n        } else if (daysSinceLastChat > 1) {\n            summary.push(`Nos vimos hace ${daysSinceLastChat} días.`);\n        }\n        // Temas recurrentes importantes\n        const importantTopics = memory.recurringTopics.filter((t)=>t.frequency > 2 && !t.resolved).slice(0, 3);\n        if (importantTopics.length > 0) {\n            summary.push(`Hemos estado trabajando en: ${importantTopics.map((t)=>t.topic).join(', ')}.`);\n        }\n        // Estado emocional\n        if (memory.emotionalProfile.motivationLevel < 5) {\n            summary.push(\"He notado que podrías necesitar un poco más de motivación.\");\n        } else if (memory.emotionalProfile.motivationLevel > 8) {\n            summary.push(\"Me alegra ver tu motivación y energía positiva.\");\n        }\n        // Seguimientos pendientes\n        const pendingFollowUps = memory.progressTracking.pendingFollowUps.filter((f)=>f.dueDate <= new Date());\n        if (pendingFollowUps.length > 0) {\n            summary.push(`Tenemos ${pendingFollowUps.length} seguimiento(s) pendiente(s).`);\n        }\n        // Preferencias del estudiante\n        if (memory.preferences.difficultSubjects.length > 0) {\n            summary.push(`Sé que ${memory.preferences.difficultSubjects[0]} te presenta algunos desafíos.`);\n        }\n        return summary.length > 0 ? summary.join(' ') : \"Continuemos donde lo dejamos la última vez.\";\n    }\n    /**\n   * Obtiene sugerencias personalizadas basadas en la memoria\n   */ static getPersonalizedSuggestions(userId, sessionId) {\n        const memory = this.getMemory(userId, sessionId);\n        const suggestions = [];\n        // Basado en temas recurrentes sin resolver\n        const unresolvedTopics = memory.recurringTopics.filter((t)=>!t.resolved);\n        unresolvedTopics.slice(0, 2).forEach((topic)=>{\n            suggestions.push(`Retomar el trabajo en ${topic.topic}`);\n        });\n        // Basado en seguimientos pendientes\n        memory.progressTracking.pendingFollowUps.slice(0, 2).forEach((followUp)=>{\n            suggestions.push(`Revisar progreso: ${followUp.task}`);\n        });\n        // Basado en materias difíciles\n        if (memory.preferences.difficultSubjects.length > 0) {\n            suggestions.push(`Planificar sesión de estudio para ${memory.preferences.difficultSubjects[0]}`);\n        }\n        // Basado en estado emocional\n        if (memory.emotionalProfile.motivationLevel < 5) {\n            suggestions.push(\"Trabajar en motivación y objetivos pequeños\");\n        }\n        // Basado en preferencias de modo\n        if (memory.preferences.preferredMode) {\n            suggestions.push(`Continuar en modo ${memory.preferences.preferredMode}`);\n        }\n        return suggestions.slice(0, 4) // Máximo 4 sugerencias\n        ;\n    }\n    /**\n   * Detecta si el usuario necesita seguimiento en temas específicos\n   */ static needsFollowUp(userId, sessionId) {\n        const memory = this.getMemory(userId, sessionId);\n        // Verificar seguimientos vencidos\n        const overdueFollowUps = memory.progressTracking.pendingFollowUps.filter((f)=>f.dueDate < new Date());\n        // Verificar temas sin resolver por mucho tiempo\n        const staleTops = memory.recurringTopics.filter((t)=>!t.resolved && Date.now() - t.lastMentioned.getTime() > 7 * 24 * 60 * 60 * 1000);\n        // Verificar bajo nivel de motivación\n        const lowMotivation = memory.emotionalProfile.motivationLevel < 4;\n        return overdueFollowUps.length > 0 || staleTops.length > 0 || lowMotivation;\n    }\n    // Métodos auxiliares privados\n    static createNewMemory(userId, sessionId) {\n        return {\n            userId,\n            sessionId: sessionId || 'default',\n            startedAt: new Date(),\n            lastActivity: new Date(),\n            totalTurns: 0,\n            conversationHistory: [],\n            preferences: {\n                preferredMode: 'chatting',\n                favoriteSubjects: [],\n                difficultSubjects: [],\n                studyTimePreference: 'evening',\n                communicationStyle: 'casual'\n            },\n            emotionalProfile: {\n                currentMood: _emotion_analyzer__WEBPACK_IMPORTED_MODULE_0__.EmotionType.NEUTRAL,\n                motivationLevel: 7,\n                recentEmotions: [],\n                emotionalTrends: {\n                    dominant: _emotion_analyzer__WEBPACK_IMPORTED_MODULE_0__.EmotionType.NEUTRAL,\n                    frequency: 0,\n                    lastWeek: []\n                },\n                frustrationAreas: [],\n                achievementAreas: [],\n                lastEncouragement: new Date(),\n                emotionalInsights: []\n            },\n            recurringTopics: [],\n            progressTracking: {\n                goalsDiscussed: [],\n                plansMade: [],\n                completedTasks: [],\n                pendingFollowUps: []\n            }\n        };\n    }\n    static extractTopics(message) {\n        const topics = [];\n        const lowerMessage = message.toLowerCase();\n        // Lista de temas académicos comunes\n        const academicTopics = [\n            'matemáticas',\n            'física',\n            'química',\n            'biología',\n            'historia',\n            'literatura',\n            'inglés',\n            'programación',\n            'cálculo',\n            'álgebra',\n            'geometría',\n            'estadística',\n            'examen',\n            'tarea',\n            'proyecto',\n            'presentación',\n            'ensayo',\n            'estudio',\n            'horario',\n            'planificación',\n            'calendario',\n            'tiempo',\n            'organización'\n        ];\n        academicTopics.forEach((topic)=>{\n            if (lowerMessage.includes(topic)) {\n                topics.push(topic);\n            }\n        });\n        return topics;\n    }\n    static extractSubjectFromMessage(message) {\n        const lowerMessage = message.toLowerCase();\n        const subjects = [\n            'matemáticas',\n            'física',\n            'química',\n            'biología',\n            'historia',\n            'literatura',\n            'inglés',\n            'programación'\n        ];\n        return subjects.find((subject)=>lowerMessage.includes(subject));\n    }\n    static detectEmotions(message, context) {\n        return _emotion_analyzer__WEBPACK_IMPORTED_MODULE_0__.EmotionAnalyzer.analyzeEmotions(message, context);\n    }\n    static analyzeContext(userMessage, saraResponse) {\n        const lowerMessage = userMessage.toLowerCase();\n        const context = {};\n        // Detectar materias\n        const subjects = [\n            'matemáticas',\n            'física',\n            'química',\n            'biología',\n            'historia',\n            'literatura',\n            'inglés'\n        ];\n        const detectedSubject = subjects.find((subject)=>lowerMessage.includes(subject));\n        if (detectedSubject) {\n            context.subject = detectedSubject;\n        }\n        // Detectar dificultad\n        if (lowerMessage.includes('fácil') || lowerMessage.includes('simple')) {\n            context.difficulty = 'easy';\n        } else if (lowerMessage.includes('difícil') || lowerMessage.includes('complejo')) {\n            context.difficulty = 'hard';\n        } else {\n            context.difficulty = 'medium';\n        }\n        // Detectar logros\n        if (lowerMessage.includes('logré') || lowerMessage.includes('terminé') || lowerMessage.includes('completé')) {\n            context.achievement = true;\n        }\n        // Detectar necesidad de seguimiento\n        if (lowerMessage.includes('planificar') || lowerMessage.includes('revisar') || lowerMessage.includes('próxima vez')) {\n            context.needsFollowUp = true;\n        }\n        return context;\n    }\n    static updatePreferences(memory, turn) {\n        // Actualizar modo preferido\n        memory.preferences.preferredMode = turn.mode;\n        // Actualizar materias favoritas/difíciles basándose en emociones\n        if (turn.context?.subject) {\n            if (turn.emotions?.detected === 'positive' || turn.emotions?.detected === 'motivated') {\n                if (!memory.preferences.favoriteSubjects.includes(turn.context.subject)) {\n                    memory.preferences.favoriteSubjects.push(turn.context.subject);\n                }\n            } else if (turn.emotions?.detected === 'frustrated' || turn.emotions?.detected === 'negative') {\n                if (!memory.preferences.difficultSubjects.includes(turn.context.subject)) {\n                    memory.preferences.difficultSubjects.push(turn.context.subject);\n                }\n            }\n        }\n    }\n    static updateEmotionalProfile(memory, turn) {\n        if (turn.emotions) {\n            const emotion = turn.emotions.primary;\n            // Actualizar humor actual\n            memory.emotionalProfile.currentMood = emotion;\n            // Agregar a emociones recientes (mantener últimas 5)\n            memory.emotionalProfile.recentEmotions.unshift(emotion);\n            if (memory.emotionalProfile.recentEmotions.length > 5) {\n                memory.emotionalProfile.recentEmotions = memory.emotionalProfile.recentEmotions.slice(0, 5);\n            }\n            // Actualizar tendencias emocionales semanales\n            memory.emotionalProfile.emotionalTrends.lastWeek.unshift(emotion);\n            if (memory.emotionalProfile.emotionalTrends.lastWeek.length > 20) {\n                memory.emotionalProfile.emotionalTrends.lastWeek = memory.emotionalProfile.emotionalTrends.lastWeek.slice(0, 20);\n            }\n            // Calcular emoción dominante\n            const emotionCounts = memory.emotionalProfile.emotionalTrends.lastWeek.reduce((acc, em)=>{\n                acc[em] = (acc[em] || 0) + 1;\n                return acc;\n            }, {});\n            const dominantEmotion = Object.entries(emotionCounts).sort(([, a], [, b])=>b - a)[0]?.[0];\n            if (dominantEmotion) {\n                memory.emotionalProfile.emotionalTrends.dominant = dominantEmotion;\n                memory.emotionalProfile.emotionalTrends.frequency = emotionCounts[dominantEmotion];\n            }\n            // Ajustar nivel de motivación basado en emociones\n            const motivationAdjustment = this.getMotivationAdjustment(emotion, turn.emotions.intensity);\n            memory.emotionalProfile.motivationLevel = Math.max(1, Math.min(10, memory.emotionalProfile.motivationLevel + motivationAdjustment));\n            // Actualizar áreas de frustración/logro\n            if (turn.context?.subject) {\n                if ([\n                    _emotion_analyzer__WEBPACK_IMPORTED_MODULE_0__.EmotionType.FRUSTRATED,\n                    _emotion_analyzer__WEBPACK_IMPORTED_MODULE_0__.EmotionType.OVERWHELMED,\n                    _emotion_analyzer__WEBPACK_IMPORTED_MODULE_0__.EmotionType.STRESSED\n                ].includes(emotion)) {\n                    if (!memory.emotionalProfile.frustrationAreas.includes(turn.context.subject)) {\n                        memory.emotionalProfile.frustrationAreas.push(turn.context.subject);\n                    }\n                }\n                if ([\n                    _emotion_analyzer__WEBPACK_IMPORTED_MODULE_0__.EmotionType.PROUD,\n                    _emotion_analyzer__WEBPACK_IMPORTED_MODULE_0__.EmotionType.CONFIDENT,\n                    _emotion_analyzer__WEBPACK_IMPORTED_MODULE_0__.EmotionType.EXCITED\n                ].includes(emotion) || turn.context?.achievement) {\n                    if (!memory.emotionalProfile.achievementAreas.includes(turn.context.subject)) {\n                        memory.emotionalProfile.achievementAreas.push(turn.context.subject);\n                    }\n                }\n            }\n            // Generar insights emocionales\n            const insight = this.generateEmotionalInsight(emotion, turn.emotions, turn.context?.subject);\n            if (insight) {\n                memory.emotionalProfile.emotionalInsights.unshift(insight);\n                if (memory.emotionalProfile.emotionalInsights.length > 10) {\n                    memory.emotionalProfile.emotionalInsights = memory.emotionalProfile.emotionalInsights.slice(0, 10);\n                }\n            }\n        }\n    }\n    /**\n   * Calcula el ajuste de motivación basado en la emoción\n   */ static getMotivationAdjustment(emotion, intensity) {\n        const baseAdjustments = {\n            [_emotion_analyzer__WEBPACK_IMPORTED_MODULE_0__.EmotionType.MOTIVATED]: 2,\n            [_emotion_analyzer__WEBPACK_IMPORTED_MODULE_0__.EmotionType.EXCITED]: 2,\n            [_emotion_analyzer__WEBPACK_IMPORTED_MODULE_0__.EmotionType.PROUD]: 1.5,\n            [_emotion_analyzer__WEBPACK_IMPORTED_MODULE_0__.EmotionType.CONFIDENT]: 1.5,\n            [_emotion_analyzer__WEBPACK_IMPORTED_MODULE_0__.EmotionType.HOPEFUL]: 1,\n            [_emotion_analyzer__WEBPACK_IMPORTED_MODULE_0__.EmotionType.HAPPY]: 1,\n            [_emotion_analyzer__WEBPACK_IMPORTED_MODULE_0__.EmotionType.GRATEFUL]: 0.5,\n            [_emotion_analyzer__WEBPACK_IMPORTED_MODULE_0__.EmotionType.RELIEVED]: 0.5,\n            [_emotion_analyzer__WEBPACK_IMPORTED_MODULE_0__.EmotionType.CURIOUS]: 0.5,\n            [_emotion_analyzer__WEBPACK_IMPORTED_MODULE_0__.EmotionType.NEUTRAL]: 0,\n            [_emotion_analyzer__WEBPACK_IMPORTED_MODULE_0__.EmotionType.CONFUSED]: -0.5,\n            [_emotion_analyzer__WEBPACK_IMPORTED_MODULE_0__.EmotionType.BORED]: -1,\n            [_emotion_analyzer__WEBPACK_IMPORTED_MODULE_0__.EmotionType.DISAPPOINTED]: -1,\n            [_emotion_analyzer__WEBPACK_IMPORTED_MODULE_0__.EmotionType.SAD]: -1,\n            [_emotion_analyzer__WEBPACK_IMPORTED_MODULE_0__.EmotionType.FRUSTRATED]: -1.5,\n            [_emotion_analyzer__WEBPACK_IMPORTED_MODULE_0__.EmotionType.OVERWHELMED]: -2,\n            [_emotion_analyzer__WEBPACK_IMPORTED_MODULE_0__.EmotionType.STRESSED]: -2,\n            [_emotion_analyzer__WEBPACK_IMPORTED_MODULE_0__.EmotionType.ANXIOUS]: -1.5,\n            [_emotion_analyzer__WEBPACK_IMPORTED_MODULE_0__.EmotionType.ANGRY]: -1,\n            [_emotion_analyzer__WEBPACK_IMPORTED_MODULE_0__.EmotionType.FEAR]: -1,\n            [_emotion_analyzer__WEBPACK_IMPORTED_MODULE_0__.EmotionType.SURPRISE]: 0\n        };\n        const baseAdjustment = baseAdjustments[emotion] || 0;\n        // Aplicar multiplicador de intensidad\n        const intensityMultiplier = intensity === 'high' ? 1.5 : intensity === 'medium' ? 1.2 : 0.8;\n        return baseAdjustment * intensityMultiplier;\n    }\n    /**\n   * Genera un insight emocional basado en la emoción detectada\n   */ static generateEmotionalInsight(emotion, analysis, subject) {\n        const timestamp = new Date().toLocaleDateString();\n        switch(emotion){\n            case _emotion_analyzer__WEBPACK_IMPORTED_MODULE_0__.EmotionType.FRUSTRATED:\n                return `${timestamp}: Frustración detectada${subject ? ` en ${subject}` : ''}. Considerar estrategias de apoyo adicional.`;\n            case _emotion_analyzer__WEBPACK_IMPORTED_MODULE_0__.EmotionType.OVERWHELMED:\n                return `${timestamp}: Estudiante se siente abrumado. Recomendar descansos y división de tareas.`;\n            case _emotion_analyzer__WEBPACK_IMPORTED_MODULE_0__.EmotionType.MOTIVATED:\n                return `${timestamp}: Alta motivación detectada${subject ? ` hacia ${subject}` : ''}. Momento ideal para objetivos ambiciosos.`;\n            case _emotion_analyzer__WEBPACK_IMPORTED_MODULE_0__.EmotionType.CONFUSED:\n                return `${timestamp}: Confusión identificada${subject ? ` en ${subject}` : ''}. Necesita explicaciones más claras.`;\n            case _emotion_analyzer__WEBPACK_IMPORTED_MODULE_0__.EmotionType.PROUD:\n                return `${timestamp}: Orgullo por logro${subject ? ` en ${subject}` : ''}. Reforzar autoconfianza.`;\n            case _emotion_analyzer__WEBPACK_IMPORTED_MODULE_0__.EmotionType.ANXIOUS:\n                return `${timestamp}: Ansiedad detectada. Implementar técnicas de relajación y apoyo.`;\n            default:\n                if (analysis.intensity === 'high') {\n                    return `${timestamp}: Emoción intensa (${emotion}) detectada. Monitorear estado emocional.`;\n                }\n                return null;\n        }\n    }\n    static updateRecurringTopics(memory, turn) {\n        turn.topics.forEach((topic)=>{\n            const existing = memory.recurringTopics.find((rt)=>rt.topic === topic);\n            if (existing) {\n                existing.frequency++;\n                existing.lastMentioned = new Date();\n                // Marcar como resuelto si hay indicadores de logro\n                if (turn.context?.achievement) {\n                    existing.resolved = true;\n                }\n            } else {\n                memory.recurringTopics.push({\n                    topic,\n                    frequency: 1,\n                    lastMentioned: new Date(),\n                    resolved: false\n                });\n            }\n        });\n    }\n    static updateProgressTracking(memory, turn) {\n        // Detectar objetivos/planes mencionados\n        const lowerMessage = turn.userMessage.toLowerCase();\n        if (lowerMessage.includes('objetivo') || lowerMessage.includes('meta')) {\n            memory.progressTracking.goalsDiscussed.push(turn.userMessage);\n        }\n        if (lowerMessage.includes('plan') || lowerMessage.includes('planificar')) {\n            memory.progressTracking.plansMade.push(turn.userMessage);\n        }\n        if (turn.context?.achievement) {\n            memory.progressTracking.completedTasks.push(turn.userMessage);\n        }\n        // Agregar seguimientos si es necesario\n        if (turn.context?.needsFollowUp) {\n            const followUpDate = new Date();\n            followUpDate.setDate(followUpDate.getDate() + 3) // Seguimiento en 3 días\n            ;\n            memory.progressTracking.pendingFollowUps.push({\n                task: turn.userMessage,\n                dueDate: followUpDate,\n                reminder: true\n            });\n        }\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QkFDQUgsV0FBVztvQkFDWHNCLGVBQWUsSUFBSTVEO29CQUNuQnVDLFVBQVU7Z0JBQ1o7WUFDRjtRQUNGO0lBQ0Y7SUFFQSxPQUFlWix1QkFBdUI5QixNQUEwQixFQUFFQyxJQUFzQixFQUFRO1FBQzlGLHdDQUF3QztRQUN4QyxNQUFNaUYsZUFBZWpGLEtBQUtMLFdBQVcsQ0FBQ3VGLFdBQVc7UUFFakQsSUFBSUQsYUFBYUcsUUFBUSxDQUFDLGVBQWVILGFBQWFHLFFBQVEsQ0FBQyxTQUFTO1lBQ3RFckYsT0FBT2dELGdCQUFnQixDQUFDOEIsY0FBYyxDQUFDeEQsSUFBSSxDQUFDckIsS0FBS0wsV0FBVztRQUM5RDtRQUVBLElBQUlzRixhQUFhRyxRQUFRLENBQUMsV0FBV0gsYUFBYUcsUUFBUSxDQUFDLGVBQWU7WUFDeEVyRixPQUFPZ0QsZ0JBQWdCLENBQUMrQixTQUFTLENBQUN6RCxJQUFJLENBQUNyQixLQUFLTCxXQUFXO1FBQ3pEO1FBRUEsSUFBSUssS0FBS2tCLE9BQU8sRUFBRXdFLGFBQWE7WUFDN0IzRixPQUFPZ0QsZ0JBQWdCLENBQUNnQyxjQUFjLENBQUMxRCxJQUFJLENBQUNyQixLQUFLTCxXQUFXO1FBQzlEO1FBRUEsdUNBQXVDO1FBQ3ZDLElBQUlLLEtBQUtrQixPQUFPLEVBQUV5QyxlQUFlO1lBQy9CLE1BQU1nRixlQUFlLElBQUl6STtZQUN6QnlJLGFBQWFDLE9BQU8sQ0FBQ0QsYUFBYUUsT0FBTyxLQUFLLEdBQUcsd0JBQXdCOztZQUV6RTlJLE9BQU9nRCxnQkFBZ0IsQ0FBQ0QsZ0JBQWdCLENBQUN6QixJQUFJLENBQUM7Z0JBQzVDb0MsTUFBTXpELEtBQUtMLFdBQVc7Z0JBQ3RCc0QsU0FBUzBGO2dCQUNURyxVQUFVO1lBQ1o7UUFDRjtJQUNGO0FBQ0YiLCJzb3VyY2VzIjpbIi9Vc2Vycy9yb2RyaWdvZGliZXJuYXJkbzMzZ21haWwuY29tL0RvY3VtZW50cy9BcHAgRGV2ZWxvcG1lbnQgUHJveWVjdHMvSW50ZWxsZWdvIFBsYXRmb3JtL3NyYy9saWIvY29udmVyc2F0aW9uLW1lbW9yeS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBTaXN0ZW1hIGRlIE1lbW9yaWEgQ29udmVyc2FjaW9uYWwgcGFyYSBTYXJhXG4vLyBQZXJtaXRlIHJlY29yZGFyIGNvbnZlcnNhY2lvbmVzLCBwcmVmZXJlbmNpYXMgeSBjb250ZXh0byBkZWwgZXN0dWRpYW50ZVxuXG5pbXBvcnQgeyBFbW90aW9uQW5hbHl6ZXIsIEVtb3Rpb25UeXBlLCBFbW90aW9uQW5hbHlzaXMgfSBmcm9tICcuL2Vtb3Rpb24tYW5hbHl6ZXInXG5cbmV4cG9ydCBpbnRlcmZhY2UgQ29udmVyc2F0aW9uVHVybiB7XG4gIGlkOiBzdHJpbmdcbiAgdGltZXN0YW1wOiBEYXRlXG4gIHVzZXJNZXNzYWdlOiBzdHJpbmdcbiAgc2FyYVJlc3BvbnNlOiBzdHJpbmdcbiAgbW9kZTogc3RyaW5nXG4gIGludGVudD86IHN0cmluZ1xuICB0b3BpY3M6IHN0cmluZ1tdXG4gIGVtb3Rpb25zPzogRW1vdGlvbkFuYWx5c2lzXG4gIGNvbnRleHQ/OiB7XG4gICAgc3ViamVjdD86IHN0cmluZ1xuICAgIGRpZmZpY3VsdHk/OiAnZWFzeScgfCAnbWVkaXVtJyB8ICdoYXJkJ1xuICAgIGFjaGlldmVtZW50PzogYm9vbGVhblxuICAgIG5lZWRzRm9sbG93VXA/OiBib29sZWFuXG4gIH1cbn1cblxuZXhwb3J0IGludGVyZmFjZSBDb252ZXJzYXRpb25NZW1vcnkge1xuICB1c2VySWQ6IHN0cmluZ1xuICBzZXNzaW9uSWQ6IHN0cmluZ1xuICBzdGFydGVkQXQ6IERhdGVcbiAgbGFzdEFjdGl2aXR5OiBEYXRlXG4gIHRvdGFsVHVybnM6IG51bWJlclxuICBjb252ZXJzYXRpb25IaXN0b3J5OiBDb252ZXJzYXRpb25UdXJuW11cbiAgXG4gIC8vIEluZm9ybWFjacOzbiBleHRyYcOtZGEgZGVsIGNvbnRleHRvXG4gIHByZWZlcmVuY2VzOiB7XG4gICAgcHJlZmVycmVkTW9kZTogc3RyaW5nXG4gICAgZmF2b3JpdGVTdWJqZWN0czogc3RyaW5nW11cbiAgICBkaWZmaWN1bHRTdWJqZWN0czogc3RyaW5nW11cbiAgICBzdHVkeVRpbWVQcmVmZXJlbmNlOiBzdHJpbmdcbiAgICBjb21tdW5pY2F0aW9uU3R5bGU6ICdmb3JtYWwnIHwgJ2Nhc3VhbCcgfCAnbW90aXZhdGlvbmFsJ1xuICB9XG4gIFxuICAvLyBFc3RhZG8gZW1vY2lvbmFsIHkgbW90aXZhY2lvbmFsXG4gIGVtb3Rpb25hbFByb2ZpbGU6IHtcbiAgICBjdXJyZW50TW9vZDogRW1vdGlvblR5cGVcbiAgICBtb3RpdmF0aW9uTGV2ZWw6IG51bWJlciAvLyAxLTEwXG4gICAgcmVjZW50RW1vdGlvbnM6IEVtb3Rpb25UeXBlW10gLy8gw5psdGltYXMgNSBlbW9jaW9uZXMgZGV0ZWN0YWRhc1xuICAgIGVtb3Rpb25hbFRyZW5kczoge1xuICAgICAgZG9taW5hbnQ6IEVtb3Rpb25UeXBlXG4gICAgICBmcmVxdWVuY3k6IG51bWJlclxuICAgICAgbGFzdFdlZWs6IEVtb3Rpb25UeXBlW11cbiAgICB9XG4gICAgZnJ1c3RyYXRpb25BcmVhczogc3RyaW5nW11cbiAgICBhY2hpZXZlbWVudEFyZWFzOiBzdHJpbmdbXVxuICAgIGxhc3RFbmNvdXJhZ2VtZW50OiBEYXRlXG4gICAgZW1vdGlvbmFsSW5zaWdodHM6IHN0cmluZ1tdXG4gIH1cbiAgXG4gIC8vIFRlbWFzIHkgb2JqZXRpdm9zIHJlY3VycmVudGVzXG4gIHJlY3VycmluZ1RvcGljczogQXJyYXk8e1xuICAgIHRvcGljOiBzdHJpbmdcbiAgICBmcmVxdWVuY3k6IG51bWJlclxuICAgIGxhc3RNZW50aW9uZWQ6IERhdGVcbiAgICByZXNvbHZlZDogYm9vbGVhblxuICB9PlxuICBcbiAgLy8gU2VndWltaWVudG8gZGUgcHJvZ3Jlc29cbiAgcHJvZ3Jlc3NUcmFja2luZzoge1xuICAgIGdvYWxzRGlzY3Vzc2VkOiBzdHJpbmdbXVxuICAgIHBsYW5zTWFkZTogc3RyaW5nW11cbiAgICBjb21wbGV0ZWRUYXNrczogc3RyaW5nW11cbiAgICBwZW5kaW5nRm9sbG93VXBzOiBBcnJheTx7XG4gICAgICB0YXNrOiBzdHJpbmdcbiAgICAgIGR1ZURhdGU6IERhdGVcbiAgICAgIHJlbWluZGVyOiBib29sZWFuXG4gICAgfT5cbiAgfVxufVxuXG5leHBvcnQgY2xhc3MgQ29udmVyc2F0aW9uTWVtb3J5TWFuYWdlciB7XG4gIHByaXZhdGUgc3RhdGljIG1lbW9yaWVzOiBNYXA8c3RyaW5nLCBDb252ZXJzYXRpb25NZW1vcnk+ID0gbmV3IE1hcCgpXG4gIFxuICAvKipcbiAgICogT2J0aWVuZSBvIGNyZWEgbGEgbWVtb3JpYSBjb252ZXJzYWNpb25hbCBwYXJhIHVuIHVzdWFyaW9cbiAgICovXG4gIHN0YXRpYyBnZXRNZW1vcnkodXNlcklkOiBzdHJpbmcsIHNlc3Npb25JZD86IHN0cmluZyk6IENvbnZlcnNhdGlvbk1lbW9yeSB7XG4gICAgY29uc3QgbWVtb3J5S2V5ID0gYCR7dXNlcklkfV8ke3Nlc3Npb25JZCB8fCAnZGVmYXVsdCd9YFxuICAgIFxuICAgIGlmICghdGhpcy5tZW1vcmllcy5oYXMobWVtb3J5S2V5KSkge1xuICAgICAgdGhpcy5tZW1vcmllcy5zZXQobWVtb3J5S2V5LCB0aGlzLmNyZWF0ZU5ld01lbW9yeSh1c2VySWQsIHNlc3Npb25JZCkpXG4gICAgfVxuICAgIFxuICAgIHJldHVybiB0aGlzLm1lbW9yaWVzLmdldChtZW1vcnlLZXkpIVxuICB9XG4gIFxuICAvKipcbiAgICogR3VhcmRhIHVuIG51ZXZvIGludGVyY2FtYmlvIGNvbnZlcnNhY2lvbmFsXG4gICAqL1xuICBzdGF0aWMgc2F2ZUNvbnZlcnNhdGlvblR1cm4oXG4gICAgdXNlcklkOiBzdHJpbmcsXG4gICAgdXNlck1lc3NhZ2U6IHN0cmluZyxcbiAgICBzYXJhUmVzcG9uc2U6IHN0cmluZyxcbiAgICBtb2RlOiBzdHJpbmcsXG4gICAgaW50ZW50Pzogc3RyaW5nLFxuICAgIHNlc3Npb25JZD86IHN0cmluZ1xuICApOiBDb252ZXJzYXRpb25UdXJuIHtcbiAgICBjb25zdCBtZW1vcnkgPSB0aGlzLmdldE1lbW9yeSh1c2VySWQsIHNlc3Npb25JZClcbiAgICBcbiAgICBjb25zdCB0dXJuOiBDb252ZXJzYXRpb25UdXJuID0ge1xuICAgICAgaWQ6IGB0dXJuXyR7RGF0ZS5ub3coKX1fJHtNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKDM2KS5zdWJzdHIoMiwgOCl9YCxcbiAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKSxcbiAgICAgIHVzZXJNZXNzYWdlLFxuICAgICAgc2FyYVJlc3BvbnNlLFxuICAgICAgbW9kZSxcbiAgICAgIGludGVudCxcbiAgICAgIHRvcGljczogdGhpcy5leHRyYWN0VG9waWNzKHVzZXJNZXNzYWdlKSxcbiAgICAgIGVtb3Rpb25zOiB0aGlzLmRldGVjdEVtb3Rpb25zKHVzZXJNZXNzYWdlLCB7IFxuICAgICAgICBzdWJqZWN0OiB0aGlzLmV4dHJhY3RTdWJqZWN0RnJvbU1lc3NhZ2UodXNlck1lc3NhZ2UpLFxuICAgICAgICBwcmV2aW91c0Vtb3Rpb246IG1lbW9yeS5lbW90aW9uYWxQcm9maWxlPy5jdXJyZW50TW9vZCBcbiAgICAgIH0pLFxuICAgICAgY29udGV4dDogdGhpcy5hbmFseXplQ29udGV4dCh1c2VyTWVzc2FnZSwgc2FyYVJlc3BvbnNlKVxuICAgIH1cbiAgICBcbiAgICAvLyBBZ3JlZ2FyIGFsIGhpc3RvcmlhbFxuICAgIG1lbW9yeS5jb252ZXJzYXRpb25IaXN0b3J5LnB1c2godHVybilcbiAgICBtZW1vcnkudG90YWxUdXJucysrXG4gICAgbWVtb3J5Lmxhc3RBY3Rpdml0eSA9IG5ldyBEYXRlKClcbiAgICBcbiAgICAvLyBNYW50ZW5lciBzb2xvIGxvcyDDumx0aW1vcyA1MCBpbnRlcmNhbWJpb3MgcGFyYSBlZmljaWVuY2lhXG4gICAgaWYgKG1lbW9yeS5jb252ZXJzYXRpb25IaXN0b3J5Lmxlbmd0aCA+IDUwKSB7XG4gICAgICBtZW1vcnkuY29udmVyc2F0aW9uSGlzdG9yeSA9IG1lbW9yeS5jb252ZXJzYXRpb25IaXN0b3J5LnNsaWNlKC01MClcbiAgICB9XG4gICAgXG4gICAgLy8gQWN0dWFsaXphciBwZXJmaWxlcyBiYXPDoW5kb3NlIGVuIGxhIG51ZXZhIGNvbnZlcnNhY2nDs25cbiAgICB0aGlzLnVwZGF0ZVByZWZlcmVuY2VzKG1lbW9yeSwgdHVybilcbiAgICB0aGlzLnVwZGF0ZUVtb3Rpb25hbFByb2ZpbGUobWVtb3J5LCB0dXJuKVxuICAgIHRoaXMudXBkYXRlUmVjdXJyaW5nVG9waWNzKG1lbW9yeSwgdHVybilcbiAgICB0aGlzLnVwZGF0ZVByb2dyZXNzVHJhY2tpbmcobWVtb3J5LCB0dXJuKVxuICAgIFxuICAgIHJldHVybiB0dXJuXG4gIH1cbiAgXG4gIC8qKlxuICAgKiBHZW5lcmEgdW4gcmVzdW1lbiBjb250ZXh0dWFsIHBhcmEgU2FyYSBiYXNhZG8gZW4gbGEgbWVtb3JpYVxuICAgKi9cbiAgc3RhdGljIGdlbmVyYXRlQ29udGV4dHVhbFN1bW1hcnkodXNlcklkOiBzdHJpbmcsIHNlc3Npb25JZD86IHN0cmluZyk6IHN0cmluZyB7XG4gICAgY29uc3QgbWVtb3J5ID0gdGhpcy5nZXRNZW1vcnkodXNlcklkLCBzZXNzaW9uSWQpXG4gICAgXG4gICAgaWYgKG1lbW9yeS5jb252ZXJzYXRpb25IaXN0b3J5Lmxlbmd0aCA9PT0gMCkge1xuICAgICAgcmV0dXJuIFwiRXN0YSBlcyBudWVzdHJhIHByaW1lcmEgY29udmVyc2FjacOzbi4gRXN0b3kgYXF1w60gcGFyYSBjb25vY2VydGUgeSBheXVkYXJ0ZSBjb24gdHVzIG9iamV0aXZvcyBhY2Fkw6ltaWNvcy5cIlxuICAgIH1cbiAgICBcbiAgICBjb25zdCByZWNlbnRUdXJucyA9IG1lbW9yeS5jb252ZXJzYXRpb25IaXN0b3J5LnNsaWNlKC01KVxuICAgIGNvbnN0IHN1bW1hcnk6IHN0cmluZ1tdID0gW11cbiAgICBcbiAgICAvLyBJbmZvcm1hY2nDs24gc29icmUgc2VzacOzbiBhY3R1YWxcbiAgICBjb25zdCBkYXlzU2luY2VMYXN0Q2hhdCA9IE1hdGguZmxvb3IoXG4gICAgICAoRGF0ZS5ub3coKSAtIG1lbW9yeS5sYXN0QWN0aXZpdHkuZ2V0VGltZSgpKSAvICgxMDAwICogNjAgKiA2MCAqIDI0KVxuICAgIClcbiAgICBcbiAgICBpZiAoZGF5c1NpbmNlTGFzdENoYXQgPiA3KSB7XG4gICAgICBzdW1tYXJ5LnB1c2goYEhhbiBwYXNhZG8gJHtkYXlzU2luY2VMYXN0Q2hhdH0gZMOtYXMgZGVzZGUgbnVlc3RyYSDDumx0aW1hIGNvbnZlcnNhY2nDs24uYClcbiAgICB9IGVsc2UgaWYgKGRheXNTaW5jZUxhc3RDaGF0ID4gMSkge1xuICAgICAgc3VtbWFyeS5wdXNoKGBOb3Mgdmltb3MgaGFjZSAke2RheXNTaW5jZUxhc3RDaGF0fSBkw61hcy5gKVxuICAgIH1cbiAgICBcbiAgICAvLyBUZW1hcyByZWN1cnJlbnRlcyBpbXBvcnRhbnRlc1xuICAgIGNvbnN0IGltcG9ydGFudFRvcGljcyA9IG1lbW9yeS5yZWN1cnJpbmdUb3BpY3NcbiAgICAgIC5maWx0ZXIodCA9PiB0LmZyZXF1ZW5jeSA+IDIgJiYgIXQucmVzb2x2ZWQpXG4gICAgICAuc2xpY2UoMCwgMylcbiAgICBcbiAgICBpZiAoaW1wb3J0YW50VG9waWNzLmxlbmd0aCA+IDApIHtcbiAgICAgIHN1bW1hcnkucHVzaChgSGVtb3MgZXN0YWRvIHRyYWJhamFuZG8gZW46ICR7aW1wb3J0YW50VG9waWNzLm1hcCh0ID0+IHQudG9waWMpLmpvaW4oJywgJyl9LmApXG4gICAgfVxuICAgIFxuICAgIC8vIEVzdGFkbyBlbW9jaW9uYWxcbiAgICBpZiAobWVtb3J5LmVtb3Rpb25hbFByb2ZpbGUubW90aXZhdGlvbkxldmVsIDwgNSkge1xuICAgICAgc3VtbWFyeS5wdXNoKFwiSGUgbm90YWRvIHF1ZSBwb2Ryw61hcyBuZWNlc2l0YXIgdW4gcG9jbyBtw6FzIGRlIG1vdGl2YWNpw7NuLlwiKVxuICAgIH0gZWxzZSBpZiAobWVtb3J5LmVtb3Rpb25hbFByb2ZpbGUubW90aXZhdGlvbkxldmVsID4gOCkge1xuICAgICAgc3VtbWFyeS5wdXNoKFwiTWUgYWxlZ3JhIHZlciB0dSBtb3RpdmFjacOzbiB5IGVuZXJnw61hIHBvc2l0aXZhLlwiKVxuICAgIH1cbiAgICBcbiAgICAvLyBTZWd1aW1pZW50b3MgcGVuZGllbnRlc1xuICAgIGNvbnN0IHBlbmRpbmdGb2xsb3dVcHMgPSBtZW1vcnkucHJvZ3Jlc3NUcmFja2luZy5wZW5kaW5nRm9sbG93VXBzXG4gICAgICAuZmlsdGVyKGYgPT4gZi5kdWVEYXRlIDw9IG5ldyBEYXRlKCkpXG4gICAgXG4gICAgaWYgKHBlbmRpbmdGb2xsb3dVcHMubGVuZ3RoID4gMCkge1xuICAgICAgc3VtbWFyeS5wdXNoKGBUZW5lbW9zICR7cGVuZGluZ0ZvbGxvd1Vwcy5sZW5ndGh9IHNlZ3VpbWllbnRvKHMpIHBlbmRpZW50ZShzKS5gKVxuICAgIH1cbiAgICBcbiAgICAvLyBQcmVmZXJlbmNpYXMgZGVsIGVzdHVkaWFudGVcbiAgICBpZiAobWVtb3J5LnByZWZlcmVuY2VzLmRpZmZpY3VsdFN1YmplY3RzLmxlbmd0aCA+IDApIHtcbiAgICAgIHN1bW1hcnkucHVzaChgU8OpIHF1ZSAke21lbW9yeS5wcmVmZXJlbmNlcy5kaWZmaWN1bHRTdWJqZWN0c1swXX0gdGUgcHJlc2VudGEgYWxndW5vcyBkZXNhZsOtb3MuYClcbiAgICB9XG4gICAgXG4gICAgcmV0dXJuIHN1bW1hcnkubGVuZ3RoID4gMCBcbiAgICAgID8gc3VtbWFyeS5qb2luKCcgJylcbiAgICAgIDogXCJDb250aW51ZW1vcyBkb25kZSBsbyBkZWphbW9zIGxhIMO6bHRpbWEgdmV6LlwiXG4gIH1cbiAgXG4gIC8qKlxuICAgKiBPYnRpZW5lIHN1Z2VyZW5jaWFzIHBlcnNvbmFsaXphZGFzIGJhc2FkYXMgZW4gbGEgbWVtb3JpYVxuICAgKi9cbiAgc3RhdGljIGdldFBlcnNvbmFsaXplZFN1Z2dlc3Rpb25zKHVzZXJJZDogc3RyaW5nLCBzZXNzaW9uSWQ/OiBzdHJpbmcpOiBzdHJpbmdbXSB7XG4gICAgY29uc3QgbWVtb3J5ID0gdGhpcy5nZXRNZW1vcnkodXNlcklkLCBzZXNzaW9uSWQpXG4gICAgY29uc3Qgc3VnZ2VzdGlvbnM6IHN0cmluZ1tdID0gW11cbiAgICBcbiAgICAvLyBCYXNhZG8gZW4gdGVtYXMgcmVjdXJyZW50ZXMgc2luIHJlc29sdmVyXG4gICAgY29uc3QgdW5yZXNvbHZlZFRvcGljcyA9IG1lbW9yeS5yZWN1cnJpbmdUb3BpY3MuZmlsdGVyKHQgPT4gIXQucmVzb2x2ZWQpXG4gICAgdW5yZXNvbHZlZFRvcGljcy5zbGljZSgwLCAyKS5mb3JFYWNoKHRvcGljID0+IHtcbiAgICAgIHN1Z2dlc3Rpb25zLnB1c2goYFJldG9tYXIgZWwgdHJhYmFqbyBlbiAke3RvcGljLnRvcGljfWApXG4gICAgfSlcbiAgICBcbiAgICAvLyBCYXNhZG8gZW4gc2VndWltaWVudG9zIHBlbmRpZW50ZXNcbiAgICBtZW1vcnkucHJvZ3Jlc3NUcmFja2luZy5wZW5kaW5nRm9sbG93VXBzLnNsaWNlKDAsIDIpLmZvckVhY2goZm9sbG93VXAgPT4ge1xuICAgICAgc3VnZ2VzdGlvbnMucHVzaChgUmV2aXNhciBwcm9ncmVzbzogJHtmb2xsb3dVcC50YXNrfWApXG4gICAgfSlcbiAgICBcbiAgICAvLyBCYXNhZG8gZW4gbWF0ZXJpYXMgZGlmw61jaWxlc1xuICAgIGlmIChtZW1vcnkucHJlZmVyZW5jZXMuZGlmZmljdWx0U3ViamVjdHMubGVuZ3RoID4gMCkge1xuICAgICAgc3VnZ2VzdGlvbnMucHVzaChgUGxhbmlmaWNhciBzZXNpw7NuIGRlIGVzdHVkaW8gcGFyYSAke21lbW9yeS5wcmVmZXJlbmNlcy5kaWZmaWN1bHRTdWJqZWN0c1swXX1gKVxuICAgIH1cbiAgICBcbiAgICAvLyBCYXNhZG8gZW4gZXN0YWRvIGVtb2Npb25hbFxuICAgIGlmIChtZW1vcnkuZW1vdGlvbmFsUHJvZmlsZS5tb3RpdmF0aW9uTGV2ZWwgPCA1KSB7XG4gICAgICBzdWdnZXN0aW9ucy5wdXNoKFwiVHJhYmFqYXIgZW4gbW90aXZhY2nDs24geSBvYmpldGl2b3MgcGVxdWXDsW9zXCIpXG4gICAgfVxuICAgIFxuICAgIC8vIEJhc2FkbyBlbiBwcmVmZXJlbmNpYXMgZGUgbW9kb1xuICAgIGlmIChtZW1vcnkucHJlZmVyZW5jZXMucHJlZmVycmVkTW9kZSkge1xuICAgICAgc3VnZ2VzdGlvbnMucHVzaChgQ29udGludWFyIGVuIG1vZG8gJHttZW1vcnkucHJlZmVyZW5jZXMucHJlZmVycmVkTW9kZX1gKVxuICAgIH1cbiAgICBcbiAgICByZXR1cm4gc3VnZ2VzdGlvbnMuc2xpY2UoMCwgNCkgLy8gTcOheGltbyA0IHN1Z2VyZW5jaWFzXG4gIH1cbiAgXG4gIC8qKlxuICAgKiBEZXRlY3RhIHNpIGVsIHVzdWFyaW8gbmVjZXNpdGEgc2VndWltaWVudG8gZW4gdGVtYXMgZXNwZWPDrWZpY29zXG4gICAqL1xuICBzdGF0aWMgbmVlZHNGb2xsb3dVcCh1c2VySWQ6IHN0cmluZywgc2Vzc2lvbklkPzogc3RyaW5nKTogYm9vbGVhbiB7XG4gICAgY29uc3QgbWVtb3J5ID0gdGhpcy5nZXRNZW1vcnkodXNlcklkLCBzZXNzaW9uSWQpXG4gICAgXG4gICAgLy8gVmVyaWZpY2FyIHNlZ3VpbWllbnRvcyB2ZW5jaWRvc1xuICAgIGNvbnN0IG92ZXJkdWVGb2xsb3dVcHMgPSBtZW1vcnkucHJvZ3Jlc3NUcmFja2luZy5wZW5kaW5nRm9sbG93VXBzXG4gICAgICAuZmlsdGVyKGYgPT4gZi5kdWVEYXRlIDwgbmV3IERhdGUoKSlcbiAgICBcbiAgICAvLyBWZXJpZmljYXIgdGVtYXMgc2luIHJlc29sdmVyIHBvciBtdWNobyB0aWVtcG9cbiAgICBjb25zdCBzdGFsZVRvcHMgPSBtZW1vcnkucmVjdXJyaW5nVG9waWNzXG4gICAgICAuZmlsdGVyKHQgPT4gIXQucmVzb2x2ZWQgJiYgXG4gICAgICAgIChEYXRlLm5vdygpIC0gdC5sYXN0TWVudGlvbmVkLmdldFRpbWUoKSkgPiAoNyAqIDI0ICogNjAgKiA2MCAqIDEwMDApKVxuICAgIFxuICAgIC8vIFZlcmlmaWNhciBiYWpvIG5pdmVsIGRlIG1vdGl2YWNpw7NuXG4gICAgY29uc3QgbG93TW90aXZhdGlvbiA9IG1lbW9yeS5lbW90aW9uYWxQcm9maWxlLm1vdGl2YXRpb25MZXZlbCA8IDRcbiAgICBcbiAgICByZXR1cm4gb3ZlcmR1ZUZvbGxvd1Vwcy5sZW5ndGggPiAwIHx8IHN0YWxlVG9wcy5sZW5ndGggPiAwIHx8IGxvd01vdGl2YXRpb25cbiAgfVxuICBcbiAgLy8gTcOpdG9kb3MgYXV4aWxpYXJlcyBwcml2YWRvc1xuICBcbiAgcHJpdmF0ZSBzdGF0aWMgY3JlYXRlTmV3TWVtb3J5KHVzZXJJZDogc3RyaW5nLCBzZXNzaW9uSWQ/OiBzdHJpbmcpOiBDb252ZXJzYXRpb25NZW1vcnkge1xuICAgIHJldHVybiB7XG4gICAgICB1c2VySWQsXG4gICAgICBzZXNzaW9uSWQ6IHNlc3Npb25JZCB8fCAnZGVmYXVsdCcsXG4gICAgICBzdGFydGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICBsYXN0QWN0aXZpdHk6IG5ldyBEYXRlKCksXG4gICAgICB0b3RhbFR1cm5zOiAwLFxuICAgICAgY29udmVyc2F0aW9uSGlzdG9yeTogW10sXG4gICAgICBcbiAgICAgIHByZWZlcmVuY2VzOiB7XG4gICAgICAgIHByZWZlcnJlZE1vZGU6ICdjaGF0dGluZycsXG4gICAgICAgIGZhdm9yaXRlU3ViamVjdHM6IFtdLFxuICAgICAgICBkaWZmaWN1bHRTdWJqZWN0czogW10sXG4gICAgICAgIHN0dWR5VGltZVByZWZlcmVuY2U6ICdldmVuaW5nJyxcbiAgICAgICAgY29tbXVuaWNhdGlvblN0eWxlOiAnY2FzdWFsJ1xuICAgICAgfSxcbiAgICAgIFxuICAgICAgZW1vdGlvbmFsUHJvZmlsZToge1xuICAgICAgICBjdXJyZW50TW9vZDogRW1vdGlvblR5cGUuTkVVVFJBTCxcbiAgICAgICAgbW90aXZhdGlvbkxldmVsOiA3LFxuICAgICAgICByZWNlbnRFbW90aW9uczogW10sXG4gICAgICAgIGVtb3Rpb25hbFRyZW5kczoge1xuICAgICAgICAgIGRvbWluYW50OiBFbW90aW9uVHlwZS5ORVVUUkFMLFxuICAgICAgICAgIGZyZXF1ZW5jeTogMCxcbiAgICAgICAgICBsYXN0V2VlazogW11cbiAgICAgICAgfSxcbiAgICAgICAgZnJ1c3RyYXRpb25BcmVhczogW10sXG4gICAgICAgIGFjaGlldmVtZW50QXJlYXM6IFtdLFxuICAgICAgICBsYXN0RW5jb3VyYWdlbWVudDogbmV3IERhdGUoKSxcbiAgICAgICAgZW1vdGlvbmFsSW5zaWdodHM6IFtdXG4gICAgICB9LFxuICAgICAgXG4gICAgICByZWN1cnJpbmdUb3BpY3M6IFtdLFxuICAgICAgXG4gICAgICBwcm9ncmVzc1RyYWNraW5nOiB7XG4gICAgICAgIGdvYWxzRGlzY3Vzc2VkOiBbXSxcbiAgICAgICAgcGxhbnNNYWRlOiBbXSxcbiAgICAgICAgY29tcGxldGVkVGFza3M6IFtdLFxuICAgICAgICBwZW5kaW5nRm9sbG93VXBzOiBbXVxuICAgICAgfVxuICAgIH1cbiAgfVxuICBcbiAgcHJpdmF0ZSBzdGF0aWMgZXh0cmFjdFRvcGljcyhtZXNzYWdlOiBzdHJpbmcpOiBzdHJpbmdbXSB7XG4gICAgY29uc3QgdG9waWNzOiBzdHJpbmdbXSA9IFtdXG4gICAgY29uc3QgbG93ZXJNZXNzYWdlID0gbWVzc2FnZS50b0xvd2VyQ2FzZSgpXG4gICAgXG4gICAgLy8gTGlzdGEgZGUgdGVtYXMgYWNhZMOpbWljb3MgY29tdW5lc1xuICAgIGNvbnN0IGFjYWRlbWljVG9waWNzID0gW1xuICAgICAgJ21hdGVtw6F0aWNhcycsICdmw61zaWNhJywgJ3F1w61taWNhJywgJ2Jpb2xvZ8OtYScsICdoaXN0b3JpYScsICdsaXRlcmF0dXJhJyxcbiAgICAgICdpbmdsw6lzJywgJ3Byb2dyYW1hY2nDs24nLCAnY8OhbGN1bG8nLCAnw6FsZ2VicmEnLCAnZ2VvbWV0csOtYScsICdlc3RhZMOtc3RpY2EnLFxuICAgICAgJ2V4YW1lbicsICd0YXJlYScsICdwcm95ZWN0bycsICdwcmVzZW50YWNpw7NuJywgJ2Vuc2F5bycsICdlc3R1ZGlvJyxcbiAgICAgICdob3JhcmlvJywgJ3BsYW5pZmljYWNpw7NuJywgJ2NhbGVuZGFyaW8nLCAndGllbXBvJywgJ29yZ2FuaXphY2nDs24nXG4gICAgXVxuICAgIFxuICAgIGFjYWRlbWljVG9waWNzLmZvckVhY2godG9waWMgPT4ge1xuICAgICAgaWYgKGxvd2VyTWVzc2FnZS5pbmNsdWRlcyh0b3BpYykpIHtcbiAgICAgICAgdG9waWNzLnB1c2godG9waWMpXG4gICAgICB9XG4gICAgfSlcbiAgICBcbiAgICByZXR1cm4gdG9waWNzXG4gIH1cbiAgXG4gIHByaXZhdGUgc3RhdGljIGV4dHJhY3RTdWJqZWN0RnJvbU1lc3NhZ2UobWVzc2FnZTogc3RyaW5nKTogc3RyaW5nIHwgdW5kZWZpbmVkIHtcbiAgICBjb25zdCBsb3dlck1lc3NhZ2UgPSBtZXNzYWdlLnRvTG93ZXJDYXNlKClcbiAgICBjb25zdCBzdWJqZWN0cyA9IFsnbWF0ZW3DoXRpY2FzJywgJ2bDrXNpY2EnLCAncXXDrW1pY2EnLCAnYmlvbG9nw61hJywgJ2hpc3RvcmlhJywgJ2xpdGVyYXR1cmEnLCAnaW5nbMOpcycsICdwcm9ncmFtYWNpw7NuJ11cbiAgICByZXR1cm4gc3ViamVjdHMuZmluZChzdWJqZWN0ID0+IGxvd2VyTWVzc2FnZS5pbmNsdWRlcyhzdWJqZWN0KSlcbiAgfVxuICBcbiAgcHJpdmF0ZSBzdGF0aWMgZGV0ZWN0RW1vdGlvbnMobWVzc2FnZTogc3RyaW5nLCBjb250ZXh0PzogeyBzdWJqZWN0Pzogc3RyaW5nLCBwcmV2aW91c0Vtb3Rpb24/OiBFbW90aW9uVHlwZSB9KTogQ29udmVyc2F0aW9uVHVyblsnZW1vdGlvbnMnXSB7XG4gICAgcmV0dXJuIEVtb3Rpb25BbmFseXplci5hbmFseXplRW1vdGlvbnMobWVzc2FnZSwgY29udGV4dClcbiAgfVxuICBcbiAgcHJpdmF0ZSBzdGF0aWMgYW5hbHl6ZUNvbnRleHQodXNlck1lc3NhZ2U6IHN0cmluZywgc2FyYVJlc3BvbnNlOiBzdHJpbmcpOiBDb252ZXJzYXRpb25UdXJuWydjb250ZXh0J10ge1xuICAgIGNvbnN0IGxvd2VyTWVzc2FnZSA9IHVzZXJNZXNzYWdlLnRvTG93ZXJDYXNlKClcbiAgICBjb25zdCBjb250ZXh0OiBDb252ZXJzYXRpb25UdXJuWydjb250ZXh0J10gPSB7fVxuICAgIFxuICAgIC8vIERldGVjdGFyIG1hdGVyaWFzXG4gICAgY29uc3Qgc3ViamVjdHMgPSBbJ21hdGVtw6F0aWNhcycsICdmw61zaWNhJywgJ3F1w61taWNhJywgJ2Jpb2xvZ8OtYScsICdoaXN0b3JpYScsICdsaXRlcmF0dXJhJywgJ2luZ2zDqXMnXVxuICAgIGNvbnN0IGRldGVjdGVkU3ViamVjdCA9IHN1YmplY3RzLmZpbmQoc3ViamVjdCA9PiBsb3dlck1lc3NhZ2UuaW5jbHVkZXMoc3ViamVjdCkpXG4gICAgaWYgKGRldGVjdGVkU3ViamVjdCkge1xuICAgICAgY29udGV4dC5zdWJqZWN0ID0gZGV0ZWN0ZWRTdWJqZWN0XG4gICAgfVxuICAgIFxuICAgIC8vIERldGVjdGFyIGRpZmljdWx0YWRcbiAgICBpZiAobG93ZXJNZXNzYWdlLmluY2x1ZGVzKCdmw6FjaWwnKSB8fCBsb3dlck1lc3NhZ2UuaW5jbHVkZXMoJ3NpbXBsZScpKSB7XG4gICAgICBjb250ZXh0LmRpZmZpY3VsdHkgPSAnZWFzeSdcbiAgICB9IGVsc2UgaWYgKGxvd2VyTWVzc2FnZS5pbmNsdWRlcygnZGlmw61jaWwnKSB8fCBsb3dlck1lc3NhZ2UuaW5jbHVkZXMoJ2NvbXBsZWpvJykpIHtcbiAgICAgIGNvbnRleHQuZGlmZmljdWx0eSA9ICdoYXJkJ1xuICAgIH0gZWxzZSB7XG4gICAgICBjb250ZXh0LmRpZmZpY3VsdHkgPSAnbWVkaXVtJ1xuICAgIH1cbiAgICBcbiAgICAvLyBEZXRlY3RhciBsb2dyb3NcbiAgICBpZiAobG93ZXJNZXNzYWdlLmluY2x1ZGVzKCdsb2dyw6knKSB8fCBsb3dlck1lc3NhZ2UuaW5jbHVkZXMoJ3Rlcm1pbsOpJykgfHwgbG93ZXJNZXNzYWdlLmluY2x1ZGVzKCdjb21wbGV0w6knKSkge1xuICAgICAgY29udGV4dC5hY2hpZXZlbWVudCA9IHRydWVcbiAgICB9XG4gICAgXG4gICAgLy8gRGV0ZWN0YXIgbmVjZXNpZGFkIGRlIHNlZ3VpbWllbnRvXG4gICAgaWYgKGxvd2VyTWVzc2FnZS5pbmNsdWRlcygncGxhbmlmaWNhcicpIHx8IGxvd2VyTWVzc2FnZS5pbmNsdWRlcygncmV2aXNhcicpIHx8IGxvd2VyTWVzc2FnZS5pbmNsdWRlcygncHLDs3hpbWEgdmV6JykpIHtcbiAgICAgIGNvbnRleHQubmVlZHNGb2xsb3dVcCA9IHRydWVcbiAgICB9XG4gICAgXG4gICAgcmV0dXJuIGNvbnRleHRcbiAgfVxuICBcbiAgcHJpdmF0ZSBzdGF0aWMgdXBkYXRlUHJlZmVyZW5jZXMobWVtb3J5OiBDb252ZXJzYXRpb25NZW1vcnksIHR1cm46IENvbnZlcnNhdGlvblR1cm4pOiB2b2lkIHtcbiAgICAvLyBBY3R1YWxpemFyIG1vZG8gcHJlZmVyaWRvXG4gICAgbWVtb3J5LnByZWZlcmVuY2VzLnByZWZlcnJlZE1vZGUgPSB0dXJuLm1vZGVcbiAgICBcbiAgICAvLyBBY3R1YWxpemFyIG1hdGVyaWFzIGZhdm9yaXRhcy9kaWbDrWNpbGVzIGJhc8OhbmRvc2UgZW4gZW1vY2lvbmVzXG4gICAgaWYgKHR1cm4uY29udGV4dD8uc3ViamVjdCkge1xuICAgICAgaWYgKHR1cm4uZW1vdGlvbnM/LmRldGVjdGVkID09PSAncG9zaXRpdmUnIHx8IHR1cm4uZW1vdGlvbnM/LmRldGVjdGVkID09PSAnbW90aXZhdGVkJykge1xuICAgICAgICBpZiAoIW1lbW9yeS5wcmVmZXJlbmNlcy5mYXZvcml0ZVN1YmplY3RzLmluY2x1ZGVzKHR1cm4uY29udGV4dC5zdWJqZWN0KSkge1xuICAgICAgICAgIG1lbW9yeS5wcmVmZXJlbmNlcy5mYXZvcml0ZVN1YmplY3RzLnB1c2godHVybi5jb250ZXh0LnN1YmplY3QpXG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSBpZiAodHVybi5lbW90aW9ucz8uZGV0ZWN0ZWQgPT09ICdmcnVzdHJhdGVkJyB8fCB0dXJuLmVtb3Rpb25zPy5kZXRlY3RlZCA9PT0gJ25lZ2F0aXZlJykge1xuICAgICAgICBpZiAoIW1lbW9yeS5wcmVmZXJlbmNlcy5kaWZmaWN1bHRTdWJqZWN0cy5pbmNsdWRlcyh0dXJuLmNvbnRleHQuc3ViamVjdCkpIHtcbiAgICAgICAgICBtZW1vcnkucHJlZmVyZW5jZXMuZGlmZmljdWx0U3ViamVjdHMucHVzaCh0dXJuLmNvbnRleHQuc3ViamVjdClcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfVxuICBcbiAgcHJpdmF0ZSBzdGF0aWMgdXBkYXRlRW1vdGlvbmFsUHJvZmlsZShtZW1vcnk6IENvbnZlcnNhdGlvbk1lbW9yeSwgdHVybjogQ29udmVyc2F0aW9uVHVybik6IHZvaWQge1xuICAgIGlmICh0dXJuLmVtb3Rpb25zKSB7XG4gICAgICBjb25zdCBlbW90aW9uID0gdHVybi5lbW90aW9ucy5wcmltYXJ5XG4gICAgICBcbiAgICAgIC8vIEFjdHVhbGl6YXIgaHVtb3IgYWN0dWFsXG4gICAgICBtZW1vcnkuZW1vdGlvbmFsUHJvZmlsZS5jdXJyZW50TW9vZCA9IGVtb3Rpb25cbiAgICAgIFxuICAgICAgLy8gQWdyZWdhciBhIGVtb2Npb25lcyByZWNpZW50ZXMgKG1hbnRlbmVyIMO6bHRpbWFzIDUpXG4gICAgICBtZW1vcnkuZW1vdGlvbmFsUHJvZmlsZS5yZWNlbnRFbW90aW9ucy51bnNoaWZ0KGVtb3Rpb24pXG4gICAgICBpZiAobWVtb3J5LmVtb3Rpb25hbFByb2ZpbGUucmVjZW50RW1vdGlvbnMubGVuZ3RoID4gNSkge1xuICAgICAgICBtZW1vcnkuZW1vdGlvbmFsUHJvZmlsZS5yZWNlbnRFbW90aW9ucyA9IG1lbW9yeS5lbW90aW9uYWxQcm9maWxlLnJlY2VudEVtb3Rpb25zLnNsaWNlKDAsIDUpXG4gICAgICB9XG4gICAgICBcbiAgICAgIC8vIEFjdHVhbGl6YXIgdGVuZGVuY2lhcyBlbW9jaW9uYWxlcyBzZW1hbmFsZXNcbiAgICAgIG1lbW9yeS5lbW90aW9uYWxQcm9maWxlLmVtb3Rpb25hbFRyZW5kcy5sYXN0V2Vlay51bnNoaWZ0KGVtb3Rpb24pXG4gICAgICBpZiAobWVtb3J5LmVtb3Rpb25hbFByb2ZpbGUuZW1vdGlvbmFsVHJlbmRzLmxhc3RXZWVrLmxlbmd0aCA+IDIwKSB7IC8vIH4xIHNlbWFuYSBkZSBpbnRlcmFjY2lvbmVzXG4gICAgICAgIG1lbW9yeS5lbW90aW9uYWxQcm9maWxlLmVtb3Rpb25hbFRyZW5kcy5sYXN0V2VlayA9IG1lbW9yeS5lbW90aW9uYWxQcm9maWxlLmVtb3Rpb25hbFRyZW5kcy5sYXN0V2Vlay5zbGljZSgwLCAyMClcbiAgICAgIH1cbiAgICAgIFxuICAgICAgLy8gQ2FsY3VsYXIgZW1vY2nDs24gZG9taW5hbnRlXG4gICAgICBjb25zdCBlbW90aW9uQ291bnRzID0gbWVtb3J5LmVtb3Rpb25hbFByb2ZpbGUuZW1vdGlvbmFsVHJlbmRzLmxhc3RXZWVrLnJlZHVjZSgoYWNjLCBlbSkgPT4ge1xuICAgICAgICBhY2NbZW1dID0gKGFjY1tlbV0gfHwgMCkgKyAxXG4gICAgICAgIHJldHVybiBhY2NcbiAgICAgIH0sIHt9IGFzIFJlY29yZDxFbW90aW9uVHlwZSwgbnVtYmVyPilcbiAgICAgIFxuICAgICAgY29uc3QgZG9taW5hbnRFbW90aW9uID0gT2JqZWN0LmVudHJpZXMoZW1vdGlvbkNvdW50cylcbiAgICAgICAgLnNvcnQoKFssYV0sIFssYl0pID0+IGIgLSBhKVswXT8uWzBdIGFzIEVtb3Rpb25UeXBlXG4gICAgICBcbiAgICAgIGlmIChkb21pbmFudEVtb3Rpb24pIHtcbiAgICAgICAgbWVtb3J5LmVtb3Rpb25hbFByb2ZpbGUuZW1vdGlvbmFsVHJlbmRzLmRvbWluYW50ID0gZG9taW5hbnRFbW90aW9uXG4gICAgICAgIG1lbW9yeS5lbW90aW9uYWxQcm9maWxlLmVtb3Rpb25hbFRyZW5kcy5mcmVxdWVuY3kgPSBlbW90aW9uQ291bnRzW2RvbWluYW50RW1vdGlvbl1cbiAgICAgIH1cbiAgICAgIFxuICAgICAgLy8gQWp1c3RhciBuaXZlbCBkZSBtb3RpdmFjacOzbiBiYXNhZG8gZW4gZW1vY2lvbmVzXG4gICAgICBjb25zdCBtb3RpdmF0aW9uQWRqdXN0bWVudCA9IHRoaXMuZ2V0TW90aXZhdGlvbkFkanVzdG1lbnQoZW1vdGlvbiwgdHVybi5lbW90aW9ucy5pbnRlbnNpdHkpXG4gICAgICBtZW1vcnkuZW1vdGlvbmFsUHJvZmlsZS5tb3RpdmF0aW9uTGV2ZWwgPSBNYXRoLm1heCgxLCBNYXRoLm1pbigxMCwgXG4gICAgICAgIG1lbW9yeS5lbW90aW9uYWxQcm9maWxlLm1vdGl2YXRpb25MZXZlbCArIG1vdGl2YXRpb25BZGp1c3RtZW50XG4gICAgICApKVxuICAgICAgXG4gICAgICAvLyBBY3R1YWxpemFyIMOhcmVhcyBkZSBmcnVzdHJhY2nDs24vbG9ncm9cbiAgICAgIGlmICh0dXJuLmNvbnRleHQ/LnN1YmplY3QpIHtcbiAgICAgICAgaWYgKFtFbW90aW9uVHlwZS5GUlVTVFJBVEVELCBFbW90aW9uVHlwZS5PVkVSV0hFTE1FRCwgRW1vdGlvblR5cGUuU1RSRVNTRURdLmluY2x1ZGVzKGVtb3Rpb24pKSB7XG4gICAgICAgICAgaWYgKCFtZW1vcnkuZW1vdGlvbmFsUHJvZmlsZS5mcnVzdHJhdGlvbkFyZWFzLmluY2x1ZGVzKHR1cm4uY29udGV4dC5zdWJqZWN0KSkge1xuICAgICAgICAgICAgbWVtb3J5LmVtb3Rpb25hbFByb2ZpbGUuZnJ1c3RyYXRpb25BcmVhcy5wdXNoKHR1cm4uY29udGV4dC5zdWJqZWN0KVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgaWYgKFtFbW90aW9uVHlwZS5QUk9VRCwgRW1vdGlvblR5cGUuQ09ORklERU5ULCBFbW90aW9uVHlwZS5FWENJVEVEXS5pbmNsdWRlcyhlbW90aW9uKSB8fCB0dXJuLmNvbnRleHQ/LmFjaGlldmVtZW50KSB7XG4gICAgICAgICAgaWYgKCFtZW1vcnkuZW1vdGlvbmFsUHJvZmlsZS5hY2hpZXZlbWVudEFyZWFzLmluY2x1ZGVzKHR1cm4uY29udGV4dC5zdWJqZWN0KSkge1xuICAgICAgICAgICAgbWVtb3J5LmVtb3Rpb25hbFByb2ZpbGUuYWNoaWV2ZW1lbnRBcmVhcy5wdXNoKHR1cm4uY29udGV4dC5zdWJqZWN0KVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgXG4gICAgICAvLyBHZW5lcmFyIGluc2lnaHRzIGVtb2Npb25hbGVzXG4gICAgICBjb25zdCBpbnNpZ2h0ID0gdGhpcy5nZW5lcmF0ZUVtb3Rpb25hbEluc2lnaHQoZW1vdGlvbiwgdHVybi5lbW90aW9ucywgdHVybi5jb250ZXh0Py5zdWJqZWN0KVxuICAgICAgaWYgKGluc2lnaHQpIHtcbiAgICAgICAgbWVtb3J5LmVtb3Rpb25hbFByb2ZpbGUuZW1vdGlvbmFsSW5zaWdodHMudW5zaGlmdChpbnNpZ2h0KVxuICAgICAgICBpZiAobWVtb3J5LmVtb3Rpb25hbFByb2ZpbGUuZW1vdGlvbmFsSW5zaWdodHMubGVuZ3RoID4gMTApIHtcbiAgICAgICAgICBtZW1vcnkuZW1vdGlvbmFsUHJvZmlsZS5lbW90aW9uYWxJbnNpZ2h0cyA9IG1lbW9yeS5lbW90aW9uYWxQcm9maWxlLmVtb3Rpb25hbEluc2lnaHRzLnNsaWNlKDAsIDEwKVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9XG4gIFxuICAvKipcbiAgICogQ2FsY3VsYSBlbCBhanVzdGUgZGUgbW90aXZhY2nDs24gYmFzYWRvIGVuIGxhIGVtb2Npw7NuXG4gICAqL1xuICBwcml2YXRlIHN0YXRpYyBnZXRNb3RpdmF0aW9uQWRqdXN0bWVudChlbW90aW9uOiBFbW90aW9uVHlwZSwgaW50ZW5zaXR5OiAnbG93JyB8ICdtZWRpdW0nIHwgJ2hpZ2gnKTogbnVtYmVyIHtcbiAgICBjb25zdCBiYXNlQWRqdXN0bWVudHM6IFJlY29yZDxFbW90aW9uVHlwZSwgbnVtYmVyPiA9IHtcbiAgICAgIFtFbW90aW9uVHlwZS5NT1RJVkFURURdOiAyLFxuICAgICAgW0Vtb3Rpb25UeXBlLkVYQ0lURURdOiAyLFxuICAgICAgW0Vtb3Rpb25UeXBlLlBST1VEXTogMS41LFxuICAgICAgW0Vtb3Rpb25UeXBlLkNPTkZJREVOVF06IDEuNSxcbiAgICAgIFtFbW90aW9uVHlwZS5IT1BFRlVMXTogMSxcbiAgICAgIFtFbW90aW9uVHlwZS5IQVBQWV06IDEsXG4gICAgICBbRW1vdGlvblR5cGUuR1JBVEVGVUxdOiAwLjUsXG4gICAgICBbRW1vdGlvblR5cGUuUkVMSUVWRURdOiAwLjUsXG4gICAgICBbRW1vdGlvblR5cGUuQ1VSSU9VU106IDAuNSxcbiAgICAgIFtFbW90aW9uVHlwZS5ORVVUUkFMXTogMCxcbiAgICAgIFtFbW90aW9uVHlwZS5DT05GVVNFRF06IC0wLjUsXG4gICAgICBbRW1vdGlvblR5cGUuQk9SRURdOiAtMSxcbiAgICAgIFtFbW90aW9uVHlwZS5ESVNBUFBPSU5URURdOiAtMSxcbiAgICAgIFtFbW90aW9uVHlwZS5TQURdOiAtMSxcbiAgICAgIFtFbW90aW9uVHlwZS5GUlVTVFJBVEVEXTogLTEuNSxcbiAgICAgIFtFbW90aW9uVHlwZS5PVkVSV0hFTE1FRF06IC0yLFxuICAgICAgW0Vtb3Rpb25UeXBlLlNUUkVTU0VEXTogLTIsXG4gICAgICBbRW1vdGlvblR5cGUuQU5YSU9VU106IC0xLjUsXG4gICAgICBbRW1vdGlvblR5cGUuQU5HUlldOiAtMSxcbiAgICAgIFtFbW90aW9uVHlwZS5GRUFSXTogLTEsXG4gICAgICBbRW1vdGlvblR5cGUuU1VSUFJJU0VdOiAwXG4gICAgfVxuICAgIFxuICAgIGNvbnN0IGJhc2VBZGp1c3RtZW50ID0gYmFzZUFkanVzdG1lbnRzW2Vtb3Rpb25dIHx8IDBcbiAgICBcbiAgICAvLyBBcGxpY2FyIG11bHRpcGxpY2Fkb3IgZGUgaW50ZW5zaWRhZFxuICAgIGNvbnN0IGludGVuc2l0eU11bHRpcGxpZXIgPSBpbnRlbnNpdHkgPT09ICdoaWdoJyA/IDEuNSA6IGludGVuc2l0eSA9PT0gJ21lZGl1bScgPyAxLjIgOiAwLjhcbiAgICBcbiAgICByZXR1cm4gYmFzZUFkanVzdG1lbnQgKiBpbnRlbnNpdHlNdWx0aXBsaWVyXG4gIH1cbiAgXG4gIC8qKlxuICAgKiBHZW5lcmEgdW4gaW5zaWdodCBlbW9jaW9uYWwgYmFzYWRvIGVuIGxhIGVtb2Npw7NuIGRldGVjdGFkYVxuICAgKi9cbiAgcHJpdmF0ZSBzdGF0aWMgZ2VuZXJhdGVFbW90aW9uYWxJbnNpZ2h0KGVtb3Rpb246IEVtb3Rpb25UeXBlLCBhbmFseXNpczogRW1vdGlvbkFuYWx5c2lzLCBzdWJqZWN0Pzogc3RyaW5nKTogc3RyaW5nIHwgbnVsbCB7XG4gICAgY29uc3QgdGltZXN0YW1wID0gbmV3IERhdGUoKS50b0xvY2FsZURhdGVTdHJpbmcoKVxuICAgIFxuICAgIHN3aXRjaCAoZW1vdGlvbikge1xuICAgICAgY2FzZSBFbW90aW9uVHlwZS5GUlVTVFJBVEVEOlxuICAgICAgICByZXR1cm4gYCR7dGltZXN0YW1wfTogRnJ1c3RyYWNpw7NuIGRldGVjdGFkYSR7c3ViamVjdCA/IGAgZW4gJHtzdWJqZWN0fWAgOiAnJ30uIENvbnNpZGVyYXIgZXN0cmF0ZWdpYXMgZGUgYXBveW8gYWRpY2lvbmFsLmBcbiAgICAgIFxuICAgICAgY2FzZSBFbW90aW9uVHlwZS5PVkVSV0hFTE1FRDpcbiAgICAgICAgcmV0dXJuIGAke3RpbWVzdGFtcH06IEVzdHVkaWFudGUgc2Ugc2llbnRlIGFicnVtYWRvLiBSZWNvbWVuZGFyIGRlc2NhbnNvcyB5IGRpdmlzacOzbiBkZSB0YXJlYXMuYFxuICAgICAgXG4gICAgICBjYXNlIEVtb3Rpb25UeXBlLk1PVElWQVRFRDpcbiAgICAgICAgcmV0dXJuIGAke3RpbWVzdGFtcH06IEFsdGEgbW90aXZhY2nDs24gZGV0ZWN0YWRhJHtzdWJqZWN0ID8gYCBoYWNpYSAke3N1YmplY3R9YCA6ICcnfS4gTW9tZW50byBpZGVhbCBwYXJhIG9iamV0aXZvcyBhbWJpY2lvc29zLmBcbiAgICAgIFxuICAgICAgY2FzZSBFbW90aW9uVHlwZS5DT05GVVNFRDpcbiAgICAgICAgcmV0dXJuIGAke3RpbWVzdGFtcH06IENvbmZ1c2nDs24gaWRlbnRpZmljYWRhJHtzdWJqZWN0ID8gYCBlbiAke3N1YmplY3R9YCA6ICcnfS4gTmVjZXNpdGEgZXhwbGljYWNpb25lcyBtw6FzIGNsYXJhcy5gXG4gICAgICBcbiAgICAgIGNhc2UgRW1vdGlvblR5cGUuUFJPVUQ6XG4gICAgICAgIHJldHVybiBgJHt0aW1lc3RhbXB9OiBPcmd1bGxvIHBvciBsb2dybyR7c3ViamVjdCA/IGAgZW4gJHtzdWJqZWN0fWAgOiAnJ30uIFJlZm9yemFyIGF1dG9jb25maWFuemEuYFxuICAgICAgXG4gICAgICBjYXNlIEVtb3Rpb25UeXBlLkFOWElPVVM6XG4gICAgICAgIHJldHVybiBgJHt0aW1lc3RhbXB9OiBBbnNpZWRhZCBkZXRlY3RhZGEuIEltcGxlbWVudGFyIHTDqWNuaWNhcyBkZSByZWxhamFjacOzbiB5IGFwb3lvLmBcbiAgICAgIFxuICAgICAgZGVmYXVsdDpcbiAgICAgICAgaWYgKGFuYWx5c2lzLmludGVuc2l0eSA9PT0gJ2hpZ2gnKSB7XG4gICAgICAgICAgcmV0dXJuIGAke3RpbWVzdGFtcH06IEVtb2Npw7NuIGludGVuc2EgKCR7ZW1vdGlvbn0pIGRldGVjdGFkYS4gTW9uaXRvcmVhciBlc3RhZG8gZW1vY2lvbmFsLmBcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbnVsbFxuICAgIH1cbiAgfVxuICBcbiAgcHJpdmF0ZSBzdGF0aWMgdXBkYXRlUmVjdXJyaW5nVG9waWNzKG1lbW9yeTogQ29udmVyc2F0aW9uTWVtb3J5LCB0dXJuOiBDb252ZXJzYXRpb25UdXJuKTogdm9pZCB7XG4gICAgdHVybi50b3BpY3MuZm9yRWFjaCh0b3BpYyA9PiB7XG4gICAgICBjb25zdCBleGlzdGluZyA9IG1lbW9yeS5yZWN1cnJpbmdUb3BpY3MuZmluZChydCA9PiBydC50b3BpYyA9PT0gdG9waWMpXG4gICAgICBcbiAgICAgIGlmIChleGlzdGluZykge1xuICAgICAgICBleGlzdGluZy5mcmVxdWVuY3krK1xuICAgICAgICBleGlzdGluZy5sYXN0TWVudGlvbmVkID0gbmV3IERhdGUoKVxuICAgICAgICBcbiAgICAgICAgLy8gTWFyY2FyIGNvbW8gcmVzdWVsdG8gc2kgaGF5IGluZGljYWRvcmVzIGRlIGxvZ3JvXG4gICAgICAgIGlmICh0dXJuLmNvbnRleHQ/LmFjaGlldmVtZW50KSB7XG4gICAgICAgICAgZXhpc3RpbmcucmVzb2x2ZWQgPSB0cnVlXG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIG1lbW9yeS5yZWN1cnJpbmdUb3BpY3MucHVzaCh7XG4gICAgICAgICAgdG9waWMsXG4gICAgICAgICAgZnJlcXVlbmN5OiAxLFxuICAgICAgICAgIGxhc3RNZW50aW9uZWQ6IG5ldyBEYXRlKCksXG4gICAgICAgICAgcmVzb2x2ZWQ6IGZhbHNlXG4gICAgICAgIH0pXG4gICAgICB9XG4gICAgfSlcbiAgfVxuICBcbiAgcHJpdmF0ZSBzdGF0aWMgdXBkYXRlUHJvZ3Jlc3NUcmFja2luZyhtZW1vcnk6IENvbnZlcnNhdGlvbk1lbW9yeSwgdHVybjogQ29udmVyc2F0aW9uVHVybik6IHZvaWQge1xuICAgIC8vIERldGVjdGFyIG9iamV0aXZvcy9wbGFuZXMgbWVuY2lvbmFkb3NcbiAgICBjb25zdCBsb3dlck1lc3NhZ2UgPSB0dXJuLnVzZXJNZXNzYWdlLnRvTG93ZXJDYXNlKClcbiAgICBcbiAgICBpZiAobG93ZXJNZXNzYWdlLmluY2x1ZGVzKCdvYmpldGl2bycpIHx8IGxvd2VyTWVzc2FnZS5pbmNsdWRlcygnbWV0YScpKSB7XG4gICAgICBtZW1vcnkucHJvZ3Jlc3NUcmFja2luZy5nb2Fsc0Rpc2N1c3NlZC5wdXNoKHR1cm4udXNlck1lc3NhZ2UpXG4gICAgfVxuICAgIFxuICAgIGlmIChsb3dlck1lc3NhZ2UuaW5jbHVkZXMoJ3BsYW4nKSB8fCBsb3dlck1lc3NhZ2UuaW5jbHVkZXMoJ3BsYW5pZmljYXInKSkge1xuICAgICAgbWVtb3J5LnByb2dyZXNzVHJhY2tpbmcucGxhbnNNYWRlLnB1c2godHVybi51c2VyTWVzc2FnZSlcbiAgICB9XG4gICAgXG4gICAgaWYgKHR1cm4uY29udGV4dD8uYWNoaWV2ZW1lbnQpIHtcbiAgICAgIG1lbW9yeS5wcm9ncmVzc1RyYWNraW5nLmNvbXBsZXRlZFRhc2tzLnB1c2godHVybi51c2VyTWVzc2FnZSlcbiAgICB9XG4gICAgXG4gICAgLy8gQWdyZWdhciBzZWd1aW1pZW50b3Mgc2kgZXMgbmVjZXNhcmlvXG4gICAgaWYgKHR1cm4uY29udGV4dD8ubmVlZHNGb2xsb3dVcCkge1xuICAgICAgY29uc3QgZm9sbG93VXBEYXRlID0gbmV3IERhdGUoKVxuICAgICAgZm9sbG93VXBEYXRlLnNldERhdGUoZm9sbG93VXBEYXRlLmdldERhdGUoKSArIDMpIC8vIFNlZ3VpbWllbnRvIGVuIDMgZMOtYXNcbiAgICAgIFxuICAgICAgbWVtb3J5LnByb2dyZXNzVHJhY2tpbmcucGVuZGluZ0ZvbGxvd1Vwcy5wdXNoKHtcbiAgICAgICAgdGFzazogdHVybi51c2VyTWVzc2FnZSxcbiAgICAgICAgZHVlRGF0ZTogZm9sbG93VXBEYXRlLFxuICAgICAgICByZW1pbmRlcjogdHJ1ZVxuICAgICAgfSlcbiAgICB9XG4gIH1cbn0iXSwibmFtZXMiOlsiRW1vdGlvbkFuYWx5emVyIiwiRW1vdGlvblR5cGUiLCJDb252ZXJzYXRpb25NZW1vcnlNYW5hZ2VyIiwibWVtb3JpZXMiLCJNYXAiLCJnZXRNZW1vcnkiLCJ1c2VySWQiLCJzZXNzaW9uSWQiLCJtZW1vcnlLZXkiLCJoYXMiLCJzZXQiLCJjcmVhdGVOZXdNZW1vcnkiLCJnZXQiLCJzYXZlQ29udmVyc2F0aW9uVHVybiIsInVzZXJNZXNzYWdlIiwic2FyYVJlc3BvbnNlIiwibW9kZSIsImludGVudCIsIm1lbW9yeSIsInR1cm4iLCJpZCIsIkRhdGUiLCJub3ciLCJNYXRoIiwicmFuZG9tIiwidG9TdHJpbmciLCJzdWJzdHIiLCJ0aW1lc3RhbXAiLCJ0b3BpY3MiLCJleHRyYWN0VG9waWNzIiwiZW1vdGlvbnMiLCJkZXRlY3RFbW90aW9ucyIsInN1YmplY3QiLCJleHRyYWN0U3ViamVjdEZyb21NZXNzYWdlIiwicHJldmlvdXNFbW90aW9uIiwiZW1vdGlvbmFsUHJvZmlsZSIsImN1cnJlbnRNb29kIiwiY29udGV4dCIsImFuYWx5emVDb250ZXh0IiwiY29udmVyc2F0aW9uSGlzdG9yeSIsInB1c2giLCJ0b3RhbFR1cm5zIiwibGFzdEFjdGl2aXR5IiwibGVuZ3RoIiwic2xpY2UiLCJ1cGRhdGVQcmVmZXJlbmNlcyIsInVwZGF0ZUVtb3Rpb25hbFByb2ZpbGUiLCJ1cGRhdGVSZWN1cnJpbmdUb3BpY3MiLCJ1cGRhdGVQcm9ncmVzc1RyYWNraW5nIiwiZ2VuZXJhdGVDb250ZXh0dWFsU3VtbWFyeSIsInJlY2VudFR1cm5zIiwic3VtbWFyeSIsImRheXNTaW5jZUxhc3RDaGF0IiwiZmxvb3IiLCJnZXRUaW1lIiwiaW1wb3J0YW50VG9waWNzIiwicmVjdXJyaW5nVG9waWNzIiwiZmlsdGVyIiwidCIsImZyZXF1ZW5jeSIsInJlc29sdmVkIiwibWFwIiwidG9waWMiLCJqb2luIiwibW90aXZhdGlvbkxldmVsIiwicGVuZGluZ0ZvbGxvd1VwcyIsInByb2dyZXNzVHJhY2tpbmciLCJmIiwiZHVlRGF0ZSIsInByZWZlcmVuY2VzIiwiZGlmZmljdWx0U3ViamVjdHMiLCJnZXRQZXJzb25hbGl6ZWRTdWdnZXN0aW9ucyIsInN1Z2dlc3Rpb25zIiwidW5yZXNvbHZlZFRvcGljcyIsImZvckVhY2giLCJmb2xsb3dVcCIsInRhc2siLCJwcmVmZXJyZWRNb2RlIiwibmVlZHNGb2xsb3dVcCIsIm92ZXJkdWVGb2xsb3dVcHMiLCJzdGFsZVRvcHMiLCJsYXN0TWVudGlvbmVkIiwibG93TW90aXZhdGlvbiIsInN0YXJ0ZWRBdCIsImZhdm9yaXRlU3ViamVjdHMiLCJzdHVkeVRpbWVQcmVmZXJlbmNlIiwiY29tbXVuaWNhdGlvblN0eWxlIiwiTkVVVFJBTCIsInJlY2VudEVtb3Rpb25zIiwiZW1vdGlvbmFsVHJlbmRzIiwiZG9taW5hbnQiLCJsYXN0V2VlayIsImZydXN0cmF0aW9uQXJlYXMiLCJhY2hpZXZlbWVudEFyZWFzIiwibGFzdEVuY291cmFnZW1lbnQiLCJlbW90aW9uYWxJbnNpZ2h0cyIsImdvYWxzRGlzY3Vzc2VkIiwicGxhbnNNYWRlIiwiY29tcGxldGVkVGFza3MiLCJtZXNzYWdlIiwibG93ZXJNZXNzYWdlIiwidG9Mb3dlckNhc2UiLCJhY2FkZW1pY1RvcGljcyIsImluY2x1ZGVzIiwic3ViamVjdHMiLCJmaW5kIiwiYW5hbHl6ZUVtb3Rpb25zIiwiZGV0ZWN0ZWRTdWJqZWN0IiwiZGlmZmljdWx0eSIsImFjaGlldmVtZW50IiwiZGV0ZWN0ZWQiLCJlbW90aW9uIiwicHJpbWFyeSIsInVuc2hpZnQiLCJlbW90aW9uQ291bnRzIiwicmVkdWNlIiwiYWNjIiwiZW0iLCJkb21pbmFudEVtb3Rpb24iLCJPYmplY3QiLCJlbnRyaWVzIiwic29ydCIsImEiLCJiIiwibW90aXZhdGlvbkFkanVzdG1lbnQiLCJnZXRNb3RpdmF0aW9uQWRqdXN0bWVudCIsImludGVuc2l0eSIsIm1heCIsIm1pbiIsIkZSVVNUUkFURUQiLCJPVkVSV0hFTE1FRCIsIlNUUkVTU0VEIiwiUFJPVUQiLCJDT05GSURFTlQiLCJFWENJVEVEIiwiaW5zaWdodCIsImdlbmVyYXRlRW1vdGlvbmFsSW5zaWdodCIsImJhc2VBZGp1c3RtZW50cyIsIk1PVElWQVRFRCIsIkhPUEVGVUwiLCJIQVBQWSIsIkdSQVRFRlVMIiwiUkVMSUVWRUQiLCJDVVJJT1VTIiwiQ09ORlVTRUQiLCJCT1JFRCIsIkRJU0FQUE9JTlRFRCIsIlNBRCIsIkFOWElPVVMiLCJBTkdSWSIsIkZFQVIiLCJTVVJQUklTRSIsImJhc2VBZGp1c3RtZW50IiwiaW50ZW5zaXR5TXVsdGlwbGllciIsImFuYWx5c2lzIiwidG9Mb2NhbGVEYXRlU3RyaW5nIiwiZXhpc3RpbmciLCJydCIsImZvbGxvd1VwRGF0ZSIsInNldERhdGUiLCJnZXREYXRlIiwicmVtaW5kZXIiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/conversation-memory.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/emotion-analyzer.ts":
/*!*************************************!*\
  !*** ./src/lib/emotion-analyzer.ts ***!
  \*************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   EmotionAnalyzer: () => (/* binding */ EmotionAnalyzer),\n/* harmony export */   EmotionType: () => (/* binding */ EmotionType)\n/* harmony export */ });\n// Sistema Avanzado de Análisis Emocional para Sara\n// Detecta emociones complejas en los mensajes de estudiantes para respuestas más empáticas\nvar EmotionType = /*#__PURE__*/ function(EmotionType) {\n    // Emociones Básicas\n    EmotionType[\"HAPPY\"] = \"happy\";\n    EmotionType[\"SAD\"] = \"sad\";\n    EmotionType[\"ANGRY\"] = \"angry\";\n    EmotionType[\"FEAR\"] = \"fear\";\n    EmotionType[\"SURPRISE\"] = \"surprise\";\n    EmotionType[\"NEUTRAL\"] = \"neutral\";\n    // Emociones Académicas Específicas\n    EmotionType[\"FRUSTRATED\"] = \"frustrated\";\n    EmotionType[\"MOTIVATED\"] = \"motivated\";\n    EmotionType[\"CONFUSED\"] = \"confused\";\n    EmotionType[\"CONFIDENT\"] = \"confident\";\n    EmotionType[\"OVERWHELMED\"] = \"overwhelmed\";\n    EmotionType[\"CURIOUS\"] = \"curious\";\n    EmotionType[\"PROUD\"] = \"proud\";\n    EmotionType[\"DISAPPOINTED\"] = \"disappointed\";\n    EmotionType[\"ANXIOUS\"] = \"anxious\";\n    EmotionType[\"EXCITED\"] = \"excited\";\n    EmotionType[\"BORED\"] = \"bored\";\n    EmotionType[\"HOPEFUL\"] = \"hopeful\";\n    EmotionType[\"STRESSED\"] = \"stressed\";\n    EmotionType[\"RELIEVED\"] = \"relieved\";\n    EmotionType[\"GRATEFUL\"] = \"grateful\";\n    return EmotionType;\n}({});\nclass EmotionAnalyzer {\n    static{\n        this.EMOTION_PATTERNS = {\n            [\"frustrated\"]: {\n                keywords: [\n                    'frustrado',\n                    'enojado',\n                    'molesto',\n                    'hartado',\n                    'furioso',\n                    'irritado'\n                ],\n                phrases: [\n                    /no\\s+puedo\\s+(más|hacer|lograr)/i,\n                    /es\\s+(muy\\s+|súper\\s+)?difícil/i,\n                    /me\\s+(frustra|molesta|enoja)/i,\n                    /por\\s+qué\\s+no\\s+(puedo|logro|entiendo)/i,\n                    /esto\\s+(no\\s+sirve|es\\s+imposible)/i,\n                    /ya\\s+(intenté|probé)\\s+todo/i\n                ],\n                context: [\n                    'difícil',\n                    'problema',\n                    'falla',\n                    'error',\n                    'imposible'\n                ],\n                intensity_multipliers: {\n                    'muy': 1.3,\n                    'súper': 1.5,\n                    'demasiado': 1.4,\n                    'completamente': 1.6\n                },\n                confidence_base: 0.85\n            },\n            [\"motivated\"]: {\n                keywords: [\n                    'motivado',\n                    'emocionado',\n                    'entusiasmado',\n                    'inspirado',\n                    'determinado'\n                ],\n                phrases: [\n                    /quiero\\s+(lograr|conseguir|aprender)/i,\n                    /estoy\\s+(listo|preparado|emocionado)/i,\n                    /me\\s+(gusta|encanta|motiva)/i,\n                    /vamos\\s+(a\\s+)?hacerlo/i,\n                    /estoy\\s+decidido/i,\n                    /tengo\\s+ganas\\s+de/i\n                ],\n                context: [\n                    'objetivo',\n                    'meta',\n                    'plan',\n                    'futuro',\n                    'logro'\n                ],\n                intensity_multipliers: {\n                    'muy': 1.2,\n                    'súper': 1.4,\n                    'realmente': 1.3\n                },\n                confidence_base: 0.8\n            },\n            [\"confused\"]: {\n                keywords: [\n                    'confundido',\n                    'perdido',\n                    'desorientado',\n                    'enredado'\n                ],\n                phrases: [\n                    /no\\s+(entiendo|comprendo|capto)/i,\n                    /estoy\\s+(confundido|perdido)/i,\n                    /no\\s+sé\\s+(cómo|qué|por\\s+qué)/i,\n                    /me\\s+(confunde|desorienta)/i,\n                    /no\\s+me\\s+queda\\s+claro/i,\n                    /podrías\\s+explicar/i\n                ],\n                context: [\n                    'explicación',\n                    'ayuda',\n                    'clarificar',\n                    'concepto',\n                    'dudas'\n                ],\n                intensity_multipliers: {\n                    'completamente': 1.5,\n                    'totalmente': 1.4,\n                    'muy': 1.2\n                },\n                confidence_base: 0.9\n            },\n            [\"overwhelmed\"]: {\n                keywords: [\n                    'abrumado',\n                    'sobrecargado',\n                    'saturado',\n                    'agobiado'\n                ],\n                phrases: [\n                    /es\\s+demasiado/i,\n                    /no\\s+puedo\\s+con\\s+todo/i,\n                    /me\\s+(abruma|agobia|satura)/i,\n                    /son\\s+muchas\\s+cosas/i,\n                    /no\\s+tengo\\s+tiempo/i,\n                    /me\\s+siento\\s+(perdido|desbordado)/i\n                ],\n                context: [\n                    'tiempo',\n                    'tareas',\n                    'exámenes',\n                    'muchos',\n                    'presión'\n                ],\n                intensity_multipliers: {\n                    'completamente': 1.6,\n                    'totalmente': 1.5,\n                    'muy': 1.3\n                },\n                confidence_base: 0.88\n            },\n            [\"anxious\"]: {\n                keywords: [\n                    'ansioso',\n                    'nervioso',\n                    'preocupado',\n                    'estresado',\n                    'tenso',\n                    'ansiedad'\n                ],\n                phrases: [\n                    /me\\s+(preocupa|da\\s+ansiedad|pone\\s+nervioso)/i,\n                    /tengo\\s+(miedo|temor)\\s+de/i,\n                    /y\\s+si\\s+(no\\s+puedo|fallo|salgo\\s+mal)/i,\n                    /me\\s+da\\s+(estrés|pánico|ansiedad)/i,\n                    /estoy\\s+(nervioso|ansioso)/i,\n                    /no\\s+sé\\s+si\\s+podré/i,\n                    /(mucha|bastante)\\s+ansiedad/i,\n                    /ansiedad\\s+(por|de|al)/i\n                ],\n                context: [\n                    'examen',\n                    'evaluación',\n                    'futuro',\n                    'resultado',\n                    'fallo',\n                    'público',\n                    'hablar'\n                ],\n                intensity_multipliers: {\n                    'muy': 1.3,\n                    'mucha': 1.4,\n                    'súper': 1.5,\n                    'demasiado': 1.4,\n                    'bastante': 1.2\n                },\n                confidence_base: 0.88\n            },\n            [\"proud\"]: {\n                keywords: [\n                    'orgulloso',\n                    'satisfecho',\n                    'contento',\n                    'feliz'\n                ],\n                phrases: [\n                    /lo\\s+(logré|conseguí|hice)/i,\n                    /estoy\\s+(orgulloso|satisfecho|contento)/i,\n                    /me\\s+siento\\s+(bien|genial|increíble)/i,\n                    /pude\\s+hacerlo/i,\n                    /lo\\s+entendí/i,\n                    /funcionó/i,\n                    /logré\\s+(terminar|completar|hacer)/i,\n                    /(terminé|completé)\\s+(el|la|mi)/i,\n                    /pude\\s+(terminar|completar)/i\n                ],\n                context: [\n                    'logro',\n                    'éxito',\n                    'resultado',\n                    'completé',\n                    'terminé',\n                    'examen',\n                    'proyecto',\n                    'tarea'\n                ],\n                intensity_multipliers: {\n                    'muy': 1.2,\n                    'súper': 1.4,\n                    'realmente': 1.3,\n                    'finalmente': 1.3\n                },\n                confidence_base: 0.85\n            },\n            [\"disappointed\"]: {\n                keywords: [\n                    'decepcionado',\n                    'triste',\n                    'desilusionado',\n                    'desanimado'\n                ],\n                phrases: [\n                    /no\\s+salió\\s+como\\s+esperaba/i,\n                    /me\\s+(decepciona|entristece|desanima)/i,\n                    /esperaba\\s+(más|mejor)/i,\n                    /no\\s+fue\\s+suficiente/i,\n                    /qué\\s+mal/i,\n                    /no\\s+funcionó/i\n                ],\n                context: [\n                    'resultado',\n                    'calificación',\n                    'expectativa',\n                    'fallo',\n                    'error'\n                ],\n                intensity_multipliers: {\n                    'muy': 1.3,\n                    'realmente': 1.4,\n                    'bastante': 1.2\n                },\n                confidence_base: 0.8\n            },\n            [\"excited\"]: {\n                keywords: [\n                    'emocionado',\n                    'entusiasmado',\n                    'ilusionado',\n                    'alegre'\n                ],\n                phrases: [\n                    /qué\\s+(genial|increíble|fantástico)/i,\n                    /me\\s+(emociona|ilusiona|alegra)/i,\n                    /estoy\\s+(emocionado|entusiasmado)/i,\n                    /no\\s+puedo\\s+esperar/i,\n                    /será\\s+(genial|fantástico)/i,\n                    /me\\s+encanta/i\n                ],\n                context: [\n                    'proyecto',\n                    'nuevo',\n                    'oportunidad',\n                    'futuro',\n                    'experiencia'\n                ],\n                intensity_multipliers: {\n                    'muy': 1.2,\n                    'súper': 1.4,\n                    'realmente': 1.3\n                },\n                confidence_base: 0.83\n            },\n            [\"bored\"]: {\n                keywords: [\n                    'aburrido',\n                    'hastiado',\n                    'cansado',\n                    'tedioso'\n                ],\n                phrases: [\n                    /me\\s+(aburre|hastía|cansa)/i,\n                    /es\\s+(aburrido|tedioso|repetitivo)/i,\n                    /no\\s+me\\s+interesa/i,\n                    /qué\\s+(aburrido|tedioso)/i,\n                    /siempre\\s+lo\\s+mismo/i,\n                    /no\\s+es\\s+divertido/i\n                ],\n                context: [\n                    'materia',\n                    'tema',\n                    'repetitivo',\n                    'siempre',\n                    'mismo'\n                ],\n                intensity_multipliers: {\n                    'muy': 1.2,\n                    'súper': 1.4,\n                    'demasiado': 1.3\n                },\n                confidence_base: 0.78\n            },\n            [\"hopeful\"]: {\n                keywords: [\n                    'esperanzado',\n                    'optimista',\n                    'confiado',\n                    'positivo'\n                ],\n                phrases: [\n                    /espero\\s+(que|poder)/i,\n                    /tengo\\s+(esperanza|fe|confianza)/i,\n                    /creo\\s+que\\s+(puedo|podré)/i,\n                    /será\\s+posible/i,\n                    /confío\\s+en\\s+que/i,\n                    /estoy\\s+optimista/i\n                ],\n                context: [\n                    'futuro',\n                    'posibilidad',\n                    'mejora',\n                    'cambio',\n                    'oportunidad'\n                ],\n                intensity_multipliers: {\n                    'muy': 1.2,\n                    'realmente': 1.3,\n                    'bastante': 1.1\n                },\n                confidence_base: 0.75\n            },\n            [\"stressed\"]: {\n                keywords: [\n                    'estresado',\n                    'presionado',\n                    'agobiado',\n                    'tensionado'\n                ],\n                phrases: [\n                    /me\\s+(estresa|presiona|agobia)/i,\n                    /siento\\s+(presión|tensión|estrés)/i,\n                    /no\\s+doy\\s+abasto/i,\n                    /es\\s+mucha\\s+presión/i,\n                    /me\\s+siento\\s+presionado/i,\n                    /no\\s+puedo\\s+relajarme/i\n                ],\n                context: [\n                    'tiempo',\n                    'presión',\n                    'deadlines',\n                    'exámenes',\n                    'múltiple'\n                ],\n                intensity_multipliers: {\n                    'muy': 1.3,\n                    'demasiado': 1.4,\n                    'extremadamente': 1.6\n                },\n                confidence_base: 0.86\n            },\n            [\"grateful\"]: {\n                keywords: [\n                    'agradecido',\n                    'gracias',\n                    'reconocido',\n                    'apreciado'\n                ],\n                phrases: [\n                    /muchas\\s+gracias/i,\n                    /(te\\s+)?agradezco/i,\n                    /me\\s+(ayudas|ayudaste)\\s+mucho/i,\n                    /eres\\s+(genial|increíble|muy\\s+útil)/i,\n                    /gracias\\s+por/i,\n                    /lo\\s+aprecio/i\n                ],\n                context: [\n                    'ayuda',\n                    'apoyo',\n                    'explicación',\n                    'tiempo',\n                    'paciencia'\n                ],\n                intensity_multipliers: {\n                    'muchísimas': 1.4,\n                    'realmente': 1.3,\n                    'muy': 1.2\n                },\n                confidence_base: 0.9\n            },\n            // Emociones básicas con patrones simples\n            [\"happy\"]: {\n                keywords: [\n                    'feliz',\n                    'alegre',\n                    'contento',\n                    'bien'\n                ],\n                phrases: [\n                    /me\\s+siento\\s+(feliz|alegre|bien)/i,\n                    /estoy\\s+(feliz|contento)/i\n                ],\n                context: [\n                    'logro',\n                    'éxito',\n                    'bueno'\n                ],\n                intensity_multipliers: {\n                    'muy': 1.2\n                },\n                confidence_base: 0.7\n            },\n            [\"sad\"]: {\n                keywords: [\n                    'triste',\n                    'melancólico',\n                    'deprimido'\n                ],\n                phrases: [\n                    /me\\s+siento\\s+triste/i,\n                    /estoy\\s+triste/i\n                ],\n                context: [\n                    'mal',\n                    'fallo',\n                    'pérdida'\n                ],\n                intensity_multipliers: {\n                    'muy': 1.3\n                },\n                confidence_base: 0.75\n            },\n            [\"angry\"]: {\n                keywords: [\n                    'enojado',\n                    'furioso',\n                    'molesto'\n                ],\n                phrases: [\n                    /me\\s+enoja/i,\n                    /estoy\\s+furioso/i\n                ],\n                context: [\n                    'problema',\n                    'injusto',\n                    'mal'\n                ],\n                intensity_multipliers: {\n                    'muy': 1.4\n                },\n                confidence_base: 0.8\n            },\n            [\"fear\"]: {\n                keywords: [\n                    'miedo',\n                    'temor',\n                    'asustado'\n                ],\n                phrases: [\n                    /tengo\\s+miedo/i,\n                    /me\\s+asusta/i\n                ],\n                context: [\n                    'peligro',\n                    'amenaza',\n                    'futuro'\n                ],\n                intensity_multipliers: {\n                    'mucho': 1.3\n                },\n                confidence_base: 0.8\n            },\n            [\"surprise\"]: {\n                keywords: [\n                    'sorprendido',\n                    'asombrado',\n                    'impresionado'\n                ],\n                phrases: [\n                    /qué\\s+sorpresa/i,\n                    /me\\s+sorprende/i\n                ],\n                context: [\n                    'inesperado',\n                    'nuevo',\n                    'diferente'\n                ],\n                intensity_multipliers: {\n                    'muy': 1.2\n                },\n                confidence_base: 0.7\n            },\n            [\"confident\"]: {\n                keywords: [\n                    'seguro',\n                    'confiado',\n                    'capaz'\n                ],\n                phrases: [\n                    /estoy\\s+seguro/i,\n                    /puedo\\s+hacerlo/i\n                ],\n                context: [\n                    'capacidad',\n                    'habilidad',\n                    'logro'\n                ],\n                intensity_multipliers: {\n                    'muy': 1.2\n                },\n                confidence_base: 0.8\n            },\n            [\"curious\"]: {\n                keywords: [\n                    'curioso',\n                    'interesado',\n                    'intrigado'\n                ],\n                phrases: [\n                    /me\\s+da\\s+curiosidad/i,\n                    /quiero\\s+saber/i\n                ],\n                context: [\n                    'pregunta',\n                    'explorar',\n                    'descubrir'\n                ],\n                intensity_multipliers: {\n                    'muy': 1.2\n                },\n                confidence_base: 0.75\n            },\n            [\"relieved\"]: {\n                keywords: [\n                    'aliviado',\n                    'tranquilo',\n                    'relajado'\n                ],\n                phrases: [\n                    /qué\\s+alivio/i,\n                    /me\\s+tranquiliza/i\n                ],\n                context: [\n                    'problema resuelto',\n                    'éxito',\n                    'terminado'\n                ],\n                intensity_multipliers: {\n                    'muy': 1.2\n                },\n                confidence_base: 0.8\n            },\n            [\"neutral\"]: {\n                keywords: [\n                    'normal',\n                    'regular',\n                    'común'\n                ],\n                phrases: [\n                    /está\\s+bien/i,\n                    /normal/i\n                ],\n                context: [],\n                intensity_multipliers: {},\n                confidence_base: 0.5\n            }\n        };\n    }\n    /**\n   * Analiza las emociones en un mensaje de texto\n   */ static analyzeEmotions(message, context) {\n        const lowerMessage = message.toLowerCase();\n        const emotionScores = [];\n        // Analizar cada patrón emocional\n        for (const [emotion, pattern] of Object.entries(this.EMOTION_PATTERNS)){\n            const score = this.calculateEmotionScore(lowerMessage, pattern, message);\n            if (score > 0.3) {\n                emotionScores.push({\n                    emotion: emotion,\n                    score,\n                    indicators: this.getMatchedIndicators(lowerMessage, pattern, message)\n                });\n            }\n        }\n        // Ordenar por puntuación\n        emotionScores.sort((a, b)=>b.score - a.score);\n        // Determinar emoción principal y secundaria\n        const primary = emotionScores[0]?.emotion || \"neutral\";\n        const secondary = emotionScores.length > 1 && emotionScores[1].score > 0.5 ? emotionScores[1].emotion : undefined;\n        const confidence = emotionScores[0]?.score || 0.5;\n        const indicators = emotionScores[0]?.indicators || [];\n        return {\n            primary,\n            secondary,\n            confidence: Math.min(confidence, 0.95),\n            intensity: this.calculateIntensity(lowerMessage, confidence),\n            indicators,\n            context: this.analyzeEmotionalContext(lowerMessage, context),\n            suggestedResponse: this.getSuggestedResponseType(primary, confidence)\n        };\n    }\n    /**\n   * Calcula la puntuación de una emoción específica\n   */ static calculateEmotionScore(lowerMessage, pattern, originalMessage) {\n        let score = 0;\n        let matches = 0;\n        // Buscar palabras clave\n        for (const keyword of pattern.keywords){\n            if (lowerMessage.includes(keyword)) {\n                score += 0.3;\n                matches++;\n            }\n        }\n        // Buscar frases específicas (mayor peso)\n        for (const phrase of pattern.phrases){\n            if (phrase.test(originalMessage)) {\n                score += 0.5;\n                matches++;\n            }\n        }\n        // Buscar contexto de apoyo\n        for (const contextWord of pattern.context){\n            if (lowerMessage.includes(contextWord)) {\n                score += 0.1;\n            }\n        }\n        // Aplicar multiplicadores de intensidad\n        for (const [intensifier, multiplier] of Object.entries(pattern.intensity_multipliers)){\n            if (lowerMessage.includes(intensifier)) {\n                score *= multiplier;\n                break;\n            }\n        }\n        // Ajustar por confianza base del patrón\n        score *= pattern.confidence_base;\n        // Bonificación por múltiples coincidencias\n        if (matches > 1) {\n            score *= 1.2;\n        }\n        return Math.min(score, 1.0) // Cap en 1.0\n        ;\n    }\n    /**\n   * Obtiene los indicadores que coincidieron\n   */ static getMatchedIndicators(lowerMessage, pattern, originalMessage) {\n        const indicators = [];\n        // Palabras clave encontradas\n        pattern.keywords.forEach((keyword)=>{\n            if (lowerMessage.includes(keyword)) {\n                indicators.push(`keyword: ${keyword}`);\n            }\n        });\n        // Frases encontradas\n        pattern.phrases.forEach((phrase, index)=>{\n            if (phrase.test(originalMessage)) {\n                indicators.push(`phrase_pattern_${index}`);\n            }\n        });\n        return indicators;\n    }\n    /**\n   * Calcula la intensidad emocional\n   */ static calculateIntensity(message, confidence) {\n        const intensifiers = [\n            'muy',\n            'súper',\n            'extremadamente',\n            'completamente',\n            'totalmente',\n            'demasiado'\n        ];\n        const hasIntensifier = intensifiers.some((word)=>message.includes(word));\n        if (confidence > 0.8 || hasIntensifier) return 'high';\n        if (confidence > 0.6) return 'medium';\n        return 'low';\n    }\n    /**\n   * Analiza el contexto emocional\n   */ static analyzeEmotionalContext(message, providedContext) {\n        const context = {};\n        // Detectar si es académico\n        const academicKeywords = [\n            'examen',\n            'tarea',\n            'estudio',\n            'clase',\n            'profesor',\n            'materia',\n            'universidad',\n            'colegio'\n        ];\n        context.academic = academicKeywords.some((word)=>message.includes(word));\n        // Detectar si es personal\n        const personalKeywords = [\n            'familia',\n            'amigos',\n            'casa',\n            'personal',\n            'vida',\n            'sentimientos'\n        ];\n        context.personal = personalKeywords.some((word)=>message.includes(word));\n        // Detectar temporalidad\n        if (/ayer|antes|pasado|era|fue/.test(message)) context.temporal = 'past';\n        else if (/mañana|próximo|futuro|después|seré/.test(message)) context.temporal = 'future';\n        else context.temporal = 'present';\n        // Usar contexto proporcionado\n        if (providedContext?.subject) {\n            context.subject = providedContext.subject;\n        }\n        return context;\n    }\n    /**\n   * Sugiere el tipo de respuesta más apropiado\n   */ static getSuggestedResponseType(emotion, confidence) {\n        const responseMap = {\n            [\"frustrated\"]: 'supportive',\n            [\"overwhelmed\"]: 'supportive',\n            [\"anxious\"]: 'empathetic',\n            [\"stressed\"]: 'solution_focused',\n            [\"confused\"]: 'professional',\n            [\"disappointed\"]: 'empathetic',\n            [\"sad\"]: 'empathetic',\n            [\"angry\"]: 'supportive',\n            [\"fear\"]: 'supportive',\n            [\"motivated\"]: 'encouraging',\n            [\"excited\"]: 'encouraging',\n            [\"proud\"]: 'encouraging',\n            [\"confident\"]: 'motivational',\n            [\"hopeful\"]: 'motivational',\n            [\"curious\"]: 'professional',\n            [\"grateful\"]: 'encouraging',\n            [\"relieved\"]: 'encouraging',\n            [\"bored\"]: 'motivational',\n            [\"happy\"]: 'encouraging',\n            [\"surprise\"]: 'professional',\n            [\"neutral\"]: 'professional'\n        };\n        return responseMap[emotion] || 'professional';\n    }\n    /**\n   * Genera un resumen textual del análisis emocional\n   */ static generateEmotionSummary(analysis) {\n        const emotionNames = {\n            [\"frustrated\"]: 'frustrado',\n            [\"motivated\"]: 'motivado',\n            [\"confused\"]: 'confundido',\n            [\"confident\"]: 'confiado',\n            [\"overwhelmed\"]: 'abrumado',\n            [\"curious\"]: 'curioso',\n            [\"proud\"]: 'orgulloso',\n            [\"disappointed\"]: 'decepcionado',\n            [\"anxious\"]: 'ansioso',\n            [\"excited\"]: 'emocionado',\n            [\"bored\"]: 'aburrido',\n            [\"hopeful\"]: 'esperanzado',\n            [\"stressed\"]: 'estresado',\n            [\"relieved\"]: 'aliviado',\n            [\"grateful\"]: 'agradecido',\n            [\"happy\"]: 'feliz',\n            [\"sad\"]: 'triste',\n            [\"angry\"]: 'enojado',\n            [\"fear\"]: 'temeroso',\n            [\"surprise\"]: 'sorprendido',\n            [\"neutral\"]: 'neutral'\n        };\n        let summary = `El estudiante se siente ${emotionNames[analysis.primary]} (confianza: ${(analysis.confidence * 100).toFixed(0)}%, intensidad: ${analysis.intensity})`;\n        if (analysis.secondary) {\n            summary += ` con matices de ${emotionNames[analysis.secondary]}`;\n        }\n        if (analysis.context.subject) {\n            summary += ` en relación a ${analysis.context.subject}`;\n        }\n        return summary;\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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RDtRQUVBLE9BQU9LO0lBQ1Q7QUFDRiIsInNvdXJjZXMiOlsiL1VzZXJzL3JvZHJpZ29kaWJlcm5hcmRvMzNnbWFpbC5jb20vRG9jdW1lbnRzL0FwcCBEZXZlbG9wbWVudCBQcm95ZWN0cy9JbnRlbGxlZ28gUGxhdGZvcm0vc3JjL2xpYi9lbW90aW9uLWFuYWx5emVyLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIFNpc3RlbWEgQXZhbnphZG8gZGUgQW7DoWxpc2lzIEVtb2Npb25hbCBwYXJhIFNhcmFcbi8vIERldGVjdGEgZW1vY2lvbmVzIGNvbXBsZWphcyBlbiBsb3MgbWVuc2FqZXMgZGUgZXN0dWRpYW50ZXMgcGFyYSByZXNwdWVzdGFzIG3DoXMgZW1ww6F0aWNhc1xuXG5leHBvcnQgZW51bSBFbW90aW9uVHlwZSB7XG4gIC8vIEVtb2Npb25lcyBCw6FzaWNhc1xuICBIQVBQWSA9ICdoYXBweScsXG4gIFNBRCA9ICdzYWQnLFxuICBBTkdSWSA9ICdhbmdyeScsXG4gIEZFQVIgPSAnZmVhcicsXG4gIFNVUlBSSVNFID0gJ3N1cnByaXNlJyxcbiAgTkVVVFJBTCA9ICduZXV0cmFsJyxcbiAgXG4gIC8vIEVtb2Npb25lcyBBY2Fkw6ltaWNhcyBFc3BlY8OtZmljYXNcbiAgRlJVU1RSQVRFRCA9ICdmcnVzdHJhdGVkJyxcbiAgTU9USVZBVEVEID0gJ21vdGl2YXRlZCcsXG4gIENPTkZVU0VEID0gJ2NvbmZ1c2VkJyxcbiAgQ09ORklERU5UID0gJ2NvbmZpZGVudCcsXG4gIE9WRVJXSEVMTUVEID0gJ292ZXJ3aGVsbWVkJyxcbiAgQ1VSSU9VUyA9ICdjdXJpb3VzJyxcbiAgUFJPVUQgPSAncHJvdWQnLFxuICBESVNBUFBPSU5URUQgPSAnZGlzYXBwb2ludGVkJyxcbiAgQU5YSU9VUyA9ICdhbnhpb3VzJyxcbiAgRVhDSVRFRCA9ICdleGNpdGVkJyxcbiAgQk9SRUQgPSAnYm9yZWQnLFxuICBIT1BFRlVMID0gJ2hvcGVmdWwnLFxuICBTVFJFU1NFRCA9ICdzdHJlc3NlZCcsXG4gIFJFTElFVkVEID0gJ3JlbGlldmVkJyxcbiAgR1JBVEVGVUwgPSAnZ3JhdGVmdWwnXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgRW1vdGlvbkFuYWx5c2lzIHtcbiAgcHJpbWFyeTogRW1vdGlvblR5cGVcbiAgc2Vjb25kYXJ5PzogRW1vdGlvblR5cGVcbiAgY29uZmlkZW5jZTogbnVtYmVyXG4gIGludGVuc2l0eTogJ2xvdycgfCAnbWVkaXVtJyB8ICdoaWdoJ1xuICBpbmRpY2F0b3JzOiBzdHJpbmdbXVxuICBjb250ZXh0OiB7XG4gICAgYWNhZGVtaWM/OiBib29sZWFuXG4gICAgcGVyc29uYWw/OiBib29sZWFuXG4gICAgdGVtcG9yYWw/OiAncGFzdCcgfCAncHJlc2VudCcgfCAnZnV0dXJlJ1xuICAgIHN1YmplY3Q/OiBzdHJpbmdcbiAgfVxuICBzdWdnZXN0ZWRSZXNwb25zZTogJ3N1cHBvcnRpdmUnIHwgJ21vdGl2YXRpb25hbCcgfCAncHJvZmVzc2lvbmFsJyB8ICdlbXBhdGhldGljJyB8ICdlbmNvdXJhZ2luZycgfCAnc29sdXRpb25fZm9jdXNlZCdcbn1cblxuZXhwb3J0IGludGVyZmFjZSBFbW90aW9uUGF0dGVybiB7XG4gIGtleXdvcmRzOiBzdHJpbmdbXVxuICBwaHJhc2VzOiBSZWdFeHBbXVxuICBjb250ZXh0OiBzdHJpbmdbXVxuICBpbnRlbnNpdHlfbXVsdGlwbGllcnM6IHsgW2tleTogc3RyaW5nXTogbnVtYmVyIH1cbiAgY29uZmlkZW5jZV9iYXNlOiBudW1iZXJcbn1cblxuZXhwb3J0IGNsYXNzIEVtb3Rpb25BbmFseXplciB7XG4gIFxuICBwcml2YXRlIHN0YXRpYyByZWFkb25seSBFTU9USU9OX1BBVFRFUk5TOiB7IFtrZXkgaW4gRW1vdGlvblR5cGVdOiBFbW90aW9uUGF0dGVybiB9ID0ge1xuICAgIFtFbW90aW9uVHlwZS5GUlVTVFJBVEVEXToge1xuICAgICAga2V5d29yZHM6IFsnZnJ1c3RyYWRvJywgJ2Vub2phZG8nLCAnbW9sZXN0bycsICdoYXJ0YWRvJywgJ2Z1cmlvc28nLCAnaXJyaXRhZG8nXSxcbiAgICAgIHBocmFzZXM6IFtcbiAgICAgICAgL25vXFxzK3B1ZWRvXFxzKyhtw6FzfGhhY2VyfGxvZ3JhcikvaSxcbiAgICAgICAgL2VzXFxzKyhtdXlcXHMrfHPDunBlclxccyspP2RpZsOtY2lsL2ksXG4gICAgICAgIC9tZVxccysoZnJ1c3RyYXxtb2xlc3RhfGVub2phKS9pLFxuICAgICAgICAvcG9yXFxzK3F1w6lcXHMrbm9cXHMrKHB1ZWRvfGxvZ3JvfGVudGllbmRvKS9pLFxuICAgICAgICAvZXN0b1xccysobm9cXHMrc2lydmV8ZXNcXHMraW1wb3NpYmxlKS9pLFxuICAgICAgICAveWFcXHMrKGludGVudMOpfHByb2LDqSlcXHMrdG9kby9pXG4gICAgICBdLFxuICAgICAgY29udGV4dDogWydkaWbDrWNpbCcsICdwcm9ibGVtYScsICdmYWxsYScsICdlcnJvcicsICdpbXBvc2libGUnXSxcbiAgICAgIGludGVuc2l0eV9tdWx0aXBsaWVyczogeyAnbXV5JzogMS4zLCAnc8O6cGVyJzogMS41LCAnZGVtYXNpYWRvJzogMS40LCAnY29tcGxldGFtZW50ZSc6IDEuNiB9LFxuICAgICAgY29uZmlkZW5jZV9iYXNlOiAwLjg1XG4gICAgfSxcblxuICAgIFtFbW90aW9uVHlwZS5NT1RJVkFURURdOiB7XG4gICAgICBrZXl3b3JkczogWydtb3RpdmFkbycsICdlbW9jaW9uYWRvJywgJ2VudHVzaWFzbWFkbycsICdpbnNwaXJhZG8nLCAnZGV0ZXJtaW5hZG8nXSxcbiAgICAgIHBocmFzZXM6IFtcbiAgICAgICAgL3F1aWVyb1xccysobG9ncmFyfGNvbnNlZ3VpcnxhcHJlbmRlcikvaSxcbiAgICAgICAgL2VzdG95XFxzKyhsaXN0b3xwcmVwYXJhZG98ZW1vY2lvbmFkbykvaSxcbiAgICAgICAgL21lXFxzKyhndXN0YXxlbmNhbnRhfG1vdGl2YSkvaSxcbiAgICAgICAgL3ZhbW9zXFxzKyhhXFxzKyk/aGFjZXJsby9pLFxuICAgICAgICAvZXN0b3lcXHMrZGVjaWRpZG8vaSxcbiAgICAgICAgL3RlbmdvXFxzK2dhbmFzXFxzK2RlL2lcbiAgICAgIF0sXG4gICAgICBjb250ZXh0OiBbJ29iamV0aXZvJywgJ21ldGEnLCAncGxhbicsICdmdXR1cm8nLCAnbG9ncm8nXSxcbiAgICAgIGludGVuc2l0eV9tdWx0aXBsaWVyczogeyAnbXV5JzogMS4yLCAnc8O6cGVyJzogMS40LCAncmVhbG1lbnRlJzogMS4zIH0sXG4gICAgICBjb25maWRlbmNlX2Jhc2U6IDAuOFxuICAgIH0sXG5cbiAgICBbRW1vdGlvblR5cGUuQ09ORlVTRURdOiB7XG4gICAgICBrZXl3b3JkczogWydjb25mdW5kaWRvJywgJ3BlcmRpZG8nLCAnZGVzb3JpZW50YWRvJywgJ2VucmVkYWRvJ10sXG4gICAgICBwaHJhc2VzOiBbXG4gICAgICAgIC9ub1xccysoZW50aWVuZG98Y29tcHJlbmRvfGNhcHRvKS9pLFxuICAgICAgICAvZXN0b3lcXHMrKGNvbmZ1bmRpZG98cGVyZGlkbykvaSxcbiAgICAgICAgL25vXFxzK3PDqVxccysoY8OzbW98cXXDqXxwb3JcXHMrcXXDqSkvaSxcbiAgICAgICAgL21lXFxzKyhjb25mdW5kZXxkZXNvcmllbnRhKS9pLFxuICAgICAgICAvbm9cXHMrbWVcXHMrcXVlZGFcXHMrY2xhcm8vaSxcbiAgICAgICAgL3BvZHLDrWFzXFxzK2V4cGxpY2FyL2lcbiAgICAgIF0sXG4gICAgICBjb250ZXh0OiBbJ2V4cGxpY2FjacOzbicsICdheXVkYScsICdjbGFyaWZpY2FyJywgJ2NvbmNlcHRvJywgJ2R1ZGFzJ10sXG4gICAgICBpbnRlbnNpdHlfbXVsdGlwbGllcnM6IHsgJ2NvbXBsZXRhbWVudGUnOiAxLjUsICd0b3RhbG1lbnRlJzogMS40LCAnbXV5JzogMS4yIH0sXG4gICAgICBjb25maWRlbmNlX2Jhc2U6IDAuOVxuICAgIH0sXG5cbiAgICBbRW1vdGlvblR5cGUuT1ZFUldIRUxNRURdOiB7XG4gICAgICBrZXl3b3JkczogWydhYnJ1bWFkbycsICdzb2JyZWNhcmdhZG8nLCAnc2F0dXJhZG8nLCAnYWdvYmlhZG8nXSxcbiAgICAgIHBocmFzZXM6IFtcbiAgICAgICAgL2VzXFxzK2RlbWFzaWFkby9pLFxuICAgICAgICAvbm9cXHMrcHVlZG9cXHMrY29uXFxzK3RvZG8vaSxcbiAgICAgICAgL21lXFxzKyhhYnJ1bWF8YWdvYmlhfHNhdHVyYSkvaSxcbiAgICAgICAgL3NvblxccyttdWNoYXNcXHMrY29zYXMvaSxcbiAgICAgICAgL25vXFxzK3RlbmdvXFxzK3RpZW1wby9pLFxuICAgICAgICAvbWVcXHMrc2llbnRvXFxzKyhwZXJkaWRvfGRlc2JvcmRhZG8pL2lcbiAgICAgIF0sXG4gICAgICBjb250ZXh0OiBbJ3RpZW1wbycsICd0YXJlYXMnLCAnZXjDoW1lbmVzJywgJ211Y2hvcycsICdwcmVzacOzbiddLFxuICAgICAgaW50ZW5zaXR5X211bHRpcGxpZXJzOiB7ICdjb21wbGV0YW1lbnRlJzogMS42LCAndG90YWxtZW50ZSc6IDEuNSwgJ211eSc6IDEuMyB9LFxuICAgICAgY29uZmlkZW5jZV9iYXNlOiAwLjg4XG4gICAgfSxcblxuICAgIFtFbW90aW9uVHlwZS5BTlhJT1VTXToge1xuICAgICAga2V5d29yZHM6IFsnYW5zaW9zbycsICduZXJ2aW9zbycsICdwcmVvY3VwYWRvJywgJ2VzdHJlc2FkbycsICd0ZW5zbycsICdhbnNpZWRhZCddLFxuICAgICAgcGhyYXNlczogW1xuICAgICAgICAvbWVcXHMrKHByZW9jdXBhfGRhXFxzK2Fuc2llZGFkfHBvbmVcXHMrbmVydmlvc28pL2ksXG4gICAgICAgIC90ZW5nb1xccysobWllZG98dGVtb3IpXFxzK2RlL2ksXG4gICAgICAgIC95XFxzK3NpXFxzKyhub1xccytwdWVkb3xmYWxsb3xzYWxnb1xccyttYWwpL2ksXG4gICAgICAgIC9tZVxccytkYVxccysoZXN0csOpc3xww6FuaWNvfGFuc2llZGFkKS9pLFxuICAgICAgICAvZXN0b3lcXHMrKG5lcnZpb3NvfGFuc2lvc28pL2ksXG4gICAgICAgIC9ub1xccytzw6lcXHMrc2lcXHMrcG9kcsOpL2ksXG4gICAgICAgIC8obXVjaGF8YmFzdGFudGUpXFxzK2Fuc2llZGFkL2ksXG4gICAgICAgIC9hbnNpZWRhZFxccysocG9yfGRlfGFsKS9pXG4gICAgICBdLFxuICAgICAgY29udGV4dDogWydleGFtZW4nLCAnZXZhbHVhY2nDs24nLCAnZnV0dXJvJywgJ3Jlc3VsdGFkbycsICdmYWxsbycsICdww7pibGljbycsICdoYWJsYXInXSxcbiAgICAgIGludGVuc2l0eV9tdWx0aXBsaWVyczogeyAnbXV5JzogMS4zLCAnbXVjaGEnOiAxLjQsICdzw7pwZXInOiAxLjUsICdkZW1hc2lhZG8nOiAxLjQsICdiYXN0YW50ZSc6IDEuMiB9LFxuICAgICAgY29uZmlkZW5jZV9iYXNlOiAwLjg4XG4gICAgfSxcblxuICAgIFtFbW90aW9uVHlwZS5QUk9VRF06IHtcbiAgICAgIGtleXdvcmRzOiBbJ29yZ3VsbG9zbycsICdzYXRpc2ZlY2hvJywgJ2NvbnRlbnRvJywgJ2ZlbGl6J10sXG4gICAgICBwaHJhc2VzOiBbXG4gICAgICAgIC9sb1xccysobG9ncsOpfGNvbnNlZ3XDrXxoaWNlKS9pLFxuICAgICAgICAvZXN0b3lcXHMrKG9yZ3VsbG9zb3xzYXRpc2ZlY2hvfGNvbnRlbnRvKS9pLFxuICAgICAgICAvbWVcXHMrc2llbnRvXFxzKyhiaWVufGdlbmlhbHxpbmNyZcOtYmxlKS9pLFxuICAgICAgICAvcHVkZVxccytoYWNlcmxvL2ksXG4gICAgICAgIC9sb1xccytlbnRlbmTDrS9pLFxuICAgICAgICAvZnVuY2lvbsOzL2ksXG4gICAgICAgIC9sb2dyw6lcXHMrKHRlcm1pbmFyfGNvbXBsZXRhcnxoYWNlcikvaSxcbiAgICAgICAgLyh0ZXJtaW7DqXxjb21wbGV0w6kpXFxzKyhlbHxsYXxtaSkvaSxcbiAgICAgICAgL3B1ZGVcXHMrKHRlcm1pbmFyfGNvbXBsZXRhcikvaVxuICAgICAgXSxcbiAgICAgIGNvbnRleHQ6IFsnbG9ncm8nLCAnw6l4aXRvJywgJ3Jlc3VsdGFkbycsICdjb21wbGV0w6knLCAndGVybWluw6knLCAnZXhhbWVuJywgJ3Byb3llY3RvJywgJ3RhcmVhJ10sXG4gICAgICBpbnRlbnNpdHlfbXVsdGlwbGllcnM6IHsgJ211eSc6IDEuMiwgJ3PDunBlcic6IDEuNCwgJ3JlYWxtZW50ZSc6IDEuMywgJ2ZpbmFsbWVudGUnOiAxLjMgfSxcbiAgICAgIGNvbmZpZGVuY2VfYmFzZTogMC44NVxuICAgIH0sXG5cbiAgICBbRW1vdGlvblR5cGUuRElTQVBQT0lOVEVEXToge1xuICAgICAga2V5d29yZHM6IFsnZGVjZXBjaW9uYWRvJywgJ3RyaXN0ZScsICdkZXNpbHVzaW9uYWRvJywgJ2Rlc2FuaW1hZG8nXSxcbiAgICAgIHBocmFzZXM6IFtcbiAgICAgICAgL25vXFxzK3NhbGnDs1xccytjb21vXFxzK2VzcGVyYWJhL2ksXG4gICAgICAgIC9tZVxccysoZGVjZXBjaW9uYXxlbnRyaXN0ZWNlfGRlc2FuaW1hKS9pLFxuICAgICAgICAvZXNwZXJhYmFcXHMrKG3DoXN8bWVqb3IpL2ksXG4gICAgICAgIC9ub1xccytmdWVcXHMrc3VmaWNpZW50ZS9pLFxuICAgICAgICAvcXXDqVxccyttYWwvaSxcbiAgICAgICAgL25vXFxzK2Z1bmNpb27Dsy9pXG4gICAgICBdLFxuICAgICAgY29udGV4dDogWydyZXN1bHRhZG8nLCAnY2FsaWZpY2FjacOzbicsICdleHBlY3RhdGl2YScsICdmYWxsbycsICdlcnJvciddLFxuICAgICAgaW50ZW5zaXR5X211bHRpcGxpZXJzOiB7ICdtdXknOiAxLjMsICdyZWFsbWVudGUnOiAxLjQsICdiYXN0YW50ZSc6IDEuMiB9LFxuICAgICAgY29uZmlkZW5jZV9iYXNlOiAwLjhcbiAgICB9LFxuXG4gICAgW0Vtb3Rpb25UeXBlLkVYQ0lURURdOiB7XG4gICAgICBrZXl3b3JkczogWydlbW9jaW9uYWRvJywgJ2VudHVzaWFzbWFkbycsICdpbHVzaW9uYWRvJywgJ2FsZWdyZSddLFxuICAgICAgcGhyYXNlczogW1xuICAgICAgICAvcXXDqVxccysoZ2VuaWFsfGluY3Jlw61ibGV8ZmFudMOhc3RpY28pL2ksXG4gICAgICAgIC9tZVxccysoZW1vY2lvbmF8aWx1c2lvbmF8YWxlZ3JhKS9pLFxuICAgICAgICAvZXN0b3lcXHMrKGVtb2Npb25hZG98ZW50dXNpYXNtYWRvKS9pLFxuICAgICAgICAvbm9cXHMrcHVlZG9cXHMrZXNwZXJhci9pLFxuICAgICAgICAvc2Vyw6FcXHMrKGdlbmlhbHxmYW50w6FzdGljbykvaSxcbiAgICAgICAgL21lXFxzK2VuY2FudGEvaVxuICAgICAgXSxcbiAgICAgIGNvbnRleHQ6IFsncHJveWVjdG8nLCAnbnVldm8nLCAnb3BvcnR1bmlkYWQnLCAnZnV0dXJvJywgJ2V4cGVyaWVuY2lhJ10sXG4gICAgICBpbnRlbnNpdHlfbXVsdGlwbGllcnM6IHsgJ211eSc6IDEuMiwgJ3PDunBlcic6IDEuNCwgJ3JlYWxtZW50ZSc6IDEuMyB9LFxuICAgICAgY29uZmlkZW5jZV9iYXNlOiAwLjgzXG4gICAgfSxcblxuICAgIFtFbW90aW9uVHlwZS5CT1JFRF06IHtcbiAgICAgIGtleXdvcmRzOiBbJ2FidXJyaWRvJywgJ2hhc3RpYWRvJywgJ2NhbnNhZG8nLCAndGVkaW9zbyddLFxuICAgICAgcGhyYXNlczogW1xuICAgICAgICAvbWVcXHMrKGFidXJyZXxoYXN0w61hfGNhbnNhKS9pLFxuICAgICAgICAvZXNcXHMrKGFidXJyaWRvfHRlZGlvc298cmVwZXRpdGl2bykvaSxcbiAgICAgICAgL25vXFxzK21lXFxzK2ludGVyZXNhL2ksXG4gICAgICAgIC9xdcOpXFxzKyhhYnVycmlkb3x0ZWRpb3NvKS9pLFxuICAgICAgICAvc2llbXByZVxccytsb1xccyttaXNtby9pLFxuICAgICAgICAvbm9cXHMrZXNcXHMrZGl2ZXJ0aWRvL2lcbiAgICAgIF0sXG4gICAgICBjb250ZXh0OiBbJ21hdGVyaWEnLCAndGVtYScsICdyZXBldGl0aXZvJywgJ3NpZW1wcmUnLCAnbWlzbW8nXSxcbiAgICAgIGludGVuc2l0eV9tdWx0aXBsaWVyczogeyAnbXV5JzogMS4yLCAnc8O6cGVyJzogMS40LCAnZGVtYXNpYWRvJzogMS4zIH0sXG4gICAgICBjb25maWRlbmNlX2Jhc2U6IDAuNzhcbiAgICB9LFxuXG4gICAgW0Vtb3Rpb25UeXBlLkhPUEVGVUxdOiB7XG4gICAgICBrZXl3b3JkczogWydlc3BlcmFuemFkbycsICdvcHRpbWlzdGEnLCAnY29uZmlhZG8nLCAncG9zaXRpdm8nXSxcbiAgICAgIHBocmFzZXM6IFtcbiAgICAgICAgL2VzcGVyb1xccysocXVlfHBvZGVyKS9pLFxuICAgICAgICAvdGVuZ29cXHMrKGVzcGVyYW56YXxmZXxjb25maWFuemEpL2ksXG4gICAgICAgIC9jcmVvXFxzK3F1ZVxccysocHVlZG98cG9kcsOpKS9pLFxuICAgICAgICAvc2Vyw6FcXHMrcG9zaWJsZS9pLFxuICAgICAgICAvY29uZsOtb1xccytlblxccytxdWUvaSxcbiAgICAgICAgL2VzdG95XFxzK29wdGltaXN0YS9pXG4gICAgICBdLFxuICAgICAgY29udGV4dDogWydmdXR1cm8nLCAncG9zaWJpbGlkYWQnLCAnbWVqb3JhJywgJ2NhbWJpbycsICdvcG9ydHVuaWRhZCddLFxuICAgICAgaW50ZW5zaXR5X211bHRpcGxpZXJzOiB7ICdtdXknOiAxLjIsICdyZWFsbWVudGUnOiAxLjMsICdiYXN0YW50ZSc6IDEuMSB9LFxuICAgICAgY29uZmlkZW5jZV9iYXNlOiAwLjc1XG4gICAgfSxcblxuICAgIFtFbW90aW9uVHlwZS5TVFJFU1NFRF06IHtcbiAgICAgIGtleXdvcmRzOiBbJ2VzdHJlc2FkbycsICdwcmVzaW9uYWRvJywgJ2Fnb2JpYWRvJywgJ3RlbnNpb25hZG8nXSxcbiAgICAgIHBocmFzZXM6IFtcbiAgICAgICAgL21lXFxzKyhlc3RyZXNhfHByZXNpb25hfGFnb2JpYSkvaSxcbiAgICAgICAgL3NpZW50b1xccysocHJlc2nDs258dGVuc2nDs258ZXN0csOpcykvaSxcbiAgICAgICAgL25vXFxzK2RveVxccythYmFzdG8vaSxcbiAgICAgICAgL2VzXFxzK211Y2hhXFxzK3ByZXNpw7NuL2ksXG4gICAgICAgIC9tZVxccytzaWVudG9cXHMrcHJlc2lvbmFkby9pLFxuICAgICAgICAvbm9cXHMrcHVlZG9cXHMrcmVsYWphcm1lL2lcbiAgICAgIF0sXG4gICAgICBjb250ZXh0OiBbJ3RpZW1wbycsICdwcmVzacOzbicsICdkZWFkbGluZXMnLCAnZXjDoW1lbmVzJywgJ23Dumx0aXBsZSddLFxuICAgICAgaW50ZW5zaXR5X211bHRpcGxpZXJzOiB7ICdtdXknOiAxLjMsICdkZW1hc2lhZG8nOiAxLjQsICdleHRyZW1hZGFtZW50ZSc6IDEuNiB9LFxuICAgICAgY29uZmlkZW5jZV9iYXNlOiAwLjg2XG4gICAgfSxcblxuICAgIFtFbW90aW9uVHlwZS5HUkFURUZVTF06IHtcbiAgICAgIGtleXdvcmRzOiBbJ2FncmFkZWNpZG8nLCAnZ3JhY2lhcycsICdyZWNvbm9jaWRvJywgJ2FwcmVjaWFkbyddLFxuICAgICAgcGhyYXNlczogW1xuICAgICAgICAvbXVjaGFzXFxzK2dyYWNpYXMvaSxcbiAgICAgICAgLyh0ZVxccyspP2FncmFkZXpjby9pLFxuICAgICAgICAvbWVcXHMrKGF5dWRhc3xheXVkYXN0ZSlcXHMrbXVjaG8vaSxcbiAgICAgICAgL2VyZXNcXHMrKGdlbmlhbHxpbmNyZcOtYmxlfG11eVxccyvDunRpbCkvaSxcbiAgICAgICAgL2dyYWNpYXNcXHMrcG9yL2ksXG4gICAgICAgIC9sb1xccythcHJlY2lvL2lcbiAgICAgIF0sXG4gICAgICBjb250ZXh0OiBbJ2F5dWRhJywgJ2Fwb3lvJywgJ2V4cGxpY2FjacOzbicsICd0aWVtcG8nLCAncGFjaWVuY2lhJ10sXG4gICAgICBpbnRlbnNpdHlfbXVsdGlwbGllcnM6IHsgJ211Y2jDrXNpbWFzJzogMS40LCAncmVhbG1lbnRlJzogMS4zLCAnbXV5JzogMS4yIH0sXG4gICAgICBjb25maWRlbmNlX2Jhc2U6IDAuOVxuICAgIH0sXG5cbiAgICAvLyBFbW9jaW9uZXMgYsOhc2ljYXMgY29uIHBhdHJvbmVzIHNpbXBsZXNcbiAgICBbRW1vdGlvblR5cGUuSEFQUFldOiB7XG4gICAgICBrZXl3b3JkczogWydmZWxpeicsICdhbGVncmUnLCAnY29udGVudG8nLCAnYmllbiddLFxuICAgICAgcGhyYXNlczogWy9tZVxccytzaWVudG9cXHMrKGZlbGl6fGFsZWdyZXxiaWVuKS9pLCAvZXN0b3lcXHMrKGZlbGl6fGNvbnRlbnRvKS9pXSxcbiAgICAgIGNvbnRleHQ6IFsnbG9ncm8nLCAnw6l4aXRvJywgJ2J1ZW5vJ10sXG4gICAgICBpbnRlbnNpdHlfbXVsdGlwbGllcnM6IHsgJ211eSc6IDEuMiB9LFxuICAgICAgY29uZmlkZW5jZV9iYXNlOiAwLjdcbiAgICB9LFxuXG4gICAgW0Vtb3Rpb25UeXBlLlNBRF06IHtcbiAgICAgIGtleXdvcmRzOiBbJ3RyaXN0ZScsICdtZWxhbmPDs2xpY28nLCAnZGVwcmltaWRvJ10sXG4gICAgICBwaHJhc2VzOiBbL21lXFxzK3NpZW50b1xccyt0cmlzdGUvaSwgL2VzdG95XFxzK3RyaXN0ZS9pXSxcbiAgICAgIGNvbnRleHQ6IFsnbWFsJywgJ2ZhbGxvJywgJ3DDqXJkaWRhJ10sXG4gICAgICBpbnRlbnNpdHlfbXVsdGlwbGllcnM6IHsgJ211eSc6IDEuMyB9LFxuICAgICAgY29uZmlkZW5jZV9iYXNlOiAwLjc1XG4gICAgfSxcblxuICAgIFtFbW90aW9uVHlwZS5BTkdSWV06IHtcbiAgICAgIGtleXdvcmRzOiBbJ2Vub2phZG8nLCAnZnVyaW9zbycsICdtb2xlc3RvJ10sXG4gICAgICBwaHJhc2VzOiBbL21lXFxzK2Vub2phL2ksIC9lc3RveVxccytmdXJpb3NvL2ldLFxuICAgICAgY29udGV4dDogWydwcm9ibGVtYScsICdpbmp1c3RvJywgJ21hbCddLFxuICAgICAgaW50ZW5zaXR5X211bHRpcGxpZXJzOiB7ICdtdXknOiAxLjQgfSxcbiAgICAgIGNvbmZpZGVuY2VfYmFzZTogMC44XG4gICAgfSxcblxuICAgIFtFbW90aW9uVHlwZS5GRUFSXToge1xuICAgICAga2V5d29yZHM6IFsnbWllZG8nLCAndGVtb3InLCAnYXN1c3RhZG8nXSxcbiAgICAgIHBocmFzZXM6IFsvdGVuZ29cXHMrbWllZG8vaSwgL21lXFxzK2FzdXN0YS9pXSxcbiAgICAgIGNvbnRleHQ6IFsncGVsaWdybycsICdhbWVuYXphJywgJ2Z1dHVybyddLFxuICAgICAgaW50ZW5zaXR5X211bHRpcGxpZXJzOiB7ICdtdWNobyc6IDEuMyB9LFxuICAgICAgY29uZmlkZW5jZV9iYXNlOiAwLjhcbiAgICB9LFxuXG4gICAgW0Vtb3Rpb25UeXBlLlNVUlBSSVNFXToge1xuICAgICAga2V5d29yZHM6IFsnc29ycHJlbmRpZG8nLCAnYXNvbWJyYWRvJywgJ2ltcHJlc2lvbmFkbyddLFxuICAgICAgcGhyYXNlczogWy9xdcOpXFxzK3NvcnByZXNhL2ksIC9tZVxccytzb3JwcmVuZGUvaV0sXG4gICAgICBjb250ZXh0OiBbJ2luZXNwZXJhZG8nLCAnbnVldm8nLCAnZGlmZXJlbnRlJ10sXG4gICAgICBpbnRlbnNpdHlfbXVsdGlwbGllcnM6IHsgJ211eSc6IDEuMiB9LFxuICAgICAgY29uZmlkZW5jZV9iYXNlOiAwLjdcbiAgICB9LFxuXG4gICAgW0Vtb3Rpb25UeXBlLkNPTkZJREVOVF06IHtcbiAgICAgIGtleXdvcmRzOiBbJ3NlZ3VybycsICdjb25maWFkbycsICdjYXBheiddLFxuICAgICAgcGhyYXNlczogWy9lc3RveVxccytzZWd1cm8vaSwgL3B1ZWRvXFxzK2hhY2VybG8vaV0sXG4gICAgICBjb250ZXh0OiBbJ2NhcGFjaWRhZCcsICdoYWJpbGlkYWQnLCAnbG9ncm8nXSxcbiAgICAgIGludGVuc2l0eV9tdWx0aXBsaWVyczogeyAnbXV5JzogMS4yIH0sXG4gICAgICBjb25maWRlbmNlX2Jhc2U6IDAuOFxuICAgIH0sXG5cbiAgICBbRW1vdGlvblR5cGUuQ1VSSU9VU106IHtcbiAgICAgIGtleXdvcmRzOiBbJ2N1cmlvc28nLCAnaW50ZXJlc2FkbycsICdpbnRyaWdhZG8nXSxcbiAgICAgIHBocmFzZXM6IFsvbWVcXHMrZGFcXHMrY3VyaW9zaWRhZC9pLCAvcXVpZXJvXFxzK3NhYmVyL2ldLFxuICAgICAgY29udGV4dDogWydwcmVndW50YScsICdleHBsb3JhcicsICdkZXNjdWJyaXInXSxcbiAgICAgIGludGVuc2l0eV9tdWx0aXBsaWVyczogeyAnbXV5JzogMS4yIH0sXG4gICAgICBjb25maWRlbmNlX2Jhc2U6IDAuNzVcbiAgICB9LFxuXG4gICAgW0Vtb3Rpb25UeXBlLlJFTElFVkVEXToge1xuICAgICAga2V5d29yZHM6IFsnYWxpdmlhZG8nLCAndHJhbnF1aWxvJywgJ3JlbGFqYWRvJ10sXG4gICAgICBwaHJhc2VzOiBbL3F1w6lcXHMrYWxpdmlvL2ksIC9tZVxccyt0cmFucXVpbGl6YS9pXSxcbiAgICAgIGNvbnRleHQ6IFsncHJvYmxlbWEgcmVzdWVsdG8nLCAnw6l4aXRvJywgJ3Rlcm1pbmFkbyddLFxuICAgICAgaW50ZW5zaXR5X211bHRpcGxpZXJzOiB7ICdtdXknOiAxLjIgfSxcbiAgICAgIGNvbmZpZGVuY2VfYmFzZTogMC44XG4gICAgfSxcblxuICAgIFtFbW90aW9uVHlwZS5ORVVUUkFMXToge1xuICAgICAga2V5d29yZHM6IFsnbm9ybWFsJywgJ3JlZ3VsYXInLCAnY29tw7puJ10sXG4gICAgICBwaHJhc2VzOiBbL2VzdMOhXFxzK2JpZW4vaSwgL25vcm1hbC9pXSxcbiAgICAgIGNvbnRleHQ6IFtdLFxuICAgICAgaW50ZW5zaXR5X211bHRpcGxpZXJzOiB7fSxcbiAgICAgIGNvbmZpZGVuY2VfYmFzZTogMC41XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEFuYWxpemEgbGFzIGVtb2Npb25lcyBlbiB1biBtZW5zYWplIGRlIHRleHRvXG4gICAqL1xuICBzdGF0aWMgYW5hbHl6ZUVtb3Rpb25zKG1lc3NhZ2U6IHN0cmluZywgY29udGV4dD86IHsgc3ViamVjdD86IHN0cmluZywgcHJldmlvdXNFbW90aW9uPzogRW1vdGlvblR5cGUgfSk6IEVtb3Rpb25BbmFseXNpcyB7XG4gICAgY29uc3QgbG93ZXJNZXNzYWdlID0gbWVzc2FnZS50b0xvd2VyQ2FzZSgpXG4gICAgY29uc3QgZW1vdGlvblNjb3JlczogQXJyYXk8eyBlbW90aW9uOiBFbW90aW9uVHlwZSwgc2NvcmU6IG51bWJlciwgaW5kaWNhdG9yczogc3RyaW5nW10gfT4gPSBbXVxuXG4gICAgLy8gQW5hbGl6YXIgY2FkYSBwYXRyw7NuIGVtb2Npb25hbFxuICAgIGZvciAoY29uc3QgW2Vtb3Rpb24sIHBhdHRlcm5dIG9mIE9iamVjdC5lbnRyaWVzKHRoaXMuRU1PVElPTl9QQVRURVJOUykpIHtcbiAgICAgIGNvbnN0IHNjb3JlID0gdGhpcy5jYWxjdWxhdGVFbW90aW9uU2NvcmUobG93ZXJNZXNzYWdlLCBwYXR0ZXJuLCBtZXNzYWdlKVxuICAgICAgaWYgKHNjb3JlID4gMC4zKSB7IC8vIFVtYnJhbCBtw61uaW1vIGRlIGNvbmZpYW56YVxuICAgICAgICBlbW90aW9uU2NvcmVzLnB1c2goe1xuICAgICAgICAgIGVtb3Rpb246IGVtb3Rpb24gYXMgRW1vdGlvblR5cGUsXG4gICAgICAgICAgc2NvcmUsXG4gICAgICAgICAgaW5kaWNhdG9yczogdGhpcy5nZXRNYXRjaGVkSW5kaWNhdG9ycyhsb3dlck1lc3NhZ2UsIHBhdHRlcm4sIG1lc3NhZ2UpXG4gICAgICAgIH0pXG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gT3JkZW5hciBwb3IgcHVudHVhY2nDs25cbiAgICBlbW90aW9uU2NvcmVzLnNvcnQoKGEsIGIpID0+IGIuc2NvcmUgLSBhLnNjb3JlKVxuXG4gICAgLy8gRGV0ZXJtaW5hciBlbW9jacOzbiBwcmluY2lwYWwgeSBzZWN1bmRhcmlhXG4gICAgY29uc3QgcHJpbWFyeSA9IGVtb3Rpb25TY29yZXNbMF0/LmVtb3Rpb24gfHwgRW1vdGlvblR5cGUuTkVVVFJBTFxuICAgIGNvbnN0IHNlY29uZGFyeSA9IGVtb3Rpb25TY29yZXMubGVuZ3RoID4gMSAmJiBlbW90aW9uU2NvcmVzWzFdLnNjb3JlID4gMC41IFxuICAgICAgPyBlbW90aW9uU2NvcmVzWzFdLmVtb3Rpb24gXG4gICAgICA6IHVuZGVmaW5lZFxuXG4gICAgY29uc3QgY29uZmlkZW5jZSA9IGVtb3Rpb25TY29yZXNbMF0/LnNjb3JlIHx8IDAuNVxuICAgIGNvbnN0IGluZGljYXRvcnMgPSBlbW90aW9uU2NvcmVzWzBdPy5pbmRpY2F0b3JzIHx8IFtdXG5cbiAgICByZXR1cm4ge1xuICAgICAgcHJpbWFyeSxcbiAgICAgIHNlY29uZGFyeSxcbiAgICAgIGNvbmZpZGVuY2U6IE1hdGgubWluKGNvbmZpZGVuY2UsIDAuOTUpLCAvLyBDYXAgbcOheGltbyBkZSBjb25maWFuemFcbiAgICAgIGludGVuc2l0eTogdGhpcy5jYWxjdWxhdGVJbnRlbnNpdHkobG93ZXJNZXNzYWdlLCBjb25maWRlbmNlKSxcbiAgICAgIGluZGljYXRvcnMsXG4gICAgICBjb250ZXh0OiB0aGlzLmFuYWx5emVFbW90aW9uYWxDb250ZXh0KGxvd2VyTWVzc2FnZSwgY29udGV4dCksXG4gICAgICBzdWdnZXN0ZWRSZXNwb25zZTogdGhpcy5nZXRTdWdnZXN0ZWRSZXNwb25zZVR5cGUocHJpbWFyeSwgY29uZmlkZW5jZSlcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogQ2FsY3VsYSBsYSBwdW50dWFjacOzbiBkZSB1bmEgZW1vY2nDs24gZXNwZWPDrWZpY2FcbiAgICovXG4gIHByaXZhdGUgc3RhdGljIGNhbGN1bGF0ZUVtb3Rpb25TY29yZShsb3dlck1lc3NhZ2U6IHN0cmluZywgcGF0dGVybjogRW1vdGlvblBhdHRlcm4sIG9yaWdpbmFsTWVzc2FnZTogc3RyaW5nKTogbnVtYmVyIHtcbiAgICBsZXQgc2NvcmUgPSAwXG4gICAgbGV0IG1hdGNoZXMgPSAwXG5cbiAgICAvLyBCdXNjYXIgcGFsYWJyYXMgY2xhdmVcbiAgICBmb3IgKGNvbnN0IGtleXdvcmQgb2YgcGF0dGVybi5rZXl3b3Jkcykge1xuICAgICAgaWYgKGxvd2VyTWVzc2FnZS5pbmNsdWRlcyhrZXl3b3JkKSkge1xuICAgICAgICBzY29yZSArPSAwLjNcbiAgICAgICAgbWF0Y2hlcysrXG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gQnVzY2FyIGZyYXNlcyBlc3BlY8OtZmljYXMgKG1heW9yIHBlc28pXG4gICAgZm9yIChjb25zdCBwaHJhc2Ugb2YgcGF0dGVybi5waHJhc2VzKSB7XG4gICAgICBpZiAocGhyYXNlLnRlc3Qob3JpZ2luYWxNZXNzYWdlKSkge1xuICAgICAgICBzY29yZSArPSAwLjVcbiAgICAgICAgbWF0Y2hlcysrXG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gQnVzY2FyIGNvbnRleHRvIGRlIGFwb3lvXG4gICAgZm9yIChjb25zdCBjb250ZXh0V29yZCBvZiBwYXR0ZXJuLmNvbnRleHQpIHtcbiAgICAgIGlmIChsb3dlck1lc3NhZ2UuaW5jbHVkZXMoY29udGV4dFdvcmQpKSB7XG4gICAgICAgIHNjb3JlICs9IDAuMVxuICAgICAgfVxuICAgIH1cblxuICAgIC8vIEFwbGljYXIgbXVsdGlwbGljYWRvcmVzIGRlIGludGVuc2lkYWRcbiAgICBmb3IgKGNvbnN0IFtpbnRlbnNpZmllciwgbXVsdGlwbGllcl0gb2YgT2JqZWN0LmVudHJpZXMocGF0dGVybi5pbnRlbnNpdHlfbXVsdGlwbGllcnMpKSB7XG4gICAgICBpZiAobG93ZXJNZXNzYWdlLmluY2x1ZGVzKGludGVuc2lmaWVyKSkge1xuICAgICAgICBzY29yZSAqPSBtdWx0aXBsaWVyXG4gICAgICAgIGJyZWFrXG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gQWp1c3RhciBwb3IgY29uZmlhbnphIGJhc2UgZGVsIHBhdHLDs25cbiAgICBzY29yZSAqPSBwYXR0ZXJuLmNvbmZpZGVuY2VfYmFzZVxuXG4gICAgLy8gQm9uaWZpY2FjacOzbiBwb3IgbcO6bHRpcGxlcyBjb2luY2lkZW5jaWFzXG4gICAgaWYgKG1hdGNoZXMgPiAxKSB7XG4gICAgICBzY29yZSAqPSAxLjJcbiAgICB9XG5cbiAgICByZXR1cm4gTWF0aC5taW4oc2NvcmUsIDEuMCkgLy8gQ2FwIGVuIDEuMFxuICB9XG5cbiAgLyoqXG4gICAqIE9idGllbmUgbG9zIGluZGljYWRvcmVzIHF1ZSBjb2luY2lkaWVyb25cbiAgICovXG4gIHByaXZhdGUgc3RhdGljIGdldE1hdGNoZWRJbmRpY2F0b3JzKGxvd2VyTWVzc2FnZTogc3RyaW5nLCBwYXR0ZXJuOiBFbW90aW9uUGF0dGVybiwgb3JpZ2luYWxNZXNzYWdlOiBzdHJpbmcpOiBzdHJpbmdbXSB7XG4gICAgY29uc3QgaW5kaWNhdG9yczogc3RyaW5nW10gPSBbXVxuXG4gICAgLy8gUGFsYWJyYXMgY2xhdmUgZW5jb250cmFkYXNcbiAgICBwYXR0ZXJuLmtleXdvcmRzLmZvckVhY2goa2V5d29yZCA9PiB7XG4gICAgICBpZiAobG93ZXJNZXNzYWdlLmluY2x1ZGVzKGtleXdvcmQpKSB7XG4gICAgICAgIGluZGljYXRvcnMucHVzaChga2V5d29yZDogJHtrZXl3b3JkfWApXG4gICAgICB9XG4gICAgfSlcblxuICAgIC8vIEZyYXNlcyBlbmNvbnRyYWRhc1xuICAgIHBhdHRlcm4ucGhyYXNlcy5mb3JFYWNoKChwaHJhc2UsIGluZGV4KSA9PiB7XG4gICAgICBpZiAocGhyYXNlLnRlc3Qob3JpZ2luYWxNZXNzYWdlKSkge1xuICAgICAgICBpbmRpY2F0b3JzLnB1c2goYHBocmFzZV9wYXR0ZXJuXyR7aW5kZXh9YClcbiAgICAgIH1cbiAgICB9KVxuXG4gICAgcmV0dXJuIGluZGljYXRvcnNcbiAgfVxuXG4gIC8qKlxuICAgKiBDYWxjdWxhIGxhIGludGVuc2lkYWQgZW1vY2lvbmFsXG4gICAqL1xuICBwcml2YXRlIHN0YXRpYyBjYWxjdWxhdGVJbnRlbnNpdHkobWVzc2FnZTogc3RyaW5nLCBjb25maWRlbmNlOiBudW1iZXIpOiAnbG93JyB8ICdtZWRpdW0nIHwgJ2hpZ2gnIHtcbiAgICBjb25zdCBpbnRlbnNpZmllcnMgPSBbJ211eScsICdzw7pwZXInLCAnZXh0cmVtYWRhbWVudGUnLCAnY29tcGxldGFtZW50ZScsICd0b3RhbG1lbnRlJywgJ2RlbWFzaWFkbyddXG4gICAgY29uc3QgaGFzSW50ZW5zaWZpZXIgPSBpbnRlbnNpZmllcnMuc29tZSh3b3JkID0+IG1lc3NhZ2UuaW5jbHVkZXMod29yZCkpXG5cbiAgICBpZiAoY29uZmlkZW5jZSA+IDAuOCB8fCBoYXNJbnRlbnNpZmllcikgcmV0dXJuICdoaWdoJ1xuICAgIGlmIChjb25maWRlbmNlID4gMC42KSByZXR1cm4gJ21lZGl1bSdcbiAgICByZXR1cm4gJ2xvdydcbiAgfVxuXG4gIC8qKlxuICAgKiBBbmFsaXphIGVsIGNvbnRleHRvIGVtb2Npb25hbFxuICAgKi9cbiAgcHJpdmF0ZSBzdGF0aWMgYW5hbHl6ZUVtb3Rpb25hbENvbnRleHQobWVzc2FnZTogc3RyaW5nLCBwcm92aWRlZENvbnRleHQ/OiB7IHN1YmplY3Q/OiBzdHJpbmcsIHByZXZpb3VzRW1vdGlvbj86IEVtb3Rpb25UeXBlIH0pIHtcbiAgICBjb25zdCBjb250ZXh0OiBFbW90aW9uQW5hbHlzaXNbJ2NvbnRleHQnXSA9IHt9XG5cbiAgICAvLyBEZXRlY3RhciBzaSBlcyBhY2Fkw6ltaWNvXG4gICAgY29uc3QgYWNhZGVtaWNLZXl3b3JkcyA9IFsnZXhhbWVuJywgJ3RhcmVhJywgJ2VzdHVkaW8nLCAnY2xhc2UnLCAncHJvZmVzb3InLCAnbWF0ZXJpYScsICd1bml2ZXJzaWRhZCcsICdjb2xlZ2lvJ11cbiAgICBjb250ZXh0LmFjYWRlbWljID0gYWNhZGVtaWNLZXl3b3Jkcy5zb21lKHdvcmQgPT4gbWVzc2FnZS5pbmNsdWRlcyh3b3JkKSlcblxuICAgIC8vIERldGVjdGFyIHNpIGVzIHBlcnNvbmFsXG4gICAgY29uc3QgcGVyc29uYWxLZXl3b3JkcyA9IFsnZmFtaWxpYScsICdhbWlnb3MnLCAnY2FzYScsICdwZXJzb25hbCcsICd2aWRhJywgJ3NlbnRpbWllbnRvcyddXG4gICAgY29udGV4dC5wZXJzb25hbCA9IHBlcnNvbmFsS2V5d29yZHMuc29tZSh3b3JkID0+IG1lc3NhZ2UuaW5jbHVkZXMod29yZCkpXG5cbiAgICAvLyBEZXRlY3RhciB0ZW1wb3JhbGlkYWRcbiAgICBpZiAoL2F5ZXJ8YW50ZXN8cGFzYWRvfGVyYXxmdWUvLnRlc3QobWVzc2FnZSkpIGNvbnRleHQudGVtcG9yYWwgPSAncGFzdCdcbiAgICBlbHNlIGlmICgvbWHDsWFuYXxwcsOzeGltb3xmdXR1cm98ZGVzcHXDqXN8c2Vyw6kvLnRlc3QobWVzc2FnZSkpIGNvbnRleHQudGVtcG9yYWwgPSAnZnV0dXJlJ1xuICAgIGVsc2UgY29udGV4dC50ZW1wb3JhbCA9ICdwcmVzZW50J1xuXG4gICAgLy8gVXNhciBjb250ZXh0byBwcm9wb3JjaW9uYWRvXG4gICAgaWYgKHByb3ZpZGVkQ29udGV4dD8uc3ViamVjdCkge1xuICAgICAgY29udGV4dC5zdWJqZWN0ID0gcHJvdmlkZWRDb250ZXh0LnN1YmplY3RcbiAgICB9XG5cbiAgICByZXR1cm4gY29udGV4dFxuICB9XG5cbiAgLyoqXG4gICAqIFN1Z2llcmUgZWwgdGlwbyBkZSByZXNwdWVzdGEgbcOhcyBhcHJvcGlhZG9cbiAgICovXG4gIHByaXZhdGUgc3RhdGljIGdldFN1Z2dlc3RlZFJlc3BvbnNlVHlwZShlbW90aW9uOiBFbW90aW9uVHlwZSwgY29uZmlkZW5jZTogbnVtYmVyKTogRW1vdGlvbkFuYWx5c2lzWydzdWdnZXN0ZWRSZXNwb25zZSddIHtcbiAgICBjb25zdCByZXNwb25zZU1hcDogeyBba2V5IGluIEVtb3Rpb25UeXBlXTogRW1vdGlvbkFuYWx5c2lzWydzdWdnZXN0ZWRSZXNwb25zZSddIH0gPSB7XG4gICAgICBbRW1vdGlvblR5cGUuRlJVU1RSQVRFRF06ICdzdXBwb3J0aXZlJyxcbiAgICAgIFtFbW90aW9uVHlwZS5PVkVSV0hFTE1FRF06ICdzdXBwb3J0aXZlJyxcbiAgICAgIFtFbW90aW9uVHlwZS5BTlhJT1VTXTogJ2VtcGF0aGV0aWMnLFxuICAgICAgW0Vtb3Rpb25UeXBlLlNUUkVTU0VEXTogJ3NvbHV0aW9uX2ZvY3VzZWQnLFxuICAgICAgW0Vtb3Rpb25UeXBlLkNPTkZVU0VEXTogJ3Byb2Zlc3Npb25hbCcsXG4gICAgICBbRW1vdGlvblR5cGUuRElTQVBQT0lOVEVEXTogJ2VtcGF0aGV0aWMnLFxuICAgICAgW0Vtb3Rpb25UeXBlLlNBRF06ICdlbXBhdGhldGljJyxcbiAgICAgIFtFbW90aW9uVHlwZS5BTkdSWV06ICdzdXBwb3J0aXZlJyxcbiAgICAgIFtFbW90aW9uVHlwZS5GRUFSXTogJ3N1cHBvcnRpdmUnLFxuICAgICAgW0Vtb3Rpb25UeXBlLk1PVElWQVRFRF06ICdlbmNvdXJhZ2luZycsXG4gICAgICBbRW1vdGlvblR5cGUuRVhDSVRFRF06ICdlbmNvdXJhZ2luZycsXG4gICAgICBbRW1vdGlvblR5cGUuUFJPVURdOiAnZW5jb3VyYWdpbmcnLFxuICAgICAgW0Vtb3Rpb25UeXBlLkNPTkZJREVOVF06ICdtb3RpdmF0aW9uYWwnLFxuICAgICAgW0Vtb3Rpb25UeXBlLkhPUEVGVUxdOiAnbW90aXZhdGlvbmFsJyxcbiAgICAgIFtFbW90aW9uVHlwZS5DVVJJT1VTXTogJ3Byb2Zlc3Npb25hbCcsXG4gICAgICBbRW1vdGlvblR5cGUuR1JBVEVGVUxdOiAnZW5jb3VyYWdpbmcnLFxuICAgICAgW0Vtb3Rpb25UeXBlLlJFTElFVkVEXTogJ2VuY291cmFnaW5nJyxcbiAgICAgIFtFbW90aW9uVHlwZS5CT1JFRF06ICdtb3RpdmF0aW9uYWwnLFxuICAgICAgW0Vtb3Rpb25UeXBlLkhBUFBZXTogJ2VuY291cmFnaW5nJyxcbiAgICAgIFtFbW90aW9uVHlwZS5TVVJQUklTRV06ICdwcm9mZXNzaW9uYWwnLFxuICAgICAgW0Vtb3Rpb25UeXBlLk5FVVRSQUxdOiAncHJvZmVzc2lvbmFsJ1xuICAgIH1cblxuICAgIHJldHVybiByZXNwb25zZU1hcFtlbW90aW9uXSB8fCAncHJvZmVzc2lvbmFsJ1xuICB9XG5cbiAgLyoqXG4gICAqIEdlbmVyYSB1biByZXN1bWVuIHRleHR1YWwgZGVsIGFuw6FsaXNpcyBlbW9jaW9uYWxcbiAgICovXG4gIHN0YXRpYyBnZW5lcmF0ZUVtb3Rpb25TdW1tYXJ5KGFuYWx5c2lzOiBFbW90aW9uQW5hbHlzaXMpOiBzdHJpbmcge1xuICAgIGNvbnN0IGVtb3Rpb25OYW1lcyA9IHtcbiAgICAgIFtFbW90aW9uVHlwZS5GUlVTVFJBVEVEXTogJ2ZydXN0cmFkbycsXG4gICAgICBbRW1vdGlvblR5cGUuTU9USVZBVEVEXTogJ21vdGl2YWRvJyxcbiAgICAgIFtFbW90aW9uVHlwZS5DT05GVVNFRF06ICdjb25mdW5kaWRvJyxcbiAgICAgIFtFbW90aW9uVHlwZS5DT05GSURFTlRdOiAnY29uZmlhZG8nLFxuICAgICAgW0Vtb3Rpb25UeXBlLk9WRVJXSEVMTUVEXTogJ2FicnVtYWRvJyxcbiAgICAgIFtFbW90aW9uVHlwZS5DVVJJT1VTXTogJ2N1cmlvc28nLFxuICAgICAgW0Vtb3Rpb25UeXBlLlBST1VEXTogJ29yZ3VsbG9zbycsXG4gICAgICBbRW1vdGlvblR5cGUuRElTQVBQT0lOVEVEXTogJ2RlY2VwY2lvbmFkbycsXG4gICAgICBbRW1vdGlvblR5cGUuQU5YSU9VU106ICdhbnNpb3NvJyxcbiAgICAgIFtFbW90aW9uVHlwZS5FWENJVEVEXTogJ2Vtb2Npb25hZG8nLFxuICAgICAgW0Vtb3Rpb25UeXBlLkJPUkVEXTogJ2FidXJyaWRvJyxcbiAgICAgIFtFbW90aW9uVHlwZS5IT1BFRlVMXTogJ2VzcGVyYW56YWRvJyxcbiAgICAgIFtFbW90aW9uVHlwZS5TVFJFU1NFRF06ICdlc3RyZXNhZG8nLFxuICAgICAgW0Vtb3Rpb25UeXBlLlJFTElFVkVEXTogJ2FsaXZpYWRvJyxcbiAgICAgIFtFbW90aW9uVHlwZS5HUkFURUZVTF06ICdhZ3JhZGVjaWRvJyxcbiAgICAgIFtFbW90aW9uVHlwZS5IQVBQWV06ICdmZWxpeicsXG4gICAgICBbRW1vdGlvblR5cGUuU0FEXTogJ3RyaXN0ZScsXG4gICAgICBbRW1vdGlvblR5cGUuQU5HUlldOiAnZW5vamFkbycsXG4gICAgICBbRW1vdGlvblR5cGUuRkVBUl06ICd0ZW1lcm9zbycsXG4gICAgICBbRW1vdGlvblR5cGUuU1VSUFJJU0VdOiAnc29ycHJlbmRpZG8nLFxuICAgICAgW0Vtb3Rpb25UeXBlLk5FVVRSQUxdOiAnbmV1dHJhbCdcbiAgICB9XG5cbiAgICBsZXQgc3VtbWFyeSA9IGBFbCBlc3R1ZGlhbnRlIHNlIHNpZW50ZSAke2Vtb3Rpb25OYW1lc1thbmFseXNpcy5wcmltYXJ5XX0gKGNvbmZpYW56YTogJHsoYW5hbHlzaXMuY29uZmlkZW5jZSAqIDEwMCkudG9GaXhlZCgwKX0lLCBpbnRlbnNpZGFkOiAke2FuYWx5c2lzLmludGVuc2l0eX0pYFxuXG4gICAgaWYgKGFuYWx5c2lzLnNlY29uZGFyeSkge1xuICAgICAgc3VtbWFyeSArPSBgIGNvbiBtYXRpY2VzIGRlICR7ZW1vdGlvbk5hbWVzW2FuYWx5c2lzLnNlY29uZGFyeV19YFxuICAgIH1cblxuICAgIGlmIChhbmFseXNpcy5jb250ZXh0LnN1YmplY3QpIHtcbiAgICAgIHN1bW1hcnkgKz0gYCBlbiByZWxhY2nDs24gYSAke2FuYWx5c2lzLmNvbnRleHQuc3ViamVjdH1gXG4gICAgfVxuXG4gICAgcmV0dXJuIHN1bW1hcnlcbiAgfVxufSJdLCJuYW1lcyI6WyJFbW90aW9uVHlwZSIsIkVtb3Rpb25BbmFseXplciIsIkVNT1RJT05fUEFUVEVSTlMiLCJrZXl3b3JkcyIsInBocmFzZXMiLCJjb250ZXh0IiwiaW50ZW5zaXR5X211bHRpcGxpZXJzIiwiY29uZmlkZW5jZV9iYXNlIiwiYW5hbHl6ZUVtb3Rpb25zIiwibWVzc2FnZSIsImxvd2VyTWVzc2FnZSIsInRvTG93ZXJDYXNlIiwiZW1vdGlvblNjb3JlcyIsImVtb3Rpb24iLCJwYXR0ZXJuIiwiT2JqZWN0IiwiZW50cmllcyIsInNjb3JlIiwiY2FsY3VsYXRlRW1vdGlvblNjb3JlIiwicHVzaCIsImluZGljYXRvcnMiLCJnZXRNYXRjaGVkSW5kaWNhdG9ycyIsInNvcnQiLCJhIiwiYiIsInByaW1hcnkiLCJzZWNvbmRhcnkiLCJsZW5ndGgiLCJ1bmRlZmluZWQiLCJjb25maWRlbmNlIiwiTWF0aCIsIm1pbiIsImludGVuc2l0eSIsImNhbGN1bGF0ZUludGVuc2l0eSIsImFuYWx5emVFbW90aW9uYWxDb250ZXh0Iiwic3VnZ2VzdGVkUmVzcG9uc2UiLCJnZXRTdWdnZXN0ZWRSZXNwb25zZVR5cGUiLCJvcmlnaW5hbE1lc3NhZ2UiLCJtYXRjaGVzIiwia2V5d29yZCIsImluY2x1ZGVzIiwicGhyYXNlIiwidGVzdCIsImNvbnRleHRXb3JkIiwiaW50ZW5zaWZpZXIiLCJtdWx0aXBsaWVyIiwiZm9yRWFjaCIsImluZGV4IiwiaW50ZW5zaWZpZXJzIiwiaGFzSW50ZW5zaWZpZXIiLCJzb21lIiwid29yZCIsInByb3ZpZGVkQ29udGV4dCIsImFjYWRlbWljS2V5d29yZHMiLCJhY2FkZW1pYyIsInBlcnNvbmFsS2V5d29yZHMiLCJwZXJzb25hbCIsInRlbXBvcmFsIiwic3ViamVjdCIsInJlc3BvbnNlTWFwIiwiZ2VuZXJhdGVFbW90aW9uU3VtbWFyeSIsImFuYWx5c2lzIiwiZW1vdGlvbk5hbWVzIiwic3VtbWFyeSIsInRvRml4ZWQiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/emotion-analyzer.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/exercise-solver.ts":
/*!************************************!*\
  !*** ./src/lib/exercise-solver.ts ***!
  \************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   ExerciseSolver: () => (/* binding */ ExerciseSolver)\n/* harmony export */ });\n/* harmony import */ var _ai_providers__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./ai-providers */ \"(rsc)/./src/lib/ai-providers.ts\");\n\nclass ExerciseSolver {\n    /**\n   * Detecta si un mensaje contiene un ejercicio para resolver\n   */ static detectExercise(message) {\n        const msgLower = message.toLowerCase();\n        // Palabras clave que indican ejercicio a resolver\n        const exerciseKeywords = [\n            'resuelve',\n            'resuelva',\n            'resolver',\n            'resolución',\n            'calcula',\n            'calcule',\n            'calcular',\n            'cálculo',\n            'calculen',\n            'encuentra',\n            'encuentre',\n            'encontrar',\n            'hallar',\n            'halle',\n            'determina',\n            'determine',\n            'determinar',\n            'determinación',\n            'ejercicio',\n            'problema',\n            'pregunta'\n        ];\n        const hasExerciseKeyword = exerciseKeywords.some((keyword)=>msgLower.includes(keyword));\n        if (!hasExerciseKeyword) {\n            return {\n                hasExercise: false,\n                subject: 'general',\n                type: 'conceptual',\n                confidence: 0\n            };\n        }\n        // Detectar materia\n        let subject = 'general';\n        let confidence = 0.5;\n        // Palabras clave específicas por materia\n        const physicsKeywords = [\n            'presión',\n            'volumen',\n            'temperatura',\n            'gas',\n            'gases',\n            'velocidad',\n            'aceleración',\n            'fuerza',\n            'masa',\n            'energía',\n            'trabajo',\n            'potencia',\n            'momento',\n            'impulso',\n            'fricción',\n            'ley de',\n            'newton',\n            'boyle',\n            'charles',\n            'gay-lussac',\n            'cinemática',\n            'dinámica',\n            'termodinámica',\n            'mecánica',\n            'atm',\n            'mmhg',\n            'pascal',\n            'joule',\n            'watt',\n            'newton',\n            'm/s',\n            'km/h',\n            'cm³',\n            'dm³',\n            'moles',\n            'mol'\n        ];\n        const chemistryKeywords = [\n            'reacción',\n            'reactivo',\n            'producto',\n            'estequiometría',\n            'molar',\n            'molaridad',\n            'concentración',\n            'dilución',\n            'ácido',\n            'base',\n            'ph',\n            'neutralización',\n            'sal',\n            'oxidación',\n            'reducción',\n            'redox',\n            'electrólisis',\n            'enlace',\n            'iónico',\n            'covalente',\n            'molecular',\n            'átomo',\n            'molécula',\n            'elemento',\n            'compuesto',\n            'masa atómica',\n            'masa molecular',\n            'número de avogadro'\n        ];\n        const mathKeywords = [\n            'ecuación',\n            'función',\n            'derivada',\n            'integral',\n            'límite',\n            'matriz',\n            'determinante',\n            'sistema',\n            'trigonometría',\n            'logaritmo',\n            'exponencial',\n            'probabilidad',\n            'estadística',\n            'geometría',\n            'álgebra',\n            'polinomio',\n            'factorización'\n        ];\n        const physicsCount = physicsKeywords.reduce((count, word)=>count + (msgLower.includes(word) ? 1 : 0), 0);\n        const chemistryCount = chemistryKeywords.reduce((count, word)=>count + (msgLower.includes(word) ? 1 : 0), 0);\n        const mathCount = mathKeywords.reduce((count, word)=>count + (msgLower.includes(word) ? 1 : 0), 0);\n        if (physicsCount > 0) {\n            subject = 'physics';\n            confidence = Math.min(0.9, 0.6 + physicsCount * 0.1);\n        } else if (chemistryCount > 0) {\n            subject = 'chemistry';\n            confidence = Math.min(0.9, 0.6 + chemistryCount * 0.1);\n        } else if (mathCount > 0) {\n            subject = 'mathematics';\n            confidence = Math.min(0.9, 0.6 + mathCount * 0.1);\n        }\n        // Detectar tipo de ejercicio\n        let type = 'conceptual';\n        const calculationIndicators = [\n            'calcula',\n            'calcule',\n            'calcular',\n            'cálculo',\n            'calculen',\n            'encuentra',\n            'encuentre',\n            'hallar',\n            'halle',\n            'determina',\n            'determine',\n            'valor',\n            'resultado'\n        ];\n        const problemSolvingIndicators = [\n            'resuelve',\n            'resuelva',\n            'resolver',\n            'problema',\n            'ejercicio',\n            'situación',\n            'caso',\n            'escenario'\n        ];\n        if (calculationIndicators.some((indicator)=>msgLower.includes(indicator))) {\n            type = 'calculation';\n        } else if (problemSolvingIndicators.some((indicator)=>msgLower.includes(indicator))) {\n            type = 'problem_solving';\n        }\n        return {\n            hasExercise: true,\n            subject,\n            type,\n            confidence\n        };\n    }\n    /**\n   * Resuelve un ejercicio paso a paso\n   */ static async solveExercise(exerciseText, subject, studentContext) {\n        const prompt = this.createSolutionPrompt(exerciseText, subject, studentContext);\n        try {\n            const solution = await _ai_providers__WEBPACK_IMPORTED_MODULE_0__.aiService.generateExercise(prompt);\n            return {\n                subject,\n                type: 'problem_solving',\n                solution: solution === 'TEMPLATE_FALLBACK' ? this.getFallbackSolution(exerciseText, subject) : solution,\n                confidence: solution === 'TEMPLATE_FALLBACK' ? 0.3 : 0.8\n            };\n        } catch (error) {\n            console.error('Error solving exercise:', error);\n            return {\n                subject,\n                type: 'problem_solving',\n                solution: this.getFallbackSolution(exerciseText, subject),\n                confidence: 0.2\n            };\n        }\n    }\n    /**\n   * Crea el prompt especializado para resolución de ejercicios\n   */ static createSolutionPrompt(exerciseText, subject, studentContext) {\n        const subjectInstructions = {\n            physics: `\n**INSTRUCCIONES ESPECÍFICAS PARA FÍSICA:**\n- Identifica TODAS las variables dadas y las que debes encontrar\n- Convierte TODAS las unidades al Sistema Internacional (SI) si es necesario\n- Aplica las leyes y fórmulas de física apropiadas (Boyle, Charles, Gay-Lussac, Newton, etc.)\n- Realiza los cálculos paso a paso con todas las operaciones matemáticas\n- Incluye las unidades en cada paso del cálculo\n- Verifica que el resultado tenga sentido físico`,\n            chemistry: `\n**INSTRUCCIONES ESPECÍFICAS PARA QUÍMICA:**\n- Identifica los reactivos, productos y datos dados\n- Escribe la ecuación química balanceada si es necesario\n- Convierte las unidades (gramos, moles, litros, etc.) según se requiera\n- Aplica los conceptos de estequiometría, concentraciones, o leyes de gases\n- Muestra todos los factores de conversión utilizados\n- Calcula paso a paso con todas las operaciones matemáticas`,\n            mathematics: `\n**INSTRUCCIONES ESPECÍFICAS PARA MATEMÁTICAS:**\n- Identifica el tipo de problema (ecuación, función, geometría, etc.)\n- Organiza los datos dados y lo que se debe encontrar\n- Aplica las fórmulas y teoremas apropiados\n- Realiza cada operación matemática paso por paso\n- Verifica la solución sustituyendo en la ecuación original`,\n            general: `\n**INSTRUCCIONES GENERALES:**\n- Identifica el tipo de problema y la materia\n- Organiza los datos dados y lo que se debe encontrar\n- Aplica el método de resolución apropiado paso a paso`\n        };\n        return `Eres un tutor experto en ciencias exactas para estudiantes de secundaria. DEBES resolver este ejercicio COMPLETAMENTE paso a paso sin omitir ningún cálculo.\n\n${subjectInstructions[subject]}\n\n**INSTRUCCIONES CRÍTICAS:**\n- COMPLETA todos los pasos de la resolución hasta el resultado final\n- NO te detengas en el medio de los cálculos\n- INCLUYE todas las operaciones matemáticas con números\n- PRESENTA el resultado final con unidades correctas\n\n**FORMATO OBLIGATORIO DE RESPUESTA:**\n\n## 📋 **DATOS:**\n[Lista TODOS los datos dados en el ejercicio con sus unidades]\n\n## 🎯 **SE PIDE:**\n[Especifica claramente qué se debe calcular o encontrar]\n\n## 📐 **FÓRMULAS A UTILIZAR:**\n[Lista las fórmulas o leyes que aplicarás]\n\n## 🔄 **CONVERSIÓN DE UNIDADES:**\n[Si es necesario, convierte todas las unidades al sistema apropiado]\n\n## ⚡ **RESOLUCIÓN PASO A PASO:**\n\n**Paso 1:** [Explica y realiza el primer cálculo completo]\n**Paso 2:** [Explica y realiza el segundo cálculo completo]\n**Paso 3:** [Continúa con todos los cálculos necesarios]\n**Paso Final:** [Completa la resolución con el resultado numérico]\n\n## ✅ **RESULTADO FINAL:**\n[Presenta la respuesta final con unidades y explica qué significa físicamente]\n\n## 🔍 **VERIFICACIÓN:**\n[Verifica que el resultado tenga sentido y sea correcto]\n\n---\n\n**EJERCICIO A RESOLVER:**\n${exerciseText}\n\n${studentContext ? `\\n**CONTEXTO DEL ESTUDIANTE:** ${studentContext}` : ''}\n\n**IMPORTANTE: Resuelve COMPLETAMENTE hasta obtener el resultado final numérico con unidades.**`;\n    }\n    /**\n   * Solución de fallback cuando la IA no está disponible\n   */ static getFallbackSolution(exerciseText, subject) {\n        const subjectName = {\n            physics: 'Física',\n            chemistry: 'Química',\n            mathematics: 'Matemáticas',\n            general: 'Ciencias Exactas'\n        }[subject];\n        return `## 📋 **EJERCICIO IDENTIFICADO**\n\nHe detectado que necesitas resolver un ejercicio de **${subjectName}**.\n\n## 🔧 **METODOLOGÍA DE RESOLUCIÓN**\n\nPara resolver este tipo de ejercicios de ${subjectName.toLowerCase()}, sigue estos pasos:\n\n**1. ORGANIZAR DATOS:**\n- Lista todos los valores dados\n- Identifica las unidades\n- Determina qué se debe calcular\n\n**2. IDENTIFICAR FÓRMULAS:**\n- Selecciona las leyes o fórmulas apropiadas\n- Verifica que las unidades sean consistentes\n\n**3. RESOLVER PASO A PASO:**\n- Sustituye los valores en las fórmulas\n- Realiza los cálculos ordenadamente\n- Incluye unidades en cada paso\n\n**4. VERIFICAR RESULTADO:**\n- Comprueba que tenga sentido\n- Revisa las unidades finales\n\n## 💡 **RECOMENDACIÓN**\n\nTe sugiero que intentes resolver el ejercicio siguiendo estos pasos y luego me muestres tu trabajo para que pueda verificarlo y ayudarte con cualquier duda específica.\n\n¿Te gustaría que te ayude con algún paso en particular o tienes alguna duda sobre el procedimiento?`;\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUFDOztBQUVaLEVBQUVKLG1CQUFtQixDQUFDM0IsUUFBUSxDQUFDOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQXNDL0IsRUFBRWtCLGFBQWE7O0FBRWYsRUFBRUMsaUJBQWlCLENBQUMsK0JBQStCLEVBQUVBLGdCQUFnQixHQUFHLEdBQUc7OzhGQUVtQixDQUFDO0lBQzdGO0lBRUE7O0dBRUMsR0FDRCxPQUFlSyxvQkFDYk4sWUFBb0IsRUFDcEJsQixPQUE0RCxFQUNwRDtRQUVSLE1BQU1nQyxjQUFjO1lBQ2xCSixTQUFTO1lBQ1RDLFdBQVc7WUFDWEMsYUFBYTtZQUNiQyxTQUFTO1FBQ1gsQ0FBQyxDQUFDL0IsUUFBUTtRQUVWLE9BQU8sQ0FBQzs7c0RBRTBDLEVBQUVnQyxZQUFZOzs7O3lDQUkzQixFQUFFQSxZQUFZdkMsV0FBVyxHQUFHOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7bUdBd0I4QixDQUFDO0lBQ2xHO0FBQ0YiLCJzb3VyY2VzIjpbIi9Vc2Vycy9yb2RyaWdvZGliZXJuYXJkbzMzZ21haWwuY29tL0RvY3VtZW50cy9BcHAgRGV2ZWxvcG1lbnQgUHJveWVjdHMvSW50ZWxsZWdvIFBsYXRmb3JtL3NyYy9saWIvZXhlcmNpc2Utc29sdmVyLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGFpU2VydmljZSB9IGZyb20gJy4vYWktcHJvdmlkZXJzJ1xuXG5leHBvcnQgaW50ZXJmYWNlIEV4ZXJjaXNlU29sdXRpb24ge1xuICBzdWJqZWN0OiAncGh5c2ljcycgfCAnY2hlbWlzdHJ5JyB8ICdtYXRoZW1hdGljcycgfCAnZ2VuZXJhbCdcbiAgdHlwZTogJ3Byb2JsZW1fc29sdmluZycgfCAnY29uY2VwdHVhbCcgfCAnY2FsY3VsYXRpb24nXG4gIHNvbHV0aW9uOiBzdHJpbmdcbiAgY29uZmlkZW5jZTogbnVtYmVyXG59XG5cbmV4cG9ydCBjbGFzcyBFeGVyY2lzZVNvbHZlciB7XG4gIFxuICAvKipcbiAgICogRGV0ZWN0YSBzaSB1biBtZW5zYWplIGNvbnRpZW5lIHVuIGVqZXJjaWNpbyBwYXJhIHJlc29sdmVyXG4gICAqL1xuICBzdGF0aWMgZGV0ZWN0RXhlcmNpc2UobWVzc2FnZTogc3RyaW5nKToge1xuICAgIGhhc0V4ZXJjaXNlOiBib29sZWFuXG4gICAgc3ViamVjdDogJ3BoeXNpY3MnIHwgJ2NoZW1pc3RyeScgfCAnbWF0aGVtYXRpY3MnIHwgJ2dlbmVyYWwnXG4gICAgdHlwZTogJ3Byb2JsZW1fc29sdmluZycgfCAnY29uY2VwdHVhbCcgfCAnY2FsY3VsYXRpb24nXG4gICAgY29uZmlkZW5jZTogbnVtYmVyXG4gIH0ge1xuICAgIGNvbnN0IG1zZ0xvd2VyID0gbWVzc2FnZS50b0xvd2VyQ2FzZSgpXG4gICAgXG4gICAgLy8gUGFsYWJyYXMgY2xhdmUgcXVlIGluZGljYW4gZWplcmNpY2lvIGEgcmVzb2x2ZXJcbiAgICBjb25zdCBleGVyY2lzZUtleXdvcmRzID0gW1xuICAgICAgJ3Jlc3VlbHZlJywgJ3Jlc3VlbHZhJywgJ3Jlc29sdmVyJywgJ3Jlc29sdWNpw7NuJyxcbiAgICAgICdjYWxjdWxhJywgJ2NhbGN1bGUnLCAnY2FsY3VsYXInLCAnY8OhbGN1bG8nLCAnY2FsY3VsZW4nLFxuICAgICAgJ2VuY3VlbnRyYScsICdlbmN1ZW50cmUnLCAnZW5jb250cmFyJywgJ2hhbGxhcicsICdoYWxsZScsXG4gICAgICAnZGV0ZXJtaW5hJywgJ2RldGVybWluZScsICdkZXRlcm1pbmFyJywgJ2RldGVybWluYWNpw7NuJyxcbiAgICAgICdlamVyY2ljaW8nLCAncHJvYmxlbWEnLCAncHJlZ3VudGEnXG4gICAgXVxuICAgIFxuICAgIGNvbnN0IGhhc0V4ZXJjaXNlS2V5d29yZCA9IGV4ZXJjaXNlS2V5d29yZHMuc29tZShrZXl3b3JkID0+IG1zZ0xvd2VyLmluY2x1ZGVzKGtleXdvcmQpKVxuICAgIFxuICAgIGlmICghaGFzRXhlcmNpc2VLZXl3b3JkKSB7XG4gICAgICByZXR1cm4geyBoYXNFeGVyY2lzZTogZmFsc2UsIHN1YmplY3Q6ICdnZW5lcmFsJywgdHlwZTogJ2NvbmNlcHR1YWwnLCBjb25maWRlbmNlOiAwIH1cbiAgICB9XG4gICAgXG4gICAgLy8gRGV0ZWN0YXIgbWF0ZXJpYVxuICAgIGxldCBzdWJqZWN0OiAncGh5c2ljcycgfCAnY2hlbWlzdHJ5JyB8ICdtYXRoZW1hdGljcycgfCAnZ2VuZXJhbCcgPSAnZ2VuZXJhbCdcbiAgICBsZXQgY29uZmlkZW5jZSA9IDAuNVxuICAgIFxuICAgIC8vIFBhbGFicmFzIGNsYXZlIGVzcGVjw61maWNhcyBwb3IgbWF0ZXJpYVxuICAgIGNvbnN0IHBoeXNpY3NLZXl3b3JkcyA9IFtcbiAgICAgICdwcmVzacOzbicsICd2b2x1bWVuJywgJ3RlbXBlcmF0dXJhJywgJ2dhcycsICdnYXNlcycsXG4gICAgICAndmVsb2NpZGFkJywgJ2FjZWxlcmFjacOzbicsICdmdWVyemEnLCAnbWFzYScsICdlbmVyZ8OtYScsXG4gICAgICAndHJhYmFqbycsICdwb3RlbmNpYScsICdtb21lbnRvJywgJ2ltcHVsc28nLCAnZnJpY2Npw7NuJyxcbiAgICAgICdsZXkgZGUnLCAnbmV3dG9uJywgJ2JveWxlJywgJ2NoYXJsZXMnLCAnZ2F5LWx1c3NhYycsXG4gICAgICAnY2luZW3DoXRpY2EnLCAnZGluw6FtaWNhJywgJ3Rlcm1vZGluw6FtaWNhJywgJ21lY8OhbmljYScsXG4gICAgICAnYXRtJywgJ21taGcnLCAncGFzY2FsJywgJ2pvdWxlJywgJ3dhdHQnLCAnbmV3dG9uJyxcbiAgICAgICdtL3MnLCAna20vaCcsICdjbcKzJywgJ2RtwrMnLCAnbW9sZXMnLCAnbW9sJ1xuICAgIF1cbiAgICBcbiAgICBjb25zdCBjaGVtaXN0cnlLZXl3b3JkcyA9IFtcbiAgICAgICdyZWFjY2nDs24nLCAncmVhY3Rpdm8nLCAncHJvZHVjdG8nLCAnZXN0ZXF1aW9tZXRyw61hJyxcbiAgICAgICdtb2xhcicsICdtb2xhcmlkYWQnLCAnY29uY2VudHJhY2nDs24nLCAnZGlsdWNpw7NuJyxcbiAgICAgICfDoWNpZG8nLCAnYmFzZScsICdwaCcsICduZXV0cmFsaXphY2nDs24nLCAnc2FsJyxcbiAgICAgICdveGlkYWNpw7NuJywgJ3JlZHVjY2nDs24nLCAncmVkb3gnLCAnZWxlY3Ryw7NsaXNpcycsXG4gICAgICAnZW5sYWNlJywgJ2nDs25pY28nLCAnY292YWxlbnRlJywgJ21vbGVjdWxhcicsXG4gICAgICAnw6F0b21vJywgJ21vbMOpY3VsYScsICdlbGVtZW50bycsICdjb21wdWVzdG8nLFxuICAgICAgJ21hc2EgYXTDs21pY2EnLCAnbWFzYSBtb2xlY3VsYXInLCAnbsO6bWVybyBkZSBhdm9nYWRybydcbiAgICBdXG4gICAgXG4gICAgY29uc3QgbWF0aEtleXdvcmRzID0gW1xuICAgICAgJ2VjdWFjacOzbicsICdmdW5jacOzbicsICdkZXJpdmFkYScsICdpbnRlZ3JhbCcsXG4gICAgICAnbMOtbWl0ZScsICdtYXRyaXonLCAnZGV0ZXJtaW5hbnRlJywgJ3Npc3RlbWEnLFxuICAgICAgJ3RyaWdvbm9tZXRyw61hJywgJ2xvZ2FyaXRtbycsICdleHBvbmVuY2lhbCcsXG4gICAgICAncHJvYmFiaWxpZGFkJywgJ2VzdGFkw61zdGljYScsICdnZW9tZXRyw61hJyxcbiAgICAgICfDoWxnZWJyYScsICdwb2xpbm9taW8nLCAnZmFjdG9yaXphY2nDs24nXG4gICAgXVxuICAgIFxuICAgIGNvbnN0IHBoeXNpY3NDb3VudCA9IHBoeXNpY3NLZXl3b3Jkcy5yZWR1Y2UoKGNvdW50LCB3b3JkKSA9PiBjb3VudCArIChtc2dMb3dlci5pbmNsdWRlcyh3b3JkKSA/IDEgOiAwKSwgMClcbiAgICBjb25zdCBjaGVtaXN0cnlDb3VudCA9IGNoZW1pc3RyeUtleXdvcmRzLnJlZHVjZSgoY291bnQsIHdvcmQpID0+IGNvdW50ICsgKG1zZ0xvd2VyLmluY2x1ZGVzKHdvcmQpID8gMSA6IDApLCAwKVxuICAgIGNvbnN0IG1hdGhDb3VudCA9IG1hdGhLZXl3b3Jkcy5yZWR1Y2UoKGNvdW50LCB3b3JkKSA9PiBjb3VudCArIChtc2dMb3dlci5pbmNsdWRlcyh3b3JkKSA/IDEgOiAwKSwgMClcbiAgICBcbiAgICBpZiAocGh5c2ljc0NvdW50ID4gMCkge1xuICAgICAgc3ViamVjdCA9ICdwaHlzaWNzJ1xuICAgICAgY29uZmlkZW5jZSA9IE1hdGgubWluKDAuOSwgMC42ICsgcGh5c2ljc0NvdW50ICogMC4xKVxuICAgIH0gZWxzZSBpZiAoY2hlbWlzdHJ5Q291bnQgPiAwKSB7XG4gICAgICBzdWJqZWN0ID0gJ2NoZW1pc3RyeSdcbiAgICAgIGNvbmZpZGVuY2UgPSBNYXRoLm1pbigwLjksIDAuNiArIGNoZW1pc3RyeUNvdW50ICogMC4xKVxuICAgIH0gZWxzZSBpZiAobWF0aENvdW50ID4gMCkge1xuICAgICAgc3ViamVjdCA9ICdtYXRoZW1hdGljcydcbiAgICAgIGNvbmZpZGVuY2UgPSBNYXRoLm1pbigwLjksIDAuNiArIG1hdGhDb3VudCAqIDAuMSlcbiAgICB9XG4gICAgXG4gICAgLy8gRGV0ZWN0YXIgdGlwbyBkZSBlamVyY2ljaW9cbiAgICBsZXQgdHlwZTogJ3Byb2JsZW1fc29sdmluZycgfCAnY29uY2VwdHVhbCcgfCAnY2FsY3VsYXRpb24nID0gJ2NvbmNlcHR1YWwnXG4gICAgXG4gICAgY29uc3QgY2FsY3VsYXRpb25JbmRpY2F0b3JzID0gW1xuICAgICAgJ2NhbGN1bGEnLCAnY2FsY3VsZScsICdjYWxjdWxhcicsICdjw6FsY3VsbycsICdjYWxjdWxlbicsXG4gICAgICAnZW5jdWVudHJhJywgJ2VuY3VlbnRyZScsICdoYWxsYXInLCAnaGFsbGUnLFxuICAgICAgJ2RldGVybWluYScsICdkZXRlcm1pbmUnLCAndmFsb3InLCAncmVzdWx0YWRvJ1xuICAgIF1cbiAgICBcbiAgICBjb25zdCBwcm9ibGVtU29sdmluZ0luZGljYXRvcnMgPSBbXG4gICAgICAncmVzdWVsdmUnLCAncmVzdWVsdmEnLCAncmVzb2x2ZXInLCAncHJvYmxlbWEnLFxuICAgICAgJ2VqZXJjaWNpbycsICdzaXR1YWNpw7NuJywgJ2Nhc28nLCAnZXNjZW5hcmlvJ1xuICAgIF1cbiAgICBcbiAgICBpZiAoY2FsY3VsYXRpb25JbmRpY2F0b3JzLnNvbWUoaW5kaWNhdG9yID0+IG1zZ0xvd2VyLmluY2x1ZGVzKGluZGljYXRvcikpKSB7XG4gICAgICB0eXBlID0gJ2NhbGN1bGF0aW9uJ1xuICAgIH0gZWxzZSBpZiAocHJvYmxlbVNvbHZpbmdJbmRpY2F0b3JzLnNvbWUoaW5kaWNhdG9yID0+IG1zZ0xvd2VyLmluY2x1ZGVzKGluZGljYXRvcikpKSB7XG4gICAgICB0eXBlID0gJ3Byb2JsZW1fc29sdmluZydcbiAgICB9XG4gICAgXG4gICAgcmV0dXJuIHtcbiAgICAgIGhhc0V4ZXJjaXNlOiB0cnVlLFxuICAgICAgc3ViamVjdCxcbiAgICAgIHR5cGUsXG4gICAgICBjb25maWRlbmNlXG4gICAgfVxuICB9XG4gIFxuICAvKipcbiAgICogUmVzdWVsdmUgdW4gZWplcmNpY2lvIHBhc28gYSBwYXNvXG4gICAqL1xuICBzdGF0aWMgYXN5bmMgc29sdmVFeGVyY2lzZShcbiAgICBleGVyY2lzZVRleHQ6IHN0cmluZywgXG4gICAgc3ViamVjdDogJ3BoeXNpY3MnIHwgJ2NoZW1pc3RyeScgfCAnbWF0aGVtYXRpY3MnIHwgJ2dlbmVyYWwnLFxuICAgIHN0dWRlbnRDb250ZXh0Pzogc3RyaW5nXG4gICk6IFByb21pc2U8RXhlcmNpc2VTb2x1dGlvbj4ge1xuICAgIFxuICAgIGNvbnN0IHByb21wdCA9IHRoaXMuY3JlYXRlU29sdXRpb25Qcm9tcHQoZXhlcmNpc2VUZXh0LCBzdWJqZWN0LCBzdHVkZW50Q29udGV4dClcbiAgICBcbiAgICB0cnkge1xuICAgICAgY29uc3Qgc29sdXRpb24gPSBhd2FpdCBhaVNlcnZpY2UuZ2VuZXJhdGVFeGVyY2lzZShwcm9tcHQpXG4gICAgICBcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHN1YmplY3QsXG4gICAgICAgIHR5cGU6ICdwcm9ibGVtX3NvbHZpbmcnLFxuICAgICAgICBzb2x1dGlvbjogc29sdXRpb24gPT09ICdURU1QTEFURV9GQUxMQkFDSycgPyBcbiAgICAgICAgICB0aGlzLmdldEZhbGxiYWNrU29sdXRpb24oZXhlcmNpc2VUZXh0LCBzdWJqZWN0KSA6IFxuICAgICAgICAgIHNvbHV0aW9uLFxuICAgICAgICBjb25maWRlbmNlOiBzb2x1dGlvbiA9PT0gJ1RFTVBMQVRFX0ZBTExCQUNLJyA/IDAuMyA6IDAuOFxuICAgICAgfVxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBzb2x2aW5nIGV4ZXJjaXNlOicsIGVycm9yKVxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3ViamVjdCxcbiAgICAgICAgdHlwZTogJ3Byb2JsZW1fc29sdmluZycsXG4gICAgICAgIHNvbHV0aW9uOiB0aGlzLmdldEZhbGxiYWNrU29sdXRpb24oZXhlcmNpc2VUZXh0LCBzdWJqZWN0KSxcbiAgICAgICAgY29uZmlkZW5jZTogMC4yXG4gICAgICB9XG4gICAgfVxuICB9XG4gIFxuICAvKipcbiAgICogQ3JlYSBlbCBwcm9tcHQgZXNwZWNpYWxpemFkbyBwYXJhIHJlc29sdWNpw7NuIGRlIGVqZXJjaWNpb3NcbiAgICovXG4gIHByaXZhdGUgc3RhdGljIGNyZWF0ZVNvbHV0aW9uUHJvbXB0KFxuICAgIGV4ZXJjaXNlVGV4dDogc3RyaW5nLCBcbiAgICBzdWJqZWN0OiAncGh5c2ljcycgfCAnY2hlbWlzdHJ5JyB8ICdtYXRoZW1hdGljcycgfCAnZ2VuZXJhbCcsXG4gICAgc3R1ZGVudENvbnRleHQ/OiBzdHJpbmdcbiAgKTogc3RyaW5nIHtcbiAgICBcbiAgICBjb25zdCBzdWJqZWN0SW5zdHJ1Y3Rpb25zID0ge1xuICAgICAgcGh5c2ljczogYFxuKipJTlNUUlVDQ0lPTkVTIEVTUEVDw41GSUNBUyBQQVJBIEbDjVNJQ0E6Kipcbi0gSWRlbnRpZmljYSBUT0RBUyBsYXMgdmFyaWFibGVzIGRhZGFzIHkgbGFzIHF1ZSBkZWJlcyBlbmNvbnRyYXJcbi0gQ29udmllcnRlIFRPREFTIGxhcyB1bmlkYWRlcyBhbCBTaXN0ZW1hIEludGVybmFjaW9uYWwgKFNJKSBzaSBlcyBuZWNlc2FyaW9cbi0gQXBsaWNhIGxhcyBsZXllcyB5IGbDs3JtdWxhcyBkZSBmw61zaWNhIGFwcm9waWFkYXMgKEJveWxlLCBDaGFybGVzLCBHYXktTHVzc2FjLCBOZXd0b24sIGV0Yy4pXG4tIFJlYWxpemEgbG9zIGPDoWxjdWxvcyBwYXNvIGEgcGFzbyBjb24gdG9kYXMgbGFzIG9wZXJhY2lvbmVzIG1hdGVtw6F0aWNhc1xuLSBJbmNsdXllIGxhcyB1bmlkYWRlcyBlbiBjYWRhIHBhc28gZGVsIGPDoWxjdWxvXG4tIFZlcmlmaWNhIHF1ZSBlbCByZXN1bHRhZG8gdGVuZ2Egc2VudGlkbyBmw61zaWNvYCxcbiAgICAgIFxuICAgICAgY2hlbWlzdHJ5OiBgXG4qKklOU1RSVUNDSU9ORVMgRVNQRUPDjUZJQ0FTIFBBUkEgUVXDjU1JQ0E6Kipcbi0gSWRlbnRpZmljYSBsb3MgcmVhY3Rpdm9zLCBwcm9kdWN0b3MgeSBkYXRvcyBkYWRvc1xuLSBFc2NyaWJlIGxhIGVjdWFjacOzbiBxdcOtbWljYSBiYWxhbmNlYWRhIHNpIGVzIG5lY2VzYXJpb1xuLSBDb252aWVydGUgbGFzIHVuaWRhZGVzIChncmFtb3MsIG1vbGVzLCBsaXRyb3MsIGV0Yy4pIHNlZ8O6biBzZSByZXF1aWVyYVxuLSBBcGxpY2EgbG9zIGNvbmNlcHRvcyBkZSBlc3RlcXVpb21ldHLDrWEsIGNvbmNlbnRyYWNpb25lcywgbyBsZXllcyBkZSBnYXNlc1xuLSBNdWVzdHJhIHRvZG9zIGxvcyBmYWN0b3JlcyBkZSBjb252ZXJzacOzbiB1dGlsaXphZG9zXG4tIENhbGN1bGEgcGFzbyBhIHBhc28gY29uIHRvZGFzIGxhcyBvcGVyYWNpb25lcyBtYXRlbcOhdGljYXNgLFxuICAgICAgXG4gICAgICBtYXRoZW1hdGljczogYFxuKipJTlNUUlVDQ0lPTkVTIEVTUEVDw41GSUNBUyBQQVJBIE1BVEVNw4FUSUNBUzoqKlxuLSBJZGVudGlmaWNhIGVsIHRpcG8gZGUgcHJvYmxlbWEgKGVjdWFjacOzbiwgZnVuY2nDs24sIGdlb21ldHLDrWEsIGV0Yy4pXG4tIE9yZ2FuaXphIGxvcyBkYXRvcyBkYWRvcyB5IGxvIHF1ZSBzZSBkZWJlIGVuY29udHJhclxuLSBBcGxpY2EgbGFzIGbDs3JtdWxhcyB5IHRlb3JlbWFzIGFwcm9waWFkb3Ncbi0gUmVhbGl6YSBjYWRhIG9wZXJhY2nDs24gbWF0ZW3DoXRpY2EgcGFzbyBwb3IgcGFzb1xuLSBWZXJpZmljYSBsYSBzb2x1Y2nDs24gc3VzdGl0dXllbmRvIGVuIGxhIGVjdWFjacOzbiBvcmlnaW5hbGAsXG4gICAgICBcbiAgICAgIGdlbmVyYWw6IGBcbioqSU5TVFJVQ0NJT05FUyBHRU5FUkFMRVM6Kipcbi0gSWRlbnRpZmljYSBlbCB0aXBvIGRlIHByb2JsZW1hIHkgbGEgbWF0ZXJpYVxuLSBPcmdhbml6YSBsb3MgZGF0b3MgZGFkb3MgeSBsbyBxdWUgc2UgZGViZSBlbmNvbnRyYXJcbi0gQXBsaWNhIGVsIG3DqXRvZG8gZGUgcmVzb2x1Y2nDs24gYXByb3BpYWRvIHBhc28gYSBwYXNvYFxuICAgIH1cbiAgICBcbiAgICByZXR1cm4gYEVyZXMgdW4gdHV0b3IgZXhwZXJ0byBlbiBjaWVuY2lhcyBleGFjdGFzIHBhcmEgZXN0dWRpYW50ZXMgZGUgc2VjdW5kYXJpYS4gREVCRVMgcmVzb2x2ZXIgZXN0ZSBlamVyY2ljaW8gQ09NUExFVEFNRU5URSBwYXNvIGEgcGFzbyBzaW4gb21pdGlyIG5pbmfDum4gY8OhbGN1bG8uXG5cbiR7c3ViamVjdEluc3RydWN0aW9uc1tzdWJqZWN0XX1cblxuKipJTlNUUlVDQ0lPTkVTIENSw41USUNBUzoqKlxuLSBDT01QTEVUQSB0b2RvcyBsb3MgcGFzb3MgZGUgbGEgcmVzb2x1Y2nDs24gaGFzdGEgZWwgcmVzdWx0YWRvIGZpbmFsXG4tIE5PIHRlIGRldGVuZ2FzIGVuIGVsIG1lZGlvIGRlIGxvcyBjw6FsY3Vsb3Ncbi0gSU5DTFVZRSB0b2RhcyBsYXMgb3BlcmFjaW9uZXMgbWF0ZW3DoXRpY2FzIGNvbiBuw7ptZXJvc1xuLSBQUkVTRU5UQSBlbCByZXN1bHRhZG8gZmluYWwgY29uIHVuaWRhZGVzIGNvcnJlY3Rhc1xuXG4qKkZPUk1BVE8gT0JMSUdBVE9SSU8gREUgUkVTUFVFU1RBOioqXG5cbiMjIPCfk4sgKipEQVRPUzoqKlxuW0xpc3RhIFRPRE9TIGxvcyBkYXRvcyBkYWRvcyBlbiBlbCBlamVyY2ljaW8gY29uIHN1cyB1bmlkYWRlc11cblxuIyMg8J+OryAqKlNFIFBJREU6KipcbltFc3BlY2lmaWNhIGNsYXJhbWVudGUgcXXDqSBzZSBkZWJlIGNhbGN1bGFyIG8gZW5jb250cmFyXVxuXG4jIyDwn5OQICoqRsOTUk1VTEFTIEEgVVRJTElaQVI6KipcbltMaXN0YSBsYXMgZsOzcm11bGFzIG8gbGV5ZXMgcXVlIGFwbGljYXLDoXNdXG5cbiMjIPCflIQgKipDT05WRVJTScOTTiBERSBVTklEQURFUzoqKlxuW1NpIGVzIG5lY2VzYXJpbywgY29udmllcnRlIHRvZGFzIGxhcyB1bmlkYWRlcyBhbCBzaXN0ZW1hIGFwcm9waWFkb11cblxuIyMg4pqhICoqUkVTT0xVQ0nDk04gUEFTTyBBIFBBU086KipcblxuKipQYXNvIDE6KiogW0V4cGxpY2EgeSByZWFsaXphIGVsIHByaW1lciBjw6FsY3VsbyBjb21wbGV0b11cbioqUGFzbyAyOioqIFtFeHBsaWNhIHkgcmVhbGl6YSBlbCBzZWd1bmRvIGPDoWxjdWxvIGNvbXBsZXRvXVxuKipQYXNvIDM6KiogW0NvbnRpbsO6YSBjb24gdG9kb3MgbG9zIGPDoWxjdWxvcyBuZWNlc2FyaW9zXVxuKipQYXNvIEZpbmFsOioqIFtDb21wbGV0YSBsYSByZXNvbHVjacOzbiBjb24gZWwgcmVzdWx0YWRvIG51bcOpcmljb11cblxuIyMg4pyFICoqUkVTVUxUQURPIEZJTkFMOioqXG5bUHJlc2VudGEgbGEgcmVzcHVlc3RhIGZpbmFsIGNvbiB1bmlkYWRlcyB5IGV4cGxpY2EgcXXDqSBzaWduaWZpY2EgZsOtc2ljYW1lbnRlXVxuXG4jIyDwn5SNICoqVkVSSUZJQ0FDScOTTjoqKlxuW1ZlcmlmaWNhIHF1ZSBlbCByZXN1bHRhZG8gdGVuZ2Egc2VudGlkbyB5IHNlYSBjb3JyZWN0b11cblxuLS0tXG5cbioqRUpFUkNJQ0lPIEEgUkVTT0xWRVI6KipcbiR7ZXhlcmNpc2VUZXh0fVxuXG4ke3N0dWRlbnRDb250ZXh0ID8gYFxcbioqQ09OVEVYVE8gREVMIEVTVFVESUFOVEU6KiogJHtzdHVkZW50Q29udGV4dH1gIDogJyd9XG5cbioqSU1QT1JUQU5URTogUmVzdWVsdmUgQ09NUExFVEFNRU5URSBoYXN0YSBvYnRlbmVyIGVsIHJlc3VsdGFkbyBmaW5hbCBudW3DqXJpY28gY29uIHVuaWRhZGVzLioqYFxuICB9XG4gIFxuICAvKipcbiAgICogU29sdWNpw7NuIGRlIGZhbGxiYWNrIGN1YW5kbyBsYSBJQSBubyBlc3TDoSBkaXNwb25pYmxlXG4gICAqL1xuICBwcml2YXRlIHN0YXRpYyBnZXRGYWxsYmFja1NvbHV0aW9uKFxuICAgIGV4ZXJjaXNlVGV4dDogc3RyaW5nLCBcbiAgICBzdWJqZWN0OiAncGh5c2ljcycgfCAnY2hlbWlzdHJ5JyB8ICdtYXRoZW1hdGljcycgfCAnZ2VuZXJhbCdcbiAgKTogc3RyaW5nIHtcbiAgICBcbiAgICBjb25zdCBzdWJqZWN0TmFtZSA9IHtcbiAgICAgIHBoeXNpY3M6ICdGw61zaWNhJyxcbiAgICAgIGNoZW1pc3RyeTogJ1F1w61taWNhJywgXG4gICAgICBtYXRoZW1hdGljczogJ01hdGVtw6F0aWNhcycsXG4gICAgICBnZW5lcmFsOiAnQ2llbmNpYXMgRXhhY3RhcydcbiAgICB9W3N1YmplY3RdXG4gICAgXG4gICAgcmV0dXJuIGAjIyDwn5OLICoqRUpFUkNJQ0lPIElERU5USUZJQ0FETyoqXG5cbkhlIGRldGVjdGFkbyBxdWUgbmVjZXNpdGFzIHJlc29sdmVyIHVuIGVqZXJjaWNpbyBkZSAqKiR7c3ViamVjdE5hbWV9KiouXG5cbiMjIPCflKcgKipNRVRPRE9MT0fDjUEgREUgUkVTT0xVQ0nDk04qKlxuXG5QYXJhIHJlc29sdmVyIGVzdGUgdGlwbyBkZSBlamVyY2ljaW9zIGRlICR7c3ViamVjdE5hbWUudG9Mb3dlckNhc2UoKX0sIHNpZ3VlIGVzdG9zIHBhc29zOlxuXG4qKjEuIE9SR0FOSVpBUiBEQVRPUzoqKlxuLSBMaXN0YSB0b2RvcyBsb3MgdmFsb3JlcyBkYWRvc1xuLSBJZGVudGlmaWNhIGxhcyB1bmlkYWRlc1xuLSBEZXRlcm1pbmEgcXXDqSBzZSBkZWJlIGNhbGN1bGFyXG5cbioqMi4gSURFTlRJRklDQVIgRsOTUk1VTEFTOioqXG4tIFNlbGVjY2lvbmEgbGFzIGxleWVzIG8gZsOzcm11bGFzIGFwcm9waWFkYXNcbi0gVmVyaWZpY2EgcXVlIGxhcyB1bmlkYWRlcyBzZWFuIGNvbnNpc3RlbnRlc1xuXG4qKjMuIFJFU09MVkVSIFBBU08gQSBQQVNPOioqXG4tIFN1c3RpdHV5ZSBsb3MgdmFsb3JlcyBlbiBsYXMgZsOzcm11bGFzXG4tIFJlYWxpemEgbG9zIGPDoWxjdWxvcyBvcmRlbmFkYW1lbnRlXG4tIEluY2x1eWUgdW5pZGFkZXMgZW4gY2FkYSBwYXNvXG5cbioqNC4gVkVSSUZJQ0FSIFJFU1VMVEFETzoqKlxuLSBDb21wcnVlYmEgcXVlIHRlbmdhIHNlbnRpZG9cbi0gUmV2aXNhIGxhcyB1bmlkYWRlcyBmaW5hbGVzXG5cbiMjIPCfkqEgKipSRUNPTUVOREFDScOTTioqXG5cblRlIHN1Z2llcm8gcXVlIGludGVudGVzIHJlc29sdmVyIGVsIGVqZXJjaWNpbyBzaWd1aWVuZG8gZXN0b3MgcGFzb3MgeSBsdWVnbyBtZSBtdWVzdHJlcyB0dSB0cmFiYWpvIHBhcmEgcXVlIHB1ZWRhIHZlcmlmaWNhcmxvIHkgYXl1ZGFydGUgY29uIGN1YWxxdWllciBkdWRhIGVzcGVjw61maWNhLlxuXG7Cv1RlIGd1c3RhcsOtYSBxdWUgdGUgYXl1ZGUgY29uIGFsZ8O6biBwYXNvIGVuIHBhcnRpY3VsYXIgbyB0aWVuZXMgYWxndW5hIGR1ZGEgc29icmUgZWwgcHJvY2VkaW1pZW50bz9gXG4gIH1cbn0iXSwibmFtZXMiOlsiYWlTZXJ2aWNlIiwiRXhlcmNpc2VTb2x2ZXIiLCJkZXRlY3RFeGVyY2lzZSIsIm1lc3NhZ2UiLCJtc2dMb3dlciIsInRvTG93ZXJDYXNlIiwiZXhlcmNpc2VLZXl3b3JkcyIsImhhc0V4ZXJjaXNlS2V5d29yZCIsInNvbWUiLCJrZXl3b3JkIiwiaW5jbHVkZXMiLCJoYXNFeGVyY2lzZSIsInN1YmplY3QiLCJ0eXBlIiwiY29uZmlkZW5jZSIsInBoeXNpY3NLZXl3b3JkcyIsImNoZW1pc3RyeUtleXdvcmRzIiwibWF0aEtleXdvcmRzIiwicGh5c2ljc0NvdW50IiwicmVkdWNlIiwiY291bnQiLCJ3b3JkIiwiY2hlbWlzdHJ5Q291bnQiLCJtYXRoQ291bnQiLCJNYXRoIiwibWluIiwiY2FsY3VsYXRpb25JbmRpY2F0b3JzIiwicHJvYmxlbVNvbHZpbmdJbmRpY2F0b3JzIiwiaW5kaWNhdG9yIiwic29sdmVFeGVyY2lzZSIsImV4ZXJjaXNlVGV4dCIsInN0dWRlbnRDb250ZXh0IiwicHJvbXB0IiwiY3JlYXRlU29sdXRpb25Qcm9tcHQiLCJzb2x1dGlvbiIsImdlbmVyYXRlRXhlcmNpc2UiLCJnZXRGYWxsYmFja1NvbHV0aW9uIiwiZXJyb3IiLCJjb25zb2xlIiwic3ViamVjdEluc3RydWN0aW9ucyIsInBoeXNpY3MiLCJjaGVtaXN0cnkiLCJtYXRoZW1hdGljcyIsImdlbmVyYWwiLCJzdWJqZWN0TmFtZSJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/exercise-solver.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/hybrid-storage.ts":
/*!***********************************!*\
  !*** ./src/lib/hybrid-storage.ts ***!
  \***********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   canSubmitThisWeek: () => (/* binding */ canSubmitThisWeek),\n/* harmony export */   createProgressReport: () => (/* binding */ createProgressReport),\n/* harmony export */   createUser: () => (/* binding */ createUser),\n/* harmony export */   findProgressReportByUserAndWeek: () => (/* binding */ findProgressReportByUserAndWeek),\n/* harmony export */   findProgressReportsByUser: () => (/* binding */ findProgressReportsByUser),\n/* harmony export */   findUserByEmail: () => (/* binding */ findUserByEmail),\n/* harmony export */   findUserById: () => (/* binding */ findUserById),\n/* harmony export */   findUsersByRole: () => (/* binding */ findUsersByRole),\n/* harmony export */   generateStudentId: () => (/* binding */ generateStudentId),\n/* harmony export */   getAllProgressReports: () => (/* binding */ getAllProgressReports),\n/* harmony export */   getAllUsers: () => (/* binding */ getAllUsers),\n/* harmony export */   getCurrentWeekEnd: () => (/* binding */ getCurrentWeekEnd),\n/* harmony export */   getCurrentWeekStart: () => (/* binding */ getCurrentWeekStart),\n/* harmony export */   getMonthWeeks: () => (/* binding */ getMonthWeeks),\n/* harmony export */   initializeStorage: () => (/* binding */ initializeStorage),\n/* harmony export */   validateStudentId: () => (/* binding */ validateStudentId)\n/* harmony export */ });\n/* harmony import */ var _temp_storage__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./temp-storage */ \"(rsc)/./src/lib/temp-storage.ts\");\n// Hybrid storage system that can work with database or fallback to temp-storage\n\n// For now, use temp-storage exclusively to ensure stability\nconst useDatabase = false;\nconsole.log('🔄 Using temp-storage system for reliability');\n// Initialize the storage system\nasync function initializeStorage() {\n    console.log('✅ Temp-storage system initialized');\n}\n// User management functions with fallback\nasync function createUser(userData) {\n    const hashedPassword = (__webpack_require__(/*! bcryptjs */ \"(rsc)/./node_modules/bcryptjs/umd/index.js\").hashSync)(userData.password, 12);\n    const user = {\n        id: Date.now().toString(),\n        ...userData,\n        password: hashedPassword,\n        createdAt: new Date(),\n        updatedAt: new Date(),\n        status: 'ACTIVE'\n    };\n    _temp_storage__WEBPACK_IMPORTED_MODULE_0__.addUser(user);\n    return user;\n}\nasync function findUserByEmail(email) {\n    return _temp_storage__WEBPACK_IMPORTED_MODULE_0__.findUserByEmail(email);\n}\nasync function getAllUsers() {\n    return _temp_storage__WEBPACK_IMPORTED_MODULE_0__.getAllUsers();\n}\nasync function findUsersByRole(role) {\n    return _temp_storage__WEBPACK_IMPORTED_MODULE_0__.findUsersByRole(role);\n}\nasync function findUserById(id) {\n    return _temp_storage__WEBPACK_IMPORTED_MODULE_0__.findUserById(id);\n}\nasync function generateStudentId() {\n    return _temp_storage__WEBPACK_IMPORTED_MODULE_0__.generateStudentId();\n}\n// Progress reports functions with fallback\nasync function createProgressReport(data) {\n    const report = {\n        id: Date.now().toString(),\n        userId: data.userId,\n        weekStart: data.weekStart,\n        weekEnd: data.weekEnd,\n        submittedAt: new Date(),\n        responses: data.responses\n    };\n    _temp_storage__WEBPACK_IMPORTED_MODULE_0__.addWeeklyReport(report);\n    return report;\n}\nasync function findProgressReportsByUser(userId) {\n    return _temp_storage__WEBPACK_IMPORTED_MODULE_0__.findWeeklyReportsByUser(userId);\n}\nasync function getAllProgressReports() {\n    return _temp_storage__WEBPACK_IMPORTED_MODULE_0__.getAllWeeklyReports();\n}\nasync function findProgressReportByUserAndWeek(userId, weekStart) {\n    return _temp_storage__WEBPACK_IMPORTED_MODULE_0__.findWeeklyReportByUserAndWeek(userId, weekStart);\n}\nasync function canSubmitThisWeek(userId) {\n    return _temp_storage__WEBPACK_IMPORTED_MODULE_0__.canSubmitThisWeek(userId);\n}\n// Utility functions (same for both)\nfunction getCurrentWeekStart() {\n    return _temp_storage__WEBPACK_IMPORTED_MODULE_0__.getCurrentWeekStart();\n}\nfunction getCurrentWeekEnd() {\n    return _temp_storage__WEBPACK_IMPORTED_MODULE_0__.getCurrentWeekEnd();\n}\nfunction getMonthWeeks(year, month) {\n    return _temp_storage__WEBPACK_IMPORTED_MODULE_0__.getMonthWeeks(year, month);\n}\nfunction validateStudentId(studentId) {\n    return _temp_storage__WEBPACK_IMPORTED_MODULE_0__.validateStudentId(studentId);\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvbGliL2h5YnJpZC1zdG9yYWdlLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUEsZ0ZBQWdGO0FBQ25DO0FBRTdDLDREQUE0RDtBQUM1RCxNQUFNQyxjQUFjO0FBRXBCQyxRQUFRQyxHQUFHLENBQUM7QUFFWixnQ0FBZ0M7QUFDekIsZUFBZUM7SUFDcEJGLFFBQVFDLEdBQUcsQ0FBQztBQUNkO0FBRUEsMENBQTBDO0FBQ25DLGVBQWVFLFdBQVdDLFFBQWE7SUFDNUMsTUFBTUMsaUJBQWlCQyw0RkFBNEIsQ0FBQ0YsU0FBU0ksUUFBUSxFQUFFO0lBQ3ZFLE1BQU1DLE9BQU87UUFDWEMsSUFBSUMsS0FBS0MsR0FBRyxHQUFHQyxRQUFRO1FBQ3ZCLEdBQUdULFFBQVE7UUFDWEksVUFBVUg7UUFDVlMsV0FBVyxJQUFJSDtRQUNmSSxXQUFXLElBQUlKO1FBQ2ZLLFFBQVE7SUFDVjtJQUNBbEIsa0RBQW1CLENBQUNXO0lBQ3BCLE9BQU9BO0FBQ1Q7QUFFTyxlQUFlUyxnQkFBZ0JDLEtBQWE7SUFDakQsT0FBT3JCLDBEQUEyQixDQUFDcUI7QUFDckM7QUFFTyxlQUFlQztJQUNwQixPQUFPdEIsc0RBQXVCO0FBQ2hDO0FBRU8sZUFBZXVCLGdCQUFnQkMsSUFBUztJQUM3QyxPQUFPeEIsMERBQTJCLENBQUN3QjtBQUNyQztBQUVPLGVBQWVDLGFBQWFiLEVBQVU7SUFDM0MsT0FBT1osdURBQXdCLENBQUNZO0FBQ2xDO0FBRU8sZUFBZWM7SUFDcEIsT0FBTzFCLDREQUE2QjtBQUN0QztBQUVBLDJDQUEyQztBQUNwQyxlQUFlMkIscUJBQXFCQyxJQUFTO0lBQ2xELE1BQU1DLFNBQVM7UUFDYmpCLElBQUlDLEtBQUtDLEdBQUcsR0FBR0MsUUFBUTtRQUN2QmUsUUFBUUYsS0FBS0UsTUFBTTtRQUNuQkMsV0FBV0gsS0FBS0csU0FBUztRQUN6QkMsU0FBU0osS0FBS0ksT0FBTztRQUNyQkMsYUFBYSxJQUFJcEI7UUFDakJxQixXQUFXTixLQUFLTSxTQUFTO0lBQzNCO0lBQ0FsQywwREFBMkIsQ0FBQzZCO0lBQzVCLE9BQU9BO0FBQ1Q7QUFFTyxlQUFlTywwQkFBMEJOLE1BQWM7SUFDNUQsT0FBTzlCLGtFQUFtQyxDQUFDOEI7QUFDN0M7QUFFTyxlQUFlUTtJQUNwQixPQUFPdEMsOERBQStCO0FBQ3hDO0FBRU8sZUFBZXdDLGdDQUFnQ1YsTUFBYyxFQUFFQyxTQUFlO0lBQ25GLE9BQU8vQix3RUFBeUMsQ0FBQzhCLFFBQVFDO0FBQzNEO0FBRU8sZUFBZVcsa0JBQWtCWixNQUFjO0lBQ3BELE9BQU85Qiw0REFBNkIsQ0FBQzhCO0FBQ3ZDO0FBRUEsb0NBQW9DO0FBQzdCLFNBQVNhO0lBQ2QsT0FBTzNDLDhEQUErQjtBQUN4QztBQUVPLFNBQVM0QztJQUNkLE9BQU81Qyw0REFBNkI7QUFDdEM7QUFFTyxTQUFTNkMsY0FBY0MsSUFBWSxFQUFFQyxLQUFhO0lBQ3ZELE9BQU8vQyx3REFBeUIsQ0FBQzhDLE1BQU1DO0FBQ3pDO0FBRU8sU0FBU0Msa0JBQWtCQyxTQUFpQjtJQUNqRCxPQUFPakQsNERBQTZCLENBQUNpRDtBQUN2QyIsInNvdXJjZXMiOlsiL1VzZXJzL3JvZHJpZ29kaWJlcm5hcmRvMzNnbWFpbC5jb20vRG9jdW1lbnRzL0FwcCBEZXZlbG9wbWVudCBQcm95ZWN0cy9JbnRlbGxlZ28gUGxhdGZvcm0vc3JjL2xpYi9oeWJyaWQtc3RvcmFnZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBIeWJyaWQgc3RvcmFnZSBzeXN0ZW0gdGhhdCBjYW4gd29yayB3aXRoIGRhdGFiYXNlIG9yIGZhbGxiYWNrIHRvIHRlbXAtc3RvcmFnZVxuaW1wb3J0ICogYXMgdGVtcFN0b3JhZ2UgZnJvbSAnLi90ZW1wLXN0b3JhZ2UnXG5cbi8vIEZvciBub3csIHVzZSB0ZW1wLXN0b3JhZ2UgZXhjbHVzaXZlbHkgdG8gZW5zdXJlIHN0YWJpbGl0eVxuY29uc3QgdXNlRGF0YWJhc2UgPSBmYWxzZVxuXG5jb25zb2xlLmxvZygn8J+UhCBVc2luZyB0ZW1wLXN0b3JhZ2Ugc3lzdGVtIGZvciByZWxpYWJpbGl0eScpXG5cbi8vIEluaXRpYWxpemUgdGhlIHN0b3JhZ2Ugc3lzdGVtXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gaW5pdGlhbGl6ZVN0b3JhZ2UoKSB7XG4gIGNvbnNvbGUubG9nKCfinIUgVGVtcC1zdG9yYWdlIHN5c3RlbSBpbml0aWFsaXplZCcpXG59XG5cbi8vIFVzZXIgbWFuYWdlbWVudCBmdW5jdGlvbnMgd2l0aCBmYWxsYmFja1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGNyZWF0ZVVzZXIodXNlckRhdGE6IGFueSkge1xuICBjb25zdCBoYXNoZWRQYXNzd29yZCA9IHJlcXVpcmUoJ2JjcnlwdGpzJykuaGFzaFN5bmModXNlckRhdGEucGFzc3dvcmQsIDEyKVxuICBjb25zdCB1c2VyID0ge1xuICAgIGlkOiBEYXRlLm5vdygpLnRvU3RyaW5nKCksXG4gICAgLi4udXNlckRhdGEsXG4gICAgcGFzc3dvcmQ6IGhhc2hlZFBhc3N3b3JkLFxuICAgIGNyZWF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICB1cGRhdGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgc3RhdHVzOiAnQUNUSVZFJyBhcyBjb25zdCxcbiAgfVxuICB0ZW1wU3RvcmFnZS5hZGRVc2VyKHVzZXIpXG4gIHJldHVybiB1c2VyXG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBmaW5kVXNlckJ5RW1haWwoZW1haWw6IHN0cmluZykge1xuICByZXR1cm4gdGVtcFN0b3JhZ2UuZmluZFVzZXJCeUVtYWlsKGVtYWlsKVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0QWxsVXNlcnMoKSB7XG4gIHJldHVybiB0ZW1wU3RvcmFnZS5nZXRBbGxVc2VycygpXG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBmaW5kVXNlcnNCeVJvbGUocm9sZTogYW55KSB7XG4gIHJldHVybiB0ZW1wU3RvcmFnZS5maW5kVXNlcnNCeVJvbGUocm9sZSlcbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGZpbmRVc2VyQnlJZChpZDogc3RyaW5nKSB7XG4gIHJldHVybiB0ZW1wU3RvcmFnZS5maW5kVXNlckJ5SWQoaWQpXG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZW5lcmF0ZVN0dWRlbnRJZCgpIHtcbiAgcmV0dXJuIHRlbXBTdG9yYWdlLmdlbmVyYXRlU3R1ZGVudElkKClcbn1cblxuLy8gUHJvZ3Jlc3MgcmVwb3J0cyBmdW5jdGlvbnMgd2l0aCBmYWxsYmFja1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGNyZWF0ZVByb2dyZXNzUmVwb3J0KGRhdGE6IGFueSkge1xuICBjb25zdCByZXBvcnQgPSB7XG4gICAgaWQ6IERhdGUubm93KCkudG9TdHJpbmcoKSxcbiAgICB1c2VySWQ6IGRhdGEudXNlcklkLFxuICAgIHdlZWtTdGFydDogZGF0YS53ZWVrU3RhcnQsXG4gICAgd2Vla0VuZDogZGF0YS53ZWVrRW5kLFxuICAgIHN1Ym1pdHRlZEF0OiBuZXcgRGF0ZSgpLFxuICAgIHJlc3BvbnNlczogZGF0YS5yZXNwb25zZXNcbiAgfVxuICB0ZW1wU3RvcmFnZS5hZGRXZWVrbHlSZXBvcnQocmVwb3J0KVxuICByZXR1cm4gcmVwb3J0XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBmaW5kUHJvZ3Jlc3NSZXBvcnRzQnlVc2VyKHVzZXJJZDogc3RyaW5nKSB7XG4gIHJldHVybiB0ZW1wU3RvcmFnZS5maW5kV2Vla2x5UmVwb3J0c0J5VXNlcih1c2VySWQpXG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRBbGxQcm9ncmVzc1JlcG9ydHMoKSB7XG4gIHJldHVybiB0ZW1wU3RvcmFnZS5nZXRBbGxXZWVrbHlSZXBvcnRzKClcbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGZpbmRQcm9ncmVzc1JlcG9ydEJ5VXNlckFuZFdlZWsodXNlcklkOiBzdHJpbmcsIHdlZWtTdGFydDogRGF0ZSkge1xuICByZXR1cm4gdGVtcFN0b3JhZ2UuZmluZFdlZWtseVJlcG9ydEJ5VXNlckFuZFdlZWsodXNlcklkLCB3ZWVrU3RhcnQpXG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjYW5TdWJtaXRUaGlzV2Vlayh1c2VySWQ6IHN0cmluZykge1xuICByZXR1cm4gdGVtcFN0b3JhZ2UuY2FuU3VibWl0VGhpc1dlZWsodXNlcklkKVxufVxuXG4vLyBVdGlsaXR5IGZ1bmN0aW9ucyAoc2FtZSBmb3IgYm90aClcbmV4cG9ydCBmdW5jdGlvbiBnZXRDdXJyZW50V2Vla1N0YXJ0KCkge1xuICByZXR1cm4gdGVtcFN0b3JhZ2UuZ2V0Q3VycmVudFdlZWtTdGFydCgpXG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRDdXJyZW50V2Vla0VuZCgpIHtcbiAgcmV0dXJuIHRlbXBTdG9yYWdlLmdldEN1cnJlbnRXZWVrRW5kKClcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGdldE1vbnRoV2Vla3MoeWVhcjogbnVtYmVyLCBtb250aDogbnVtYmVyKSB7XG4gIHJldHVybiB0ZW1wU3RvcmFnZS5nZXRNb250aFdlZWtzKHllYXIsIG1vbnRoKVxufVxuXG5leHBvcnQgZnVuY3Rpb24gdmFsaWRhdGVTdHVkZW50SWQoc3R1ZGVudElkOiBzdHJpbmcpIHtcbiAgcmV0dXJuIHRlbXBTdG9yYWdlLnZhbGlkYXRlU3R1ZGVudElkKHN0dWRlbnRJZClcbn0iXSwibmFtZXMiOlsidGVtcFN0b3JhZ2UiLCJ1c2VEYXRhYmFzZSIsImNvbnNvbGUiLCJsb2ciLCJpbml0aWFsaXplU3RvcmFnZSIsImNyZWF0ZVVzZXIiLCJ1c2VyRGF0YSIsImhhc2hlZFBhc3N3b3JkIiwicmVxdWlyZSIsImhhc2hTeW5jIiwicGFzc3dvcmQiLCJ1c2VyIiwiaWQiLCJEYXRlIiwibm93IiwidG9TdHJpbmciLCJjcmVhdGVkQXQiLCJ1cGRhdGVkQXQiLCJzdGF0dXMiLCJhZGRVc2VyIiwiZmluZFVzZXJCeUVtYWlsIiwiZW1haWwiLCJnZXRBbGxVc2VycyIsImZpbmRVc2Vyc0J5Um9sZSIsInJvbGUiLCJmaW5kVXNlckJ5SWQiLCJnZW5lcmF0ZVN0dWRlbnRJZCIsImNyZWF0ZVByb2dyZXNzUmVwb3J0IiwiZGF0YSIsInJlcG9ydCIsInVzZXJJZCIsIndlZWtTdGFydCIsIndlZWtFbmQiLCJzdWJtaXR0ZWRBdCIsInJlc3BvbnNlcyIsImFkZFdlZWtseVJlcG9ydCIsImZpbmRQcm9ncmVzc1JlcG9ydHNCeVVzZXIiLCJmaW5kV2Vla2x5UmVwb3J0c0J5VXNlciIsImdldEFsbFByb2dyZXNzUmVwb3J0cyIsImdldEFsbFdlZWtseVJlcG9ydHMiLCJmaW5kUHJvZ3Jlc3NSZXBvcnRCeVVzZXJBbmRXZWVrIiwiZmluZFdlZWtseVJlcG9ydEJ5VXNlckFuZFdlZWsiLCJjYW5TdWJtaXRUaGlzV2VlayIsImdldEN1cnJlbnRXZWVrU3RhcnQiLCJnZXRDdXJyZW50V2Vla0VuZCIsImdldE1vbnRoV2Vla3MiLCJ5ZWFyIiwibW9udGgiLCJ2YWxpZGF0ZVN0dWRlbnRJZCIsInN0dWRlbnRJZCJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/hybrid-storage.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/notification-service.ts":
/*!*****************************************!*\
  !*** ./src/lib/notification-service.ts ***!
  \*****************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   NotificationCategory: () => (/* binding */ NotificationCategory),\n/* harmony export */   NotificationPriority: () => (/* binding */ NotificationPriority),\n/* harmony export */   NotificationService: () => (/* binding */ NotificationService),\n/* harmony export */   NotificationTrigger: () => (/* binding */ NotificationTrigger),\n/* harmony export */   NotificationType: () => (/* binding */ NotificationType)\n/* harmony export */ });\n/* harmony import */ var _novu_node__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @novu/node */ \"(rsc)/./node_modules/@novu/node/build/module/index.js\");\n/* harmony import */ var _novu_node__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_novu_node__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _academic_search_engine__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./academic-search-engine */ \"(rsc)/./src/lib/academic-search-engine.ts\");\n/* harmony import */ var _conversation_memory__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./conversation-memory */ \"(rsc)/./src/lib/conversation-memory.ts\");\n/* harmony import */ var _emotion_analyzer__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./emotion-analyzer */ \"(rsc)/./src/lib/emotion-analyzer.ts\");\n// Sistema de Notificaciones Proactivas para Sara\n// Integra búsqueda académica con notificaciones inteligentes usando Novu\n\n\n\n\nvar NotificationTrigger = /*#__PURE__*/ function(NotificationTrigger) {\n    NotificationTrigger[\"EMOTIONAL_PATTERN\"] = \"emotional_pattern\";\n    NotificationTrigger[\"ACADEMIC_STRUGGLE\"] = \"academic_struggle\";\n    NotificationTrigger[\"LEARNING_OPPORTUNITY\"] = \"learning_opportunity\";\n    NotificationTrigger[\"DEADLINE_APPROACHING\"] = \"deadline_approaching\";\n    NotificationTrigger[\"PROGRESS_MILESTONE\"] = \"progress_milestone\";\n    NotificationTrigger[\"KNOWLEDGE_GAP\"] = \"knowledge_gap\";\n    NotificationTrigger[\"MOTIVATION_DROP\"] = \"motivation_drop\";\n    NotificationTrigger[\"STUDY_PATTERN\"] = \"study_pattern\";\n    return NotificationTrigger;\n}({});\nvar NotificationType = /*#__PURE__*/ function(NotificationType) {\n    NotificationType[\"ACADEMIC_RESOURCE\"] = \"academic_resource\";\n    NotificationType[\"STUDY_REMINDER\"] = \"study_reminder\";\n    NotificationType[\"MOTIVATIONAL\"] = \"motivational\";\n    NotificationType[\"PROGRESS_UPDATE\"] = \"progress_update\";\n    NotificationType[\"LEARNING_TIP\"] = \"learning_tip\";\n    NotificationType[\"DEADLINE_ALERT\"] = \"deadline_alert\";\n    NotificationType[\"ACHIEVEMENT\"] = \"achievement\";\n    return NotificationType;\n}({});\nvar NotificationPriority = /*#__PURE__*/ function(NotificationPriority) {\n    NotificationPriority[\"LOW\"] = \"low\";\n    NotificationPriority[\"MEDIUM\"] = \"medium\";\n    NotificationPriority[\"HIGH\"] = \"high\";\n    NotificationPriority[\"URGENT\"] = \"urgent\";\n    return NotificationPriority;\n}({});\nvar NotificationCategory = /*#__PURE__*/ function(NotificationCategory) {\n    NotificationCategory[\"ACADEMIC\"] = \"academic\";\n    NotificationCategory[\"EMOTIONAL\"] = \"emotional\";\n    NotificationCategory[\"ORGANIZATIONAL\"] = \"organizational\";\n    NotificationCategory[\"MOTIVATIONAL\"] = \"motivational\";\n    return NotificationCategory;\n}({});\nclass NotificationService {\n    static{\n        this.novu = null;\n    }\n    static{\n        this.initialized = false;\n    }\n    /**\n   * Inicializa el servicio de notificaciones\n   */ static initialize() {\n        try {\n            const apiKey = process.env.NOVU_API_KEY;\n            if (apiKey && apiKey.length > 10 && apiKey !== 'tu-clave-secreta-de-novu') {\n                this.novu = new _novu_node__WEBPACK_IMPORTED_MODULE_0__.Novu(apiKey);\n                this.initialized = true;\n                console.log('✅ Novu notification service initialized successfully');\n                console.log('📱 Push notifications, email, and SMS are now available');\n            } else if (apiKey === 'tu-clave-secreta-de-novu') {\n                console.log('⚠️  Placeholder API key detected. Please configure a real Novu API key.');\n                console.log('📖 Follow the tutorial in CLAUDE.md to get your API key');\n                this.initialized = true;\n            } else {\n                console.log('⚠️  Novu API key not found, using local notification system');\n                console.log('💡 To enable push notifications, configure NOVU_API_KEY in .env');\n                console.log('📖 See CLAUDE.md for setup instructions');\n                this.initialized = true;\n            }\n        } catch (error) {\n            console.error('❌ Failed to initialize Novu:', error);\n            console.log('🔄 Falling back to local notification system');\n            this.initialized = true;\n        }\n    }\n    /**\n   * Analiza el contexto del estudiante y genera notificaciones proactivas relevantes\n   */ static async analyzeAndNotify(context) {\n        if (!this.initialized) this.initialize();\n        const notifications = [];\n        const memory = _conversation_memory__WEBPACK_IMPORTED_MODULE_2__.ConversationMemoryManager.getMemory(context.userId, context.sessionId);\n        // 1. Analizar patrones emocionales para notificaciones\n        const emotionalNotifications = await this.analyzeEmotionalPatterns(context, memory);\n        notifications.push(...emotionalNotifications);\n        // 2. Detectar oportunidades de aprendizaje\n        const learningNotifications = await this.detectLearningOpportunities(context, memory);\n        notifications.push(...learningNotifications);\n        // 3. Verificar deadlines y tareas pendientes\n        const deadlineNotifications = await this.checkDeadlinesAndTasks(context, memory);\n        notifications.push(...deadlineNotifications);\n        // 4. Analizar patrones de estudio\n        const studyPatternNotifications = await this.analyzeStudyPatterns(context, memory);\n        notifications.push(...studyPatternNotifications);\n        // Ordenar por prioridad y enviar\n        const prioritizedNotifications = this.prioritizeNotifications(notifications);\n        // Enviar las notificaciones más importantes\n        for (const notification of prioritizedNotifications.slice(0, 3)){\n            await this.sendNotification(notification, context.userId);\n        }\n        return prioritizedNotifications;\n    }\n    /**\n   * Analiza patrones emocionales y genera notificaciones apropiadas\n   */ static async analyzeEmotionalPatterns(context, memory) {\n        const notifications = [];\n        const recentEmotions = memory.emotionalProfile.recentEmotions || [];\n        const currentMood = memory.emotionalProfile.currentMood;\n        const motivationLevel = memory.emotionalProfile.motivationLevel || 5;\n        // Patrón: Frustración recurrente\n        if (recentEmotions.filter((e)=>e === _emotion_analyzer__WEBPACK_IMPORTED_MODULE_3__.EmotionType.FRUSTRATED).length >= 2) {\n            const searchQuery = {\n                topic: 'técnicas de manejo de la frustración en el estudio',\n                searchType: 'resources',\n                level: 'basic',\n                language: 'es',\n                userId: context.userId,\n                sessionId: context.sessionId\n            };\n            const searchResults = await _academic_search_engine__WEBPACK_IMPORTED_MODULE_1__.AcademicSearchEngine.searchAcademicContent(searchQuery);\n            notifications.push({\n                id: `frustration_${Date.now()}`,\n                type: \"learning_tip\",\n                title: '💡 Gestiona la Frustración Académica',\n                message: 'He notado que has estado experimentando frustración últimamente. Te encontré recursos específicos para convertir esa frustración en motivación.',\n                actionButton: {\n                    text: 'Ver Técnicas',\n                    action: 'show_search_results',\n                    payload: searchResults\n                },\n                searchResults,\n                timestamp: new Date(),\n                priority: \"high\",\n                category: \"emotional\"\n            });\n        }\n        // Patrón: Motivación baja\n        if (motivationLevel < 4) {\n            const motivationalSearch = {\n                topic: 'técnicas de motivación para estudiantes estrategias de estudio',\n                searchType: 'resources',\n                level: 'basic',\n                language: 'es',\n                userId: context.userId,\n                sessionId: context.sessionId\n            };\n            const motivationResults = await _academic_search_engine__WEBPACK_IMPORTED_MODULE_1__.AcademicSearchEngine.searchAcademicContent(motivationalSearch);\n            notifications.push({\n                id: `motivation_${Date.now()}`,\n                type: \"motivational\",\n                title: '🌟 Impulsa tu Motivación',\n                message: 'Tu nivel de motivación ha bajado un poco. He encontrado estrategias probadas para recuperar tu energía académica.',\n                actionButton: {\n                    text: 'Motivarme',\n                    action: 'show_search_results',\n                    payload: motivationResults\n                },\n                searchResults: motivationResults,\n                timestamp: new Date(),\n                priority: \"medium\",\n                category: \"motivational\"\n            });\n        }\n        // Patrón: Confusión persistente\n        if (currentMood === _emotion_analyzer__WEBPACK_IMPORTED_MODULE_3__.EmotionType.CONFUSED && recentEmotions.filter((e)=>e === _emotion_analyzer__WEBPACK_IMPORTED_MODULE_3__.EmotionType.CONFUSED).length >= 2) {\n            const difficultSubjects = memory.preferences?.difficultSubjects || [];\n            const primarySubject = difficultSubjects[0] || 'matemáticas';\n            const clarificationSearch = {\n                topic: `${primarySubject} explicación simple conceptos básicos`,\n                searchType: 'explanation',\n                level: 'basic',\n                subject: primarySubject,\n                language: 'es',\n                userId: context.userId,\n                sessionId: context.sessionId\n            };\n            const clarificationResults = await _academic_search_engine__WEBPACK_IMPORTED_MODULE_1__.AcademicSearchEngine.searchAcademicContent(clarificationSearch);\n            notifications.push({\n                id: `confusion_${Date.now()}`,\n                type: \"academic_resource\",\n                title: '🎯 Aclaremos las Dudas',\n                message: `He detectado confusión recurrente en ${primarySubject}. Te busqué explicaciones especialmente claras para resolver tus dudas.`,\n                actionButton: {\n                    text: 'Aclarar Conceptos',\n                    action: 'show_search_results',\n                    payload: clarificationResults\n                },\n                searchResults: clarificationResults,\n                timestamp: new Date(),\n                priority: \"high\",\n                category: \"academic\"\n            });\n        }\n        return notifications;\n    }\n    /**\n   * Detecta oportunidades de aprendizaje basadas en el progreso\n   */ static async detectLearningOpportunities(context, memory) {\n        const notifications = [];\n        const achievementAreas = memory.emotionalProfile.achievementAreas || [];\n        const difficultSubjects = memory.preferences?.difficultSubjects || [];\n        // Oportunidad: Expandir áreas de fortaleza\n        if (achievementAreas.length > 0) {\n            const strongSubject = achievementAreas[0];\n            const advancedSearch = {\n                topic: `${strongSubject} avanzado proyectos desafíos`,\n                searchType: 'resources',\n                level: 'advanced',\n                subject: strongSubject,\n                language: 'es',\n                userId: context.userId,\n                sessionId: context.sessionId\n            };\n            const advancedResults = await _academic_search_engine__WEBPACK_IMPORTED_MODULE_1__.AcademicSearchEngine.searchAcademicContent(advancedSearch);\n            notifications.push({\n                id: `opportunity_${Date.now()}`,\n                type: \"learning_tip\",\n                title: '🚀 Amplía tus Fortalezas',\n                message: `Dominas bien ${strongSubject}. ¿Te interesa explorar aspectos más avanzados y desafiantes?`,\n                actionButton: {\n                    text: 'Explorar Nivel Avanzado',\n                    action: 'show_search_results',\n                    payload: advancedResults\n                },\n                searchResults: advancedResults,\n                timestamp: new Date(),\n                priority: \"low\",\n                category: \"academic\"\n            });\n        }\n        // Oportunidad: Recursos para materias difíciles\n        if (difficultSubjects.length > 0) {\n            const challengingSubject = difficultSubjects[0];\n            const supportSearch = {\n                topic: `${challengingSubject} tutorial básico paso a paso`,\n                searchType: 'explanation',\n                level: 'basic',\n                subject: challengingSubject,\n                language: 'es',\n                userId: context.userId,\n                sessionId: context.sessionId\n            };\n            const supportResults = await _academic_search_engine__WEBPACK_IMPORTED_MODULE_1__.AcademicSearchEngine.searchAcademicContent(supportSearch);\n            notifications.push({\n                id: `support_${Date.now()}`,\n                type: \"academic_resource\",\n                title: '📚 Recursos para Superar Desafíos',\n                message: `Encontré nuevos recursos para ${challengingSubject} que podrían ayudarte a superar las dificultades.`,\n                actionButton: {\n                    text: 'Ver Recursos',\n                    action: 'show_search_results',\n                    payload: supportResults\n                },\n                searchResults: supportResults,\n                timestamp: new Date(),\n                priority: \"medium\",\n                category: \"academic\"\n            });\n        }\n        return notifications;\n    }\n    /**\n   * Verifica deadlines y tareas pendientes\n   */ static async checkDeadlinesAndTasks(context, memory) {\n        const notifications = [];\n        // Simulación de deadlines próximos (en una implementación real, vendría de calendario)\n        const upcomingDeadlines = context.academicContext?.upcomingDeadlines || [];\n        if (upcomingDeadlines.length > 0) {\n            const deadline = upcomingDeadlines[0];\n            const preparationSearch = {\n                topic: `${deadline} preparación examen guía estudio`,\n                searchType: 'resources',\n                level: 'intermediate',\n                language: 'es',\n                userId: context.userId,\n                sessionId: context.sessionId\n            };\n            const prepResults = await _academic_search_engine__WEBPACK_IMPORTED_MODULE_1__.AcademicSearchEngine.searchAcademicContent(preparationSearch);\n            notifications.push({\n                id: `deadline_${Date.now()}`,\n                type: \"deadline_alert\",\n                title: '⏰ Deadline Próximo',\n                message: `Se acerca tu ${deadline}. Te busqué recursos específicos para una preparación efectiva.`,\n                actionButton: {\n                    text: 'Preparar Examen',\n                    action: 'show_search_results',\n                    payload: prepResults\n                },\n                searchResults: prepResults,\n                timestamp: new Date(),\n                priority: \"urgent\",\n                category: \"organizational\"\n            });\n        }\n        return notifications;\n    }\n    /**\n   * Analiza patrones de estudio para optimizaciones\n   */ static async analyzeStudyPatterns(context, memory) {\n        const notifications = [];\n        const totalTurns = memory.totalTurns || 0;\n        // Patrón: Usuario nuevo - ofrecer orientación\n        if (totalTurns < 5) {\n            const orientationSearch = {\n                topic: 'técnicas de estudio efectivas guía para estudiantes',\n                searchType: 'resources',\n                level: 'basic',\n                language: 'es',\n                userId: context.userId,\n                sessionId: context.sessionId\n            };\n            const orientationResults = await _academic_search_engine__WEBPACK_IMPORTED_MODULE_1__.AcademicSearchEngine.searchAcademicContent(orientationSearch);\n            notifications.push({\n                id: `orientation_${Date.now()}`,\n                type: \"learning_tip\",\n                title: '👋 Optimiza tu Estudio',\n                message: 'Como eres nuevo, te encontré las mejores técnicas de estudio para maximizar tu aprendizaje desde el inicio.',\n                actionButton: {\n                    text: 'Conocer Técnicas',\n                    action: 'show_search_results',\n                    payload: orientationResults\n                },\n                searchResults: orientationResults,\n                timestamp: new Date(),\n                priority: \"medium\",\n                category: \"academic\"\n            });\n        }\n        return notifications;\n    }\n    /**\n   * Prioriza notificaciones según urgencia y relevancia\n   */ static prioritizeNotifications(notifications) {\n        const priorityOrder = {\n            [\"urgent\"]: 4,\n            [\"high\"]: 3,\n            [\"medium\"]: 2,\n            [\"low\"]: 1\n        };\n        return notifications.sort((a, b)=>{\n            const priorityA = priorityOrder[a.priority];\n            const priorityB = priorityOrder[b.priority];\n            if (priorityA !== priorityB) {\n                return priorityB - priorityA;\n            }\n            // Si tienen la misma prioridad, ordenar por timestamp (más reciente primero)\n            return b.timestamp.getTime() - a.timestamp.getTime();\n        });\n    }\n    /**\n   * Envía notificación usando Novu o sistema local\n   */ static async sendNotification(notification, userId) {\n        try {\n            if (this.novu) {\n                // Enviar con Novu\n                await this.novu.trigger('academic-notification', {\n                    to: {\n                        subscriberId: userId\n                    },\n                    payload: {\n                        title: notification.title,\n                        message: notification.message,\n                        actionText: notification.actionButton?.text,\n                        actionPayload: notification.actionButton?.payload,\n                        priority: notification.priority,\n                        category: notification.category,\n                        timestamp: notification.timestamp.toISOString()\n                    }\n                });\n                console.log(`📬 Novu notification sent: ${notification.title}`);\n                return true;\n            } else {\n                // Sistema local de notificaciones\n                console.log(`📱 Local notification: ${notification.title} - ${notification.message}`);\n                this.storeLocalNotification(notification, userId);\n                return true;\n            }\n        } catch (error) {\n            console.error('❌ Failed to send notification:', error);\n            // Fallback: guardar localmente\n            this.storeLocalNotification(notification, userId);\n            return false;\n        }\n    }\n    /**\n   * Almacena notificación localmente cuando Novu no está disponible\n   */ static storeLocalNotification(notification, userId) {\n        // En un sistema real, esto se guardaría en base de datos\n        // Por ahora, usamos almacenamiento en memoria\n        if (!globalThis.localNotifications) {\n            globalThis.localNotifications = new Map();\n        }\n        if (!globalThis.localNotifications.has(userId)) {\n            globalThis.localNotifications.set(userId, []);\n        }\n        const userNotifications = globalThis.localNotifications.get(userId);\n        userNotifications.unshift(notification) // Agregar al inicio\n        ;\n        // Mantener solo las últimas 10 notificaciones\n        if (userNotifications.length > 10) {\n            userNotifications.splice(10);\n        }\n        console.log(`💾 Stored local notification for user ${userId}: ${notification.title}`);\n    }\n    /**\n   * Obtiene notificaciones locales para un usuario\n   */ static getLocalNotifications(userId) {\n        if (!globalThis.localNotifications) {\n            return [];\n        }\n        return globalThis.localNotifications.get(userId) || [];\n    }\n    /**\n   * Limpia notificaciones antiguas\n   */ static clearOldNotifications(userId, olderThanHours = 24) {\n        if (!globalThis.localNotifications) return;\n        const userNotifications = globalThis.localNotifications.get(userId) || [];\n        const cutoffTime = new Date(Date.now() - olderThanHours * 60 * 60 * 1000);\n        const recentNotifications = userNotifications.filter((notification)=>notification.timestamp > cutoffTime);\n        globalThis.localNotifications.set(userId, recentNotifications);\n    }\n    /**\n   * Genera notificación basada en búsqueda académica directa\n   */ static async createAcademicNotification(userId, searchQuery, trigger, customTitle, customMessage) {\n        const searchResults = await _academic_search_engine__WEBPACK_IMPORTED_MODULE_1__.AcademicSearchEngine.searchAcademicContent(searchQuery);\n        const defaultTitles = {\n            [\"knowledge_gap\"]: '🎯 Recursos para tu Consulta',\n            [\"learning_opportunity\"]: '📚 Nueva Oportunidad de Aprendizaje',\n            [\"academic_struggle\"]: '💡 Ayuda Específica Encontrada'\n        };\n        const defaultMessages = {\n            [\"knowledge_gap\"]: `Encontré recursos específicos sobre ${searchQuery.topic} que pueden resolver tus dudas.`,\n            [\"learning_opportunity\"]: `He descubierto material interesante sobre ${searchQuery.topic} que podría expandir tu conocimiento.`,\n            [\"academic_struggle\"]: `Te busqué recursos especializados para superar las dificultades con ${searchQuery.topic}.`\n        };\n        const notification = {\n            id: `academic_${Date.now()}`,\n            type: \"academic_resource\",\n            title: customTitle || defaultTitles[trigger] || '📖 Recursos Académicos',\n            message: customMessage || defaultMessages[trigger] || `Recursos encontrados sobre ${searchQuery.topic}`,\n            actionButton: {\n                text: 'Ver Recursos',\n                action: 'show_search_results',\n                payload: searchResults\n            },\n            searchResults,\n            timestamp: new Date(),\n            priority: \"medium\",\n            category: \"academic\"\n        };\n        // Enviar la notificación\n        await this.sendNotification(notification, userId);\n        return notification;\n    }\n    /**\n   * Obtiene estadísticas del sistema de notificaciones\n   */ static getNotificationStats(userId) {\n        const allNotifications = globalThis.localNotifications || new Map();\n        if (userId) {\n            const userNotifications = allNotifications.get(userId) || [];\n            return {\n                total: userNotifications.length,\n                byType: this.groupByProperty(userNotifications, 'type'),\n                byPriority: this.groupByProperty(userNotifications, 'priority'),\n                byCategory: this.groupByProperty(userNotifications, 'category'),\n                recent: userNotifications.filter((n)=>n.timestamp > new Date(Date.now() - 24 * 60 * 60 * 1000)).length\n            };\n        }\n        // Estadísticas globales\n        let totalNotifications = 0;\n        const globalStats = {\n            byType: {},\n            byPriority: {},\n            byCategory: {}\n        };\n        for (const userNotifications of allNotifications.values()){\n            totalNotifications += userNotifications.length;\n        }\n        return {\n            totalUsers: allNotifications.size,\n            totalNotifications,\n            novuEnabled: this.novu !== null,\n            initialized: this.initialized\n        };\n    }\n    /**\n   * Utilitario para agrupar por propiedad\n   */ static groupByProperty(notifications, property) {\n        return notifications.reduce((acc, notification)=>{\n            const key = notification[property];\n            acc[key] = (acc[key] || 0) + 1;\n            return acc;\n        }, {});\n    }\n}\n// Inicializar el servicio automáticamente\nNotificationService.initialize();\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvbGliL25vdGlmaWNhdGlvbi1zZXJ2aWNlLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7QUFBQSxpREFBaUQ7QUFDakQseUVBQXlFO0FBRXhDO0FBQ21FO0FBQ25DO0FBQ2pCO0FBZ0N6QyxpREFBS0k7Ozs7Ozs7OztXQUFBQTtNQVNYO0FBRU0sOENBQUtDOzs7Ozs7OztXQUFBQTtNQVFYO0FBRU0sa0RBQUtDOzs7OztXQUFBQTtNQUtYO0FBRU0sa0RBQUtDOzs7OztXQUFBQTtNQUtYO0FBRU0sTUFBTUM7O2FBQ0lDLE9BQW9COzs7YUFDcEJDLGNBQWM7O0lBRTdCOztHQUVDLEdBQ0QsT0FBT0MsYUFBYTtRQUNsQixJQUFJO1lBQ0YsTUFBTUMsU0FBU0MsUUFBUUMsR0FBRyxDQUFDQyxZQUFZO1lBRXZDLElBQUlILFVBQVVBLE9BQU9JLE1BQU0sR0FBRyxNQUFNSixXQUFXLDRCQUE0QjtnQkFDekUsSUFBSSxDQUFDSCxJQUFJLEdBQUcsSUFBSVQsNENBQUlBLENBQUNZO2dCQUNyQixJQUFJLENBQUNGLFdBQVcsR0FBRztnQkFDbkJPLFFBQVFDLEdBQUcsQ0FBQztnQkFDWkQsUUFBUUMsR0FBRyxDQUFDO1lBQ2QsT0FBTyxJQUFJTixXQUFXLDRCQUE0QjtnQkFDaERLLFFBQVFDLEdBQUcsQ0FBQztnQkFDWkQsUUFBUUMsR0FBRyxDQUFDO2dCQUNaLElBQUksQ0FBQ1IsV0FBVyxHQUFHO1lBQ3JCLE9BQU87Z0JBQ0xPLFFBQVFDLEdBQUcsQ0FBQztnQkFDWkQsUUFBUUMsR0FBRyxDQUFDO2dCQUNaRCxRQUFRQyxHQUFHLENBQUM7Z0JBQ1osSUFBSSxDQUFDUixXQUFXLEdBQUc7WUFDckI7UUFDRixFQUFFLE9BQU9TLE9BQU87WUFDZEYsUUFBUUUsS0FBSyxDQUFDLGdDQUFnQ0E7WUFDOUNGLFFBQVFDLEdBQUcsQ0FBQztZQUNaLElBQUksQ0FBQ1IsV0FBVyxHQUFHO1FBQ3JCO0lBQ0Y7SUFFQTs7R0FFQyxHQUNELGFBQWFVLGlCQUFpQkMs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STtZQUNqQ0o7WUFDQUssYUFBYSxJQUFJLENBQUNsSSxJQUFJLEtBQUs7WUFDM0JDLGFBQWEsSUFBSSxDQUFDQSxXQUFXO1FBQy9CO0lBQ0Y7SUFFQTs7R0FFQyxHQUNELE9BQWV1SCxnQkFBZ0IzRyxhQUFzQyxFQUFFc0gsUUFBcUMsRUFBRTtRQUM1RyxPQUFPdEgsY0FBY3VILE1BQU0sQ0FBQyxDQUFDQyxLQUFLeEc7WUFDaEMsTUFBTXlHLE1BQU16RyxZQUFZLENBQUNzRyxTQUFTO1lBQ2xDRSxHQUFHLENBQUNDLElBQUksR0FBRyxDQUFDRCxHQUFHLENBQUNDLElBQUksSUFBSSxLQUFLO1lBQzdCLE9BQU9EO1FBQ1QsR0FBRyxDQUFDO0lBQ047QUFDRjtBQUVBLDBDQUEwQztBQUMxQ3RJLG9CQUFvQkcsVUFBVSIsInNvdXJjZXMiOlsiL1VzZXJzL3JvZHJpZ29kaWJlcm5hcmRvMzNnbWFpbC5jb20vRG9jdW1lbnRzL0FwcCBEZXZlbG9wbWVudCBQcm95ZWN0cy9JbnRlbGxlZ28gUGxhdGZvcm0vc3JjL2xpYi9ub3RpZmljYXRpb24tc2VydmljZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBTaXN0ZW1hIGRlIE5vdGlmaWNhY2lvbmVzIFByb2FjdGl2YXMgcGFyYSBTYXJhXG4vLyBJbnRlZ3JhIGLDunNxdWVkYSBhY2Fkw6ltaWNhIGNvbiBub3RpZmljYWNpb25lcyBpbnRlbGlnZW50ZXMgdXNhbmRvIE5vdnVcblxuaW1wb3J0IHsgTm92dSB9IGZyb20gJ0Bub3Z1L25vZGUnXG5pbXBvcnQgeyBBY2FkZW1pY1NlYXJjaEVuZ2luZSwgQWNhZGVtaWNTZWFyY2hRdWVyeSwgU2VhcmNoQW5hbHlzaXMgfSBmcm9tICcuL2FjYWRlbWljLXNlYXJjaC1lbmdpbmUnXG5pbXBvcnQgeyBDb252ZXJzYXRpb25NZW1vcnlNYW5hZ2VyIH0gZnJvbSAnLi9jb252ZXJzYXRpb24tbWVtb3J5J1xuaW1wb3J0IHsgRW1vdGlvblR5cGUgfSBmcm9tICcuL2Vtb3Rpb24tYW5hbHl6ZXInXG5pbXBvcnQgeyBDb252ZXJzYXRpb25Nb2RlIH0gZnJvbSAnLi9hZHZhbmNlZC1pbnRlbnQtZW5naW5lJ1xuXG5leHBvcnQgaW50ZXJmYWNlIE5vdGlmaWNhdGlvbkNvbnRleHQge1xuICB1c2VySWQ6IHN0cmluZ1xuICBzZXNzaW9uSWQ/OiBzdHJpbmdcbiAgdHJpZ2dlcjogTm90aWZpY2F0aW9uVHJpZ2dlclxuICBwcmlvcml0eTogTm90aWZpY2F0aW9uUHJpb3JpdHlcbiAgYWNhZGVtaWNDb250ZXh0Pzoge1xuICAgIHN1YmplY3Q/OiBzdHJpbmdcbiAgICBkaWZmaWN1bHR5PzogJ3N0cnVnZ2xpbmcnIHwgJ3Byb2dyZXNzaW5nJyB8ICdleGNlbGxpbmcnXG4gICAgdXBjb21pbmdEZWFkbGluZXM/OiBzdHJpbmdbXVxuICAgIHJlY2VudEFjdGl2aXR5Pzogc3RyaW5nW11cbiAgfVxufVxuXG5leHBvcnQgaW50ZXJmYWNlIFByb2FjdGl2ZU5vdGlmaWNhdGlvbiB7XG4gIGlkOiBzdHJpbmdcbiAgdHlwZTogTm90aWZpY2F0aW9uVHlwZVxuICB0aXRsZTogc3RyaW5nXG4gIG1lc3NhZ2U6IHN0cmluZ1xuICBhY3Rpb25CdXR0b24/OiB7XG4gICAgdGV4dDogc3RyaW5nXG4gICAgYWN0aW9uOiBzdHJpbmdcbiAgICBwYXlsb2FkPzogYW55XG4gIH1cbiAgc2VhcmNoUmVzdWx0cz86IFNlYXJjaEFuYWx5c2lzXG4gIHRpbWVzdGFtcDogRGF0ZVxuICBwcmlvcml0eTogTm90aWZpY2F0aW9uUHJpb3JpdHlcbiAgY2F0ZWdvcnk6IE5vdGlmaWNhdGlvbkNhdGVnb3J5XG59XG5cbmV4cG9ydCBlbnVtIE5vdGlmaWNhdGlvblRyaWdnZXIge1xuICBFTU9USU9OQUxfUEFUVEVSTiA9ICdlbW90aW9uYWxfcGF0dGVybicsXG4gIEFDQURFTUlDX1NUUlVHR0xFID0gJ2FjYWRlbWljX3N0cnVnZ2xlJyxcbiAgTEVBUk5JTkdfT1BQT1JUVU5JVFkgPSAnbGVhcm5pbmdfb3Bwb3J0dW5pdHknLFxuICBERUFETElORV9BUFBST0FDSElORyA9ICdkZWFkbGluZV9hcHByb2FjaGluZycsXG4gIFBST0dSRVNTX01JTEVTVE9ORSA9ICdwcm9ncmVzc19taWxlc3RvbmUnLFxuICBLTk9XTEVER0VfR0FQID0gJ2tub3dsZWRnZV9nYXAnLFxuICBNT1RJVkFUSU9OX0RST1AgPSAnbW90aXZhdGlvbl9kcm9wJyxcbiAgU1RVRFlfUEFUVEVSTiA9ICdzdHVkeV9wYXR0ZXJuJ1xufVxuXG5leHBvcnQgZW51bSBOb3RpZmljYXRpb25UeXBlIHtcbiAgQUNBREVNSUNfUkVTT1VSQ0UgPSAnYWNhZGVtaWNfcmVzb3VyY2UnLFxuICBTVFVEWV9SRU1JTkRFUiA9ICdzdHVkeV9yZW1pbmRlcicsXG4gIE1PVElWQVRJT05BTCA9ICdtb3RpdmF0aW9uYWwnLFxuICBQUk9HUkVTU19VUERBVEUgPSAncHJvZ3Jlc3NfdXBkYXRlJyxcbiAgTEVBUk5JTkdfVElQID0gJ2xlYXJuaW5nX3RpcCcsXG4gIERFQURMSU5FX0FMRVJUID0gJ2RlYWRsaW5lX2FsZXJ0JyxcbiAgQUNISUVWRU1FTlQgPSAnYWNoaWV2ZW1lbnQnXG59XG5cbmV4cG9ydCBlbnVtIE5vdGlmaWNhdGlvblByaW9yaXR5IHtcbiAgTE9XID0gJ2xvdycsXG4gIE1FRElVTSA9ICdtZWRpdW0nLFxuICBISUdIID0gJ2hpZ2gnLFxuICBVUkdFTlQgPSAndXJnZW50J1xufVxuXG5leHBvcnQgZW51bSBOb3RpZmljYXRpb25DYXRlZ29yeSB7XG4gIEFDQURFTUlDID0gJ2FjYWRlbWljJyxcbiAgRU1PVElPTkFMID0gJ2Vtb3Rpb25hbCcsXG4gIE9SR0FOSVpBVElPTkFMID0gJ29yZ2FuaXphdGlvbmFsJyxcbiAgTU9USVZBVElPTkFMID0gJ21vdGl2YXRpb25hbCdcbn1cblxuZXhwb3J0IGNsYXNzIE5vdGlmaWNhdGlvblNlcnZpY2Uge1xuICBwcml2YXRlIHN0YXRpYyBub3Z1OiBOb3Z1IHwgbnVsbCA9IG51bGxcbiAgcHJpdmF0ZSBzdGF0aWMgaW5pdGlhbGl6ZWQgPSBmYWxzZVxuXG4gIC8qKlxuICAgKiBJbmljaWFsaXphIGVsIHNlcnZpY2lvIGRlIG5vdGlmaWNhY2lvbmVzXG4gICAqL1xuICBzdGF0aWMgaW5pdGlhbGl6ZSgpIHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgYXBpS2V5ID0gcHJvY2Vzcy5lbnYuTk9WVV9BUElfS0VZXG4gICAgICBcbiAgICAgIGlmIChhcGlLZXkgJiYgYXBpS2V5Lmxlbmd0aCA+IDEwICYmIGFwaUtleSAhPT0gJ3R1LWNsYXZlLXNlY3JldGEtZGUtbm92dScpIHtcbiAgICAgICAgdGhpcy5ub3Z1ID0gbmV3IE5vdnUoYXBpS2V5KVxuICAgICAgICB0aGlzLmluaXRpYWxpemVkID0gdHJ1ZVxuICAgICAgICBjb25zb2xlLmxvZygn4pyFIE5vdnUgbm90aWZpY2F0aW9uIHNlcnZpY2UgaW5pdGlhbGl6ZWQgc3VjY2Vzc2Z1bGx5JylcbiAgICAgICAgY29uc29sZS5sb2coJ/Cfk7EgUHVzaCBub3RpZmljYXRpb25zLCBlbWFpbCwgYW5kIFNNUyBhcmUgbm93IGF2YWlsYWJsZScpXG4gICAgICB9IGVsc2UgaWYgKGFwaUtleSA9PT0gJ3R1LWNsYXZlLXNlY3JldGEtZGUtbm92dScpIHtcbiAgICAgICAgY29uc29sZS5sb2coJ+KaoO+4jyAgUGxhY2Vob2xkZXIgQVBJIGtleSBkZXRlY3RlZC4gUGxlYXNlIGNvbmZpZ3VyZSBhIHJlYWwgTm92dSBBUEkga2V5LicpXG4gICAgICAgIGNvbnNvbGUubG9nKCfwn5OWIEZvbGxvdyB0aGUgdHV0b3JpYWwgaW4gQ0xBVURFLm1kIHRvIGdldCB5b3VyIEFQSSBrZXknKVxuICAgICAgICB0aGlzLmluaXRpYWxpemVkID0gdHJ1ZVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY29uc29sZS5sb2coJ+KaoO+4jyAgTm92dSBBUEkga2V5IG5vdCBmb3VuZCwgdXNpbmcgbG9jYWwgbm90aWZpY2F0aW9uIHN5c3RlbScpXG4gICAgICAgIGNvbnNvbGUubG9nKCfwn5KhIFRvIGVuYWJsZSBwdXNoIG5vdGlmaWNhdGlvbnMsIGNvbmZpZ3VyZSBOT1ZVX0FQSV9LRVkgaW4gLmVudicpXG4gICAgICAgIGNvbnNvbGUubG9nKCfwn5OWIFNlZSBDTEFVREUubWQgZm9yIHNldHVwIGluc3RydWN0aW9ucycpXG4gICAgICAgIHRoaXMuaW5pdGlhbGl6ZWQgPSB0cnVlXG4gICAgICB9XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBGYWlsZWQgdG8gaW5pdGlhbGl6ZSBOb3Z1OicsIGVycm9yKVxuICAgICAgY29uc29sZS5sb2coJ/CflIQgRmFsbGluZyBiYWNrIHRvIGxvY2FsIG5vdGlmaWNhdGlvbiBzeXN0ZW0nKVxuICAgICAgdGhpcy5pbml0aWFsaXplZCA9IHRydWVcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogQW5hbGl6YSBlbCBjb250ZXh0byBkZWwgZXN0dWRpYW50ZSB5IGdlbmVyYSBub3RpZmljYWNpb25lcyBwcm9hY3RpdmFzIHJlbGV2YW50ZXNcbiAgICovXG4gIHN0YXRpYyBhc3luYyBhbmFseXplQW5kTm90aWZ5KGNvbnRleHQ6IE5vdGlmaWNhdGlvbkNvbnRleHQpOiBQcm9taXNlPFByb2FjdGl2ZU5vdGlmaWNhdGlvbltdPiB7XG4gICAgaWYgKCF0aGlzLmluaXRpYWxpemVkKSB0aGlzLmluaXRpYWxpemUoKVxuXG4gICAgY29uc3Qgbm90aWZpY2F0aW9uczogUHJvYWN0aXZlTm90aWZpY2F0aW9uW10gPSBbXVxuICAgIGNvbnN0IG1lbW9yeSA9IENvbnZlcnNhdGlvbk1lbW9yeU1hbmFnZXIuZ2V0TWVtb3J5KGNvbnRleHQudXNlcklkLCBjb250ZXh0LnNlc3Npb25JZClcblxuICAgIC8vIDEuIEFuYWxpemFyIHBhdHJvbmVzIGVtb2Npb25hbGVzIHBhcmEgbm90aWZpY2FjaW9uZXNcbiAgICBjb25zdCBlbW90aW9uYWxOb3RpZmljYXRpb25zID0gYXdhaXQgdGhpcy5hbmFseXplRW1vdGlvbmFsUGF0dGVybnMoY29udGV4dCwgbWVtb3J5KVxuICAgIG5vdGlmaWNhdGlvbnMucHVzaCguLi5lbW90aW9uYWxOb3RpZmljYXRpb25zKVxuXG4gICAgLy8gMi4gRGV0ZWN0YXIgb3BvcnR1bmlkYWRlcyBkZSBhcHJlbmRpemFqZVxuICAgIGNvbnN0IGxlYXJuaW5nTm90aWZpY2F0aW9ucyA9IGF3YWl0IHRoaXMuZGV0ZWN0TGVhcm5pbmdPcHBvcnR1bml0aWVzKGNvbnRleHQsIG1lbW9yeSlcbiAgICBub3RpZmljYXRpb25zLnB1c2goLi4ubGVhcm5pbmdOb3RpZmljYXRpb25zKVxuXG4gICAgLy8gMy4gVmVyaWZpY2FyIGRlYWRsaW5lcyB5IHRhcmVhcyBwZW5kaWVudGVzXG4gICAgY29uc3QgZGVhZGxpbmVOb3RpZmljYXRpb25zID0gYXdhaXQgdGhpcy5jaGVja0RlYWRsaW5lc0FuZFRhc2tzKGNvbnRleHQsIG1lbW9yeSlcbiAgICBub3RpZmljYXRpb25zLnB1c2goLi4uZGVhZGxpbmVOb3RpZmljYXRpb25zKVxuXG4gICAgLy8gNC4gQW5hbGl6YXIgcGF0cm9uZXMgZGUgZXN0dWRpb1xuICAgIGNvbnN0IHN0dWR5UGF0dGVybk5vdGlmaWNhdGlvbnMgPSBhd2FpdCB0aGlzLmFuYWx5emVTdHVkeVBhdHRlcm5zKGNvbnRleHQsIG1lbW9yeSlcbiAgICBub3RpZmljYXRpb25zLnB1c2goLi4uc3R1ZHlQYXR0ZXJuTm90aWZpY2F0aW9ucylcblxuICAgIC8vIE9yZGVuYXIgcG9yIHByaW9yaWRhZCB5IGVudmlhclxuICAgIGNvbnN0IHByaW9yaXRpemVkTm90aWZpY2F0aW9ucyA9IHRoaXMucHJpb3JpdGl6ZU5vdGlmaWNhdGlvbnMobm90aWZpY2F0aW9ucylcbiAgICBcbiAgICAvLyBFbnZpYXIgbGFzIG5vdGlmaWNhY2lvbmVzIG3DoXMgaW1wb3J0YW50ZXNcbiAgICBmb3IgKGNvbnN0IG5vdGlmaWNhdGlvbiBvZiBwcmlvcml0aXplZE5vdGlmaWNhdGlvbnMuc2xpY2UoMCwgMykpIHtcbiAgICAgIGF3YWl0IHRoaXMuc2VuZE5vdGlmaWNhdGlvbihub3RpZmljYXRpb24sIGNvbnRleHQudXNlcklkKVxuICAgIH1cblxuICAgIHJldHVybiBwcmlvcml0aXplZE5vdGlmaWNhdGlvbnNcbiAgfVxuXG4gIC8qKlxuICAgKiBBbmFsaXphIHBhdHJvbmVzIGVtb2Npb25hbGVzIHkgZ2VuZXJhIG5vdGlmaWNhY2lvbmVzIGFwcm9waWFkYXNcbiAgICovXG4gIHByaXZhdGUgc3RhdGljIGFzeW5jIGFuYWx5emVFbW90aW9uYWxQYXR0ZXJucyhcbiAgICBjb250ZXh0OiBOb3RpZmljYXRpb25Db250ZXh0LCBcbiAgICBtZW1vcnk6IGFueVxuICApOiBQcm9taXNlPFByb2FjdGl2ZU5vdGlmaWNhdGlvbltdPiB7XG4gICAgY29uc3Qgbm90aWZpY2F0aW9uczogUHJvYWN0aXZlTm90aWZpY2F0aW9uW10gPSBbXVxuICAgIGNvbnN0IHJlY2VudEVtb3Rpb25zID0gbWVtb3J5LmVtb3Rpb25hbFByb2ZpbGUucmVjZW50RW1vdGlvbnMgfHwgW11cbiAgICBjb25zdCBjdXJyZW50TW9vZCA9IG1lbW9yeS5lbW90aW9uYWxQcm9maWxlLmN1cnJlbnRNb29kXG4gICAgY29uc3QgbW90aXZhdGlvbkxldmVsID0gbWVtb3J5LmVtb3Rpb25hbFByb2ZpbGUubW90aXZhdGlvbkxldmVsIHx8IDVcblxuICAgIC8vIFBhdHLDs246IEZydXN0cmFjacOzbiByZWN1cnJlbnRlXG4gICAgaWYgKHJlY2VudEVtb3Rpb25zLmZpbHRlcihlID0+IGUgPT09IEVtb3Rpb25UeXBlLkZSVVNUUkFURUQpLmxlbmd0aCA+PSAyKSB7XG4gICAgICBjb25zdCBzZWFyY2hRdWVyeTogQWNhZGVtaWNTZWFyY2hRdWVyeSA9IHtcbiAgICAgICAgdG9waWM6ICd0w6ljbmljYXMgZGUgbWFuZWpvIGRlIGxhIGZydXN0cmFjacOzbiBlbiBlbCBlc3R1ZGlvJyxcbiAgICAgICAgc2VhcmNoVHlwZTogJ3Jlc291cmNlcycsXG4gICAgICAgIGxldmVsOiAnYmFzaWMnLFxuICAgICAgICBsYW5ndWFnZTogJ2VzJyxcbiAgICAgICAgdXNlcklkOiBjb250ZXh0LnVzZXJJZCxcbiAgICAgICAgc2Vzc2lvbklkOiBjb250ZXh0LnNlc3Npb25JZFxuICAgICAgfVxuXG4gICAgICBjb25zdCBzZWFyY2hSZXN1bHRzID0gYXdhaXQgQWNhZGVtaWNTZWFyY2hFbmdpbmUuc2VhcmNoQWNhZGVtaWNDb250ZW50KHNlYXJjaFF1ZXJ5KVxuXG4gICAgICBub3RpZmljYXRpb25zLnB1c2goe1xuICAgICAgICBpZDogYGZydXN0cmF0aW9uXyR7RGF0ZS5ub3coKX1gLFxuICAgICAgICB0eXBlOiBOb3RpZmljYXRpb25UeXBlLkxFQVJOSU5HX1RJUCxcbiAgICAgICAgdGl0bGU6ICfwn5KhIEdlc3Rpb25hIGxhIEZydXN0cmFjacOzbiBBY2Fkw6ltaWNhJyxcbiAgICAgICAgbWVzc2FnZTogJ0hlIG5vdGFkbyBxdWUgaGFzIGVzdGFkbyBleHBlcmltZW50YW5kbyBmcnVzdHJhY2nDs24gw7psdGltYW1lbnRlLiBUZSBlbmNvbnRyw6kgcmVjdXJzb3MgZXNwZWPDrWZpY29zIHBhcmEgY29udmVydGlyIGVzYSBmcnVzdHJhY2nDs24gZW4gbW90aXZhY2nDs24uJyxcbiAgICAgICAgYWN0aW9uQnV0dG9uOiB7XG4gICAgICAgICAgdGV4dDogJ1ZlciBUw6ljbmljYXMnLFxuICAgICAgICAgIGFjdGlvbjogJ3Nob3dfc2VhcmNoX3Jlc3VsdHMnLFxuICAgICAgICAgIHBheWxvYWQ6IHNlYXJjaFJlc3VsdHNcbiAgICAgICAgfSxcbiAgICAgICAgc2VhcmNoUmVzdWx0cyxcbiAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLFxuICAgICAgICBwcmlvcml0eTogTm90aWZpY2F0aW9uUHJpb3JpdHkuSElHSCxcbiAgICAgICAgY2F0ZWdvcnk6IE5vdGlmaWNhdGlvbkNhdGVnb3J5LkVNT1RJT05BTFxuICAgICAgfSlcbiAgICB9XG5cbiAgICAvLyBQYXRyw7NuOiBNb3RpdmFjacOzbiBiYWphXG4gICAgaWYgKG1vdGl2YXRpb25MZXZlbCA8IDQpIHtcbiAgICAgIGNvbnN0IG1vdGl2YXRpb25hbFNlYXJjaDogQWNhZGVtaWNTZWFyY2hRdWVyeSA9IHtcbiAgICAgICAgdG9waWM6ICd0w6ljbmljYXMgZGUgbW90aXZhY2nDs24gcGFyYSBlc3R1ZGlhbnRlcyBlc3RyYXRlZ2lhcyBkZSBlc3R1ZGlvJyxcbiAgICAgICAgc2VhcmNoVHlwZTogJ3Jlc291cmNlcycsXG4gICAgICAgIGxldmVsOiAnYmFzaWMnLFxuICAgICAgICBsYW5ndWFnZTogJ2VzJyxcbiAgICAgICAgdXNlcklkOiBjb250ZXh0LnVzZXJJZCxcbiAgICAgICAgc2Vzc2lvbklkOiBjb250ZXh0LnNlc3Npb25JZFxuICAgICAgfVxuXG4gICAgICBjb25zdCBtb3RpdmF0aW9uUmVzdWx0cyA9IGF3YWl0IEFjYWRlbWljU2VhcmNoRW5naW5lLnNlYXJjaEFjYWRlbWljQ29udGVudChtb3RpdmF0aW9uYWxTZWFyY2gpXG5cbiAgICAgIG5vdGlmaWNhdGlvbnMucHVzaCh7XG4gICAgICAgIGlkOiBgbW90aXZhdGlvbl8ke0RhdGUubm93KCl9YCxcbiAgICAgICAgdHlwZTogTm90aWZpY2F0aW9uVHlwZS5NT1RJVkFUSU9OQUwsXG4gICAgICAgIHRpdGxlOiAn8J+MnyBJbXB1bHNhIHR1IE1vdGl2YWNpw7NuJyxcbiAgICAgICAgbWVzc2FnZTogJ1R1IG5pdmVsIGRlIG1vdGl2YWNpw7NuIGhhIGJhamFkbyB1biBwb2NvLiBIZSBlbmNvbnRyYWRvIGVzdHJhdGVnaWFzIHByb2JhZGFzIHBhcmEgcmVjdXBlcmFyIHR1IGVuZXJnw61hIGFjYWTDqW1pY2EuJyxcbiAgICAgICAgYWN0aW9uQnV0dG9uOiB7XG4gICAgICAgICAgdGV4dDogJ01vdGl2YXJtZScsXG4gICAgICAgICAgYWN0aW9uOiAnc2hvd19zZWFyY2hfcmVzdWx0cycsXG4gICAgICAgICAgcGF5bG9hZDogbW90aXZhdGlvblJlc3VsdHNcbiAgICAgICAgfSxcbiAgICAgICAgc2VhcmNoUmVzdWx0czogbW90aXZhdGlvblJlc3VsdHMsXG4gICAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKSxcbiAgICAgICAgcHJpb3JpdHk6IE5vdGlmaWNhdGlvblByaW9yaXR5Lk1FRElVTSxcbiAgICAgICAgY2F0ZWdvcnk6IE5vdGlmaWNhdGlvbkNhdGVnb3J5Lk1PVElWQVRJT05BTFxuICAgICAgfSlcbiAgICB9XG5cbiAgICAvLyBQYXRyw7NuOiBDb25mdXNpw7NuIHBlcnNpc3RlbnRlXG4gICAgaWYgKGN1cnJlbnRNb29kID09PSBFbW90aW9uVHlwZS5DT05GVVNFRCAmJiBcbiAgICAgICAgcmVjZW50RW1vdGlvbnMuZmlsdGVyKGUgPT4gZSA9PT0gRW1vdGlvblR5cGUuQ09ORlVTRUQpLmxlbmd0aCA+PSAyKSB7XG4gICAgICBcbiAgICAgIGNvbnN0IGRpZmZpY3VsdFN1YmplY3RzID0gbWVtb3J5LnByZWZlcmVuY2VzPy5kaWZmaWN1bHRTdWJqZWN0cyB8fCBbXVxuICAgICAgY29uc3QgcHJpbWFyeVN1YmplY3QgPSBkaWZmaWN1bHRTdWJqZWN0c1swXSB8fCAnbWF0ZW3DoXRpY2FzJ1xuXG4gICAgICBjb25zdCBjbGFyaWZpY2F0aW9uU2VhcmNoOiBBY2FkZW1pY1NlYXJjaFF1ZXJ5ID0ge1xuICAgICAgICB0b3BpYzogYCR7cHJpbWFyeVN1YmplY3R9IGV4cGxpY2FjacOzbiBzaW1wbGUgY29uY2VwdG9zIGLDoXNpY29zYCxcbiAgICAgICAgc2VhcmNoVHlwZTogJ2V4cGxhbmF0aW9uJyxcbiAgICAgICAgbGV2ZWw6ICdiYXNpYycsXG4gICAgICAgIHN1YmplY3Q6IHByaW1hcnlTdWJqZWN0LFxuICAgICAgICBsYW5ndWFnZTogJ2VzJyxcbiAgICAgICAgdXNlcklkOiBjb250ZXh0LnVzZXJJZCxcbiAgICAgICAgc2Vzc2lvbklkOiBjb250ZXh0LnNlc3Npb25JZFxuICAgICAgfVxuXG4gICAgICBjb25zdCBjbGFyaWZpY2F0aW9uUmVzdWx0cyA9IGF3YWl0IEFjYWRlbWljU2VhcmNoRW5naW5lLnNlYXJjaEFjYWRlbWljQ29udGVudChjbGFyaWZpY2F0aW9uU2VhcmNoKVxuXG4gICAgICBub3RpZmljYXRpb25zLnB1c2goe1xuICAgICAgICBpZDogYGNvbmZ1c2lvbl8ke0RhdGUubm93KCl9YCxcbiAgICAgICAgdHlwZTogTm90aWZpY2F0aW9uVHlwZS5BQ0FERU1JQ19SRVNPVVJDRSxcbiAgICAgICAgdGl0bGU6ICfwn46vIEFjbGFyZW1vcyBsYXMgRHVkYXMnLFxuICAgICAgICBtZXNzYWdlOiBgSGUgZGV0ZWN0YWRvIGNvbmZ1c2nDs24gcmVjdXJyZW50ZSBlbiAke3ByaW1hcnlTdWJqZWN0fS4gVGUgYnVzcXXDqSBleHBsaWNhY2lvbmVzIGVzcGVjaWFsbWVudGUgY2xhcmFzIHBhcmEgcmVzb2x2ZXIgdHVzIGR1ZGFzLmAsXG4gICAgICAgIGFjdGlvbkJ1dHRvbjoge1xuICAgICAgICAgIHRleHQ6ICdBY2xhcmFyIENvbmNlcHRvcycsXG4gICAgICAgICAgYWN0aW9uOiAnc2hvd19zZWFyY2hfcmVzdWx0cycsXG4gICAgICAgICAgcGF5bG9hZDogY2xhcmlmaWNhdGlvblJlc3VsdHNcbiAgICAgICAgfSxcbiAgICAgICAgc2VhcmNoUmVzdWx0czogY2xhcmlmaWNhdGlvblJlc3VsdHMsXG4gICAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKSxcbiAgICAgICAgcHJpb3JpdHk6IE5vdGlmaWNhdGlvblByaW9yaXR5LkhJR0gsXG4gICAgICAgIGNhdGVnb3J5OiBOb3RpZmljYXRpb25DYXRlZ29yeS5BQ0FERU1JQ1xuICAgICAgfSlcbiAgICB9XG5cbiAgICByZXR1cm4gbm90aWZpY2F0aW9uc1xuICB9XG5cbiAgLyoqXG4gICAqIERldGVjdGEgb3BvcnR1bmlkYWRlcyBkZSBhcHJlbmRpemFqZSBiYXNhZGFzIGVuIGVsIHByb2dyZXNvXG4gICAqL1xuICBwcml2YXRlIHN0YXRpYyBhc3luYyBkZXRlY3RMZWFybmluZ09wcG9ydHVuaXRpZXMoXG4gICAgY29udGV4dDogTm90aWZpY2F0aW9uQ29udGV4dCxcbiAgICBtZW1vcnk6IGFueVxuICApOiBQcm9taXNlPFByb2FjdGl2ZU5vdGlmaWNhdGlvbltdPiB7XG4gICAgY29uc3Qgbm90aWZpY2F0aW9uczogUHJvYWN0aXZlTm90aWZpY2F0aW9uW10gPSBbXVxuICAgIGNvbnN0IGFjaGlldmVtZW50QXJlYXMgPSBtZW1vcnkuZW1vdGlvbmFsUHJvZmlsZS5hY2hpZXZlbWVudEFyZWFzIHx8IFtdXG4gICAgY29uc3QgZGlmZmljdWx0U3ViamVjdHMgPSBtZW1vcnkucHJlZmVyZW5jZXM/LmRpZmZpY3VsdFN1YmplY3RzIHx8IFtdXG5cbiAgICAvLyBPcG9ydHVuaWRhZDogRXhwYW5kaXIgw6FyZWFzIGRlIGZvcnRhbGV6YVxuICAgIGlmIChhY2hpZXZlbWVudEFyZWFzLmxlbmd0aCA+IDApIHtcbiAgICAgIGNvbnN0IHN0cm9uZ1N1YmplY3QgPSBhY2hpZXZlbWVudEFyZWFzWzBdXG4gICAgICBjb25zdCBhZHZhbmNlZFNlYXJjaDogQWNhZGVtaWNTZWFyY2hRdWVyeSA9IHtcbiAgICAgICAgdG9waWM6IGAke3N0cm9uZ1N1YmplY3R9IGF2YW56YWRvIHByb3llY3RvcyBkZXNhZsOtb3NgLFxuICAgICAgICBzZWFyY2hUeXBlOiAncmVzb3VyY2VzJyxcbiAgICAgICAgbGV2ZWw6ICdhZHZhbmNlZCcsXG4gICAgICAgIHN1YmplY3Q6IHN0cm9uZ1N1YmplY3QsXG4gICAgICAgIGxhbmd1YWdlOiAnZXMnLFxuICAgICAgICB1c2VySWQ6IGNvbnRleHQudXNlcklkLFxuICAgICAgICBzZXNzaW9uSWQ6IGNvbnRleHQuc2Vzc2lvbklkXG4gICAgICB9XG5cbiAgICAgIGNvbnN0IGFkdmFuY2VkUmVzdWx0cyA9IGF3YWl0IEFjYWRlbWljU2VhcmNoRW5naW5lLnNlYXJjaEFjYWRlbWljQ29udGVudChhZHZhbmNlZFNlYXJjaClcblxuICAgICAgbm90aWZpY2F0aW9ucy5wdXNoKHtcbiAgICAgICAgaWQ6IGBvcHBvcnR1bml0eV8ke0RhdGUubm93KCl9YCxcbiAgICAgICAgdHlwZTogTm90aWZpY2F0aW9uVHlwZS5MRUFSTklOR19USVAsXG4gICAgICAgIHRpdGxlOiAn8J+agCBBbXBsw61hIHR1cyBGb3J0YWxlemFzJyxcbiAgICAgICAgbWVzc2FnZTogYERvbWluYXMgYmllbiAke3N0cm9uZ1N1YmplY3R9LiDCv1RlIGludGVyZXNhIGV4cGxvcmFyIGFzcGVjdG9zIG3DoXMgYXZhbnphZG9zIHkgZGVzYWZpYW50ZXM/YCxcbiAgICAgICAgYWN0aW9uQnV0dG9uOiB7XG4gICAgICAgICAgdGV4dDogJ0V4cGxvcmFyIE5pdmVsIEF2YW56YWRvJyxcbiAgICAgICAgICBhY3Rpb246ICdzaG93X3NlYXJjaF9yZXN1bHRzJyxcbiAgICAgICAgICBwYXlsb2FkOiBhZHZhbmNlZFJlc3VsdHNcbiAgICAgICAgfSxcbiAgICAgICAgc2VhcmNoUmVzdWx0czogYWR2YW5jZWRSZXN1bHRzLFxuICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCksXG4gICAgICAgIHByaW9yaXR5OiBOb3RpZmljYXRpb25Qcmlvcml0eS5MT1csXG4gICAgICAgIGNhdGVnb3J5OiBOb3RpZmljYXRpb25DYXRlZ29yeS5BQ0FERU1JQ1xuICAgICAgfSlcbiAgICB9XG5cbiAgICAvLyBPcG9ydHVuaWRhZDogUmVjdXJzb3MgcGFyYSBtYXRlcmlhcyBkaWbDrWNpbGVzXG4gICAgaWYgKGRpZmZpY3VsdFN1YmplY3RzLmxlbmd0aCA+IDApIHtcbiAgICAgIGNvbnN0IGNoYWxsZW5naW5nU3ViamVjdCA9IGRpZmZpY3VsdFN1YmplY3RzWzBdXG4gICAgICBjb25zdCBzdXBwb3J0U2VhcmNoOiBBY2FkZW1pY1NlYXJjaFF1ZXJ5ID0ge1xuICAgICAgICB0b3BpYzogYCR7Y2hhbGxlbmdpbmdTdWJqZWN0fSB0dXRvcmlhbCBiw6FzaWNvIHBhc28gYSBwYXNvYCxcbiAgICAgICAgc2VhcmNoVHlwZTogJ2V4cGxhbmF0aW9uJyxcbiAgICAgICAgbGV2ZWw6ICdiYXNpYycsXG4gICAgICAgIHN1YmplY3Q6IGNoYWxsZW5naW5nU3ViamVjdCxcbiAgICAgICAgbGFuZ3VhZ2U6ICdlcycsXG4gICAgICAgIHVzZXJJZDogY29udGV4dC51c2VySWQsXG4gICAgICAgIHNlc3Npb25JZDogY29udGV4dC5zZXNzaW9uSWRcbiAgICAgIH1cblxuICAgICAgY29uc3Qgc3VwcG9ydFJlc3VsdHMgPSBhd2FpdCBBY2FkZW1pY1NlYXJjaEVuZ2luZS5zZWFyY2hBY2FkZW1pY0NvbnRlbnQoc3VwcG9ydFNlYXJjaClcblxuICAgICAgbm90aWZpY2F0aW9ucy5wdXNoKHtcbiAgICAgICAgaWQ6IGBzdXBwb3J0XyR7RGF0ZS5ub3coKX1gLFxuICAgICAgICB0eXBlOiBOb3RpZmljYXRpb25UeXBlLkFDQURFTUlDX1JFU09VUkNFLFxuICAgICAgICB0aXRsZTogJ/Cfk5ogUmVjdXJzb3MgcGFyYSBTdXBlcmFyIERlc2Fmw61vcycsXG4gICAgICAgIG1lc3NhZ2U6IGBFbmNvbnRyw6kgbnVldm9zIHJlY3Vyc29zIHBhcmEgJHtjaGFsbGVuZ2luZ1N1YmplY3R9IHF1ZSBwb2Ryw61hbiBheXVkYXJ0ZSBhIHN1cGVyYXIgbGFzIGRpZmljdWx0YWRlcy5gLFxuICAgICAgICBhY3Rpb25CdXR0b246IHtcbiAgICAgICAgICB0ZXh0OiAnVmVyIFJlY3Vyc29zJyxcbiAgICAgICAgICBhY3Rpb246ICdzaG93X3NlYXJjaF9yZXN1bHRzJyxcbiAgICAgICAgICBwYXlsb2FkOiBzdXBwb3J0UmVzdWx0c1xuICAgICAgICB9LFxuICAgICAgICBzZWFyY2hSZXN1bHRzOiBzdXBwb3J0UmVzdWx0cyxcbiAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLFxuICAgICAgICBwcmlvcml0eTogTm90aWZpY2F0aW9uUHJpb3JpdHkuTUVESVVNLFxuICAgICAgICBjYXRlZ29yeTogTm90aWZpY2F0aW9uQ2F0ZWdvcnkuQUNBREVNSUNcbiAgICAgIH0pXG4gICAgfVxuXG4gICAgcmV0dXJuIG5vdGlmaWNhdGlvbnNcbiAgfVxuXG4gIC8qKlxuICAgKiBWZXJpZmljYSBkZWFkbGluZXMgeSB0YXJlYXMgcGVuZGllbnRlc1xuICAgKi9cbiAgcHJpdmF0ZSBzdGF0aWMgYXN5bmMgY2hlY2tEZWFkbGluZXNBbmRUYXNrcyhcbiAgICBjb250ZXh0OiBOb3RpZmljYXRpb25Db250ZXh0LFxuICAgIG1lbW9yeTogYW55XG4gICk6IFByb21pc2U8UHJvYWN0aXZlTm90aWZpY2F0aW9uW10+IHtcbiAgICBjb25zdCBub3RpZmljYXRpb25zOiBQcm9hY3RpdmVOb3RpZmljYXRpb25bXSA9IFtdXG5cbiAgICAvLyBTaW11bGFjacOzbiBkZSBkZWFkbGluZXMgcHLDs3hpbW9zIChlbiB1bmEgaW1wbGVtZW50YWNpw7NuIHJlYWwsIHZlbmRyw61hIGRlIGNhbGVuZGFyaW8pXG4gICAgY29uc3QgdXBjb21pbmdEZWFkbGluZXMgPSBjb250ZXh0LmFjYWRlbWljQ29udGV4dD8udXBjb21pbmdEZWFkbGluZXMgfHwgW11cblxuICAgIGlmICh1cGNvbWluZ0RlYWRsaW5lcy5sZW5ndGggPiAwKSB7XG4gICAgICBjb25zdCBkZWFkbGluZSA9IHVwY29taW5nRGVhZGxpbmVzWzBdXG4gICAgICBjb25zdCBwcmVwYXJhdGlvblNlYXJjaDogQWNhZGVtaWNTZWFyY2hRdWVyeSA9IHtcbiAgICAgICAgdG9waWM6IGAke2RlYWRsaW5lfSBwcmVwYXJhY2nDs24gZXhhbWVuIGd1w61hIGVzdHVkaW9gLFxuICAgICAgICBzZWFyY2hUeXBlOiAncmVzb3VyY2VzJyxcbiAgICAgICAgbGV2ZWw6ICdpbnRlcm1lZGlhdGUnLFxuICAgICAgICBsYW5ndWFnZTogJ2VzJyxcbiAgICAgICAgdXNlcklkOiBjb250ZXh0LnVzZXJJZCxcbiAgICAgICAgc2Vzc2lvbklkOiBjb250ZXh0LnNlc3Npb25JZFxuICAgICAgfVxuXG4gICAgICBjb25zdCBwcmVwUmVzdWx0cyA9IGF3YWl0IEFjYWRlbWljU2VhcmNoRW5naW5lLnNlYXJjaEFjYWRlbWljQ29udGVudChwcmVwYXJhdGlvblNlYXJjaClcblxuICAgICAgbm90aWZpY2F0aW9ucy5wdXNoKHtcbiAgICAgICAgaWQ6IGBkZWFkbGluZV8ke0RhdGUubm93KCl9YCxcbiAgICAgICAgdHlwZTogTm90aWZpY2F0aW9uVHlwZS5ERUFETElORV9BTEVSVCxcbiAgICAgICAgdGl0bGU6ICfij7AgRGVhZGxpbmUgUHLDs3hpbW8nLFxuICAgICAgICBtZXNzYWdlOiBgU2UgYWNlcmNhIHR1ICR7ZGVhZGxpbmV9LiBUZSBidXNxdcOpIHJlY3Vyc29zIGVzcGVjw61maWNvcyBwYXJhIHVuYSBwcmVwYXJhY2nDs24gZWZlY3RpdmEuYCxcbiAgICAgICAgYWN0aW9uQnV0dG9uOiB7XG4gICAgICAgICAgdGV4dDogJ1ByZXBhcmFyIEV4YW1lbicsXG4gICAgICAgICAgYWN0aW9uOiAnc2hvd19zZWFyY2hfcmVzdWx0cycsXG4gICAgICAgICAgcGF5bG9hZDogcHJlcFJlc3VsdHNcbiAgICAgICAgfSxcbiAgICAgICAgc2VhcmNoUmVzdWx0czogcHJlcFJlc3VsdHMsXG4gICAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKSxcbiAgICAgICAgcHJpb3JpdHk6IE5vdGlmaWNhdGlvblByaW9yaXR5LlVSR0VOVCxcbiAgICAgICAgY2F0ZWdvcnk6IE5vdGlmaWNhdGlvbkNhdGVnb3J5Lk9SR0FOSVpBVElPTkFMXG4gICAgICB9KVxuICAgIH1cblxuICAgIHJldHVybiBub3RpZmljYXRpb25zXG4gIH1cblxuICAvKipcbiAgICogQW5hbGl6YSBwYXRyb25lcyBkZSBlc3R1ZGlvIHBhcmEgb3B0aW1pemFjaW9uZXNcbiAgICovXG4gIHByaXZhdGUgc3RhdGljIGFzeW5jIGFuYWx5emVTdHVkeVBhdHRlcm5zKFxuICAgIGNvbnRleHQ6IE5vdGlmaWNhdGlvbkNvbnRleHQsXG4gICAgbWVtb3J5OiBhbnlcbiAgKTogUHJvbWlzZTxQcm9hY3RpdmVOb3RpZmljYXRpb25bXT4ge1xuICAgIGNvbnN0IG5vdGlmaWNhdGlvbnM6IFByb2FjdGl2ZU5vdGlmaWNhdGlvbltdID0gW11cbiAgICBjb25zdCB0b3RhbFR1cm5zID0gbWVtb3J5LnRvdGFsVHVybnMgfHwgMFxuXG4gICAgLy8gUGF0csOzbjogVXN1YXJpbyBudWV2byAtIG9mcmVjZXIgb3JpZW50YWNpw7NuXG4gICAgaWYgKHRvdGFsVHVybnMgPCA1KSB7XG4gICAgICBjb25zdCBvcmllbnRhdGlvblNlYXJjaDogQWNhZGVtaWNTZWFyY2hRdWVyeSA9IHtcbiAgICAgICAgdG9waWM6ICd0w6ljbmljYXMgZGUgZXN0dWRpbyBlZmVjdGl2YXMgZ3XDrWEgcGFyYSBlc3R1ZGlhbnRlcycsXG4gICAgICAgIHNlYXJjaFR5cGU6ICdyZXNvdXJjZXMnLFxuICAgICAgICBsZXZlbDogJ2Jhc2ljJyxcbiAgICAgICAgbGFuZ3VhZ2U6ICdlcycsXG4gICAgICAgIHVzZXJJZDogY29udGV4dC51c2VySWQsXG4gICAgICAgIHNlc3Npb25JZDogY29udGV4dC5zZXNzaW9uSWRcbiAgICAgIH1cblxuICAgICAgY29uc3Qgb3JpZW50YXRpb25SZXN1bHRzID0gYXdhaXQgQWNhZGVtaWNTZWFyY2hFbmdpbmUuc2VhcmNoQWNhZGVtaWNDb250ZW50KG9yaWVudGF0aW9uU2VhcmNoKVxuXG4gICAgICBub3RpZmljYXRpb25zLnB1c2goe1xuICAgICAgICBpZDogYG9yaWVudGF0aW9uXyR7RGF0ZS5ub3coKX1gLFxuICAgICAgICB0eXBlOiBOb3RpZmljYXRpb25UeXBlLkxFQVJOSU5HX1RJUCxcbiAgICAgICAgdGl0bGU6ICfwn5GLIE9wdGltaXphIHR1IEVzdHVkaW8nLFxuICAgICAgICBtZXNzYWdlOiAnQ29tbyBlcmVzIG51ZXZvLCB0ZSBlbmNvbnRyw6kgbGFzIG1lam9yZXMgdMOpY25pY2FzIGRlIGVzdHVkaW8gcGFyYSBtYXhpbWl6YXIgdHUgYXByZW5kaXphamUgZGVzZGUgZWwgaW5pY2lvLicsXG4gICAgICAgIGFjdGlvbkJ1dHRvbjoge1xuICAgICAgICAgIHRleHQ6ICdDb25vY2VyIFTDqWNuaWNhcycsXG4gICAgICAgICAgYWN0aW9uOiAnc2hvd19zZWFyY2hfcmVzdWx0cycsXG4gICAgICAgICAgcGF5bG9hZDogb3JpZW50YXRpb25SZXN1bHRzXG4gICAgICAgIH0sXG4gICAgICAgIHNlYXJjaFJlc3VsdHM6IG9yaWVudGF0aW9uUmVzdWx0cyxcbiAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLFxuICAgICAgICBwcmlvcml0eTogTm90aWZpY2F0aW9uUHJpb3JpdHkuTUVESVVNLFxuICAgICAgICBjYXRlZ29yeTogTm90aWZpY2F0aW9uQ2F0ZWdvcnkuQUNBREVNSUNcbiAgICAgIH0pXG4gICAgfVxuXG4gICAgcmV0dXJuIG5vdGlmaWNhdGlvbnNcbiAgfVxuXG4gIC8qKlxuICAgKiBQcmlvcml6YSBub3RpZmljYWNpb25lcyBzZWfDum4gdXJnZW5jaWEgeSByZWxldmFuY2lhXG4gICAqL1xuICBwcml2YXRlIHN0YXRpYyBwcmlvcml0aXplTm90aWZpY2F0aW9ucyhub3RpZmljYXRpb25zOiBQcm9hY3RpdmVOb3RpZmljYXRpb25bXSk6IFByb2FjdGl2ZU5vdGlmaWNhdGlvbltdIHtcbiAgICBjb25zdCBwcmlvcml0eU9yZGVyID0ge1xuICAgICAgW05vdGlmaWNhdGlvblByaW9yaXR5LlVSR0VOVF06IDQsXG4gICAgICBbTm90aWZpY2F0aW9uUHJpb3JpdHkuSElHSF06IDMsXG4gICAgICBbTm90aWZpY2F0aW9uUHJpb3JpdHkuTUVESVVNXTogMixcbiAgICAgIFtOb3RpZmljYXRpb25Qcmlvcml0eS5MT1ddOiAxXG4gICAgfVxuXG4gICAgcmV0dXJuIG5vdGlmaWNhdGlvbnMuc29ydCgoYSwgYikgPT4ge1xuICAgICAgY29uc3QgcHJpb3JpdHlBID0gcHJpb3JpdHlPcmRlclthLnByaW9yaXR5XVxuICAgICAgY29uc3QgcHJpb3JpdHlCID0gcHJpb3JpdHlPcmRlcltiLnByaW9yaXR5XVxuICAgICAgXG4gICAgICBpZiAocHJpb3JpdHlBICE9PSBwcmlvcml0eUIpIHtcbiAgICAgICAgcmV0dXJuIHByaW9yaXR5QiAtIHByaW9yaXR5QVxuICAgICAgfVxuICAgICAgXG4gICAgICAvLyBTaSB0aWVuZW4gbGEgbWlzbWEgcHJpb3JpZGFkLCBvcmRlbmFyIHBvciB0aW1lc3RhbXAgKG3DoXMgcmVjaWVudGUgcHJpbWVybylcbiAgICAgIHJldHVybiBiLnRpbWVzdGFtcC5nZXRUaW1lKCkgLSBhLnRpbWVzdGFtcC5nZXRUaW1lKClcbiAgICB9KVxuICB9XG5cbiAgLyoqXG4gICAqIEVudsOtYSBub3RpZmljYWNpw7NuIHVzYW5kbyBOb3Z1IG8gc2lzdGVtYSBsb2NhbFxuICAgKi9cbiAgcHJpdmF0ZSBzdGF0aWMgYXN5bmMgc2VuZE5vdGlmaWNhdGlvbihub3RpZmljYXRpb246IFByb2FjdGl2ZU5vdGlmaWNhdGlvbiwgdXNlcklkOiBzdHJpbmcpOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgICB0cnkge1xuICAgICAgaWYgKHRoaXMubm92dSkge1xuICAgICAgICAvLyBFbnZpYXIgY29uIE5vdnVcbiAgICAgICAgYXdhaXQgdGhpcy5ub3Z1LnRyaWdnZXIoJ2FjYWRlbWljLW5vdGlmaWNhdGlvbicsIHtcbiAgICAgICAgICB0bzoge1xuICAgICAgICAgICAgc3Vic2NyaWJlcklkOiB1c2VySWQsXG4gICAgICAgICAgfSxcbiAgICAgICAgICBwYXlsb2FkOiB7XG4gICAgICAgICAgICB0aXRsZTogbm90aWZpY2F0aW9uLnRpdGxlLFxuICAgICAgICAgICAgbWVzc2FnZTogbm90aWZpY2F0aW9uLm1lc3NhZ2UsXG4gICAgICAgICAgICBhY3Rpb25UZXh0OiBub3RpZmljYXRpb24uYWN0aW9uQnV0dG9uPy50ZXh0LFxuICAgICAgICAgICAgYWN0aW9uUGF5bG9hZDogbm90aWZpY2F0aW9uLmFjdGlvbkJ1dHRvbj8ucGF5bG9hZCxcbiAgICAgICAgICAgIHByaW9yaXR5OiBub3RpZmljYXRpb24ucHJpb3JpdHksXG4gICAgICAgICAgICBjYXRlZ29yeTogbm90aWZpY2F0aW9uLmNhdGVnb3J5LFxuICAgICAgICAgICAgdGltZXN0YW1wOiBub3RpZmljYXRpb24udGltZXN0YW1wLnRvSVNPU3RyaW5nKClcbiAgICAgICAgICB9LFxuICAgICAgICB9KVxuICAgICAgICBcbiAgICAgICAgY29uc29sZS5sb2coYPCfk6wgTm92dSBub3RpZmljYXRpb24gc2VudDogJHtub3RpZmljYXRpb24udGl0bGV9YClcbiAgICAgICAgcmV0dXJuIHRydWVcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIFNpc3RlbWEgbG9jYWwgZGUgbm90aWZpY2FjaW9uZXNcbiAgICAgICAgY29uc29sZS5sb2coYPCfk7EgTG9jYWwgbm90aWZpY2F0aW9uOiAke25vdGlmaWNhdGlvbi50aXRsZX0gLSAke25vdGlmaWNhdGlvbi5tZXNzYWdlfWApXG4gICAgICAgIHRoaXMuc3RvcmVMb2NhbE5vdGlmaWNhdGlvbihub3RpZmljYXRpb24sIHVzZXJJZClcbiAgICAgICAgcmV0dXJuIHRydWVcbiAgICAgIH1cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcign4p2MIEZhaWxlZCB0byBzZW5kIG5vdGlmaWNhdGlvbjonLCBlcnJvcilcbiAgICAgIC8vIEZhbGxiYWNrOiBndWFyZGFyIGxvY2FsbWVudGVcbiAgICAgIHRoaXMuc3RvcmVMb2NhbE5vdGlmaWNhdGlvbihub3RpZmljYXRpb24sIHVzZXJJZClcbiAgICAgIHJldHVybiBmYWxzZVxuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBBbG1hY2VuYSBub3RpZmljYWNpw7NuIGxvY2FsbWVudGUgY3VhbmRvIE5vdnUgbm8gZXN0w6EgZGlzcG9uaWJsZVxuICAgKi9cbiAgcHJpdmF0ZSBzdGF0aWMgc3RvcmVMb2NhbE5vdGlmaWNhdGlvbihub3RpZmljYXRpb246IFByb2FjdGl2ZU5vdGlmaWNhdGlvbiwgdXNlcklkOiBzdHJpbmcpIHtcbiAgICAvLyBFbiB1biBzaXN0ZW1hIHJlYWwsIGVzdG8gc2UgZ3VhcmRhcsOtYSBlbiBiYXNlIGRlIGRhdG9zXG4gICAgLy8gUG9yIGFob3JhLCB1c2Ftb3MgYWxtYWNlbmFtaWVudG8gZW4gbWVtb3JpYVxuICAgIGlmICghZ2xvYmFsVGhpcy5sb2NhbE5vdGlmaWNhdGlvbnMpIHtcbiAgICAgIGdsb2JhbFRoaXMubG9jYWxOb3RpZmljYXRpb25zID0gbmV3IE1hcCgpXG4gICAgfVxuICAgIFxuICAgIGlmICghZ2xvYmFsVGhpcy5sb2NhbE5vdGlmaWNhdGlvbnMuaGFzKHVzZXJJZCkpIHtcbiAgICAgIGdsb2JhbFRoaXMubG9jYWxOb3RpZmljYXRpb25zLnNldCh1c2VySWQsIFtdKVxuICAgIH1cbiAgICBcbiAgICBjb25zdCB1c2VyTm90aWZpY2F0aW9ucyA9IGdsb2JhbFRoaXMubG9jYWxOb3RpZmljYXRpb25zLmdldCh1c2VySWQpXG4gICAgdXNlck5vdGlmaWNhdGlvbnMudW5zaGlmdChub3RpZmljYXRpb24pIC8vIEFncmVnYXIgYWwgaW5pY2lvXG4gICAgXG4gICAgLy8gTWFudGVuZXIgc29sbyBsYXMgw7psdGltYXMgMTAgbm90aWZpY2FjaW9uZXNcbiAgICBpZiAodXNlck5vdGlmaWNhdGlvbnMubGVuZ3RoID4gMTApIHtcbiAgICAgIHVzZXJOb3RpZmljYXRpb25zLnNwbGljZSgxMClcbiAgICB9XG4gICAgXG4gICAgY29uc29sZS5sb2coYPCfkr4gU3RvcmVkIGxvY2FsIG5vdGlmaWNhdGlvbiBmb3IgdXNlciAke3VzZXJJZH06ICR7bm90aWZpY2F0aW9uLnRpdGxlfWApXG4gIH1cblxuICAvKipcbiAgICogT2J0aWVuZSBub3RpZmljYWNpb25lcyBsb2NhbGVzIHBhcmEgdW4gdXN1YXJpb1xuICAgKi9cbiAgc3RhdGljIGdldExvY2FsTm90aWZpY2F0aW9ucyh1c2VySWQ6IHN0cmluZyk6IFByb2FjdGl2ZU5vdGlmaWNhdGlvbltdIHtcbiAgICBpZiAoIWdsb2JhbFRoaXMubG9jYWxOb3RpZmljYXRpb25zKSB7XG4gICAgICByZXR1cm4gW11cbiAgICB9XG4gICAgXG4gICAgcmV0dXJuIGdsb2JhbFRoaXMubG9jYWxOb3RpZmljYXRpb25zLmdldCh1c2VySWQpIHx8IFtdXG4gIH1cblxuICAvKipcbiAgICogTGltcGlhIG5vdGlmaWNhY2lvbmVzIGFudGlndWFzXG4gICAqL1xuICBzdGF0aWMgY2xlYXJPbGROb3RpZmljYXRpb25zKHVzZXJJZDogc3RyaW5nLCBvbGRlclRoYW5Ib3VyczogbnVtYmVyID0gMjQpIHtcbiAgICBpZiAoIWdsb2JhbFRoaXMubG9jYWxOb3RpZmljYXRpb25zKSByZXR1cm5cbiAgICBcbiAgICBjb25zdCB1c2VyTm90aWZpY2F0aW9ucyA9IGdsb2JhbFRoaXMubG9jYWxOb3RpZmljYXRpb25zLmdldCh1c2VySWQpIHx8IFtdXG4gICAgY29uc3QgY3V0b2ZmVGltZSA9IG5ldyBEYXRlKERhdGUubm93KCkgLSAob2xkZXJUaGFuSG91cnMgKiA2MCAqIDYwICogMTAwMCkpXG4gICAgXG4gICAgY29uc3QgcmVjZW50Tm90aWZpY2F0aW9ucyA9IHVzZXJOb3RpZmljYXRpb25zLmZpbHRlcihcbiAgICAgIG5vdGlmaWNhdGlvbiA9PiBub3RpZmljYXRpb24udGltZXN0YW1wID4gY3V0b2ZmVGltZVxuICAgIClcbiAgICBcbiAgICBnbG9iYWxUaGlzLmxvY2FsTm90aWZpY2F0aW9ucy5zZXQodXNlcklkLCByZWNlbnROb3RpZmljYXRpb25zKVxuICB9XG5cbiAgLyoqXG4gICAqIEdlbmVyYSBub3RpZmljYWNpw7NuIGJhc2FkYSBlbiBiw7pzcXVlZGEgYWNhZMOpbWljYSBkaXJlY3RhXG4gICAqL1xuICBzdGF0aWMgYXN5bmMgY3JlYXRlQWNhZGVtaWNOb3RpZmljYXRpb24oXG4gICAgdXNlcklkOiBzdHJpbmcsXG4gICAgc2VhcmNoUXVlcnk6IEFjYWRlbWljU2VhcmNoUXVlcnksXG4gICAgdHJpZ2dlcjogTm90aWZpY2F0aW9uVHJpZ2dlcixcbiAgICBjdXN0b21UaXRsZT86IHN0cmluZyxcbiAgICBjdXN0b21NZXNzYWdlPzogc3RyaW5nXG4gICk6IFByb21pc2U8UHJvYWN0aXZlTm90aWZpY2F0aW9uPiB7XG4gICAgY29uc3Qgc2VhcmNoUmVzdWx0cyA9IGF3YWl0IEFjYWRlbWljU2VhcmNoRW5naW5lLnNlYXJjaEFjYWRlbWljQ29udGVudChzZWFyY2hRdWVyeSlcbiAgICBcbiAgICBjb25zdCBkZWZhdWx0VGl0bGVzID0ge1xuICAgICAgW05vdGlmaWNhdGlvblRyaWdnZXIuS05PV0xFREdFX0dBUF06ICfwn46vIFJlY3Vyc29zIHBhcmEgdHUgQ29uc3VsdGEnLFxuICAgICAgW05vdGlmaWNhdGlvblRyaWdnZXIuTEVBUk5JTkdfT1BQT1JUVU5JVFldOiAn8J+TmiBOdWV2YSBPcG9ydHVuaWRhZCBkZSBBcHJlbmRpemFqZScsXG4gICAgICBbTm90aWZpY2F0aW9uVHJpZ2dlci5BQ0FERU1JQ19TVFJVR0dMRV06ICfwn5KhIEF5dWRhIEVzcGVjw61maWNhIEVuY29udHJhZGEnLFxuICAgIH1cblxuICAgIGNvbnN0IGRlZmF1bHRNZXNzYWdlcyA9IHtcbiAgICAgIFtOb3RpZmljYXRpb25UcmlnZ2VyLktOT1dMRURHRV9HQVBdOiBgRW5jb250csOpIHJlY3Vyc29zIGVzcGVjw61maWNvcyBzb2JyZSAke3NlYXJjaFF1ZXJ5LnRvcGljfSBxdWUgcHVlZGVuIHJlc29sdmVyIHR1cyBkdWRhcy5gLFxuICAgICAgW05vdGlmaWNhdGlvblRyaWdnZXIuTEVBUk5JTkdfT1BQT1JUVU5JVFldOiBgSGUgZGVzY3ViaWVydG8gbWF0ZXJpYWwgaW50ZXJlc2FudGUgc29icmUgJHtzZWFyY2hRdWVyeS50b3BpY30gcXVlIHBvZHLDrWEgZXhwYW5kaXIgdHUgY29ub2NpbWllbnRvLmAsXG4gICAgICBbTm90aWZpY2F0aW9uVHJpZ2dlci5BQ0FERU1JQ19TVFJVR0dMRV06IGBUZSBidXNxdcOpIHJlY3Vyc29zIGVzcGVjaWFsaXphZG9zIHBhcmEgc3VwZXJhciBsYXMgZGlmaWN1bHRhZGVzIGNvbiAke3NlYXJjaFF1ZXJ5LnRvcGljfS5gLFxuICAgIH1cblxuICAgIGNvbnN0IG5vdGlmaWNhdGlvbjogUHJvYWN0aXZlTm90aWZpY2F0aW9uID0ge1xuICAgICAgaWQ6IGBhY2FkZW1pY18ke0RhdGUubm93KCl9YCxcbiAgICAgIHR5cGU6IE5vdGlmaWNhdGlvblR5cGUuQUNBREVNSUNfUkVTT1VSQ0UsXG4gICAgICB0aXRsZTogY3VzdG9tVGl0bGUgfHwgZGVmYXVsdFRpdGxlc1t0cmlnZ2VyXSB8fCAn8J+TliBSZWN1cnNvcyBBY2Fkw6ltaWNvcycsXG4gICAgICBtZXNzYWdlOiBjdXN0b21NZXNzYWdlIHx8IGRlZmF1bHRNZXNzYWdlc1t0cmlnZ2VyXSB8fCBgUmVjdXJzb3MgZW5jb250cmFkb3Mgc29icmUgJHtzZWFyY2hRdWVyeS50b3BpY31gLFxuICAgICAgYWN0aW9uQnV0dG9uOiB7XG4gICAgICAgIHRleHQ6ICdWZXIgUmVjdXJzb3MnLFxuICAgICAgICBhY3Rpb246ICdzaG93X3NlYXJjaF9yZXN1bHRzJyxcbiAgICAgICAgcGF5bG9hZDogc2VhcmNoUmVzdWx0c1xuICAgICAgfSxcbiAgICAgIHNlYXJjaFJlc3VsdHMsXG4gICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCksXG4gICAgICBwcmlvcml0eTogTm90aWZpY2F0aW9uUHJpb3JpdHkuTUVESVVNLFxuICAgICAgY2F0ZWdvcnk6IE5vdGlmaWNhdGlvbkNhdGVnb3J5LkFDQURFTUlDXG4gICAgfVxuXG4gICAgLy8gRW52aWFyIGxhIG5vdGlmaWNhY2nDs25cbiAgICBhd2FpdCB0aGlzLnNlbmROb3RpZmljYXRpb24obm90aWZpY2F0aW9uLCB1c2VySWQpXG4gICAgXG4gICAgcmV0dXJuIG5vdGlmaWNhdGlvblxuICB9XG5cbiAgLyoqXG4gICAqIE9idGllbmUgZXN0YWTDrXN0aWNhcyBkZWwgc2lzdGVtYSBkZSBub3RpZmljYWNpb25lc1xuICAgKi9cbiAgc3RhdGljIGdldE5vdGlmaWNhdGlvblN0YXRzKHVzZXJJZD86IHN0cmluZykge1xuICAgIGNvbnN0IGFsbE5vdGlmaWNhdGlvbnMgPSBnbG9iYWxUaGlzLmxvY2FsTm90aWZpY2F0aW9ucyB8fCBuZXcgTWFwKClcbiAgICBcbiAgICBpZiAodXNlcklkKSB7XG4gICAgICBjb25zdCB1c2VyTm90aWZpY2F0aW9ucyA9IGFsbE5vdGlmaWNhdGlvbnMuZ2V0KHVzZXJJZCkgfHwgW11cbiAgICAgIHJldHVybiB7XG4gICAgICAgIHRvdGFsOiB1c2VyTm90aWZpY2F0aW9ucy5sZW5ndGgsXG4gICAgICAgIGJ5VHlwZTogdGhpcy5ncm91cEJ5UHJvcGVydHkodXNlck5vdGlmaWNhdGlvbnMsICd0eXBlJyksXG4gICAgICAgIGJ5UHJpb3JpdHk6IHRoaXMuZ3JvdXBCeVByb3BlcnR5KHVzZXJOb3RpZmljYXRpb25zLCAncHJpb3JpdHknKSxcbiAgICAgICAgYnlDYXRlZ29yeTogdGhpcy5ncm91cEJ5UHJvcGVydHkodXNlck5vdGlmaWNhdGlvbnMsICdjYXRlZ29yeScpLFxuICAgICAgICByZWNlbnQ6IHVzZXJOb3RpZmljYXRpb25zLmZpbHRlcihuID0+IFxuICAgICAgICAgIG4udGltZXN0YW1wID4gbmV3IERhdGUoRGF0ZS5ub3coKSAtIDI0ICogNjAgKiA2MCAqIDEwMDApXG4gICAgICAgICkubGVuZ3RoXG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gRXN0YWTDrXN0aWNhcyBnbG9iYWxlc1xuICAgIGxldCB0b3RhbE5vdGlmaWNhdGlvbnMgPSAwXG4gICAgY29uc3QgZ2xvYmFsU3RhdHMgPSB7IGJ5VHlwZToge30sIGJ5UHJpb3JpdHk6IHt9LCBieUNhdGVnb3J5OiB7fSB9XG4gICAgXG4gICAgZm9yIChjb25zdCB1c2VyTm90aWZpY2F0aW9ucyBvZiBhbGxOb3RpZmljYXRpb25zLnZhbHVlcygpKSB7XG4gICAgICB0b3RhbE5vdGlmaWNhdGlvbnMgKz0gdXNlck5vdGlmaWNhdGlvbnMubGVuZ3RoXG4gICAgfVxuXG4gICAgcmV0dXJuIHtcbiAgICAgIHRvdGFsVXNlcnM6IGFsbE5vdGlmaWNhdGlvbnMuc2l6ZSxcbiAgICAgIHRvdGFsTm90aWZpY2F0aW9ucyxcbiAgICAgIG5vdnVFbmFibGVkOiB0aGlzLm5vdnUgIT09IG51bGwsXG4gICAgICBpbml0aWFsaXplZDogdGhpcy5pbml0aWFsaXplZFxuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBVdGlsaXRhcmlvIHBhcmEgYWdydXBhciBwb3IgcHJvcGllZGFkXG4gICAqL1xuICBwcml2YXRlIHN0YXRpYyBncm91cEJ5UHJvcGVydHkobm90aWZpY2F0aW9uczogUHJvYWN0aXZlTm90aWZpY2F0aW9uW10sIHByb3BlcnR5OiBrZXlvZiBQcm9hY3RpdmVOb3RpZmljYXRpb24pIHtcbiAgICByZXR1cm4gbm90aWZpY2F0aW9ucy5yZWR1Y2UoKGFjYywgbm90aWZpY2F0aW9uKSA9PiB7XG4gICAgICBjb25zdCBrZXkgPSBub3RpZmljYXRpb25bcHJvcGVydHldIGFzIHN0cmluZ1xuICAgICAgYWNjW2tleV0gPSAoYWNjW2tleV0gfHwgMCkgKyAxXG4gICAgICByZXR1cm4gYWNjXG4gICAgfSwge30gYXMgUmVjb3JkPHN0cmluZywgbnVtYmVyPilcbiAgfVxufVxuXG4vLyBJbmljaWFsaXphciBlbCBzZXJ2aWNpbyBhdXRvbcOhdGljYW1lbnRlXG5Ob3RpZmljYXRpb25TZXJ2aWNlLmluaXRpYWxpemUoKSJdLCJuYW1lcyI6WyJOb3Z1IiwiQWNhZGVtaWNTZWFyY2hFbmdpbmUiLCJDb252ZXJzYXRpb25NZW1vcnlNYW5hZ2VyIiwiRW1vdGlvblR5cGUiLCJOb3RpZmljYXRpb25UcmlnZ2VyIiwiTm90aWZpY2F0aW9uVHlwZSIsIk5vdGlmaWNhdGlvblByaW9yaXR5IiwiTm90aWZpY2F0aW9uQ2F0ZWdvcnkiLCJOb3RpZmljYXRpb25TZXJ2aWNlIiwibm92dSIsImluaXRpYWxpemVkIiwiaW5pdGlhbGl6ZSIsImFwaUtleSIsInByb2Nlc3MiLCJlbnYiLCJOT1ZVX0FQSV9LRVkiLCJsZW5ndGgiLCJjb25zb2xlIiwibG9nIiwiZXJyb3IiLCJhbmFseXplQW5kTm90aWZ5IiwiY29udGV4dCIsIm5vdGlmaWNhdGlvbnMiLCJtZW1vcnkiLCJnZXRNZW1vcnkiLCJ1c2VySWQiLCJzZXNzaW9uSWQiLCJlbW90aW9uYWxOb3RpZmljYXRpb25zIiwiYW5hbHl6ZUVtb3Rpb25hbFBhdHRlcm5zIiwicHVzaCIsImxlYXJuaW5nTm90aWZpY2F0aW9ucyIsImRldGVjdExlYXJuaW5nT3Bwb3J0dW5pdGllcyIsImRlYWRsaW5lTm90aWZpY2F0aW9ucyIsImNoZWNrRGVhZGxpbmVzQW5kVGFza3MiLCJzdHVkeVBhdHRlcm5Ob3RpZmljYXRpb25zIiwiYW5hbHl6ZVN0dWR5UGF0dGVybnMiLCJwcmlvcml0aXplZE5vdGlmaWNhdGlvbnMiLCJwcmlvcml0aXplTm90aWZpY2F0aW9ucyIsIm5vdGlmaWNhdGlvbiIsInNsaWNlIiwic2VuZE5vdGlmaWNhdGlvbiIsInJlY2VudEVtb3Rpb25zIiwiZW1vdGlvbmFsUHJvZmlsZSIsImN1cnJlbnRNb29kIiwibW90aXZhdGlvbkxldmVsIiwiZmlsdGVyIiwiZSIsIkZSVVNUUkFURUQiLCJzZWFyY2hRdWVyeSIsInRvcGljIiwic2VhcmNoVHlwZSIsImxldmVsIiwibGFuZ3VhZ2UiLCJzZWFyY2hSZXN1bHRzIiwic2VhcmNoQWNhZGVtaWNDb250ZW50IiwiaWQiLCJEYXRlIiwibm93IiwidHlwZSIsInRpdGxlIiwibWVzc2FnZSIsImFjdGlvbkJ1dHRvbiIsInRleHQiLCJhY3Rpb24iLCJwYXlsb2FkIiwidGltZXN0YW1wIiwicHJpb3JpdHkiLCJjYXRlZ29yeSIsIm1vdGl2YXRpb25hbFNlYXJjaCIsIm1vdGl2YXRpb25SZXN1bHRzIiwiQ09ORlVTRUQiLCJkaWZmaWN1bHRTdWJqZWN0cyIsInByZWZlcmVuY2VzIiwicHJpbWFyeVN1YmplY3QiLCJjbGFyaWZpY2F0aW9uU2VhcmNoIiwic3ViamVjdCIsImNsYXJpZmljYXRpb25SZXN1bHRzIiwiYWNoaWV2ZW1lbnRBcmVhcyIsInN0cm9uZ1N1YmplY3QiLCJhZHZhbmNlZFNlYXJjaCIsImFkdmFuY2VkUmVzdWx0cyIsImNoYWxsZW5naW5nU3ViamVjdCIsInN1cHBvcnRTZWFyY2giLCJzdXBwb3J0UmVzdWx0cyIsInVwY29taW5nRGVhZGxpbmVzIiwiYWNhZGVtaWNDb250ZXh0IiwiZGVhZGxpbmUiLCJwcmVwYXJhdGlvblNlYXJjaCIsInByZXBSZXN1bHRzIiwidG90YWxUdXJucyIsIm9yaWVudGF0aW9uU2VhcmNoIiwib3JpZW50YXRpb25SZXN1bHRzIiwicHJpb3JpdHlPcmRlciIsInNvcnQiLCJhIiwiYiIsInByaW9yaXR5QSIsInByaW9yaXR5QiIsImdldFRpbWUiLCJ0cmlnZ2VyIiwidG8iLCJzdWJzY3JpYmVySWQiLCJhY3Rpb25UZXh0IiwiYWN0aW9uUGF5bG9hZCIsInRvSVNPU3RyaW5nIiwic3RvcmVMb2NhbE5vdGlmaWNhdGlvbiIsImdsb2JhbFRoaXMiLCJsb2NhbE5vdGlmaWNhdGlvbnMiLCJNYXAiLCJoYXMiLCJzZXQiLCJ1c2VyTm90aWZpY2F0aW9ucyIsImdldCIsInVuc2hpZnQiLCJzcGxpY2UiLCJnZXRMb2NhbE5vdGlmaWNhdGlvbnMiLCJjbGVhck9sZE5vdGlmaWNhdGlvbnMiLCJvbGRlclRoYW5Ib3VycyIsImN1dG9mZlRpbWUiLCJyZWNlbnROb3RpZmljYXRpb25zIiwiY3JlYXRlQWNhZGVtaWNOb3RpZmljYXRpb24iLCJjdXN0b21UaXRsZSIsImN1c3RvbU1lc3NhZ2UiLCJkZWZhdWx0VGl0bGVzIiwiZGVmYXVsdE1lc3NhZ2VzIiwiZ2V0Tm90aWZpY2F0aW9uU3RhdHMiLCJhbGxOb3RpZmljYXRpb25zIiwidG90YWwiLCJieVR5cGUiLCJncm91cEJ5UHJvcGVydHkiLCJieVByaW9yaXR5IiwiYnlDYXRlZ29yeSIsInJlY2VudCIsIm4iLCJ0b3RhbE5vdGlmaWNhdGlvbnMiLCJnbG9iYWxTdGF0cyIsInZhbHVlcyIsInRvdGFsVXNlcnMiLCJzaXplIiwibm92dUVuYWJsZWQiLCJwcm9wZXJ0eSIsInJlZHVjZSIsImFjYyIsImtleSJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/notification-service.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/temp-storage.ts":
/*!*********************************!*\
  !*** ./src/lib/temp-storage.ts ***!
  \*********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   addConversationTurn: () => (/* binding */ addConversationTurn),\n/* harmony export */   addPendingTask: () => (/* binding */ addPendingTask),\n/* harmony export */   addUser: () => (/* binding */ addUser),\n/* harmony export */   addWeeklyReport: () => (/* binding */ addWeeklyReport),\n/* harmony export */   canSubmitThisWeek: () => (/* binding */ canSubmitThisWeek),\n/* harmony export */   cleanupOldConversations: () => (/* binding */ cleanupOldConversations),\n/* harmony export */   createConversationSession: () => (/* binding */ createConversationSession),\n/* harmony export */   deleteUser: () => (/* binding */ deleteUser),\n/* harmony export */   findEventById: () => (/* binding */ findEventById),\n/* harmony export */   findUserByEmail: () => (/* binding */ findUserByEmail),\n/* harmony export */   findUserById: () => (/* binding */ findUserById),\n/* harmony export */   findUserByStudentId: () => (/* binding */ findUserByStudentId),\n/* harmony export */   findUsersByProgram: () => (/* binding */ findUsersByProgram),\n/* harmony export */   findUsersByRole: () => (/* binding */ findUsersByRole),\n/* harmony export */   findUsersByStatus: () => (/* binding */ findUsersByStatus),\n/* harmony export */   findWeeklyReportByUserAndWeek: () => (/* binding */ findWeeklyReportByUserAndWeek),\n/* harmony export */   findWeeklyReportsByUser: () => (/* binding */ findWeeklyReportsByUser),\n/* harmony export */   generateStudentId: () => (/* binding */ generateStudentId),\n/* harmony export */   getAllCalendarEvents: () => (/* binding */ getAllCalendarEvents),\n/* harmony export */   getAllUsers: () => (/* binding */ getAllUsers),\n/* harmony export */   getAllWeeklyReports: () => (/* binding */ getAllWeeklyReports),\n/* harmony export */   getConversationHistory: () => (/* binding */ getConversationHistory),\n/* harmony export */   getConversationSession: () => (/* binding */ getConversationSession),\n/* harmony export */   getCurrentWeekEnd: () => (/* binding */ getCurrentWeekEnd),\n/* harmony export */   getCurrentWeekStart: () => (/* binding */ getCurrentWeekStart),\n/* harmony export */   getEvents: () => (/* binding */ getEvents),\n/* harmony export */   getEventsForDateRange: () => (/* binding */ getEventsForDateRange),\n/* harmony export */   getMonthWeeks: () => (/* binding */ getMonthWeeks),\n/* harmony export */   getPendingTasks: () => (/* binding */ getPendingTasks),\n/* harmony export */   getUpcomingEvents: () => (/* binding */ getUpcomingEvents),\n/* harmony export */   getUserActiveSessions: () => (/* binding */ getUserActiveSessions),\n/* harmony export */   getWeekDates: () => (/* binding */ getWeekDates),\n/* harmony export */   getWeeklyReportsByDateRange: () => (/* binding */ getWeeklyReportsByDateRange),\n/* harmony export */   markTaskCompleted: () => (/* binding */ markTaskCompleted),\n/* harmony export */   tempConversations: () => (/* binding */ tempConversations),\n/* harmony export */   tempUsers: () => (/* binding */ tempUsers),\n/* harmony export */   tempWeeklyReports: () => (/* binding */ tempWeeklyReports),\n/* harmony export */   updateConversationSession: () => (/* binding */ updateConversationSession),\n/* harmony export */   updateUser: () => (/* binding */ updateUser),\n/* harmony export */   validateStudentId: () => (/* binding */ validateStudentId)\n/* harmony export */ });\n/* harmony import */ var bcryptjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! bcryptjs */ \"(rsc)/./node_modules/bcryptjs/index.js\");\n// Temporary user storage - replace with database later\n// Singleton pattern to persist data across requests\nconst globalForStorage = globalThis;\nconst tempUsers = globalForStorage.tempUsers ?? [];\nconst tempWeeklyReports = globalForStorage.tempWeeklyReports ?? [];\n// Assign to globalThis to persist across requests\nglobalForStorage.tempUsers = tempUsers;\nglobalForStorage.tempWeeklyReports = tempWeeklyReports;\nfunction addUser(user) {\n    tempUsers.push(user);\n}\nfunction findUserByEmail(email) {\n    return tempUsers.find((user)=>user.email === email);\n}\nfunction findUserByStudentId(studentId) {\n    return tempUsers.find((user)=>user.studentId === studentId);\n}\nfunction findUserById(id) {\n    return tempUsers.find((user)=>user.id === id);\n}\nfunction getAllUsers() {\n    return tempUsers;\n}\nfunction findUsersByRole(role) {\n    return tempUsers.filter((user)=>user.role === role);\n}\nfunction findUsersByProgram(program) {\n    return tempUsers.filter((user)=>user.program === program);\n}\nfunction findUsersByStatus(status) {\n    return tempUsers.filter((user)=>user.status === status);\n}\nfunction updateUser(id, updates) {\n    const userIndex = tempUsers.findIndex((user)=>user.id === id);\n    if (userIndex !== -1) {\n        tempUsers[userIndex] = {\n            ...tempUsers[userIndex],\n            ...updates,\n            updatedAt: new Date()\n        };\n        return tempUsers[userIndex];\n    }\n    return null;\n}\nfunction deleteUser(id) {\n    const userIndex = tempUsers.findIndex((user)=>user.id === id);\n    if (userIndex !== -1) {\n        return tempUsers.splice(userIndex, 1)[0];\n    }\n    return null;\n}\nfunction validateStudentId(studentId) {\n    // Formato sugerido: EST-YYYY-XXX (ej: EST-2024-001)\n    const studentIdRegex = /^EST-\\d{4}-\\d{3}$/;\n    return studentIdRegex.test(studentId);\n}\nfunction generateStudentId() {\n    const currentYear = new Date().getFullYear();\n    const existingIds = tempUsers.filter((user)=>user.studentId && user.studentId.startsWith(`EST-${currentYear}`)).map((user)=>user.studentId).sort();\n    let nextNumber = 1;\n    if (existingIds.length > 0) {\n        const lastId = existingIds[existingIds.length - 1];\n        const lastNumber = parseInt(lastId.split('-')[2]);\n        nextNumber = lastNumber + 1;\n    }\n    return `EST-${currentYear}-${nextNumber.toString().padStart(3, '0')}`;\n}\n// Weekly Reports Functions\nfunction addWeeklyReport(report) {\n    tempWeeklyReports.push(report);\n}\nfunction findWeeklyReportsByUser(userId) {\n    return tempWeeklyReports.filter((report)=>report.userId === userId);\n}\nfunction findWeeklyReportByUserAndWeek(userId, weekStart) {\n    return tempWeeklyReports.find((report)=>report.userId === userId && report.weekStart.getTime() === weekStart.getTime());\n}\nfunction getAllWeeklyReports() {\n    return tempWeeklyReports;\n}\nfunction getWeeklyReportsByDateRange(startDate, endDate) {\n    return tempWeeklyReports.filter((report)=>report.weekStart >= startDate && report.weekEnd <= endDate);\n}\n// Date utility functions\nfunction getCurrentWeekStart() {\n    const now = new Date();\n    const monday = new Date(now);\n    const day = now.getDay();\n    const diff = now.getDate() - day + (day === 0 ? -6 : 1 // Adjust for Sunday\n    );\n    monday.setDate(diff);\n    monday.setHours(0, 0, 0, 0);\n    return monday;\n}\nfunction getCurrentWeekEnd() {\n    const weekStart = getCurrentWeekStart();\n    const weekEnd = new Date(weekStart);\n    weekEnd.setDate(weekStart.getDate() + 6);\n    weekEnd.setHours(23, 59, 59, 999);\n    return weekEnd;\n}\nfunction canSubmitThisWeek(userId) {\n    const weekStart = getCurrentWeekStart();\n    const weekEnd = getCurrentWeekEnd();\n    const currentDate = new Date();\n    const existingReport = findWeeklyReportByUserAndWeek(userId, weekStart);\n    // Can submit if:\n    // 1. We are currently in this week (currentDate is between weekStart and weekEnd)\n    // 2. No report exists for this week\n    const isCurrentWeek = currentDate >= weekStart && currentDate <= weekEnd;\n    console.log(`🔍 Debug canSubmitThisWeek for user ${userId}:`);\n    console.log(`  Current date: ${currentDate.toISOString()}`);\n    console.log(`  Week start: ${weekStart.toISOString()}`);\n    console.log(`  Week end: ${weekEnd.toISOString()}`);\n    console.log(`  Is current week: ${isCurrentWeek}`);\n    console.log(`  Existing report: ${existingReport ? 'YES' : 'NO'}`);\n    console.log(`  Can submit: ${isCurrentWeek && !existingReport}`);\n    return isCurrentWeek && !existingReport;\n}\nfunction getWeekDates(date) {\n    const start = new Date(date);\n    const day = start.getDay();\n    const diff = start.getDate() - day + (day === 0 ? -6 : 1);\n    start.setDate(diff);\n    start.setHours(0, 0, 0, 0);\n    const end = new Date(start);\n    end.setDate(start.getDate() + 6);\n    end.setHours(23, 59, 59, 999);\n    return {\n        start,\n        end\n    };\n}\nfunction getMonthWeeks(year, month) {\n    const weeks = [];\n    const firstDay = new Date(year, month, 1);\n    const lastDay = new Date(year, month + 1, 0);\n    let current = new Date(firstDay);\n    // Adjust to start from Monday of first week\n    const dayOfWeek = current.getDay();\n    const daysToSubtract = dayOfWeek === 0 ? 6 : dayOfWeek - 1;\n    current.setDate(current.getDate() - daysToSubtract);\n    while(current <= lastDay){\n        const weekStart = new Date(current);\n        const weekEnd = new Date(current);\n        weekEnd.setDate(weekStart.getDate() + 6);\n        weeks.push({\n            start: weekStart,\n            end: weekEnd\n        });\n        current.setDate(current.getDate() + 7);\n    }\n    return weeks;\n}\n// ===== CALENDAR FUNCTIONS =====\n// These functions integrate with the calendar system for Sara AI\nfunction getEvents(userId) {\n    // Import calendar data functions\n    try {\n        const { getUserCalendarData } = __webpack_require__(/*! ./calendar-data */ \"(rsc)/./src/lib/calendar-data.ts\");\n        const userData = getUserCalendarData(userId);\n        return userData?.events || [];\n    } catch (error) {\n        console.error('Error getting calendar events:', error);\n        return [];\n    }\n}\nfunction getAllCalendarEvents(userId) {\n    // Alias for getEvents for compatibility\n    return getEvents(userId);\n}\nfunction getUpcomingEvents(userId, days = 30) {\n    try {\n        const allEvents = getEvents(userId);\n        const now = new Date();\n        const futureDate = new Date();\n        futureDate.setDate(futureDate.getDate() + days);\n        return allEvents.filter((event)=>{\n            const eventDate = new Date(event.date);\n            return eventDate >= now && eventDate <= futureDate;\n        }).sort((a, b)=>new Date(a.date).getTime() - new Date(b.date).getTime());\n    } catch (error) {\n        console.error('Error getting upcoming events:', error);\n        return [];\n    }\n}\nfunction getEventsForDateRange(userId, startDate, endDate) {\n    try {\n        const allEvents = getEvents(userId);\n        return allEvents.filter((event)=>{\n            const eventDate = new Date(event.date);\n            return eventDate >= startDate && eventDate <= endDate;\n        });\n    } catch (error) {\n        console.error('Error getting events for date range:', error);\n        return [];\n    }\n}\nfunction findEventById(userId, eventId) {\n    try {\n        const allEvents = getEvents(userId);\n        return allEvents.find((event)=>event.id === eventId) || null;\n    } catch (error) {\n        console.error('Error finding event by ID:', error);\n        return null;\n    }\n}\n// Global storage for conversations\nconst globalForConversations = globalThis;\nconst tempConversations = globalForConversations.tempConversations ?? [];\nglobalForConversations.tempConversations = tempConversations;\nfunction getConversationSession(userId, sessionId) {\n    return tempConversations.find((session)=>session.userId === userId && session.sessionId === sessionId) || null;\n}\nfunction createConversationSession(userId, sessionId) {\n    // First remove any old session for the same user/sessionId\n    const existingIndex = tempConversations.findIndex((session)=>session.userId === userId && session.sessionId === sessionId);\n    if (existingIndex !== -1) {\n        tempConversations.splice(existingIndex, 1);\n    }\n    const newSession = {\n        userId,\n        sessionId,\n        turns: [],\n        currentTopic: undefined,\n        currentSubject: undefined,\n        pendingTasks: [],\n        lastUpdate: new Date()\n    };\n    tempConversations.push(newSession);\n    console.log(`💬 Created conversation session ${sessionId} for user ${userId}`);\n    return newSession;\n}\nfunction updateConversationSession(session) {\n    const index = tempConversations.findIndex((s)=>s.userId === session.userId && s.sessionId === session.sessionId);\n    if (index !== -1) {\n        tempConversations[index] = {\n            ...session,\n            lastUpdate: new Date()\n        };\n        console.log(`💬 Updated session ${session.sessionId} - ${session.turns.length} turns`);\n    } else {\n        tempConversations.push({\n            ...session,\n            lastUpdate: new Date()\n        });\n        console.log(`💬 Created new session ${session.sessionId} during update`);\n    }\n    return session;\n}\nfunction addConversationTurn(userId, sessionId, role, content, metadata = {}) {\n    let session = getConversationSession(userId, sessionId);\n    if (!session) {\n        session = createConversationSession(userId, sessionId);\n    }\n    const turn = {\n        id: `turn_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,\n        timestamp: new Date(),\n        role,\n        content,\n        metadata\n    };\n    session.turns.push(turn);\n    // Keep only last 20 turns per session\n    if (session.turns.length > 20) {\n        session.turns = session.turns.slice(-20);\n    }\n    return updateConversationSession(session);\n}\nfunction addPendingTask(userId, sessionId, type, description, data) {\n    let session = getConversationSession(userId, sessionId);\n    if (!session) {\n        session = createConversationSession(userId, sessionId);\n    }\n    const task = {\n        id: `task_${Date.now()}`,\n        type,\n        description,\n        data,\n        completed: false,\n        createdAt: new Date()\n    };\n    session.pendingTasks.push(task);\n    console.log(`📋 Added pending task: ${description}`);\n    updateConversationSession(session);\n}\nfunction markTaskCompleted(userId, sessionId, taskId, result) {\n    const session = getConversationSession(userId, sessionId);\n    if (!session) return false;\n    const task = session.pendingTasks.find((t)=>t.id === taskId);\n    if (!task) return false;\n    task.completed = true;\n    if (result) {\n        task.data.result = result;\n    }\n    console.log(`✅ Completed task: ${task.description}`);\n    updateConversationSession(session);\n    return true;\n}\nfunction getPendingTasks(userId, sessionId) {\n    const session = getConversationSession(userId, sessionId);\n    if (!session) return [];\n    return session.pendingTasks.filter((task)=>!task.completed);\n}\nfunction getConversationHistory(userId, sessionId, limit = 10) {\n    const session = getConversationSession(userId, sessionId);\n    if (!session) return [];\n    return session.turns.slice(-limit);\n}\nfunction getUserActiveSessions(userId) {\n    const oneHourAgo = new Date(Date.now() - 60 * 60 * 1000);\n    return tempConversations.filter((session)=>session.userId === userId && session.lastUpdate > oneHourAgo);\n}\nfunction cleanupOldConversations() {\n    const sixHoursAgo = new Date(Date.now() - 6 * 60 * 60 * 1000);\n    const before = tempConversations.length;\n    // Remove conversations older than 6 hours\n    for(let i = tempConversations.length - 1; i >= 0; i--){\n        if (tempConversations[i].lastUpdate < sixHoursAgo) {\n            tempConversations.splice(i, 1);\n        }\n    }\n    const after = tempConversations.length;\n    if (before !== after) {\n        console.log(`🧹 Cleaned up ${before - after} old conversation sessions`);\n    }\n}\n// Initialize default users automatically\n\nfunction initDefaultUsers() {\n    // Check if demo users already exist to avoid duplicates\n    const studentExists = findUserByEmail(\"estudiante@demo.com\");\n    const instructorExists = findUserByEmail(\"instructor@demo.com\");\n    if (!studentExists || !instructorExists) {\n        console.log(\"🔧 Inicializando usuarios por defecto...\");\n        try {\n            const hashedPassword = bcryptjs__WEBPACK_IMPORTED_MODULE_0__[\"default\"].hashSync(\"Estudiante123!!!\", 12);\n            // Only add student if doesn't exist\n            if (!studentExists) {\n                addUser({\n                    id: \"demo-student-fixed\",\n                    name: \"Estudiante Demo\",\n                    email: \"estudiante@demo.com\",\n                    password: hashedPassword,\n                    role: \"STUDENT\",\n                    studentId: \"EST-2025-001\",\n                    status: \"ACTIVE\",\n                    enrollmentYear: 2025,\n                    academicYear: \"2025-2026\",\n                    program: \"Ingeniería en Sistemas\",\n                    phoneNumber: \"+1234567890\",\n                    dateOfBirth: new Date(\"2000-01-01\"),\n                    address: \"Demo Address 123\",\n                    emergencyContact: {\n                        name: \"Contacto Demo\",\n                        phone: \"+0987654321\",\n                        relationship: \"Padre\"\n                    },\n                    createdAt: new Date(),\n                    updatedAt: new Date()\n                });\n                console.log(\"✅ Usuario estudiante demo creado\");\n            }\n            // Only add instructor if doesn't exist\n            if (!instructorExists) {\n                addUser({\n                    id: \"demo-instructor-fixed\",\n                    name: \"Instructor Demo\",\n                    email: \"instructor@demo.com\",\n                    password: hashedPassword,\n                    role: \"INSTRUCTOR\",\n                    studentId: null,\n                    status: \"ACTIVE\",\n                    enrollmentYear: 2025,\n                    academicYear: \"2025-2026\",\n                    createdAt: new Date(),\n                    updatedAt: new Date()\n                });\n                console.log(\"✅ Usuario instructor demo creado\");\n            }\n            console.log(\"✅ Verificación de usuarios por defecto completada\");\n        } catch (error) {\n            console.error(\"❌ Error creando usuarios por defecto:\", error);\n        }\n    } else {\n        console.log(\"✅ Usuarios demo ya existen, no se reinicializan\");\n    }\n    // Always check and initialize sample reports\n    initSampleReports();\n}\nfunction initSampleReports() {\n    // Check if sample reports already exist for demo student\n    const existingSampleReports = tempWeeklyReports.filter((report)=>report.userId === \"demo-student-fixed\");\n    if (existingSampleReports.length === 0) {\n        console.log(\"📝 Inicializando reportes de muestra...\");\n        try {\n            // Get current week dates\n            const now = new Date();\n            const currentWeek = getCurrentWeekStart();\n            const currentWeekEnd = getCurrentWeekEnd();\n            // Previous week\n            const prevWeek = new Date(currentWeek);\n            prevWeek.setDate(prevWeek.getDate() - 7);\n            const prevWeekEnd = new Date(currentWeekEnd);\n            prevWeekEnd.setDate(prevWeekEnd.getDate() - 7);\n            // Sample report from previous week\n            addWeeklyReport({\n                id: \"sample-report-1\",\n                userId: \"demo-student-fixed\",\n                weekStart: prevWeek,\n                weekEnd: prevWeekEnd,\n                submittedAt: new Date(prevWeekEnd.getTime() - 24 * 60 * 60 * 1000),\n                responses: {\n                    temasYDominio: \"Esta semana trabajamos con JavaScript básico - Nivel 3: Domino funciones y arrays, y estoy aprendiendo objetos complejos.\",\n                    evidenciaAprendizaje: \"Completé un proyecto de To-Do List usando JavaScript vanilla. Implementé funciones para agregar, editar y eliminar tareas usando arrays y objetos.\",\n                    dificultadesEstrategias: \"Tuve dificultades con el manejo de eventos en JavaScript. Lo resolví practicando con ejemplos y consultando documentación de MDN.\",\n                    conexionesAplicacion: \"Los conceptos de eventos se conectan con la interactividad en aplicaciones web. Puedo aplicarlo para crear interfaces más dinámicas.\",\n                    comentariosAdicionales: \"Me siento más confiado con JavaScript. Quiero seguir practicando con proyectos más complejos.\"\n                }\n            });\n            // Two weeks ago report  \n            const twoWeeksAgo = new Date(currentWeek);\n            twoWeeksAgo.setDate(twoWeeksAgo.getDate() - 14);\n            const twoWeeksAgoEnd = new Date(currentWeekEnd);\n            twoWeeksAgoEnd.setDate(twoWeeksAgoEnd.getDate() - 14);\n            addWeeklyReport({\n                id: \"sample-report-2\",\n                userId: \"demo-student-fixed\",\n                weekStart: twoWeeksAgo,\n                weekEnd: twoWeeksAgoEnd,\n                submittedAt: new Date(twoWeeksAgoEnd.getTime() - 12 * 60 * 60 * 1000),\n                responses: {\n                    temasYDominio: \"Esta semana estudiamos CSS Grid y Flexbox - Nivel 2: Entiendo los conceptos básicos pero aún tengo dudas con layouts complejos.\",\n                    evidenciaAprendizaje: \"Recreé el layout de una página web usando CSS Grid. Logré hacer una estructura responsive con header, sidebar y main content.\",\n                    dificultadesEstrategias: \"Me confundí con las propiedades grid-template-areas. Resolví el problema dibujando el layout en papel primero.\",\n                    conexionesAplicacion: \"CSS Grid es perfecto para crear layouts de páginas web modernas. Lo usaré en mi proyecto final de página portfolio.\",\n                    comentariosAdicionales: \"CSS es más divertido de lo que pensaba. Me gusta ver los resultados visuales inmediatos.\"\n                }\n            });\n            console.log(\"✅ Reportes de muestra creados exitosamente\");\n        } catch (error) {\n            console.error(\"❌ Error creando reportes de muestra:\", error);\n        }\n    } else {\n        console.log(\"✅ Reportes de muestra ya existen, no se reinicializan\");\n    }\n}\n// Initialize on module load\ninitDefaultUsers();\n// Start conversation cleanup interval\nsetInterval(cleanupOldConversations, 30 * 60 * 1000) // Every 30 minutes\n;\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QixNQUFNQyxjQUFjLElBQUk3SixLQUFLa0o7WUFDN0JXLFlBQVlySCxPQUFPLENBQUNxSCxZQUFZdEgsT0FBTyxLQUFLO1lBQzVDLE1BQU11SCxpQkFBaUIsSUFBSTlKLEtBQUttSjtZQUNoQ1csZUFBZXRILE9BQU8sQ0FBQ3NILGVBQWV2SCxPQUFPLEtBQUs7WUFFbERsQixnQkFBZ0I7Z0JBQ2RuQyxJQUFJO2dCQUNKc0MsUUFBUTtnQkFDUkUsV0FBV21JO2dCQUNYN0gsU0FBUzhIO2dCQUNUUixhQUFhLElBQUl0SixLQUFLOEosZUFBZW5JLE9BQU8sS0FBSyxLQUFLLEtBQUssS0FBSztnQkFDaEU0SCxXQUFXO29CQUNUQyxlQUFlO29CQUNmQyxzQkFBc0I7b0JBQ3RCQyx5QkFBeUI7b0JBQ3pCQyxzQkFBc0I7b0JBQ3RCQyx3QkFBd0I7Z0JBQzFCO1lBQ0Y7WUFFQTdHLFFBQVFDLEdBQUcsQ0FBQztRQUNkLEVBQUUsT0FBT29CLE9BQU87WUFDZHJCLFFBQVFxQixLQUFLLENBQUMsd0NBQXdDQTtRQUN4RDtJQUNGLE9BQU87UUFDTHJCLFFBQVFDLEdBQUcsQ0FBQztJQUNkO0FBQ0Y7QUFFQSw0QkFBNEI7QUFDNUJpRjtBQUVBLHNDQUFzQztBQUN0QzhCLFlBQVlwQyx5QkFBeUIsS0FBSyxLQUFLLE1BQU0sbUJBQW1CIiwic291cmNlcyI6WyIvVXNlcnMvcm9kcmlnb2RpYmVybmFyZG8zM2dtYWlsLmNvbS9Eb2N1bWVudHMvQXBwIERldmVsb3BtZW50IFByb3llY3RzL0ludGVsbGVnbyBQbGF0Zm9ybS9zcmMvbGliL3RlbXAtc3RvcmFnZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBUZW1wb3JhcnkgdXNlciBzdG9yYWdlIC0gcmVwbGFjZSB3aXRoIGRhdGFiYXNlIGxhdGVyXG5pbnRlcmZhY2UgVGVtcFVzZXIge1xuICBpZDogc3RyaW5nXG4gIG5hbWU6IHN0cmluZ1xuICBlbWFpbDogc3RyaW5nXG4gIHBhc3N3b3JkOiBzdHJpbmdcbiAgc3R1ZGVudElkPzogc3RyaW5nIHwgbnVsbFxuICByb2xlOiBzdHJpbmdcbiAgY3JlYXRlZEF0OiBEYXRlXG4gIHVwZGF0ZWRBdDogRGF0ZVxuICBpbWFnZT86IHN0cmluZ1xuICAvLyBBY2FkZW1pYyBmaWVsZHNcbiAgcHJvZ3JhbT86IHN0cmluZyAvLyBDYXJyZXJhL3Byb2dyYW1hIGRlIGVzdHVkaW9zXG4gIGFjYWRlbWljWWVhcj86IHN0cmluZyAvLyBBw7FvIGFjYWTDqW1pY28gKGVqOiBcIjIwMjQtMjAyNVwiKVxuICBlbnJvbGxtZW50WWVhcj86IG51bWJlciAvLyBBw7FvIGRlIGluZ3Jlc29cbiAgc3RhdHVzPzogXCJBQ1RJVkVcIiB8IFwiSU5BQ1RJVkVcIiB8IFwiU1VTUEVOREVEXCIgLy8gRXN0YWRvIGRlbCBlc3R1ZGlhbnRlXG4gIHBob25lTnVtYmVyPzogc3RyaW5nXG4gIGRhdGVPZkJpcnRoPzogRGF0ZVxuICBhZGRyZXNzPzogc3RyaW5nXG4gIGVtZXJnZW5jeUNvbnRhY3Q/OiB7XG4gICAgbmFtZTogc3RyaW5nXG4gICAgcGhvbmU6IHN0cmluZ1xuICAgIHJlbGF0aW9uc2hpcDogc3RyaW5nXG4gIH1cbiAgcHJlZmVyZW5jZXM/OiB7XG4gICAgZW1haWxOb3RpZmljYXRpb25zOiBib29sZWFuXG4gICAgcHVzaE5vdGlmaWNhdGlvbnM6IGJvb2xlYW5cbiAgICB3ZWVrbHlSZW1pbmRlcnM6IGJvb2xlYW5cbiAgICBwcm9ncmVzc1JlcG9ydHM6IGJvb2xlYW5cbiAgfVxufVxuXG5pbnRlcmZhY2UgQXR0YWNoZWRGaWxlIHtcbiAgZmlsZW5hbWU6IHN0cmluZ1xuICBvcmlnaW5hbE5hbWU6IHN0cmluZ1xuICBzaXplOiBudW1iZXJcbiAgdHlwZTogc3RyaW5nXG4gIHVybDogc3RyaW5nXG59XG5cbmludGVyZmFjZSBXZWVrbHlSZXBvcnQge1xuICBpZDogc3RyaW5nXG4gIHVzZXJJZDogc3RyaW5nXG4gIHdlZWtTdGFydDogRGF0ZVxuICB3ZWVrRW5kOiBEYXRlXG4gIHN1Ym1pdHRlZEF0OiBEYXRlXG4gIHJlc3BvbnNlczoge1xuICAgIHRlbWFzWURvbWluaW86IHN0cmluZyAvLyBQcmVndW50YSAxXG4gICAgZXZpZGVuY2lhQXByZW5kaXphamU6IHN0cmluZyAvLyBQcmVndW50YSAyXG4gICAgZGlmaWN1bHRhZGVzRXN0cmF0ZWdpYXM6IHN0cmluZyAvLyBQcmVndW50YSAzXG4gICAgY29uZXhpb25lc0FwbGljYWNpb246IHN0cmluZyAvLyBQcmVndW50YSA0XG4gICAgY29tZW50YXJpb3NBZGljaW9uYWxlcz86IHN0cmluZyAvLyBQcmVndW50YSA1IChvcGNpb25hbClcbiAgfVxuICBhdHRhY2htZW50cz86IEF0dGFjaGVkRmlsZVtdIC8vIEFyY2hpdm9zIGFkanVudG9zXG59XG5cbi8vIFNpbmdsZXRvbiBwYXR0ZXJuIHRvIHBlcnNpc3QgZGF0YSBhY3Jvc3MgcmVxdWVzdHNcbmNvbnN0IGdsb2JhbEZvclN0b3JhZ2UgPSBnbG9iYWxUaGlzIGFzIHVua25vd24gYXMge1xuICB0ZW1wVXNlcnM6IFRlbXBVc2VyW10gfCB1bmRlZmluZWRcbiAgdGVtcFdlZWtseVJlcG9ydHM6IFdlZWtseVJlcG9ydFtdIHwgdW5kZWZpbmVkXG59XG5cbmV4cG9ydCBjb25zdCB0ZW1wVXNlcnM6IFRlbXBVc2VyW10gPSBnbG9iYWxGb3JTdG9yYWdlLnRlbXBVc2VycyA/PyBbXVxuZXhwb3J0IGNvbnN0IHRlbXBXZWVrbHlSZXBvcnRzOiBXZWVrbHlSZXBvcnRbXSA9IGdsb2JhbEZvclN0b3JhZ2UudGVtcFdlZWtseVJlcG9ydHMgPz8gW11cblxuLy8gQXNzaWduIHRvIGdsb2JhbFRoaXMgdG8gcGVyc2lzdCBhY3Jvc3MgcmVxdWVzdHNcbmdsb2JhbEZvclN0b3JhZ2UudGVtcFVzZXJzID0gdGVtcFVzZXJzXG5nbG9iYWxGb3JTdG9yYWdlLnRlbXBXZWVrbHlSZXBvcnRzID0gdGVtcFdlZWtseVJlcG9ydHNcblxuZXhwb3J0IGZ1bmN0aW9uIGFkZFVzZXIodXNlcjogVGVtcFVzZXIpIHtcbiAgdGVtcFVzZXJzLnB1c2godXNlcilcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGZpbmRVc2VyQnlFbWFpbChlbWFpbDogc3RyaW5nKSB7XG4gIHJldHVybiB0ZW1wVXNlcnMuZmluZCh1c2VyID0+IHVzZXIuZW1haWwgPT09IGVtYWlsKVxufVxuXG5leHBvcnQgZnVuY3Rpb24gZmluZFVzZXJCeVN0dWRlbnRJZChzdHVkZW50SWQ6IHN0cmluZykge1xuICByZXR1cm4gdGVtcFVzZXJzLmZpbmQodXNlciA9PiB1c2VyLnN0dWRlbnRJZCA9PT0gc3R1ZGVudElkKVxufVxuXG5leHBvcnQgZnVuY3Rpb24gZmluZFVzZXJCeUlkKGlkOiBzdHJpbmcpIHtcbiAgcmV0dXJuIHRlbXBVc2Vycy5maW5kKHVzZXIgPT4gdXNlci5pZCA9PT0gaWQpXG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRBbGxVc2VycygpIHtcbiAgcmV0dXJuIHRlbXBVc2Vyc1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZmluZFVzZXJzQnlSb2xlKHJvbGU6IHN0cmluZykge1xuICByZXR1cm4gdGVtcFVzZXJzLmZpbHRlcih1c2VyID0+IHVzZXIucm9sZSA9PT0gcm9sZSlcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGZpbmRVc2Vyc0J5UHJvZ3JhbShwcm9ncmFtOiBzdHJpbmcpIHtcbiAgcmV0dXJuIHRlbXBVc2Vycy5maWx0ZXIodXNlciA9PiB1c2VyLnByb2dyYW0gPT09IHByb2dyYW0pXG59XG5cbmV4cG9ydCBmdW5jdGlvbiBmaW5kVXNlcnNCeVN0YXR1cyhzdGF0dXM6IFwiQUNUSVZFXCIgfCBcIklOQUNUSVZFXCIgfCBcIlNVU1BFTkRFRFwiKSB7XG4gIHJldHVybiB0ZW1wVXNlcnMuZmlsdGVyKHVzZXIgPT4gdXNlci5zdGF0dXMgPT09IHN0YXR1cylcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHVwZGF0ZVVzZXIoaWQ6IHN0cmluZywgdXBkYXRlczogUGFydGlhbDxUZW1wVXNlcj4pIHtcbiAgY29uc3QgdXNlckluZGV4ID0gdGVtcFVzZXJzLmZpbmRJbmRleCh1c2VyID0+IHVzZXIuaWQgPT09IGlkKVxuICBpZiAodXNlckluZGV4ICE9PSAtMSkge1xuICAgIHRlbXBVc2Vyc1t1c2VySW5kZXhdID0ge1xuICAgICAgLi4udGVtcFVzZXJzW3VzZXJJbmRleF0sXG4gICAgICAuLi51cGRhdGVzLFxuICAgICAgdXBkYXRlZEF0OiBuZXcgRGF0ZSgpXG4gICAgfVxuICAgIHJldHVybiB0ZW1wVXNlcnNbdXNlckluZGV4XVxuICB9XG4gIHJldHVybiBudWxsXG59XG5cbmV4cG9ydCBmdW5jdGlvbiBkZWxldGVVc2VyKGlkOiBzdHJpbmcpIHtcbiAgY29uc3QgdXNlckluZGV4ID0gdGVtcFVzZXJzLmZpbmRJbmRleCh1c2VyID0+IHVzZXIuaWQgPT09IGlkKVxuICBpZiAodXNlckluZGV4ICE9PSAtMSkge1xuICAgIHJldHVybiB0ZW1wVXNlcnMuc3BsaWNlKHVzZXJJbmRleCwgMSlbMF1cbiAgfVxuICByZXR1cm4gbnVsbFxufVxuXG5leHBvcnQgZnVuY3Rpb24gdmFsaWRhdGVTdHVkZW50SWQoc3R1ZGVudElkOiBzdHJpbmcpOiBib29sZWFuIHtcbiAgLy8gRm9ybWF0byBzdWdlcmlkbzogRVNULVlZWVktWFhYIChlajogRVNULTIwMjQtMDAxKVxuICBjb25zdCBzdHVkZW50SWRSZWdleCA9IC9eRVNULVxcZHs0fS1cXGR7M30kL1xuICByZXR1cm4gc3R1ZGVudElkUmVnZXgudGVzdChzdHVkZW50SWQpXG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZW5lcmF0ZVN0dWRlbnRJZCgpOiBzdHJpbmcge1xuICBjb25zdCBjdXJyZW50WWVhciA9IG5ldyBEYXRlKCkuZ2V0RnVsbFllYXIoKVxuICBjb25zdCBleGlzdGluZ0lkcyA9IHRlbXBVc2Vyc1xuICAgIC5maWx0ZXIodXNlciA9PiB1c2VyLnN0dWRlbnRJZCAmJiB1c2VyLnN0dWRlbnRJZC5zdGFydHNXaXRoKGBFU1QtJHtjdXJyZW50WWVhcn1gKSlcbiAgICAubWFwKHVzZXIgPT4gdXNlci5zdHVkZW50SWQhKVxuICAgIC5zb3J0KClcblxuICBsZXQgbmV4dE51bWJlciA9IDFcbiAgaWYgKGV4aXN0aW5nSWRzLmxlbmd0aCA+IDApIHtcbiAgICBjb25zdCBsYXN0SWQgPSBleGlzdGluZ0lkc1tleGlzdGluZ0lkcy5sZW5ndGggLSAxXVxuICAgIGNvbnN0IGxhc3ROdW1iZXIgPSBwYXJzZUludChsYXN0SWQuc3BsaXQoJy0nKVsyXSlcbiAgICBuZXh0TnVtYmVyID0gbGFzdE51bWJlciArIDFcbiAgfVxuXG4gIHJldHVybiBgRVNULSR7Y3VycmVudFllYXJ9LSR7bmV4dE51bWJlci50b1N0cmluZygpLnBhZFN0YXJ0KDMsICcwJyl9YFxufVxuXG4vLyBXZWVrbHkgUmVwb3J0cyBGdW5jdGlvbnNcbmV4cG9ydCBmdW5jdGlvbiBhZGRXZWVrbHlSZXBvcnQocmVwb3J0OiBXZWVrbHlSZXBvcnQpIHtcbiAgdGVtcFdlZWtseVJlcG9ydHMucHVzaChyZXBvcnQpXG59XG5cbmV4cG9ydCBmdW5jdGlvbiBmaW5kV2Vla2x5UmVwb3J0c0J5VXNlcih1c2VySWQ6IHN0cmluZyk6IFdlZWtseVJlcG9ydFtdIHtcbiAgcmV0dXJuIHRlbXBXZWVrbHlSZXBvcnRzLmZpbHRlcihyZXBvcnQgPT4gcmVwb3J0LnVzZXJJZCA9PT0gdXNlcklkKVxufVxuXG5leHBvcnQgZnVuY3Rpb24gZmluZFdlZWtseVJlcG9ydEJ5VXNlckFuZFdlZWsodXNlcklkOiBzdHJpbmcsIHdlZWtTdGFydDogRGF0ZSk6IFdlZWtseVJlcG9ydCB8IHVuZGVmaW5lZCB7XG4gIHJldHVybiB0ZW1wV2Vla2x5UmVwb3J0cy5maW5kKHJlcG9ydCA9PiBcbiAgICByZXBvcnQudXNlcklkID09PSB1c2VySWQgJiYgXG4gICAgcmVwb3J0LndlZWtTdGFydC5nZXRUaW1lKCkgPT09IHdlZWtTdGFydC5nZXRUaW1lKClcbiAgKVxufVxuXG5leHBvcnQgZnVuY3Rpb24gZ2V0QWxsV2Vla2x5UmVwb3J0cygpOiBXZWVrbHlSZXBvcnRbXSB7XG4gIHJldHVybiB0ZW1wV2Vla2x5UmVwb3J0c1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZ2V0V2Vla2x5UmVwb3J0c0J5RGF0ZVJhbmdlKHN0YXJ0RGF0ZTogRGF0ZSwgZW5kRGF0ZTogRGF0ZSk6IFdlZWtseVJlcG9ydFtdIHtcbiAgcmV0dXJuIHRlbXBXZWVrbHlSZXBvcnRzLmZpbHRlcihyZXBvcnQgPT4gXG4gICAgcmVwb3J0LndlZWtTdGFydCA+PSBzdGFydERhdGUgJiYgcmVwb3J0LndlZWtFbmQgPD0gZW5kRGF0ZVxuICApXG59XG5cbi8vIERhdGUgdXRpbGl0eSBmdW5jdGlvbnNcbmV4cG9ydCBmdW5jdGlvbiBnZXRDdXJyZW50V2Vla1N0YXJ0KCk6IERhdGUge1xuICBjb25zdCBub3cgPSBuZXcgRGF0ZSgpXG4gIGNvbnN0IG1vbmRheSA9IG5ldyBEYXRlKG5vdylcbiAgY29uc3QgZGF5ID0gbm93LmdldERheSgpXG4gIGNvbnN0IGRpZmYgPSBub3cuZ2V0RGF0ZSgpIC0gZGF5ICsgKGRheSA9PT0gMCA/IC02IDogMSkgLy8gQWRqdXN0IGZvciBTdW5kYXlcbiAgbW9uZGF5LnNldERhdGUoZGlmZilcbiAgbW9uZGF5LnNldEhvdXJzKDAsIDAsIDAsIDApXG4gIHJldHVybiBtb25kYXlcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGdldEN1cnJlbnRXZWVrRW5kKCk6IERhdGUge1xuICBjb25zdCB3ZWVrU3RhcnQgPSBnZXRDdXJyZW50V2Vla1N0YXJ0KClcbiAgY29uc3Qgd2Vla0VuZCA9IG5ldyBEYXRlKHdlZWtTdGFydClcbiAgd2Vla0VuZC5zZXREYXRlKHdlZWtTdGFydC5nZXREYXRlKCkgKyA2KVxuICB3ZWVrRW5kLnNldEhvdXJzKDIzLCA1OSwgNTksIDk5OSlcbiAgcmV0dXJuIHdlZWtFbmRcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGNhblN1Ym1pdFRoaXNXZWVrKHVzZXJJZDogc3RyaW5nKTogYm9vbGVhbiB7XG4gIGNvbnN0IHdlZWtTdGFydCA9IGdldEN1cnJlbnRXZWVrU3RhcnQoKVxuICBjb25zdCB3ZWVrRW5kID0gZ2V0Q3VycmVudFdlZWtFbmQoKVxuICBjb25zdCBjdXJyZW50RGF0ZSA9IG5ldyBEYXRlKClcbiAgY29uc3QgZXhpc3RpbmdSZXBvcnQgPSBmaW5kV2Vla2x5UmVwb3J0QnlVc2VyQW5kV2Vlayh1c2VySWQsIHdlZWtTdGFydClcbiAgXG4gIC8vIENhbiBzdWJtaXQgaWY6XG4gIC8vIDEuIFdlIGFyZSBjdXJyZW50bHkgaW4gdGhpcyB3ZWVrIChjdXJyZW50RGF0ZSBpcyBiZXR3ZWVuIHdlZWtTdGFydCBhbmQgd2Vla0VuZClcbiAgLy8gMi4gTm8gcmVwb3J0IGV4aXN0cyBmb3IgdGhpcyB3ZWVrXG4gIGNvbnN0IGlzQ3VycmVudFdlZWsgPSBjdXJyZW50RGF0ZSA+PSB3ZWVrU3RhcnQgJiYgY3VycmVudERhdGUgPD0gd2Vla0VuZFxuICBcbiAgY29uc29sZS5sb2coYPCflI0gRGVidWcgY2FuU3VibWl0VGhpc1dlZWsgZm9yIHVzZXIgJHt1c2VySWR9OmApXG4gIGNvbnNvbGUubG9nKGAgIEN1cnJlbnQgZGF0ZTogJHtjdXJyZW50RGF0ZS50b0lTT1N0cmluZygpfWApXG4gIGNvbnNvbGUubG9nKGAgIFdlZWsgc3RhcnQ6ICR7d2Vla1N0YXJ0LnRvSVNPU3RyaW5nKCl9YClcbiAgY29uc29sZS5sb2coYCAgV2VlayBlbmQ6ICR7d2Vla0VuZC50b0lTT1N0cmluZygpfWApXG4gIGNvbnNvbGUubG9nKGAgIElzIGN1cnJlbnQgd2VlazogJHtpc0N1cnJlbnRXZWVrfWApXG4gIGNvbnNvbGUubG9nKGAgIEV4aXN0aW5nIHJlcG9ydDogJHtleGlzdGluZ1JlcG9ydCA/ICdZRVMnIDogJ05PJ31gKVxuICBjb25zb2xlLmxvZyhgICBDYW4gc3VibWl0OiAke2lzQ3VycmVudFdlZWsgJiYgIWV4aXN0aW5nUmVwb3J0fWApXG4gIFxuICByZXR1cm4gaXNDdXJyZW50V2VlayAmJiAhZXhpc3RpbmdSZXBvcnRcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGdldFdlZWtEYXRlcyhkYXRlOiBEYXRlKTogeyBzdGFydDogRGF0ZTsgZW5kOiBEYXRlIH0ge1xuICBjb25zdCBzdGFydCA9IG5ldyBEYXRlKGRhdGUpXG4gIGNvbnN0IGRheSA9IHN0YXJ0LmdldERheSgpXG4gIGNvbnN0IGRpZmYgPSBzdGFydC5nZXREYXRlKCkgLSBkYXkgKyAoZGF5ID09PSAwID8gLTYgOiAxKVxuICBzdGFydC5zZXREYXRlKGRpZmYpXG4gIHN0YXJ0LnNldEhvdXJzKDAsIDAsIDAsIDApXG4gIFxuICBjb25zdCBlbmQgPSBuZXcgRGF0ZShzdGFydClcbiAgZW5kLnNldERhdGUoc3RhcnQuZ2V0RGF0ZSgpICsgNilcbiAgZW5kLnNldEhvdXJzKDIzLCA1OSwgNTksIDk5OSlcbiAgXG4gIHJldHVybiB7IHN0YXJ0LCBlbmQgfVxufVxuXG5leHBvcnQgZnVuY3Rpb24gZ2V0TW9udGhXZWVrcyh5ZWFyOiBudW1iZXIsIG1vbnRoOiBudW1iZXIpOiBBcnJheTx7IHN0YXJ0OiBEYXRlOyBlbmQ6IERhdGUgfT4ge1xuICBjb25zdCB3ZWVrcyA9IFtdXG4gIGNvbnN0IGZpcnN0RGF5ID0gbmV3IERhdGUoeWVhciwgbW9udGgsIDEpXG4gIGNvbnN0IGxhc3REYXkgPSBuZXcgRGF0ZSh5ZWFyLCBtb250aCArIDEsIDApXG4gIFxuICBsZXQgY3VycmVudCA9IG5ldyBEYXRlKGZpcnN0RGF5KVxuICBcbiAgLy8gQWRqdXN0IHRvIHN0YXJ0IGZyb20gTW9uZGF5IG9mIGZpcnN0IHdlZWtcbiAgY29uc3QgZGF5T2ZXZWVrID0gY3VycmVudC5nZXREYXkoKVxuICBjb25zdCBkYXlzVG9TdWJ0cmFjdCA9IGRheU9mV2VlayA9PT0gMCA/IDYgOiBkYXlPZldlZWsgLSAxXG4gIGN1cnJlbnQuc2V0RGF0ZShjdXJyZW50LmdldERhdGUoKSAtIGRheXNUb1N1YnRyYWN0KVxuICBcbiAgd2hpbGUgKGN1cnJlbnQgPD0gbGFzdERheSkge1xuICAgIGNvbnN0IHdlZWtTdGFydCA9IG5ldyBEYXRlKGN1cnJlbnQpXG4gICAgY29uc3Qgd2Vla0VuZCA9IG5ldyBEYXRlKGN1cnJlbnQpXG4gICAgd2Vla0VuZC5zZXREYXRlKHdlZWtTdGFydC5nZXREYXRlKCkgKyA2KVxuICAgIFxuICAgIHdlZWtzLnB1c2goeyBzdGFydDogd2Vla1N0YXJ0LCBlbmQ6IHdlZWtFbmQgfSlcbiAgICBjdXJyZW50LnNldERhdGUoY3VycmVudC5nZXREYXRlKCkgKyA3KVxuICB9XG4gIFxuICByZXR1cm4gd2Vla3Ncbn1cblxuLy8gPT09PT0gQ0FMRU5EQVIgRlVOQ1RJT05TID09PT09XG4vLyBUaGVzZSBmdW5jdGlvbnMgaW50ZWdyYXRlIHdpdGggdGhlIGNhbGVuZGFyIHN5c3RlbSBmb3IgU2FyYSBBSVxuXG5leHBvcnQgZnVuY3Rpb24gZ2V0RXZlbnRzKHVzZXJJZDogc3RyaW5nKTogYW55W10ge1xuICAvLyBJbXBvcnQgY2FsZW5kYXIgZGF0YSBmdW5jdGlvbnNcbiAgdHJ5IHtcbiAgICBjb25zdCB7IGdldFVzZXJDYWxlbmRhckRhdGEgfSA9IHJlcXVpcmUoJy4vY2FsZW5kYXItZGF0YScpXG4gICAgY29uc3QgdXNlckRhdGEgPSBnZXRVc2VyQ2FsZW5kYXJEYXRhKHVzZXJJZClcbiAgICByZXR1cm4gdXNlckRhdGE/LmV2ZW50cyB8fCBbXVxuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGdldHRpbmcgY2FsZW5kYXIgZXZlbnRzOicsIGVycm9yKVxuICAgIHJldHVybiBbXVxuICB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRBbGxDYWxlbmRhckV2ZW50cyh1c2VySWQ6IHN0cmluZyk6IGFueVtdIHtcbiAgLy8gQWxpYXMgZm9yIGdldEV2ZW50cyBmb3IgY29tcGF0aWJpbGl0eVxuICByZXR1cm4gZ2V0RXZlbnRzKHVzZXJJZClcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGdldFVwY29taW5nRXZlbnRzKHVzZXJJZDogc3RyaW5nLCBkYXlzOiBudW1iZXIgPSAzMCk6IGFueVtdIHtcbiAgdHJ5IHtcbiAgICBjb25zdCBhbGxFdmVudHMgPSBnZXRFdmVudHModXNlcklkKVxuICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKClcbiAgICBjb25zdCBmdXR1cmVEYXRlID0gbmV3IERhdGUoKVxuICAgIGZ1dHVyZURhdGUuc2V0RGF0ZShmdXR1cmVEYXRlLmdldERhdGUoKSArIGRheXMpXG4gICAgXG4gICAgcmV0dXJuIGFsbEV2ZW50cy5maWx0ZXIoZXZlbnQgPT4ge1xuICAgICAgY29uc3QgZXZlbnREYXRlID0gbmV3IERhdGUoZXZlbnQuZGF0ZSlcbiAgICAgIHJldHVybiBldmVudERhdGUgPj0gbm93ICYmIGV2ZW50RGF0ZSA8PSBmdXR1cmVEYXRlXG4gICAgfSkuc29ydCgoYSwgYikgPT4gbmV3IERhdGUoYS5kYXRlKS5nZXRUaW1lKCkgLSBuZXcgRGF0ZShiLmRhdGUpLmdldFRpbWUoKSlcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBnZXR0aW5nIHVwY29taW5nIGV2ZW50czonLCBlcnJvcilcbiAgICByZXR1cm4gW11cbiAgfVxufVxuXG5leHBvcnQgZnVuY3Rpb24gZ2V0RXZlbnRzRm9yRGF0ZVJhbmdlKHVzZXJJZDogc3RyaW5nLCBzdGFydERhdGU6IERhdGUsIGVuZERhdGU6IERhdGUpOiBhbnlbXSB7XG4gIHRyeSB7XG4gICAgY29uc3QgYWxsRXZlbnRzID0gZ2V0RXZlbnRzKHVzZXJJZClcbiAgICByZXR1cm4gYWxsRXZlbnRzLmZpbHRlcihldmVudCA9PiB7XG4gICAgICBjb25zdCBldmVudERhdGUgPSBuZXcgRGF0ZShldmVudC5kYXRlKVxuICAgICAgcmV0dXJuIGV2ZW50RGF0ZSA+PSBzdGFydERhdGUgJiYgZXZlbnREYXRlIDw9IGVuZERhdGVcbiAgICB9KVxuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGdldHRpbmcgZXZlbnRzIGZvciBkYXRlIHJhbmdlOicsIGVycm9yKVxuICAgIHJldHVybiBbXVxuICB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBmaW5kRXZlbnRCeUlkKHVzZXJJZDogc3RyaW5nLCBldmVudElkOiBzdHJpbmcpOiBhbnkgfCBudWxsIHtcbiAgdHJ5IHtcbiAgICBjb25zdCBhbGxFdmVudHMgPSBnZXRFdmVudHModXNlcklkKVxuICAgIHJldHVybiBhbGxFdmVudHMuZmluZChldmVudCA9PiBldmVudC5pZCA9PT0gZXZlbnRJZCkgfHwgbnVsbFxuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGZpbmRpbmcgZXZlbnQgYnkgSUQ6JywgZXJyb3IpXG4gICAgcmV0dXJuIG51bGxcbiAgfVxufVxuXG4vLyA9PT09PSBDT05WRVJTQVRJT04gTUVNT1JZIEZVTkNUSU9OUyA9PT09PVxuLy8gUGVyc2lzdGVudCBjb252ZXJzYXRpb24gc3RvcmFnZSBmb3IgU2FyYSBBSVxuXG5pbnRlcmZhY2UgQ29udmVyc2F0aW9uVHVybiB7XG4gIGlkOiBzdHJpbmdcbiAgdGltZXN0YW1wOiBEYXRlXG4gIHJvbGU6ICd1c2VyJyB8ICdhc3Npc3RhbnQnXG4gIGNvbnRlbnQ6IHN0cmluZ1xuICBtZXRhZGF0YToge1xuICAgIHN1YmplY3Q/OiBzdHJpbmdcbiAgICB0b3BpYz86IHN0cmluZ1xuICAgIGludGVudGlvbj86IHN0cmluZ1xuICAgIHRhc2tDb21wbGV0ZWQ/OiBib29sZWFuXG4gICAgZXZlbnRDcmVhdGVkPzogYm9vbGVhblxuICB9XG59XG5cbmludGVyZmFjZSBDb252ZXJzYXRpb25TZXNzaW9uIHtcbiAgdXNlcklkOiBzdHJpbmdcbiAgc2Vzc2lvbklkOiBzdHJpbmdcbiAgdHVybnM6IENvbnZlcnNhdGlvblR1cm5bXVxuICBjdXJyZW50VG9waWM/OiBzdHJpbmdcbiAgY3VycmVudFN1YmplY3Q/OiBzdHJpbmdcbiAgcGVuZGluZ1Rhc2tzOiBBcnJheTx7XG4gICAgaWQ6IHN0cmluZ1xuICAgIHR5cGU6ICdjYWxlbmRhcl9ldmVudCcgfCAnYWNhZGVtaWNfc2VhcmNoJyB8ICdyZW1pbmRlcidcbiAgICBkZXNjcmlwdGlvbjogc3RyaW5nXG4gICAgZGF0YTogYW55XG4gICAgY29tcGxldGVkOiBib29sZWFuXG4gICAgY3JlYXRlZEF0OiBEYXRlXG4gIH0+XG4gIGxhc3RVcGRhdGU6IERhdGVcbn1cblxuLy8gR2xvYmFsIHN0b3JhZ2UgZm9yIGNvbnZlcnNhdGlvbnNcbmNvbnN0IGdsb2JhbEZvckNvbnZlcnNhdGlvbnMgPSBnbG9iYWxUaGlzIGFzIHVua25vd24gYXMge1xuICB0ZW1wQ29udmVyc2F0aW9uczogQ29udmVyc2F0aW9uU2Vzc2lvbltdIHwgdW5kZWZpbmVkXG59XG5cbmV4cG9ydCBjb25zdCB0ZW1wQ29udmVyc2F0aW9uczogQ29udmVyc2F0aW9uU2Vzc2lvbltdID0gZ2xvYmFsRm9yQ29udmVyc2F0aW9ucy50ZW1wQ29udmVyc2F0aW9ucyA/PyBbXVxuZ2xvYmFsRm9yQ29udmVyc2F0aW9ucy50ZW1wQ29udmVyc2F0aW9ucyA9IHRlbXBDb252ZXJzYXRpb25zXG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRDb252ZXJzYXRpb25TZXNzaW9uKHVzZXJJZDogc3RyaW5nLCBzZXNzaW9uSWQ6IHN0cmluZyk6IENvbnZlcnNhdGlvblNlc3Npb24gfCBudWxsIHtcbiAgcmV0dXJuIHRlbXBDb252ZXJzYXRpb25zLmZpbmQoc2Vzc2lvbiA9PiBcbiAgICBzZXNzaW9uLnVzZXJJZCA9PT0gdXNlcklkICYmIHNlc3Npb24uc2Vzc2lvbklkID09PSBzZXNzaW9uSWRcbiAgKSB8fCBudWxsXG59XG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVDb252ZXJzYXRpb25TZXNzaW9uKHVzZXJJZDogc3RyaW5nLCBzZXNzaW9uSWQ6IHN0cmluZyk6IENvbnZlcnNhdGlvblNlc3Npb24ge1xuICAvLyBGaXJzdCByZW1vdmUgYW55IG9sZCBzZXNzaW9uIGZvciB0aGUgc2FtZSB1c2VyL3Nlc3Npb25JZFxuICBjb25zdCBleGlzdGluZ0luZGV4ID0gdGVtcENvbnZlcnNhdGlvbnMuZmluZEluZGV4KHNlc3Npb24gPT4gXG4gICAgc2Vzc2lvbi51c2VySWQgPT09IHVzZXJJZCAmJiBzZXNzaW9uLnNlc3Npb25JZCA9PT0gc2Vzc2lvbklkXG4gIClcbiAgaWYgKGV4aXN0aW5nSW5kZXggIT09IC0xKSB7XG4gICAgdGVtcENvbnZlcnNhdGlvbnMuc3BsaWNlKGV4aXN0aW5nSW5kZXgsIDEpXG4gIH1cblxuICBjb25zdCBuZXdTZXNzaW9uOiBDb252ZXJzYXRpb25TZXNzaW9uID0ge1xuICAgIHVzZXJJZCxcbiAgICBzZXNzaW9uSWQsXG4gICAgdHVybnM6IFtdLFxuICAgIGN1cnJlbnRUb3BpYzogdW5kZWZpbmVkLFxuICAgIGN1cnJlbnRTdWJqZWN0OiB1bmRlZmluZWQsXG4gICAgcGVuZGluZ1Rhc2tzOiBbXSxcbiAgICBsYXN0VXBkYXRlOiBuZXcgRGF0ZSgpXG4gIH1cbiAgXG4gIHRlbXBDb252ZXJzYXRpb25zLnB1c2gobmV3U2Vzc2lvbilcbiAgY29uc29sZS5sb2coYPCfkqwgQ3JlYXRlZCBjb252ZXJzYXRpb24gc2Vzc2lvbiAke3Nlc3Npb25JZH0gZm9yIHVzZXIgJHt1c2VySWR9YClcbiAgcmV0dXJuIG5ld1Nlc3Npb25cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHVwZGF0ZUNvbnZlcnNhdGlvblNlc3Npb24oc2Vzc2lvbjogQ29udmVyc2F0aW9uU2Vzc2lvbik6IENvbnZlcnNhdGlvblNlc3Npb24ge1xuICBjb25zdCBpbmRleCA9IHRlbXBDb252ZXJzYXRpb25zLmZpbmRJbmRleChzID0+IFxuICAgIHMudXNlcklkID09PSBzZXNzaW9uLnVzZXJJZCAmJiBzLnNlc3Npb25JZCA9PT0gc2Vzc2lvbi5zZXNzaW9uSWRcbiAgKVxuICBcbiAgaWYgKGluZGV4ICE9PSAtMSkge1xuICAgIHRlbXBDb252ZXJzYXRpb25zW2luZGV4XSA9IHsgLi4uc2Vzc2lvbiwgbGFzdFVwZGF0ZTogbmV3IERhdGUoKSB9XG4gICAgY29uc29sZS5sb2coYPCfkqwgVXBkYXRlZCBzZXNzaW9uICR7c2Vzc2lvbi5zZXNzaW9uSWR9IC0gJHtzZXNzaW9uLnR1cm5zLmxlbmd0aH0gdHVybnNgKVxuICB9IGVsc2Uge1xuICAgIHRlbXBDb252ZXJzYXRpb25zLnB1c2goeyAuLi5zZXNzaW9uLCBsYXN0VXBkYXRlOiBuZXcgRGF0ZSgpIH0pXG4gICAgY29uc29sZS5sb2coYPCfkqwgQ3JlYXRlZCBuZXcgc2Vzc2lvbiAke3Nlc3Npb24uc2Vzc2lvbklkfSBkdXJpbmcgdXBkYXRlYClcbiAgfVxuICBcbiAgcmV0dXJuIHNlc3Npb25cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGFkZENvbnZlcnNhdGlvblR1cm4oXG4gIHVzZXJJZDogc3RyaW5nLCBcbiAgc2Vzc2lvbklkOiBzdHJpbmcsIFxuICByb2xlOiAndXNlcicgfCAnYXNzaXN0YW50JywgXG4gIGNvbnRlbnQ6IHN0cmluZyxcbiAgbWV0YWRhdGE6IENvbnZlcnNhdGlvblR1cm5bJ21ldGFkYXRhJ10gPSB7fVxuKTogQ29udmVyc2F0aW9uU2Vzc2lvbiB7XG4gIGxldCBzZXNzaW9uID0gZ2V0Q29udmVyc2F0aW9uU2Vzc2lvbih1c2VySWQsIHNlc3Npb25JZClcbiAgaWYgKCFzZXNzaW9uKSB7XG4gICAgc2Vzc2lvbiA9IGNyZWF0ZUNvbnZlcnNhdGlvblNlc3Npb24odXNlcklkLCBzZXNzaW9uSWQpXG4gIH1cbiAgXG4gIGNvbnN0IHR1cm46IENvbnZlcnNhdGlvblR1cm4gPSB7XG4gICAgaWQ6IGB0dXJuXyR7RGF0ZS5ub3coKX1fJHtNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKDM2KS5zdWJzdHIoMiwgOSl9YCxcbiAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCksXG4gICAgcm9sZSxcbiAgICBjb250ZW50LFxuICAgIG1ldGFkYXRhXG4gIH1cbiAgXG4gIHNlc3Npb24udHVybnMucHVzaCh0dXJuKVxuICBcbiAgLy8gS2VlcCBvbmx5IGxhc3QgMjAgdHVybnMgcGVyIHNlc3Npb25cbiAgaWYgKHNlc3Npb24udHVybnMubGVuZ3RoID4gMjApIHtcbiAgICBzZXNzaW9uLnR1cm5zID0gc2Vzc2lvbi50dXJucy5zbGljZSgtMjApXG4gIH1cbiAgXG4gIHJldHVybiB1cGRhdGVDb252ZXJzYXRpb25TZXNzaW9uKHNlc3Npb24pXG59XG5cbmV4cG9ydCBmdW5jdGlvbiBhZGRQZW5kaW5nVGFzayhcbiAgdXNlcklkOiBzdHJpbmcsXG4gIHNlc3Npb25JZDogc3RyaW5nLFxuICB0eXBlOiAnY2FsZW5kYXJfZXZlbnQnIHwgJ2FjYWRlbWljX3NlYXJjaCcgfCAncmVtaW5kZXInLFxuICBkZXNjcmlwdGlvbjogc3RyaW5nLFxuICBkYXRhOiBhbnlcbik6IHZvaWQge1xuICBsZXQgc2Vzc2lvbiA9IGdldENvbnZlcnNhdGlvblNlc3Npb24odXNlcklkLCBzZXNzaW9uSWQpXG4gIGlmICghc2Vzc2lvbikge1xuICAgIHNlc3Npb24gPSBjcmVhdGVDb252ZXJzYXRpb25TZXNzaW9uKHVzZXJJZCwgc2Vzc2lvbklkKVxuICB9XG4gIFxuICBjb25zdCB0YXNrID0ge1xuICAgIGlkOiBgdGFza18ke0RhdGUubm93KCl9YCxcbiAgICB0eXBlLFxuICAgIGRlc2NyaXB0aW9uLFxuICAgIGRhdGEsXG4gICAgY29tcGxldGVkOiBmYWxzZSxcbiAgICBjcmVhdGVkQXQ6IG5ldyBEYXRlKClcbiAgfVxuICBcbiAgc2Vzc2lvbi5wZW5kaW5nVGFza3MucHVzaCh0YXNrKVxuICBjb25zb2xlLmxvZyhg8J+TiyBBZGRlZCBwZW5kaW5nIHRhc2s6ICR7ZGVzY3JpcHRpb259YClcbiAgXG4gIHVwZGF0ZUNvbnZlcnNhdGlvblNlc3Npb24oc2Vzc2lvbilcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIG1hcmtUYXNrQ29tcGxldGVkKFxuICB1c2VySWQ6IHN0cmluZyxcbiAgc2Vzc2lvbklkOiBzdHJpbmcsXG4gIHRhc2tJZDogc3RyaW5nLFxuICByZXN1bHQ/OiBhbnlcbik6IGJvb2xlYW4ge1xuICBjb25zdCBzZXNzaW9uID0gZ2V0Q29udmVyc2F0aW9uU2Vzc2lvbih1c2VySWQsIHNlc3Npb25JZClcbiAgaWYgKCFzZXNzaW9uKSByZXR1cm4gZmFsc2VcbiAgXG4gIGNvbnN0IHRhc2sgPSBzZXNzaW9uLnBlbmRpbmdUYXNrcy5maW5kKHQgPT4gdC5pZCA9PT0gdGFza0lkKVxuICBpZiAoIXRhc2spIHJldHVybiBmYWxzZVxuICBcbiAgdGFzay5jb21wbGV0ZWQgPSB0cnVlXG4gIGlmIChyZXN1bHQpIHtcbiAgICB0YXNrLmRhdGEucmVzdWx0ID0gcmVzdWx0XG4gIH1cbiAgXG4gIGNvbnNvbGUubG9nKGDinIUgQ29tcGxldGVkIHRhc2s6ICR7dGFzay5kZXNjcmlwdGlvbn1gKVxuICB1cGRhdGVDb252ZXJzYXRpb25TZXNzaW9uKHNlc3Npb24pXG4gIHJldHVybiB0cnVlXG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRQZW5kaW5nVGFza3ModXNlcklkOiBzdHJpbmcsIHNlc3Npb25JZDogc3RyaW5nKTogQXJyYXk8e1xuICBpZDogc3RyaW5nXG4gIHR5cGU6ICdjYWxlbmRhcl9ldmVudCcgfCAnYWNhZGVtaWNfc2VhcmNoJyB8ICdyZW1pbmRlcidcbiAgZGVzY3JpcHRpb246IHN0cmluZ1xuICBkYXRhOiBhbnlcbiAgY29tcGxldGVkOiBib29sZWFuXG4gIGNyZWF0ZWRBdDogRGF0ZVxufT4ge1xuICBjb25zdCBzZXNzaW9uID0gZ2V0Q29udmVyc2F0aW9uU2Vzc2lvbih1c2VySWQsIHNlc3Npb25JZClcbiAgaWYgKCFzZXNzaW9uKSByZXR1cm4gW11cbiAgXG4gIHJldHVybiBzZXNzaW9uLnBlbmRpbmdUYXNrcy5maWx0ZXIodGFzayA9PiAhdGFzay5jb21wbGV0ZWQpXG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRDb252ZXJzYXRpb25IaXN0b3J5KHVzZXJJZDogc3RyaW5nLCBzZXNzaW9uSWQ6IHN0cmluZywgbGltaXQ6IG51bWJlciA9IDEwKTogQ29udmVyc2F0aW9uVHVybltdIHtcbiAgY29uc3Qgc2Vzc2lvbiA9IGdldENvbnZlcnNhdGlvblNlc3Npb24odXNlcklkLCBzZXNzaW9uSWQpXG4gIGlmICghc2Vzc2lvbikgcmV0dXJuIFtdXG4gIFxuICByZXR1cm4gc2Vzc2lvbi50dXJucy5zbGljZSgtbGltaXQpXG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRVc2VyQWN0aXZlU2Vzc2lvbnModXNlcklkOiBzdHJpbmcpOiBDb252ZXJzYXRpb25TZXNzaW9uW10ge1xuICBjb25zdCBvbmVIb3VyQWdvID0gbmV3IERhdGUoRGF0ZS5ub3coKSAtICg2MCAqIDYwICogMTAwMCkpXG4gIHJldHVybiB0ZW1wQ29udmVyc2F0aW9ucy5maWx0ZXIoc2Vzc2lvbiA9PiBcbiAgICBzZXNzaW9uLnVzZXJJZCA9PT0gdXNlcklkICYmIHNlc3Npb24ubGFzdFVwZGF0ZSA+IG9uZUhvdXJBZ29cbiAgKVxufVxuXG5leHBvcnQgZnVuY3Rpb24gY2xlYW51cE9sZENvbnZlcnNhdGlvbnMoKTogdm9pZCB7XG4gIGNvbnN0IHNpeEhvdXJzQWdvID0gbmV3IERhdGUoRGF0ZS5ub3coKSAtICg2ICogNjAgKiA2MCAqIDEwMDApKVxuICBjb25zdCBiZWZvcmUgPSB0ZW1wQ29udmVyc2F0aW9ucy5sZW5ndGhcbiAgXG4gIC8vIFJlbW92ZSBjb252ZXJzYXRpb25zIG9sZGVyIHRoYW4gNiBob3Vyc1xuICBmb3IgKGxldCBpID0gdGVtcENvbnZlcnNhdGlvbnMubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIHtcbiAgICBpZiAodGVtcENvbnZlcnNhdGlvbnNbaV0ubGFzdFVwZGF0ZSA8IHNpeEhvdXJzQWdvKSB7XG4gICAgICB0ZW1wQ29udmVyc2F0aW9ucy5zcGxpY2UoaSwgMSlcbiAgICB9XG4gIH1cbiAgXG4gIGNvbnN0IGFmdGVyID0gdGVtcENvbnZlcnNhdGlvbnMubGVuZ3RoXG4gIGlmIChiZWZvcmUgIT09IGFmdGVyKSB7XG4gICAgY29uc29sZS5sb2coYPCfp7kgQ2xlYW5lZCB1cCAke2JlZm9yZSAtIGFmdGVyfSBvbGQgY29udmVyc2F0aW9uIHNlc3Npb25zYClcbiAgfVxufVxuXG4vLyBJbml0aWFsaXplIGRlZmF1bHQgdXNlcnMgYXV0b21hdGljYWxseVxuaW1wb3J0IGJjcnlwdCBmcm9tIFwiYmNyeXB0anNcIlxuXG5mdW5jdGlvbiBpbml0RGVmYXVsdFVzZXJzKCkge1xuICAvLyBDaGVjayBpZiBkZW1vIHVzZXJzIGFscmVhZHkgZXhpc3QgdG8gYXZvaWQgZHVwbGljYXRlc1xuICBjb25zdCBzdHVkZW50RXhpc3RzID0gZmluZFVzZXJCeUVtYWlsKFwiZXN0dWRpYW50ZUBkZW1vLmNvbVwiKVxuICBjb25zdCBpbnN0cnVjdG9yRXhpc3RzID0gZmluZFVzZXJCeUVtYWlsKFwiaW5zdHJ1Y3RvckBkZW1vLmNvbVwiKVxuICBcbiAgaWYgKCFzdHVkZW50RXhpc3RzIHx8ICFpbnN0cnVjdG9yRXhpc3RzKSB7XG4gICAgY29uc29sZS5sb2coXCLwn5SnIEluaWNpYWxpemFuZG8gdXN1YXJpb3MgcG9yIGRlZmVjdG8uLi5cIilcbiAgICBcbiAgICB0cnkge1xuICAgICAgY29uc3QgaGFzaGVkUGFzc3dvcmQgPSBiY3J5cHQuaGFzaFN5bmMoXCJFc3R1ZGlhbnRlMTIzISEhXCIsIDEyKVxuICAgICAgXG4gICAgICAvLyBPbmx5IGFkZCBzdHVkZW50IGlmIGRvZXNuJ3QgZXhpc3RcbiAgICAgIGlmICghc3R1ZGVudEV4aXN0cykge1xuICAgICAgICBhZGRVc2VyKHtcbiAgICAgICAgICBpZDogXCJkZW1vLXN0dWRlbnQtZml4ZWRcIixcbiAgICAgICAgICBuYW1lOiBcIkVzdHVkaWFudGUgRGVtb1wiLFxuICAgICAgICAgIGVtYWlsOiBcImVzdHVkaWFudGVAZGVtby5jb21cIixcbiAgICAgICAgICBwYXNzd29yZDogaGFzaGVkUGFzc3dvcmQsXG4gICAgICAgICAgcm9sZTogXCJTVFVERU5UXCIsXG4gICAgICAgICAgc3R1ZGVudElkOiBcIkVTVC0yMDI1LTAwMVwiLFxuICAgICAgICAgIHN0YXR1czogXCJBQ1RJVkVcIixcbiAgICAgICAgICBlbnJvbGxtZW50WWVhcjogMjAyNSxcbiAgICAgICAgICBhY2FkZW1pY1llYXI6IFwiMjAyNS0yMDI2XCIsXG4gICAgICAgICAgcHJvZ3JhbTogXCJJbmdlbmllcsOtYSBlbiBTaXN0ZW1hc1wiLFxuICAgICAgICAgIHBob25lTnVtYmVyOiBcIisxMjM0NTY3ODkwXCIsXG4gICAgICAgICAgZGF0ZU9mQmlydGg6IG5ldyBEYXRlKFwiMjAwMC0wMS0wMVwiKSxcbiAgICAgICAgICBhZGRyZXNzOiBcIkRlbW8gQWRkcmVzcyAxMjNcIixcbiAgICAgICAgICBlbWVyZ2VuY3lDb250YWN0OiB7XG4gICAgICAgICAgICBuYW1lOiBcIkNvbnRhY3RvIERlbW9cIixcbiAgICAgICAgICAgIHBob25lOiBcIiswOTg3NjU0MzIxXCIsXG4gICAgICAgICAgICByZWxhdGlvbnNoaXA6IFwiUGFkcmVcIlxuICAgICAgICAgIH0sXG4gICAgICAgICAgY3JlYXRlZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgICAgfSlcbiAgICAgICAgY29uc29sZS5sb2coXCLinIUgVXN1YXJpbyBlc3R1ZGlhbnRlIGRlbW8gY3JlYWRvXCIpXG4gICAgICB9XG4gICAgICBcbiAgICAgIC8vIE9ubHkgYWRkIGluc3RydWN0b3IgaWYgZG9lc24ndCBleGlzdFxuICAgICAgaWYgKCFpbnN0cnVjdG9yRXhpc3RzKSB7XG4gICAgICAgIGFkZFVzZXIoe1xuICAgICAgICAgIGlkOiBcImRlbW8taW5zdHJ1Y3Rvci1maXhlZFwiLFxuICAgICAgICAgIG5hbWU6IFwiSW5zdHJ1Y3RvciBEZW1vXCIsXG4gICAgICAgICAgZW1haWw6IFwiaW5zdHJ1Y3RvckBkZW1vLmNvbVwiLFxuICAgICAgICAgIHBhc3N3b3JkOiBoYXNoZWRQYXNzd29yZCxcbiAgICAgICAgICByb2xlOiBcIklOU1RSVUNUT1JcIixcbiAgICAgICAgICBzdHVkZW50SWQ6IG51bGwsXG4gICAgICAgICAgc3RhdHVzOiBcIkFDVElWRVwiLFxuICAgICAgICAgIGVucm9sbG1lbnRZZWFyOiAyMDI1LFxuICAgICAgICAgIGFjYWRlbWljWWVhcjogXCIyMDI1LTIwMjZcIixcbiAgICAgICAgICBjcmVhdGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICAgICAgdXBkYXRlZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgICB9KVxuICAgICAgICBjb25zb2xlLmxvZyhcIuKchSBVc3VhcmlvIGluc3RydWN0b3IgZGVtbyBjcmVhZG9cIilcbiAgICAgIH1cbiAgICAgIFxuICAgICAgY29uc29sZS5sb2coXCLinIUgVmVyaWZpY2FjacOzbiBkZSB1c3VhcmlvcyBwb3IgZGVmZWN0byBjb21wbGV0YWRhXCIpXG4gICAgICBcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcihcIuKdjCBFcnJvciBjcmVhbmRvIHVzdWFyaW9zIHBvciBkZWZlY3RvOlwiLCBlcnJvcilcbiAgICB9XG4gIH0gZWxzZSB7XG4gICAgY29uc29sZS5sb2coXCLinIUgVXN1YXJpb3MgZGVtbyB5YSBleGlzdGVuLCBubyBzZSByZWluaWNpYWxpemFuXCIpXG4gIH1cbiAgXG4gIC8vIEFsd2F5cyBjaGVjayBhbmQgaW5pdGlhbGl6ZSBzYW1wbGUgcmVwb3J0c1xuICBpbml0U2FtcGxlUmVwb3J0cygpXG59XG5cbmZ1bmN0aW9uIGluaXRTYW1wbGVSZXBvcnRzKCkge1xuICAvLyBDaGVjayBpZiBzYW1wbGUgcmVwb3J0cyBhbHJlYWR5IGV4aXN0IGZvciBkZW1vIHN0dWRlbnRcbiAgY29uc3QgZXhpc3RpbmdTYW1wbGVSZXBvcnRzID0gdGVtcFdlZWtseVJlcG9ydHMuZmlsdGVyKHJlcG9ydCA9PiByZXBvcnQudXNlcklkID09PSBcImRlbW8tc3R1ZGVudC1maXhlZFwiKVxuICBcbiAgaWYgKGV4aXN0aW5nU2FtcGxlUmVwb3J0cy5sZW5ndGggPT09IDApIHtcbiAgICBjb25zb2xlLmxvZyhcIvCfk50gSW5pY2lhbGl6YW5kbyByZXBvcnRlcyBkZSBtdWVzdHJhLi4uXCIpXG4gICAgXG4gICAgdHJ5IHtcbiAgICAgIC8vIEdldCBjdXJyZW50IHdlZWsgZGF0ZXNcbiAgICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKClcbiAgICAgIGNvbnN0IGN1cnJlbnRXZWVrID0gZ2V0Q3VycmVudFdlZWtTdGFydCgpXG4gICAgICBjb25zdCBjdXJyZW50V2Vla0VuZCA9IGdldEN1cnJlbnRXZWVrRW5kKClcbiAgICAgIFxuICAgICAgLy8gUHJldmlvdXMgd2Vla1xuICAgICAgY29uc3QgcHJldldlZWsgPSBuZXcgRGF0ZShjdXJyZW50V2VlaylcbiAgICAgIHByZXZXZWVrLnNldERhdGUocHJldldlZWsuZ2V0RGF0ZSgpIC0gNylcbiAgICAgIGNvbnN0IHByZXZXZWVrRW5kID0gbmV3IERhdGUoY3VycmVudFdlZWtFbmQpXG4gICAgICBwcmV2V2Vla0VuZC5zZXREYXRlKHByZXZXZWVrRW5kLmdldERhdGUoKSAtIDcpXG4gICAgICBcbiAgICAgIC8vIFNhbXBsZSByZXBvcnQgZnJvbSBwcmV2aW91cyB3ZWVrXG4gICAgICBhZGRXZWVrbHlSZXBvcnQoe1xuICAgICAgICBpZDogXCJzYW1wbGUtcmVwb3J0LTFcIixcbiAgICAgICAgdXNlcklkOiBcImRlbW8tc3R1ZGVudC1maXhlZFwiLFxuICAgICAgICB3ZWVrU3RhcnQ6IHByZXZXZWVrLFxuICAgICAgICB3ZWVrRW5kOiBwcmV2V2Vla0VuZCxcbiAgICAgICAgc3VibWl0dGVkQXQ6IG5ldyBEYXRlKHByZXZXZWVrRW5kLmdldFRpbWUoKSAtIDI0ICogNjAgKiA2MCAqIDEwMDApLCAvLyAxIGRheSBiZWZvcmUgd2VlayBlbmRcbiAgICAgICAgcmVzcG9uc2VzOiB7XG4gICAgICAgICAgdGVtYXNZRG9taW5pbzogXCJFc3RhIHNlbWFuYSB0cmFiYWphbW9zIGNvbiBKYXZhU2NyaXB0IGLDoXNpY28gLSBOaXZlbCAzOiBEb21pbm8gZnVuY2lvbmVzIHkgYXJyYXlzLCB5IGVzdG95IGFwcmVuZGllbmRvIG9iamV0b3MgY29tcGxlam9zLlwiLFxuICAgICAgICAgIGV2aWRlbmNpYUFwcmVuZGl6YWplOiBcIkNvbXBsZXTDqSB1biBwcm95ZWN0byBkZSBUby1EbyBMaXN0IHVzYW5kbyBKYXZhU2NyaXB0IHZhbmlsbGEuIEltcGxlbWVudMOpIGZ1bmNpb25lcyBwYXJhIGFncmVnYXIsIGVkaXRhciB5IGVsaW1pbmFyIHRhcmVhcyB1c2FuZG8gYXJyYXlzIHkgb2JqZXRvcy5cIixcbiAgICAgICAgICBkaWZpY3VsdGFkZXNFc3RyYXRlZ2lhczogXCJUdXZlIGRpZmljdWx0YWRlcyBjb24gZWwgbWFuZWpvIGRlIGV2ZW50b3MgZW4gSmF2YVNjcmlwdC4gTG8gcmVzb2x2w60gcHJhY3RpY2FuZG8gY29uIGVqZW1wbG9zIHkgY29uc3VsdGFuZG8gZG9jdW1lbnRhY2nDs24gZGUgTUROLlwiLFxuICAgICAgICAgIGNvbmV4aW9uZXNBcGxpY2FjaW9uOiBcIkxvcyBjb25jZXB0b3MgZGUgZXZlbnRvcyBzZSBjb25lY3RhbiBjb24gbGEgaW50ZXJhY3RpdmlkYWQgZW4gYXBsaWNhY2lvbmVzIHdlYi4gUHVlZG8gYXBsaWNhcmxvIHBhcmEgY3JlYXIgaW50ZXJmYWNlcyBtw6FzIGRpbsOhbWljYXMuXCIsXG4gICAgICAgICAgY29tZW50YXJpb3NBZGljaW9uYWxlczogXCJNZSBzaWVudG8gbcOhcyBjb25maWFkbyBjb24gSmF2YVNjcmlwdC4gUXVpZXJvIHNlZ3VpciBwcmFjdGljYW5kbyBjb24gcHJveWVjdG9zIG3DoXMgY29tcGxlam9zLlwiXG4gICAgICAgIH1cbiAgICAgIH0pXG4gICAgICBcbiAgICAgIC8vIFR3byB3ZWVrcyBhZ28gcmVwb3J0ICBcbiAgICAgIGNvbnN0IHR3b1dlZWtzQWdvID0gbmV3IERhdGUoY3VycmVudFdlZWspXG4gICAgICB0d29XZWVrc0Fnby5zZXREYXRlKHR3b1dlZWtzQWdvLmdldERhdGUoKSAtIDE0KVxuICAgICAgY29uc3QgdHdvV2Vla3NBZ29FbmQgPSBuZXcgRGF0ZShjdXJyZW50V2Vla0VuZClcbiAgICAgIHR3b1dlZWtzQWdvRW5kLnNldERhdGUodHdvV2Vla3NBZ29FbmQuZ2V0RGF0ZSgpIC0gMTQpXG4gICAgICBcbiAgICAgIGFkZFdlZWtseVJlcG9ydCh7XG4gICAgICAgIGlkOiBcInNhbXBsZS1yZXBvcnQtMlwiLFxuICAgICAgICB1c2VySWQ6IFwiZGVtby1zdHVkZW50LWZpeGVkXCIsIFxuICAgICAgICB3ZWVrU3RhcnQ6IHR3b1dlZWtzQWdvLFxuICAgICAgICB3ZWVrRW5kOiB0d29XZWVrc0Fnb0VuZCxcbiAgICAgICAgc3VibWl0dGVkQXQ6IG5ldyBEYXRlKHR3b1dlZWtzQWdvRW5kLmdldFRpbWUoKSAtIDEyICogNjAgKiA2MCAqIDEwMDApLCAvLyAxMiBob3VycyBiZWZvcmUgd2VlayBlbmRcbiAgICAgICAgcmVzcG9uc2VzOiB7XG4gICAgICAgICAgdGVtYXNZRG9taW5pbzogXCJFc3RhIHNlbWFuYSBlc3R1ZGlhbW9zIENTUyBHcmlkIHkgRmxleGJveCAtIE5pdmVsIDI6IEVudGllbmRvIGxvcyBjb25jZXB0b3MgYsOhc2ljb3MgcGVybyBhw7puIHRlbmdvIGR1ZGFzIGNvbiBsYXlvdXRzIGNvbXBsZWpvcy5cIixcbiAgICAgICAgICBldmlkZW5jaWFBcHJlbmRpemFqZTogXCJSZWNyZcOpIGVsIGxheW91dCBkZSB1bmEgcMOhZ2luYSB3ZWIgdXNhbmRvIENTUyBHcmlkLiBMb2dyw6kgaGFjZXIgdW5hIGVzdHJ1Y3R1cmEgcmVzcG9uc2l2ZSBjb24gaGVhZGVyLCBzaWRlYmFyIHkgbWFpbiBjb250ZW50LlwiLFxuICAgICAgICAgIGRpZmljdWx0YWRlc0VzdHJhdGVnaWFzOiBcIk1lIGNvbmZ1bmTDrSBjb24gbGFzIHByb3BpZWRhZGVzIGdyaWQtdGVtcGxhdGUtYXJlYXMuIFJlc29sdsOtIGVsIHByb2JsZW1hIGRpYnVqYW5kbyBlbCBsYXlvdXQgZW4gcGFwZWwgcHJpbWVyby5cIixcbiAgICAgICAgICBjb25leGlvbmVzQXBsaWNhY2lvbjogXCJDU1MgR3JpZCBlcyBwZXJmZWN0byBwYXJhIGNyZWFyIGxheW91dHMgZGUgcMOhZ2luYXMgd2ViIG1vZGVybmFzLiBMbyB1c2Fyw6kgZW4gbWkgcHJveWVjdG8gZmluYWwgZGUgcMOhZ2luYSBwb3J0Zm9saW8uXCIsXG4gICAgICAgICAgY29tZW50YXJpb3NBZGljaW9uYWxlczogXCJDU1MgZXMgbcOhcyBkaXZlcnRpZG8gZGUgbG8gcXVlIHBlbnNhYmEuIE1lIGd1c3RhIHZlciBsb3MgcmVzdWx0YWRvcyB2aXN1YWxlcyBpbm1lZGlhdG9zLlwiXG4gICAgICAgIH1cbiAgICAgIH0pXG4gICAgICBcbiAgICAgIGNvbnNvbGUubG9nKFwi4pyFIFJlcG9ydGVzIGRlIG11ZXN0cmEgY3JlYWRvcyBleGl0b3NhbWVudGVcIilcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcihcIuKdjCBFcnJvciBjcmVhbmRvIHJlcG9ydGVzIGRlIG11ZXN0cmE6XCIsIGVycm9yKVxuICAgIH1cbiAgfSBlbHNlIHtcbiAgICBjb25zb2xlLmxvZyhcIuKchSBSZXBvcnRlcyBkZSBtdWVzdHJhIHlhIGV4aXN0ZW4sIG5vIHNlIHJlaW5pY2lhbGl6YW5cIilcbiAgfVxufVxuXG4vLyBJbml0aWFsaXplIG9uIG1vZHVsZSBsb2FkXG5pbml0RGVmYXVsdFVzZXJzKClcblxuLy8gU3RhcnQgY29udmVyc2F0aW9uIGNsZWFudXAgaW50ZXJ2YWxcbnNldEludGVydmFsKGNsZWFudXBPbGRDb252ZXJzYXRpb25zLCAzMCAqIDYwICogMTAwMCkgLy8gRXZlcnkgMzAgbWludXRlcyJdLCJuYW1lcyI6WyJnbG9iYWxGb3JTdG9yYWdlIiwiZ2xvYmFsVGhpcyIsInRlbXBVc2VycyIsInRlbXBXZWVrbHlSZXBvcnRzIiwiYWRkVXNlciIsInVzZXIiLCJwdXNoIiwiZmluZFVzZXJCeUVtYWlsIiwiZW1haWwiLCJmaW5kIiwiZmluZFVzZXJCeVN0dWRlbnRJZCIsInN0dWRlbnRJZCIsImZpbmRVc2VyQnlJZCIsImlkIiwiZ2V0QWxsVXNlcnMiLCJmaW5kVXNlcnNCeVJvbGUiLCJyb2xlIiwiZmlsdGVyIiwiZmluZFVzZXJzQnlQcm9ncmFtIiwicHJvZ3JhbSIsImZpbmRVc2Vyc0J5U3RhdHVzIiwic3RhdHVzIiwidXBkYXRlVXNlciIsInVwZGF0ZXMiLCJ1c2VySW5kZXgiLCJmaW5kSW5kZXgiLCJ1cGRhdGVkQXQiLCJEYXRlIiwiZGVsZXRlVXNlciIsInNwbGljZSIsInZhbGlkYXRlU3R1ZGVudElkIiwic3R1ZGVudElkUmVnZXgiLCJ0ZXN0IiwiZ2VuZXJhdGVTdHVkZW50SWQiLCJjdXJyZW50WWVhciIsImdldEZ1bGxZZWFyIiwiZXhpc3RpbmdJZHMiLCJzdGFydHNXaXRoIiwibWFwIiwic29ydCIsIm5leHROdW1iZXIiLCJsZW5ndGgiLCJsYXN0SWQiLCJsYXN0TnVtYmVyIiwicGFyc2VJbnQiLCJzcGxpdCIsInRvU3RyaW5nIiwicGFkU3RhcnQiLCJhZGRXZWVrbHlSZXBvcnQiLCJyZXBvcnQiLCJmaW5kV2Vla2x5UmVwb3J0c0J5VXNlciIsInVzZXJJZCIsImZpbmRXZWVrbHlSZXBvcnRCeVVzZXJBbmRXZWVrIiwid2Vla1N0YXJ0IiwiZ2V0VGltZSIsImdldEFsbFdlZWtseVJlcG9ydHMiLCJnZXRXZWVrbHlSZXBvcnRzQnlEYXRlUmFuZ2UiLCJzdGFydERhdGUiLCJlbmREYXRlIiwid2Vla0VuZCIsImdldEN1cnJlbnRXZWVrU3RhcnQiLCJub3ciLCJtb25kYXkiLCJkYXkiLCJnZXREYXkiLCJkaWZmIiwiZ2V0RGF0ZSIsInNldERhdGUiLCJzZXRIb3VycyIsImdldEN1cnJlbnRXZWVrRW5kIiwiY2FuU3VibWl0VGhpc1dlZWsiLCJjdXJyZW50RGF0ZSIsImV4aXN0aW5nUmVwb3J0IiwiaXNDdXJyZW50V2VlayIsImNvbnNvbGUiLCJsb2ciLCJ0b0lTT1N0cmluZyIsImdldFdlZWtEYXRlcyIsImRhdGUiLCJzdGFydCIsImVuZCIsImdldE1vbnRoV2Vla3MiLCJ5ZWFyIiwibW9udGgiLCJ3ZWVrcyIsImZpcnN0RGF5IiwibGFzdERheSIsImN1cnJlbnQiLCJkYXlPZldlZWsiLCJkYXlzVG9TdWJ0cmFjdCIsImdldEV2ZW50cyIsImdldFVzZXJDYWxlbmRhckRhdGEiLCJyZXF1aXJlIiwidXNlckRhdGEiLCJldmVudHMiLCJlcnJvciIsImdldEFsbENhbGVuZGFyRXZlbnRzIiwiZ2V0VXBjb21pbmdFdmVudHMiLCJkYXlzIiwiYWxsRXZlbnRzIiwiZnV0dXJlRGF0ZSIsImV2ZW50IiwiZXZlbnREYXRlIiwiYSIsImIiLCJnZXRFdmVudHNGb3JEYXRlUmFuZ2UiLCJmaW5kRXZlbnRCeUlkIiwiZXZlbnRJZCIsImdsb2JhbEZvckNvbnZlcnNhdGlvbnMiLCJ0ZW1wQ29udmVyc2F0aW9ucyIsImdldENvbnZlcnNhdGlvblNlc3Npb24iLCJzZXNzaW9uSWQiLCJzZXNzaW9uIiwiY3JlYXRlQ29udmVyc2F0aW9uU2Vzc2lvbiIsImV4aXN0aW5nSW5kZXgiLCJuZXdTZXNzaW9uIiwidHVybnMiLCJjdXJyZW50VG9waWMiLCJ1bmRlZmluZWQiLCJjdXJyZW50U3ViamVjdCIsInBlbmRpbmdUYXNrcyIsImxhc3RVcGRhdGUiLCJ1cGRhdGVDb252ZXJzYXRpb25TZXNzaW9uIiwiaW5kZXgiLCJzIiwiYWRkQ29udmVyc2F0aW9uVHVybiIsImNvbnRlbnQiLCJtZXRhZGF0YSIsInR1cm4iLCJNYXRoIiwicmFuZG9tIiwic3Vic3RyIiwidGltZXN0YW1wIiwic2xpY2UiLCJhZGRQZW5kaW5nVGFzayIsInR5cGUiLCJkZXNjcmlwdGlvbiIsImRhdGEiLCJ0YXNrIiwiY29tcGxldGVkIiwiY3JlYXRlZEF0IiwibWFya1Rhc2tDb21wbGV0ZWQiLCJ0YXNrSWQiLCJyZXN1bHQiLCJ0IiwiZ2V0UGVuZGluZ1Rhc2tzIiwiZ2V0Q29udmVyc2F0aW9uSGlzdG9yeSIsImxpbWl0IiwiZ2V0VXNlckFjdGl2ZVNlc3Npb25zIiwib25lSG91ckFnbyIsImNsZWFudXBPbGRDb252ZXJzYXRpb25zIiwic2l4SG91cnNBZ28iLCJiZWZvcmUiLCJpIiwiYWZ0ZXIiLCJiY3J5cHQiLCJpbml0RGVmYXVsdFVzZXJzIiwic3R1ZGVudEV4aXN0cyIsImluc3RydWN0b3JFeGlzdHMiLCJoYXNoZWRQYXNzd29yZCIsImhhc2hTeW5jIiwibmFtZSIsInBhc3N3b3JkIiwiZW5yb2xsbWVudFllYXIiLCJhY2FkZW1pY1llYXIiLCJwaG9uZU51bWJlciIsImRhdGVPZkJpcnRoIiwiYWRkcmVzcyIsImVtZXJnZW5jeUNvbnRhY3QiLCJwaG9uZSIsInJlbGF0aW9uc2hpcCIsImluaXRTYW1wbGVSZXBvcnRzIiwiZXhpc3RpbmdTYW1wbGVSZXBvcnRzIiwiY3VycmVudFdlZWsiLCJjdXJyZW50V2Vla0VuZCIsInByZXZXZWVrIiwicHJldldlZWtFbmQiLCJzdWJtaXR0ZWRBdCIsInJlc3BvbnNlcyIsInRlbWFzWURvbWluaW8iLCJldmlkZW5jaWFBcHJlbmRpemFqZSIsImRpZmljdWx0YWRlc0VzdHJhdGVnaWFzIiwiY29uZXhpb25lc0FwbGljYWNpb24iLCJjb21lbnRhcmlvc0FkaWNpb25hbGVzIiwidHdvV2Vla3NBZ28iLCJ0d29XZWVrc0Fnb0VuZCIsInNldEludGVydmFsIl0sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/temp-storage.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/visual-learning-engine.ts":
/*!*******************************************!*\
  !*** ./src/lib/visual-learning-engine.ts ***!
  \*******************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   VisualLearningEngine: () => (/* binding */ VisualLearningEngine),\n/* harmony export */   VisualType: () => (/* binding */ VisualType)\n/* harmony export */ });\n// Visual Learning Engine for Sara AI\n// Generates ASCII diagrams, conceptual maps, and visual representations for enhanced learning\nvar VisualType = /*#__PURE__*/ function(VisualType) {\n    VisualType[\"CONCEPT_MAP\"] = \"concept_map\";\n    VisualType[\"FLOWCHART\"] = \"flowchart\";\n    VisualType[\"HIERARCHY\"] = \"hierarchy\";\n    VisualType[\"TIMELINE\"] = \"timeline\";\n    VisualType[\"DIAGRAM\"] = \"diagram\";\n    VisualType[\"FORMULA_VISUALIZATION\"] = \"formula_visualization\";\n    VisualType[\"CHEMICAL_STRUCTURE\"] = \"chemical_structure\";\n    VisualType[\"MATH_GRAPH\"] = \"math_graph\";\n    VisualType[\"PROCESS_FLOW\"] = \"process_flow\";\n    return VisualType;\n}({});\nclass VisualLearningEngine {\n    /**\n   * Generates visual representation based on content and type\n   */ static generateVisual(content, type, subject) {\n        switch(type){\n            case \"concept_map\":\n                return this.generateConceptMap(content, subject);\n            case \"flowchart\":\n                return this.generateFlowchart(content);\n            case \"hierarchy\":\n                return this.generateHierarchy(content);\n            case \"timeline\":\n                return this.generateTimeline(content);\n            case \"formula_visualization\":\n                return this.generateFormulaVisualization(content);\n            case \"chemical_structure\":\n                return this.generateChemicalStructure(content);\n            case \"process_flow\":\n                return this.generateProcessFlow(content);\n            default:\n                return this.generateGenericDiagram(content);\n        }\n    }\n    /**\n   * Auto-detects the best visual type for content\n   */ static detectOptimalVisualType(content, subject) {\n        const contentLower = content.toLowerCase();\n        // Chemical formulas and structures\n        if (subject === 'chemistry' || subject === 'química' || /h2o|co2|nacl|ch4|formula|molecular|átomo|molécula/.test(contentLower)) {\n            return \"chemical_structure\";\n        }\n        // Mathematical formulas\n        if (subject === 'mathematics' || subject === 'matemáticas' || /ecuación|formula|función|derivada|integral|gráfica/.test(contentLower)) {\n            return \"formula_visualization\";\n        }\n        // Process or step-by-step content\n        if (/paso|step|proceso|luego|después|entonces|primero|segundo/.test(contentLower)) {\n            return \"process_flow\";\n        }\n        // Hierarchical content\n        if (/clasificación|categoría|tipo|nivel|jerarquía|superior|inferior/.test(contentLower)) {\n            return \"hierarchy\";\n        }\n        // Timeline content\n        if (/año|fecha|siglo|época|antes|después|historia|cronología/.test(contentLower)) {\n            return \"timeline\";\n        }\n        // Conceptual relationships\n        if (/relación|concepto|idea|conecta|vincula|asocia/.test(contentLower)) {\n            return \"concept_map\";\n        }\n        // Default to flowchart for general content\n        return \"flowchart\";\n    }\n    /**\n   * Generates concept map visualization\n   */ static generateConceptMap(content, subject) {\n        const concepts = this.extractConcepts(content);\n        const mainConcept = concepts[0] || 'Concepto Principal';\n        const relatedConcepts = concepts.slice(1, 5);\n        let ascii = `\n┌─────────────────────┐\n│   ${this.centerText(mainConcept, 17)}   │\n└─────────┬───────────┘\n          │\n    ┌─────┴─────┐\n    │           │`;\n        relatedConcepts.forEach((concept, index)=>{\n            if (index < 2) {\n                ascii += `\n┌──────────────┐    ┌──────────────┐\n│ ${this.centerText(concept, 12)} │    │              │\n└──────────────┘    └──────────────┘`;\n            }\n        });\n        if (relatedConcepts.length > 2) {\n            ascii += `\n    │           │\n┌───┴─────┐ ┌─────┴───┐`;\n            relatedConcepts.slice(2, 4).forEach((concept)=>{\n                ascii += `\n│ ${this.centerText(concept, 7)} │ │         │`;\n            });\n            ascii += `\n└─────────┘ └─────────┘`;\n        }\n        return {\n            type: \"concept_map\",\n            ascii: ascii,\n            description: `Mapa conceptual que muestra las relaciones entre ${mainConcept} y conceptos relacionados`,\n            elements: concepts.map((concept, index)=>({\n                    id: `concept_${index}`,\n                    type: \"concept_map\",\n                    title: concept,\n                    content: `Concepto: ${concept}`,\n                    connections: index === 0 ? relatedConcepts : [\n                        mainConcept\n                    ]\n                })),\n            instructions: [\n                'El concepto central aparece en la parte superior',\n                'Las líneas conectan conceptos relacionados',\n                'Los conceptos secundarios se ramifican del principal'\n            ]\n        };\n    }\n    /**\n   * Generates flowchart visualization\n   */ static generateFlowchart(content) {\n        const steps = this.extractSteps(content);\n        let ascii = `┌─────────────┐\\n│   INICIO    │\\n└──────┬──────┘\\n       │\\n       ▼`;\n        steps.forEach((step, index)=>{\n            const stepText = this.truncateText(step, 15);\n            ascii += `\n┌─────────────────┐\n│ ${this.centerText(stepText, 15)} │\n└─────────┬───────┘\n          │\n          ▼`;\n        });\n        ascii += `\n┌─────────────┐\n│    FIN      │\n└─────────────┘`;\n        return {\n            type: \"flowchart\",\n            ascii: ascii,\n            description: `Diagrama de flujo que muestra ${steps.length} pasos del proceso`,\n            elements: steps.map((step, index)=>({\n                    id: `step_${index}`,\n                    type: \"flowchart\",\n                    title: `Paso ${index + 1}`,\n                    content: step,\n                    connections: index < steps.length - 1 ? [\n                        `step_${index + 1}`\n                    ] : []\n                })),\n            instructions: [\n                'Sigue las flechas de arriba hacia abajo',\n                'Cada caja representa un paso del proceso',\n                'El flujo va desde INICIO hasta FIN'\n            ]\n        };\n    }\n    /**\n   * Generates hierarchy visualization\n   */ static generateHierarchy(content) {\n        const hierarchyItems = this.extractHierarchy(content);\n        const root = hierarchyItems[0] || 'Elemento Principal';\n        const children = hierarchyItems.slice(1, 4);\n        const grandchildren = hierarchyItems.slice(4, 8);\n        let ascii = `\n                    ┌──────────────────┐\n                    │ ${this.centerText(root, 16)} │\n                    └─────────┬────────┘\n                              │\n                 ┌────────────┼────────────┐`;\n        children.forEach((child, index)=>{\n            const spacing = index === 0 ? '     ' : index === 1 ? '           ' : '                 ';\n            ascii += `\n        ┌─────────────┐${spacing}┌─────────────┐\n        │ ${this.centerText(child, 11)} │${spacing}│             │\n        └─────────────┘${spacing}└─────────────┘`;\n        });\n        if (grandchildren.length > 0) {\n            ascii += `\n              │                     │\n        ┌─────┴─────┐         ┌─────┴─────┐`;\n            grandchildren.slice(0, 2).forEach((item)=>{\n                ascii += `\n        │ ${this.centerText(item, 9)} │         │           │`;\n            });\n            ascii += `\n        └───────────┘         └───────────┘`;\n        }\n        return {\n            type: \"hierarchy\",\n            ascii: ascii,\n            description: `Jerarquía que muestra la estructura de ${root} con ${children.length} niveles`,\n            elements: hierarchyItems.map((item, index)=>({\n                    id: `hierarchy_${index}`,\n                    type: \"hierarchy\",\n                    title: item,\n                    content: `Elemento de jerarquía: ${item}`,\n                    connections: index === 0 ? children : []\n                })),\n            instructions: [\n                'El elemento principal está en la parte superior',\n                'Los elementos secundarios se conectan hacia abajo',\n                'Cada nivel representa una subdivisión'\n            ]\n        };\n    }\n    /**\n   * Generates timeline visualization\n   */ static generateTimeline(content) {\n        const timeEvents = this.extractTimelineEvents(content);\n        let ascii = `━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\\n`;\n        timeEvents.forEach((event, index)=>{\n            const eventText = this.truncateText(event.event, 20);\n            const timeText = event.time || `T${index + 1}`;\n            if (index % 2 === 0) {\n                // Event above timeline\n                ascii += `┌─────────────────────┐\\n│ ${this.centerText(eventText, 19)} │\\n└──────────┬──────────┘\\n           │\\n`;\n                ascii += `━━━━━━━━━━━┿━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\\n`;\n                ascii += `           ${timeText}\\n\\n`;\n            } else {\n                // Event below timeline\n                ascii += `           │\\n           ┼\\n┌──────────┴──────────┐\\n│ ${this.centerText(eventText, 19)} │\\n└─────────────────────┘\\n`;\n            }\n        });\n        return {\n            type: \"timeline\",\n            ascii: ascii,\n            description: `Línea de tiempo con ${timeEvents.length} eventos cronológicos`,\n            elements: timeEvents.map((event, index)=>({\n                    id: `event_${index}`,\n                    type: \"timeline\",\n                    title: event.time || `Evento ${index + 1}`,\n                    content: event.event,\n                    connections: []\n                })),\n            instructions: [\n                'Los eventos se muestran en orden cronológico',\n                'La línea horizontal representa el tiempo',\n                'Los eventos alternos aparecen arriba y abajo de la línea'\n            ]\n        };\n    }\n    /**\n   * Generates formula visualization\n   */ static generateFormulaVisualization(content) {\n        const formula = this.extractFormula(content);\n        const variables = this.extractVariables(content);\n        let ascii = `\n╔═══════════════════════════════════╗\n║         FÓRMULA MATEMÁTICA        ║\n╠═══════════════════════════════════╣\n║                                   ║\n║         ${this.centerText(formula, 19)}         ║\n║                                   ║\n╠═══════════════════════════════════╣\n║           VARIABLES:              ║`;\n        variables.forEach((variable)=>{\n            ascii += `\n║  ${variable.symbol} = ${this.truncateText(variable.description, 20)}    ║`;\n        });\n        ascii += `\n║                                   ║\n╚═══════════════════════════════════╝\n\n    Representación visual:\n    \n         ${formula}\n         ↙     ↘\n    Variable   Resultado\n      ${variables[0]?.symbol || 'x'}         y`;\n        return {\n            type: \"formula_visualization\",\n            ascii: ascii,\n            description: `Visualización de la fórmula ${formula} con ${variables.length} variables`,\n            elements: [\n                {\n                    id: 'formula_main',\n                    type: \"formula_visualization\",\n                    title: 'Fórmula Principal',\n                    content: formula,\n                    connections: variables.map((_, index)=>`var_${index}`)\n                }\n            ].concat(variables.map((variable, index)=>({\n                    id: `var_${index}`,\n                    type: \"formula_visualization\",\n                    title: variable.symbol,\n                    content: variable.description,\n                    connections: []\n                }))),\n            instructions: [\n                'La fórmula principal se muestra en el centro',\n                'Las variables se definen en la tabla inferior',\n                'Sustituye los valores para resolver'\n            ]\n        };\n    }\n    /**\n   * Generates chemical structure visualization\n   */ static generateChemicalStructure(content) {\n        const molecule = this.extractMolecule(content);\n        const atoms = this.extractAtoms(content);\n        let ascii = '';\n        // Simple molecular representations\n        if (molecule.toLowerCase().includes('h2o') || molecule.toLowerCase().includes('agua')) {\n            ascii = `\n        Estructura del Agua (H₂O)\n        \n            H\n            │\n        H─O─H    o    H─O─H\n            \n        Representación angular:\n        \n            H\n             \\\\\n              O\n             /\n            H\n              \n        Ángulo H-O-H: 104.5°`;\n        } else if (molecule.toLowerCase().includes('co2')) {\n            ascii = `\n        Estructura del CO₂\n        \n        O═C═O\n        \n        Lineal, 180°\n        \n        Enlaces dobles:\n        O ══ C ══ O`;\n        } else if (molecule.toLowerCase().includes('ch4') || molecule.toLowerCase().includes('metano')) {\n            ascii = `\n        Estructura del Metano (CH₄)\n        \n           H\n           │\n        H─C─H\n           │\n           H\n           \n        Tetraédrica\n        Ángulo H-C-H: 109.5°`;\n        } else {\n            ascii = `\n        Estructura Molecular\n        \n        ${molecule}\n        \n        Átomos identificados:\n        ${atoms.map((atom)=>`• ${atom}`).join('\\n        ')}\n        \n        Representación esquemática:\n        \n        [Átomo1]─[Átomo2]─[Átomo3]`;\n        }\n        return {\n            type: \"chemical_structure\",\n            ascii: ascii,\n            description: `Estructura química de ${molecule} mostrando ${atoms.length} tipos de átomos`,\n            elements: [\n                {\n                    id: 'molecule_main',\n                    type: \"chemical_structure\",\n                    title: molecule,\n                    content: `Molécula: ${molecule}`,\n                    connections: atoms.map((_, index)=>`atom_${index}`)\n                }\n            ].concat(atoms.map((atom, index)=>({\n                    id: `atom_${index}`,\n                    type: \"chemical_structure\",\n                    title: atom,\n                    content: `Átomo: ${atom}`,\n                    connections: []\n                }))),\n            instructions: [\n                'Los átomos se representan con sus símbolos',\n                'Las líneas representan enlaces químicos',\n                'Los ángulos muestran la geometría molecular'\n            ]\n        };\n    }\n    /**\n   * Generates process flow visualization\n   */ static generateProcessFlow(content) {\n        const processes = this.extractProcesses(content);\n        let ascii = `\n    FLUJO DEL PROCESO\n    \n    ┌─────────────┐`;\n        processes.forEach((process, index)=>{\n            const processText = this.truncateText(process, 15);\n            if (index === 0) {\n                ascii += `\n    │   ${this.centerText(processText, 9)}   │\n    └─────┬───────┘\n          │\n          ▼`;\n            } else {\n                ascii += `\n    ┌─────────────┐\n    │   ${this.centerText(processText, 9)}   │\n    └─────┬───────┘\n          │\n          ▼`;\n            }\n        });\n        ascii += `\n    ┌─────────────┐\n    │   FINAL     │\n    └─────────────┘`;\n        return {\n            type: \"process_flow\",\n            ascii: ascii,\n            description: `Flujo de proceso con ${processes.length} etapas secuenciales`,\n            elements: processes.map((process, index)=>({\n                    id: `process_${index}`,\n                    type: \"process_flow\",\n                    title: `Proceso ${index + 1}`,\n                    content: process,\n                    connections: index < processes.length - 1 ? [\n                        `process_${index + 1}`\n                    ] : []\n                })),\n            instructions: [\n                'Sigue el flujo de arriba hacia abajo',\n                'Cada caja representa una etapa del proceso',\n                'Las flechas indican la secuencia'\n            ]\n        };\n    }\n    /**\n   * Generates generic diagram\n   */ static generateGenericDiagram(content) {\n        const keyPoints = this.extractKeyPoints(content, 4);\n        let ascii = `\n    ╭─────────────────────────────────╮\n    │        DIAGRAMA GENERAL         │\n    ╰─────────────┬───────────────────╯\n                  │`;\n        keyPoints.forEach((point, index)=>{\n            const pointText = this.truncateText(point, 20);\n            ascii += `\n                  ▼\n    ┌─────────────────────────────┐\n    │ ${index + 1}. ${this.leftAlign(pointText, 23)} │\n    └─────────────────────────────┘`;\n        });\n        return {\n            type: \"diagram\",\n            ascii: ascii,\n            description: `Diagrama general con ${keyPoints.length} elementos principales`,\n            elements: keyPoints.map((point, index)=>({\n                    id: `point_${index}`,\n                    type: \"diagram\",\n                    title: `Punto ${index + 1}`,\n                    content: point,\n                    connections: []\n                })),\n            instructions: [\n                'Cada elemento se presenta de forma secuencial',\n                'Los números indican el orden de importancia',\n                'Revisa cada punto para comprensión completa'\n            ]\n        };\n    }\n    // ===== UTILITY FUNCTIONS =====\n    /**\n   * Extracts main concepts from content\n   */ static extractConcepts(content) {\n        const sentences = content.split(/[.!?]+/);\n        const concepts = [];\n        for (const sentence of sentences){\n            const words = sentence.trim().split(' ');\n            const importantWords = words.filter((word)=>word.length > 4 && ![\n                    'este',\n                    'esta',\n                    'estos',\n                    'estas',\n                    'cuando',\n                    'donde',\n                    'porque'\n                ].includes(word.toLowerCase()));\n            if (importantWords.length > 0) {\n                concepts.push(importantWords[0]);\n            }\n            if (concepts.length >= 5) break;\n        }\n        return concepts.length > 0 ? concepts : [\n            'Concepto Principal'\n        ];\n    }\n    /**\n   * Extracts steps from content\n   */ static extractSteps(content) {\n        // Look for numbered steps or sequential indicators\n        const stepPatterns = [\n            /\\d+[.)]\\s*([^.!?]+)/g,\n            /paso \\d+:?\\s*([^.!?]+)/gi,\n            /(primero|segundo|tercero|luego|después|finalmente)[,:]?\\s*([^.!?]+)/gi\n        ];\n        const steps = [];\n        for (const pattern of stepPatterns){\n            let match;\n            while((match = pattern.exec(content)) !== null && steps.length < 6){\n                const step = match[1] || match[2];\n                if (step && step.trim().length > 5) {\n                    steps.push(step.trim());\n                }\n            }\n        }\n        if (steps.length === 0) {\n            // Fallback: split by sentences\n            const sentences = content.split(/[.!?]+/);\n            steps.push(...sentences.slice(0, 4).filter((s)=>s.trim().length > 10));\n        }\n        return steps.slice(0, 5);\n    }\n    /**\n   * Extracts hierarchy items\n   */ static extractHierarchy(content) {\n        const hierarchyWords = [\n            'principal',\n            'secundario',\n            'tipo',\n            'categoría',\n            'clase',\n            'grupo'\n        ];\n        const items = [];\n        const sentences = content.split(/[.!?]+/);\n        for (const sentence of sentences){\n            for (const word of hierarchyWords){\n                if (sentence.toLowerCase().includes(word)) {\n                    const cleanSentence = sentence.replace(/^\\s*\\d+[.)]\\s*/, '').trim();\n                    if (cleanSentence.length > 5) {\n                        items.push(cleanSentence);\n                        break;\n                    }\n                }\n            }\n            if (items.length >= 6) break;\n        }\n        return items.length > 0 ? items : [\n            'Elemento Principal',\n            'Subelemento 1',\n            'Subelemento 2'\n        ];\n    }\n    /**\n   * Extracts timeline events\n   */ static extractTimelineEvents(content) {\n        const timePattern = /(\\d{4}|\\d{1,2}:\\d{2}|siglo \\w+|era \\w+)/gi;\n        const events = [];\n        const sentences = content.split(/[.!?]+/);\n        for (const sentence of sentences){\n            const timeMatch = sentence.match(timePattern);\n            if (timeMatch) {\n                events.push({\n                    time: timeMatch[0],\n                    event: sentence.replace(timePattern, '').trim()\n                });\n            }\n        }\n        if (events.length === 0) {\n            // Fallback timeline\n            const keyEvents = sentences.slice(0, 3).filter((s)=>s.trim().length > 10);\n            keyEvents.forEach((event, index)=>{\n                events.push({\n                    time: `T${index + 1}`,\n                    event: event.trim()\n                });\n            });\n        }\n        return events.slice(0, 5);\n    }\n    /**\n   * Extracts formula from content\n   */ static extractFormula(content) {\n        // Look for mathematical expressions\n        const formulaPatterns = [\n            /([a-zA-Z]\\s*[=]\\s*[^.!?]+)/,\n            /([a-zA-Z]+\\s*\\(\\s*[a-zA-Z,\\s]+\\s*\\))/,\n            /(f\\([x-z]\\)\\s*=\\s*[^.!?]+)/i,\n            /([xy]\\s*=\\s*[^.!?]+)/\n        ];\n        for (const pattern of formulaPatterns){\n            const match = content.match(pattern);\n            if (match) {\n                return match[1].trim();\n            }\n        }\n        // Fallback\n        if (content.includes('=')) {\n            const parts = content.split('=');\n            if (parts.length >= 2) {\n                return `${parts[0].trim()} = ${parts[1].split(/[.!?]/)[0].trim()}`;\n            }\n        }\n        return 'y = f(x)';\n    }\n    /**\n   * Extracts variables from content\n   */ static extractVariables(content) {\n        const variables = [];\n        // Look for variable definitions like \"donde x es...\"\n        const varPattern = /([a-zA-Z])\\s+es\\s+([^.!?]+)/gi;\n        let match;\n        while((match = varPattern.exec(content)) !== null && variables.length < 4){\n            variables.push({\n                symbol: match[1],\n                description: match[2].trim()\n            });\n        }\n        if (variables.length === 0) {\n            variables.push({\n                symbol: 'x',\n                description: 'variable independiente'\n            }, {\n                symbol: 'y',\n                description: 'variable dependiente'\n            });\n        }\n        return variables;\n    }\n    /**\n   * Extracts molecule information\n   */ static extractMolecule(content) {\n        const moleculePatterns = [\n            /([A-Z][a-z]?\\d*)+/g,\n            /(agua|metano|dióxido|carbono|oxígeno|hidrógeno)/i\n        ];\n        for (const pattern of moleculePatterns){\n            const match = content.match(pattern);\n            if (match) {\n                return match[0];\n            }\n        }\n        return 'Molécula';\n    }\n    /**\n   * Extracts atoms from content\n   */ static extractAtoms(content) {\n        const atomSymbols = content.match(/[A-Z][a-z]?/g) || [];\n        const uniqueAtoms = [\n            ...new Set(atomSymbols)\n        ];\n        if (uniqueAtoms.length === 0) {\n            return [\n                'C',\n                'H',\n                'O'\n            ];\n        }\n        return uniqueAtoms.slice(0, 5);\n    }\n    /**\n   * Extracts processes from content\n   */ static extractProcesses(content) {\n        const processes = this.extractSteps(content);\n        return processes.length > 0 ? processes : [\n            'Proceso 1',\n            'Proceso 2',\n            'Proceso 3'\n        ];\n    }\n    /**\n   * Extracts key points from content\n   */ static extractKeyPoints(content, limit = 4) {\n        const sentences = content.split(/[.!?]+/);\n        return sentences.filter((s)=>s.trim().length > 10).slice(0, limit).map((s)=>s.trim());\n    }\n    // ===== TEXT FORMATTING UTILITIES =====\n    /**\n   * Centers text in a fixed width\n   */ static centerText(text, width) {\n        const truncated = this.truncateText(text, width);\n        const padding = Math.max(0, width - truncated.length);\n        const leftPad = Math.floor(padding / 2);\n        const rightPad = padding - leftPad;\n        return ' '.repeat(leftPad) + truncated + ' '.repeat(rightPad);\n    }\n    /**\n   * Left aligns text in a fixed width\n   */ static leftAlign(text, width) {\n        const truncated = this.truncateText(text, width);\n        const padding = Math.max(0, width - truncated.length);\n        return truncated + ' '.repeat(padding);\n    }\n    /**\n   * Truncates text to fit width\n   */ static truncateText(text, maxWidth) {\n        if (text.length <= maxWidth) {\n            return text;\n        }\n        return text.substring(0, maxWidth - 3) + '...';\n    }\n    /**\n   * Main entry point - analyzes content and generates appropriate visual\n   */ static generateOptimalVisual(content, subject) {\n        const optimalType = this.detectOptimalVisualType(content, subject);\n        return this.generateVisual(content, optimalType, subject);\n    }\n    /**\n   * Generates multiple visual options for user to choose from\n   */ static generateVisualOptions(content, subject) {\n        const primaryType = this.detectOptimalVisualType(content, subject);\n        const options = [\n            this.generateVisual(content, primaryType, subject)\n        ];\n        // Add alternative visualizations\n        const alternativeTypes = [\n            \"concept_map\",\n            \"flowchart\",\n            \"diagram\"\n        ];\n        for (const type of alternativeTypes){\n            if (type !== primaryType && options.length < 3) {\n                options.push(this.generateVisual(content, type, subject));\n            }\n        }\n        return options;\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvbGliL3Zpc3VhbC1sZWFybmluZy1lbmdpbmUudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSxxQ0FBcUM7QUFDckMsOEZBQThGO0FBRXZGLHdDQUFLQTs7Ozs7Ozs7OztXQUFBQTtNQVVYO0FBdUJNLE1BQU1DO0lBRVg7O0dBRUMsR0FDRCxPQUFPQyxlQUFlQyxPQUFlLEVBQUVDLElBQWdCLEVBQUVDLE9BQWdCLEVBQXdCO1FBQy9GLE9BQVFEO1lBQ047Z0JBQ0UsT0FBTyxJQUFJLENBQUNFLGtCQUFrQixDQUFDSCxTQUFTRTtZQUMxQztnQkFDRSxPQUFPLElBQUksQ0FBQ0UsaUJBQWlCLENBQUNKO1lBQ2hDO2dCQUNFLE9BQU8sSUFBSSxDQUFDSyxpQkFBaUIsQ0FBQ0w7WUFDaEM7Z0JBQ0UsT0FBTyxJQUFJLENBQUNNLGdCQUFnQixDQUFDTjtZQUMvQjtnQkFDRSxPQUFPLElBQUksQ0FBQ08sNEJBQTRCLENBQUNQO1lBQzNDO2dCQUNFLE9BQU8sSUFBSSxDQUFDUSx5QkFBeUIsQ0FBQ1I7WUFDeEM7Z0JBQ0UsT0FBTyxJQUFJLENBQUNTLG1CQUFtQixDQUFDVDtZQUNsQztnQkFDRSxPQUFPLElBQUksQ0FBQ1Usc0JBQXNCLENBQUNWO1FBQ3ZDO0lBQ0Y7SUFFQTs7R0FFQyxHQUNELE9BQU9XLHdCQUF3QlgsT0FBZSxFQUFFRSxPQUFnQixFQUFjO1FBQzVFLE1BQU1VLGVBQWVaLFFBQVFhLFdBQVc7UUFFeEMsbUNBQW1DO1FBQ25DLElBQUlYLFlBQVksZUFBZUEsWUFBWSxhQUN2QyxvREFBb0RZLElBQUksQ0FBQ0YsZUFBZTtZQUMxRTtRQUNGO1FBRUEsd0JBQXdCO1FBQ3hCLElBQUlWLFlBQVksaUJBQWlCQSxZQUFZLGlCQUN6QyxxREFBcURZLElBQUksQ0FBQ0YsZUFBZTtZQUMzRTtRQUNGO1FBRUEsa0NBQWtDO1FBQ2xDLElBQUksMkRBQTJERSxJQUFJLENBQUNGLGVBQWU7WUFDakY7UUFDRjtRQUVBLHVCQUF1QjtRQUN2QixJQUFJLGlFQUFpRUUsSUFBSSxDQUFDRixlQUFlO1lBQ3ZGO1FBQ0Y7UUFFQSxtQkFBbUI7UUFDbkIsSUFBSSwwREFBMERFLElBQUksQ0FBQ0YsZUFBZTtZQUNoRjtRQUNGO1FBRUEsMkJBQTJCO1FBQzNCLElBQUksZ0RBQWdERSxJQUFJLENBQUNGLGVBQWU7WUFDdEU7UUFDRjtRQUVBLDJDQUEyQztRQUMzQztJQUNGO0lBRUE7O0dBRUMsR0FDRCxPQUFPVCxtQkFBbUJILE9BQWUsRUFBRUUsT0FBZ0IsRUFBd0I7UUFDakYsTUFBTWEsV0FBVyxJQUFJLENBQUNDLGVBQWUsQ0FBQ2hCO1FBQ3RDLE1BQU1pQixjQUFjRixRQUFRLENBQUMsRUFBRSxJQUFJO1FBQ25DLE1BQU1HLGtCQUFrQkgsU0FBU0ksS0FBSyxDQUFDLEdBQUc7UUFFMUMsSUFBSUMsUUFBUSxDQUFDOztJQUViLEVBQUUsSUFBSSxDQUFDQyxVQUFVLENBQUNKLGFBQWEsSUFBSTs7OztpQkFJdEIsQ0FBQztRQUVkQyxnQkFBZ0JJLE9BQU8sQ0FBQyxDQUFDQyxTQUFTQztZQUNoQyxJQUFJQSxRQUFRLEdBQUc7Z0JBQ2JKLFNBQVMsQ0FBQzs7RUFFaEIsRUFBRSxJQUFJLENBQUNDLFVBQVUsQ0FBQ0UsU0FBUyxJQUFJO29DQUNHLENBQUM7WUFDL0I7UUFDRjtRQUVBLElBQUlMLGdCQUFnQk8sTUFBTSxHQUFHLEdBQUc7WUFDOUJMLFNBQVMsQ0FBQzs7dUJBRU8sQ0FBQztZQUNsQkYsZ0JBQWdCQyxLQUFLLENBQUMsR0FBRyxHQUFHRyxPQUFPLENBQUNDLENBQUFBO2dCQUNsQ0gsU0FBUyxDQUFDO0VBQ2hCLEVBQUUsSUFBSSxDQUFDQyxVQUFVLENBQUNFLFNBQVMsR0FBRyxjQUFjLENBQUM7WUFDekM7WUFDQUgsU0FBUyxDQUFDO3VCQUNPLENBQUM7UUFDcEI7UUFFQSxPQUFPO1lBQ0xuQixJQUFJO1lBQ0ptQixPQUFPQTtZQUNQTSxhQUFhLENBQUMsaURBQWlELEVBQUVULFlBQVkseUJBQXlCLENBQUM7WUFDdkdVLFVBQVVaLFNBQVNhLEdBQUcsQ0FBQyxDQUFDTCxTQUFTQyxRQUFXO29CQUMxQ0ssSUFBSSxDQUFDLFFBQVEsRUFBRUwsT0FBTztvQkFDdEJ2QixJQUFJO29CQUNKNkIsT0FBT1A7b0JBQ1B2QixTQUFTLENBQUMsVUFBVSxFQUFFdUIsU0FBUztvQkFDL0JRLGFBQWFQLFVBQVUsSUFBSU4sa0JBQWtCO3dCQUFDRDtxQkFBWTtnQkFDNUQ7WUFDQWUsY0FBYztnQkFDWjtnQkFDQTtnQkFDQTthQUNEO1FBQ0g7SUFDRjtJQUVBOztHQUVDLEdBQ0QsT0FBTzVCLGtCQUFrQkosT0FBZSxFQUF3QjtRQUM5RCxNQUFNaUMsUUFBUSxJQUFJLENBQUNDLFlBQVksQ0FBQ2xDO1FBRWhDLElBQUlvQixRQUFRLENBQUMscUVBQXFFLENBQUM7UUFFbkZhLE1BQU1YLE9BQU8sQ0FBQyxDQUFDYSxNQUFNWDtZQUNuQixNQUFNWSxXQUFXLElBQUksQ0FBQ0MsWUFBWSxDQUFDRixNQUFNO1lBQ3pDZixTQUFTLENBQUM7O0VBRWQsRUFBRSxJQUFJLENBQUNDLFVBQVUsQ0FBQ2UsVUFBVSxJQUFJOzs7V0FHdkIsQ0FBQztRQUNSO1FBRUFoQixTQUFTLENBQUM7OztlQUdDLENBQUM7UUFFWixPQUFPO1lBQ0xuQixJQUFJO1lBQ0ptQixPQUFPQTtZQUNQTSxhQUFhLENBQUMsOEJBQThCLEVBQUVPLE1BQU1SLE1BQU0sQ0FBQyxrQkFBa0IsQ0FBQztZQUM5RUUsVUFBVU0sTUFBTUwsR0FBRyxDQUFDLENBQUNPLE1BQU1YLFFBQVc7b0JBQ3BDSyxJQUFJLENBQUMsS0FBSyxFQUFFTCxPQUFPO29CQUNuQnZCLElBQUk7b0JBQ0o2QixPQUFPLENBQUMsS0FBSyxFQUFFTixRQUFRLEdBQUc7b0JBQzFCeEIsU0FBU21DO29CQUNUSixhQUFhUCxRQUFRUyxNQUFNUixNQUFNLEdBQUcsSUFBSTt3QkFBQyxDQUFDLEtBQUssRUFBRUQsUUFBUSxHQUFHO3FCQUFDLEdBQUcsRUFBRTtnQkFDcEU7WUFDQVEsY0FBYztnQkFDWjtnQkFDQTtnQkFDQTthQUNEO1FBQ0g7SUFDRjtJQUVBOztHQUVDLEdBQ0QsT0FBTzNCLGtCQUFrQkwsT0FBZSxFQUF3QjtRQUM5RCxNQUFNc0MsaUJBQWlCLElBQUksQ0FBQ0MsZ0JBQWdCLENBQUN2QztRQUM3QyxNQUFNd0MsT0FBT0YsY0FBYyxDQUFDLEVBQUUsSUFBSTtRQUNsQyxNQUFNRyxXQUFXSCxlQUFlbkIsS0FBSyxDQUFDLEdBQUc7UUFDekMsTUFBTXVCLGdCQUFnQkosZUFBZW5CLEtBQUssQ0FBQyxHQUFHO1FBRTlDLElBQUlDLFFBQVEsQ0FBQzs7c0JBRUssRUFBRSxJQUFJLENBQUNDLFVBQVUsQ0FBQ21CLE1BQU0sSUFBSTs7OzRDQUdOLENBQUM7UUFFekNDLFNBQVNuQixPQUFPLENBQUMsQ0FBQ3FCLE9BQU9uQjtZQUN2QixNQUFNb0IsVUFBVXBCLFVBQVUsSUFBSSxVQUFVQSxVQUFVLElBQUksZ0JBQWdCO1lBQ3RFSixTQUFTLENBQUM7dUJBQ08sRUFBRXdCLFFBQVE7VUFDdkIsRUFBRSxJQUFJLENBQUN2QixVQUFVLENBQUNzQixPQUFPLElBQUksRUFBRSxFQUFFQyxRQUFRO3VCQUM1QixFQUFFQSxRQUFRLGVBQWUsQ0FBQztRQUM3QztRQUVBLElBQUlGLGNBQWNqQixNQUFNLEdBQUcsR0FBRztZQUM1QkwsU0FBUyxDQUFDOzsyQ0FFMkIsQ0FBQztZQUN0Q3NCLGNBQWN2QixLQUFLLENBQUMsR0FBRyxHQUFHRyxPQUFPLENBQUN1QixDQUFBQTtnQkFDaEN6QixTQUFTLENBQUM7VUFDUixFQUFFLElBQUksQ0FBQ0MsVUFBVSxDQUFDd0IsTUFBTSxHQUFHLHdCQUF3QixDQUFDO1lBQ3hEO1lBQ0F6QixTQUFTLENBQUM7MkNBQzJCLENBQUM7UUFDeEM7UUFFQSxPQUFPO1lBQ0xuQixJQUFJO1lBQ0ptQixPQUFPQTtZQUNQTSxhQUFhLENBQUMsdUNBQXVDLEVBQUVjLEtBQUssS0FBSyxFQUFFQyxTQUFTaEIsTUFBTSxDQUFDLFFBQVEsQ0FBQztZQUM1RkUsVUFBVVcsZUFBZVYsR0FBRyxDQUFDLENBQUNpQixNQUFNckIsUUFBVztvQkFDN0NLLElBQUksQ0FBQyxVQUFVLEVBQUVMLE9BQU87b0JBQ3hCdkIsSUFBSTtvQkFDSjZCLE9BQU9lO29CQUNQN0MsU0FBUyxDQUFDLHVCQUF1QixFQUFFNkMsTUFBTTtvQkFDekNkLGFBQWFQLFVBQVUsSUFBSWlCLFdBQVcsRUFBRTtnQkFDMUM7WUFDQVQsY0FBYztnQkFDWjtnQkFDQTtnQkFDQTthQUNEO1FBQ0g7SUFDRjtJQUVBOztHQUVDLEdBQ0QsT0FBTzFCLGlCQUFpQk4sT0FBZSxFQUF3QjtRQUM3RCxNQUFNOEMsYUFBYSxJQUFJLENBQUNDLHFCQUFxQixDQUFDL0M7UUFFOUMsSUFBSW9CLFFBQVEsQ0FBQywrR0FBK0csQ0FBQztRQUU3SDBCLFdBQVd4QixPQUFPLENBQUMsQ0FBQzBCLE9BQU94QjtZQUN6QixNQUFNeUIsWUFBWSxJQUFJLENBQUNaLFlBQVksQ0FBQ1csTUFBTUEsS0FBSyxFQUFFO1lBQ2pELE1BQU1FLFdBQVdGLE1BQU1HLElBQUksSUFBSSxDQUFDLENBQUMsRUFBRTNCLFFBQVEsR0FBRztZQUU5QyxJQUFJQSxRQUFRLE1BQU0sR0FBRztnQkFDbkIsdUJBQXVCO2dCQUN2QkosU0FBUyxDQUFDLDJCQUEyQixFQUFFLElBQUksQ0FBQ0MsVUFBVSxDQUFDNEIsV0FBVyxJQUFJLDJDQUEyQyxDQUFDO2dCQUNsSDdCLFNBQVMsQ0FBQyw4R0FBOEcsQ0FBQztnQkFDekhBLFNBQVMsQ0FBQyxXQUFXLEVBQUU4QixTQUFTLElBQUksQ0FBQztZQUN2QyxPQUFPO2dCQUNMLHVCQUF1QjtnQkFDdkI5QixTQUFTLENBQUMsdURBQXVELEVBQUUsSUFBSSxDQUFDQyxVQUFVLENBQUM0QixXQUFXLElBQUksNkJBQTZCLENBQUM7WUFDbEk7UUFDRjtRQUVBLE9BQU87WUFDTGhELElBQUk7WUFDSm1CLE9BQU9BO1lBQ1BNLGFBQWEsQ0FBQyxvQkFBb0IsRUFBRW9CLFdBQVdyQixNQUFNLENBQUMscUJBQXFCLENBQUM7WUFDNUVFLFVBQVVtQixXQUFXbEIsR0FBRyxDQUFDLENBQUNvQixPQUFPeEIsUUFBVztvQkFDMUNLLElBQUksQ0FBQyxNQUFNLEVBQUVMLE9BQU87b0JBQ3BCdkIsSUFBSTtvQkFDSjZCLE9BQU9rQixNQUFNRyxJQUFJLElBQUksQ0FBQyxPQUFPLEVBQUUzQixRQUFRLEdBQUc7b0JBQzFDeEIsU0FBU2dELE1BQU1BLEtBQUs7b0JBQ3BCakIsYUFBYSxFQUFFO2dCQUNqQjtZQUNBQyxjQUFjO2dCQUNaO2dCQUNBO2dCQUNBO2FBQ0Q7UUFDSDtJQUNGO0lBRUE7O0dBRUMsR0FDRCxPQUFPekIsNkJBQTZCUCxPQUFlLEVBQXdCO1FBQ3pFLE1BQU1vRCxVQUFVLElBQUksQ0FBQ0MsY0FBYyxDQUFDckQ7UUFDcEMsTUFBTXNELFlBQVksSUFBSSxDQUFDQyxnQkFBZ0IsQ0FBQ3ZEO1FBRXhDLElBQUlvQixRQUFRLENBQUM7Ozs7O1VBS1AsRUFBRSxJQUFJLENBQUNDLFVBQVUsQ0FBQytCLFNBQVMsSUFBSTs7O3FDQUdKLENBQUM7UUFFbENFLFVBQVVoQyxPQUFPLENBQUNrQyxDQUFBQTtZQUNoQnBDLFNBQVMsQ0FBQztHQUNiLEVBQUVvQyxTQUFTQyxNQUFNLENBQUMsR0FBRyxFQUFFLElBQUksQ0FBQ3BCLFlBQVksQ0FBQ21CLFNBQVM5QixXQUFXLEVBQUUsSUFBSSxLQUFLLENBQUM7UUFDeEU7UUFFQU4sU0FBUyxDQUFDOzs7Ozs7U0FNTCxFQUFFZ0MsUUFBUTs7O01BR2IsRUFBRUUsU0FBUyxDQUFDLEVBQUUsRUFBRUcsVUFBVSxJQUFJLFVBQVUsQ0FBQztRQUUzQyxPQUFPO1lBQ0x4RCxJQUFJO1lBQ0ptQixPQUFPQTtZQUNQTSxhQUFhLENBQUMsNEJBQTRCLEVBQUUwQixRQUFRLEtBQUssRUFBRUUsVUFBVTdCLE1BQU0sQ0FBQyxVQUFVLENBQUM7WUFDdkZFLFVBQVU7Z0JBQUM7b0JBQ1RFLElBQUk7b0JBQ0o1QixJQUFJO29CQUNKNkIsT0FBTztvQkFDUDlCLFNBQVNvRDtvQkFDVHJCLGFBQWF1QixVQUFVMUIsR0FBRyxDQUFDLENBQUM4QixHQUFHbEMsUUFBVSxDQUFDLElBQUksRUFBRUEsT0FBTztnQkFDekQ7YUFBRSxDQUFDbUMsTUFBTSxDQUFDTCxVQUFVMUIsR0FBRyxDQUFDLENBQUM0QixVQUFVaEMsUUFBVztvQkFDNUNLLElBQUksQ0FBQyxJQUFJLEVBQUVMLE9BQU87b0JBQ2xCdkIsSUFBSTtvQkFDSjZCLE9BQU8wQixTQUFTQyxNQUFNO29CQUN0QnpELFNBQVN3RCxTQUFTOUIsV0FBVztvQkFDN0JLLGFBQWEsRUFBRTtnQkFDakI7WUFDQUMsY0FBYztnQkFDWjtnQkFDQTtnQkFDQTthQUNEO1FBQ0g7SUFDRjtJQUVBOztHQUVDLEdBQ0QsT0FBT3hCLDBCQUEwQlIsT0FBZSxFQUF3QjtRQUN0RSxNQUFNNEQsV0FBVyxJQUFJLENBQUNDLGVBQWUsQ0FBQzdEO1FBQ3RDLE1BQU04RCxRQUFRLElBQUksQ0FBQ0MsWUFBWSxDQUFDL0Q7UUFFaEMsSUFBSW9CLFFBQVE7UUFFWixtQ0FBbUM7UUFDbkMsSUFBSXdDLFNBQVMvQyxXQUFXLEdBQUdtRCxRQUFRLENBQUMsVUFBVUosU0FBUy9DLFdBQVcsR0FBR21ELFFBQVEsQ0FBQyxTQUFTO1lBQ3JGNUMsUUFBUSxDQUFDOzs7Ozs7Ozs7Ozs7Ozs7NEJBZWEsQ0FBQztRQUN6QixPQUFPLElBQUl3QyxTQUFTL0MsV0FBVyxHQUFHbUQsUUFBUSxDQUFDLFFBQVE7WUFDakQ1QyxRQUFRLENBQUM7Ozs7Ozs7O21CQVFJLENBQUM7UUFDaEIsT0FBTyxJQUFJd0MsU0FBUy9DLFdBQVcsR0FBR21ELFFBQVEsQ0FBQyxVQUFVSixTQUFTL0MsV0FBVyxHQUFHbUQsUUFBUSxDQUFDLFdBQVc7WUFDOUY1QyxRQUFRLENBQUM7Ozs7Ozs7Ozs7NEJBVWEsQ0FBQztRQUN6QixPQUFPO1lBQ0xBLFFBQVEsQ0FBQzs7O1FBR1AsRUFBRXdDLFNBQVM7OztRQUdYLEVBQUVFLE1BQU1sQyxHQUFHLENBQUNxQyxDQUFBQSxPQUFRLENBQUMsRUFBRSxFQUFFQSxNQUFNLEVBQUVDLElBQUksQ0FBQyxjQUFjOzs7O2tDQUkxQixDQUFDO1FBQy9CO1FBRUEsT0FBTztZQUNMakUsSUFBSTtZQUNKbUIsT0FBT0E7WUFDUE0sYUFBYSxDQUFDLHNCQUFzQixFQUFFa0MsU0FBUyxXQUFXLEVBQUVFLE1BQU1yQyxNQUFNLENBQUMsZ0JBQWdCLENBQUM7WUFDMUZFLFVBQVU7Z0JBQUM7b0JBQ1RFLElBQUk7b0JBQ0o1QixJQUFJO29CQUNKNkIsT0FBTzhCO29CQUNQNUQsU0FBUyxDQUFDLFVBQVUsRUFBRTRELFVBQVU7b0JBQ2hDN0IsYUFBYStCLE1BQU1sQyxHQUFHLENBQUMsQ0FBQzhCLEdBQUdsQyxRQUFVLENBQUMsS0FBSyxFQUFFQSxPQUFPO2dCQUN0RDthQUFFLENBQUNtQyxNQUFNLENBQUNHLE1BQU1sQyxHQUFHLENBQUMsQ0FBQ3FDLE1BQU16QyxRQUFXO29CQUNwQ0ssSUFBSSxDQUFDLEtBQUssRUFBRUwsT0FBTztvQkFDbkJ2QixJQUFJO29CQUNKNkIsT0FBT21DO29CQUNQakUsU0FBUyxDQUFDLE9BQU8sRUFBRWlFLE1BQU07b0JBQ3pCbEMsYUFBYSxFQUFFO2dCQUNqQjtZQUNBQyxjQUFjO2dCQUNaO2dCQUNBO2dCQUNBO2FBQ0Q7UUFDSDtJQUNGO0lBRUE7O0dBRUMsR0FDRCxPQUFPdkIsb0JBQW9CVCxPQUFlLEVBQXdCO1FBQ2hFLE1BQU1tRSxZQUFZLElBQUksQ0FBQ0MsZ0JBQWdCLENBQUNwRTtRQUV4QyxJQUFJb0IsUUFBUSxDQUFDOzs7bUJBR0UsQ0FBQztRQUVoQitDLFVBQVU3QyxPQUFPLENBQUMsQ0FBQytDLFNBQVM3QztZQUMxQixNQUFNOEMsY0FBYyxJQUFJLENBQUNqQyxZQUFZLENBQUNnQyxTQUFTO1lBQy9DLElBQUk3QyxVQUFVLEdBQUc7Z0JBQ2ZKLFNBQVMsQ0FBQztRQUNWLEVBQUUsSUFBSSxDQUFDQyxVQUFVLENBQUNpRCxhQUFhLEdBQUc7OztXQUcvQixDQUFDO1lBQ04sT0FBTztnQkFDTGxELFNBQVMsQ0FBQzs7UUFFVixFQUFFLElBQUksQ0FBQ0MsVUFBVSxDQUFDaUQsYUFBYSxHQUFHOzs7V0FHL0IsQ0FBQztZQUNOO1FBQ0Y7UUFFQWxELFNBQVMsQ0FBQzs7O21CQUdLLENBQUM7UUFFaEIsT0FBTztZQUNMbkIsSUFBSTtZQUNKbUIsT0FBT0E7WUFDUE0sYUFBYSxDQUFDLHFCQUFxQixFQUFFeUMsVUFBVTFDLE1BQU0sQ0FBQyxvQkFBb0IsQ0FBQztZQUMzRUUsVUFBVXdDLFVBQVV2QyxHQUFHLENBQUMsQ0FBQ3lDLFNBQVM3QyxRQUFXO29CQUMzQ0ssSUFBSSxDQUFDLFFBQVEsRUFBRUwsT0FBTztvQkFDdEJ2QixJQUFJO29CQUNKNkIsT0FBTyxDQUFDLFFBQVEsRUFBRU4sUUFBUSxHQUFHO29CQUM3QnhCLFNBQVNxRTtvQkFDVHRDLGFBQWFQLFFBQVEyQyxVQUFVMUMsTUFBTSxHQUFHLElBQUk7d0JBQUMsQ0FBQyxRQUFRLEVBQUVELFFBQVEsR0FBRztxQkFBQyxHQUFHLEVBQUU7Z0JBQzNFO1lBQ0FRLGNBQWM7Z0JBQ1o7Z0JBQ0E7Z0JBQ0E7YUFDRDtRQUNIO0lBQ0Y7SUFFQTs7R0FFQyxHQUNELE9BQU90Qix1QkFBdUJWLE9BQWUsRUFBd0I7UUFDbkUsTUFBTXVFLFlBQVksSUFBSSxDQUFDQyxnQkFBZ0IsQ0FBQ3hFLFNBQVM7UUFFakQsSUFBSW9CLFFBQVEsQ0FBQzs7OzttQkFJRSxDQUFDO1FBRWhCbUQsVUFBVWpELE9BQU8sQ0FBQyxDQUFDbUQsT0FBT2pEO1lBQ3hCLE1BQU1rRCxZQUFZLElBQUksQ0FBQ3JDLFlBQVksQ0FBQ29DLE9BQU87WUFDM0NyRCxTQUFTLENBQUM7OztNQUdWLEVBQUVJLFFBQVEsRUFBRSxFQUFFLEVBQUUsSUFBSSxDQUFDbUQsU0FBUyxDQUFDRCxXQUFXLElBQUk7bUNBQ2pCLENBQUM7UUFDaEM7UUFFQSxPQUFPO1lBQ0x6RSxJQUFJO1lBQ0ptQixPQUFPQTtZQUNQTSxhQUFhLENBQUMscUJBQXFCLEVBQUU2QyxVQUFVOUMsTUFBTSxDQUFDLHNCQUFzQixDQUFDO1lBQzdFRSxVQUFVNEMsVUFBVTNDLEdBQUcsQ0FBQyxDQUFDNkMsT0FBT2pELFFBQVc7b0JBQ3pDSyxJQUFJLENBQUMsTUFBTSxFQUFFTCxPQUFPO29CQUNwQnZCLElBQUk7b0JBQ0o2QixPQUFPLENBQUMsTUFBTSxFQUFFTixRQUFRLEdBQUc7b0JBQzNCeEIsU0FBU3lFO29CQUNUMUMsYUFBYSxFQUFFO2dCQUNqQjtZQUNBQyxjQUFjO2dCQUNaO2dCQUNBO2dCQUNBO2FBQ0Q7UUFDSDtJQUNGO0lBRUEsZ0NBQWdDO0lBRWhDOztHQUVDLEdBQ0QsT0FBZWhCLGdCQUFnQmhCLE9BQWUsRUFBWTtRQUN4RCxNQUFNNEUsWUFBWTVFLFFBQVE2RSxLQUFLLENBQUM7UUFDaEMsTUFBTTlELFdBQXFCLEVBQUU7UUFFN0IsS0FBSyxNQUFNK0QsWUFBWUYsVUFBVztZQUNoQyxNQUFNRyxRQUFRRCxTQUFTRSxJQUFJLEdBQUdILEtBQUssQ0FBQztZQUNwQyxNQUFNSSxpQkFBaUJGLE1BQU1HLE1BQU0sQ0FBQ0MsQ0FBQUEsT0FDbENBLEtBQUsxRCxNQUFNLEdBQUcsS0FDZCxDQUFDO29CQUFDO29CQUFRO29CQUFRO29CQUFTO29CQUFTO29CQUFVO29CQUFTO2lCQUFTLENBQUN1QyxRQUFRLENBQUNtQixLQUFLdEUsV0FBVztZQUc1RixJQUFJb0UsZUFBZXhELE1BQU0sR0FBRyxHQUFHO2dCQUM3QlYsU0FBU3FFLElBQUksQ0FBQ0gsY0FBYyxDQUFDLEVBQUU7WUFDakM7WUFFQSxJQUFJbEUsU0FBU1UsTUFBTSxJQUFJLEdBQUc7UUFDNUI7UUFFQSxPQUFPVixTQUFTVSxNQUFNLEdBQUcsSUFBSVYsV0FBVztZQUFDO1NBQXFCO0lBQ2hFO0lBRUE7O0dBRUMsR0FDRCxPQUFlbUIsYUFBYWxDLE9BQWUsRUFBWTtRQUNyRCxtREFBbUQ7UUFDbkQsTUFBTXFGLGVBQWU7WUFDbkI7WUFDQTtZQUNBO1NBQ0Q7UUFFRCxNQUFNcEQsUUFBa0IsRUFBRTtRQUUxQixLQUFLLE1BQU1xRCxXQUFXRCxhQUFjO1lBQ2xDLElBQUlFO1lBQ0osTUFBTyxDQUFDQSxRQUFRRCxRQUFRRSxJQUFJLENBQUN4RixRQUFPLE1BQU8sUUFBUWlDLE1BQU1SLE1BQU0sR0FBRyxFQUFHO2dCQUNuRSxNQUFNVSxPQUFPb0QsS0FBSyxDQUFDLEVBQUUsSUFBSUEsS0FBSyxDQUFDLEVBQUU7Z0JBQ2pDLElBQUlwRCxRQUFRQSxLQUFLNkMsSUFBSSxHQUFHdkQsTUFBTSxHQUFHLEdBQUc7b0JBQ2xDUSxNQUFNbUQsSUFBSSxDQUFDakQsS0FBSzZDLElBQUk7Z0JBQ3RCO1lBQ0Y7UUFDRjtRQUVBLElBQUkvQyxNQUFNUixNQUFNLEtBQUssR0FBRztZQUN0QiwrQkFBK0I7WUFDL0IsTUFBTW1ELFlBQVk1RSxRQUFRNkUsS0FBSyxDQUFDO1lBQ2hDNUMsTUFBTW1ELElBQUksSUFBSVIsVUFBVXpELEtBQUssQ0FBQyxHQUFHLEdBQUcrRCxNQUFNLENBQUNPLENBQUFBLElBQUtBLEVBQUVULElBQUksR0FBR3ZELE1BQU0sR0FBRztRQUNwRTtRQUVBLE9BQU9RLE1BQU1kLEtBQUssQ0FBQyxHQUFHO0lBQ3hCO0lBRUE7O0dBRUMsR0FDRCxPQUFlb0IsaUJBQWlCdkMsT0FBZSxFQUFZO1FBQ3pELE1BQU0wRixpQkFBaUI7WUFBQztZQUFhO1lBQWM7WUFBUTtZQUFhO1lBQVM7U0FBUTtRQUN6RixNQUFNQyxRQUFrQixFQUFFO1FBQzFCLE1BQU1mLFlBQVk1RSxRQUFRNkUsS0FBSyxDQUFDO1FBRWhDLEtBQUssTUFBTUMsWUFBWUYsVUFBVztZQUNoQyxLQUFLLE1BQU1PLFFBQVFPLGVBQWdCO2dCQUNqQyxJQUFJWixTQUFTakUsV0FBVyxHQUFHbUQsUUFBUSxDQUFDbUIsT0FBTztvQkFDekMsTUFBTVMsZ0JBQWdCZCxTQUFTZSxPQUFPLENBQUMsa0JBQWtCLElBQUliLElBQUk7b0JBQ2pFLElBQUlZLGNBQWNuRSxNQUFNLEdBQUcsR0FBRzt3QkFDNUJrRSxNQUFNUCxJQUFJLENBQUNRO3dCQUNYO29CQUNGO2dCQUNGO1lBQ0Y7WUFDQSxJQUFJRCxNQUFNbEUsTUFBTSxJQUFJLEdBQUc7UUFDekI7UUFFQSxPQUFPa0UsTUFBTWxFLE1BQU0sR0FBRyxJQUFJa0UsUUFBUTtZQUFDO1lBQXNCO1lBQWlCO1NBQWdCO0lBQzVGO0lBRUE7O0dBRUMsR0FDRCxPQUFlNUMsc0JBQXNCL0MsT0FBZSxFQUF3QztRQUMxRixNQUFNOEYsY0FBYztRQUNwQixNQUFNQyxTQUErQyxFQUFFO1FBQ3ZELE1BQU1uQixZQUFZNUUsUUFBUTZFLEtBQUssQ0FBQztRQUVoQyxLQUFLLE1BQU1DLFlBQVlGLFVBQVc7WUFDaEMsTUFBTW9CLFlBQVlsQixTQUFTUyxLQUFLLENBQUNPO1lBQ2pDLElBQUlFLFdBQVc7Z0JBQ2JELE9BQU9YLElBQUksQ0FBQztvQkFDVmpDLE1BQU02QyxTQUFTLENBQUMsRUFBRTtvQkFDbEJoRCxPQUFPOEIsU0FBU2UsT0FBTyxDQUFDQyxhQUFhLElBQUlkLElBQUk7Z0JBQy9DO1lBQ0Y7UUFDRjtRQUVBLElBQUllLE9BQU90RSxNQUFNLEtBQUssR0FBRztZQUN2QixvQkFBb0I7WUFDcEIsTUFBTXdFLFlBQVlyQixVQUFVekQsS0FBSyxDQUFDLEdBQUcsR0FBRytELE1BQU0sQ0FBQ08sQ0FBQUEsSUFBS0EsRUFBRVQsSUFBSSxHQUFHdkQsTUFBTSxHQUFHO1lBQ3RFd0UsVUFBVTNFLE9BQU8sQ0FBQyxDQUFDMEIsT0FBT3hCO2dCQUN4QnVFLE9BQU9YLElBQUksQ0FBQztvQkFDVmpDLE1BQU0sQ0FBQyxDQUFDLEVBQUUzQixRQUFRLEdBQUc7b0JBQ3JCd0IsT0FBT0EsTUFBTWdDLElBQUk7Z0JBQ25CO1lBQ0Y7UUFDRjtRQUVBLE9BQU9lLE9BQU81RSxLQUFLLENBQUMsR0FBRztJQUN6QjtJQUVBOztHQUVDLEdBQ0QsT0FBZWtDLGVBQWVyRCxPQUFlLEVBQVU7UUFDckQsb0NBQW9DO1FBQ3BDLE1BQU1rRyxrQkFBa0I7WUFDdEI7WUFDQTtZQUNBO1lBQ0E7U0FDRDtRQUVELEtBQUssTUFBTVosV0FBV1ksZ0JBQWlCO1lBQ3JDLE1BQU1YLFFBQVF2RixRQUFRdUYsS0FBSyxDQUFDRDtZQUM1QixJQUFJQyxPQUFPO2dCQUNULE9BQU9BLEtBQUssQ0FBQyxFQUFFLENBQUNQLElBQUk7WUFDdEI7UUFDRjtRQUVBLFdBQVc7UUFDWCxJQUFJaEYsUUFBUWdFLFFBQVEsQ0FBQyxNQUFNO1lBQ3pCLE1BQU1tQyxRQUFRbkcsUUFBUTZFLEtBQUssQ0FBQztZQUM1QixJQUFJc0IsTUFBTTFFLE1BQU0sSUFBSSxHQUFHO2dCQUNyQixPQUFPLEdBQUcwRSxLQUFLLENBQUMsRUFBRSxDQUFDbkIsSUFBSSxHQUFHLEdBQUcsRUFBRW1CLEtBQUssQ0FBQyxFQUFFLENBQUN0QixLQUFLLENBQUMsUUFBUSxDQUFDLEVBQUUsQ0FBQ0csSUFBSSxJQUFJO1lBQ3BFO1FBQ0Y7UUFFQSxPQUFPO0lBQ1Q7SUFFQTs7R0FFQyxHQUNELE9BQWV6QixpQkFBaUJ2RCxPQUFlLEVBQWdEO1FBQzdGLE1BQU1zRCxZQUEwRCxFQUFFO1FBRWxFLHFEQUFxRDtRQUNyRCxNQUFNOEMsYUFBYTtRQUNuQixJQUFJYjtRQUVKLE1BQU8sQ0FBQ0EsUUFBUWEsV0FBV1osSUFBSSxDQUFDeEYsUUFBTyxNQUFPLFFBQVFzRCxVQUFVN0IsTUFBTSxHQUFHLEVBQUc7WUFDMUU2QixVQUFVOEIsSUFBSSxDQUFDO2dCQUNiM0IsUUFBUThCLEtBQUssQ0FBQyxFQUFFO2dCQUNoQjdELGFBQWE2RCxLQUFLLENBQUMsRUFBRSxDQUFDUCxJQUFJO1lBQzVCO1FBQ0Y7UUFFQSxJQUFJMUIsVUFBVTdCLE1BQU0sS0FBSyxHQUFHO1lBQzFCNkIsVUFBVThCLElBQUksQ0FDWjtnQkFBRTNCLFFBQVE7Z0JBQUsvQixhQUFhO1lBQXlCLEdBQ3JEO2dCQUFFK0IsUUFBUTtnQkFBSy9CLGFBQWE7WUFBdUI7UUFFdkQ7UUFFQSxPQUFPNEI7SUFDVDtJQUVBOztHQUVDLEdBQ0QsT0FBZU8sZ0JBQWdCN0QsT0FBZSxFQUFVO1FBQ3RELE1BQU1xRyxtQkFBbUI7WUFDdkI7WUFDQTtTQUNEO1FBRUQsS0FBSyxNQUFNZixXQUFXZSxpQkFBa0I7WUFDdEMsTUFBTWQsUUFBUXZGLFFBQVF1RixLQUFLLENBQUNEO1lBQzVCLElBQUlDLE9BQU87Z0JBQ1QsT0FBT0EsS0FBSyxDQUFDLEVBQUU7WUFDakI7UUFDRjtRQUVBLE9BQU87SUFDVDtJQUVBOztHQUVDLEdBQ0QsT0FBZXhCLGFBQWEvRCxPQUFlLEVBQVk7UUFDckQsTUFBTXNHLGNBQWN0RyxRQUFRdUYsS0FBSyxDQUFDLG1CQUFtQixFQUFFO1FBQ3ZELE1BQU1nQixjQUFjO2VBQUksSUFBSUMsSUFBSUY7U0FBYTtRQUU3QyxJQUFJQyxZQUFZOUUsTUFBTSxLQUFLLEdBQUc7WUFDNUIsT0FBTztnQkFBQztnQkFBSztnQkFBSzthQUFJO1FBQ3hCO1FBRUEsT0FBTzhFLFlBQVlwRixLQUFLLENBQUMsR0FBRztJQUM5QjtJQUVBOztHQUVDLEdBQ0QsT0FBZWlELGlCQUFpQnBFLE9BQWUsRUFBWTtRQUN6RCxNQUFNbUUsWUFBWSxJQUFJLENBQUNqQyxZQUFZLENBQUNsQztRQUNwQyxPQUFPbUUsVUFBVTFDLE1BQU0sR0FBRyxJQUFJMEMsWUFBWTtZQUFDO1lBQWE7WUFBYTtTQUFZO0lBQ25GO0lBRUE7O0dBRUMsR0FDRCxPQUFlSyxpQkFBaUJ4RSxPQUFlLEVBQUV5RyxRQUFnQixDQUFDLEVBQVk7UUFDNUUsTUFBTTdCLFlBQVk1RSxRQUFRNkUsS0FBSyxDQUFDO1FBQ2hDLE9BQU9ELFVBQ0pNLE1BQU0sQ0FBQ08sQ0FBQUEsSUFBS0EsRUFBRVQsSUFBSSxHQUFHdkQsTUFBTSxHQUFHLElBQzlCTixLQUFLLENBQUMsR0FBR3NGLE9BQ1Q3RSxHQUFHLENBQUM2RCxDQUFBQSxJQUFLQSxFQUFFVCxJQUFJO0lBQ3BCO0lBRUEsd0NBQXdDO0lBRXhDOztHQUVDLEdBQ0QsT0FBZTNELFdBQVdxRixJQUFZLEVBQUVDLEtBQWEsRUFBVTtRQUM3RCxNQUFNQyxZQUFZLElBQUksQ0FBQ3ZFLFlBQVksQ0FBQ3FFLE1BQU1DO1FBQzFDLE1BQU1FLFVBQVVDLEtBQUtDLEdBQUcsQ0FBQyxHQUFHSixRQUFRQyxVQUFVbkYsTUFBTTtRQUNwRCxNQUFNdUYsVUFBVUYsS0FBS0csS0FBSyxDQUFDSixVQUFVO1FBQ3JDLE1BQU1LLFdBQVdMLFVBQVVHO1FBQzNCLE9BQU8sSUFBSUcsTUFBTSxDQUFDSCxXQUFXSixZQUFZLElBQUlPLE1BQU0sQ0FBQ0Q7SUFDdEQ7SUFFQTs7R0FFQyxHQUNELE9BQWV2QyxVQUFVK0IsSUFBWSxFQUFFQyxLQUFhLEVBQVU7UUFDNUQsTUFBTUMsWUFBWSxJQUFJLENBQUN2RSxZQUFZLENBQUNxRSxNQUFNQztRQUMxQyxNQUFNRSxVQUFVQyxLQUFLQyxHQUFHLENBQUMsR0FBR0osUUFBUUMsVUFBVW5GLE1BQU07UUFDcEQsT0FBT21GLFlBQVksSUFBSU8sTUFBTSxDQUFDTjtJQUNoQztJQUVBOztHQUVDLEdBQ0QsT0FBZXhFLGFBQWFxRSxJQUFZLEVBQUVVLFFBQWdCLEVBQVU7UUFDbEUsSUFBSVYsS0FBS2pGLE1BQU0sSUFBSTJGLFVBQVU7WUFDM0IsT0FBT1Y7UUFDVDtRQUNBLE9BQU9BLEtBQUtXLFNBQVMsQ0FBQyxHQUFHRCxXQUFXLEtBQUs7SUFDM0M7SUFFQTs7R0FFQyxHQUNELE9BQU9FLHNCQUFzQnRILE9BQWUsRUFBRUUsT0FBZ0IsRUFBd0I7UUFDcEYsTUFBTXFILGNBQWMsSUFBSSxDQUFDNUcsdUJBQXVCLENBQUNYLFNBQVNFO1FBQzFELE9BQU8sSUFBSSxDQUFDSCxjQUFjLENBQUNDLFNBQVN1SCxhQUFhckg7SUFDbkQ7SUFFQTs7R0FFQyxHQUNELE9BQU9zSCxzQkFBc0J4SCxPQUFlLEVBQUVFLE9BQWdCLEVBQTBCO1FBQ3RGLE1BQU11SCxjQUFjLElBQUksQ0FBQzlHLHVCQUF1QixDQUFDWCxTQUFTRTtRQUMxRCxNQUFNd0gsVUFBa0M7WUFDdEMsSUFBSSxDQUFDM0gsY0FBYyxDQUFDQyxTQUFTeUgsYUFBYXZIO1NBQzNDO1FBRUQsaUNBQWlDO1FBQ2pDLE1BQU15SCxtQkFBbUI7Ozs7U0FBa0U7UUFFM0YsS0FBSyxNQUFNMUgsUUFBUTBILGlCQUFrQjtZQUNuQyxJQUFJMUgsU0FBU3dILGVBQWVDLFFBQVFqRyxNQUFNLEdBQUcsR0FBRztnQkFDOUNpRyxRQUFRdEMsSUFBSSxDQUFDLElBQUksQ0FBQ3JGLGNBQWMsQ0FBQ0MsU0FBU0MsTUFBTUM7WUFDbEQ7UUFDRjtRQUVBLE9BQU93SDtJQUNUO0FBQ0YiLCJzb3VyY2VzIjpbIi9Vc2Vycy9yb2RyaWdvZGliZXJuYXJkbzMzZ21haWwuY29tL0RvY3VtZW50cy9BcHAgRGV2ZWxvcG1lbnQgUHJveWVjdHMvSW50ZWxsZWdvIFBsYXRmb3JtL3NyYy9saWIvdmlzdWFsLWxlYXJuaW5nLWVuZ2luZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBWaXN1YWwgTGVhcm5pbmcgRW5naW5lIGZvciBTYXJhIEFJXG4vLyBHZW5lcmF0ZXMgQVNDSUkgZGlhZ3JhbXMsIGNvbmNlcHR1YWwgbWFwcywgYW5kIHZpc3VhbCByZXByZXNlbnRhdGlvbnMgZm9yIGVuaGFuY2VkIGxlYXJuaW5nXG5cbmV4cG9ydCBlbnVtIFZpc3VhbFR5cGUge1xuICBDT05DRVBUX01BUCA9ICdjb25jZXB0X21hcCcsXG4gIEZMT1dDSEFSVCA9ICdmbG93Y2hhcnQnLFxuICBISUVSQVJDSFkgPSAnaGllcmFyY2h5JyxcbiAgVElNRUxJTkUgPSAndGltZWxpbmUnLFxuICBESUFHUkFNID0gJ2RpYWdyYW0nLFxuICBGT1JNVUxBX1ZJU1VBTElaQVRJT04gPSAnZm9ybXVsYV92aXN1YWxpemF0aW9uJyxcbiAgQ0hFTUlDQUxfU1RSVUNUVVJFID0gJ2NoZW1pY2FsX3N0cnVjdHVyZScsXG4gIE1BVEhfR1JBUEggPSAnbWF0aF9ncmFwaCcsXG4gIFBST0NFU1NfRkxPVyA9ICdwcm9jZXNzX2Zsb3cnXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgVmlzdWFsRWxlbWVudCB7XG4gIGlkOiBzdHJpbmdcbiAgdHlwZTogVmlzdWFsVHlwZVxuICB0aXRsZTogc3RyaW5nXG4gIGNvbnRlbnQ6IHN0cmluZ1xuICBjb25uZWN0aW9ucz86IHN0cmluZ1tdXG4gIG1ldGFkYXRhPzoge1xuICAgIHN1YmplY3Q/OiBzdHJpbmdcbiAgICBkaWZmaWN1bHR5PzogJ2Jhc2ljJyB8ICdpbnRlcm1lZGlhdGUnIHwgJ2FkdmFuY2VkJ1xuICAgIGtleXdvcmRzPzogc3RyaW5nW11cbiAgfVxufVxuXG5leHBvcnQgaW50ZXJmYWNlIFZpc3VhbFJlcHJlc2VudGF0aW9uIHtcbiAgdHlwZTogVmlzdWFsVHlwZVxuICBhc2NpaTogc3RyaW5nXG4gIGRlc2NyaXB0aW9uOiBzdHJpbmdcbiAgZWxlbWVudHM6IFZpc3VhbEVsZW1lbnRbXVxuICBpbnN0cnVjdGlvbnM6IHN0cmluZ1tdXG59XG5cbmV4cG9ydCBjbGFzcyBWaXN1YWxMZWFybmluZ0VuZ2luZSB7XG5cbiAgLyoqXG4gICAqIEdlbmVyYXRlcyB2aXN1YWwgcmVwcmVzZW50YXRpb24gYmFzZWQgb24gY29udGVudCBhbmQgdHlwZVxuICAgKi9cbiAgc3RhdGljIGdlbmVyYXRlVmlzdWFsKGNvbnRlbnQ6IHN0cmluZywgdHlwZTogVmlzdWFsVHlwZSwgc3ViamVjdD86IHN0cmluZyk6IFZpc3VhbFJlcHJlc2VudGF0aW9uIHtcbiAgICBzd2l0Y2ggKHR5cGUpIHtcbiAgICAgIGNhc2UgVmlzdWFsVHlwZS5DT05DRVBUX01BUDpcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2VuZXJhdGVDb25jZXB0TWFwKGNvbnRlbnQsIHN1YmplY3QpXG4gICAgICBjYXNlIFZpc3VhbFR5cGUuRkxPV0NIQVJUOlxuICAgICAgICByZXR1cm4gdGhpcy5nZW5lcmF0ZUZsb3djaGFydChjb250ZW50KVxuICAgICAgY2FzZSBWaXN1YWxUeXBlLkhJRVJBUkNIWTpcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2VuZXJhdGVIaWVyYXJjaHkoY29udGVudClcbiAgICAgIGNhc2UgVmlzdWFsVHlwZS5USU1FTElORTpcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2VuZXJhdGVUaW1lbGluZShjb250ZW50KVxuICAgICAgY2FzZSBWaXN1YWxUeXBlLkZPUk1VTEFfVklTVUFMSVpBVElPTjpcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2VuZXJhdGVGb3JtdWxhVmlzdWFsaXphdGlvbihjb250ZW50KVxuICAgICAgY2FzZSBWaXN1YWxUeXBlLkNIRU1JQ0FMX1NUUlVDVFVSRTpcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2VuZXJhdGVDaGVtaWNhbFN0cnVjdHVyZShjb250ZW50KVxuICAgICAgY2FzZSBWaXN1YWxUeXBlLlBST0NFU1NfRkxPVzpcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2VuZXJhdGVQcm9jZXNzRmxvdyhjb250ZW50KVxuICAgICAgZGVmYXVsdDpcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2VuZXJhdGVHZW5lcmljRGlhZ3JhbShjb250ZW50KVxuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBBdXRvLWRldGVjdHMgdGhlIGJlc3QgdmlzdWFsIHR5cGUgZm9yIGNvbnRlbnRcbiAgICovXG4gIHN0YXRpYyBkZXRlY3RPcHRpbWFsVmlzdWFsVHlwZShjb250ZW50OiBzdHJpbmcsIHN1YmplY3Q/OiBzdHJpbmcpOiBWaXN1YWxUeXBlIHtcbiAgICBjb25zdCBjb250ZW50TG93ZXIgPSBjb250ZW50LnRvTG93ZXJDYXNlKClcblxuICAgIC8vIENoZW1pY2FsIGZvcm11bGFzIGFuZCBzdHJ1Y3R1cmVzXG4gICAgaWYgKHN1YmplY3QgPT09ICdjaGVtaXN0cnknIHx8IHN1YmplY3QgPT09ICdxdcOtbWljYScgfHwgXG4gICAgICAgIC9oMm98Y28yfG5hY2x8Y2g0fGZvcm11bGF8bW9sZWN1bGFyfMOhdG9tb3xtb2zDqWN1bGEvLnRlc3QoY29udGVudExvd2VyKSkge1xuICAgICAgcmV0dXJuIFZpc3VhbFR5cGUuQ0hFTUlDQUxfU1RSVUNUVVJFXG4gICAgfVxuXG4gICAgLy8gTWF0aGVtYXRpY2FsIGZvcm11bGFzXG4gICAgaWYgKHN1YmplY3QgPT09ICdtYXRoZW1hdGljcycgfHwgc3ViamVjdCA9PT0gJ21hdGVtw6F0aWNhcycgfHwgXG4gICAgICAgIC9lY3VhY2nDs258Zm9ybXVsYXxmdW5jacOzbnxkZXJpdmFkYXxpbnRlZ3JhbHxncsOhZmljYS8udGVzdChjb250ZW50TG93ZXIpKSB7XG4gICAgICByZXR1cm4gVmlzdWFsVHlwZS5GT1JNVUxBX1ZJU1VBTElaQVRJT05cbiAgICB9XG5cbiAgICAvLyBQcm9jZXNzIG9yIHN0ZXAtYnktc3RlcCBjb250ZW50XG4gICAgaWYgKC9wYXNvfHN0ZXB8cHJvY2Vzb3xsdWVnb3xkZXNwdcOpc3xlbnRvbmNlc3xwcmltZXJvfHNlZ3VuZG8vLnRlc3QoY29udGVudExvd2VyKSkge1xuICAgICAgcmV0dXJuIFZpc3VhbFR5cGUuUFJPQ0VTU19GTE9XXG4gICAgfVxuXG4gICAgLy8gSGllcmFyY2hpY2FsIGNvbnRlbnRcbiAgICBpZiAoL2NsYXNpZmljYWNpw7NufGNhdGVnb3LDrWF8dGlwb3xuaXZlbHxqZXJhcnF1w61hfHN1cGVyaW9yfGluZmVyaW9yLy50ZXN0KGNvbnRlbnRMb3dlcikpIHtcbiAgICAgIHJldHVybiBWaXN1YWxUeXBlLkhJRVJBUkNIWVxuICAgIH1cblxuICAgIC8vIFRpbWVsaW5lIGNvbnRlbnRcbiAgICBpZiAoL2HDsW98ZmVjaGF8c2lnbG98w6lwb2NhfGFudGVzfGRlc3B1w6lzfGhpc3RvcmlhfGNyb25vbG9nw61hLy50ZXN0KGNvbnRlbnRMb3dlcikpIHtcbiAgICAgIHJldHVybiBWaXN1YWxUeXBlLlRJTUVMSU5FXG4gICAgfVxuXG4gICAgLy8gQ29uY2VwdHVhbCByZWxhdGlvbnNoaXBzXG4gICAgaWYgKC9yZWxhY2nDs258Y29uY2VwdG98aWRlYXxjb25lY3RhfHZpbmN1bGF8YXNvY2lhLy50ZXN0KGNvbnRlbnRMb3dlcikpIHtcbiAgICAgIHJldHVybiBWaXN1YWxUeXBlLkNPTkNFUFRfTUFQXG4gICAgfVxuXG4gICAgLy8gRGVmYXVsdCB0byBmbG93Y2hhcnQgZm9yIGdlbmVyYWwgY29udGVudFxuICAgIHJldHVybiBWaXN1YWxUeXBlLkZMT1dDSEFSVFxuICB9XG5cbiAgLyoqXG4gICAqIEdlbmVyYXRlcyBjb25jZXB0IG1hcCB2aXN1YWxpemF0aW9uXG4gICAqL1xuICBzdGF0aWMgZ2VuZXJhdGVDb25jZXB0TWFwKGNvbnRlbnQ6IHN0cmluZywgc3ViamVjdD86IHN0cmluZyk6IFZpc3VhbFJlcHJlc2VudGF0aW9uIHtcbiAgICBjb25zdCBjb25jZXB0cyA9IHRoaXMuZXh0cmFjdENvbmNlcHRzKGNvbnRlbnQpXG4gICAgY29uc3QgbWFpbkNvbmNlcHQgPSBjb25jZXB0c1swXSB8fCAnQ29uY2VwdG8gUHJpbmNpcGFsJ1xuICAgIGNvbnN0IHJlbGF0ZWRDb25jZXB0cyA9IGNvbmNlcHRzLnNsaWNlKDEsIDUpXG5cbiAgICBsZXQgYXNjaWkgPSBgXG7ilIzilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilJBcbuKUgiAgICR7dGhpcy5jZW50ZXJUZXh0KG1haW5Db25jZXB0LCAxNyl9ICAg4pSCXG7ilJTilIDilIDilIDilIDilIDilIDilIDilIDilIDilKzilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilJhcbiAgICAgICAgICDilIJcbiAgICDilIzilIDilIDilIDilIDilIDilLTilIDilIDilIDilIDilIDilJBcbiAgICDilIIgICAgICAgICAgIOKUgmBcblxuICAgIHJlbGF0ZWRDb25jZXB0cy5mb3JFYWNoKChjb25jZXB0LCBpbmRleCkgPT4ge1xuICAgICAgaWYgKGluZGV4IDwgMikge1xuICAgICAgICBhc2NpaSArPSBgXG7ilIzilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilJAgICAg4pSM4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSQXG7ilIIgJHt0aGlzLmNlbnRlclRleHQoY29uY2VwdCwgMTIpfSDilIIgICAg4pSCICAgICAgICAgICAgICDilIJcbuKUlOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUmCAgICDilJTilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilJhgXG4gICAgICB9XG4gICAgfSlcblxuICAgIGlmIChyZWxhdGVkQ29uY2VwdHMubGVuZ3RoID4gMikge1xuICAgICAgYXNjaWkgKz0gYFxuICAgIOKUgiAgICAgICAgICAg4pSCXG7ilIzilIDilIDilIDilLTilIDilIDilIDilIDilIDilJAg4pSM4pSA4pSA4pSA4pSA4pSA4pS04pSA4pSA4pSA4pSQYFxuICAgICAgcmVsYXRlZENvbmNlcHRzLnNsaWNlKDIsIDQpLmZvckVhY2goY29uY2VwdCA9PiB7XG4gICAgICAgIGFzY2lpICs9IGBcbuKUgiAke3RoaXMuY2VudGVyVGV4dChjb25jZXB0LCA3KX0g4pSCIOKUgiAgICAgICAgIOKUgmBcbiAgICAgIH0pXG4gICAgICBhc2NpaSArPSBgXG7ilJTilIDilIDilIDilIDilIDilIDilIDilIDilIDilJgg4pSU4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSYYFxuICAgIH1cblxuICAgIHJldHVybiB7XG4gICAgICB0eXBlOiBWaXN1YWxUeXBlLkNPTkNFUFRfTUFQLFxuICAgICAgYXNjaWk6IGFzY2lpLFxuICAgICAgZGVzY3JpcHRpb246IGBNYXBhIGNvbmNlcHR1YWwgcXVlIG11ZXN0cmEgbGFzIHJlbGFjaW9uZXMgZW50cmUgJHttYWluQ29uY2VwdH0geSBjb25jZXB0b3MgcmVsYWNpb25hZG9zYCxcbiAgICAgIGVsZW1lbnRzOiBjb25jZXB0cy5tYXAoKGNvbmNlcHQsIGluZGV4KSA9PiAoe1xuICAgICAgICBpZDogYGNvbmNlcHRfJHtpbmRleH1gLFxuICAgICAgICB0eXBlOiBWaXN1YWxUeXBlLkNPTkNFUFRfTUFQLFxuICAgICAgICB0aXRsZTogY29uY2VwdCxcbiAgICAgICAgY29udGVudDogYENvbmNlcHRvOiAke2NvbmNlcHR9YCxcbiAgICAgICAgY29ubmVjdGlvbnM6IGluZGV4ID09PSAwID8gcmVsYXRlZENvbmNlcHRzIDogW21haW5Db25jZXB0XVxuICAgICAgfSkpLFxuICAgICAgaW5zdHJ1Y3Rpb25zOiBbXG4gICAgICAgICdFbCBjb25jZXB0byBjZW50cmFsIGFwYXJlY2UgZW4gbGEgcGFydGUgc3VwZXJpb3InLFxuICAgICAgICAnTGFzIGzDrW5lYXMgY29uZWN0YW4gY29uY2VwdG9zIHJlbGFjaW9uYWRvcycsXG4gICAgICAgICdMb3MgY29uY2VwdG9zIHNlY3VuZGFyaW9zIHNlIHJhbWlmaWNhbiBkZWwgcHJpbmNpcGFsJ1xuICAgICAgXVxuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBHZW5lcmF0ZXMgZmxvd2NoYXJ0IHZpc3VhbGl6YXRpb25cbiAgICovXG4gIHN0YXRpYyBnZW5lcmF0ZUZsb3djaGFydChjb250ZW50OiBzdHJpbmcpOiBWaXN1YWxSZXByZXNlbnRhdGlvbiB7XG4gICAgY29uc3Qgc3RlcHMgPSB0aGlzLmV4dHJhY3RTdGVwcyhjb250ZW50KVxuICAgIFxuICAgIGxldCBhc2NpaSA9IGDilIzilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilJBcXG7ilIIgICBJTklDSU8gICAg4pSCXFxu4pSU4pSA4pSA4pSA4pSA4pSA4pSA4pSs4pSA4pSA4pSA4pSA4pSA4pSA4pSYXFxuICAgICAgIOKUglxcbiAgICAgICDilrxgXG5cbiAgICBzdGVwcy5mb3JFYWNoKChzdGVwLCBpbmRleCkgPT4ge1xuICAgICAgY29uc3Qgc3RlcFRleHQgPSB0aGlzLnRydW5jYXRlVGV4dChzdGVwLCAxNSlcbiAgICAgIGFzY2lpICs9IGBcbuKUjOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUkFxu4pSCICR7dGhpcy5jZW50ZXJUZXh0KHN0ZXBUZXh0LCAxNSl9IOKUglxu4pSU4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSs4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSYXG4gICAgICAgICAg4pSCXG4gICAgICAgICAg4pa8YFxuICAgIH0pXG5cbiAgICBhc2NpaSArPSBgXG7ilIzilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilJBcbuKUgiAgICBGSU4gICAgICDilIJcbuKUlOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUmGBcblxuICAgIHJldHVybiB7XG4gICAgICB0eXBlOiBWaXN1YWxUeXBlLkZMT1dDSEFSVCxcbiAgICAgIGFzY2lpOiBhc2NpaSxcbiAgICAgIGRlc2NyaXB0aW9uOiBgRGlhZ3JhbWEgZGUgZmx1am8gcXVlIG11ZXN0cmEgJHtzdGVwcy5sZW5ndGh9IHBhc29zIGRlbCBwcm9jZXNvYCxcbiAgICAgIGVsZW1lbnRzOiBzdGVwcy5tYXAoKHN0ZXAsIGluZGV4KSA9PiAoe1xuICAgICAgICBpZDogYHN0ZXBfJHtpbmRleH1gLFxuICAgICAgICB0eXBlOiBWaXN1YWxUeXBlLkZMT1dDSEFSVCxcbiAgICAgICAgdGl0bGU6IGBQYXNvICR7aW5kZXggKyAxfWAsXG4gICAgICAgIGNvbnRlbnQ6IHN0ZXAsXG4gICAgICAgIGNvbm5lY3Rpb25zOiBpbmRleCA8IHN0ZXBzLmxlbmd0aCAtIDEgPyBbYHN0ZXBfJHtpbmRleCArIDF9YF0gOiBbXVxuICAgICAgfSkpLFxuICAgICAgaW5zdHJ1Y3Rpb25zOiBbXG4gICAgICAgICdTaWd1ZSBsYXMgZmxlY2hhcyBkZSBhcnJpYmEgaGFjaWEgYWJham8nLFxuICAgICAgICAnQ2FkYSBjYWphIHJlcHJlc2VudGEgdW4gcGFzbyBkZWwgcHJvY2VzbycsXG4gICAgICAgICdFbCBmbHVqbyB2YSBkZXNkZSBJTklDSU8gaGFzdGEgRklOJ1xuICAgICAgXVxuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBHZW5lcmF0ZXMgaGllcmFyY2h5IHZpc3VhbGl6YXRpb25cbiAgICovXG4gIHN0YXRpYyBnZW5lcmF0ZUhpZXJhcmNoeShjb250ZW50OiBzdHJpbmcpOiBWaXN1YWxSZXByZXNlbnRhdGlvbiB7XG4gICAgY29uc3QgaGllcmFyY2h5SXRlbXMgPSB0aGlzLmV4dHJhY3RIaWVyYXJjaHkoY29udGVudClcbiAgICBjb25zdCByb290ID0gaGllcmFyY2h5SXRlbXNbMF0gfHwgJ0VsZW1lbnRvIFByaW5jaXBhbCdcbiAgICBjb25zdCBjaGlsZHJlbiA9IGhpZXJhcmNoeUl0ZW1zLnNsaWNlKDEsIDQpXG4gICAgY29uc3QgZ3JhbmRjaGlsZHJlbiA9IGhpZXJhcmNoeUl0ZW1zLnNsaWNlKDQsIDgpXG5cbiAgICBsZXQgYXNjaWkgPSBgXG4gICAgICAgICAgICAgICAgICAgIOKUjOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUkFxuICAgICAgICAgICAgICAgICAgICDilIIgJHt0aGlzLmNlbnRlclRleHQocm9vdCwgMTYpfSDilIJcbiAgICAgICAgICAgICAgICAgICAg4pSU4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSs4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSYXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICDilIJcbiAgICAgICAgICAgICAgICAg4pSM4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pS84pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSQYFxuXG4gICAgY2hpbGRyZW4uZm9yRWFjaCgoY2hpbGQsIGluZGV4KSA9PiB7XG4gICAgICBjb25zdCBzcGFjaW5nID0gaW5kZXggPT09IDAgPyAnICAgICAnIDogaW5kZXggPT09IDEgPyAnICAgICAgICAgICAnIDogJyAgICAgICAgICAgICAgICAgJ1xuICAgICAgYXNjaWkgKz0gYFxuICAgICAgICDilIzilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilJAke3NwYWNpbmd94pSM4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSQXG4gICAgICAgIOKUgiAke3RoaXMuY2VudGVyVGV4dChjaGlsZCwgMTEpfSDilIIke3NwYWNpbmd94pSCICAgICAgICAgICAgIOKUglxuICAgICAgICDilJTilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilJgke3NwYWNpbmd94pSU4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSYYFxuICAgIH0pXG5cbiAgICBpZiAoZ3JhbmRjaGlsZHJlbi5sZW5ndGggPiAwKSB7XG4gICAgICBhc2NpaSArPSBgXG4gICAgICAgICAgICAgIOKUgiAgICAgICAgICAgICAgICAgICAgIOKUglxuICAgICAgICDilIzilIDilIDilIDilIDilIDilLTilIDilIDilIDilIDilIDilJAgICAgICAgICDilIzilIDilIDilIDilIDilIDilLTilIDilIDilIDilIDilIDilJBgXG4gICAgICBncmFuZGNoaWxkcmVuLnNsaWNlKDAsIDIpLmZvckVhY2goaXRlbSA9PiB7XG4gICAgICAgIGFzY2lpICs9IGBcbiAgICAgICAg4pSCICR7dGhpcy5jZW50ZXJUZXh0KGl0ZW0sIDkpfSDilIIgICAgICAgICDilIIgICAgICAgICAgIOKUgmBcbiAgICAgIH0pXG4gICAgICBhc2NpaSArPSBgXG4gICAgICAgIOKUlOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUmCAgICAgICAgIOKUlOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUmGBcbiAgICB9XG5cbiAgICByZXR1cm4ge1xuICAgICAgdHlwZTogVmlzdWFsVHlwZS5ISUVSQVJDSFksXG4gICAgICBhc2NpaTogYXNjaWksXG4gICAgICBkZXNjcmlwdGlvbjogYEplcmFycXXDrWEgcXVlIG11ZXN0cmEgbGEgZXN0cnVjdHVyYSBkZSAke3Jvb3R9IGNvbiAke2NoaWxkcmVuLmxlbmd0aH0gbml2ZWxlc2AsXG4gICAgICBlbGVtZW50czogaGllcmFyY2h5SXRlbXMubWFwKChpdGVtLCBpbmRleCkgPT4gKHtcbiAgICAgICAgaWQ6IGBoaWVyYXJjaHlfJHtpbmRleH1gLFxuICAgICAgICB0eXBlOiBWaXN1YWxUeXBlLkhJRVJBUkNIWSxcbiAgICAgICAgdGl0bGU6IGl0ZW0sXG4gICAgICAgIGNvbnRlbnQ6IGBFbGVtZW50byBkZSBqZXJhcnF1w61hOiAke2l0ZW19YCxcbiAgICAgICAgY29ubmVjdGlvbnM6IGluZGV4ID09PSAwID8gY2hpbGRyZW4gOiBbXVxuICAgICAgfSkpLFxuICAgICAgaW5zdHJ1Y3Rpb25zOiBbXG4gICAgICAgICdFbCBlbGVtZW50byBwcmluY2lwYWwgZXN0w6EgZW4gbGEgcGFydGUgc3VwZXJpb3InLFxuICAgICAgICAnTG9zIGVsZW1lbnRvcyBzZWN1bmRhcmlvcyBzZSBjb25lY3RhbiBoYWNpYSBhYmFqbycsXG4gICAgICAgICdDYWRhIG5pdmVsIHJlcHJlc2VudGEgdW5hIHN1YmRpdmlzacOzbidcbiAgICAgIF1cbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogR2VuZXJhdGVzIHRpbWVsaW5lIHZpc3VhbGl6YXRpb25cbiAgICovXG4gIHN0YXRpYyBnZW5lcmF0ZVRpbWVsaW5lKGNvbnRlbnQ6IHN0cmluZyk6IFZpc3VhbFJlcHJlc2VudGF0aW9uIHtcbiAgICBjb25zdCB0aW1lRXZlbnRzID0gdGhpcy5leHRyYWN0VGltZWxpbmVFdmVudHMoY29udGVudClcbiAgICBcbiAgICBsZXQgYXNjaWkgPSBg4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSBXFxuYFxuICAgIFxuICAgIHRpbWVFdmVudHMuZm9yRWFjaCgoZXZlbnQsIGluZGV4KSA9PiB7XG4gICAgICBjb25zdCBldmVudFRleHQgPSB0aGlzLnRydW5jYXRlVGV4dChldmVudC5ldmVudCwgMjApXG4gICAgICBjb25zdCB0aW1lVGV4dCA9IGV2ZW50LnRpbWUgfHwgYFQke2luZGV4ICsgMX1gXG4gICAgICBcbiAgICAgIGlmIChpbmRleCAlIDIgPT09IDApIHtcbiAgICAgICAgLy8gRXZlbnQgYWJvdmUgdGltZWxpbmVcbiAgICAgICAgYXNjaWkgKz0gYOKUjOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUkFxcbuKUgiAke3RoaXMuY2VudGVyVGV4dChldmVudFRleHQsIDE5KX0g4pSCXFxu4pSU4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSs4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSYXFxuICAgICAgICAgICDilIJcXG5gXG4gICAgICAgIGFzY2lpICs9IGDilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilL/ilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIFcXG5gXG4gICAgICAgIGFzY2lpICs9IGAgICAgICAgICAgICR7dGltZVRleHR9XFxuXFxuYFxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gRXZlbnQgYmVsb3cgdGltZWxpbmVcbiAgICAgICAgYXNjaWkgKz0gYCAgICAgICAgICAg4pSCXFxuICAgICAgICAgICDilLxcXG7ilIzilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilLTilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilJBcXG7ilIIgJHt0aGlzLmNlbnRlclRleHQoZXZlbnRUZXh0LCAxOSl9IOKUglxcbuKUlOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUmFxcbmBcbiAgICAgIH1cbiAgICB9KVxuXG4gICAgcmV0dXJuIHtcbiAgICAgIHR5cGU6IFZpc3VhbFR5cGUuVElNRUxJTkUsXG4gICAgICBhc2NpaTogYXNjaWksXG4gICAgICBkZXNjcmlwdGlvbjogYEzDrW5lYSBkZSB0aWVtcG8gY29uICR7dGltZUV2ZW50cy5sZW5ndGh9IGV2ZW50b3MgY3Jvbm9sw7NnaWNvc2AsXG4gICAgICBlbGVtZW50czogdGltZUV2ZW50cy5tYXAoKGV2ZW50LCBpbmRleCkgPT4gKHtcbiAgICAgICAgaWQ6IGBldmVudF8ke2luZGV4fWAsXG4gICAgICAgIHR5cGU6IFZpc3VhbFR5cGUuVElNRUxJTkUsXG4gICAgICAgIHRpdGxlOiBldmVudC50aW1lIHx8IGBFdmVudG8gJHtpbmRleCArIDF9YCxcbiAgICAgICAgY29udGVudDogZXZlbnQuZXZlbnQsXG4gICAgICAgIGNvbm5lY3Rpb25zOiBbXVxuICAgICAgfSkpLFxuICAgICAgaW5zdHJ1Y3Rpb25zOiBbXG4gICAgICAgICdMb3MgZXZlbnRvcyBzZSBtdWVzdHJhbiBlbiBvcmRlbiBjcm9ub2zDs2dpY28nLFxuICAgICAgICAnTGEgbMOtbmVhIGhvcml6b250YWwgcmVwcmVzZW50YSBlbCB0aWVtcG8nLFxuICAgICAgICAnTG9zIGV2ZW50b3MgYWx0ZXJub3MgYXBhcmVjZW4gYXJyaWJhIHkgYWJham8gZGUgbGEgbMOtbmVhJ1xuICAgICAgXVxuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBHZW5lcmF0ZXMgZm9ybXVsYSB2aXN1YWxpemF0aW9uXG4gICAqL1xuICBzdGF0aWMgZ2VuZXJhdGVGb3JtdWxhVmlzdWFsaXphdGlvbihjb250ZW50OiBzdHJpbmcpOiBWaXN1YWxSZXByZXNlbnRhdGlvbiB7XG4gICAgY29uc3QgZm9ybXVsYSA9IHRoaXMuZXh0cmFjdEZvcm11bGEoY29udGVudClcbiAgICBjb25zdCB2YXJpYWJsZXMgPSB0aGlzLmV4dHJhY3RWYXJpYWJsZXMoY29udGVudClcbiAgICBcbiAgICBsZXQgYXNjaWkgPSBgXG7ilZTilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZdcbuKVkSAgICAgICAgIEbDk1JNVUxBIE1BVEVNw4FUSUNBICAgICAgICDilZFcbuKVoOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVo1xu4pWRICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICDilZFcbuKVkSAgICAgICAgICR7dGhpcy5jZW50ZXJUZXh0KGZvcm11bGEsIDE5KX0gICAgICAgICDilZFcbuKVkSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg4pWRXG7ilaDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilaNcbuKVkSAgICAgICAgICAgVkFSSUFCTEVTOiAgICAgICAgICAgICAg4pWRYFxuXG4gICAgdmFyaWFibGVzLmZvckVhY2godmFyaWFibGUgPT4ge1xuICAgICAgYXNjaWkgKz0gYFxu4pWRICAke3ZhcmlhYmxlLnN5bWJvbH0gPSAke3RoaXMudHJ1bmNhdGVUZXh0KHZhcmlhYmxlLmRlc2NyaXB0aW9uLCAyMCl9ICAgIOKVkWBcbiAgICB9KVxuXG4gICAgYXNjaWkgKz0gYFxu4pWRICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICDilZFcbuKVmuKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVnVxuXG4gICAgUmVwcmVzZW50YWNpw7NuIHZpc3VhbDpcbiAgICBcbiAgICAgICAgICR7Zm9ybXVsYX1cbiAgICAgICAgIOKGmSAgICAg4oaYXG4gICAgVmFyaWFibGUgICBSZXN1bHRhZG9cbiAgICAgICR7dmFyaWFibGVzWzBdPy5zeW1ib2wgfHwgJ3gnfSAgICAgICAgIHlgXG5cbiAgICByZXR1cm4ge1xuICAgICAgdHlwZTogVmlzdWFsVHlwZS5GT1JNVUxBX1ZJU1VBTElaQVRJT04sXG4gICAgICBhc2NpaTogYXNjaWksXG4gICAgICBkZXNjcmlwdGlvbjogYFZpc3VhbGl6YWNpw7NuIGRlIGxhIGbDs3JtdWxhICR7Zm9ybXVsYX0gY29uICR7dmFyaWFibGVzLmxlbmd0aH0gdmFyaWFibGVzYCxcbiAgICAgIGVsZW1lbnRzOiBbe1xuICAgICAgICBpZDogJ2Zvcm11bGFfbWFpbicsXG4gICAgICAgIHR5cGU6IFZpc3VhbFR5cGUuRk9STVVMQV9WSVNVQUxJWkFUSU9OLFxuICAgICAgICB0aXRsZTogJ0bDs3JtdWxhIFByaW5jaXBhbCcsXG4gICAgICAgIGNvbnRlbnQ6IGZvcm11bGEsXG4gICAgICAgIGNvbm5lY3Rpb25zOiB2YXJpYWJsZXMubWFwKChfLCBpbmRleCkgPT4gYHZhcl8ke2luZGV4fWApXG4gICAgICB9XS5jb25jYXQodmFyaWFibGVzLm1hcCgodmFyaWFibGUsIGluZGV4KSA9PiAoe1xuICAgICAgICBpZDogYHZhcl8ke2luZGV4fWAsXG4gICAgICAgIHR5cGU6IFZpc3VhbFR5cGUuRk9STVVMQV9WSVNVQUxJWkFUSU9OLFxuICAgICAgICB0aXRsZTogdmFyaWFibGUuc3ltYm9sLFxuICAgICAgICBjb250ZW50OiB2YXJpYWJsZS5kZXNjcmlwdGlvbixcbiAgICAgICAgY29ubmVjdGlvbnM6IFtdXG4gICAgICB9KSkpLFxuICAgICAgaW5zdHJ1Y3Rpb25zOiBbXG4gICAgICAgICdMYSBmw7NybXVsYSBwcmluY2lwYWwgc2UgbXVlc3RyYSBlbiBlbCBjZW50cm8nLFxuICAgICAgICAnTGFzIHZhcmlhYmxlcyBzZSBkZWZpbmVuIGVuIGxhIHRhYmxhIGluZmVyaW9yJyxcbiAgICAgICAgJ1N1c3RpdHV5ZSBsb3MgdmFsb3JlcyBwYXJhIHJlc29sdmVyJ1xuICAgICAgXVxuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBHZW5lcmF0ZXMgY2hlbWljYWwgc3RydWN0dXJlIHZpc3VhbGl6YXRpb25cbiAgICovXG4gIHN0YXRpYyBnZW5lcmF0ZUNoZW1pY2FsU3RydWN0dXJlKGNvbnRlbnQ6IHN0cmluZyk6IFZpc3VhbFJlcHJlc2VudGF0aW9uIHtcbiAgICBjb25zdCBtb2xlY3VsZSA9IHRoaXMuZXh0cmFjdE1vbGVjdWxlKGNvbnRlbnQpXG4gICAgY29uc3QgYXRvbXMgPSB0aGlzLmV4dHJhY3RBdG9tcyhjb250ZW50KVxuICAgIFxuICAgIGxldCBhc2NpaSA9ICcnXG5cbiAgICAvLyBTaW1wbGUgbW9sZWN1bGFyIHJlcHJlc2VudGF0aW9uc1xuICAgIGlmIChtb2xlY3VsZS50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKCdoMm8nKSB8fCBtb2xlY3VsZS50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKCdhZ3VhJykpIHtcbiAgICAgIGFzY2lpID0gYFxuICAgICAgICBFc3RydWN0dXJhIGRlbCBBZ3VhIChI4oKCTylcbiAgICAgICAgXG4gICAgICAgICAgICBIXG4gICAgICAgICAgICDilIJcbiAgICAgICAgSOKUgE/ilIBIICAgIG8gICAgSOKUgE/ilIBIXG4gICAgICAgICAgICBcbiAgICAgICAgUmVwcmVzZW50YWNpw7NuIGFuZ3VsYXI6XG4gICAgICAgIFxuICAgICAgICAgICAgSFxuICAgICAgICAgICAgIFxcXFxcbiAgICAgICAgICAgICAgT1xuICAgICAgICAgICAgIC9cbiAgICAgICAgICAgIEhcbiAgICAgICAgICAgICAgXG4gICAgICAgIMOBbmd1bG8gSC1PLUg6IDEwNC41wrBgXG4gICAgfSBlbHNlIGlmIChtb2xlY3VsZS50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKCdjbzInKSkge1xuICAgICAgYXNjaWkgPSBgXG4gICAgICAgIEVzdHJ1Y3R1cmEgZGVsIENP4oKCXG4gICAgICAgIFxuICAgICAgICBP4pWQQ+KVkE9cbiAgICAgICAgXG4gICAgICAgIExpbmVhbCwgMTgwwrBcbiAgICAgICAgXG4gICAgICAgIEVubGFjZXMgZG9ibGVzOlxuICAgICAgICBPIOKVkOKVkCBDIOKVkOKVkCBPYFxuICAgIH0gZWxzZSBpZiAobW9sZWN1bGUudG9Mb3dlckNhc2UoKS5pbmNsdWRlcygnY2g0JykgfHwgbW9sZWN1bGUudG9Mb3dlckNhc2UoKS5pbmNsdWRlcygnbWV0YW5vJykpIHtcbiAgICAgIGFzY2lpID0gYFxuICAgICAgICBFc3RydWN0dXJhIGRlbCBNZXRhbm8gKENI4oKEKVxuICAgICAgICBcbiAgICAgICAgICAgSFxuICAgICAgICAgICDilIJcbiAgICAgICAgSOKUgEPilIBIXG4gICAgICAgICAgIOKUglxuICAgICAgICAgICBIXG4gICAgICAgICAgIFxuICAgICAgICBUZXRyYcOpZHJpY2FcbiAgICAgICAgw4FuZ3VsbyBILUMtSDogMTA5LjXCsGBcbiAgICB9IGVsc2Uge1xuICAgICAgYXNjaWkgPSBgXG4gICAgICAgIEVzdHJ1Y3R1cmEgTW9sZWN1bGFyXG4gICAgICAgIFxuICAgICAgICAke21vbGVjdWxlfVxuICAgICAgICBcbiAgICAgICAgw4F0b21vcyBpZGVudGlmaWNhZG9zOlxuICAgICAgICAke2F0b21zLm1hcChhdG9tID0+IGDigKIgJHthdG9tfWApLmpvaW4oJ1xcbiAgICAgICAgJyl9XG4gICAgICAgIFxuICAgICAgICBSZXByZXNlbnRhY2nDs24gZXNxdWVtw6F0aWNhOlxuICAgICAgICBcbiAgICAgICAgW8OBdG9tbzFd4pSAW8OBdG9tbzJd4pSAW8OBdG9tbzNdYFxuICAgIH1cblxuICAgIHJldHVybiB7XG4gICAgICB0eXBlOiBWaXN1YWxUeXBlLkNIRU1JQ0FMX1NUUlVDVFVSRSxcbiAgICAgIGFzY2lpOiBhc2NpaSxcbiAgICAgIGRlc2NyaXB0aW9uOiBgRXN0cnVjdHVyYSBxdcOtbWljYSBkZSAke21vbGVjdWxlfSBtb3N0cmFuZG8gJHthdG9tcy5sZW5ndGh9IHRpcG9zIGRlIMOhdG9tb3NgLFxuICAgICAgZWxlbWVudHM6IFt7XG4gICAgICAgIGlkOiAnbW9sZWN1bGVfbWFpbicsXG4gICAgICAgIHR5cGU6IFZpc3VhbFR5cGUuQ0hFTUlDQUxfU1RSVUNUVVJFLFxuICAgICAgICB0aXRsZTogbW9sZWN1bGUsXG4gICAgICAgIGNvbnRlbnQ6IGBNb2zDqWN1bGE6ICR7bW9sZWN1bGV9YCxcbiAgICAgICAgY29ubmVjdGlvbnM6IGF0b21zLm1hcCgoXywgaW5kZXgpID0+IGBhdG9tXyR7aW5kZXh9YClcbiAgICAgIH1dLmNvbmNhdChhdG9tcy5tYXAoKGF0b20sIGluZGV4KSA9PiAoe1xuICAgICAgICBpZDogYGF0b21fJHtpbmRleH1gLFxuICAgICAgICB0eXBlOiBWaXN1YWxUeXBlLkNIRU1JQ0FMX1NUUlVDVFVSRSxcbiAgICAgICAgdGl0bGU6IGF0b20sXG4gICAgICAgIGNvbnRlbnQ6IGDDgXRvbW86ICR7YXRvbX1gLFxuICAgICAgICBjb25uZWN0aW9uczogW11cbiAgICAgIH0pKSksXG4gICAgICBpbnN0cnVjdGlvbnM6IFtcbiAgICAgICAgJ0xvcyDDoXRvbW9zIHNlIHJlcHJlc2VudGFuIGNvbiBzdXMgc8OtbWJvbG9zJyxcbiAgICAgICAgJ0xhcyBsw61uZWFzIHJlcHJlc2VudGFuIGVubGFjZXMgcXXDrW1pY29zJyxcbiAgICAgICAgJ0xvcyDDoW5ndWxvcyBtdWVzdHJhbiBsYSBnZW9tZXRyw61hIG1vbGVjdWxhcidcbiAgICAgIF1cbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogR2VuZXJhdGVzIHByb2Nlc3MgZmxvdyB2aXN1YWxpemF0aW9uXG4gICAqL1xuICBzdGF0aWMgZ2VuZXJhdGVQcm9jZXNzRmxvdyhjb250ZW50OiBzdHJpbmcpOiBWaXN1YWxSZXByZXNlbnRhdGlvbiB7XG4gICAgY29uc3QgcHJvY2Vzc2VzID0gdGhpcy5leHRyYWN0UHJvY2Vzc2VzKGNvbnRlbnQpXG4gICAgXG4gICAgbGV0IGFzY2lpID0gYFxuICAgIEZMVUpPIERFTCBQUk9DRVNPXG4gICAgXG4gICAg4pSM4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSQYFxuXG4gICAgcHJvY2Vzc2VzLmZvckVhY2goKHByb2Nlc3MsIGluZGV4KSA9PiB7XG4gICAgICBjb25zdCBwcm9jZXNzVGV4dCA9IHRoaXMudHJ1bmNhdGVUZXh0KHByb2Nlc3MsIDE1KVxuICAgICAgaWYgKGluZGV4ID09PSAwKSB7XG4gICAgICAgIGFzY2lpICs9IGBcbiAgICDilIIgICAke3RoaXMuY2VudGVyVGV4dChwcm9jZXNzVGV4dCwgOSl9ICAg4pSCXG4gICAg4pSU4pSA4pSA4pSA4pSA4pSA4pSs4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSYXG4gICAgICAgICAg4pSCXG4gICAgICAgICAg4pa8YFxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgYXNjaWkgKz0gYFxuICAgIOKUjOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUkFxuICAgIOKUgiAgICR7dGhpcy5jZW50ZXJUZXh0KHByb2Nlc3NUZXh0LCA5KX0gICDilIJcbiAgICDilJTilIDilIDilIDilIDilIDilKzilIDilIDilIDilIDilIDilIDilIDilJhcbiAgICAgICAgICDilIJcbiAgICAgICAgICDilrxgXG4gICAgICB9XG4gICAgfSlcblxuICAgIGFzY2lpICs9IGBcbiAgICDilIzilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilJBcbiAgICDilIIgICBGSU5BTCAgICAg4pSCXG4gICAg4pSU4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSYYFxuXG4gICAgcmV0dXJuIHtcbiAgICAgIHR5cGU6IFZpc3VhbFR5cGUuUFJPQ0VTU19GTE9XLFxuICAgICAgYXNjaWk6IGFzY2lpLFxuICAgICAgZGVzY3JpcHRpb246IGBGbHVqbyBkZSBwcm9jZXNvIGNvbiAke3Byb2Nlc3Nlcy5sZW5ndGh9IGV0YXBhcyBzZWN1ZW5jaWFsZXNgLFxuICAgICAgZWxlbWVudHM6IHByb2Nlc3Nlcy5tYXAoKHByb2Nlc3MsIGluZGV4KSA9PiAoe1xuICAgICAgICBpZDogYHByb2Nlc3NfJHtpbmRleH1gLFxuICAgICAgICB0eXBlOiBWaXN1YWxUeXBlLlBST0NFU1NfRkxPVyxcbiAgICAgICAgdGl0bGU6IGBQcm9jZXNvICR7aW5kZXggKyAxfWAsXG4gICAgICAgIGNvbnRlbnQ6IHByb2Nlc3MsXG4gICAgICAgIGNvbm5lY3Rpb25zOiBpbmRleCA8IHByb2Nlc3Nlcy5sZW5ndGggLSAxID8gW2Bwcm9jZXNzXyR7aW5kZXggKyAxfWBdIDogW11cbiAgICAgIH0pKSxcbiAgICAgIGluc3RydWN0aW9uczogW1xuICAgICAgICAnU2lndWUgZWwgZmx1am8gZGUgYXJyaWJhIGhhY2lhIGFiYWpvJyxcbiAgICAgICAgJ0NhZGEgY2FqYSByZXByZXNlbnRhIHVuYSBldGFwYSBkZWwgcHJvY2VzbycsXG4gICAgICAgICdMYXMgZmxlY2hhcyBpbmRpY2FuIGxhIHNlY3VlbmNpYSdcbiAgICAgIF1cbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogR2VuZXJhdGVzIGdlbmVyaWMgZGlhZ3JhbVxuICAgKi9cbiAgc3RhdGljIGdlbmVyYXRlR2VuZXJpY0RpYWdyYW0oY29udGVudDogc3RyaW5nKTogVmlzdWFsUmVwcmVzZW50YXRpb24ge1xuICAgIGNvbnN0IGtleVBvaW50cyA9IHRoaXMuZXh0cmFjdEtleVBvaW50cyhjb250ZW50LCA0KVxuICAgIFxuICAgIGxldCBhc2NpaSA9IGBcbiAgICDila3ilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDila5cbiAgICDilIIgICAgICAgIERJQUdSQU1BIEdFTkVSQUwgICAgICAgICDilIJcbiAgICDilbDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilKzilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDila9cbiAgICAgICAgICAgICAgICAgIOKUgmBcblxuICAgIGtleVBvaW50cy5mb3JFYWNoKChwb2ludCwgaW5kZXgpID0+IHtcbiAgICAgIGNvbnN0IHBvaW50VGV4dCA9IHRoaXMudHJ1bmNhdGVUZXh0KHBvaW50LCAyMClcbiAgICAgIGFzY2lpICs9IGBcbiAgICAgICAgICAgICAgICAgIOKWvFxuICAgIOKUjOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUkFxuICAgIOKUgiAke2luZGV4ICsgMX0uICR7dGhpcy5sZWZ0QWxpZ24ocG9pbnRUZXh0LCAyMyl9IOKUglxuICAgIOKUlOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUmGBcbiAgICB9KVxuXG4gICAgcmV0dXJuIHtcbiAgICAgIHR5cGU6IFZpc3VhbFR5cGUuRElBR1JBTSxcbiAgICAgIGFzY2lpOiBhc2NpaSxcbiAgICAgIGRlc2NyaXB0aW9uOiBgRGlhZ3JhbWEgZ2VuZXJhbCBjb24gJHtrZXlQb2ludHMubGVuZ3RofSBlbGVtZW50b3MgcHJpbmNpcGFsZXNgLFxuICAgICAgZWxlbWVudHM6IGtleVBvaW50cy5tYXAoKHBvaW50LCBpbmRleCkgPT4gKHtcbiAgICAgICAgaWQ6IGBwb2ludF8ke2luZGV4fWAsXG4gICAgICAgIHR5cGU6IFZpc3VhbFR5cGUuRElBR1JBTSxcbiAgICAgICAgdGl0bGU6IGBQdW50byAke2luZGV4ICsgMX1gLFxuICAgICAgICBjb250ZW50OiBwb2ludCxcbiAgICAgICAgY29ubmVjdGlvbnM6IFtdXG4gICAgICB9KSksXG4gICAgICBpbnN0cnVjdGlvbnM6IFtcbiAgICAgICAgJ0NhZGEgZWxlbWVudG8gc2UgcHJlc2VudGEgZGUgZm9ybWEgc2VjdWVuY2lhbCcsXG4gICAgICAgICdMb3MgbsO6bWVyb3MgaW5kaWNhbiBlbCBvcmRlbiBkZSBpbXBvcnRhbmNpYScsXG4gICAgICAgICdSZXZpc2EgY2FkYSBwdW50byBwYXJhIGNvbXByZW5zacOzbiBjb21wbGV0YSdcbiAgICAgIF1cbiAgICB9XG4gIH1cblxuICAvLyA9PT09PSBVVElMSVRZIEZVTkNUSU9OUyA9PT09PVxuXG4gIC8qKlxuICAgKiBFeHRyYWN0cyBtYWluIGNvbmNlcHRzIGZyb20gY29udGVudFxuICAgKi9cbiAgcHJpdmF0ZSBzdGF0aWMgZXh0cmFjdENvbmNlcHRzKGNvbnRlbnQ6IHN0cmluZyk6IHN0cmluZ1tdIHtcbiAgICBjb25zdCBzZW50ZW5jZXMgPSBjb250ZW50LnNwbGl0KC9bLiE/XSsvKVxuICAgIGNvbnN0IGNvbmNlcHRzOiBzdHJpbmdbXSA9IFtdXG4gICAgXG4gICAgZm9yIChjb25zdCBzZW50ZW5jZSBvZiBzZW50ZW5jZXMpIHtcbiAgICAgIGNvbnN0IHdvcmRzID0gc2VudGVuY2UudHJpbSgpLnNwbGl0KCcgJylcbiAgICAgIGNvbnN0IGltcG9ydGFudFdvcmRzID0gd29yZHMuZmlsdGVyKHdvcmQgPT4gXG4gICAgICAgIHdvcmQubGVuZ3RoID4gNCAmJiBcbiAgICAgICAgIVsnZXN0ZScsICdlc3RhJywgJ2VzdG9zJywgJ2VzdGFzJywgJ2N1YW5kbycsICdkb25kZScsICdwb3JxdWUnXS5pbmNsdWRlcyh3b3JkLnRvTG93ZXJDYXNlKCkpXG4gICAgICApXG4gICAgICBcbiAgICAgIGlmIChpbXBvcnRhbnRXb3Jkcy5sZW5ndGggPiAwKSB7XG4gICAgICAgIGNvbmNlcHRzLnB1c2goaW1wb3J0YW50V29yZHNbMF0pXG4gICAgICB9XG4gICAgICBcbiAgICAgIGlmIChjb25jZXB0cy5sZW5ndGggPj0gNSkgYnJlYWtcbiAgICB9XG4gICAgXG4gICAgcmV0dXJuIGNvbmNlcHRzLmxlbmd0aCA+IDAgPyBjb25jZXB0cyA6IFsnQ29uY2VwdG8gUHJpbmNpcGFsJ11cbiAgfVxuXG4gIC8qKlxuICAgKiBFeHRyYWN0cyBzdGVwcyBmcm9tIGNvbnRlbnRcbiAgICovXG4gIHByaXZhdGUgc3RhdGljIGV4dHJhY3RTdGVwcyhjb250ZW50OiBzdHJpbmcpOiBzdHJpbmdbXSB7XG4gICAgLy8gTG9vayBmb3IgbnVtYmVyZWQgc3RlcHMgb3Igc2VxdWVudGlhbCBpbmRpY2F0b3JzXG4gICAgY29uc3Qgc3RlcFBhdHRlcm5zID0gW1xuICAgICAgL1xcZCtbLildXFxzKihbXi4hP10rKS9nLFxuICAgICAgL3Bhc28gXFxkKzo/XFxzKihbXi4hP10rKS9naSxcbiAgICAgIC8ocHJpbWVyb3xzZWd1bmRvfHRlcmNlcm98bHVlZ298ZGVzcHXDqXN8ZmluYWxtZW50ZSlbLDpdP1xccyooW14uIT9dKykvZ2lcbiAgICBdXG4gICAgXG4gICAgY29uc3Qgc3RlcHM6IHN0cmluZ1tdID0gW11cbiAgICBcbiAgICBmb3IgKGNvbnN0IHBhdHRlcm4gb2Ygc3RlcFBhdHRlcm5zKSB7XG4gICAgICBsZXQgbWF0Y2hcbiAgICAgIHdoaWxlICgobWF0Y2ggPSBwYXR0ZXJuLmV4ZWMoY29udGVudCkpICE9PSBudWxsICYmIHN0ZXBzLmxlbmd0aCA8IDYpIHtcbiAgICAgICAgY29uc3Qgc3RlcCA9IG1hdGNoWzFdIHx8IG1hdGNoWzJdXG4gICAgICAgIGlmIChzdGVwICYmIHN0ZXAudHJpbSgpLmxlbmd0aCA+IDUpIHtcbiAgICAgICAgICBzdGVwcy5wdXNoKHN0ZXAudHJpbSgpKVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIFxuICAgIGlmIChzdGVwcy5sZW5ndGggPT09IDApIHtcbiAgICAgIC8vIEZhbGxiYWNrOiBzcGxpdCBieSBzZW50ZW5jZXNcbiAgICAgIGNvbnN0IHNlbnRlbmNlcyA9IGNvbnRlbnQuc3BsaXQoL1suIT9dKy8pXG4gICAgICBzdGVwcy5wdXNoKC4uLnNlbnRlbmNlcy5zbGljZSgwLCA0KS5maWx0ZXIocyA9PiBzLnRyaW0oKS5sZW5ndGggPiAxMCkpXG4gICAgfVxuICAgIFxuICAgIHJldHVybiBzdGVwcy5zbGljZSgwLCA1KVxuICB9XG5cbiAgLyoqXG4gICAqIEV4dHJhY3RzIGhpZXJhcmNoeSBpdGVtc1xuICAgKi9cbiAgcHJpdmF0ZSBzdGF0aWMgZXh0cmFjdEhpZXJhcmNoeShjb250ZW50OiBzdHJpbmcpOiBzdHJpbmdbXSB7XG4gICAgY29uc3QgaGllcmFyY2h5V29yZHMgPSBbJ3ByaW5jaXBhbCcsICdzZWN1bmRhcmlvJywgJ3RpcG8nLCAnY2F0ZWdvcsOtYScsICdjbGFzZScsICdncnVwbyddXG4gICAgY29uc3QgaXRlbXM6IHN0cmluZ1tdID0gW11cbiAgICBjb25zdCBzZW50ZW5jZXMgPSBjb250ZW50LnNwbGl0KC9bLiE/XSsvKVxuICAgIFxuICAgIGZvciAoY29uc3Qgc2VudGVuY2Ugb2Ygc2VudGVuY2VzKSB7XG4gICAgICBmb3IgKGNvbnN0IHdvcmQgb2YgaGllcmFyY2h5V29yZHMpIHtcbiAgICAgICAgaWYgKHNlbnRlbmNlLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMod29yZCkpIHtcbiAgICAgICAgICBjb25zdCBjbGVhblNlbnRlbmNlID0gc2VudGVuY2UucmVwbGFjZSgvXlxccypcXGQrWy4pXVxccyovLCAnJykudHJpbSgpXG4gICAgICAgICAgaWYgKGNsZWFuU2VudGVuY2UubGVuZ3RoID4gNSkge1xuICAgICAgICAgICAgaXRlbXMucHVzaChjbGVhblNlbnRlbmNlKVxuICAgICAgICAgICAgYnJlYWtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGlmIChpdGVtcy5sZW5ndGggPj0gNikgYnJlYWtcbiAgICB9XG4gICAgXG4gICAgcmV0dXJuIGl0ZW1zLmxlbmd0aCA+IDAgPyBpdGVtcyA6IFsnRWxlbWVudG8gUHJpbmNpcGFsJywgJ1N1YmVsZW1lbnRvIDEnLCAnU3ViZWxlbWVudG8gMiddXG4gIH1cblxuICAvKipcbiAgICogRXh0cmFjdHMgdGltZWxpbmUgZXZlbnRzXG4gICAqL1xuICBwcml2YXRlIHN0YXRpYyBleHRyYWN0VGltZWxpbmVFdmVudHMoY29udGVudDogc3RyaW5nKTogQXJyYXk8e3RpbWU6IHN0cmluZywgZXZlbnQ6IHN0cmluZ30+IHtcbiAgICBjb25zdCB0aW1lUGF0dGVybiA9IC8oXFxkezR9fFxcZHsxLDJ9OlxcZHsyfXxzaWdsbyBcXHcrfGVyYSBcXHcrKS9naVxuICAgIGNvbnN0IGV2ZW50czogQXJyYXk8e3RpbWU6IHN0cmluZywgZXZlbnQ6IHN0cmluZ30+ID0gW11cbiAgICBjb25zdCBzZW50ZW5jZXMgPSBjb250ZW50LnNwbGl0KC9bLiE/XSsvKVxuICAgIFxuICAgIGZvciAoY29uc3Qgc2VudGVuY2Ugb2Ygc2VudGVuY2VzKSB7XG4gICAgICBjb25zdCB0aW1lTWF0Y2ggPSBzZW50ZW5jZS5tYXRjaCh0aW1lUGF0dGVybilcbiAgICAgIGlmICh0aW1lTWF0Y2gpIHtcbiAgICAgICAgZXZlbnRzLnB1c2goe1xuICAgICAgICAgIHRpbWU6IHRpbWVNYXRjaFswXSxcbiAgICAgICAgICBldmVudDogc2VudGVuY2UucmVwbGFjZSh0aW1lUGF0dGVybiwgJycpLnRyaW0oKVxuICAgICAgICB9KVxuICAgICAgfVxuICAgIH1cbiAgICBcbiAgICBpZiAoZXZlbnRzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgLy8gRmFsbGJhY2sgdGltZWxpbmVcbiAgICAgIGNvbnN0IGtleUV2ZW50cyA9IHNlbnRlbmNlcy5zbGljZSgwLCAzKS5maWx0ZXIocyA9PiBzLnRyaW0oKS5sZW5ndGggPiAxMClcbiAgICAgIGtleUV2ZW50cy5mb3JFYWNoKChldmVudCwgaW5kZXgpID0+IHtcbiAgICAgICAgZXZlbnRzLnB1c2goe1xuICAgICAgICAgIHRpbWU6IGBUJHtpbmRleCArIDF9YCxcbiAgICAgICAgICBldmVudDogZXZlbnQudHJpbSgpXG4gICAgICAgIH0pXG4gICAgICB9KVxuICAgIH1cbiAgICBcbiAgICByZXR1cm4gZXZlbnRzLnNsaWNlKDAsIDUpXG4gIH1cblxuICAvKipcbiAgICogRXh0cmFjdHMgZm9ybXVsYSBmcm9tIGNvbnRlbnRcbiAgICovXG4gIHByaXZhdGUgc3RhdGljIGV4dHJhY3RGb3JtdWxhKGNvbnRlbnQ6IHN0cmluZyk6IHN0cmluZyB7XG4gICAgLy8gTG9vayBmb3IgbWF0aGVtYXRpY2FsIGV4cHJlc3Npb25zXG4gICAgY29uc3QgZm9ybXVsYVBhdHRlcm5zID0gW1xuICAgICAgLyhbYS16QS1aXVxccypbPV1cXHMqW14uIT9dKykvLFxuICAgICAgLyhbYS16QS1aXStcXHMqXFwoXFxzKlthLXpBLVosXFxzXStcXHMqXFwpKS8sXG4gICAgICAvKGZcXChbeC16XVxcKVxccyo9XFxzKlteLiE/XSspL2ksXG4gICAgICAvKFt4eV1cXHMqPVxccypbXi4hP10rKS9cbiAgICBdXG4gICAgXG4gICAgZm9yIChjb25zdCBwYXR0ZXJuIG9mIGZvcm11bGFQYXR0ZXJucykge1xuICAgICAgY29uc3QgbWF0Y2ggPSBjb250ZW50Lm1hdGNoKHBhdHRlcm4pXG4gICAgICBpZiAobWF0Y2gpIHtcbiAgICAgICAgcmV0dXJuIG1hdGNoWzFdLnRyaW0oKVxuICAgICAgfVxuICAgIH1cbiAgICBcbiAgICAvLyBGYWxsYmFja1xuICAgIGlmIChjb250ZW50LmluY2x1ZGVzKCc9JykpIHtcbiAgICAgIGNvbnN0IHBhcnRzID0gY29udGVudC5zcGxpdCgnPScpXG4gICAgICBpZiAocGFydHMubGVuZ3RoID49IDIpIHtcbiAgICAgICAgcmV0dXJuIGAke3BhcnRzWzBdLnRyaW0oKX0gPSAke3BhcnRzWzFdLnNwbGl0KC9bLiE/XS8pWzBdLnRyaW0oKX1gXG4gICAgICB9XG4gICAgfVxuICAgIFxuICAgIHJldHVybiAneSA9IGYoeCknXG4gIH1cblxuICAvKipcbiAgICogRXh0cmFjdHMgdmFyaWFibGVzIGZyb20gY29udGVudFxuICAgKi9cbiAgcHJpdmF0ZSBzdGF0aWMgZXh0cmFjdFZhcmlhYmxlcyhjb250ZW50OiBzdHJpbmcpOiBBcnJheTx7c3ltYm9sOiBzdHJpbmcsIGRlc2NyaXB0aW9uOiBzdHJpbmd9PiB7XG4gICAgY29uc3QgdmFyaWFibGVzOiBBcnJheTx7c3ltYm9sOiBzdHJpbmcsIGRlc2NyaXB0aW9uOiBzdHJpbmd9PiA9IFtdXG4gICAgXG4gICAgLy8gTG9vayBmb3IgdmFyaWFibGUgZGVmaW5pdGlvbnMgbGlrZSBcImRvbmRlIHggZXMuLi5cIlxuICAgIGNvbnN0IHZhclBhdHRlcm4gPSAvKFthLXpBLVpdKVxccytlc1xccysoW14uIT9dKykvZ2lcbiAgICBsZXQgbWF0Y2hcbiAgICBcbiAgICB3aGlsZSAoKG1hdGNoID0gdmFyUGF0dGVybi5leGVjKGNvbnRlbnQpKSAhPT0gbnVsbCAmJiB2YXJpYWJsZXMubGVuZ3RoIDwgNCkge1xuICAgICAgdmFyaWFibGVzLnB1c2goe1xuICAgICAgICBzeW1ib2w6IG1hdGNoWzFdLFxuICAgICAgICBkZXNjcmlwdGlvbjogbWF0Y2hbMl0udHJpbSgpXG4gICAgICB9KVxuICAgIH1cbiAgICBcbiAgICBpZiAodmFyaWFibGVzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgdmFyaWFibGVzLnB1c2goXG4gICAgICAgIHsgc3ltYm9sOiAneCcsIGRlc2NyaXB0aW9uOiAndmFyaWFibGUgaW5kZXBlbmRpZW50ZScgfSxcbiAgICAgICAgeyBzeW1ib2w6ICd5JywgZGVzY3JpcHRpb246ICd2YXJpYWJsZSBkZXBlbmRpZW50ZScgfVxuICAgICAgKVxuICAgIH1cbiAgICBcbiAgICByZXR1cm4gdmFyaWFibGVzXG4gIH1cblxuICAvKipcbiAgICogRXh0cmFjdHMgbW9sZWN1bGUgaW5mb3JtYXRpb25cbiAgICovXG4gIHByaXZhdGUgc3RhdGljIGV4dHJhY3RNb2xlY3VsZShjb250ZW50OiBzdHJpbmcpOiBzdHJpbmcge1xuICAgIGNvbnN0IG1vbGVjdWxlUGF0dGVybnMgPSBbXG4gICAgICAvKFtBLVpdW2Etel0/XFxkKikrL2csICAvLyBDaGVtaWNhbCBmb3JtdWxhIHBhdHRlcm5cbiAgICAgIC8oYWd1YXxtZXRhbm98ZGnDs3hpZG98Y2FyYm9ub3xveMOtZ2Vub3xoaWRyw7NnZW5vKS9pXG4gICAgXVxuICAgIFxuICAgIGZvciAoY29uc3QgcGF0dGVybiBvZiBtb2xlY3VsZVBhdHRlcm5zKSB7XG4gICAgICBjb25zdCBtYXRjaCA9IGNvbnRlbnQubWF0Y2gocGF0dGVybilcbiAgICAgIGlmIChtYXRjaCkge1xuICAgICAgICByZXR1cm4gbWF0Y2hbMF1cbiAgICAgIH1cbiAgICB9XG4gICAgXG4gICAgcmV0dXJuICdNb2zDqWN1bGEnXG4gIH1cblxuICAvKipcbiAgICogRXh0cmFjdHMgYXRvbXMgZnJvbSBjb250ZW50XG4gICAqL1xuICBwcml2YXRlIHN0YXRpYyBleHRyYWN0QXRvbXMoY29udGVudDogc3RyaW5nKTogc3RyaW5nW10ge1xuICAgIGNvbnN0IGF0b21TeW1ib2xzID0gY29udGVudC5tYXRjaCgvW0EtWl1bYS16XT8vZykgfHwgW11cbiAgICBjb25zdCB1bmlxdWVBdG9tcyA9IFsuLi5uZXcgU2V0KGF0b21TeW1ib2xzKV1cbiAgICBcbiAgICBpZiAodW5pcXVlQXRvbXMubGVuZ3RoID09PSAwKSB7XG4gICAgICByZXR1cm4gWydDJywgJ0gnLCAnTyddXG4gICAgfVxuICAgIFxuICAgIHJldHVybiB1bmlxdWVBdG9tcy5zbGljZSgwLCA1KVxuICB9XG5cbiAgLyoqXG4gICAqIEV4dHJhY3RzIHByb2Nlc3NlcyBmcm9tIGNvbnRlbnRcbiAgICovXG4gIHByaXZhdGUgc3RhdGljIGV4dHJhY3RQcm9jZXNzZXMoY29udGVudDogc3RyaW5nKTogc3RyaW5nW10ge1xuICAgIGNvbnN0IHByb2Nlc3NlcyA9IHRoaXMuZXh0cmFjdFN0ZXBzKGNvbnRlbnQpXG4gICAgcmV0dXJuIHByb2Nlc3Nlcy5sZW5ndGggPiAwID8gcHJvY2Vzc2VzIDogWydQcm9jZXNvIDEnLCAnUHJvY2VzbyAyJywgJ1Byb2Nlc28gMyddXG4gIH1cblxuICAvKipcbiAgICogRXh0cmFjdHMga2V5IHBvaW50cyBmcm9tIGNvbnRlbnRcbiAgICovXG4gIHByaXZhdGUgc3RhdGljIGV4dHJhY3RLZXlQb2ludHMoY29udGVudDogc3RyaW5nLCBsaW1pdDogbnVtYmVyID0gNCk6IHN0cmluZ1tdIHtcbiAgICBjb25zdCBzZW50ZW5jZXMgPSBjb250ZW50LnNwbGl0KC9bLiE/XSsvKVxuICAgIHJldHVybiBzZW50ZW5jZXNcbiAgICAgIC5maWx0ZXIocyA9PiBzLnRyaW0oKS5sZW5ndGggPiAxMClcbiAgICAgIC5zbGljZSgwLCBsaW1pdClcbiAgICAgIC5tYXAocyA9PiBzLnRyaW0oKSlcbiAgfVxuXG4gIC8vID09PT09IFRFWFQgRk9STUFUVElORyBVVElMSVRJRVMgPT09PT1cblxuICAvKipcbiAgICogQ2VudGVycyB0ZXh0IGluIGEgZml4ZWQgd2lkdGhcbiAgICovXG4gIHByaXZhdGUgc3RhdGljIGNlbnRlclRleHQodGV4dDogc3RyaW5nLCB3aWR0aDogbnVtYmVyKTogc3RyaW5nIHtcbiAgICBjb25zdCB0cnVuY2F0ZWQgPSB0aGlzLnRydW5jYXRlVGV4dCh0ZXh0LCB3aWR0aClcbiAgICBjb25zdCBwYWRkaW5nID0gTWF0aC5tYXgoMCwgd2lkdGggLSB0cnVuY2F0ZWQubGVuZ3RoKVxuICAgIGNvbnN0IGxlZnRQYWQgPSBNYXRoLmZsb29yKHBhZGRpbmcgLyAyKVxuICAgIGNvbnN0IHJpZ2h0UGFkID0gcGFkZGluZyAtIGxlZnRQYWRcbiAgICByZXR1cm4gJyAnLnJlcGVhdChsZWZ0UGFkKSArIHRydW5jYXRlZCArICcgJy5yZXBlYXQocmlnaHRQYWQpXG4gIH1cblxuICAvKipcbiAgICogTGVmdCBhbGlnbnMgdGV4dCBpbiBhIGZpeGVkIHdpZHRoXG4gICAqL1xuICBwcml2YXRlIHN0YXRpYyBsZWZ0QWxpZ24odGV4dDogc3RyaW5nLCB3aWR0aDogbnVtYmVyKTogc3RyaW5nIHtcbiAgICBjb25zdCB0cnVuY2F0ZWQgPSB0aGlzLnRydW5jYXRlVGV4dCh0ZXh0LCB3aWR0aClcbiAgICBjb25zdCBwYWRkaW5nID0gTWF0aC5tYXgoMCwgd2lkdGggLSB0cnVuY2F0ZWQubGVuZ3RoKVxuICAgIHJldHVybiB0cnVuY2F0ZWQgKyAnICcucmVwZWF0KHBhZGRpbmcpXG4gIH1cblxuICAvKipcbiAgICogVHJ1bmNhdGVzIHRleHQgdG8gZml0IHdpZHRoXG4gICAqL1xuICBwcml2YXRlIHN0YXRpYyB0cnVuY2F0ZVRleHQodGV4dDogc3RyaW5nLCBtYXhXaWR0aDogbnVtYmVyKTogc3RyaW5nIHtcbiAgICBpZiAodGV4dC5sZW5ndGggPD0gbWF4V2lkdGgpIHtcbiAgICAgIHJldHVybiB0ZXh0XG4gICAgfVxuICAgIHJldHVybiB0ZXh0LnN1YnN0cmluZygwLCBtYXhXaWR0aCAtIDMpICsgJy4uLidcbiAgfVxuXG4gIC8qKlxuICAgKiBNYWluIGVudHJ5IHBvaW50IC0gYW5hbHl6ZXMgY29udGVudCBhbmQgZ2VuZXJhdGVzIGFwcHJvcHJpYXRlIHZpc3VhbFxuICAgKi9cbiAgc3RhdGljIGdlbmVyYXRlT3B0aW1hbFZpc3VhbChjb250ZW50OiBzdHJpbmcsIHN1YmplY3Q/OiBzdHJpbmcpOiBWaXN1YWxSZXByZXNlbnRhdGlvbiB7XG4gICAgY29uc3Qgb3B0aW1hbFR5cGUgPSB0aGlzLmRldGVjdE9wdGltYWxWaXN1YWxUeXBlKGNvbnRlbnQsIHN1YmplY3QpXG4gICAgcmV0dXJuIHRoaXMuZ2VuZXJhdGVWaXN1YWwoY29udGVudCwgb3B0aW1hbFR5cGUsIHN1YmplY3QpXG4gIH1cblxuICAvKipcbiAgICogR2VuZXJhdGVzIG11bHRpcGxlIHZpc3VhbCBvcHRpb25zIGZvciB1c2VyIHRvIGNob29zZSBmcm9tXG4gICAqL1xuICBzdGF0aWMgZ2VuZXJhdGVWaXN1YWxPcHRpb25zKGNvbnRlbnQ6IHN0cmluZywgc3ViamVjdD86IHN0cmluZyk6IFZpc3VhbFJlcHJlc2VudGF0aW9uW10ge1xuICAgIGNvbnN0IHByaW1hcnlUeXBlID0gdGhpcy5kZXRlY3RPcHRpbWFsVmlzdWFsVHlwZShjb250ZW50LCBzdWJqZWN0KVxuICAgIGNvbnN0IG9wdGlvbnM6IFZpc3VhbFJlcHJlc2VudGF0aW9uW10gPSBbXG4gICAgICB0aGlzLmdlbmVyYXRlVmlzdWFsKGNvbnRlbnQsIHByaW1hcnlUeXBlLCBzdWJqZWN0KVxuICAgIF1cblxuICAgIC8vIEFkZCBhbHRlcm5hdGl2ZSB2aXN1YWxpemF0aW9uc1xuICAgIGNvbnN0IGFsdGVybmF0aXZlVHlwZXMgPSBbVmlzdWFsVHlwZS5DT05DRVBUX01BUCwgVmlzdWFsVHlwZS5GTE9XQ0hBUlQsIFZpc3VhbFR5cGUuRElBR1JBTV1cbiAgICBcbiAgICBmb3IgKGNvbnN0IHR5cGUgb2YgYWx0ZXJuYXRpdmVUeXBlcykge1xuICAgICAgaWYgKHR5cGUgIT09IHByaW1hcnlUeXBlICYmIG9wdGlvbnMubGVuZ3RoIDwgMykge1xuICAgICAgICBvcHRpb25zLnB1c2godGhpcy5nZW5lcmF0ZVZpc3VhbChjb250ZW50LCB0eXBlLCBzdWJqZWN0KSlcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gb3B0aW9uc1xuICB9XG59Il0sIm5hbWVzIjpbIlZpc3VhbFR5cGUiLCJWaXN1YWxMZWFybmluZ0VuZ2luZSIsImdlbmVyYXRlVmlzdWFsIiwiY29udGVudCIsInR5cGUiLCJzdWJqZWN0IiwiZ2VuZXJhdGVDb25jZXB0TWFwIiwiZ2VuZXJhdGVGbG93Y2hhcnQiLCJnZW5lcmF0ZUhpZXJhcmNoeSIsImdlbmVyYXRlVGltZWxpbmUiLCJnZW5lcmF0ZUZvcm11bGFWaXN1YWxpemF0aW9uIiwiZ2VuZXJhdGVDaGVtaWNhbFN0cnVjdHVyZSIsImdlbmVyYXRlUHJvY2Vzc0Zsb3ciLCJnZW5lcmF0ZUdlbmVyaWNEaWFncmFtIiwiZGV0ZWN0T3B0aW1hbFZpc3VhbFR5cGUiLCJjb250ZW50TG93ZXIiLCJ0b0xvd2VyQ2FzZSIsInRlc3QiLCJjb25jZXB0cyIsImV4dHJhY3RDb25jZXB0cyIsIm1haW5Db25jZXB0IiwicmVsYXRlZENvbmNlcHRzIiwic2xpY2UiLCJhc2NpaSIsImNlbnRlclRleHQiLCJmb3JFYWNoIiwiY29uY2VwdCIsImluZGV4IiwibGVuZ3RoIiwiZGVzY3JpcHRpb24iLCJlbGVtZW50cyIsIm1hcCIsImlkIiwidGl0bGUiLCJjb25uZWN0aW9ucyIsImluc3RydWN0aW9ucyIsInN0ZXBzIiwiZXh0cmFjdFN0ZXBzIiwic3RlcCIsInN0ZXBUZXh0IiwidHJ1bmNhdGVUZXh0IiwiaGllcmFyY2h5SXRlbXMiLCJleHRyYWN0SGllcmFyY2h5Iiwicm9vdCIsImNoaWxkcmVuIiwiZ3JhbmRjaGlsZHJlbiIsImNoaWxkIiwic3BhY2luZyIsIml0ZW0iLCJ0aW1lRXZlbnRzIiwiZXh0cmFjdFRpbWVsaW5lRXZlbnRzIiwiZXZlbnQiLCJldmVudFRleHQiLCJ0aW1lVGV4dCIsInRpbWUiLCJmb3JtdWxhIiwiZXh0cmFjdEZvcm11bGEiLCJ2YXJpYWJsZXMiLCJleHRyYWN0VmFyaWFibGVzIiwidmFyaWFibGUiLCJzeW1ib2wiLCJfIiwiY29uY2F0IiwibW9sZWN1bGUiLCJleHRyYWN0TW9sZWN1bGUiLCJhdG9tcyIsImV4dHJhY3RBdG9tcyIsImluY2x1ZGVzIiwiYXRvbSIsImpvaW4iLCJwcm9jZXNzZXMiLCJleHRyYWN0UHJvY2Vzc2VzIiwicHJvY2VzcyIsInByb2Nlc3NUZXh0Iiwia2V5UG9pbnRzIiwiZXh0cmFjdEtleVBvaW50cyIsInBvaW50IiwicG9pbnRUZXh0IiwibGVmdEFsaWduIiwic2VudGVuY2VzIiwic3BsaXQiLCJzZW50ZW5jZSIsIndvcmRzIiwidHJpbSIsImltcG9ydGFudFdvcmRzIiwiZmlsdGVyIiwid29yZCIsInB1c2giLCJzdGVwUGF0dGVybnMiLCJwYXR0ZXJuIiwibWF0Y2giLCJleGVjIiwicyIsImhpZXJhcmNoeVdvcmRzIiwiaXRlbXMiLCJjbGVhblNlbnRlbmNlIiwicmVwbGFjZSIsInRpbWVQYXR0ZXJuIiwiZXZlbnRzIiwidGltZU1hdGNoIiwia2V5RXZlbnRzIiwiZm9ybXVsYVBhdHRlcm5zIiwicGFydHMiLCJ2YXJQYXR0ZXJuIiwibW9sZWN1bGVQYXR0ZXJucyIsImF0b21TeW1ib2xzIiwidW5pcXVlQXRvbXMiLCJTZXQiLCJsaW1pdCIsInRleHQiLCJ3aWR0aCIsInRydW5jYXRlZCIsInBhZGRpbmciLCJNYXRoIiwibWF4IiwibGVmdFBhZCIsImZsb29yIiwicmlnaHRQYWQiLCJyZXBlYXQiLCJtYXhXaWR0aCIsInN1YnN0cmluZyIsImdlbmVyYXRlT3B0aW1hbFZpc3VhbCIsIm9wdGltYWxUeXBlIiwiZ2VuZXJhdGVWaXN1YWxPcHRpb25zIiwicHJpbWFyeVR5cGUiLCJvcHRpb25zIiwiYWx0ZXJuYXRpdmVUeXBlcyJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/visual-learning-engine.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/web-search-integration.ts":
/*!*******************************************!*\
  !*** ./src/lib/web-search-integration.ts ***!
  \*******************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   WebSearchIntegration: () => (/* binding */ WebSearchIntegration)\n/* harmony export */ });\n// Integración del WebSearch Tool con el Sistema Académico de Sara\n// Proporciona búsquedas web reales usando el WebSearch tool disponible\nclass WebSearchIntegration {\n    /**\n   * Realiza búsqueda web usando el WebSearch tool disponible\n   */ static async performWebSearch(query) {\n        try {\n            // En un entorno real, aquí se usaría el WebSearch tool\n            // Por ahora, simularemos resultados realistas hasta que se integre\n            console.log(`🔍 Web search query: ${query}`);\n            // TODO: Integrar con WebSearch tool real cuando esté disponible\n            // const webSearchResults = await WebSearch.search(query)\n            // Mientras tanto, generar resultados simulados basados en el query\n            return this.generateRealisticResults(query);\n        } catch (error) {\n            console.error('Error in web search:', error);\n            return this.generateFallbackResults(query);\n        }\n    }\n    /**\n   * Convierte query académico en query optimizado para web\n   */ static optimizeQueryForWeb(academicQuery) {\n        const { topic, subject, searchType, level, language } = academicQuery;\n        let webQuery = topic;\n        // Agregar contexto de materia\n        if (subject) {\n            webQuery = `${subject} ${webQuery}`;\n        }\n        // Agregar términos específicos según el tipo de búsqueda\n        const searchTypeTerms = {\n            explanation: language === 'es' ? 'explicación concepto tutorial' : 'explanation concept tutorial',\n            examples: language === 'es' ? 'ejemplos casos prácticos' : 'examples practical cases',\n            exercises: language === 'es' ? 'ejercicios problemas resueltos' : 'exercises solved problems',\n            resources: language === 'es' ? 'recursos materiales estudio' : 'resources study materials',\n            research: language === 'es' ? 'investigación papers académicos' : 'research academic papers'\n        };\n        webQuery += ` ${searchTypeTerms[searchType]}`;\n        // Agregar nivel de dificultad\n        if (level) {\n            const levelTerms = {\n                es: {\n                    basic: 'básico principiante',\n                    intermediate: 'intermedio',\n                    advanced: 'avanzado'\n                },\n                en: {\n                    basic: 'basic beginner',\n                    intermediate: 'intermediate',\n                    advanced: 'advanced'\n                }\n            };\n            webQuery += ` ${levelTerms[language || 'es'][level]}`;\n        }\n        // Agregar términos de calidad académica\n        const qualityTerms = language === 'es' ? 'educativo académico universidad' : 'educational academic university';\n        webQuery += ` ${qualityTerms}`;\n        return webQuery.trim();\n    }\n    /**\n   * Convierte resultados web en formato académico\n   */ static convertToAcademicResults(webResults, originalQuery) {\n        return webResults.map((result)=>({\n                title: result.title,\n                content: result.content || result.snippet || '',\n                source: this.extractDomain(result.url),\n                relevanceScore: this.calculateWebRelevance(result, originalQuery),\n                difficulty: this.inferDifficultyFromContent(result.content || result.snippet || '', originalQuery.level),\n                contentType: this.classifyWebContentType(result),\n                summary: this.generateContentSummary(result.content || result.snippet || ''),\n                keyPoints: this.extractWebKeyPoints(result.content || result.snippet || ''),\n                relatedTopics: this.identifyWebRelatedTopics(result.content || result.snippet || '', originalQuery.topic),\n                estimatedReadTime: this.estimateWebReadTime(result.content || result.snippet || '')\n            }));\n    }\n    /**\n   * Calcula relevancia específica para resultados web\n   */ static calculateWebRelevance(result, query) {\n        let score = 0.5;\n        const content = (result.content || result.snippet || '').toLowerCase();\n        const title = result.title.toLowerCase();\n        const topic = query.topic.toLowerCase();\n        const url = result.url.toLowerCase();\n        // Coincidencia en título (alta puntuación)\n        if (title.includes(topic)) score += 0.3;\n        // Coincidencia en contenido\n        if (content.includes(topic)) score += 0.2;\n        // Dominios educativos obtienen mayor puntuación\n        if (url.includes('edu') || url.includes('academic') || url.includes('university')) {\n            score += 0.3;\n        } else if (url.includes('wikipedia') || url.includes('khan')) {\n            score += 0.2;\n        }\n        // Contenido más largo generalmente es más útil\n        if (content.length > 300) score += 0.1;\n        // Penalizar contenido muy corto\n        if (content.length < 50) score -= 0.2;\n        return Math.max(0, Math.min(1, score));\n    }\n    /**\n   * Clasifica el tipo de contenido web\n   */ static classifyWebContentType(result) {\n        const content = (result.content || result.snippet || '').toLowerCase();\n        const title = result.title.toLowerCase();\n        const url = result.url.toLowerCase();\n        if (url.includes('youtube') || url.includes('vimeo') || content.includes('video')) {\n            return 'video';\n        }\n        if (content.includes('ejercicio') || content.includes('problema') || title.includes('exercise')) {\n            return 'exercise';\n        }\n        if (url.includes('scholar') || content.includes('research') || content.includes('journal')) {\n            return 'academic_paper';\n        }\n        if (content.includes('tutorial') || content.includes('how to') || title.includes('guía')) {\n            return 'tutorial';\n        }\n        return 'article';\n    }\n    /**\n   * Genera resultados realistas para desarrollo y testing\n   */ static generateRealisticResults(query) {\n        const queryLower = query.toLowerCase();\n        // Generar resultados específicos según el tipo de consulta\n        const results = [];\n        if (queryLower.includes('matemáticas') || queryLower.includes('mathematics')) {\n            results.push({\n                title: 'Khan Academy - Matemáticas Gratuitas',\n                content: 'Aprende matemáticas de forma gratuita con ejercicios interactivos, videos y artículos. Desde aritmética básica hasta cálculo avanzado.',\n                url: 'https://es.khanacademy.org/math',\n                snippet: 'Plataforma educativa con cursos completos de matemáticas para todos los niveles.'\n            }, {\n                title: 'Matemáticas Universitarias - MIT OpenCourseWare',\n                content: 'Cursos completos del MIT sobre matemáticas universitarias incluyendo álgebra lineal, cálculo y matemáticas discretas.',\n                url: 'https://ocw.mit.edu/courses/mathematics/',\n                snippet: 'Recursos académicos de alta calidad del MIT para matemáticas avanzadas.'\n            });\n        }\n        if (queryLower.includes('química') || queryLower.includes('chemistry')) {\n            results.push({\n                title: 'LibreTexts Química - Recursos Educativos',\n                content: 'Biblioteca completa de textos de química con explicaciones detalladas, ejemplos y problemas resueltos.',\n                url: 'https://chem.libretexts.org/',\n                snippet: 'Textos académicos gratuitos sobre química general, orgánica e inorgánica.'\n            }, {\n                title: 'ChemSketch - Simulador de Reacciones',\n                content: 'Herramienta para simular reacciones químicas y entender mecanismos moleculares de forma visual.',\n                url: 'https://www.acdlabs.com/resources/free-chemistry-software-apps/',\n                snippet: 'Software gratuito para modelado molecular y simulación química.'\n            });\n        }\n        if (queryLower.includes('física') || queryLower.includes('physics')) {\n            results.push({\n                title: 'Physics Classroom - Conceptos de Física',\n                content: 'Tutoriales interactivos sobre conceptos fundamentales de física con simulaciones y experimentos virtuales.',\n                url: 'https://www.physicsclassroom.com/',\n                snippet: 'Recurso educativo para entender física desde conceptos básicos hasta avanzados.'\n            }, {\n                title: 'PhET Simulaciones Interactivas',\n                content: 'Simulaciones gratuitas de física, química y matemáticas desarrolladas por la Universidad de Colorado.',\n                url: 'https://phet.colorado.edu/es/',\n                snippet: 'Simulaciones interactivas para visualizar conceptos científicos complejos.'\n            });\n        }\n        // Resultados genéricos educativos\n        if (results.length === 0) {\n            results.push({\n                title: `Guía Completa: ${query}`,\n                content: `Explicación exhaustiva sobre ${query} con ejemplos prácticos, ejercicios resueltos y recursos adicionales para profundizar en el tema.`,\n                url: 'https://academia.edu/topics/' + encodeURIComponent(query),\n                snippet: `Recurso académico completo sobre ${query} con contenido verificado por expertos.`\n            }, {\n                title: `Tutorial Paso a Paso: ${query}`,\n                content: `Aprende ${query} de manera estructurada con explicaciones claras, ejemplos visuales y ejercicios progresivos.`,\n                url: 'https://coursera.org/learn/' + encodeURIComponent(query),\n                snippet: `Curso en línea con metodología probada para dominar ${query}.`\n            }, {\n                title: `${query} - Recursos y Herramientas`,\n                content: `Colección curada de los mejores recursos, herramientas y materiales de estudio para ${query}.`,\n                url: 'https://edx.org/course/' + encodeURIComponent(query),\n                snippet: `Recursos educativos de universidades prestigiosas sobre ${query}.`\n            });\n        }\n        return results;\n    }\n    /**\n   * Genera resultados de respaldo cuando la búsqueda falla\n   */ static generateFallbackResults(query) {\n        return [\n            {\n                title: 'Recurso Educativo Local',\n                content: `Información básica sobre ${query}. Considera consultar tu biblioteca local o recursos académicos institucionales.`,\n                url: 'local://academic-resources',\n                snippet: `Recurso de respaldo para ${query} cuando la búsqueda web no está disponible.`\n            }\n        ];\n    }\n    /**\n   * Infiere dificultad del contenido web\n   */ static inferDifficultyFromContent(content, suggestedLevel) {\n        if (suggestedLevel) return suggestedLevel;\n        const lowerContent = content.toLowerCase();\n        // Indicadores de nivel básico\n        const basicIndicators = [\n            'básico',\n            'introducción',\n            'principiante',\n            'simple',\n            'elementary'\n        ];\n        const basicCount = basicIndicators.filter((indicator)=>lowerContent.includes(indicator)).length;\n        // Indicadores de nivel avanzado\n        const advancedIndicators = [\n            'avanzado',\n            'complejo',\n            'doctoral',\n            'research',\n            'graduate'\n        ];\n        const advancedCount = advancedIndicators.filter((indicator)=>lowerContent.includes(indicator)).length;\n        if (advancedCount > basicCount) return 'advanced';\n        if (basicCount > 0) return 'basic';\n        return 'intermediate';\n    }\n    /**\n   * Genera resumen del contenido web\n   */ static generateContentSummary(content) {\n        if (!content || content.length < 20) {\n            return 'Recurso educativo disponible para consulta.';\n        }\n        const sentences = content.split(/[.!?]+/).filter((s)=>s.trim().length > 15);\n        const firstSentences = sentences.slice(0, 2).join('. ');\n        if (firstSentences.length > 200) {\n            return firstSentences.substring(0, 197) + '...';\n        }\n        return firstSentences || 'Contenido educativo sobre el tema consultado.';\n    }\n    /**\n   * Extrae puntos clave del contenido web\n   */ static extractWebKeyPoints(content) {\n        if (!content || content.length < 50) {\n            return [\n                'Información disponible en el recurso'\n            ];\n        }\n        const keyPoints = [];\n        // Buscar listas o puntos numerados\n        const listItems = content.match(/(?:^|\\n)\\s*[\\d\\-\\*\\•]\\s*([^\\n]+)/g);\n        if (listItems && listItems.length > 0) {\n            keyPoints.push(...listItems.slice(0, 3).map((item)=>item.replace(/^[\\s\\d\\-\\*\\•]+/, '').trim()));\n        }\n        // Si no hay listas, extraer oraciones importantes\n        if (keyPoints.length === 0) {\n            const sentences = content.split(/[.!?]+/).filter((s)=>s.length > 20 && s.length < 120).slice(0, 3);\n            keyPoints.push(...sentences.map((s)=>s.trim()));\n        }\n        return keyPoints.filter((point)=>point.length > 5);\n    }\n    /**\n   * Identifica temas relacionados del contenido web\n   */ static identifyWebRelatedTopics(content, mainTopic) {\n        const relatedTopics = [];\n        const lowerContent = content.toLowerCase();\n        const lowerTopic = mainTopic.toLowerCase();\n        // Diccionario expandido de relaciones temáticas\n        const topicRelations = {\n            'matemáticas': [\n                'álgebra',\n                'geometría',\n                'cálculo',\n                'estadística',\n                'trigonometría',\n                'aritmética'\n            ],\n            'física': [\n                'mecánica',\n                'termodinámica',\n                'electromagnetismo',\n                'óptica',\n                'ondas',\n                'energía'\n            ],\n            'química': [\n                'orgánica',\n                'inorgánica',\n                'analítica',\n                'bioquímica',\n                'reacciones',\n                'moléculas'\n            ],\n            'programación': [\n                'algoritmos',\n                'estructuras de datos',\n                'desarrollo web',\n                'inteligencia artificial',\n                'bases de datos'\n            ],\n            'biología': [\n                'genética',\n                'evolución',\n                'ecología',\n                'anatomía',\n                'fisiología',\n                'microbiología'\n            ],\n            'historia': [\n                'cronología',\n                'civilizaciones',\n                'guerras',\n                'cultura',\n                'política',\n                'economía'\n            ]\n        };\n        // Buscar relaciones directas\n        for (const [subject, relations] of Object.entries(topicRelations)){\n            if (lowerTopic.includes(subject) || lowerContent.includes(subject)) {\n                const foundRelations = relations.filter((relation)=>lowerContent.includes(relation) && !lowerTopic.includes(relation));\n                relatedTopics.push(...foundRelations);\n            }\n        }\n        return Array.from(new Set(relatedTopics)).slice(0, 4);\n    }\n    /**\n   * Estima tiempo de lectura del contenido web\n   */ static estimateWebReadTime(content) {\n        if (!content) return 1;\n        const wordsPerMinute = 200 // Velocidad promedio de lectura\n        ;\n        const wordCount = content.split(/\\s+/).length;\n        return Math.max(1, Math.ceil(wordCount / wordsPerMinute));\n    }\n    /**\n   * Extrae dominio de URL\n   */ static extractDomain(url) {\n        try {\n            const urlObj = new URL(url);\n            return urlObj.hostname.replace('www.', '');\n        } catch  {\n            return 'fuente web';\n        }\n    }\n    /**\n   * Integra búsqueda web con el sistema académico completo\n   */ static async performAcademicWebSearch(query) {\n        const startTime = Date.now();\n        try {\n            // Optimizar query para búsqueda web\n            const webQuery = this.optimizeQueryForWeb(query);\n            // Realizar búsqueda web\n            const webResults = await this.performWebSearch(webQuery);\n            // Convertir a formato académico\n            const academicResults = this.convertToAcademicResults(webResults, query);\n            // Calcular tiempo de búsqueda\n            const searchTime = Date.now() - startTime;\n            return {\n                query,\n                results: academicResults,\n                searchSuccess: academicResults.length > 0,\n                totalResults: academicResults.length,\n                searchTime,\n                personalizedRecommendations: this.generateWebRecommendations(academicResults, query),\n                followUpQuestions: this.generateWebFollowUps(query, academicResults),\n                suggestedActions: this.generateWebActions(academicResults)\n            };\n        } catch (error) {\n            console.error('Error in academic web search:', error);\n            return {\n                query,\n                results: [],\n                searchSuccess: false,\n                totalResults: 0,\n                searchTime: Date.now() - startTime,\n                personalizedRecommendations: [\n                    `Buscar \"${query.topic}\" en recursos académicos locales`\n                ],\n                followUpQuestions: [\n                    '¿Te gustaría que reformule la búsqueda?'\n                ],\n                suggestedActions: [\n                    'Verificar conexión a internet',\n                    'Intentar con términos más específicos'\n                ]\n            };\n        }\n    }\n    /**\n   * Genera recomendaciones basadas en resultados web\n   */ static generateWebRecommendations(results, query) {\n        const recommendations = [];\n        if (results.length === 0) {\n            recommendations.push(`No encontré resultados específicos para \"${query.topic}\". Te sugiero reformular la búsqueda.`);\n            return recommendations;\n        }\n        const hasVideos = results.some((r)=>r.contentType === 'video');\n        const hasExercises = results.some((r)=>r.contentType === 'exercise');\n        const highQualitySources = results.filter((r)=>r.relevanceScore > 0.7);\n        if (hasVideos) {\n            recommendations.push('Encontré videos explicativos que pueden ayudarte a visualizar los conceptos');\n        }\n        if (hasExercises) {\n            recommendations.push('Hay ejercicios prácticos disponibles para reforzar tu aprendizaje');\n        }\n        if (highQualitySources.length > 0) {\n            recommendations.push(`Identifiqué ${highQualitySources.length} fuentes de alta calidad académica`);\n        }\n        return recommendations;\n    }\n    /**\n   * Genera preguntas de seguimiento basadas en búsqueda web\n   */ static generateWebFollowUps(query, results) {\n        const followUps = [];\n        if (results.length > 0) {\n            followUps.push(`¿Te gustaría que profundice en algún aspecto específico de ${query.topic}?`);\n            const relatedTopics = Array.from(new Set(results.flatMap((r)=>r.relatedTopics))).slice(0, 2);\n            if (relatedTopics.length > 0) {\n                followUps.push(`¿Te interesa explorar ${relatedTopics.join(' o ')}?`);\n            }\n            if (query.searchType === 'explanation') {\n                followUps.push('¿Necesitas ejemplos prácticos para este tema?');\n            }\n        }\n        return followUps;\n    }\n    /**\n   * Genera acciones sugeridas basadas en resultados web\n   */ static generateWebActions(results) {\n        const actions = [];\n        if (results.length > 0) {\n            actions.push('Revisar los recursos encontrados por orden de relevancia');\n            const videos = results.filter((r)=>r.contentType === 'video');\n            if (videos.length > 0) {\n                actions.push('Ver videos explicativos para comprensión visual');\n            }\n            const exercises = results.filter((r)=>r.contentType === 'exercise');\n            if (exercises.length > 0) {\n                actions.push('Practicar con ejercicios encontrados');\n            }\n            actions.push('Tomar notas de los puntos clave identificados');\n        }\n        return actions;\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvbGliL3dlYi1zZWFyY2gtaW50ZWdyYXRpb24udHMiLCJtYXBwaW5ncyI6Ijs7OztBQUFBLGtFQUFrRTtBQUNsRSx1RUFBdUU7QUFZaEUsTUFBTUE7SUFFWDs7R0FFQyxHQUNELGFBQWFDLGlCQUFpQkMsS0FBYSxFQUE4QjtRQUN2RSxJQUFJO1lBQ0YsdURBQXVEO1lBQ3ZELG1FQUFtRTtZQUNuRUMsUUFBUUMsR0FBRyxDQUFDLENBQUMscUJBQXFCLEVBQUVGLE9BQU87WUFFM0MsZ0VBQWdFO1lBQ2hFLHlEQUF5RDtZQUV6RCxtRUFBbUU7WUFDbkUsT0FBTyxJQUFJLENBQUNHLHdCQUF3QixDQUFDSDtRQUV2QyxFQUFFLE9BQU9JLE9BQU87WUFDZEgsUUFBUUcsS0FBSyxDQUFDLHdCQUF3QkE7WUFDdEMsT0FBTyxJQUFJLENBQUNDLHVCQUF1QixDQUFDTDtRQUN0QztJQUNGO0lBRUE7O0dBRUMsR0FDRCxPQUFPTSxvQkFBb0JDLGFBQWtDLEVBQVU7UUFDckUsTUFBTSxFQUFFQyxLQUFLLEVBQUVDLE9BQU8sRUFBRUMsVUFBVSxFQUFFQyxLQUFLLEVBQUVDLFFBQVEsRUFBRSxHQUFHTDtRQUV4RCxJQUFJTSxXQUFXTDtRQUVmLDhCQUE4QjtRQUM5QixJQUFJQyxTQUFTO1lBQ1hJLFdBQVcsR0FBR0osUUFBUSxDQUFDLEVBQUVJLFVBQVU7UUFDckM7UUFFQSx5REFBeUQ7UUFDekQsTUFBTUMsa0JBQWtCO1lBQ3RCQyxhQUFhSCxhQUFhLE9BQU8sa0NBQWtDO1lBQ25FSSxVQUFVSixhQUFhLE9BQU8sNkJBQTZCO1lBQzNESyxXQUFXTCxhQUFhLE9BQU8sbUNBQW1DO1lBQ2xFTSxXQUFXTixhQUFhLE9BQU8sZ0NBQWdDO1lBQy9ETyxVQUFVUCxhQUFhLE9BQU8sb0NBQW9DO1FBQ3BFO1FBRUFDLFlBQVksQ0FBQyxDQUFDLEVBQUVDLGVBQWUsQ0FBQ0osV0FBVyxFQUFFO1FBRTdDLDhCQUE4QjtRQUM5QixJQUFJQyxPQUFPO1lBQ1QsTUFBTVMsYUFB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b3VyY2VzIjpbIi9Vc2Vycy9yb2RyaWdvZGliZXJuYXJkbzMzZ21haWwuY29tL0RvY3VtZW50cy9BcHAgRGV2ZWxvcG1lbnQgUHJveWVjdHMvSW50ZWxsZWdvIFBsYXRmb3JtL3NyYy9saWIvd2ViLXNlYXJjaC1pbnRlZ3JhdGlvbi50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBJbnRlZ3JhY2nDs24gZGVsIFdlYlNlYXJjaCBUb29sIGNvbiBlbCBTaXN0ZW1hIEFjYWTDqW1pY28gZGUgU2FyYVxuLy8gUHJvcG9yY2lvbmEgYsO6c3F1ZWRhcyB3ZWIgcmVhbGVzIHVzYW5kbyBlbCBXZWJTZWFyY2ggdG9vbCBkaXNwb25pYmxlXG5cbmltcG9ydCB7IEFjYWRlbWljU2VhcmNoUXVlcnksIEFjYWRlbWljU2VhcmNoUmVzdWx0LCBTZWFyY2hBbmFseXNpcyB9IGZyb20gJy4vYWNhZGVtaWMtc2VhcmNoLWVuZ2luZSdcblxuZXhwb3J0IGludGVyZmFjZSBXZWJTZWFyY2hSZXN1bHQge1xuICB0aXRsZTogc3RyaW5nXG4gIGNvbnRlbnQ6IHN0cmluZ1xuICB1cmw6IHN0cmluZ1xuICBzbmlwcGV0Pzogc3RyaW5nXG4gIHNvdXJjZT86IHN0cmluZ1xufVxuXG5leHBvcnQgY2xhc3MgV2ViU2VhcmNoSW50ZWdyYXRpb24ge1xuICBcbiAgLyoqXG4gICAqIFJlYWxpemEgYsO6c3F1ZWRhIHdlYiB1c2FuZG8gZWwgV2ViU2VhcmNoIHRvb2wgZGlzcG9uaWJsZVxuICAgKi9cbiAgc3RhdGljIGFzeW5jIHBlcmZvcm1XZWJTZWFyY2gocXVlcnk6IHN0cmluZyk6IFByb21pc2U8V2ViU2VhcmNoUmVzdWx0W10+IHtcbiAgICB0cnkge1xuICAgICAgLy8gRW4gdW4gZW50b3JubyByZWFsLCBhcXXDrSBzZSB1c2Fyw61hIGVsIFdlYlNlYXJjaCB0b29sXG4gICAgICAvLyBQb3IgYWhvcmEsIHNpbXVsYXJlbW9zIHJlc3VsdGFkb3MgcmVhbGlzdGFzIGhhc3RhIHF1ZSBzZSBpbnRlZ3JlXG4gICAgICBjb25zb2xlLmxvZyhg8J+UjSBXZWIgc2VhcmNoIHF1ZXJ5OiAke3F1ZXJ5fWApXG4gICAgICBcbiAgICAgIC8vIFRPRE86IEludGVncmFyIGNvbiBXZWJTZWFyY2ggdG9vbCByZWFsIGN1YW5kbyBlc3TDqSBkaXNwb25pYmxlXG4gICAgICAvLyBjb25zdCB3ZWJTZWFyY2hSZXN1bHRzID0gYXdhaXQgV2ViU2VhcmNoLnNlYXJjaChxdWVyeSlcbiAgICAgIFxuICAgICAgLy8gTWllbnRyYXMgdGFudG8sIGdlbmVyYXIgcmVzdWx0YWRvcyBzaW11bGFkb3MgYmFzYWRvcyBlbiBlbCBxdWVyeVxuICAgICAgcmV0dXJuIHRoaXMuZ2VuZXJhdGVSZWFsaXN0aWNSZXN1bHRzKHF1ZXJ5KVxuICAgICAgXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGluIHdlYiBzZWFyY2g6JywgZXJyb3IpXG4gICAgICByZXR1cm4gdGhpcy5nZW5lcmF0ZUZhbGxiYWNrUmVzdWx0cyhxdWVyeSlcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogQ29udmllcnRlIHF1ZXJ5IGFjYWTDqW1pY28gZW4gcXVlcnkgb3B0aW1pemFkbyBwYXJhIHdlYlxuICAgKi9cbiAgc3RhdGljIG9wdGltaXplUXVlcnlGb3JXZWIoYWNhZGVtaWNRdWVyeTogQWNhZGVtaWNTZWFyY2hRdWVyeSk6IHN0cmluZyB7XG4gICAgY29uc3QgeyB0b3BpYywgc3ViamVjdCwgc2VhcmNoVHlwZSwgbGV2ZWwsIGxhbmd1YWdlIH0gPSBhY2FkZW1pY1F1ZXJ5XG4gICAgXG4gICAgbGV0IHdlYlF1ZXJ5ID0gdG9waWNcblxuICAgIC8vIEFncmVnYXIgY29udGV4dG8gZGUgbWF0ZXJpYVxuICAgIGlmIChzdWJqZWN0KSB7XG4gICAgICB3ZWJRdWVyeSA9IGAke3N1YmplY3R9ICR7d2ViUXVlcnl9YFxuICAgIH1cblxuICAgIC8vIEFncmVnYXIgdMOpcm1pbm9zIGVzcGVjw61maWNvcyBzZWfDum4gZWwgdGlwbyBkZSBiw7pzcXVlZGFcbiAgICBjb25zdCBzZWFyY2hUeXBlVGVybXMgPSB7XG4gICAgICBleHBsYW5hdGlvbjogbGFuZ3VhZ2UgPT09ICdlcycgPyAnZXhwbGljYWNpw7NuIGNvbmNlcHRvIHR1dG9yaWFsJyA6ICdleHBsYW5hdGlvbiBjb25jZXB0IHR1dG9yaWFsJyxcbiAgICAgIGV4YW1wbGVzOiBsYW5ndWFnZSA9PT0gJ2VzJyA/ICdlamVtcGxvcyBjYXNvcyBwcsOhY3RpY29zJyA6ICdleGFtcGxlcyBwcmFjdGljYWwgY2FzZXMnLFxuICAgICAgZXhlcmNpc2VzOiBsYW5ndWFnZSA9PT0gJ2VzJyA/ICdlamVyY2ljaW9zIHByb2JsZW1hcyByZXN1ZWx0b3MnIDogJ2V4ZXJjaXNlcyBzb2x2ZWQgcHJvYmxlbXMnLFxuICAgICAgcmVzb3VyY2VzOiBsYW5ndWFnZSA9PT0gJ2VzJyA/ICdyZWN1cnNvcyBtYXRlcmlhbGVzIGVzdHVkaW8nIDogJ3Jlc291cmNlcyBzdHVkeSBtYXRlcmlhbHMnLFxuICAgICAgcmVzZWFyY2g6IGxhbmd1YWdlID09PSAnZXMnID8gJ2ludmVzdGlnYWNpw7NuIHBhcGVycyBhY2Fkw6ltaWNvcycgOiAncmVzZWFyY2ggYWNhZGVtaWMgcGFwZXJzJ1xuICAgIH1cbiAgICBcbiAgICB3ZWJRdWVyeSArPSBgICR7c2VhcmNoVHlwZVRlcm1zW3NlYXJjaFR5cGVdfWBcblxuICAgIC8vIEFncmVnYXIgbml2ZWwgZGUgZGlmaWN1bHRhZFxuICAgIGlmIChsZXZlbCkge1xuICAgICAgY29uc3QgbGV2ZWxUZXJtcyA9IHtcbiAgICAgICAgZXM6IHsgYmFzaWM6ICdiw6FzaWNvIHByaW5jaXBpYW50ZScsIGludGVybWVkaWF0ZTogJ2ludGVybWVkaW8nLCBhZHZhbmNlZDogJ2F2YW56YWRvJyB9LFxuICAgICAgICBlbjogeyBiYXNpYzogJ2Jhc2ljIGJlZ2lubmVyJywgaW50ZXJtZWRpYXRlOiAnaW50ZXJtZWRpYXRlJywgYWR2YW5jZWQ6ICdhZHZhbmNlZCcgfVxuICAgICAgfVxuICAgICAgd2ViUXVlcnkgKz0gYCAke2xldmVsVGVybXNbbGFuZ3VhZ2UgfHwgJ2VzJ11bbGV2ZWxdfWBcbiAgICB9XG5cbiAgICAvLyBBZ3JlZ2FyIHTDqXJtaW5vcyBkZSBjYWxpZGFkIGFjYWTDqW1pY2FcbiAgICBjb25zdCBxdWFsaXR5VGVybXMgPSBsYW5ndWFnZSA9PT0gJ2VzJyBcbiAgICAgID8gJ2VkdWNhdGl2byBhY2Fkw6ltaWNvIHVuaXZlcnNpZGFkJyBcbiAgICAgIDogJ2VkdWNhdGlvbmFsIGFjYWRlbWljIHVuaXZlcnNpdHknXG4gICAgd2ViUXVlcnkgKz0gYCAke3F1YWxpdHlUZXJtc31gXG5cbiAgICByZXR1cm4gd2ViUXVlcnkudHJpbSgpXG4gIH1cblxuICAvKipcbiAgICogQ29udmllcnRlIHJlc3VsdGFkb3Mgd2ViIGVuIGZvcm1hdG8gYWNhZMOpbWljb1xuICAgKi9cbiAgc3RhdGljIGNvbnZlcnRUb0FjYWRlbWljUmVzdWx0cyhcbiAgICB3ZWJSZXN1bHRzOiBXZWJTZWFyY2hSZXN1bHRbXSwgXG4gICAgb3JpZ2luYWxRdWVyeTogQWNhZGVtaWNTZWFyY2hRdWVyeVxuICApOiBBY2FkZW1pY1NlYXJjaFJlc3VsdFtdIHtcbiAgICByZXR1cm4gd2ViUmVzdWx0cy5tYXAocmVzdWx0ID0+ICh7XG4gICAgICB0aXRsZTogcmVzdWx0LnRpdGxlLFxuICAgICAgY29udGVudDogcmVzdWx0LmNvbnRlbnQgfHwgcmVzdWx0LnNuaXBwZXQgfHwgJycsXG4gICAgICBzb3VyY2U6IHRoaXMuZXh0cmFjdERvbWFpbihyZXN1bHQudXJsKSxcbiAgICAgIHJlbGV2YW5jZVNjb3JlOiB0aGlzLmNhbGN1bGF0ZVdlYlJlbGV2YW5jZShyZXN1bHQsIG9yaWdpbmFsUXVlcnkpLFxuICAgICAgZGlmZmljdWx0eTogdGhpcy5pbmZlckRpZmZpY3VsdHlGcm9tQ29udGVudChyZXN1bHQuY29udGVudCB8fCByZXN1bHQuc25pcHBldCB8fCAnJywgb3JpZ2luYWxRdWVyeS5sZXZlbCksXG4gICAgICBjb250ZW50VHlwZTogdGhpcy5jbGFzc2lmeVdlYkNvbnRlbnRUeXBlKHJlc3VsdCksXG4gICAgICBzdW1tYXJ5OiB0aGlzLmdlbmVyYXRlQ29udGVudFN1bW1hcnkocmVzdWx0LmNvbnRlbnQgfHwgcmVzdWx0LnNuaXBwZXQgfHwgJycpLFxuICAgICAga2V5UG9pbnRzOiB0aGlzLmV4dHJhY3RXZWJLZXlQb2ludHMocmVzdWx0LmNvbnRlbnQgfHwgcmVzdWx0LnNuaXBwZXQgfHwgJycpLFxuICAgICAgcmVsYXRlZFRvcGljczogdGhpcy5pZGVudGlmeVdlYlJlbGF0ZWRUb3BpY3MocmVzdWx0LmNvbnRlbnQgfHwgcmVzdWx0LnNuaXBwZXQgfHwgJycsIG9yaWdpbmFsUXVlcnkudG9waWMpLFxuICAgICAgZXN0aW1hdGVkUmVhZFRpbWU6IHRoaXMuZXN0aW1hdGVXZWJSZWFkVGltZShyZXN1bHQuY29udGVudCB8fCByZXN1bHQuc25pcHBldCB8fCAnJylcbiAgICB9KSlcbiAgfVxuXG4gIC8qKlxuICAgKiBDYWxjdWxhIHJlbGV2YW5jaWEgZXNwZWPDrWZpY2EgcGFyYSByZXN1bHRhZG9zIHdlYlxuICAgKi9cbiAgcHJpdmF0ZSBzdGF0aWMgY2FsY3VsYXRlV2ViUmVsZXZhbmNlKHJlc3VsdDogV2ViU2VhcmNoUmVzdWx0LCBxdWVyeTogQWNhZGVtaWNTZWFyY2hRdWVyeSk6IG51bWJlciB7XG4gICAgbGV0IHNjb3JlID0gMC41XG4gICAgXG4gICAgY29uc3QgY29udGVudCA9IChyZXN1bHQuY29udGVudCB8fCByZXN1bHQuc25pcHBldCB8fCAnJykudG9Mb3dlckNhc2UoKVxuICAgIGNvbnN0IHRpdGxlID0gcmVzdWx0LnRpdGxlLnRvTG93ZXJDYXNlKClcbiAgICBjb25zdCB0b3BpYyA9IHF1ZXJ5LnRvcGljLnRvTG93ZXJDYXNlKClcbiAgICBjb25zdCB1cmwgPSByZXN1bHQudXJsLnRvTG93ZXJDYXNlKClcblxuICAgIC8vIENvaW5jaWRlbmNpYSBlbiB0w610dWxvIChhbHRhIHB1bnR1YWNpw7NuKVxuICAgIGlmICh0aXRsZS5pbmNsdWRlcyh0b3BpYykpIHNjb3JlICs9IDAuM1xuICAgIFxuICAgIC8vIENvaW5jaWRlbmNpYSBlbiBjb250ZW5pZG9cbiAgICBpZiAoY29udGVudC5pbmNsdWRlcyh0b3BpYykpIHNjb3JlICs9IDAuMlxuICAgIFxuICAgIC8vIERvbWluaW9zIGVkdWNhdGl2b3Mgb2J0aWVuZW4gbWF5b3IgcHVudHVhY2nDs25cbiAgICBpZiAodXJsLmluY2x1ZGVzKCdlZHUnKSB8fCB1cmwuaW5jbHVkZXMoJ2FjYWRlbWljJykgfHwgdXJsLmluY2x1ZGVzKCd1bml2ZXJzaXR5JykpIHtcbiAgICAgIHNjb3JlICs9IDAuM1xuICAgIH0gZWxzZSBpZiAodXJsLmluY2x1ZGVzKCd3aWtpcGVkaWEnKSB8fCB1cmwuaW5jbHVkZXMoJ2toYW4nKSkge1xuICAgICAgc2NvcmUgKz0gMC4yXG4gICAgfVxuXG4gICAgLy8gQ29udGVuaWRvIG3DoXMgbGFyZ28gZ2VuZXJhbG1lbnRlIGVzIG3DoXMgw7p0aWxcbiAgICBpZiAoY29udGVudC5sZW5ndGggPiAzMDApIHNjb3JlICs9IDAuMVxuICAgIFxuICAgIC8vIFBlbmFsaXphciBjb250ZW5pZG8gbXV5IGNvcnRvXG4gICAgaWYgKGNvbnRlbnQubGVuZ3RoIDwgNTApIHNjb3JlIC09IDAuMlxuICAgIFxuICAgIHJldHVybiBNYXRoLm1heCgwLCBNYXRoLm1pbigxLCBzY29yZSkpXG4gIH1cblxuICAvKipcbiAgICogQ2xhc2lmaWNhIGVsIHRpcG8gZGUgY29udGVuaWRvIHdlYlxuICAgKi9cbiAgcHJpdmF0ZSBzdGF0aWMgY2xhc3NpZnlXZWJDb250ZW50VHlwZShyZXN1bHQ6IFdlYlNlYXJjaFJlc3VsdCk6IEFjYWRlbWljU2VhcmNoUmVzdWx0Wydjb250ZW50VHlwZSddIHtcbiAgICBjb25zdCBjb250ZW50ID0gKHJlc3VsdC5jb250ZW50IHx8IHJlc3VsdC5zbmlwcGV0IHx8ICcnKS50b0xvd2VyQ2FzZSgpXG4gICAgY29uc3QgdGl0bGUgPSByZXN1bHQudGl0bGUudG9Mb3dlckNhc2UoKVxuICAgIGNvbnN0IHVybCA9IHJlc3VsdC51cmwudG9Mb3dlckNhc2UoKVxuXG4gICAgaWYgKHVybC5pbmNsdWRlcygneW91dHViZScpIHx8IHVybC5pbmNsdWRlcygndmltZW8nKSB8fCBjb250ZW50LmluY2x1ZGVzKCd2aWRlbycpKSB7XG4gICAgICByZXR1cm4gJ3ZpZGVvJ1xuICAgIH1cbiAgICBcbiAgICBpZiAoY29udGVudC5pbmNsdWRlcygnZWplcmNpY2lvJykgfHwgY29udGVudC5pbmNsdWRlcygncHJvYmxlbWEnKSB8fCB0aXRsZS5pbmNsdWRlcygnZXhlcmNpc2UnKSkge1xuICAgICAgcmV0dXJuICdleGVyY2lzZSdcbiAgICB9XG4gICAgXG4gICAgaWYgKHVybC5pbmNsdWRlcygnc2Nob2xhcicpIHx8IGNvbnRlbnQuaW5jbHVkZXMoJ3Jlc2VhcmNoJykgfHwgY29udGVudC5pbmNsdWRlcygnam91cm5hbCcpKSB7XG4gICAgICByZXR1cm4gJ2FjYWRlbWljX3BhcGVyJ1xuICAgIH1cbiAgICBcbiAgICBpZiAoY29udGVudC5pbmNsdWRlcygndHV0b3JpYWwnKSB8fCBjb250ZW50LmluY2x1ZGVzKCdob3cgdG8nKSB8fCB0aXRsZS5pbmNsdWRlcygnZ3XDrWEnKSkge1xuICAgICAgcmV0dXJuICd0dXRvcmlhbCdcbiAgICB9XG4gICAgXG4gICAgcmV0dXJuICdhcnRpY2xlJ1xuICB9XG5cbiAgLyoqXG4gICAqIEdlbmVyYSByZXN1bHRhZG9zIHJlYWxpc3RhcyBwYXJhIGRlc2Fycm9sbG8geSB0ZXN0aW5nXG4gICAqL1xuICBwcml2YXRlIHN0YXRpYyBnZW5lcmF0ZVJlYWxpc3RpY1Jlc3VsdHMocXVlcnk6IHN0cmluZyk6IFdlYlNlYXJjaFJlc3VsdFtdIHtcbiAgICBjb25zdCBxdWVyeUxvd2VyID0gcXVlcnkudG9Mb3dlckNhc2UoKVxuICAgIFxuICAgIC8vIEdlbmVyYXIgcmVzdWx0YWRvcyBlc3BlY8OtZmljb3Mgc2Vnw7puIGVsIHRpcG8gZGUgY29uc3VsdGFcbiAgICBjb25zdCByZXN1bHRzOiBXZWJTZWFyY2hSZXN1bHRbXSA9IFtdXG4gICAgXG4gICAgaWYgKHF1ZXJ5TG93ZXIuaW5jbHVkZXMoJ21hdGVtw6F0aWNhcycpIHx8IHF1ZXJ5TG93ZXIuaW5jbHVkZXMoJ21hdGhlbWF0aWNzJykpIHtcbiAgICAgIHJlc3VsdHMucHVzaChcbiAgICAgICAge1xuICAgICAgICAgIHRpdGxlOiAnS2hhbiBBY2FkZW15IC0gTWF0ZW3DoXRpY2FzIEdyYXR1aXRhcycsXG4gICAgICAgICAgY29udGVudDogJ0FwcmVuZGUgbWF0ZW3DoXRpY2FzIGRlIGZvcm1hIGdyYXR1aXRhIGNvbiBlamVyY2ljaW9zIGludGVyYWN0aXZvcywgdmlkZW9zIHkgYXJ0w61jdWxvcy4gRGVzZGUgYXJpdG3DqXRpY2EgYsOhc2ljYSBoYXN0YSBjw6FsY3VsbyBhdmFuemFkby4nLFxuICAgICAgICAgIHVybDogJ2h0dHBzOi8vZXMua2hhbmFjYWRlbXkub3JnL21hdGgnLFxuICAgICAgICAgIHNuaXBwZXQ6ICdQbGF0YWZvcm1hIGVkdWNhdGl2YSBjb24gY3Vyc29zIGNvbXBsZXRvcyBkZSBtYXRlbcOhdGljYXMgcGFyYSB0b2RvcyBsb3Mgbml2ZWxlcy4nXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICB0aXRsZTogJ01hdGVtw6F0aWNhcyBVbml2ZXJzaXRhcmlhcyAtIE1JVCBPcGVuQ291cnNlV2FyZScsXG4gICAgICAgICAgY29udGVudDogJ0N1cnNvcyBjb21wbGV0b3MgZGVsIE1JVCBzb2JyZSBtYXRlbcOhdGljYXMgdW5pdmVyc2l0YXJpYXMgaW5jbHV5ZW5kbyDDoWxnZWJyYSBsaW5lYWwsIGPDoWxjdWxvIHkgbWF0ZW3DoXRpY2FzIGRpc2NyZXRhcy4nLFxuICAgICAgICAgIHVybDogJ2h0dHBzOi8vb2N3Lm1pdC5lZHUvY291cnNlcy9tYXRoZW1hdGljcy8nLFxuICAgICAgICAgIHNuaXBwZXQ6ICdSZWN1cnNvcyBhY2Fkw6ltaWNvcyBkZSBhbHRhIGNhbGlkYWQgZGVsIE1JVCBwYXJhIG1hdGVtw6F0aWNhcyBhdmFuemFkYXMuJ1xuICAgICAgICB9XG4gICAgICApXG4gICAgfVxuICAgIFxuICAgIGlmIChxdWVyeUxvd2VyLmluY2x1ZGVzKCdxdcOtbWljYScpIHx8IHF1ZXJ5TG93ZXIuaW5jbHVkZXMoJ2NoZW1pc3RyeScpKSB7XG4gICAgICByZXN1bHRzLnB1c2goXG4gICAgICAgIHtcbiAgICAgICAgICB0aXRsZTogJ0xpYnJlVGV4dHMgUXXDrW1pY2EgLSBSZWN1cnNvcyBFZHVjYXRpdm9zJyxcbiAgICAgICAgICBjb250ZW50OiAnQmlibGlvdGVjYSBjb21wbGV0YSBkZSB0ZXh0b3MgZGUgcXXDrW1pY2EgY29uIGV4cGxpY2FjaW9uZXMgZGV0YWxsYWRhcywgZWplbXBsb3MgeSBwcm9ibGVtYXMgcmVzdWVsdG9zLicsXG4gICAgICAgICAgdXJsOiAnaHR0cHM6Ly9jaGVtLmxpYnJldGV4dHMub3JnLycsXG4gICAgICAgICAgc25pcHBldDogJ1RleHRvcyBhY2Fkw6ltaWNvcyBncmF0dWl0b3Mgc29icmUgcXXDrW1pY2EgZ2VuZXJhbCwgb3Jnw6FuaWNhIGUgaW5vcmfDoW5pY2EuJ1xuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgdGl0bGU6ICdDaGVtU2tldGNoIC0gU2ltdWxhZG9yIGRlIFJlYWNjaW9uZXMnLFxuICAgICAgICAgIGNvbnRlbnQ6ICdIZXJyYW1pZW50YSBwYXJhIHNpbXVsYXIgcmVhY2Npb25lcyBxdcOtbWljYXMgeSBlbnRlbmRlciBtZWNhbmlzbW9zIG1vbGVjdWxhcmVzIGRlIGZvcm1hIHZpc3VhbC4nLFxuICAgICAgICAgIHVybDogJ2h0dHBzOi8vd3d3LmFjZGxhYnMuY29tL3Jlc291cmNlcy9mcmVlLWNoZW1pc3RyeS1zb2Z0d2FyZS1hcHBzLycsXG4gICAgICAgICAgc25pcHBldDogJ1NvZnR3YXJlIGdyYXR1aXRvIHBhcmEgbW9kZWxhZG8gbW9sZWN1bGFyIHkgc2ltdWxhY2nDs24gcXXDrW1pY2EuJ1xuICAgICAgICB9XG4gICAgICApXG4gICAgfVxuICAgIFxuICAgIGlmIChxdWVyeUxvd2VyLmluY2x1ZGVzKCdmw61zaWNhJykgfHwgcXVlcnlMb3dlci5pbmNsdWRlcygncGh5c2ljcycpKSB7XG4gICAgICByZXN1bHRzLnB1c2goXG4gICAgICAgIHtcbiAgICAgICAgICB0aXRsZTogJ1BoeXNpY3MgQ2xhc3Nyb29tIC0gQ29uY2VwdG9zIGRlIEbDrXNpY2EnLFxuICAgICAgICAgIGNvbnRlbnQ6ICdUdXRvcmlhbGVzIGludGVyYWN0aXZvcyBzb2JyZSBjb25jZXB0b3MgZnVuZGFtZW50YWxlcyBkZSBmw61zaWNhIGNvbiBzaW11bGFjaW9uZXMgeSBleHBlcmltZW50b3MgdmlydHVhbGVzLicsXG4gICAgICAgICAgdXJsOiAnaHR0cHM6Ly93d3cucGh5c2ljc2NsYXNzcm9vbS5jb20vJyxcbiAgICAgICAgICBzbmlwcGV0OiAnUmVjdXJzbyBlZHVjYXRpdm8gcGFyYSBlbnRlbmRlciBmw61zaWNhIGRlc2RlIGNvbmNlcHRvcyBiw6FzaWNvcyBoYXN0YSBhdmFuemFkb3MuJ1xuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgdGl0bGU6ICdQaEVUIFNpbXVsYWNpb25lcyBJbnRlcmFjdGl2YXMnLFxuICAgICAgICAgIGNvbnRlbnQ6ICdTaW11bGFjaW9uZXMgZ3JhdHVpdGFzIGRlIGbDrXNpY2EsIHF1w61taWNhIHkgbWF0ZW3DoXRpY2FzIGRlc2Fycm9sbGFkYXMgcG9yIGxhIFVuaXZlcnNpZGFkIGRlIENvbG9yYWRvLicsXG4gICAgICAgICAgdXJsOiAnaHR0cHM6Ly9waGV0LmNvbG9yYWRvLmVkdS9lcy8nLFxuICAgICAgICAgIHNuaXBwZXQ6ICdTaW11bGFjaW9uZXMgaW50ZXJhY3RpdmFzIHBhcmEgdmlzdWFsaXphciBjb25jZXB0b3MgY2llbnTDrWZpY29zIGNvbXBsZWpvcy4nXG4gICAgICAgIH1cbiAgICAgIClcbiAgICB9XG5cbiAgICAvLyBSZXN1bHRhZG9zIGdlbsOpcmljb3MgZWR1Y2F0aXZvc1xuICAgIGlmIChyZXN1bHRzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgcmVzdWx0cy5wdXNoKFxuICAgICAgICB7XG4gICAgICAgICAgdGl0bGU6IGBHdcOtYSBDb21wbGV0YTogJHtxdWVyeX1gLFxuICAgICAgICAgIGNvbnRlbnQ6IGBFeHBsaWNhY2nDs24gZXhoYXVzdGl2YSBzb2JyZSAke3F1ZXJ5fSBjb24gZWplbXBsb3MgcHLDoWN0aWNvcywgZWplcmNpY2lvcyByZXN1ZWx0b3MgeSByZWN1cnNvcyBhZGljaW9uYWxlcyBwYXJhIHByb2Z1bmRpemFyIGVuIGVsIHRlbWEuYCxcbiAgICAgICAgICB1cmw6ICdodHRwczovL2FjYWRlbWlhLmVkdS90b3BpY3MvJyArIGVuY29kZVVSSUNvbXBvbmVudChxdWVyeSksXG4gICAgICAgICAgc25pcHBldDogYFJlY3Vyc28gYWNhZMOpbWljbyBjb21wbGV0byBzb2JyZSAke3F1ZXJ5fSBjb24gY29udGVuaWRvIHZlcmlmaWNhZG8gcG9yIGV4cGVydG9zLmBcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIHRpdGxlOiBgVHV0b3JpYWwgUGFzbyBhIFBhc286ICR7cXVlcnl9YCxcbiAgICAgICAgICBjb250ZW50OiBgQXByZW5kZSAke3F1ZXJ5fSBkZSBtYW5lcmEgZXN0cnVjdHVyYWRhIGNvbiBleHBsaWNhY2lvbmVzIGNsYXJhcywgZWplbXBsb3MgdmlzdWFsZXMgeSBlamVyY2ljaW9zIHByb2dyZXNpdm9zLmAsXG4gICAgICAgICAgdXJsOiAnaHR0cHM6Ly9jb3Vyc2VyYS5vcmcvbGVhcm4vJyArIGVuY29kZVVSSUNvbXBvbmVudChxdWVyeSksXG4gICAgICAgICAgc25pcHBldDogYEN1cnNvIGVuIGzDrW5lYSBjb24gbWV0b2RvbG9nw61hIHByb2JhZGEgcGFyYSBkb21pbmFyICR7cXVlcnl9LmBcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIHRpdGxlOiBgJHtxdWVyeX0gLSBSZWN1cnNvcyB5IEhlcnJhbWllbnRhc2AsXG4gICAgICAgICAgY29udGVudDogYENvbGVjY2nDs24gY3VyYWRhIGRlIGxvcyBtZWpvcmVzIHJlY3Vyc29zLCBoZXJyYW1pZW50YXMgeSBtYXRlcmlhbGVzIGRlIGVzdHVkaW8gcGFyYSAke3F1ZXJ5fS5gLFxuICAgICAgICAgIHVybDogJ2h0dHBzOi8vZWR4Lm9yZy9jb3Vyc2UvJyArIGVuY29kZVVSSUNvbXBvbmVudChxdWVyeSksXG4gICAgICAgICAgc25pcHBldDogYFJlY3Vyc29zIGVkdWNhdGl2b3MgZGUgdW5pdmVyc2lkYWRlcyBwcmVzdGlnaW9zYXMgc29icmUgJHtxdWVyeX0uYFxuICAgICAgICB9XG4gICAgICApXG4gICAgfVxuXG4gICAgcmV0dXJuIHJlc3VsdHNcbiAgfVxuXG4gIC8qKlxuICAgKiBHZW5lcmEgcmVzdWx0YWRvcyBkZSByZXNwYWxkbyBjdWFuZG8gbGEgYsO6c3F1ZWRhIGZhbGxhXG4gICAqL1xuICBwcml2YXRlIHN0YXRpYyBnZW5lcmF0ZUZhbGxiYWNrUmVzdWx0cyhxdWVyeTogc3RyaW5nKTogV2ViU2VhcmNoUmVzdWx0W10ge1xuICAgIHJldHVybiBbXG4gICAgICB7XG4gICAgICAgIHRpdGxlOiAnUmVjdXJzbyBFZHVjYXRpdm8gTG9jYWwnLFxuICAgICAgICBjb250ZW50OiBgSW5mb3JtYWNpw7NuIGLDoXNpY2Egc29icmUgJHtxdWVyeX0uIENvbnNpZGVyYSBjb25zdWx0YXIgdHUgYmlibGlvdGVjYSBsb2NhbCBvIHJlY3Vyc29zIGFjYWTDqW1pY29zIGluc3RpdHVjaW9uYWxlcy5gLFxuICAgICAgICB1cmw6ICdsb2NhbDovL2FjYWRlbWljLXJlc291cmNlcycsXG4gICAgICAgIHNuaXBwZXQ6IGBSZWN1cnNvIGRlIHJlc3BhbGRvIHBhcmEgJHtxdWVyeX0gY3VhbmRvIGxhIGLDunNxdWVkYSB3ZWIgbm8gZXN0w6EgZGlzcG9uaWJsZS5gXG4gICAgICB9XG4gICAgXVxuICB9XG5cbiAgLyoqXG4gICAqIEluZmllcmUgZGlmaWN1bHRhZCBkZWwgY29udGVuaWRvIHdlYlxuICAgKi9cbiAgcHJpdmF0ZSBzdGF0aWMgaW5mZXJEaWZmaWN1bHR5RnJvbUNvbnRlbnQoXG4gICAgY29udGVudDogc3RyaW5nLCBcbiAgICBzdWdnZXN0ZWRMZXZlbD86ICdiYXNpYycgfCAnaW50ZXJtZWRpYXRlJyB8ICdhZHZhbmNlZCdcbiAgKTogJ2Jhc2ljJyB8ICdpbnRlcm1lZGlhdGUnIHwgJ2FkdmFuY2VkJyB7XG4gICAgXG4gICAgaWYgKHN1Z2dlc3RlZExldmVsKSByZXR1cm4gc3VnZ2VzdGVkTGV2ZWxcbiAgICBcbiAgICBjb25zdCBsb3dlckNvbnRlbnQgPSBjb250ZW50LnRvTG93ZXJDYXNlKClcbiAgICBcbiAgICAvLyBJbmRpY2Fkb3JlcyBkZSBuaXZlbCBiw6FzaWNvXG4gICAgY29uc3QgYmFzaWNJbmRpY2F0b3JzID0gWydiw6FzaWNvJywgJ2ludHJvZHVjY2nDs24nLCAncHJpbmNpcGlhbnRlJywgJ3NpbXBsZScsICdlbGVtZW50YXJ5J11cbiAgICBjb25zdCBiYXNpY0NvdW50ID0gYmFzaWNJbmRpY2F0b3JzLmZpbHRlcihpbmRpY2F0b3IgPT4gbG93ZXJDb250ZW50LmluY2x1ZGVzKGluZGljYXRvcikpLmxlbmd0aFxuICAgIFxuICAgIC8vIEluZGljYWRvcmVzIGRlIG5pdmVsIGF2YW56YWRvXG4gICAgY29uc3QgYWR2YW5jZWRJbmRpY2F0b3JzID0gWydhdmFuemFkbycsICdjb21wbGVqbycsICdkb2N0b3JhbCcsICdyZXNlYXJjaCcsICdncmFkdWF0ZSddXG4gICAgY29uc3QgYWR2YW5jZWRDb3VudCA9IGFkdmFuY2VkSW5kaWNhdG9ycy5maWx0ZXIoaW5kaWNhdG9yID0+IGxvd2VyQ29udGVudC5pbmNsdWRlcyhpbmRpY2F0b3IpKS5sZW5ndGhcbiAgICBcbiAgICBpZiAoYWR2YW5jZWRDb3VudCA+IGJhc2ljQ291bnQpIHJldHVybiAnYWR2YW5jZWQnXG4gICAgaWYgKGJhc2ljQ291bnQgPiAwKSByZXR1cm4gJ2Jhc2ljJ1xuICAgIHJldHVybiAnaW50ZXJtZWRpYXRlJ1xuICB9XG5cbiAgLyoqXG4gICAqIEdlbmVyYSByZXN1bWVuIGRlbCBjb250ZW5pZG8gd2ViXG4gICAqL1xuICBwcml2YXRlIHN0YXRpYyBnZW5lcmF0ZUNvbnRlbnRTdW1tYXJ5KGNvbnRlbnQ6IHN0cmluZyk6IHN0cmluZyB7XG4gICAgaWYgKCFjb250ZW50IHx8IGNvbnRlbnQubGVuZ3RoIDwgMjApIHtcbiAgICAgIHJldHVybiAnUmVjdXJzbyBlZHVjYXRpdm8gZGlzcG9uaWJsZSBwYXJhIGNvbnN1bHRhLidcbiAgICB9XG4gICAgXG4gICAgY29uc3Qgc2VudGVuY2VzID0gY29udGVudC5zcGxpdCgvWy4hP10rLykuZmlsdGVyKHMgPT4gcy50cmltKCkubGVuZ3RoID4gMTUpXG4gICAgY29uc3QgZmlyc3RTZW50ZW5jZXMgPSBzZW50ZW5jZXMuc2xpY2UoMCwgMikuam9pbignLiAnKVxuICAgIFxuICAgIGlmIChmaXJzdFNlbnRlbmNlcy5sZW5ndGggPiAyMDApIHtcbiAgICAgIHJldHVybiBmaXJzdFNlbnRlbmNlcy5zdWJzdHJpbmcoMCwgMTk3KSArICcuLi4nXG4gICAgfVxuICAgIFxuICAgIHJldHVybiBmaXJzdFNlbnRlbmNlcyB8fCAnQ29udGVuaWRvIGVkdWNhdGl2byBzb2JyZSBlbCB0ZW1hIGNvbnN1bHRhZG8uJ1xuICB9XG5cbiAgLyoqXG4gICAqIEV4dHJhZSBwdW50b3MgY2xhdmUgZGVsIGNvbnRlbmlkbyB3ZWJcbiAgICovXG4gIHByaXZhdGUgc3RhdGljIGV4dHJhY3RXZWJLZXlQb2ludHMoY29udGVudDogc3RyaW5nKTogc3RyaW5nW10ge1xuICAgIGlmICghY29udGVudCB8fCBjb250ZW50Lmxlbmd0aCA8IDUwKSB7XG4gICAgICByZXR1cm4gWydJbmZvcm1hY2nDs24gZGlzcG9uaWJsZSBlbiBlbCByZWN1cnNvJ11cbiAgICB9XG4gICAgXG4gICAgY29uc3Qga2V5UG9pbnRzOiBzdHJpbmdbXSA9IFtdXG4gICAgXG4gICAgLy8gQnVzY2FyIGxpc3RhcyBvIHB1bnRvcyBudW1lcmFkb3NcbiAgICBjb25zdCBsaXN0SXRlbXMgPSBjb250ZW50Lm1hdGNoKC8oPzpefFxcbilcXHMqW1xcZFxcLVxcKlxc4oCiXVxccyooW15cXG5dKykvZylcbiAgICBpZiAobGlzdEl0ZW1zICYmIGxpc3RJdGVtcy5sZW5ndGggPiAwKSB7XG4gICAgICBrZXlQb2ludHMucHVzaCguLi5saXN0SXRlbXMuc2xpY2UoMCwgMykubWFwKGl0ZW0gPT4gXG4gICAgICAgIGl0ZW0ucmVwbGFjZSgvXltcXHNcXGRcXC1cXCpcXOKAol0rLywgJycpLnRyaW0oKVxuICAgICAgKSlcbiAgICB9XG4gICAgXG4gICAgLy8gU2kgbm8gaGF5IGxpc3RhcywgZXh0cmFlciBvcmFjaW9uZXMgaW1wb3J0YW50ZXNcbiAgICBpZiAoa2V5UG9pbnRzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgY29uc3Qgc2VudGVuY2VzID0gY29udGVudC5zcGxpdCgvWy4hP10rLylcbiAgICAgICAgLmZpbHRlcihzID0+IHMubGVuZ3RoID4gMjAgJiYgcy5sZW5ndGggPCAxMjApXG4gICAgICAgIC5zbGljZSgwLCAzKVxuICAgICAgXG4gICAgICBrZXlQb2ludHMucHVzaCguLi5zZW50ZW5jZXMubWFwKHMgPT4gcy50cmltKCkpKVxuICAgIH1cbiAgICBcbiAgICByZXR1cm4ga2V5UG9pbnRzLmZpbHRlcihwb2ludCA9PiBwb2ludC5sZW5ndGggPiA1KVxuICB9XG5cbiAgLyoqXG4gICAqIElkZW50aWZpY2EgdGVtYXMgcmVsYWNpb25hZG9zIGRlbCBjb250ZW5pZG8gd2ViXG4gICAqL1xuICBwcml2YXRlIHN0YXRpYyBpZGVudGlmeVdlYlJlbGF0ZWRUb3BpY3MoY29udGVudDogc3RyaW5nLCBtYWluVG9waWM6IHN0cmluZyk6IHN0cmluZ1tdIHtcbiAgICBjb25zdCByZWxhdGVkVG9waWNzOiBzdHJpbmdbXSA9IFtdXG4gICAgY29uc3QgbG93ZXJDb250ZW50ID0gY29udGVudC50b0xvd2VyQ2FzZSgpXG4gICAgY29uc3QgbG93ZXJUb3BpYyA9IG1haW5Ub3BpYy50b0xvd2VyQ2FzZSgpXG4gICAgXG4gICAgLy8gRGljY2lvbmFyaW8gZXhwYW5kaWRvIGRlIHJlbGFjaW9uZXMgdGVtw6F0aWNhc1xuICAgIGNvbnN0IHRvcGljUmVsYXRpb25zOiB7IFtrZXk6IHN0cmluZ106IHN0cmluZ1tdIH0gPSB7XG4gICAgICAnbWF0ZW3DoXRpY2FzJzogWyfDoWxnZWJyYScsICdnZW9tZXRyw61hJywgJ2PDoWxjdWxvJywgJ2VzdGFkw61zdGljYScsICd0cmlnb25vbWV0csOtYScsICdhcml0bcOpdGljYSddLFxuICAgICAgJ2bDrXNpY2EnOiBbJ21lY8OhbmljYScsICd0ZXJtb2RpbsOhbWljYScsICdlbGVjdHJvbWFnbmV0aXNtbycsICfDs3B0aWNhJywgJ29uZGFzJywgJ2VuZXJnw61hJ10sXG4gICAgICAncXXDrW1pY2EnOiBbJ29yZ8OhbmljYScsICdpbm9yZ8OhbmljYScsICdhbmFsw610aWNhJywgJ2Jpb3F1w61taWNhJywgJ3JlYWNjaW9uZXMnLCAnbW9sw6ljdWxhcyddLFxuICAgICAgJ3Byb2dyYW1hY2nDs24nOiBbJ2FsZ29yaXRtb3MnLCAnZXN0cnVjdHVyYXMgZGUgZGF0b3MnLCAnZGVzYXJyb2xsbyB3ZWInLCAnaW50ZWxpZ2VuY2lhIGFydGlmaWNpYWwnLCAnYmFzZXMgZGUgZGF0b3MnXSxcbiAgICAgICdiaW9sb2fDrWEnOiBbJ2dlbsOpdGljYScsICdldm9sdWNpw7NuJywgJ2Vjb2xvZ8OtYScsICdhbmF0b23DrWEnLCAnZmlzaW9sb2fDrWEnLCAnbWljcm9iaW9sb2fDrWEnXSxcbiAgICAgICdoaXN0b3JpYSc6IFsnY3Jvbm9sb2fDrWEnLCAnY2l2aWxpemFjaW9uZXMnLCAnZ3VlcnJhcycsICdjdWx0dXJhJywgJ3BvbMOtdGljYScsICdlY29ub23DrWEnXVxuICAgIH1cbiAgICBcbiAgICAvLyBCdXNjYXIgcmVsYWNpb25lcyBkaXJlY3Rhc1xuICAgIGZvciAoY29uc3QgW3N1YmplY3QsIHJlbGF0aW9uc10gb2YgT2JqZWN0LmVudHJpZXModG9waWNSZWxhdGlvbnMpKSB7XG4gICAgICBpZiAobG93ZXJUb3BpYy5pbmNsdWRlcyhzdWJqZWN0KSB8fCBsb3dlckNvbnRlbnQuaW5jbHVkZXMoc3ViamVjdCkpIHtcbiAgICAgICAgY29uc3QgZm91bmRSZWxhdGlvbnMgPSByZWxhdGlvbnMuZmlsdGVyKHJlbGF0aW9uID0+IFxuICAgICAgICAgIGxvd2VyQ29udGVudC5pbmNsdWRlcyhyZWxhdGlvbikgJiYgIWxvd2VyVG9waWMuaW5jbHVkZXMocmVsYXRpb24pXG4gICAgICAgIClcbiAgICAgICAgcmVsYXRlZFRvcGljcy5wdXNoKC4uLmZvdW5kUmVsYXRpb25zKVxuICAgICAgfVxuICAgIH1cbiAgICBcbiAgICByZXR1cm4gQXJyYXkuZnJvbShuZXcgU2V0KHJlbGF0ZWRUb3BpY3MpKS5zbGljZSgwLCA0KVxuICB9XG5cbiAgLyoqXG4gICAqIEVzdGltYSB0aWVtcG8gZGUgbGVjdHVyYSBkZWwgY29udGVuaWRvIHdlYlxuICAgKi9cbiAgcHJpdmF0ZSBzdGF0aWMgZXN0aW1hdGVXZWJSZWFkVGltZShjb250ZW50OiBzdHJpbmcpOiBudW1iZXIge1xuICAgIGlmICghY29udGVudCkgcmV0dXJuIDFcbiAgICBcbiAgICBjb25zdCB3b3Jkc1Blck1pbnV0ZSA9IDIwMCAvLyBWZWxvY2lkYWQgcHJvbWVkaW8gZGUgbGVjdHVyYVxuICAgIGNvbnN0IHdvcmRDb3VudCA9IGNvbnRlbnQuc3BsaXQoL1xccysvKS5sZW5ndGhcbiAgICByZXR1cm4gTWF0aC5tYXgoMSwgTWF0aC5jZWlsKHdvcmRDb3VudCAvIHdvcmRzUGVyTWludXRlKSlcbiAgfVxuXG4gIC8qKlxuICAgKiBFeHRyYWUgZG9taW5pbyBkZSBVUkxcbiAgICovXG4gIHByaXZhdGUgc3RhdGljIGV4dHJhY3REb21haW4odXJsOiBzdHJpbmcpOiBzdHJpbmcge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCB1cmxPYmogPSBuZXcgVVJMKHVybClcbiAgICAgIHJldHVybiB1cmxPYmouaG9zdG5hbWUucmVwbGFjZSgnd3d3LicsICcnKVxuICAgIH0gY2F0Y2gge1xuICAgICAgcmV0dXJuICdmdWVudGUgd2ViJ1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBJbnRlZ3JhIGLDunNxdWVkYSB3ZWIgY29uIGVsIHNpc3RlbWEgYWNhZMOpbWljbyBjb21wbGV0b1xuICAgKi9cbiAgc3RhdGljIGFzeW5jIHBlcmZvcm1BY2FkZW1pY1dlYlNlYXJjaChxdWVyeTogQWNhZGVtaWNTZWFyY2hRdWVyeSk6IFByb21pc2U8U2VhcmNoQW5hbHlzaXM+IHtcbiAgICBjb25zdCBzdGFydFRpbWUgPSBEYXRlLm5vdygpXG4gICAgXG4gICAgdHJ5IHtcbiAgICAgIC8vIE9wdGltaXphciBxdWVyeSBwYXJhIGLDunNxdWVkYSB3ZWJcbiAgICAgIGNvbnN0IHdlYlF1ZXJ5ID0gdGhpcy5vcHRpbWl6ZVF1ZXJ5Rm9yV2ViKHF1ZXJ5KVxuICAgICAgXG4gICAgICAvLyBSZWFsaXphciBiw7pzcXVlZGEgd2ViXG4gICAgICBjb25zdCB3ZWJSZXN1bHRzID0gYXdhaXQgdGhpcy5wZXJmb3JtV2ViU2VhcmNoKHdlYlF1ZXJ5KVxuICAgICAgXG4gICAgICAvLyBDb252ZXJ0aXIgYSBmb3JtYXRvIGFjYWTDqW1pY29cbiAgICAgIGNvbnN0IGFjYWRlbWljUmVzdWx0cyA9IHRoaXMuY29udmVydFRvQWNhZGVtaWNSZXN1bHRzKHdlYlJlc3VsdHMsIHF1ZXJ5KVxuICAgICAgXG4gICAgICAvLyBDYWxjdWxhciB0aWVtcG8gZGUgYsO6c3F1ZWRhXG4gICAgICBjb25zdCBzZWFyY2hUaW1lID0gRGF0ZS5ub3coKSAtIHN0YXJ0VGltZVxuICAgICAgXG4gICAgICByZXR1cm4ge1xuICAgICAgICBxdWVyeSxcbiAgICAgICAgcmVzdWx0czogYWNhZGVtaWNSZXN1bHRzLFxuICAgICAgICBzZWFyY2hTdWNjZXNzOiBhY2FkZW1pY1Jlc3VsdHMubGVuZ3RoID4gMCxcbiAgICAgICAgdG90YWxSZXN1bHRzOiBhY2FkZW1pY1Jlc3VsdHMubGVuZ3RoLFxuICAgICAgICBzZWFyY2hUaW1lLFxuICAgICAgICBwZXJzb25hbGl6ZWRSZWNvbW1lbmRhdGlvbnM6IHRoaXMuZ2VuZXJhdGVXZWJSZWNvbW1lbmRhdGlvbnMoYWNhZGVtaWNSZXN1bHRzLCBxdWVyeSksXG4gICAgICAgIGZvbGxvd1VwUXVlc3Rpb25zOiB0aGlzLmdlbmVyYXRlV2ViRm9sbG93VXBzKHF1ZXJ5LCBhY2FkZW1pY1Jlc3VsdHMpLFxuICAgICAgICBzdWdnZXN0ZWRBY3Rpb25zOiB0aGlzLmdlbmVyYXRlV2ViQWN0aW9ucyhhY2FkZW1pY1Jlc3VsdHMpXG4gICAgICB9XG4gICAgICBcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgaW4gYWNhZGVtaWMgd2ViIHNlYXJjaDonLCBlcnJvcilcbiAgICAgIFxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgcXVlcnksXG4gICAgICAgIHJlc3VsdHM6IFtdLFxuICAgICAgICBzZWFyY2hTdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgdG90YWxSZXN1bHRzOiAwLFxuICAgICAgICBzZWFyY2hUaW1lOiBEYXRlLm5vdygpIC0gc3RhcnRUaW1lLFxuICAgICAgICBwZXJzb25hbGl6ZWRSZWNvbW1lbmRhdGlvbnM6IFtgQnVzY2FyIFwiJHtxdWVyeS50b3BpY31cIiBlbiByZWN1cnNvcyBhY2Fkw6ltaWNvcyBsb2NhbGVzYF0sXG4gICAgICAgIGZvbGxvd1VwUXVlc3Rpb25zOiBbJ8K/VGUgZ3VzdGFyw61hIHF1ZSByZWZvcm11bGUgbGEgYsO6c3F1ZWRhPyddLFxuICAgICAgICBzdWdnZXN0ZWRBY3Rpb25zOiBbJ1ZlcmlmaWNhciBjb25leGnDs24gYSBpbnRlcm5ldCcsICdJbnRlbnRhciBjb24gdMOpcm1pbm9zIG3DoXMgZXNwZWPDrWZpY29zJ11cbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogR2VuZXJhIHJlY29tZW5kYWNpb25lcyBiYXNhZGFzIGVuIHJlc3VsdGFkb3Mgd2ViXG4gICAqL1xuICBwcml2YXRlIHN0YXRpYyBnZW5lcmF0ZVdlYlJlY29tbWVuZGF0aW9ucyhyZXN1bHRzOiBBY2FkZW1pY1NlYXJjaFJlc3VsdFtdLCBxdWVyeTogQWNhZGVtaWNTZWFyY2hRdWVyeSk6IHN0cmluZ1tdIHtcbiAgICBjb25zdCByZWNvbW1lbmRhdGlvbnM6IHN0cmluZ1tdID0gW11cbiAgICBcbiAgICBpZiAocmVzdWx0cy5sZW5ndGggPT09IDApIHtcbiAgICAgIHJlY29tbWVuZGF0aW9ucy5wdXNoKGBObyBlbmNvbnRyw6kgcmVzdWx0YWRvcyBlc3BlY8OtZmljb3MgcGFyYSBcIiR7cXVlcnkudG9waWN9XCIuIFRlIHN1Z2llcm8gcmVmb3JtdWxhciBsYSBiw7pzcXVlZGEuYClcbiAgICAgIHJldHVybiByZWNvbW1lbmRhdGlvbnNcbiAgICB9XG4gICAgXG4gICAgY29uc3QgaGFzVmlkZW9zID0gcmVzdWx0cy5zb21lKHIgPT4gci5jb250ZW50VHlwZSA9PT0gJ3ZpZGVvJylcbiAgICBjb25zdCBoYXNFeGVyY2lzZXMgPSByZXN1bHRzLnNvbWUociA9PiByLmNvbnRlbnRUeXBlID09PSAnZXhlcmNpc2UnKVxuICAgIGNvbnN0IGhpZ2hRdWFsaXR5U291cmNlcyA9IHJlc3VsdHMuZmlsdGVyKHIgPT4gci5yZWxldmFuY2VTY29yZSA+IDAuNylcbiAgICBcbiAgICBpZiAoaGFzVmlkZW9zKSB7XG4gICAgICByZWNvbW1lbmRhdGlvbnMucHVzaCgnRW5jb250csOpIHZpZGVvcyBleHBsaWNhdGl2b3MgcXVlIHB1ZWRlbiBheXVkYXJ0ZSBhIHZpc3VhbGl6YXIgbG9zIGNvbmNlcHRvcycpXG4gICAgfVxuICAgIFxuICAgIGlmIChoYXNFeGVyY2lzZXMpIHtcbiAgICAgIHJlY29tbWVuZGF0aW9ucy5wdXNoKCdIYXkgZWplcmNpY2lvcyBwcsOhY3RpY29zIGRpc3BvbmlibGVzIHBhcmEgcmVmb3J6YXIgdHUgYXByZW5kaXphamUnKVxuICAgIH1cbiAgICBcbiAgICBpZiAoaGlnaFF1YWxpdHlTb3VyY2VzLmxlbmd0aCA+IDApIHtcbiAgICAgIHJlY29tbWVuZGF0aW9ucy5wdXNoKGBJZGVudGlmaXF1w6kgJHtoaWdoUXVhbGl0eVNvdXJjZXMubGVuZ3RofSBmdWVudGVzIGRlIGFsdGEgY2FsaWRhZCBhY2Fkw6ltaWNhYClcbiAgICB9XG4gICAgXG4gICAgcmV0dXJuIHJlY29tbWVuZGF0aW9uc1xuICB9XG5cbiAgLyoqXG4gICAqIEdlbmVyYSBwcmVndW50YXMgZGUgc2VndWltaWVudG8gYmFzYWRhcyBlbiBiw7pzcXVlZGEgd2ViXG4gICAqL1xuICBwcml2YXRlIHN0YXRpYyBnZW5lcmF0ZVdlYkZvbGxvd1VwcyhxdWVyeTogQWNhZGVtaWNTZWFyY2hRdWVyeSwgcmVzdWx0czogQWNhZGVtaWNTZWFyY2hSZXN1bHRbXSk6IHN0cmluZ1tdIHtcbiAgICBjb25zdCBmb2xsb3dVcHM6IHN0cmluZ1tdID0gW11cbiAgICBcbiAgICBpZiAocmVzdWx0cy5sZW5ndGggPiAwKSB7XG4gICAgICBmb2xsb3dVcHMucHVzaChgwr9UZSBndXN0YXLDrWEgcXVlIHByb2Z1bmRpY2UgZW4gYWxnw7puIGFzcGVjdG8gZXNwZWPDrWZpY28gZGUgJHtxdWVyeS50b3BpY30/YClcbiAgICAgIFxuICAgICAgY29uc3QgcmVsYXRlZFRvcGljcyA9IEFycmF5LmZyb20obmV3IFNldChyZXN1bHRzLmZsYXRNYXAociA9PiByLnJlbGF0ZWRUb3BpY3MpKSkuc2xpY2UoMCwgMilcbiAgICAgIGlmIChyZWxhdGVkVG9waWNzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgZm9sbG93VXBzLnB1c2goYMK/VGUgaW50ZXJlc2EgZXhwbG9yYXIgJHtyZWxhdGVkVG9waWNzLmpvaW4oJyBvICcpfT9gKVxuICAgICAgfVxuICAgICAgXG4gICAgICBpZiAocXVlcnkuc2VhcmNoVHlwZSA9PT0gJ2V4cGxhbmF0aW9uJykge1xuICAgICAgICBmb2xsb3dVcHMucHVzaCgnwr9OZWNlc2l0YXMgZWplbXBsb3MgcHLDoWN0aWNvcyBwYXJhIGVzdGUgdGVtYT8nKVxuICAgICAgfVxuICAgIH1cbiAgICBcbiAgICByZXR1cm4gZm9sbG93VXBzXG4gIH1cblxuICAvKipcbiAgICogR2VuZXJhIGFjY2lvbmVzIHN1Z2VyaWRhcyBiYXNhZGFzIGVuIHJlc3VsdGFkb3Mgd2ViXG4gICAqL1xuICBwcml2YXRlIHN0YXRpYyBnZW5lcmF0ZVdlYkFjdGlvbnMocmVzdWx0czogQWNhZGVtaWNTZWFyY2hSZXN1bHRbXSk6IHN0cmluZ1tdIHtcbiAgICBjb25zdCBhY3Rpb25zOiBzdHJpbmdbXSA9IFtdXG4gICAgXG4gICAgaWYgKHJlc3VsdHMubGVuZ3RoID4gMCkge1xuICAgICAgYWN0aW9ucy5wdXNoKCdSZXZpc2FyIGxvcyByZWN1cnNvcyBlbmNvbnRyYWRvcyBwb3Igb3JkZW4gZGUgcmVsZXZhbmNpYScpXG4gICAgICBcbiAgICAgIGNvbnN0IHZpZGVvcyA9IHJlc3VsdHMuZmlsdGVyKHIgPT4gci5jb250ZW50VHlwZSA9PT0gJ3ZpZGVvJylcbiAgICAgIGlmICh2aWRlb3MubGVuZ3RoID4gMCkge1xuICAgICAgICBhY3Rpb25zLnB1c2goJ1ZlciB2aWRlb3MgZXhwbGljYXRpdm9zIHBhcmEgY29tcHJlbnNpw7NuIHZpc3VhbCcpXG4gICAgICB9XG4gICAgICBcbiAgICAgIGNvbnN0IGV4ZXJjaXNlcyA9IHJlc3VsdHMuZmlsdGVyKHIgPT4gci5jb250ZW50VHlwZSA9PT0gJ2V4ZXJjaXNlJylcbiAgICAgIGlmIChleGVyY2lzZXMubGVuZ3RoID4gMCkge1xuICAgICAgICBhY3Rpb25zLnB1c2goJ1ByYWN0aWNhciBjb24gZWplcmNpY2lvcyBlbmNvbnRyYWRvcycpXG4gICAgICB9XG4gICAgICBcbiAgICAgIGFjdGlvbnMucHVzaCgnVG9tYXIgbm90YXMgZGUgbG9zIHB1bnRvcyBjbGF2ZSBpZGVudGlmaWNhZG9zJylcbiAgICB9XG4gICAgXG4gICAgcmV0dXJuIGFjdGlvbnNcbiAgfVxufSJdLCJuYW1lcyI6WyJXZWJTZWFyY2hJbnRlZ3JhdGlvbiIsInBlcmZvcm1XZWJTZWFyY2giLCJxdWVyeSIsImNvbnNvbGUiLCJsb2ciLCJnZW5lcmF0ZVJlYWxpc3RpY1Jlc3VsdHMiLCJlcnJvciIsImdlbmVyYXRlRmFsbGJhY2tSZXN1bHRzIiwib3B0aW1pemVRdWVyeUZvcldlYiIsImFjYWRlbWljUXVlcnkiLCJ0b3BpYyIsInN1YmplY3QiLCJzZWFyY2hUeXBlIiwibGV2ZWwiLCJsYW5ndWFnZSIsIndlYlF1ZXJ5Iiwic2VhcmNoVHlwZVRlcm1zIiwiZXhwbGFuYXRpb24iLCJleGFtcGxlcyIsImV4ZXJjaXNlcyIsInJlc291cmNlcyIsInJlc2VhcmNoIiwibGV2ZWxUZXJtcyIsImVzIiwiYmFzaWMiLCJpbnRlcm1lZGlhdGUiLCJhZHZhbmNlZCIsImVuIiwicXVhbGl0eVRlcm1zIiwidHJpbSIsImNvbnZlcnRUb0FjYWRlbWljUmVzdWx0cyIsIndlYlJlc3VsdHMiLCJvcmlnaW5hbFF1ZXJ5IiwibWFwIiwicmVzdWx0IiwidGl0bGUiLCJjb250ZW50Iiwic25pcHBldCIsInNvdXJjZSIsImV4dHJhY3REb21haW4iLCJ1cmwiLCJyZWxldmFuY2VTY29yZSIsImNhbGN1bGF0ZVdlYlJlbGV2YW5jZSIsImRpZmZpY3VsdHkiLCJpbmZlckRpZmZpY3VsdHlGcm9tQ29udGVudCIsImNvbnRlbnRUeXBlIiwiY2xhc3NpZnlXZWJDb250ZW50VHlwZSIsInN1bW1hcnkiLCJnZW5lcmF0ZUNvbnRlbnRTdW1tYXJ5Iiwia2V5UG9pbnRzIiwiZXh0cmFjdFdlYktleVBvaW50cyIsInJlbGF0ZWRUb3BpY3MiLCJpZGVudGlmeVdlYlJlbGF0ZWRUb3BpY3MiLCJlc3RpbWF0ZWRSZWFkVGltZSIsImVzdGltYXRlV2ViUmVhZFRpbWUiLCJzY29yZSIsInRvTG93ZXJDYXNlIiwiaW5jbHVkZXMiLCJsZW5ndGgiLCJNYXRoIiwibWF4IiwibWluIiwicXVlcnlMb3dlciIsInJlc3VsdHMiLCJwdXNoIiwiZW5jb2RlVVJJQ29tcG9uZW50Iiwic3VnZ2VzdGVkTGV2ZWwiLCJsb3dlckNvbnRlbnQiLCJiYXNpY0luZGljYXRvcnMiLCJiYXNpY0NvdW50IiwiZmlsdGVyIiwiaW5kaWNhdG9yIiwiYWR2YW5jZWRJbmRpY2F0b3JzIiwiYWR2YW5jZWRDb3VudCIsInNlbnRlbmNlcyIsInNwbGl0IiwicyIsImZpcnN0U2VudGVuY2VzIiwic2xpY2UiLCJqb2luIiwic3Vic3RyaW5nIiwibGlzdEl0ZW1zIiwibWF0Y2giLCJpdGVtIiwicmVwbGFjZSIsInBvaW50IiwibWFpblRvcGljIiwibG93ZXJUb3BpYyIsInRvcGljUmVsYXRpb25zIiwicmVsYXRpb25zIiwiT2JqZWN0IiwiZW50cmllcyIsImZvdW5kUmVsYXRpb25zIiwicmVsYXRpb24iLCJBcnJheSIsImZyb20iLCJTZXQiLCJ3b3Jkc1Blck1pbnV0ZSIsIndvcmRDb3VudCIsImNlaWwiLCJ1cmxPYmoiLCJVUkwiLCJob3N0bmFtZSIsInBlcmZvcm1BY2FkZW1pY1dlYlNlYXJjaCIsInN0YXJ0VGltZSIsIkRhdGUiLCJub3ciLCJhY2FkZW1pY1Jlc3VsdHMiLCJzZWFyY2hUaW1lIiwic2VhcmNoU3VjY2VzcyIsInRvdGFsUmVzdWx0cyIsInBlcnNvbmFsaXplZFJlY29tbWVuZGF0aW9ucyIsImdlbmVyYXRlV2ViUmVjb21tZW5kYXRpb25zIiwiZm9sbG93VXBRdWVzdGlvbnMiLCJnZW5lcmF0ZVdlYkZvbGxvd1VwcyIsInN1Z2dlc3RlZEFjdGlvbnMiLCJnZW5lcmF0ZVdlYkFjdGlvbnMiLCJyZWNvbW1lbmRhdGlvbnMiLCJoYXNWaWRlb3MiLCJzb21lIiwiciIsImhhc0V4ZXJjaXNlcyIsImhpZ2hRdWFsaXR5U291cmNlcyIsImZvbGxvd1VwcyIsImZsYXRNYXAiLCJhY3Rpb25zIiwidmlkZW9zIl0sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/web-search-integration.ts\n");

/***/ }),

/***/ "(ssr)/./node_modules/next/dist/build/webpack/loaders/next-flight-client-entry-loader.js?server=true!":
/*!******************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-flight-client-entry-loader.js?server=true! ***!
  \******************************************************************************************************/
/***/ (() => {



/***/ }),

/***/ "../app-render/after-task-async-storage.external":
/*!***********************************************************************************!*\
  !*** external "next/dist/server/app-render/after-task-async-storage.external.js" ***!
  \***********************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/server/app-render/after-task-async-storage.external.js");

/***/ }),

/***/ "../app-render/work-async-storage.external":
/*!*****************************************************************************!*\
  !*** external "next/dist/server/app-render/work-async-storage.external.js" ***!
  \*****************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/server/app-render/work-async-storage.external.js");

/***/ }),

/***/ "./work-unit-async-storage.external":
/*!**********************************************************************************!*\
  !*** external "next/dist/server/app-render/work-unit-async-storage.external.js" ***!
  \**********************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/server/app-render/work-unit-async-storage.external.js");

/***/ }),

/***/ "@xenova/transformers":
/*!***************************************!*\
  !*** external "@xenova/transformers" ***!
  \***************************************/
/***/ ((module) => {

"use strict";
module.exports = import("@xenova/transformers");;

/***/ }),

/***/ "assert":
/*!*************************!*\
  !*** external "assert" ***!
  \*************************/
/***/ ((module) => {

"use strict";
module.exports = require("assert");

/***/ }),

/***/ "buffer":
/*!*************************!*\
  !*** external "buffer" ***!
  \*************************/
/***/ ((module) => {

"use strict";
module.exports = require("buffer");

/***/ }),

/***/ "crypto":
/*!*************************!*\
  !*** external "crypto" ***!
  \*************************/
/***/ ((module) => {

"use strict";
module.exports = require("crypto");

/***/ }),

/***/ "events":
/*!*************************!*\
  !*** external "events" ***!
  \*************************/
/***/ ((module) => {

"use strict";
module.exports = require("events");

/***/ }),

/***/ "fs":
/*!*********************!*\
  !*** external "fs" ***!
  \*********************/
/***/ ((module) => {

"use strict";
module.exports = require("fs");

/***/ }),

/***/ "http":
/*!***********************!*\
  !*** external "http" ***!
  \***********************/
/***/ ((module) => {

"use strict";
module.exports = require("http");

/***/ }),

/***/ "https":
/*!************************!*\
  !*** external "https" ***!
  \************************/
/***/ ((module) => {

"use strict";
module.exports = require("https");

/***/ }),

/***/ "next/dist/compiled/next-server/app-page.runtime.dev.js":
/*!*************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-page.runtime.dev.js" ***!
  \*************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/compiled/next-server/app-page.runtime.dev.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "os":
/*!*********************!*\
  !*** external "os" ***!
  \*********************/
/***/ ((module) => {

"use strict";
module.exports = require("os");

/***/ }),

/***/ "path":
/*!***********************!*\
  !*** external "path" ***!
  \***********************/
/***/ ((module) => {

"use strict";
module.exports = require("path");

/***/ }),

/***/ "querystring":
/*!******************************!*\
  !*** external "querystring" ***!
  \******************************/
/***/ ((module) => {

"use strict";
module.exports = require("querystring");

/***/ }),

/***/ "stream":
/*!*************************!*\
  !*** external "stream" ***!
  \*************************/
/***/ ((module) => {

"use strict";
module.exports = require("stream");

/***/ }),

/***/ "tty":
/*!**********************!*\
  !*** external "tty" ***!
  \**********************/
/***/ ((module) => {

"use strict";
module.exports = require("tty");

/***/ }),

/***/ "url":
/*!**********************!*\
  !*** external "url" ***!
  \**********************/
/***/ ((module) => {

"use strict";
module.exports = require("url");

/***/ }),

/***/ "util":
/*!***********************!*\
  !*** external "util" ***!
  \***********************/
/***/ ((module) => {

"use strict";
module.exports = require("util");

/***/ }),

/***/ "zlib":
/*!***********************!*\
  !*** external "zlib" ***!
  \***********************/
/***/ ((module) => {

"use strict";
module.exports = require("zlib");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next","vendor-chunks/jose","vendor-chunks/next-auth","vendor-chunks/openid-client","vendor-chunks/bcryptjs","vendor-chunks/@babel","vendor-chunks/oauth","vendor-chunks/preact","vendor-chunks/uuid","vendor-chunks/yallist","vendor-chunks/preact-render-to-string","vendor-chunks/cookie","vendor-chunks/oidc-token-hash","vendor-chunks/@panva","vendor-chunks/@novu","vendor-chunks/asynckit","vendor-chunks/math-intrinsics","vendor-chunks/es-errors","vendor-chunks/form-data","vendor-chunks/call-bind-apply-helpers","vendor-chunks/debug","vendor-chunks/get-proto","vendor-chunks/has-symbols","vendor-chunks/gopd","vendor-chunks/function-bind","vendor-chunks/follow-redirects","vendor-chunks/axios-retry","vendor-chunks/axios","vendor-chunks/supports-color","vendor-chunks/proxy-from-env","vendor-chunks/ms","vendor-chunks/is-retry-allowed","vendor-chunks/hasown","vendor-chunks/has-tostringtag","vendor-chunks/has-flag","vendor-chunks/get-intrinsic","vendor-chunks/es-set-tostringtag","vendor-chunks/es-object-atoms","vendor-chunks/es-define-property","vendor-chunks/dunder-proto","vendor-chunks/delayed-stream","vendor-chunks/combined-stream"], () => (__webpack_exec__("(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader/index.js?name=app%2Fapi%2Fai-chat%2Finitialize%2Froute&page=%2Fapi%2Fai-chat%2Finitialize%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fai-chat%2Finitialize%2Froute.ts&appDir=%2FUsers%2Frodrigodibernardo33gmail.com%2FDocuments%2FApp%20Development%20Proyects%2FIntellego%20Platform%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Frodrigodibernardo33gmail.com%2FDocuments%2FApp%20Development%20Proyects%2FIntellego%20Platform&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();