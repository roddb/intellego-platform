/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/debug-sara-memory/route";
exports.ids = ["app/api/debug-sara-memory/route"];
exports.modules = {

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader/index.js?name=app%2Fapi%2Fdebug-sara-memory%2Froute&page=%2Fapi%2Fdebug-sara-memory%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fdebug-sara-memory%2Froute.ts&appDir=%2FUsers%2Frodrigodibernardo33gmail.com%2FDocuments%2FApp%20Development%20Proyects%2FIntellego%20Platform%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Frodrigodibernardo33gmail.com%2FDocuments%2FApp%20Development%20Proyects%2FIntellego%20Platform&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!":
/*!*************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-app-loader/index.js?name=app%2Fapi%2Fdebug-sara-memory%2Froute&page=%2Fapi%2Fdebug-sara-memory%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fdebug-sara-memory%2Froute.ts&appDir=%2FUsers%2Frodrigodibernardo33gmail.com%2FDocuments%2FApp%20Development%20Proyects%2FIntellego%20Platform%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Frodrigodibernardo33gmail.com%2FDocuments%2FApp%20Development%20Proyects%2FIntellego%20Platform&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D! ***!
  \*************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   workAsyncStorage: () => (/* binding */ workAsyncStorage),\n/* harmony export */   workUnitAsyncStorage: () => (/* binding */ workUnitAsyncStorage)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/route-modules/app-route/module.compiled */ \"(rsc)/./node_modules/next/dist/server/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/route-kind */ \"(rsc)/./node_modules/next/dist/server/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/./node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var _Users_rodrigodibernardo33gmail_com_Documents_App_Development_Proyects_Intellego_Platform_src_app_api_debug_sara_memory_route_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./src/app/api/debug-sara-memory/route.ts */ \"(rsc)/./src/app/api/debug-sara-memory/route.ts\");\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new next_dist_server_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/debug-sara-memory/route\",\n        pathname: \"/api/debug-sara-memory\",\n        filename: \"route\",\n        bundlePath: \"app/api/debug-sara-memory/route\"\n    },\n    resolvedPagePath: \"/Users/rodrigodibernardo33gmail.com/Documents/App Development Proyects/Intellego Platform/src/app/api/debug-sara-memory/route.ts\",\n    nextConfigOutput,\n    userland: _Users_rodrigodibernardo33gmail_com_Documents_App_Development_Proyects_Intellego_Platform_src_app_api_debug_sara_memory_route_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { workAsyncStorage, workUnitAsyncStorage, serverHooks } = routeModule;\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        workAsyncStorage,\n        workUnitAsyncStorage\n    });\n}\n\n\n//# sourceMappingURL=app-route.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LWFwcC1sb2FkZXIvaW5kZXguanM/bmFtZT1hcHAlMkZhcGklMkZkZWJ1Zy1zYXJhLW1lbW9yeSUyRnJvdXRlJnBhZ2U9JTJGYXBpJTJGZGVidWctc2FyYS1tZW1vcnklMkZyb3V0ZSZhcHBQYXRocz0mcGFnZVBhdGg9cHJpdmF0ZS1uZXh0LWFwcC1kaXIlMkZhcGklMkZkZWJ1Zy1zYXJhLW1lbW9yeSUyRnJvdXRlLnRzJmFwcERpcj0lMkZVc2VycyUyRnJvZHJpZ29kaWJlcm5hcmRvMzNnbWFpbC5jb20lMkZEb2N1bWVudHMlMkZBcHAlMjBEZXZlbG9wbWVudCUyMFByb3llY3RzJTJGSW50ZWxsZWdvJTIwUGxhdGZvcm0lMkZzcmMlMkZhcHAmcGFnZUV4dGVuc2lvbnM9dHN4JnBhZ2VFeHRlbnNpb25zPXRzJnBhZ2VFeHRlbnNpb25zPWpzeCZwYWdlRXh0ZW5zaW9ucz1qcyZyb290RGlyPSUyRlVzZXJzJTJGcm9kcmlnb2RpYmVybmFyZG8zM2dtYWlsLmNvbSUyRkRvY3VtZW50cyUyRkFwcCUyMERldmVsb3BtZW50JTIwUHJveWVjdHMlMkZJbnRlbGxlZ28lMjBQbGF0Zm9ybSZpc0Rldj10cnVlJnRzY29uZmlnUGF0aD10c2NvbmZpZy5qc29uJmJhc2VQYXRoPSZhc3NldFByZWZpeD0mbmV4dENvbmZpZ091dHB1dD0mcHJlZmVycmVkUmVnaW9uPSZtaWRkbGV3YXJlQ29uZmlnPWUzMCUzRCEiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7QUFBK0Y7QUFDdkM7QUFDcUI7QUFDZ0Y7QUFDN0o7QUFDQTtBQUNBO0FBQ0Esd0JBQXdCLHlHQUFtQjtBQUMzQztBQUNBLGNBQWMsa0VBQVM7QUFDdkI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLFlBQVk7QUFDWixDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0EsUUFBUSxzREFBc0Q7QUFDOUQ7QUFDQSxXQUFXLDRFQUFXO0FBQ3RCO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDMEY7O0FBRTFGIiwic291cmNlcyI6WyIiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQXBwUm91dGVSb3V0ZU1vZHVsZSB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL3JvdXRlLW1vZHVsZXMvYXBwLXJvdXRlL21vZHVsZS5jb21waWxlZFwiO1xuaW1wb3J0IHsgUm91dGVLaW5kIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvcm91dGUta2luZFwiO1xuaW1wb3J0IHsgcGF0Y2hGZXRjaCBhcyBfcGF0Y2hGZXRjaCB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2xpYi9wYXRjaC1mZXRjaFwiO1xuaW1wb3J0ICogYXMgdXNlcmxhbmQgZnJvbSBcIi9Vc2Vycy9yb2RyaWdvZGliZXJuYXJkbzMzZ21haWwuY29tL0RvY3VtZW50cy9BcHAgRGV2ZWxvcG1lbnQgUHJveWVjdHMvSW50ZWxsZWdvIFBsYXRmb3JtL3NyYy9hcHAvYXBpL2RlYnVnLXNhcmEtbWVtb3J5L3JvdXRlLnRzXCI7XG4vLyBXZSBpbmplY3QgdGhlIG5leHRDb25maWdPdXRwdXQgaGVyZSBzbyB0aGF0IHdlIGNhbiB1c2UgdGhlbSBpbiB0aGUgcm91dGVcbi8vIG1vZHVsZS5cbmNvbnN0IG5leHRDb25maWdPdXRwdXQgPSBcIlwiXG5jb25zdCByb3V0ZU1vZHVsZSA9IG5ldyBBcHBSb3V0ZVJvdXRlTW9kdWxlKHtcbiAgICBkZWZpbml0aW9uOiB7XG4gICAgICAgIGtpbmQ6IFJvdXRlS2luZC5BUFBfUk9VVEUsXG4gICAgICAgIHBhZ2U6IFwiL2FwaS9kZWJ1Zy1zYXJhLW1lbW9yeS9yb3V0ZVwiLFxuICAgICAgICBwYXRobmFtZTogXCIvYXBpL2RlYnVnLXNhcmEtbWVtb3J5XCIsXG4gICAgICAgIGZpbGVuYW1lOiBcInJvdXRlXCIsXG4gICAgICAgIGJ1bmRsZVBhdGg6IFwiYXBwL2FwaS9kZWJ1Zy1zYXJhLW1lbW9yeS9yb3V0ZVwiXG4gICAgfSxcbiAgICByZXNvbHZlZFBhZ2VQYXRoOiBcIi9Vc2Vycy9yb2RyaWdvZGliZXJuYXJkbzMzZ21haWwuY29tL0RvY3VtZW50cy9BcHAgRGV2ZWxvcG1lbnQgUHJveWVjdHMvSW50ZWxsZWdvIFBsYXRmb3JtL3NyYy9hcHAvYXBpL2RlYnVnLXNhcmEtbWVtb3J5L3JvdXRlLnRzXCIsXG4gICAgbmV4dENvbmZpZ091dHB1dCxcbiAgICB1c2VybGFuZFxufSk7XG4vLyBQdWxsIG91dCB0aGUgZXhwb3J0cyB0aGF0IHdlIG5lZWQgdG8gZXhwb3NlIGZyb20gdGhlIG1vZHVsZS4gVGhpcyBzaG91bGRcbi8vIGJlIGVsaW1pbmF0ZWQgd2hlbiB3ZSd2ZSBtb3ZlZCB0aGUgb3RoZXIgcm91dGVzIHRvIHRoZSBuZXcgZm9ybWF0LiBUaGVzZVxuLy8gYXJlIHVzZWQgdG8gaG9vayBpbnRvIHRoZSByb3V0ZS5cbmNvbnN0IHsgd29ya0FzeW5jU3RvcmFnZSwgd29ya1VuaXRBc3luY1N0b3JhZ2UsIHNlcnZlckhvb2tzIH0gPSByb3V0ZU1vZHVsZTtcbmZ1bmN0aW9uIHBhdGNoRmV0Y2goKSB7XG4gICAgcmV0dXJuIF9wYXRjaEZldGNoKHtcbiAgICAgICAgd29ya0FzeW5jU3RvcmFnZSxcbiAgICAgICAgd29ya1VuaXRBc3luY1N0b3JhZ2VcbiAgICB9KTtcbn1cbmV4cG9ydCB7IHJvdXRlTW9kdWxlLCB3b3JrQXN5bmNTdG9yYWdlLCB3b3JrVW5pdEFzeW5jU3RvcmFnZSwgc2VydmVySG9va3MsIHBhdGNoRmV0Y2gsICB9O1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1hcHAtcm91dGUuanMubWFwIl0sIm5hbWVzIjpbXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader/index.js?name=app%2Fapi%2Fdebug-sara-memory%2Froute&page=%2Fapi%2Fdebug-sara-memory%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fdebug-sara-memory%2Froute.ts&appDir=%2FUsers%2Frodrigodibernardo33gmail.com%2FDocuments%2FApp%20Development%20Proyects%2FIntellego%20Platform%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Frodrigodibernardo33gmail.com%2FDocuments%2FApp%20Development%20Proyects%2FIntellego%20Platform&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-flight-client-entry-loader.js?server=true!":
/*!******************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-flight-client-entry-loader.js?server=true! ***!
  \******************************************************************************************************/
/***/ (() => {



/***/ }),

/***/ "(rsc)/./src/app/api/ai-calendar/create-event/route.ts":
/*!*******************************************************!*\
  !*** ./src/app/api/ai-calendar/create-event/route.ts ***!
  \*******************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   POST: () => (/* binding */ POST)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/./node_modules/next/dist/api/server.js\");\n/* harmony import */ var next_auth__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next-auth */ \"(rsc)/./node_modules/next-auth/index.js\");\n/* harmony import */ var next_auth__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(next_auth__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var _lib_auth__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/lib/auth */ \"(rsc)/./src/lib/auth.ts\");\n/* harmony import */ var _lib_calendar_data__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @/lib/calendar-data */ \"(rsc)/./src/lib/calendar-data.ts\");\n\n\n\n\nasync function POST(request) {\n    try {\n        const session = await (0,next_auth__WEBPACK_IMPORTED_MODULE_1__.getServerSession)(_lib_auth__WEBPACK_IMPORTED_MODULE_2__.authOptions);\n        if (!session) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: 'Authentication required',\n                success: false\n            }, {\n                status: 401\n            });\n        }\n        const body = await request.json();\n        const { title, type, subject, date, startTime, endTime, duration, location, description, priority } = body;\n        // Validaciones b√°sicas\n        if (!title || !type || !date) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: 'Missing required fields: title, type, date',\n                success: false\n            }, {\n                status: 400\n            });\n        }\n        // Validar tipo de evento\n        const validTypes = [\n            'exam',\n            'study_session',\n            'class',\n            'personal',\n            'extracurricular'\n        ];\n        if (!validTypes.includes(type)) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: `Invalid event type. Must be one of: ${validTypes.join(', ')}`,\n                success: false\n            }, {\n                status: 400\n            });\n        }\n        // Procesar fecha\n        let eventDate;\n        try {\n            eventDate = new Date(date);\n            if (isNaN(eventDate.getTime())) {\n                throw new Error('Invalid date');\n            }\n        } catch (error) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: 'Invalid date format',\n                success: false\n            }, {\n                status: 400\n            });\n        }\n        // Calcular endTime si no se proporciona pero se tiene duration\n        let finalEndTime = endTime;\n        if (!endTime && startTime && duration) {\n            const start = new Date(`2000-01-01T${startTime}:00`);\n            const end = new Date(start.getTime() + duration * 60000);\n            finalEndTime = end.toTimeString().substring(0, 5);\n        }\n        // Crear el evento\n        const event = {\n            id: `ai-event-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`,\n            title: title.trim(),\n            date: eventDate,\n            startTime: startTime || '15:00',\n            endTime: finalEndTime || '16:00',\n            type: type,\n            color: (0,_lib_calendar_data__WEBPACK_IMPORTED_MODULE_3__.getEventTypeColor)(type),\n            subject: subject || undefined,\n            location: location || undefined,\n            description: description || 'Creado autom√°ticamente por IA Tutora',\n            priority: priority || 'medium',\n            duration: duration || 60\n        };\n        // Intentar agregar el evento al calendario del usuario\n        const userId = session.user.id;\n        const success = (0,_lib_calendar_data__WEBPACK_IMPORTED_MODULE_3__.addCalendarEvent)(userId, event);\n        if (!success) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: 'Failed to create event in calendar',\n                success: false\n            }, {\n                status: 500\n            });\n        }\n        // Verificar que el evento se guard√≥ correctamente\n        const userData = (0,_lib_calendar_data__WEBPACK_IMPORTED_MODULE_3__.getUserCalendarData)(userId);\n        const savedEvent = userData?.events.find((e)=>e.id === event.id);\n        if (!savedEvent) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: 'Event was not saved correctly',\n                success: false\n            }, {\n                status: 500\n            });\n        }\n        console.log(`ü§ñ IA cre√≥ evento: ${event.title} para ${userId}`);\n        // Disparar evento global para notificar a los componentes frontend\n        if (typeof globalThis !== 'undefined') {\n            // Usar setTimeout para evitar problemas de timing\n            setTimeout(()=>{\n                if (false) {}\n            }, 100);\n        }\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            success: true,\n            event: savedEvent,\n            message: `Evento \"${event.title}\" creado exitosamente`,\n            totalEvents: userData?.events.length || 0\n        });\n    } catch (error) {\n        console.error('‚ùå Error in AI calendar creation:', error);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: 'Internal server error while creating event',\n            success: false\n        }, {\n            status: 500\n        });\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvYXBwL2FwaS9haS1jYWxlbmRhci9jcmVhdGUtZXZlbnQvcm91dGUudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7O0FBQTBDO0FBQ0U7QUFDSjtBQU1aO0FBRXJCLGVBQWVNLEtBQUtDLE9BQWdCO0lBQ3pDLElBQUk7UUFDRixNQUFNQyxVQUFVLE1BQU1QLDJEQUFnQkEsQ0FBQ0Msa0RBQVdBO1FBRWxELElBQUksQ0FBQ00sU0FBUztZQUNaLE9BQU9SLHFEQUFZQSxDQUFDUyxJQUFJLENBQ3RCO2dCQUFFQyxPQUFPO2dCQUEyQkMsU0FBUztZQUFNLEdBQ25EO2dCQUFFQyxRQUFRO1lBQUk7UUFFbEI7UUFFQSxNQUFNQyxPQUFPLE1BQU1OLFFBQVFFLElBQUk7UUFDL0IsTUFBTSxFQUNKSyxLQUFLLEVBQ0xDLElBQUksRUFDSkMsT0FBTyxFQUNQQyxJQUFJLEVBQ0pDLFNBQVMsRUFDVEMsT0FBTyxFQUNQQyxRQUFRLEVBQ1JDLFFBQVEsRUFDUkMsV0FBVyxFQUNYQyxRQUFRLEVBQ1QsR0FBR1Y7UUFFSix1QkFBdUI7UUFDdkIsSUFBSSxDQUFDQyxTQUFTLENBQUNDLFFBQVEsQ0FBQ0UsTUFBTTtZQUM1QixPQUFPakIscURBQVlBLENBQUNTLElBQUksQ0FDdEI7Z0JBQ0VDLE9BQU87Z0JBQ1BDLFNBQVM7WUFDWCxHQUNBO2dCQUFFQyxRQUFRO1lBQUk7UUFFbEI7UUFFQSx5QkFBeUI7UUFDekIsTUFBTVksYUFBYTtZQUFDO1lBQVE7WUFBaUI7WUFBUztZQUFZO1NBQWtCO1FBQ3BGLElBQUksQ0FBQ0EsV0FBV0MsUUFBUSxDQUFDVixPQUFPO1lBQzlCLE9BQU9mLHFEQUFZQSxDQUFDUyxJQUFJLENBQ3RCO2dCQUNFQyxPQUFPLENBQUMsb0NBQW9DLEVBQUVjLFdBQVdFLElBQUksQ0FBQyxPQUFPO2dCQUNyRWYsU0FBUztZQUNYLEdBQ0E7Z0JBQUVDLFFBQVE7WUFBSTtRQUVsQjtRQUVBLGlCQUFpQjtRQUNqQixJQUFJZTtRQUNKLElBQUk7WUFDRkEsWUFBWSxJQUFJQyxLQUFLWDtZQUNyQixJQUFJWSxNQUFNRixVQUFVRyxPQUFPLEtBQUs7Z0JBQzlCLE1BQU0sSUFBSUMsTUFBTTtZQUNsQjtRQUNGLEVBQUUsT0FBT3JCLE9BQU87WUFDZCxPQUFPVixxREFBWUEsQ0FBQ1MsSUFBSSxDQUN0QjtnQkFBRUMsT0FBTztnQkFBdUJDLFNBQVM7WUFBTSxHQUMvQztnQkFBRUMsUUFBUTtZQUFJO1FBRWxCO1FBRUEsK0RBQStEO1FBQy9ELElBQUlvQixlQUFlYjtRQUNuQixJQUFJLENBQUNBLFdBQVdELGFBQWFFLFVBQVU7WUFDckMsTUFBTWEsUUFBUSxJQUFJTCxLQUFLLENBQUMsV0FBVyxFQUFFVixVQUFVLEdBQUcsQ0FBQztZQUNuRCxNQUFNZ0IsTUFBTSxJQUFJTixLQUFLSyxNQUFNSCxPQUFPLEtBQUtWLFdBQVc7WUFDbERZLGVBQWVFLElBQUlDLFlBQVksR0FBR0MsU0FBUyxDQUFDLEdBQUc7UUFDakQ7UUFFQSxrQkFBa0I7UUFDbEIsTUFBTUMsUUFBdUI7WUFDM0JDLElBQUksQ0FBQyxTQUFTLEVBQUVWLEtBQUtXLEdBQUcsR0FBRyxDQUFDLEVBQUVDLEtBQUtDLE1BQU0sR0FBR0MsUUFBUSxDQUFDLElBQUlDLE1BQU0sQ0FBQyxHQUFHLElBQUk7WUFDdkU3QixPQUFPQSxNQUFNOEIsSUFBSTtZQUNqQjNCLE1BQU1VO1lBQ05ULFdBQVdBLGFBQWE7WUFDeEJDLFNBQVNhLGdCQUFnQjtZQUN6QmpCLE1BQU1BO1lBQ044QixPQUFPekMscUVBQWlCQSxDQUFDVztZQUN6QkMsU0FBU0EsV0FBVzhCO1lBQ3BCekIsVUFBVUEsWUFBWXlCO1lBQ3RCeEIsYUFBYUEsZUFBZTtZQUM1QkMsVUFBVUEsWUFBWTtZQUN0QkgsVUFBVUEsWUFBWTtRQUN4QjtRQUVBLHVEQUF1RDtRQUN2RCxNQUFNMkIsU0FBU3ZDLFFBQVF3QyxJQUFJLENBQUNWLEVBQUU7UUFDOUIsTUFBTTNCLFVBQVVSLG9FQUFnQkEsQ0FBQzRDLFFBQVFWO1FBRXpDLElBQUksQ0FBQzFCLFNBQVM7WUFDWixPQUFPWCxxREFBWUEsQ0FBQ1MsSUFBSSxDQUN0QjtnQkFDRUMsT0FBTztnQkFDUEMsU0FBUztZQUNYLEdBQ0E7Z0JBQUVDLFFBQVE7WUFBSTtRQUVsQjtRQUVBLGtEQUFrRDtRQUNsRCxNQUFNcUMsV0FBVzVDLHVFQUFtQkEsQ0FBQzBDO1FBQ3JDLE1BQU1HLGFBQWFELFVBQVVFLE9BQU9DLEtBQUtDLENBQUFBLElBQUtBLEVBQUVmLEVBQUUsS0FBS0QsTUFBTUMsRUFBRTtRQUUvRCxJQUFJLENBQUNZLFlBQVk7WUFDZixPQUFPbEQscURBQVlBLENBQUNTLElBQUksQ0FDdEI7Z0JBQ0VDLE9BQU87Z0JBQ1BDLFNBQVM7WUFDWCxHQUNBO2dCQUFFQyxRQUFRO1lBQUk7UUFFbEI7UUFFQTBDLFFBQVFDLEdBQUcsQ0FBQyxDQUFDLG1CQUFtQixFQUFFbEIsTUFBTXZCLEtBQUssQ0FBQyxNQUFNLEVBQUVpQyxRQUFRO1FBRTlELG1FQUFtRTtRQUNuRSxJQUFJLE9BQU9TLGVBQWUsYUFBYTtZQUNyQyxrREFBa0Q7WUFDbERDLFdBQVc7Z0JBQ1QsSUFBSSxLQUE2QixFQUFFLEVBSWxDO1lBQ0gsR0FBRztRQUNMO1FBRUEsT0FBT3pELHFEQUFZQSxDQUFDUyxJQUFJLENBQUM7WUFDdkJFLFNBQVM7WUFDVDBCLE9BQU9hO1lBQ1BZLFNBQVMsQ0FBQyxRQUFRLEVBQUV6QixNQUFNdkIsS0FBSyxDQUFDLHFCQUFxQixDQUFDO1lBQ3REaUQsYUFBYWQsVUFBVUUsT0FBT2EsVUFBVTtRQUMxQztJQUVGLEVBQUUsT0FBT3RELE9BQU87UUFDZDRDLFFBQVE1QyxLQUFLLENBQUMsb0NBQW9DQTtRQUVsRCxPQUFPVixxREFBWUEsQ0FBQ1MsSUFBSSxDQUN0QjtZQUNFQyxPQUFPO1lBQ1BDLFNBQVM7UUFDWCxHQUNBO1lBQUVDLFFBQVE7UUFBSTtJQUVsQjtBQUNGIiwic291cmNlcyI6WyIvVXNlcnMvcm9kcmlnb2RpYmVybmFyZG8zM2dtYWlsLmNvbS9Eb2N1bWVudHMvQXBwIERldmVsb3BtZW50IFByb3llY3RzL0ludGVsbGVnbyBQbGF0Zm9ybS9zcmMvYXBwL2FwaS9haS1jYWxlbmRhci9jcmVhdGUtZXZlbnQvcm91dGUudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgTmV4dFJlc3BvbnNlIH0gZnJvbSAnbmV4dC9zZXJ2ZXInXG5pbXBvcnQgeyBnZXRTZXJ2ZXJTZXNzaW9uIH0gZnJvbSAnbmV4dC1hdXRoJ1xuaW1wb3J0IHsgYXV0aE9wdGlvbnMgfSBmcm9tICdAL2xpYi9hdXRoJ1xuaW1wb3J0IHsgXG4gIGFkZENhbGVuZGFyRXZlbnQsIFxuICBDYWxlbmRhckV2ZW50LCBcbiAgZ2V0RXZlbnRUeXBlQ29sb3IsXG4gIGdldFVzZXJDYWxlbmRhckRhdGEgXG59IGZyb20gJ0AvbGliL2NhbGVuZGFyLWRhdGEnXG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBQT1NUKHJlcXVlc3Q6IFJlcXVlc3QpIHtcbiAgdHJ5IHtcbiAgICBjb25zdCBzZXNzaW9uID0gYXdhaXQgZ2V0U2VydmVyU2Vzc2lvbihhdXRoT3B0aW9ucylcbiAgICBcbiAgICBpZiAoIXNlc3Npb24pIHtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAgeyBlcnJvcjogJ0F1dGhlbnRpY2F0aW9uIHJlcXVpcmVkJywgc3VjY2VzczogZmFsc2UgfSxcbiAgICAgICAgeyBzdGF0dXM6IDQwMSB9XG4gICAgICApXG4gICAgfVxuXG4gICAgY29uc3QgYm9keSA9IGF3YWl0IHJlcXVlc3QuanNvbigpXG4gICAgY29uc3QgeyBcbiAgICAgIHRpdGxlLCBcbiAgICAgIHR5cGUsIFxuICAgICAgc3ViamVjdCwgXG4gICAgICBkYXRlLCBcbiAgICAgIHN0YXJ0VGltZSwgXG4gICAgICBlbmRUaW1lLCBcbiAgICAgIGR1cmF0aW9uLCBcbiAgICAgIGxvY2F0aW9uLCBcbiAgICAgIGRlc2NyaXB0aW9uLCBcbiAgICAgIHByaW9yaXR5IFxuICAgIH0gPSBib2R5XG5cbiAgICAvLyBWYWxpZGFjaW9uZXMgYsOhc2ljYXNcbiAgICBpZiAoIXRpdGxlIHx8ICF0eXBlIHx8ICFkYXRlKSB7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgIHsgXG4gICAgICAgICAgZXJyb3I6ICdNaXNzaW5nIHJlcXVpcmVkIGZpZWxkczogdGl0bGUsIHR5cGUsIGRhdGUnLCBcbiAgICAgICAgICBzdWNjZXNzOiBmYWxzZSBcbiAgICAgICAgfSxcbiAgICAgICAgeyBzdGF0dXM6IDQwMCB9XG4gICAgICApXG4gICAgfVxuXG4gICAgLy8gVmFsaWRhciB0aXBvIGRlIGV2ZW50b1xuICAgIGNvbnN0IHZhbGlkVHlwZXMgPSBbJ2V4YW0nLCAnc3R1ZHlfc2Vzc2lvbicsICdjbGFzcycsICdwZXJzb25hbCcsICdleHRyYWN1cnJpY3VsYXInXVxuICAgIGlmICghdmFsaWRUeXBlcy5pbmNsdWRlcyh0eXBlKSkge1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICB7IFxuICAgICAgICAgIGVycm9yOiBgSW52YWxpZCBldmVudCB0eXBlLiBNdXN0IGJlIG9uZSBvZjogJHt2YWxpZFR5cGVzLmpvaW4oJywgJyl9YCwgXG4gICAgICAgICAgc3VjY2VzczogZmFsc2UgXG4gICAgICAgIH0sXG4gICAgICAgIHsgc3RhdHVzOiA0MDAgfVxuICAgICAgKVxuICAgIH1cblxuICAgIC8vIFByb2Nlc2FyIGZlY2hhXG4gICAgbGV0IGV2ZW50RGF0ZTogRGF0ZVxuICAgIHRyeSB7XG4gICAgICBldmVudERhdGUgPSBuZXcgRGF0ZShkYXRlKVxuICAgICAgaWYgKGlzTmFOKGV2ZW50RGF0ZS5nZXRUaW1lKCkpKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcignSW52YWxpZCBkYXRlJylcbiAgICAgIH1cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICB7IGVycm9yOiAnSW52YWxpZCBkYXRlIGZvcm1hdCcsIHN1Y2Nlc3M6IGZhbHNlIH0sXG4gICAgICAgIHsgc3RhdHVzOiA0MDAgfVxuICAgICAgKVxuICAgIH1cblxuICAgIC8vIENhbGN1bGFyIGVuZFRpbWUgc2kgbm8gc2UgcHJvcG9yY2lvbmEgcGVybyBzZSB0aWVuZSBkdXJhdGlvblxuICAgIGxldCBmaW5hbEVuZFRpbWUgPSBlbmRUaW1lXG4gICAgaWYgKCFlbmRUaW1lICYmIHN0YXJ0VGltZSAmJiBkdXJhdGlvbikge1xuICAgICAgY29uc3Qgc3RhcnQgPSBuZXcgRGF0ZShgMjAwMC0wMS0wMVQke3N0YXJ0VGltZX06MDBgKVxuICAgICAgY29uc3QgZW5kID0gbmV3IERhdGUoc3RhcnQuZ2V0VGltZSgpICsgZHVyYXRpb24gKiA2MDAwMClcbiAgICAgIGZpbmFsRW5kVGltZSA9IGVuZC50b1RpbWVTdHJpbmcoKS5zdWJzdHJpbmcoMCwgNSlcbiAgICB9XG5cbiAgICAvLyBDcmVhciBlbCBldmVudG9cbiAgICBjb25zdCBldmVudDogQ2FsZW5kYXJFdmVudCA9IHtcbiAgICAgIGlkOiBgYWktZXZlbnQtJHtEYXRlLm5vdygpfS0ke01hdGgucmFuZG9tKCkudG9TdHJpbmcoMzYpLnN1YnN0cigyLCA5KX1gLFxuICAgICAgdGl0bGU6IHRpdGxlLnRyaW0oKSxcbiAgICAgIGRhdGU6IGV2ZW50RGF0ZSxcbiAgICAgIHN0YXJ0VGltZTogc3RhcnRUaW1lIHx8ICcxNTowMCcsXG4gICAgICBlbmRUaW1lOiBmaW5hbEVuZFRpbWUgfHwgJzE2OjAwJyxcbiAgICAgIHR5cGU6IHR5cGUgYXMgQ2FsZW5kYXJFdmVudFsndHlwZSddLFxuICAgICAgY29sb3I6IGdldEV2ZW50VHlwZUNvbG9yKHR5cGUgYXMgQ2FsZW5kYXJFdmVudFsndHlwZSddKSxcbiAgICAgIHN1YmplY3Q6IHN1YmplY3QgfHwgdW5kZWZpbmVkLFxuICAgICAgbG9jYXRpb246IGxvY2F0aW9uIHx8IHVuZGVmaW5lZCxcbiAgICAgIGRlc2NyaXB0aW9uOiBkZXNjcmlwdGlvbiB8fCAnQ3JlYWRvIGF1dG9tw6F0aWNhbWVudGUgcG9yIElBIFR1dG9yYScsXG4gICAgICBwcmlvcml0eTogcHJpb3JpdHkgfHwgJ21lZGl1bScsXG4gICAgICBkdXJhdGlvbjogZHVyYXRpb24gfHwgNjBcbiAgICB9XG5cbiAgICAvLyBJbnRlbnRhciBhZ3JlZ2FyIGVsIGV2ZW50byBhbCBjYWxlbmRhcmlvIGRlbCB1c3VhcmlvXG4gICAgY29uc3QgdXNlcklkID0gc2Vzc2lvbi51c2VyLmlkXG4gICAgY29uc3Qgc3VjY2VzcyA9IGFkZENhbGVuZGFyRXZlbnQodXNlcklkLCBldmVudClcblxuICAgIGlmICghc3VjY2Vzcykge1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICB7IFxuICAgICAgICAgIGVycm9yOiAnRmFpbGVkIHRvIGNyZWF0ZSBldmVudCBpbiBjYWxlbmRhcicsIFxuICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlIFxuICAgICAgICB9LFxuICAgICAgICB7IHN0YXR1czogNTAwIH1cbiAgICAgIClcbiAgICB9XG5cbiAgICAvLyBWZXJpZmljYXIgcXVlIGVsIGV2ZW50byBzZSBndWFyZMOzIGNvcnJlY3RhbWVudGVcbiAgICBjb25zdCB1c2VyRGF0YSA9IGdldFVzZXJDYWxlbmRhckRhdGEodXNlcklkKVxuICAgIGNvbnN0IHNhdmVkRXZlbnQgPSB1c2VyRGF0YT8uZXZlbnRzLmZpbmQoZSA9PiBlLmlkID09PSBldmVudC5pZClcblxuICAgIGlmICghc2F2ZWRFdmVudCkge1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICB7IFxuICAgICAgICAgIGVycm9yOiAnRXZlbnQgd2FzIG5vdCBzYXZlZCBjb3JyZWN0bHknLCBcbiAgICAgICAgICBzdWNjZXNzOiBmYWxzZSBcbiAgICAgICAgfSxcbiAgICAgICAgeyBzdGF0dXM6IDUwMCB9XG4gICAgICApXG4gICAgfVxuXG4gICAgY29uc29sZS5sb2coYPCfpJYgSUEgY3Jlw7MgZXZlbnRvOiAke2V2ZW50LnRpdGxlfSBwYXJhICR7dXNlcklkfWApXG5cbiAgICAvLyBEaXNwYXJhciBldmVudG8gZ2xvYmFsIHBhcmEgbm90aWZpY2FyIGEgbG9zIGNvbXBvbmVudGVzIGZyb250ZW5kXG4gICAgaWYgKHR5cGVvZiBnbG9iYWxUaGlzICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgLy8gVXNhciBzZXRUaW1lb3V0IHBhcmEgZXZpdGFyIHByb2JsZW1hcyBkZSB0aW1pbmdcbiAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICBpZiAodHlwZW9mIHdpbmRvdyAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICB3aW5kb3cuZGlzcGF0Y2hFdmVudChuZXcgQ3VzdG9tRXZlbnQoJ2NhbGVuZGFyRXZlbnRDcmVhdGVkJywge1xuICAgICAgICAgICAgZGV0YWlsOiB7IGV2ZW50OiBzYXZlZEV2ZW50LCB1c2VySWQgfVxuICAgICAgICAgIH0pKVxuICAgICAgICB9XG4gICAgICB9LCAxMDApXG4gICAgfVxuXG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHtcbiAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICBldmVudDogc2F2ZWRFdmVudCxcbiAgICAgIG1lc3NhZ2U6IGBFdmVudG8gXCIke2V2ZW50LnRpdGxlfVwiIGNyZWFkbyBleGl0b3NhbWVudGVgLFxuICAgICAgdG90YWxFdmVudHM6IHVzZXJEYXRhPy5ldmVudHMubGVuZ3RoIHx8IDBcbiAgICB9KVxuXG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcign4p2MIEVycm9yIGluIEFJIGNhbGVuZGFyIGNyZWF0aW9uOicsIGVycm9yKVxuICAgIFxuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgIHsgXG4gICAgICAgIGVycm9yOiAnSW50ZXJuYWwgc2VydmVyIGVycm9yIHdoaWxlIGNyZWF0aW5nIGV2ZW50JywgXG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlIFxuICAgICAgfSxcbiAgICAgIHsgc3RhdHVzOiA1MDAgfVxuICAgIClcbiAgfVxufSJdLCJuYW1lcyI6WyJOZXh0UmVzcG9uc2UiLCJnZXRTZXJ2ZXJTZXNzaW9uIiwiYXV0aE9wdGlvbnMiLCJhZGRDYWxlbmRhckV2ZW50IiwiZ2V0RXZlbnRUeXBlQ29sb3IiLCJnZXRVc2VyQ2FsZW5kYXJEYXRhIiwiUE9TVCIsInJlcXVlc3QiLCJzZXNzaW9uIiwianNvbiIsImVycm9yIiwic3VjY2VzcyIsInN0YXR1cyIsImJvZHkiLCJ0aXRsZSIsInR5cGUiLCJzdWJqZWN0IiwiZGF0ZSIsInN0YXJ0VGltZSIsImVuZFRpbWUiLCJkdXJhdGlvbiIsImxvY2F0aW9uIiwiZGVzY3JpcHRpb24iLCJwcmlvcml0eSIsInZhbGlkVHlwZXMiLCJpbmNsdWRlcyIsImpvaW4iLCJldmVudERhdGUiLCJEYXRlIiwiaXNOYU4iLCJnZXRUaW1lIiwiRXJyb3IiLCJmaW5hbEVuZFRpbWUiLCJzdGFydCIsImVuZCIsInRvVGltZVN0cmluZyIsInN1YnN0cmluZyIsImV2ZW50IiwiaWQiLCJub3ciLCJNYXRoIiwicmFuZG9tIiwidG9TdHJpbmciLCJzdWJzdHIiLCJ0cmltIiwiY29sb3IiLCJ1bmRlZmluZWQiLCJ1c2VySWQiLCJ1c2VyIiwidXNlckRhdGEiLCJzYXZlZEV2ZW50IiwiZXZlbnRzIiwiZmluZCIsImUiLCJjb25zb2xlIiwibG9nIiwiZ2xvYmFsVGhpcyIsInNldFRpbWVvdXQiLCJ3aW5kb3ciLCJkaXNwYXRjaEV2ZW50IiwiQ3VzdG9tRXZlbnQiLCJkZXRhaWwiLCJtZXNzYWdlIiwidG90YWxFdmVudHMiLCJsZW5ndGgiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./src/app/api/ai-calendar/create-event/route.ts\n");

/***/ }),

/***/ "(rsc)/./src/app/api/debug-sara-memory/route.ts":
/*!************************************************!*\
  !*** ./src/app/api/debug-sara-memory/route.ts ***!
  \************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   GET: () => (/* binding */ GET),\n/* harmony export */   POST: () => (/* binding */ POST)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/./node_modules/next/dist/api/server.js\");\n// Debugging endpoint for Sara's memory and conversation system\n\nasync function POST(req) {\n    try {\n        const { action, userId, message, sessionId, testType } = await req.json();\n        const results = {\n            timestamp: new Date(),\n            action,\n            userId: userId || 'debug-test-user',\n            sessionId: sessionId || 'debug-session-001',\n            results: {}\n        };\n        console.log(`üß™ Debug Sara Memory - Action: ${action}`);\n        switch(action){\n            case 'test_persistent_memory':\n                results.results = await testPersistentMemory(results.userId, results.sessionId);\n                break;\n            case 'test_calendar_execution':\n                results.results = await testCalendarExecution(results.userId, message);\n                break;\n            case 'test_conversation_coherence':\n                results.results = await testConversationCoherence(results.userId, results.sessionId);\n                break;\n            case 'full_integration_test':\n                results.results = await fullIntegrationTest(results.userId);\n                break;\n            case 'memory_inspection':\n                results.results = await inspectMemoryState(results.userId, results.sessionId);\n                break;\n            default:\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    success: false,\n                    error: 'Invalid action. Available: test_persistent_memory, test_calendar_execution, test_conversation_coherence, full_integration_test, memory_inspection'\n                }, {\n                    status: 400\n                });\n        }\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            success: true,\n            results,\n            message: `Debug action '${action}' completed successfully`\n        });\n    } catch (error) {\n        console.error('‚ùå Debug Sara Memory error:', error);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            success: false,\n            error: error instanceof Error ? error.message : 'Unknown error',\n            message: 'Debug test failed'\n        }, {\n            status: 500\n        });\n    }\n}\n/**\n * Test 1: Persistent Memory System\n */ async function testPersistentMemory(userId, sessionId) {\n    console.log('üß† Testing persistent memory system...');\n    const { getConversationSession, createConversationSession, addConversationTurn, addPendingTask, getPendingTasks } = __webpack_require__(/*! @/lib/temp-storage */ \"(rsc)/./src/lib/temp-storage.ts\");\n    const { ContextualConversationManager } = __webpack_require__(/*! @/lib/contextual-conversation-manager */ \"(rsc)/./src/lib/contextual-conversation-manager.ts\");\n    // Step 1: Send first message\n    const message1 = \"Hola Sara, expl√≠came qu√© son las ecuaciones cuadr√°ticas en matem√°ticas\";\n    const response1 = await ContextualConversationManager.processContextualMessage(userId, message1, sessionId, \"Estudiante Prueba\");\n    // Step 2: Check if conversation was stored\n    let session = getConversationSession(userId, sessionId);\n    const turnsAfterFirst = session ? session.turns.length : 0;\n    // Step 3: Send follow-up message to test memory\n    const message2 = \"Contin√∫a explicando con ejemplos pr√°cticos\";\n    const response2 = await ContextualConversationManager.processContextualMessage(userId, message2, sessionId, \"Estudiante Prueba\");\n    // Step 4: Check memory persistence\n    session = getConversationSession(userId, sessionId);\n    const turnsAfterSecond = session ? session.turns.length : 0;\n    // Step 5: Add a calendar task and test persistence\n    addPendingTask(userId, sessionId, 'calendar_event', 'Examen de matem√°ticas para el viernes', {\n        title: 'Examen de matem√°ticas',\n        date: '2025-07-25',\n        startTime: '10:00'\n    });\n    const pendingTasks = getPendingTasks(userId, sessionId);\n    return {\n        memoryPersistence: {\n            firstResponse: !!response1.content,\n            secondResponse: !!response2.content,\n            continuityScore: response2.continuityScore,\n            turnsAfterFirst,\n            turnsAfterSecond,\n            memoryWorking: turnsAfterSecond > turnsAfterFirst,\n            contextMaintained: response2.content.toLowerCase().includes('ecuaciones') || response2.content.toLowerCase().includes('matem√°ticas')\n        },\n        taskManagement: {\n            taskAdded: true,\n            pendingTasksCount: pendingTasks.length,\n            hasCalendarTask: pendingTasks.some((t)=>t.type === 'calendar_event'),\n            taskDetails: pendingTasks.length > 0 ? pendingTasks[0] : null\n        },\n        conversationData: {\n            sessionExists: !!session,\n            currentTopic: session?.currentTopic,\n            currentSubject: session?.currentSubject,\n            lastUpdate: session?.lastUpdate\n        }\n    };\n}\n/**\n * Test 2: Calendar Task Execution\n */ async function testCalendarExecution(userId, testMessage) {\n    console.log('üìÖ Testing calendar task execution...');\n    const { ContextualConversationManager } = __webpack_require__(/*! @/lib/contextual-conversation-manager */ \"(rsc)/./src/lib/contextual-conversation-manager.ts\");\n    // Test message that should trigger calendar creation\n    const calendarMessage = testMessage || \"Agrega un examen de qu√≠mica sobre reacciones qu√≠micas para el 25 de julio a las 9 AM en aula 104\";\n    console.log(`Sending calendar test message: \"${calendarMessage}\"`);\n    const response = await ContextualConversationManager.processContextualMessage(userId, calendarMessage, 'calendar-test-session', \"Estudiante Prueba\");\n    // Check if calendar task was handled\n    const wasCalendarTaskHandled = response.personalizations.includes('calendar_task_executed') || response.personalizations.includes('task_aware');\n    // Check response content for calendar confirmation\n    const hasCalendarConfirmation = response.content.toLowerCase().includes('calendario') || response.content.toLowerCase().includes('evento') || response.content.toLowerCase().includes('creado') || response.content.toLowerCase().includes('agregado');\n    return {\n        taskExecution: {\n            messageProcessed: !!response.content,\n            calendarTaskDetected: wasCalendarTaskHandled,\n            hasCalendarConfirmation,\n            responseLength: response.content.length,\n            personalizations: response.personalizations,\n            suggestedActions: response.suggestedFollowups\n        },\n        responseAnalysis: {\n            containsCalendarKeywords: hasCalendarConfirmation,\n            containsSuccessIndicators: response.content.toLowerCase().includes('‚úÖ') || response.content.toLowerCase().includes('perfecto') || response.content.toLowerCase().includes('creado'),\n            mentionsSpecificDetails: response.content.toLowerCase().includes('qu√≠mica') && response.content.toLowerCase().includes('25') && response.content.toLowerCase().includes('9')\n        },\n        fullResponse: response.content.substring(0, 300) + (response.content.length > 300 ? '...' : '')\n    };\n}\n/**\n * Test 3: Conversation Coherence Over Multiple Messages\n */ async function testConversationCoherence(userId, sessionId) {\n    console.log('üí¨ Testing conversation coherence...');\n    const { ContextualConversationManager } = __webpack_require__(/*! @/lib/contextual-conversation-manager */ \"(rsc)/./src/lib/contextual-conversation-manager.ts\");\n    // Simulate a 3-message conversation like the user's example\n    const messages = [\n        \"Sara, necesito ayuda con f√≠sica, espec√≠ficamente con cinem√°tica\",\n        \"Expl√≠came qu√© es el movimiento rectil√≠neo uniforme\",\n        \"¬øPuedes darme ejemplos de la vida real?\"\n    ];\n    const responses = [];\n    let coherenceScores = [];\n    let contextMaintained = true;\n    for(let i = 0; i < messages.length; i++){\n        console.log(`Sending message ${i + 1}: \"${messages[i]}\"`);\n        const response = await ContextualConversationManager.processContextualMessage(userId, messages[i], sessionId, \"Estudiante Prueba\");\n        responses.push({\n            messageIndex: i + 1,\n            response: response.content.substring(0, 200) + '...',\n            continuityScore: response.continuityScore,\n            personalizations: response.personalizations,\n            contextSubject: response.context.currentSubject,\n            contextTopic: response.context.currentTopic\n        });\n        coherenceScores.push(response.continuityScore);\n        // Check if context is maintained\n        if (i > 0) {\n            const maintainsPhysics = response.content.toLowerCase().includes('f√≠sica') || response.content.toLowerCase().includes('cinem√°tica') || response.context.currentSubject === 'f√≠sica';\n            if (!maintainsPhysics) {\n                contextMaintained = false;\n            }\n        }\n        // Small delay to simulate real conversation timing\n        await new Promise((resolve)=>setTimeout(resolve, 100));\n    }\n    const averageContinuityScore = coherenceScores.reduce((a, b)=>a + b, 0) / coherenceScores.length;\n    return {\n        conversationFlow: {\n            messagesProcessed: responses.length,\n            averageContinuityScore,\n            contextMaintained,\n            allResponsesGenerated: responses.every((r)=>r.response.length > 0),\n            subjectConsistency: responses.every((r)=>r.contextSubject === 'f√≠sica' || r.contextSubject === responses[0].contextSubject)\n        },\n        detailedResponses: responses,\n        coherenceAnalysis: {\n            firstMessageCoherent: coherenceScores[0] >= 0.5,\n            secondMessageCoherent: coherenceScores[1] >= 0.6,\n            thirdMessageCoherent: coherenceScores[2] >= 0.7,\n            improvingCoherence: coherenceScores[2] > coherenceScores[0]\n        }\n    };\n}\n/**\n * Test 4: Full Integration Test\n */ async function fullIntegrationTest(userId) {\n    console.log('üéØ Running full integration test...');\n    // Test all systems together\n    const memoryTest = await testPersistentMemory(userId, 'integration-session');\n    const calendarTest = await testCalendarExecution(userId, \"Agrega una sesi√≥n de estudio de matem√°ticas para ma√±ana a las 3 PM\");\n    const coherenceTest = await testConversationCoherence(userId, 'coherence-session');\n    const overallScore = (memoryTest.memoryPersistence.memoryWorking ? 25 : 0) + (memoryTest.taskManagement.hasCalendarTask ? 15 : 0) + (calendarTest.taskExecution.calendarTaskDetected ? 25 : 0) + (calendarTest.responseAnalysis.hasCalendarConfirmation ? 15 : 0) + (coherenceTest.conversationFlow.contextMaintained ? 20 : 0);\n    return {\n        overallScore: `${overallScore}/100`,\n        status: overallScore >= 85 ? 'EXCELLENT' : overallScore >= 70 ? 'GOOD' : overallScore >= 50 ? 'ACCEPTABLE' : 'NEEDS_IMPROVEMENT',\n        componentTests: {\n            memorySystem: memoryTest.memoryPersistence.memoryWorking,\n            taskManagement: memoryTest.taskManagement.hasCalendarTask,\n            calendarExecution: calendarTest.taskExecution.calendarTaskDetected,\n            calendarConfirmation: calendarTest.responseAnalysis.hasCalendarConfirmation,\n            conversationCoherence: coherenceTest.conversationFlow.contextMaintained\n        },\n        recommendations: overallScore < 85 ? [\n            overallScore < 50 ? 'Critical: Review persistent storage implementation' : null,\n            !calendarTest.taskExecution.calendarTaskDetected ? 'Fix calendar task detection' : null,\n            !coherenceTest.conversationFlow.contextMaintained ? 'Improve context management' : null,\n            !memoryTest.memoryPersistence.memoryWorking ? 'Debug conversation storage' : null\n        ].filter(Boolean) : [\n            'System working optimally'\n        ]\n    };\n}\n/**\n * Test 5: Memory State Inspection\n */ async function inspectMemoryState(userId, sessionId) {\n    console.log('üîç Inspecting memory state...');\n    const { getConversationSession, getUserActiveSessions, tempConversations, getPendingTasks } = __webpack_require__(/*! @/lib/temp-storage */ \"(rsc)/./src/lib/temp-storage.ts\");\n    const session = getConversationSession(userId, sessionId);\n    const activeSessions = getUserActiveSessions(userId);\n    const pendingTasks = getPendingTasks(userId, sessionId);\n    return {\n        sessionInspection: {\n            sessionExists: !!session,\n            turnsCount: session?.turns?.length || 0,\n            currentTopic: session?.currentTopic,\n            currentSubject: session?.currentSubject,\n            lastUpdate: session?.lastUpdate,\n            pendingTasksCount: session?.pendingTasks?.length || 0\n        },\n        userSessions: {\n            activeSessionsCount: activeSessions.length,\n            sessionIds: activeSessions.map((s)=>s.sessionId),\n            totalTurnsAcrossSessions: activeSessions.reduce((sum, s)=>sum + s.turns.length, 0)\n        },\n        globalState: {\n            totalConversations: tempConversations.length,\n            uniqueUsers: [\n                ...new Set(tempConversations.map((c)=>c.userId))\n            ].length\n        },\n        pendingTasks: {\n            count: pendingTasks.length,\n            types: [\n                ...new Set(pendingTasks.map((t)=>t.type))\n            ],\n            details: pendingTasks.map((t)=>({\n                    id: t.id,\n                    type: t.type,\n                    description: t.description,\n                    completed: t.completed\n                }))\n        }\n    };\n}\nasync function GET(req) {\n    return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n        success: true,\n        message: 'Sara Memory Debug Endpoint',\n        availableActions: [\n            'test_persistent_memory',\n            'test_calendar_execution',\n            'test_conversation_coherence',\n            'full_integration_test',\n            'memory_inspection'\n        ],\n        instructions: 'Send a POST request with action, userId (optional), sessionId (optional), and message (for calendar tests)'\n    });\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvYXBwL2FwaS9kZWJ1Zy1zYXJhLW1lbW9yeS9yb3V0ZS50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7QUFBQSwrREFBK0Q7QUFDUjtBQUVoRCxlQUFlQyxLQUFLQyxHQUFnQjtJQUN6QyxJQUFJO1FBQ0YsTUFBTSxFQUFFQyxNQUFNLEVBQUVDLE1BQU0sRUFBRUMsT0FBTyxFQUFFQyxTQUFTLEVBQUVDLFFBQVEsRUFBRSxHQUFHLE1BQU1MLElBQUlNLElBQUk7UUFFdkUsTUFBTUMsVUFBZTtZQUNuQkMsV0FBVyxJQUFJQztZQUNmUjtZQUNBQyxRQUFRQSxVQUFVO1lBQ2xCRSxXQUFXQSxhQUFhO1lBQ3hCRyxTQUFTLENBQUM7UUFDWjtRQUVBRyxRQUFRQyxHQUFHLENBQUMsQ0FBQywrQkFBK0IsRUFBRVYsUUFBUTtRQUV0RCxPQUFRQTtZQUNOLEtBQUs7Z0JBQ0hNLFFBQVFBLE9BQU8sR0FBRyxNQUFNSyxxQkFBcUJMLFFBQVFMLE1BQU0sRUFBRUssUUFBUUgsU0FBUztnQkFDOUU7WUFFRixLQUFLO2dCQUNIRyxRQUFRQSxPQUFPLEdBQUcsTUFBTU0sc0JBQXNCTixRQUFRTCxNQUFNLEVBQUVDO2dCQUM5RDtZQUVGLEtBQUs7Z0JBQ0hJLFFBQVFBLE9BQU8sR0FBRyxNQUFNTywwQkFBMEJQLFFBQVFMLE1BQU0sRUFBRUssUUFBUUgsU0FBUztnQkFDbkY7WUFFRixLQUFLO2dCQUNIRyxRQUFRQSxPQUFPLEdBQUcsTUFBTVEsb0JBQW9CUixRQUFRTCxNQUFNO2dCQUMxRDtZQUVGLEtBQUs7Z0JBQ0hLLFFBQVFBLE9BQU8sR0FBRyxNQUFNUyxtQkFBbUJULFFBQVFMLE1BQU0sRUFBRUssUUFBUUgsU0FBUztnQkFDNUU7WUFFRjtnQkFDRSxPQUFPTixxREFBWUEsQ0FBQ1EsSUFBSSxDQUFDO29CQUN2QlcsU0FBUztvQkFDVEMsT0FBTztnQkFDVCxHQUFHO29CQUFFQyxRQUFRO2dCQUFJO1FBQ3JCO1FBRUEsT0FBT3JCLHFEQUFZQSxDQUFDUSxJQUFJLENB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QSxJQUFLQSxFQUFFQyxJQUFJO2FBQUc7WUFDbERxRixTQUFTckcsYUFBYTBGLEdBQUcsQ0FBQzNFLENBQUFBLElBQU07b0JBQzlCdUYsSUFBSXZGLEVBQUV1RixFQUFFO29CQUNSdEYsTUFBTUQsRUFBRUMsSUFBSTtvQkFDWnVGLGFBQWF4RixFQUFFd0YsV0FBVztvQkFDMUJDLFdBQVd6RixFQUFFeUYsU0FBUztnQkFDeEI7UUFDRjtJQUNGO0FBQ0Y7QUFFTyxlQUFlQyxJQUFJbEosR0FBZ0I7SUFDeEMsT0FBT0YscURBQVlBLENBQUNRLElBQUksQ0FBQztRQUN2QlcsU0FBUztRQUNUZCxTQUFTO1FBQ1RnSixrQkFBa0I7WUFDaEI7WUFDQTtZQUNBO1lBQ0E7WUFDQTtTQUNEO1FBQ0RDLGNBQWM7SUFDaEI7QUFDRiIsInNvdXJjZXMiOlsiL1VzZXJzL3JvZHJpZ29kaWJlcm5hcmRvMzNnbWFpbC5jb20vRG9jdW1lbnRzL0FwcCBEZXZlbG9wbWVudCBQcm95ZWN0cy9JbnRlbGxlZ28gUGxhdGZvcm0vc3JjL2FwcC9hcGkvZGVidWctc2FyYS1tZW1vcnkvcm91dGUudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gRGVidWdnaW5nIGVuZHBvaW50IGZvciBTYXJhJ3MgbWVtb3J5IGFuZCBjb252ZXJzYXRpb24gc3lzdGVtXG5pbXBvcnQgeyBOZXh0UmVxdWVzdCwgTmV4dFJlc3BvbnNlIH0gZnJvbSAnbmV4dC9zZXJ2ZXInXG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBQT1NUKHJlcTogTmV4dFJlcXVlc3QpIHtcbiAgdHJ5IHtcbiAgICBjb25zdCB7IGFjdGlvbiwgdXNlcklkLCBtZXNzYWdlLCBzZXNzaW9uSWQsIHRlc3RUeXBlIH0gPSBhd2FpdCByZXEuanNvbigpXG4gICAgXG4gICAgY29uc3QgcmVzdWx0czogYW55ID0ge1xuICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLFxuICAgICAgYWN0aW9uLFxuICAgICAgdXNlcklkOiB1c2VySWQgfHwgJ2RlYnVnLXRlc3QtdXNlcicsXG4gICAgICBzZXNzaW9uSWQ6IHNlc3Npb25JZCB8fCAnZGVidWctc2Vzc2lvbi0wMDEnLFxuICAgICAgcmVzdWx0czoge31cbiAgICB9XG5cbiAgICBjb25zb2xlLmxvZyhg8J+nqiBEZWJ1ZyBTYXJhIE1lbW9yeSAtIEFjdGlvbjogJHthY3Rpb259YClcblxuICAgIHN3aXRjaCAoYWN0aW9uKSB7XG4gICAgICBjYXNlICd0ZXN0X3BlcnNpc3RlbnRfbWVtb3J5JzpcbiAgICAgICAgcmVzdWx0cy5yZXN1bHRzID0gYXdhaXQgdGVzdFBlcnNpc3RlbnRNZW1vcnkocmVzdWx0cy51c2VySWQsIHJlc3VsdHMuc2Vzc2lvbklkKVxuICAgICAgICBicmVha1xuXG4gICAgICBjYXNlICd0ZXN0X2NhbGVuZGFyX2V4ZWN1dGlvbic6XG4gICAgICAgIHJlc3VsdHMucmVzdWx0cyA9IGF3YWl0IHRlc3RDYWxlbmRhckV4ZWN1dGlvbihyZXN1bHRzLnVzZXJJZCwgbWVzc2FnZSlcbiAgICAgICAgYnJlYWtcblxuICAgICAgY2FzZSAndGVzdF9jb252ZXJzYXRpb25fY29oZXJlbmNlJzpcbiAgICAgICAgcmVzdWx0cy5yZXN1bHRzID0gYXdhaXQgdGVzdENvbnZlcnNhdGlvbkNvaGVyZW5jZShyZXN1bHRzLnVzZXJJZCwgcmVzdWx0cy5zZXNzaW9uSWQpXG4gICAgICAgIGJyZWFrXG5cbiAgICAgIGNhc2UgJ2Z1bGxfaW50ZWdyYXRpb25fdGVzdCc6XG4gICAgICAgIHJlc3VsdHMucmVzdWx0cyA9IGF3YWl0IGZ1bGxJbnRlZ3JhdGlvblRlc3QocmVzdWx0cy51c2VySWQpXG4gICAgICAgIGJyZWFrXG5cbiAgICAgIGNhc2UgJ21lbW9yeV9pbnNwZWN0aW9uJzpcbiAgICAgICAgcmVzdWx0cy5yZXN1bHRzID0gYXdhaXQgaW5zcGVjdE1lbW9yeVN0YXRlKHJlc3VsdHMudXNlcklkLCByZXN1bHRzLnNlc3Npb25JZClcbiAgICAgICAgYnJlYWtcblxuICAgICAgZGVmYXVsdDpcbiAgICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHtcbiAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgICBlcnJvcjogJ0ludmFsaWQgYWN0aW9uLiBBdmFpbGFibGU6IHRlc3RfcGVyc2lzdGVudF9tZW1vcnksIHRlc3RfY2FsZW5kYXJfZXhlY3V0aW9uLCB0ZXN0X2NvbnZlcnNhdGlvbl9jb2hlcmVuY2UsIGZ1bGxfaW50ZWdyYXRpb25fdGVzdCwgbWVtb3J5X2luc3BlY3Rpb24nXG4gICAgICAgIH0sIHsgc3RhdHVzOiA0MDAgfSlcbiAgICB9XG5cbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oe1xuICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgIHJlc3VsdHMsXG4gICAgICBtZXNzYWdlOiBgRGVidWcgYWN0aW9uICcke2FjdGlvbn0nIGNvbXBsZXRlZCBzdWNjZXNzZnVsbHlgXG4gICAgfSlcblxuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBEZWJ1ZyBTYXJhIE1lbW9yeSBlcnJvcjonLCBlcnJvcilcbiAgICBcbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oe1xuICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICBlcnJvcjogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnVW5rbm93biBlcnJvcicsXG4gICAgICBtZXNzYWdlOiAnRGVidWcgdGVzdCBmYWlsZWQnXG4gICAgfSwgeyBzdGF0dXM6IDUwMCB9KVxuICB9XG59XG5cbi8qKlxuICogVGVzdCAxOiBQZXJzaXN0ZW50IE1lbW9yeSBTeXN0ZW1cbiAqL1xuYXN5bmMgZnVuY3Rpb24gdGVzdFBlcnNpc3RlbnRNZW1vcnkodXNlcklkOiBzdHJpbmcsIHNlc3Npb25JZDogc3RyaW5nKSB7XG4gIGNvbnNvbGUubG9nKCfwn6egIFRlc3RpbmcgcGVyc2lzdGVudCBtZW1vcnkgc3lzdGVtLi4uJylcbiAgXG4gIGNvbnN0IHsgXG4gICAgZ2V0Q29udmVyc2F0aW9uU2Vzc2lvbiwgXG4gICAgY3JlYXRlQ29udmVyc2F0aW9uU2Vzc2lvbiwgXG4gICAgYWRkQ29udmVyc2F0aW9uVHVybixcbiAgICBhZGRQZW5kaW5nVGFzayxcbiAgICBnZXRQZW5kaW5nVGFza3NcbiAgfSA9IHJlcXVpcmUoJ0AvbGliL3RlbXAtc3RvcmFnZScpXG5cbiAgY29uc3QgeyBDb250ZXh0dWFsQ29udmVyc2F0aW9uTWFuYWdlciB9ID0gcmVxdWlyZSgnQC9saWIvY29udGV4dHVhbC1jb252ZXJzYXRpb24tbWFuYWdlcicpXG5cbiAgLy8gU3RlcCAxOiBTZW5kIGZpcnN0IG1lc3NhZ2VcbiAgY29uc3QgbWVzc2FnZTEgPSBcIkhvbGEgU2FyYSwgZXhwbMOtY2FtZSBxdcOpIHNvbiBsYXMgZWN1YWNpb25lcyBjdWFkcsOhdGljYXMgZW4gbWF0ZW3DoXRpY2FzXCJcbiAgY29uc3QgcmVzcG9uc2UxID0gYXdhaXQgQ29udGV4dHVhbENvbnZlcnNhdGlvbk1hbmFnZXIucHJvY2Vzc0NvbnRleHR1YWxNZXNzYWdlKFxuICAgIHVzZXJJZCwgbWVzc2FnZTEsIHNlc3Npb25JZCwgXCJFc3R1ZGlhbnRlIFBydWViYVwiXG4gIClcblxuICAvLyBTdGVwIDI6IENoZWNrIGlmIGNvbnZlcnNhdGlvbiB3YXMgc3RvcmVkXG4gIGxldCBzZXNzaW9uID0gZ2V0Q29udmVyc2F0aW9uU2Vzc2lvbih1c2VySWQsIHNlc3Npb25JZClcbiAgY29uc3QgdHVybnNBZnRlckZpcnN0ID0gc2Vzc2lvbiA/IHNlc3Npb24udHVybnMubGVuZ3RoIDogMFxuXG4gIC8vIFN0ZXAgMzogU2VuZCBmb2xsb3ctdXAgbWVzc2FnZSB0byB0ZXN0IG1lbW9yeVxuICBjb25zdCBtZXNzYWdlMiA9IFwiQ29udGluw7phIGV4cGxpY2FuZG8gY29uIGVqZW1wbG9zIHByw6FjdGljb3NcIlxuICBjb25zdCByZXNwb25zZTIgPSBhd2FpdCBDb250ZXh0dWFsQ29udmVyc2F0aW9uTWFuYWdlci5wcm9jZXNzQ29udGV4dHVhbE1lc3NhZ2UoXG4gICAgdXNlcklkLCBtZXNzYWdlMiwgc2Vzc2lvbklkLCBcIkVzdHVkaWFudGUgUHJ1ZWJhXCJcbiAgKVxuXG4gIC8vIFN0ZXAgNDogQ2hlY2sgbWVtb3J5IHBlcnNpc3RlbmNlXG4gIHNlc3Npb24gPSBnZXRDb252ZXJzYXRpb25TZXNzaW9uKHVzZXJJZCwgc2Vzc2lvbklkKVxuICBjb25zdCB0dXJuc0FmdGVyU2Vjb25kID0gc2Vzc2lvbiA/IHNlc3Npb24udHVybnMubGVuZ3RoIDogMFxuXG4gIC8vIFN0ZXAgNTogQWRkIGEgY2FsZW5kYXIgdGFzayBhbmQgdGVzdCBwZXJzaXN0ZW5jZVxuICBhZGRQZW5kaW5nVGFzayh1c2VySWQsIHNlc3Npb25JZCwgJ2NhbGVuZGFyX2V2ZW50JywgJ0V4YW1lbiBkZSBtYXRlbcOhdGljYXMgcGFyYSBlbCB2aWVybmVzJywge1xuICAgIHRpdGxlOiAnRXhhbWVuIGRlIG1hdGVtw6F0aWNhcycsXG4gICAgZGF0ZTogJzIwMjUtMDctMjUnLFxuICAgIHN0YXJ0VGltZTogJzEwOjAwJ1xuICB9KVxuXG4gIGNvbnN0IHBlbmRpbmdUYXNrcyA9IGdldFBlbmRpbmdUYXNrcyh1c2VySWQsIHNlc3Npb25JZClcblxuICByZXR1cm4ge1xuICAgIG1lbW9yeVBlcnNpc3RlbmNlOiB7XG4gICAgICBmaXJzdFJlc3BvbnNlOiAhIXJlc3BvbnNlMS5jb250ZW50LFxuICAgICAgc2Vjb25kUmVzcG9uc2U6ICEhcmVzcG9uc2UyLmNvbnRlbnQsXG4gICAgICBjb250aW51aXR5U2NvcmU6IHJlc3BvbnNlMi5jb250aW51aXR5U2NvcmUsXG4gICAgICB0dXJuc0FmdGVyRmlyc3QsXG4gICAgICB0dXJuc0FmdGVyU2Vjb25kLFxuICAgICAgbWVtb3J5V29ya2luZzogdHVybnNBZnRlclNlY29uZCA+IHR1cm5zQWZ0ZXJGaXJzdCxcbiAgICAgIGNvbnRleHRNYWludGFpbmVkOiByZXNwb25zZTIuY29udGVudC50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKCdlY3VhY2lvbmVzJykgfHwgXG4gICAgICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlMi5jb250ZW50LnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMoJ21hdGVtw6F0aWNhcycpXG4gICAgfSxcbiAgICB0YXNrTWFuYWdlbWVudDoge1xuICAgICAgdGFza0FkZGVkOiB0cnVlLFxuICAgICAgcGVuZGluZ1Rhc2tzQ291bnQ6IHBlbmRpbmdUYXNrcy5sZW5ndGgsXG4gICAgICBoYXNDYWxlbmRhclRhc2s6IHBlbmRpbmdUYXNrcy5zb21lKHQgPT4gdC50eXBlID09PSAnY2FsZW5kYXJfZXZlbnQnKSxcbiAgICAgIHRhc2tEZXRhaWxzOiBwZW5kaW5nVGFza3MubGVuZ3RoID4gMCA/IHBlbmRpbmdUYXNrc1swXSA6IG51bGxcbiAgICB9LFxuICAgIGNvbnZlcnNhdGlvbkRhdGE6IHtcbiAgICAgIHNlc3Npb25FeGlzdHM6ICEhc2Vzc2lvbixcbiAgICAgIGN1cnJlbnRUb3BpYzogc2Vzc2lvbj8uY3VycmVudFRvcGljLFxuICAgICAgY3VycmVudFN1YmplY3Q6IHNlc3Npb24/LmN1cnJlbnRTdWJqZWN0LFxuICAgICAgbGFzdFVwZGF0ZTogc2Vzc2lvbj8ubGFzdFVwZGF0ZVxuICAgIH1cbiAgfVxufVxuXG4vKipcbiAqIFRlc3QgMjogQ2FsZW5kYXIgVGFzayBFeGVjdXRpb25cbiAqL1xuYXN5bmMgZnVuY3Rpb24gdGVzdENhbGVuZGFyRXhlY3V0aW9uKHVzZXJJZDogc3RyaW5nLCB0ZXN0TWVzc2FnZT86IHN0cmluZykge1xuICBjb25zb2xlLmxvZygn8J+ThSBUZXN0aW5nIGNhbGVuZGFyIHRhc2sgZXhlY3V0aW9uLi4uJylcbiAgXG4gIGNvbnN0IHsgQ29udGV4dHVhbENvbnZlcnNhdGlvbk1hbmFnZXIgfSA9IHJlcXVpcmUoJ0AvbGliL2NvbnRleHR1YWwtY29udmVyc2F0aW9uLW1hbmFnZXInKVxuICBcbiAgLy8gVGVzdCBtZXNzYWdlIHRoYXQgc2hvdWxkIHRyaWdnZXIgY2FsZW5kYXIgY3JlYXRpb25cbiAgY29uc3QgY2FsZW5kYXJNZXNzYWdlID0gdGVzdE1lc3NhZ2UgfHwgXCJBZ3JlZ2EgdW4gZXhhbWVuIGRlIHF1w61taWNhIHNvYnJlIHJlYWNjaW9uZXMgcXXDrW1pY2FzIHBhcmEgZWwgMjUgZGUganVsaW8gYSBsYXMgOSBBTSBlbiBhdWxhIDEwNFwiXG4gIFxuICBjb25zb2xlLmxvZyhgU2VuZGluZyBjYWxlbmRhciB0ZXN0IG1lc3NhZ2U6IFwiJHtjYWxlbmRhck1lc3NhZ2V9XCJgKVxuICBcbiAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBDb250ZXh0dWFsQ29udmVyc2F0aW9uTWFuYWdlci5wcm9jZXNzQ29udGV4dHVhbE1lc3NhZ2UoXG4gICAgdXNlcklkLCBjYWxlbmRhck1lc3NhZ2UsICdjYWxlbmRhci10ZXN0LXNlc3Npb24nLCBcIkVzdHVkaWFudGUgUHJ1ZWJhXCJcbiAgKVxuXG4gIC8vIENoZWNrIGlmIGNhbGVuZGFyIHRhc2sgd2FzIGhhbmRsZWRcbiAgY29uc3Qgd2FzQ2FsZW5kYXJUYXNrSGFuZGxlZCA9IHJlc3BvbnNlLnBlcnNvbmFsaXphdGlvbnMuaW5jbHVkZXMoJ2NhbGVuZGFyX3Rhc2tfZXhlY3V0ZWQnKSB8fFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNwb25zZS5wZXJzb25hbGl6YXRpb25zLmluY2x1ZGVzKCd0YXNrX2F3YXJlJylcbiAgXG4gIC8vIENoZWNrIHJlc3BvbnNlIGNvbnRlbnQgZm9yIGNhbGVuZGFyIGNvbmZpcm1hdGlvblxuICBjb25zdCBoYXNDYWxlbmRhckNvbmZpcm1hdGlvbiA9IHJlc3BvbnNlLmNvbnRlbnQudG9Mb3dlckNhc2UoKS5pbmNsdWRlcygnY2FsZW5kYXJpbycpIHx8XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNwb25zZS5jb250ZW50LnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMoJ2V2ZW50bycpIHx8XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNwb25zZS5jb250ZW50LnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMoJ2NyZWFkbycpIHx8XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNwb25zZS5jb250ZW50LnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMoJ2FncmVnYWRvJylcblxuICByZXR1cm4ge1xuICAgIHRhc2tFeGVjdXRpb246IHtcbiAgICAgIG1lc3NhZ2VQcm9jZXNzZWQ6ICEhcmVzcG9uc2UuY29udGVudCxcbiAgICAgIGNhbGVuZGFyVGFza0RldGVjdGVkOiB3YXNDYWxlbmRhclRhc2tIYW5kbGVkLFxuICAgICAgaGFzQ2FsZW5kYXJDb25maXJtYXRpb24sXG4gICAgICByZXNwb25zZUxlbmd0aDogcmVzcG9uc2UuY29udGVudC5sZW5ndGgsXG4gICAgICBwZXJzb25hbGl6YXRpb25zOiByZXNwb25zZS5wZXJzb25hbGl6YXRpb25zLFxuICAgICAgc3VnZ2VzdGVkQWN0aW9uczogcmVzcG9uc2Uuc3VnZ2VzdGVkRm9sbG93dXBzXG4gICAgfSxcbiAgICByZXNwb25zZUFuYWx5c2lzOiB7XG4gICAgICBjb250YWluc0NhbGVuZGFyS2V5d29yZHM6IGhhc0NhbGVuZGFyQ29uZmlybWF0aW9uLFxuICAgICAgY29udGFpbnNTdWNjZXNzSW5kaWNhdG9yczogcmVzcG9uc2UuY29udGVudC50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKCfinIUnKSB8fFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNwb25zZS5jb250ZW50LnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMoJ3BlcmZlY3RvJykgfHxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2UuY29udGVudC50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKCdjcmVhZG8nKSxcbiAgICAgIG1lbnRpb25zU3BlY2lmaWNEZXRhaWxzOiByZXNwb25zZS5jb250ZW50LnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMoJ3F1w61taWNhJykgJiZcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlLmNvbnRlbnQudG9Mb3dlckNhc2UoKS5pbmNsdWRlcygnMjUnKSAmJlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2UuY29udGVudC50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKCc5JylcbiAgICB9LFxuICAgIGZ1bGxSZXNwb25zZTogcmVzcG9uc2UuY29udGVudC5zdWJzdHJpbmcoMCwgMzAwKSArIChyZXNwb25zZS5jb250ZW50Lmxlbmd0aCA+IDMwMCA/ICcuLi4nIDogJycpXG4gIH1cbn1cblxuLyoqXG4gKiBUZXN0IDM6IENvbnZlcnNhdGlvbiBDb2hlcmVuY2UgT3ZlciBNdWx0aXBsZSBNZXNzYWdlc1xuICovXG5hc3luYyBmdW5jdGlvbiB0ZXN0Q29udmVyc2F0aW9uQ29oZXJlbmNlKHVzZXJJZDogc3RyaW5nLCBzZXNzaW9uSWQ6IHN0cmluZykge1xuICBjb25zb2xlLmxvZygn8J+SrCBUZXN0aW5nIGNvbnZlcnNhdGlvbiBjb2hlcmVuY2UuLi4nKVxuICBcbiAgY29uc3QgeyBDb250ZXh0dWFsQ29udmVyc2F0aW9uTWFuYWdlciB9ID0gcmVxdWlyZSgnQC9saWIvY29udGV4dHVhbC1jb252ZXJzYXRpb24tbWFuYWdlcicpXG4gIFxuICAvLyBTaW11bGF0ZSBhIDMtbWVzc2FnZSBjb252ZXJzYXRpb24gbGlrZSB0aGUgdXNlcidzIGV4YW1wbGVcbiAgY29uc3QgbWVzc2FnZXMgPSBbXG4gICAgXCJTYXJhLCBuZWNlc2l0byBheXVkYSBjb24gZsOtc2ljYSwgZXNwZWPDrWZpY2FtZW50ZSBjb24gY2luZW3DoXRpY2FcIixcbiAgICBcIkV4cGzDrWNhbWUgcXXDqSBlcyBlbCBtb3ZpbWllbnRvIHJlY3RpbMOtbmVvIHVuaWZvcm1lXCIsXG4gICAgXCLCv1B1ZWRlcyBkYXJtZSBlamVtcGxvcyBkZSBsYSB2aWRhIHJlYWw/XCJcbiAgXVxuXG4gIGNvbnN0IHJlc3BvbnNlcyA9IFtdXG4gIGxldCBjb2hlcmVuY2VTY29yZXMgPSBbXVxuICBsZXQgY29udGV4dE1haW50YWluZWQgPSB0cnVlXG5cbiAgZm9yIChsZXQgaSA9IDA7IGkgPCBtZXNzYWdlcy5sZW5ndGg7IGkrKykge1xuICAgIGNvbnNvbGUubG9nKGBTZW5kaW5nIG1lc3NhZ2UgJHtpICsgMX06IFwiJHttZXNzYWdlc1tpXX1cImApXG4gICAgXG4gICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBDb250ZXh0dWFsQ29udmVyc2F0aW9uTWFuYWdlci5wcm9jZXNzQ29udGV4dHVhbE1lc3NhZ2UoXG4gICAgICB1c2VySWQsIG1lc3NhZ2VzW2ldLCBzZXNzaW9uSWQsIFwiRXN0dWRpYW50ZSBQcnVlYmFcIlxuICAgIClcbiAgICBcbiAgICByZXNwb25zZXMucHVzaCh7XG4gICAgICBtZXNzYWdlSW5kZXg6IGkgKyAxLFxuICAgICAgcmVzcG9uc2U6IHJlc3BvbnNlLmNvbnRlbnQuc3Vic3RyaW5nKDAsIDIwMCkgKyAnLi4uJyxcbiAgICAgIGNvbnRpbnVpdHlTY29yZTogcmVzcG9uc2UuY29udGludWl0eVNjb3JlLFxuICAgICAgcGVyc29uYWxpemF0aW9uczogcmVzcG9uc2UucGVyc29uYWxpemF0aW9ucyxcbiAgICAgIGNvbnRleHRTdWJqZWN0OiByZXNwb25zZS5jb250ZXh0LmN1cnJlbnRTdWJqZWN0LFxuICAgICAgY29udGV4dFRvcGljOiByZXNwb25zZS5jb250ZXh0LmN1cnJlbnRUb3BpY1xuICAgIH0pXG4gICAgXG4gICAgY29oZXJlbmNlU2NvcmVzLnB1c2gocmVzcG9uc2UuY29udGludWl0eVNjb3JlKVxuICAgIFxuICAgIC8vIENoZWNrIGlmIGNvbnRleHQgaXMgbWFpbnRhaW5lZFxuICAgIGlmIChpID4gMCkge1xuICAgICAgY29uc3QgbWFpbnRhaW5zUGh5c2ljcyA9IHJlc3BvbnNlLmNvbnRlbnQudG9Mb3dlckNhc2UoKS5pbmNsdWRlcygnZsOtc2ljYScpIHx8XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNwb25zZS5jb250ZW50LnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMoJ2NpbmVtw6F0aWNhJykgfHxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlLmNvbnRleHQuY3VycmVudFN1YmplY3QgPT09ICdmw61zaWNhJ1xuICAgICAgaWYgKCFtYWludGFpbnNQaHlzaWNzKSB7XG4gICAgICAgIGNvbnRleHRNYWludGFpbmVkID0gZmFsc2VcbiAgICAgIH1cbiAgICB9XG4gICAgXG4gICAgLy8gU21hbGwgZGVsYXkgdG8gc2ltdWxhdGUgcmVhbCBjb252ZXJzYXRpb24gdGltaW5nXG4gICAgYXdhaXQgbmV3IFByb21pc2UocmVzb2x2ZSA9PiBzZXRUaW1lb3V0KHJlc29sdmUsIDEwMCkpXG4gIH1cblxuICBjb25zdCBhdmVyYWdlQ29udGludWl0eVNjb3JlID0gY29oZXJlbmNlU2NvcmVzLnJlZHVjZSgoYSwgYikgPT4gYSArIGIsIDApIC8gY29oZXJlbmNlU2NvcmVzLmxlbmd0aFxuXG4gIHJldHVybiB7XG4gICAgY29udmVyc2F0aW9uRmxvdzoge1xuICAgICAgbWVzc2FnZXNQcm9jZXNzZWQ6IHJlc3BvbnNlcy5sZW5ndGgsXG4gICAgICBhdmVyYWdlQ29udGludWl0eVNjb3JlLFxuICAgICAgY29udGV4dE1haW50YWluZWQsXG4gICAgICBhbGxSZXNwb25zZXNHZW5lcmF0ZWQ6IHJlc3BvbnNlcy5ldmVyeShyID0+IHIucmVzcG9uc2UubGVuZ3RoID4gMCksXG4gICAgICBzdWJqZWN0Q29uc2lzdGVuY3k6IHJlc3BvbnNlcy5ldmVyeShyID0+IHIuY29udGV4dFN1YmplY3QgPT09ICdmw61zaWNhJyB8fCBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgci5jb250ZXh0U3ViamVjdCA9PT0gcmVzcG9uc2VzWzBdLmNvbnRleHRTdWJqZWN0KVxuICAgIH0sXG4gICAgZGV0YWlsZWRSZXNwb25zZXM6IHJlc3BvbnNlcyxcbiAgICBjb2hlcmVuY2VBbmFseXNpczoge1xuICAgICAgZmlyc3RNZXNzYWdlQ29oZXJlbnQ6IGNvaGVyZW5jZVNjb3Jlc1swXSA+PSAwLjUsXG4gICAgICBzZWNvbmRNZXNzYWdlQ29oZXJlbnQ6IGNvaGVyZW5jZVNjb3Jlc1sxXSA+PSAwLjYsXG4gICAgICB0aGlyZE1lc3NhZ2VDb2hlcmVudDogY29oZXJlbmNlU2NvcmVzWzJdID49IDAuNyxcbiAgICAgIGltcHJvdmluZ0NvaGVyZW5jZTogY29oZXJlbmNlU2NvcmVzWzJdID4gY29oZXJlbmNlU2NvcmVzWzBdXG4gICAgfVxuICB9XG59XG5cbi8qKlxuICogVGVzdCA0OiBGdWxsIEludGVncmF0aW9uIFRlc3RcbiAqL1xuYXN5bmMgZnVuY3Rpb24gZnVsbEludGVncmF0aW9uVGVzdCh1c2VySWQ6IHN0cmluZykge1xuICBjb25zb2xlLmxvZygn8J+OryBSdW5uaW5nIGZ1bGwgaW50ZWdyYXRpb24gdGVzdC4uLicpXG4gIFxuICAvLyBUZXN0IGFsbCBzeXN0ZW1zIHRvZ2V0aGVyXG4gIGNvbnN0IG1lbW9yeVRlc3QgPSBhd2FpdCB0ZXN0UGVyc2lzdGVudE1lbW9yeSh1c2VySWQsICdpbnRlZ3JhdGlvbi1zZXNzaW9uJylcbiAgY29uc3QgY2FsZW5kYXJUZXN0ID0gYXdhaXQgdGVzdENhbGVuZGFyRXhlY3V0aW9uKHVzZXJJZCwgXCJBZ3JlZ2EgdW5hIHNlc2nDs24gZGUgZXN0dWRpbyBkZSBtYXRlbcOhdGljYXMgcGFyYSBtYcOxYW5hIGEgbGFzIDMgUE1cIilcbiAgY29uc3QgY29oZXJlbmNlVGVzdCA9IGF3YWl0IHRlc3RDb252ZXJzYXRpb25Db2hlcmVuY2UodXNlcklkLCAnY29oZXJlbmNlLXNlc3Npb24nKVxuXG4gIGNvbnN0IG92ZXJhbGxTY29yZSA9IChcbiAgICAobWVtb3J5VGVzdC5tZW1vcnlQZXJzaXN0ZW5jZS5tZW1vcnlXb3JraW5nID8gMjUgOiAwKSArXG4gICAgKG1lbW9yeVRlc3QudGFza01hbmFnZW1lbnQuaGFzQ2FsZW5kYXJUYXNrID8gMTUgOiAwKSArXG4gICAgKGNhbGVuZGFyVGVzdC50YXNrRXhlY3V0aW9uLmNhbGVuZGFyVGFza0RldGVjdGVkID8gMjUgOiAwKSArXG4gICAgKGNhbGVuZGFyVGVzdC5yZXNwb25zZUFuYWx5c2lzLmhhc0NhbGVuZGFyQ29uZmlybWF0aW9uID8gMTUgOiAwKSArXG4gICAgKGNvaGVyZW5jZVRlc3QuY29udmVyc2F0aW9uRmxvdy5jb250ZXh0TWFpbnRhaW5lZCA/IDIwIDogMClcbiAgKVxuXG4gIHJldHVybiB7XG4gICAgb3ZlcmFsbFNjb3JlOiBgJHtvdmVyYWxsU2NvcmV9LzEwMGAsXG4gICAgc3RhdHVzOiBvdmVyYWxsU2NvcmUgPj0gODUgPyAnRVhDRUxMRU5UJyA6IFxuICAgICAgICAgICAgb3ZlcmFsbFNjb3JlID49IDcwID8gJ0dPT0QnIDogXG4gICAgICAgICAgICBvdmVyYWxsU2NvcmUgPj0gNTAgPyAnQUNDRVBUQUJMRScgOiAnTkVFRFNfSU1QUk9WRU1FTlQnLFxuICAgIGNvbXBvbmVudFRlc3RzOiB7XG4gICAgICBtZW1vcnlTeXN0ZW06IG1lbW9yeVRlc3QubWVtb3J5UGVyc2lzdGVuY2UubWVtb3J5V29ya2luZyxcbiAgICAgIHRhc2tNYW5hZ2VtZW50OiBtZW1vcnlUZXN0LnRhc2tNYW5hZ2VtZW50Lmhhc0NhbGVuZGFyVGFzayxcbiAgICAgIGNhbGVuZGFyRXhlY3V0aW9uOiBjYWxlbmRhclRlc3QudGFza0V4ZWN1dGlvbi5jYWxlbmRhclRhc2tEZXRlY3RlZCxcbiAgICAgIGNhbGVuZGFyQ29uZmlybWF0aW9uOiBjYWxlbmRhclRlc3QucmVzcG9uc2VBbmFseXNpcy5oYXNDYWxlbmRhckNvbmZpcm1hdGlvbixcbiAgICAgIGNvbnZlcnNhdGlvbkNvaGVyZW5jZTogY29oZXJlbmNlVGVzdC5jb252ZXJzYXRpb25GbG93LmNvbnRleHRNYWludGFpbmVkXG4gICAgfSxcbiAgICByZWNvbW1lbmRhdGlvbnM6IG92ZXJhbGxTY29yZSA8IDg1ID8gW1xuICAgICAgb3ZlcmFsbFNjb3JlIDwgNTAgPyAnQ3JpdGljYWw6IFJldmlldyBwZXJzaXN0ZW50IHN0b3JhZ2UgaW1wbGVtZW50YXRpb24nIDogbnVsbCxcbiAgICAgICFjYWxlbmRhclRlc3QudGFza0V4ZWN1dGlvbi5jYWxlbmRhclRhc2tEZXRlY3RlZCA/ICdGaXggY2FsZW5kYXIgdGFzayBkZXRlY3Rpb24nIDogbnVsbCxcbiAgICAgICFjb2hlcmVuY2VUZXN0LmNvbnZlcnNhdGlvbkZsb3cuY29udGV4dE1haW50YWluZWQgPyAnSW1wcm92ZSBjb250ZXh0IG1hbmFnZW1lbnQnIDogbnVsbCxcbiAgICAgICFtZW1vcnlUZXN0Lm1lbW9yeVBlcnNpc3RlbmNlLm1lbW9yeVdvcmtpbmcgPyAnRGVidWcgY29udmVyc2F0aW9uIHN0b3JhZ2UnIDogbnVsbFxuICAgIF0uZmlsdGVyKEJvb2xlYW4pIDogWydTeXN0ZW0gd29ya2luZyBvcHRpbWFsbHknXVxuICB9XG59XG5cbi8qKlxuICogVGVzdCA1OiBNZW1vcnkgU3RhdGUgSW5zcGVjdGlvblxuICovXG5hc3luYyBmdW5jdGlvbiBpbnNwZWN0TWVtb3J5U3RhdGUodXNlcklkOiBzdHJpbmcsIHNlc3Npb25JZDogc3RyaW5nKSB7XG4gIGNvbnNvbGUubG9nKCfwn5SNIEluc3BlY3RpbmcgbWVtb3J5IHN0YXRlLi4uJylcbiAgXG4gIGNvbnN0IHsgXG4gICAgZ2V0Q29udmVyc2F0aW9uU2Vzc2lvbixcbiAgICBnZXRVc2VyQWN0aXZlU2Vzc2lvbnMsXG4gICAgdGVtcENvbnZlcnNhdGlvbnMsXG4gICAgZ2V0UGVuZGluZ1Rhc2tzXG4gIH0gPSByZXF1aXJlKCdAL2xpYi90ZW1wLXN0b3JhZ2UnKVxuXG4gIGNvbnN0IHNlc3Npb24gPSBnZXRDb252ZXJzYXRpb25TZXNzaW9uKHVzZXJJZCwgc2Vzc2lvbklkKVxuICBjb25zdCBhY3RpdmVTZXNzaW9ucyA9IGdldFVzZXJBY3RpdmVTZXNzaW9ucyh1c2VySWQpXG4gIGNvbnN0IHBlbmRpbmdUYXNrcyA9IGdldFBlbmRpbmdUYXNrcyh1c2VySWQsIHNlc3Npb25JZClcblxuICByZXR1cm4ge1xuICAgIHNlc3Npb25JbnNwZWN0aW9uOiB7XG4gICAgICBzZXNzaW9uRXhpc3RzOiAhIXNlc3Npb24sXG4gICAgICB0dXJuc0NvdW50OiBzZXNzaW9uPy50dXJucz8ubGVuZ3RoIHx8IDAsXG4gICAgICBjdXJyZW50VG9waWM6IHNlc3Npb24/LmN1cnJlbnRUb3BpYyxcbiAgICAgIGN1cnJlbnRTdWJqZWN0OiBzZXNzaW9uPy5jdXJyZW50U3ViamVjdCxcbiAgICAgIGxhc3RVcGRhdGU6IHNlc3Npb24/Lmxhc3RVcGRhdGUsXG4gICAgICBwZW5kaW5nVGFza3NDb3VudDogc2Vzc2lvbj8ucGVuZGluZ1Rhc2tzPy5sZW5ndGggfHwgMFxuICAgIH0sXG4gICAgdXNlclNlc3Npb25zOiB7XG4gICAgICBhY3RpdmVTZXNzaW9uc0NvdW50OiBhY3RpdmVTZXNzaW9ucy5sZW5ndGgsXG4gICAgICBzZXNzaW9uSWRzOiBhY3RpdmVTZXNzaW9ucy5tYXAocyA9PiBzLnNlc3Npb25JZCksXG4gICAgICB0b3RhbFR1cm5zQWNyb3NzU2Vzc2lvbnM6IGFjdGl2ZVNlc3Npb25zLnJlZHVjZSgoc3VtLCBzKSA9PiBzdW0gKyBzLnR1cm5zLmxlbmd0aCwgMClcbiAgICB9LFxuICAgIGdsb2JhbFN0YXRlOiB7XG4gICAgICB0b3RhbENvbnZlcnNhdGlvbnM6IHRlbXBDb252ZXJzYXRpb25zLmxlbmd0aCxcbiAgICAgIHVuaXF1ZVVzZXJzOiBbLi4ubmV3IFNldCh0ZW1wQ29udmVyc2F0aW9ucy5tYXAoYyA9PiBjLnVzZXJJZCkpXS5sZW5ndGhcbiAgICB9LFxuICAgIHBlbmRpbmdUYXNrczoge1xuICAgICAgY291bnQ6IHBlbmRpbmdUYXNrcy5sZW5ndGgsXG4gICAgICB0eXBlczogWy4uLm5ldyBTZXQocGVuZGluZ1Rhc2tzLm1hcCh0ID0+IHQudHlwZSkpXSxcbiAgICAgIGRldGFpbHM6IHBlbmRpbmdUYXNrcy5tYXAodCA9PiAoe1xuICAgICAgICBpZDogdC5pZCxcbiAgICAgICAgdHlwZTogdC50eXBlLFxuICAgICAgICBkZXNjcmlwdGlvbjogdC5kZXNjcmlwdGlvbixcbiAgICAgICAgY29tcGxldGVkOiB0LmNvbXBsZXRlZFxuICAgICAgfSkpXG4gICAgfVxuICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBHRVQocmVxOiBOZXh0UmVxdWVzdCkge1xuICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oe1xuICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgbWVzc2FnZTogJ1NhcmEgTWVtb3J5IERlYnVnIEVuZHBvaW50JyxcbiAgICBhdmFpbGFibGVBY3Rpb25zOiBbXG4gICAgICAndGVzdF9wZXJzaXN0ZW50X21lbW9yeScsXG4gICAgICAndGVzdF9jYWxlbmRhcl9leGVjdXRpb24nLCBcbiAgICAgICd0ZXN0X2NvbnZlcnNhdGlvbl9jb2hlcmVuY2UnLFxuICAgICAgJ2Z1bGxfaW50ZWdyYXRpb25fdGVzdCcsXG4gICAgICAnbWVtb3J5X2luc3BlY3Rpb24nXG4gICAgXSxcbiAgICBpbnN0cnVjdGlvbnM6ICdTZW5kIGEgUE9TVCByZXF1ZXN0IHdpdGggYWN0aW9uLCB1c2VySWQgKG9wdGlvbmFsKSwgc2Vzc2lvbklkIChvcHRpb25hbCksIGFuZCBtZXNzYWdlIChmb3IgY2FsZW5kYXIgdGVzdHMpJ1xuICB9KVxufSJdLCJuYW1lcyI6WyJOZXh0UmVzcG9uc2UiLCJQT1NUIiwicmVxIiwiYWN0aW9uIiwidXNlcklkIiwibWVzc2FnZSIsInNlc3Npb25JZCIsInRlc3RUeXBlIiwianNvbiIsInJlc3VsdHMiLCJ0aW1lc3RhbXAiLCJEYXRlIiwiY29uc29sZSIsImxvZyIsInRlc3RQZXJzaXN0ZW50TWVtb3J5IiwidGVzdENhbGVuZGFyRXhlY3V0aW9uIiwidGVzdENvbnZlcnNhdGlvbkNvaGVyZW5jZSIsImZ1bGxJbnRlZ3JhdGlvblRlc3QiLCJpbnNwZWN0TWVtb3J5U3RhdGUiLCJzdWNjZXNzIiwiZXJyb3IiLCJzdGF0dXMiLCJFcnJvciIsImdldENvbnZlcnNhdGlvblNlc3Npb24iLCJjcmVhdGVDb252ZXJzYXRpb25TZXNzaW9uIiwiYWRkQ29udmVyc2F0aW9uVHVybiIsImFkZFBlbmRpbmdUYXNrIiwiZ2V0UGVuZGluZ1Rhc2tzIiwicmVxdWlyZSIsIkNvbnRleHR1YWxDb252ZXJzYXRpb25NYW5hZ2VyIiwibWVzc2FnZTEiLCJyZXNwb25zZTEiLCJwcm9jZXNzQ29udGV4dHVhbE1lc3NhZ2UiLCJzZXNzaW9uIiwidHVybnNBZnRlckZpcnN0IiwidHVybnMiLCJsZW5ndGgiLCJtZXNzYWdlMiIsInJlc3BvbnNlMiIsInR1cm5zQWZ0ZXJTZWNvbmQiLCJ0aXRsZSIsImRhdGUiLCJzdGFydFRpbWUiLCJwZW5kaW5nVGFza3MiLCJtZW1vcnlQZXJzaXN0ZW5jZSIsImZpcnN0UmVzcG9uc2UiLCJjb250ZW50Iiwic2Vjb25kUmVzcG9uc2UiLCJjb250aW51aXR5U2NvcmUiLCJtZW1vcnlXb3JraW5nIiwiY29udGV4dE1haW50YWluZWQiLCJ0b0xvd2VyQ2FzZSIsImluY2x1ZGVzIiwidGFza01hbmFnZW1lbnQiLCJ0YXNrQWRkZWQiLCJwZW5kaW5nVGFza3NDb3VudCIsImhhc0NhbGVuZGFyVGFzayIsInNvbWUiLCJ0IiwidHlwZSIsInRhc2tEZXRhaWxzIiwiY29udmVyc2F0aW9uRGF0YSIsInNlc3Npb25FeGlzdHMiLCJjdXJyZW50VG9waWMiLCJjdXJyZW50U3ViamVjdCIsImxhc3RVcGRhdGUiLCJ0ZXN0TWVzc2FnZSIsImNhbGVuZGFyTWVzc2FnZSIsInJlc3BvbnNlIiwid2FzQ2FsZW5kYXJUYXNrSGFuZGxlZCIsInBlcnNvbmFsaXphdGlvbnMiLCJoYXNDYWxlbmRhckNvbmZpcm1hdGlvbiIsInRhc2tFeGVjdXRpb24iLCJtZXNzYWdlUHJvY2Vzc2VkIiwiY2FsZW5kYXJUYXNrRGV0ZWN0ZWQiLCJyZXNwb25zZUxlbmd0aCIsInN1Z2dlc3RlZEFjdGlvbnMiLCJzdWdnZXN0ZWRGb2xsb3d1cHMiLCJyZXNwb25zZUFuYWx5c2lzIiwiY29udGFpbnNDYWxlbmRhcktleXdvcmRzIiwiY29udGFpbnNTdWNjZXNzSW5kaWNhdG9ycyIsIm1lbnRpb25zU3BlY2lmaWNEZXRhaWxzIiwiZnVsbFJlc3BvbnNlIiwic3Vic3RyaW5nIiwibWVzc2FnZXMiLCJyZXNwb25zZXMiLCJjb2hlcmVuY2VTY29yZXMiLCJpIiwicHVzaCIsIm1lc3NhZ2VJbmRleCIsImNvbnRleHRTdWJqZWN0IiwiY29udGV4dCIsImNvbnRleHRUb3BpYyIsIm1haW50YWluc1BoeXNpY3MiLCJQcm9taXNlIiwicmVzb2x2ZSIsInNldFRpbWVvdXQiLCJhdmVyYWdlQ29udGludWl0eVNjb3JlIiwicmVkdWNlIiwiYSIsImIiLCJjb252ZXJzYXRpb25GbG93IiwibWVzc2FnZXNQcm9jZXNzZWQiLCJhbGxSZXNwb25zZXNHZW5lcmF0ZWQiLCJldmVyeSIsInIiLCJzdWJqZWN0Q29uc2lzdGVuY3kiLCJkZXRhaWxlZFJlc3BvbnNlcyIsImNvaGVyZW5jZUFuYWx5c2lzIiwiZmlyc3RNZXNzYWdlQ29oZXJlbnQiLCJzZWNvbmRNZXNzYWdlQ29oZXJlbnQiLCJ0aGlyZE1lc3NhZ2VDb2hlcmVudCIsImltcHJvdmluZ0NvaGVyZW5jZSIsIm1lbW9yeVRlc3QiLCJjYWxlbmRhclRlc3QiLCJjb2hlcmVuY2VUZXN0Iiwib3ZlcmFsbFNjb3JlIiwiY29tcG9uZW50VGVzdHMiLCJtZW1vcnlTeXN0ZW0iLCJjYWxlbmRhckV4ZWN1dGlvbiIsImNhbGVuZGFyQ29uZmlybWF0aW9uIiwiY29udmVyc2F0aW9uQ29oZXJlbmNlIiwicmVjb21tZW5kYXRpb25zIiwiZmlsdGVyIiwiQm9vbGVhbiIsImdldFVzZXJBY3RpdmVTZXNzaW9ucyIsInRlbXBDb252ZXJzYXRpb25zIiwiYWN0aXZlU2Vzc2lvbnMiLCJzZXNzaW9uSW5zcGVjdGlvbiIsInR1cm5zQ291bnQiLCJ1c2VyU2Vzc2lvbnMiLCJhY3RpdmVTZXNzaW9uc0NvdW50Iiwic2Vzc2lvbklkcyIsIm1hcCIsInMiLCJ0b3RhbFR1cm5zQWNyb3NzU2Vzc2lvbnMiLCJzdW0iLCJnbG9iYWxTdGF0ZSIsInRvdGFsQ29udmVyc2F0aW9ucyIsInVuaXF1ZVVzZXJzIiwiU2V0IiwiYyIsImNvdW50IiwidHlwZXMiLCJkZXRhaWxzIiwiaWQiLCJkZXNjcmlwdGlvbiIsImNvbXBsZXRlZCIsIkdFVCIsImF2YWlsYWJsZUFjdGlvbnMiLCJpbnN0cnVjdGlvbnMiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./src/app/api/debug-sara-memory/route.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/advanced-learning-profiles.ts":
/*!***********************************************!*\
  !*** ./src/lib/advanced-learning-profiles.ts ***!
  \***********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   AdvancedLearningProfileManager: () => (/* binding */ AdvancedLearningProfileManager),\n/* harmony export */   LearningStyle: () => (/* binding */ LearningStyle)\n/* harmony export */ });\n// Advanced Learning Profiles System for Sara AI\n// Implements VARK model (Visual, Auditory, Reading/Writing, Kinesthetic) with automatic detection\nvar LearningStyle = /*#__PURE__*/ function(LearningStyle) {\n    LearningStyle[\"VISUAL\"] = \"visual\";\n    LearningStyle[\"AUDITORY\"] = \"auditory\";\n    LearningStyle[\"READING_WRITING\"] = \"reading_writing\";\n    LearningStyle[\"KINESTHETIC\"] = \"kinesthetic\";\n    LearningStyle[\"MULTIMODAL\"] = \"multimodal\";\n    return LearningStyle;\n}({});\nclass AdvancedLearningProfileManager {\n    static{\n        // Storage for learning profiles\n        this.profiles = new Map();\n    }\n    static{\n        this.behaviors = [];\n    }\n    /**\n   * Analyzes user message for learning style indicators\n   */ static analyzeMessageForLearningStyle(message, userId) {\n        const msgLower = message.toLowerCase();\n        const indicators = [];\n        // VISUAL indicators\n        const visualKeywords = [\n            'ver',\n            'mirar',\n            'mostrar',\n            'imagen',\n            'gr√°fico',\n            'diagrama',\n            'visual',\n            'color',\n            'mapa',\n            'esquema',\n            'dibujo',\n            'ilustraci√≥n',\n            'tabla',\n            'gr√°fica',\n            'visualizar',\n            'observar',\n            'demostrar',\n            'ejemplo visual',\n            'claramente'\n        ];\n        const visualPhrases = [\n            'me gusta ver',\n            'mu√©strame',\n            'qu√© aspecto tiene',\n            'c√≥mo se ve',\n            'necesito ver',\n            'puedes mostrar',\n            'ejemplo visual',\n            'de forma gr√°fica'\n        ];\n        let visualScore = this.calculateKeywordScore(msgLower, visualKeywords, visualPhrases);\n        if (visualScore > 0) {\n            indicators.push({\n                style: \"visual\",\n                weight: visualScore,\n                evidence: this.extractEvidence(msgLower, [\n                    ...visualKeywords,\n                    ...visualPhrases\n                ]),\n                confidence: Math.min(visualScore * 1.2, 1.0)\n            });\n        }\n        // AUDITORY indicators\n        const auditoryKeywords = [\n            'escuchar',\n            'o√≠r',\n            'sonido',\n            'explicar',\n            'decir',\n            'contar',\n            'discutir',\n            'hablar',\n            'verbal',\n            'audio',\n            'pronunciar',\n            'repetir',\n            'preguntar'\n        ];\n        const auditoryPhrases = [\n            'expl√≠came',\n            'cu√©ntame',\n            'me puedes decir',\n            'necesito que me expliques',\n            'rep√≠telo',\n            'en palabras',\n            'de forma verbal',\n            'hablemos de'\n        ];\n        let auditoryScore = this.calculateKeywordScore(msgLower, auditoryKeywords, auditoryPhrases);\n        if (auditoryScore > 0) {\n            indicators.push({\n                style: \"auditory\",\n                weight: auditoryScore,\n                evidence: this.extractEvidence(msgLower, [\n                    ...auditoryKeywords,\n                    ...auditoryPhrases\n                ]),\n                confidence: Math.min(auditoryScore * 1.1, 1.0)\n            });\n        }\n        // READING/WRITING indicators\n        const readWriteKeywords = [\n            'leer',\n            'escribir',\n            'texto',\n            'nota',\n            'lista',\n            'definici√≥n',\n            'resumen',\n            'apuntes',\n            'documento',\n            'art√≠culo',\n            'p√°rrafo',\n            'descripci√≥n',\n            'detalles'\n        ];\n        const readWritePhrases = [\n            'en texto',\n            'por escrito',\n            'dame detalles',\n            'necesito leer',\n            'quiero estudiar',\n            'informaci√≥n detallada',\n            'paso a paso',\n            'lista de'\n        ];\n        let readWriteScore = this.calculateKeywordScore(msgLower, readWriteKeywords, readWritePhrases);\n        if (readWriteScore > 0) {\n            indicators.push({\n                style: \"reading_writing\",\n                weight: readWriteScore,\n                evidence: this.extractEvidence(msgLower, [\n                    ...readWriteKeywords,\n                    ...readWritePhrases\n                ]),\n                confidence: Math.min(readWriteScore, 1.0)\n            });\n        }\n        // KINESTHETIC indicators\n        const kinestheticKeywords = [\n            'hacer',\n            'practicar',\n            'ejercicio',\n            'actividad',\n            'mano',\n            'tocar',\n            'mover',\n            'experimentar',\n            'probar',\n            'manipular',\n            'construir',\n            'crear',\n            'interactivo'\n        ];\n        const kinestheticPhrases = [\n            'quiero hacer',\n            'necesito practicar',\n            'hands on',\n            'de forma pr√°ctica',\n            'experimentando',\n            'probando',\n            'haciendo ejercicios',\n            'actividades'\n        ];\n        let kinestheticScore = this.calculateKeywordScore(msgLower, kinestheticKeywords, kinestheticPhrases);\n        if (kinestheticScore > 0) {\n            indicators.push({\n                style: \"kinesthetic\",\n                weight: kinestheticScore,\n                evidence: this.extractEvidence(msgLower, [\n                    ...kinestheticKeywords,\n                    ...kinestheticPhrases\n                ]),\n                confidence: Math.min(kinestheticScore * 1.3, 1.0)\n            });\n        }\n        // Record behavior pattern\n        if (indicators.length > 0) {\n            this.recordBehaviorPattern(userId, 'message_analysis', message, indicators.map((i)=>i.style));\n        }\n        return indicators.sort((a, b)=>b.weight - a.weight);\n    }\n    /**\n   * Calculates score based on keyword and phrase matches\n   */ static calculateKeywordScore(text, keywords, phrases) {\n        let score = 0;\n        // Keyword matches (lower weight)\n        for (const keyword of keywords){\n            if (text.includes(keyword)) {\n                score += 0.1;\n            }\n        }\n        // Phrase matches (higher weight)\n        for (const phrase of phrases){\n            if (text.includes(phrase)) {\n                score += 0.3;\n            }\n        }\n        return Math.min(score, 1.0);\n    }\n    /**\n   * Extracts evidence from text\n   */ static extractEvidence(text, patterns) {\n        const evidence = [];\n        for (const pattern of patterns){\n            if (text.includes(pattern)) {\n                // Extract sentence containing the pattern\n                const sentences = text.split(/[.!?]+/);\n                const matchingSentence = sentences.find((sentence)=>sentence.toLowerCase().includes(pattern));\n                if (matchingSentence) {\n                    evidence.push(matchingSentence.trim());\n                }\n            }\n        }\n        return evidence.slice(0, 3) // Limit to 3 pieces of evidence\n        ;\n    }\n    /**\n   * Records a learning behavior pattern\n   */ static recordBehaviorPattern(userId, action, context, styleIndicators) {\n        this.behaviors.push({\n            userId,\n            timestamp: new Date(),\n            action,\n            context,\n            styleIndicators\n        });\n        // Keep only recent behaviors (last 100 per user)\n        const userBehaviors = this.behaviors.filter((b)=>b.userId === userId);\n        if (userBehaviors.length > 100) {\n            this.behaviors = this.behaviors.filter((b)=>b.userId !== userId).concat(userBehaviors.slice(-100));\n        }\n    }\n    /**\n   * Updates or creates learning profile for user\n   */ static updateLearningProfile(userId, indicators, context) {\n        let profile = this.profiles.get(userId) || this.createInitialProfile(userId);\n        // Update style distribution based on new indicators\n        for (const indicator of indicators){\n            const weight = indicator.weight * indicator.confidence;\n            switch(indicator.style){\n                case \"visual\":\n                    profile.styleDistribution.visual = Math.min(profile.styleDistribution.visual + weight * 0.1, 1.0);\n                    break;\n                case \"auditory\":\n                    profile.styleDistribution.auditory = Math.min(profile.styleDistribution.auditory + weight * 0.1, 1.0);\n                    break;\n                case \"reading_writing\":\n                    profile.styleDistribution.reading_writing = Math.min(profile.styleDistribution.reading_writing + weight * 0.1, 1.0);\n                    break;\n                case \"kinesthetic\":\n                    profile.styleDistribution.kinesthetic = Math.min(profile.styleDistribution.kinesthetic + weight * 0.1, 1.0);\n                    break;\n            }\n        }\n        // Normalize distribution\n        const total = profile.styleDistribution.visual + profile.styleDistribution.auditory + profile.styleDistribution.reading_writing + profile.styleDistribution.kinesthetic;\n        if (total > 0) {\n            profile.styleDistribution.visual /= total;\n            profile.styleDistribution.auditory /= total;\n            profile.styleDistribution.reading_writing /= total;\n            profile.styleDistribution.kinesthetic /= total;\n        }\n        // Determine primary and secondary styles\n        const styles = [\n            {\n                style: \"visual\",\n                score: profile.styleDistribution.visual\n            },\n            {\n                style: \"auditory\",\n                score: profile.styleDistribution.auditory\n            },\n            {\n                style: \"reading_writing\",\n                score: profile.styleDistribution.reading_writing\n            },\n            {\n                style: \"kinesthetic\",\n                score: profile.styleDistribution.kinesthetic\n            }\n        ].sort((a, b)=>b.score - a.score);\n        profile.primaryStyle = styles[0].score > 0.35 ? styles[0].style : \"multimodal\";\n        profile.secondaryStyle = styles[1].score > 0.25 ? styles[1].style : undefined;\n        // Update adaptation preferences\n        profile.adaptationPreferences = {\n            prefersDiagrams: profile.styleDistribution.visual > 0.3,\n            prefersStepByStep: profile.styleDistribution.reading_writing > 0.3,\n            prefersExamples: profile.styleDistribution.visual > 0.25 || profile.styleDistribution.kinesthetic > 0.25,\n            prefersInteraction: profile.styleDistribution.kinesthetic > 0.3,\n            prefersVisualAids: profile.styleDistribution.visual > 0.25,\n            prefersVerbalExplanation: profile.styleDistribution.auditory > 0.3\n        };\n        profile.lastUpdated = new Date();\n        profile.interactions++;\n        this.profiles.set(userId, profile);\n        console.log(`üìä Learning profile updated for ${userId}: Primary=${profile.primaryStyle}, Secondary=${profile.secondaryStyle || 'none'}`);\n        return profile;\n    }\n    /**\n   * Creates initial learning profile\n   */ static createInitialProfile(userId) {\n        return {\n            userId,\n            primaryStyle: \"multimodal\",\n            secondaryStyle: undefined,\n            styleDistribution: {\n                visual: 0.25,\n                auditory: 0.25,\n                reading_writing: 0.25,\n                kinesthetic: 0.25\n            },\n            adaptationPreferences: {\n                prefersDiagrams: false,\n                prefersStepByStep: true,\n                prefersExamples: true,\n                prefersInteraction: false,\n                prefersVisualAids: false,\n                prefersVerbalExplanation: false\n            },\n            detectedFrom: {\n                messageAnalysis: 0,\n                behaviorPatterns: 0,\n                explicitPreferences: 0\n            },\n            lastUpdated: new Date(),\n            interactions: 0\n        };\n    }\n    /**\n   * Gets learning profile for user\n   */ static getLearningProfile(userId) {\n        return this.profiles.get(userId) || this.createInitialProfile(userId);\n    }\n    /**\n   * Adapts response content based on learning profile\n   */ static adaptResponseToLearningStyle(content, profile) {\n        let adaptedContent = content;\n        // Visual learner adaptations\n        if (profile.adaptationPreferences.prefersVisualAids) {\n            adaptedContent = this.addVisualElements(adaptedContent, profile);\n        }\n        // Auditory learner adaptations\n        if (profile.adaptationPreferences.prefersVerbalExplanation) {\n            adaptedContent = this.addAuditoryElements(adaptedContent, profile);\n        }\n        // Reading/Writing learner adaptations\n        if (profile.adaptationPreferences.prefersStepByStep) {\n            adaptedContent = this.addStructuredElements(adaptedContent, profile);\n        }\n        // Kinesthetic learner adaptations\n        if (profile.adaptationPreferences.prefersInteraction) {\n            adaptedContent = this.addInteractiveElements(adaptedContent, profile);\n        }\n        return adaptedContent;\n    }\n    /**\n   * Adds visual elements for visual learners\n   */ static addVisualElements(content, profile) {\n        let enhanced = content;\n        // Add visual cues and formatting\n        enhanced = enhanced.replace(/importante:/gi, 'üîç **IMPORTANTE:**');\n        enhanced = enhanced.replace(/nota:/gi, 'üìù **NOTA:**');\n        enhanced = enhanced.replace(/ejemplo:/gi, 'üí° **EJEMPLO:**');\n        enhanced = enhanced.replace(/resultado:/gi, '‚úÖ **RESULTADO:**');\n        // Add visual separators\n        if (enhanced.includes('paso') || enhanced.includes('step')) {\n            enhanced = enhanced.replace(/paso (\\d+)/gi, '\\nüìç **PASO $1**\\n');\n        }\n        return enhanced;\n    }\n    /**\n   * Adds auditory elements for auditory learners  \n   */ static addAuditoryElements(content, profile) {\n        let enhanced = content;\n        // Add conversational phrases\n        enhanced = \"üó£Ô∏è Te voy a explicar esto paso a paso:\\n\\n\" + enhanced;\n        // Add verbal transition phrases\n        enhanced = enhanced.replace(/\\. ([A-Z])/g, '. Ahora, $1');\n        enhanced = enhanced.replace(/:\\n/g, '. Escucha bien:\\n');\n        return enhanced;\n    }\n    /**\n   * Adds structured elements for reading/writing learners\n   */ static addStructuredElements(content, profile) {\n        let enhanced = content;\n        // Add clear structure and bullet points\n        if (!enhanced.includes('**') && enhanced.length > 200) {\n            const sentences = enhanced.split('.');\n            if (sentences.length > 3) {\n                enhanced = sentences.filter((s)=>s.trim().length > 10).map((sentence, index)=>`${index + 1}. ${sentence.trim()}`).join('\\n');\n            }\n        }\n        return enhanced;\n    }\n    /**\n   * Adds interactive elements for kinesthetic learners\n   */ static addInteractiveElements(content, profile) {\n        let enhanced = content;\n        // Add action-oriented language\n        enhanced += \"\\n\\nüéØ **Prueba esto:**\";\n        enhanced += \"\\n‚Ä¢ Aplica este concepto a un problema real\";\n        enhanced += \"\\n‚Ä¢ Experimenta cambiando los valores\";\n        enhanced += \"\\n‚Ä¢ Practica con ejercicios similares\";\n        return enhanced;\n    }\n    /**\n   * Analyzes behavior patterns to enhance profile\n   */ static analyzeBehaviorPatterns(userId) {\n        const userBehaviors = this.behaviors.filter((b)=>b.userId === userId);\n        const profile = this.getLearningProfile(userId);\n        if (userBehaviors.length < 5) return profile;\n        // Analyze patterns in recent behaviors\n        const recentBehaviors = userBehaviors.slice(-20);\n        const styleFrequency = new Map();\n        for (const behavior of recentBehaviors){\n            for (const style of behavior.styleIndicators){\n                styleFrequency.set(style, (styleFrequency.get(style) || 0) + 1);\n            }\n        }\n        // Update profile based on behavioral patterns\n        const indicators = [];\n        for (const [style, frequency] of styleFrequency.entries()){\n            const weight = frequency / recentBehaviors.length;\n            if (weight > 0.1) {\n                indicators.push({\n                    style,\n                    weight,\n                    evidence: [\n                        `Detectado en ${frequency} de ${recentBehaviors.length} interacciones recientes`\n                    ],\n                    confidence: Math.min(weight * 2, 1.0)\n                });\n            }\n        }\n        return this.updateLearningProfile(userId, indicators, 'behavior_analysis');\n    }\n    /**\n   * Gets profile statistics\n   */ static getProfileStatistics(userId) {\n        if (userId) {\n            const profile = this.profiles.get(userId);\n            const behaviors = this.behaviors.filter((b)=>b.userId === userId);\n            return {\n                profile: profile || null,\n                behaviorCount: behaviors.length,\n                recentInteractions: behaviors.filter((b)=>b.timestamp > new Date(Date.now() - 7 * 24 * 60 * 60 * 1000)).length\n            };\n        }\n        return {\n            totalProfiles: this.profiles.size,\n            totalBehaviors: this.behaviors.length,\n            styleDistribution: this.getGlobalStyleDistribution()\n        };\n    }\n    /**\n   * Gets global style distribution\n   */ static getGlobalStyleDistribution() {\n        const distribution = {\n            visual: 0,\n            auditory: 0,\n            reading_writing: 0,\n            kinesthetic: 0,\n            multimodal: 0\n        };\n        for (const profile of this.profiles.values()){\n            switch(profile.primaryStyle){\n                case \"visual\":\n                    distribution.visual++;\n                    break;\n                case \"auditory\":\n                    distribution.auditory++;\n                    break;\n                case \"reading_writing\":\n                    distribution.reading_writing++;\n                    break;\n                case \"kinesthetic\":\n                    distribution.kinesthetic++;\n                    break;\n                case \"multimodal\":\n                    distribution.multimodal++;\n                    break;\n            }\n        }\n        return distribution;\n    }\n    /**\n   * Process user message and update learning profile\n   */ static processUserMessage(userId, message) {\n        // Analyze message for learning style indicators\n        const indicators = this.analyzeMessageForLearningStyle(message, userId);\n        // Update learning profile if indicators found\n        if (indicators.length > 0) {\n            return this.updateLearningProfile(userId, indicators, 'message_processing');\n        }\n        // Analyze behavior patterns periodically\n        const profile = this.getLearningProfile(userId);\n        if (profile.interactions % 10 === 0) {\n            return this.analyzeBehaviorPatterns(userId);\n        }\n        return profile;\n    }\n    /**\n   * Generates learning style recommendations for Sara\n   */ static generateStyleRecommendations(profile) {\n        const recommendations = [];\n        switch(profile.primaryStyle){\n            case \"visual\":\n                recommendations.push(\"Usar diagramas y esquemas cuando explico conceptos\");\n                recommendations.push(\"Incluir ejemplos visuales y gr√°ficos\");\n                recommendations.push(\"Estructurar informaci√≥n con vi√±etas y colores\");\n                break;\n            case \"auditory\":\n                recommendations.push(\"Explicar conceptos con lenguaje conversacional\");\n                recommendations.push(\"Usar analog√≠as y met√°foras verbales\");\n                recommendations.push(\"Incluir discusiones y preguntas abiertas\");\n                break;\n            case \"reading_writing\":\n                recommendations.push(\"Proporcionar informaci√≥n detallada por escrito\");\n                recommendations.push(\"Crear listas y res√∫menes estructurados\");\n                recommendations.push(\"Incluir definiciones y descripciones precisas\");\n                break;\n            case \"kinesthetic\":\n                recommendations.push(\"Incluir ejercicios pr√°cticos y actividades\");\n                recommendations.push(\"Sugerir experimentos y aplicaciones reales\");\n                recommendations.push(\"Usar ejemplos concretos y manipulables\");\n                break;\n            case \"multimodal\":\n                recommendations.push(\"Combinar m√∫ltiples enfoques de ense√±anza\");\n                recommendations.push(\"Adaptar explicaciones seg√∫n el contexto\");\n                recommendations.push(\"Ofrecer opciones de aprendizaje variadas\");\n                break;\n        }\n        return recommendations;\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvbGliL2FkdmFuY2VkLWxlYXJuaW5nLXByb2ZpbGVzLnRzIiwibWFwcGluZ3MiOiI7Ozs7O0FBQUEsZ0RBQWdEO0FBQ2hELGtHQUFrRztBQUUzRiwyQ0FBS0E7Ozs7OztXQUFBQTtNQU1YO0FBNENNLE1BQU1DOztRQUVYLGdDQUFnQzthQUNqQkMsV0FBeUMsSUFBSUM7OzthQUM3Q0MsWUFBdUMsRUFBRTs7SUFFeEQ7O0dBRUMsR0FDRCxPQUFPQywrQkFBK0JDLE9BQWUsRUFBRUMsTUFBYyxFQUE0QjtRQUMvRixNQUFNQyxXQUFXRixRQUFRRyxXQUFXO1FBQ3BDLE1BQU1DLGFBQXVDLEVBQUU7UUFFL0Msb0JBQW9CO1FBQ3BCLE1BQU1DLGlCQUFpQjtZQUNyQjtZQUFPO1lBQVM7WUFBVztZQUFVO1lBQVc7WUFBWTtZQUFVO1lBQ3RFO1lBQVE7WUFBVztZQUFVO1lBQWU7WUFBUztZQUFXO1lBQ2hFO1lBQVk7WUFBYTtZQUFrQjtTQUM1QztRQUVELE1BQU1DLGdCQUFnQjtZQUNwQjtZQUFnQjtZQUFhO1lBQXFCO1lBQ2xEO1lBQWdCO1lBQWtCO1lBQWtCO1NBQ3JEO1FBRUQsSUFBSUMsY0FBYyxJQUFJLENBQUNDLHFCQUFxQixDQUFDTixVQUFVRyxnQkFBZ0JDO1FBQ3ZFLElBQUlDLGNBQWMsR0FBRztZQUNuQkgsV0FBV0ssSUFBSSxDQUFDO2dCQUNkQyxLQUFLO2dCQUNMQyxRQUFRSjtnQkFDUkssVUFBVSxJQUFJLENBQUNDLGVBQWUsQ0FBQ1gsVUFBVTt1QkFBSUc7dUJBQW1CQztpQkFBYztnQkFDOUVRLFlBQVlDLEtBQUtDLEdBQUcsQ0FBQ1QsY0FBYyxLQUFLO1lBQzFDO1FBQ0Y7UUFFQSxzQkFBc0I7UUFDdEIsTUFBTVUsbUJBQW1CO1lBQ3ZCO1lBQVk7WUFBTztZQUFVO1lBQVk7WUFBUztZQUFVO1lBQzVEO1lBQVU7WUFBVTtZQUFTO1lBQWM7WUFBVztTQUN2RDtRQUVELE1BQU1DLGtCQUFrQjtZQUN0QjtZQUFhO1lBQVk7WUFBbUI7WUFD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UUFBUVcsWUFBWTtZQUMxQjtnQkFDRW1ELGdCQUFnQi9HLElBQUksQ0FBQztnQkFDckIrRyxnQkFBZ0IvRyxJQUFJLENBQUM7Z0JBQ3JCK0csZ0JBQWdCL0csSUFBSSxDQUFDO2dCQUNyQjtZQUVGO2dCQUNFK0csZ0JBQWdCL0csSUFBSSxDQUFDO2dCQUNyQitHLGdCQUFnQi9HLElBQUksQ0FBQztnQkFDckIrRyxnQkFBZ0IvRyxJQUFJLENBQUM7Z0JBQ3JCO1lBRUY7Z0JBQ0UrRyxnQkFBZ0IvRyxJQUFJLENBQUM7Z0JBQ3JCK0csZ0JBQWdCL0csSUFBSSxDQUFDO2dCQUNyQitHLGdCQUFnQi9HLElBQUksQ0FBQztnQkFDckI7WUFFRjtnQkFDRStHLGdCQUFnQi9HLElBQUksQ0FBQztnQkFDckIrRyxnQkFBZ0IvRyxJQUFJLENBQUM7Z0JBQ3JCK0csZ0JBQWdCL0csSUFBSSxDQUFDO2dCQUNyQjtZQUVGO2dCQUNFK0csZ0JBQWdCL0csSUFBSSxDQUFDO2dCQUNyQitHLGdCQUFnQi9HLElBQUksQ0FBQztnQkFDckIrRyxnQkFBZ0IvRyxJQUFJLENBQUM7Z0JBQ3JCO1FBQ0o7UUFFQSxPQUFPK0c7SUFDVDtBQUNGIiwic291cmNlcyI6WyIvVXNlcnMvcm9kcmlnb2RpYmVybmFyZG8zM2dtYWlsLmNvbS9Eb2N1bWVudHMvQXBwIERldmVsb3BtZW50IFByb3llY3RzL0ludGVsbGVnbyBQbGF0Zm9ybS9zcmMvbGliL2FkdmFuY2VkLWxlYXJuaW5nLXByb2ZpbGVzLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIEFkdmFuY2VkIExlYXJuaW5nIFByb2ZpbGVzIFN5c3RlbSBmb3IgU2FyYSBBSVxuLy8gSW1wbGVtZW50cyBWQVJLIG1vZGVsIChWaXN1YWwsIEF1ZGl0b3J5LCBSZWFkaW5nL1dyaXRpbmcsIEtpbmVzdGhldGljKSB3aXRoIGF1dG9tYXRpYyBkZXRlY3Rpb25cblxuZXhwb3J0IGVudW0gTGVhcm5pbmdTdHlsZSB7XG4gIFZJU1VBTCA9ICd2aXN1YWwnLFxuICBBVURJVE9SWSA9ICdhdWRpdG9yeScsXG4gIFJFQURJTkdfV1JJVElORyA9ICdyZWFkaW5nX3dyaXRpbmcnLCBcbiAgS0lORVNUSEVUSUMgPSAna2luZXN0aGV0aWMnLFxuICBNVUxUSU1PREFMID0gJ211bHRpbW9kYWwnXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgTGVhcm5pbmdTdHlsZUluZGljYXRvciB7XG4gIHN0eWxlOiBMZWFybmluZ1N0eWxlXG4gIHdlaWdodDogbnVtYmVyIC8vIDAuMCB0byAxLjBcbiAgZXZpZGVuY2U6IHN0cmluZ1tdXG4gIGNvbmZpZGVuY2U6IG51bWJlciAvLyAwLjAgdG8gMS4wXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgTGVhcm5pbmdQcm9maWxlIHtcbiAgdXNlcklkOiBzdHJpbmdcbiAgcHJpbWFyeVN0eWxlOiBMZWFybmluZ1N0eWxlXG4gIHNlY29uZGFyeVN0eWxlPzogTGVhcm5pbmdTdHlsZVxuICBzdHlsZURpc3RyaWJ1dGlvbjoge1xuICAgIHZpc3VhbDogbnVtYmVyXG4gICAgYXVkaXRvcnk6IG51bWJlclxuICAgIHJlYWRpbmdfd3JpdGluZzogbnVtYmVyXG4gICAga2luZXN0aGV0aWM6IG51bWJlclxuICB9XG4gIGFkYXB0YXRpb25QcmVmZXJlbmNlczoge1xuICAgIHByZWZlcnNEaWFncmFtczogYm9vbGVhblxuICAgIHByZWZlcnNTdGVwQnlTdGVwOiBib29sZWFuXG4gICAgcHJlZmVyc0V4YW1wbGVzOiBib29sZWFuXG4gICAgcHJlZmVyc0ludGVyYWN0aW9uOiBib29sZWFuXG4gICAgcHJlZmVyc1Zpc3VhbEFpZHM6IGJvb2xlYW5cbiAgICBwcmVmZXJzVmVyYmFsRXhwbGFuYXRpb246IGJvb2xlYW5cbiAgfVxuICBkZXRlY3RlZEZyb206IHtcbiAgICBtZXNzYWdlQW5hbHlzaXM6IG51bWJlclxuICAgIGJlaGF2aW9yUGF0dGVybnM6IG51bWJlclxuICAgIGV4cGxpY2l0UHJlZmVyZW5jZXM6IG51bWJlclxuICB9XG4gIGxhc3RVcGRhdGVkOiBEYXRlXG4gIGludGVyYWN0aW9uczogbnVtYmVyXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgTGVhcm5pbmdCZWhhdmlvclBhdHRlcm4ge1xuICB1c2VySWQ6IHN0cmluZ1xuICB0aW1lc3RhbXA6IERhdGVcbiAgYWN0aW9uOiBzdHJpbmdcbiAgY29udGV4dDogc3RyaW5nXG4gIHN0eWxlSW5kaWNhdG9yczogTGVhcm5pbmdTdHlsZVtdXG59XG5cbmV4cG9ydCBjbGFzcyBBZHZhbmNlZExlYXJuaW5nUHJvZmlsZU1hbmFnZXIge1xuICBcbiAgLy8gU3RvcmFnZSBmb3IgbGVhcm5pbmcgcHJvZmlsZXNcbiAgcHJpdmF0ZSBzdGF0aWMgcHJvZmlsZXM6IE1hcDxzdHJpbmcsIExlYXJuaW5nUHJvZmlsZT4gPSBuZXcgTWFwKClcbiAgcHJpdmF0ZSBzdGF0aWMgYmVoYXZpb3JzOiBMZWFybmluZ0JlaGF2aW9yUGF0dGVybltdID0gW11cblxuICAvKipcbiAgICogQW5hbHl6ZXMgdXNlciBtZXNzYWdlIGZvciBsZWFybmluZyBzdHlsZSBpbmRpY2F0b3JzXG4gICAqL1xuICBzdGF0aWMgYW5hbHl6ZU1lc3NhZ2VGb3JMZWFybmluZ1N0eWxlKG1lc3NhZ2U6IHN0cmluZywgdXNlcklkOiBzdHJpbmcpOiBMZWFybmluZ1N0eWxlSW5kaWNhdG9yW10ge1xuICAgIGNvbnN0IG1zZ0xvd2VyID0gbWVzc2FnZS50b0xvd2VyQ2FzZSgpXG4gICAgY29uc3QgaW5kaWNhdG9yczogTGVhcm5pbmdTdHlsZUluZGljYXRvcltdID0gW11cblxuICAgIC8vIFZJU1VBTCBpbmRpY2F0b3JzXG4gICAgY29uc3QgdmlzdWFsS2V5d29yZHMgPSBbXG4gICAgICAndmVyJywgJ21pcmFyJywgJ21vc3RyYXInLCAnaW1hZ2VuJywgJ2dyw6FmaWNvJywgJ2RpYWdyYW1hJywgJ3Zpc3VhbCcsICdjb2xvcicsXG4gICAgICAnbWFwYScsICdlc3F1ZW1hJywgJ2RpYnVqbycsICdpbHVzdHJhY2nDs24nLCAndGFibGEnLCAnZ3LDoWZpY2EnLCAndmlzdWFsaXphcicsXG4gICAgICAnb2JzZXJ2YXInLCAnZGVtb3N0cmFyJywgJ2VqZW1wbG8gdmlzdWFsJywgJ2NsYXJhbWVudGUnXG4gICAgXVxuICAgIFxuICAgIGNvbnN0IHZpc3VhbFBocmFzZXMgPSBbXG4gICAgICAnbWUgZ3VzdGEgdmVyJywgJ211w6lzdHJhbWUnLCAncXXDqSBhc3BlY3RvIHRpZW5lJywgJ2PDs21vIHNlIHZlJyxcbiAgICAgICduZWNlc2l0byB2ZXInLCAncHVlZGVzIG1vc3RyYXInLCAnZWplbXBsbyB2aXN1YWwnLCAnZGUgZm9ybWEgZ3LDoWZpY2EnXG4gICAgXVxuICAgIFxuICAgIGxldCB2aXN1YWxTY29yZSA9IHRoaXMuY2FsY3VsYXRlS2V5d29yZFNjb3JlKG1zZ0xvd2VyLCB2aXN1YWxLZXl3b3JkcywgdmlzdWFsUGhyYXNlcylcbiAgICBpZiAodmlzdWFsU2NvcmUgPiAwKSB7XG4gICAgICBpbmRpY2F0b3JzLnB1c2goe1xuICAgICAgICBzdHlsZTogTGVhcm5pbmdTdHlsZS5WSVNVQUwsXG4gICAgICAgIHdlaWdodDogdmlzdWFsU2NvcmUsXG4gICAgICAgIGV2aWRlbmNlOiB0aGlzLmV4dHJhY3RFdmlkZW5jZShtc2dMb3dlciwgWy4uLnZpc3VhbEtleXdvcmRzLCAuLi52aXN1YWxQaHJhc2VzXSksXG4gICAgICAgIGNvbmZpZGVuY2U6IE1hdGgubWluKHZpc3VhbFNjb3JlICogMS4yLCAxLjApXG4gICAgICB9KVxuICAgIH1cblxuICAgIC8vIEFVRElUT1JZIGluZGljYXRvcnNcbiAgICBjb25zdCBhdWRpdG9yeUtleXdvcmRzID0gW1xuICAgICAgJ2VzY3VjaGFyJywgJ2/DrXInLCAnc29uaWRvJywgJ2V4cGxpY2FyJywgJ2RlY2lyJywgJ2NvbnRhcicsICdkaXNjdXRpcicsXG4gICAgICAnaGFibGFyJywgJ3ZlcmJhbCcsICdhdWRpbycsICdwcm9udW5jaWFyJywgJ3JlcGV0aXInLCAncHJlZ3VudGFyJ1xuICAgIF1cbiAgICBcbiAgICBjb25zdCBhdWRpdG9yeVBocmFzZXMgPSBbXG4gICAgICAnZXhwbMOtY2FtZScsICdjdcOpbnRhbWUnLCAnbWUgcHVlZGVzIGRlY2lyJywgJ25lY2VzaXRvIHF1ZSBtZSBleHBsaXF1ZXMnLFxuICAgICAgJ3JlcMOtdGVsbycsICdlbiBwYWxhYnJhcycsICdkZSBmb3JtYSB2ZXJiYWwnLCAnaGFibGVtb3MgZGUnXG4gICAgXVxuICAgIFxuICAgIGxldCBhdWRpdG9yeVNjb3JlID0gdGhpcy5jYWxjdWxhdGVLZXl3b3JkU2NvcmUobXNnTG93ZXIsIGF1ZGl0b3J5S2V5d29yZHMsIGF1ZGl0b3J5UGhyYXNlcylcbiAgICBpZiAoYXVkaXRvcnlTY29yZSA+IDApIHtcbiAgICAgIGluZGljYXRvcnMucHVzaCh7XG4gICAgICAgIHN0eWxlOiBMZWFybmluZ1N0eWxlLkFVRElUT1JZLFxuICAgICAgICB3ZWlnaHQ6IGF1ZGl0b3J5U2NvcmUsXG4gICAgICAgIGV2aWRlbmNlOiB0aGlzLmV4dHJhY3RFdmlkZW5jZShtc2dMb3dlciwgWy4uLmF1ZGl0b3J5S2V5d29yZHMsIC4uLmF1ZGl0b3J5UGhyYXNlc10pLFxuICAgICAgICBjb25maWRlbmNlOiBNYXRoLm1pbihhdWRpdG9yeVNjb3JlICogMS4xLCAxLjApXG4gICAgICB9KVxuICAgIH1cblxuICAgIC8vIFJFQURJTkcvV1JJVElORyBpbmRpY2F0b3JzXG4gICAgY29uc3QgcmVhZFdyaXRlS2V5d29yZHMgPSBbXG4gICAgICAnbGVlcicsICdlc2NyaWJpcicsICd0ZXh0bycsICdub3RhJywgJ2xpc3RhJywgJ2RlZmluaWNpw7NuJywgJ3Jlc3VtZW4nLFxuICAgICAgJ2FwdW50ZXMnLCAnZG9jdW1lbnRvJywgJ2FydMOtY3VsbycsICdww6FycmFmbycsICdkZXNjcmlwY2nDs24nLCAnZGV0YWxsZXMnXG4gICAgXVxuICAgIFxuICAgIGNvbnN0IHJlYWRXcml0ZVBocmFzZXMgPSBbXG4gICAgICAnZW4gdGV4dG8nLCAncG9yIGVzY3JpdG8nLCAnZGFtZSBkZXRhbGxlcycsICduZWNlc2l0byBsZWVyJyxcbiAgICAgICdxdWllcm8gZXN0dWRpYXInLCAnaW5mb3JtYWNpw7NuIGRldGFsbGFkYScsICdwYXNvIGEgcGFzbycsICdsaXN0YSBkZSdcbiAgICBdXG4gICAgXG4gICAgbGV0IHJlYWRXcml0ZVNjb3JlID0gdGhpcy5jYWxjdWxhdGVLZXl3b3JkU2NvcmUobXNnTG93ZXIsIHJlYWRXcml0ZUtleXdvcmRzLCByZWFkV3JpdGVQaHJhc2VzKVxuICAgIGlmIChyZWFkV3JpdGVTY29yZSA+IDApIHtcbiAgICAgIGluZGljYXRvcnMucHVzaCh7XG4gICAgICAgIHN0eWxlOiBMZWFybmluZ1N0eWxlLlJFQURJTkdfV1JJVElORyxcbiAgICAgICAgd2VpZ2h0OiByZWFkV3JpdGVTY29yZSxcbiAgICAgICAgZXZpZGVuY2U6IHRoaXMuZXh0cmFjdEV2aWRlbmNlKG1zZ0xvd2VyLCBbLi4ucmVhZFdyaXRlS2V5d29yZHMsIC4uLnJlYWRXcml0ZVBocmFzZXNdKSxcbiAgICAgICAgY29uZmlkZW5jZTogTWF0aC5taW4ocmVhZFdyaXRlU2NvcmUsIDEuMClcbiAgICAgIH0pXG4gICAgfVxuXG4gICAgLy8gS0lORVNUSEVUSUMgaW5kaWNhdG9yc1xuICAgIGNvbnN0IGtpbmVzdGhldGljS2V5d29yZHMgPSBbXG4gICAgICAnaGFjZXInLCAncHJhY3RpY2FyJywgJ2VqZXJjaWNpbycsICdhY3RpdmlkYWQnLCAnbWFubycsICd0b2NhcicsICdtb3ZlcicsXG4gICAgICAnZXhwZXJpbWVudGFyJywgJ3Byb2JhcicsICdtYW5pcHVsYXInLCAnY29uc3RydWlyJywgJ2NyZWFyJywgJ2ludGVyYWN0aXZvJ1xuICAgIF1cbiAgICBcbiAgICBjb25zdCBraW5lc3RoZXRpY1BocmFzZXMgPSBbXG4gICAgICAncXVpZXJvIGhhY2VyJywgJ25lY2VzaXRvIHByYWN0aWNhcicsICdoYW5kcyBvbicsICdkZSBmb3JtYSBwcsOhY3RpY2EnLFxuICAgICAgJ2V4cGVyaW1lbnRhbmRvJywgJ3Byb2JhbmRvJywgJ2hhY2llbmRvIGVqZXJjaWNpb3MnLCAnYWN0aXZpZGFkZXMnXG4gICAgXVxuICAgIFxuICAgIGxldCBraW5lc3RoZXRpY1Njb3JlID0gdGhpcy5jYWxjdWxhdGVLZXl3b3JkU2NvcmUobXNnTG93ZXIsIGtpbmVzdGhldGljS2V5d29yZHMsIGtpbmVzdGhldGljUGhyYXNlcylcbiAgICBpZiAoa2luZXN0aGV0aWNTY29yZSA+IDApIHtcbiAgICAgIGluZGljYXRvcnMucHVzaCh7XG4gICAgICAgIHN0eWxlOiBMZWFybmluZ1N0eWxlLktJTkVTVEhFVElDLFxuICAgICAgICB3ZWlnaHQ6IGtpbmVzdGhldGljU2NvcmUsXG4gICAgICAgIGV2aWRlbmNlOiB0aGlzLmV4dHJhY3RFdmlkZW5jZShtc2dMb3dlciwgWy4uLmtpbmVzdGhldGljS2V5d29yZHMsIC4uLmtpbmVzdGhldGljUGhyYXNlc10pLFxuICAgICAgICBjb25maWRlbmNlOiBNYXRoLm1pbihraW5lc3RoZXRpY1Njb3JlICogMS4zLCAxLjApXG4gICAgICB9KVxuICAgIH1cblxuICAgIC8vIFJlY29yZCBiZWhhdmlvciBwYXR0ZXJuXG4gICAgaWYgKGluZGljYXRvcnMubGVuZ3RoID4gMCkge1xuICAgICAgdGhpcy5yZWNvcmRCZWhhdmlvclBhdHRlcm4odXNlcklkLCAnbWVzc2FnZV9hbmFseXNpcycsIG1lc3NhZ2UsIFxuICAgICAgICBpbmRpY2F0b3JzLm1hcChpID0+IGkuc3R5bGUpKVxuICAgIH1cblxuICAgIHJldHVybiBpbmRpY2F0b3JzLnNvcnQoKGEsIGIpID0+IGIud2VpZ2h0IC0gYS53ZWlnaHQpXG4gIH1cblxuICAvKipcbiAgICogQ2FsY3VsYXRlcyBzY29yZSBiYXNlZCBvbiBrZXl3b3JkIGFuZCBwaHJhc2UgbWF0Y2hlc1xuICAgKi9cbiAgcHJpdmF0ZSBzdGF0aWMgY2FsY3VsYXRlS2V5d29yZFNjb3JlKHRleHQ6IHN0cmluZywga2V5d29yZHM6IHN0cmluZ1tdLCBwaHJhc2VzOiBzdHJpbmdbXSk6IG51bWJlciB7XG4gICAgbGV0IHNjb3JlID0gMFxuICAgIFxuICAgIC8vIEtleXdvcmQgbWF0Y2hlcyAobG93ZXIgd2VpZ2h0KVxuICAgIGZvciAoY29uc3Qga2V5d29yZCBvZiBrZXl3b3Jkcykge1xuICAgICAgaWYgKHRleHQuaW5jbHVkZXMoa2V5d29yZCkpIHtcbiAgICAgICAgc2NvcmUgKz0gMC4xXG4gICAgICB9XG4gICAgfVxuICAgIFxuICAgIC8vIFBocmFzZSBtYXRjaGVzIChoaWdoZXIgd2VpZ2h0KVxuICAgIGZvciAoY29uc3QgcGhyYXNlIG9mIHBocmFzZXMpIHtcbiAgICAgIGlmICh0ZXh0LmluY2x1ZGVzKHBocmFzZSkpIHtcbiAgICAgICAgc2NvcmUgKz0gMC4zXG4gICAgICB9XG4gICAgfVxuICAgIFxuICAgIHJldHVybiBNYXRoLm1pbihzY29yZSwgMS4wKVxuICB9XG5cbiAgLyoqXG4gICAqIEV4dHJhY3RzIGV2aWRlbmNlIGZyb20gdGV4dFxuICAgKi9cbiAgcHJpdmF0ZSBzdGF0aWMgZXh0cmFjdEV2aWRlbmNlKHRleHQ6IHN0cmluZywgcGF0dGVybnM6IHN0cmluZ1tdKTogc3RyaW5nW10ge1xuICAgIGNvbnN0IGV2aWRlbmNlOiBzdHJpbmdbXSA9IFtdXG4gICAgXG4gICAgZm9yIChjb25zdCBwYXR0ZXJuIG9mIHBhdHRlcm5zKSB7XG4gICAgICBpZiAodGV4dC5pbmNsdWRlcyhwYXR0ZXJuKSkge1xuICAgICAgICAvLyBFeHRyYWN0IHNlbnRlbmNlIGNvbnRhaW5pbmcgdGhlIHBhdHRlcm5cbiAgICAgICAgY29uc3Qgc2VudGVuY2VzID0gdGV4dC5zcGxpdCgvWy4hP10rLylcbiAgICAgICAgY29uc3QgbWF0Y2hpbmdTZW50ZW5jZSA9IHNlbnRlbmNlcy5maW5kKHNlbnRlbmNlID0+IFxuICAgICAgICAgIHNlbnRlbmNlLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMocGF0dGVybikpXG4gICAgICAgIGlmIChtYXRjaGluZ1NlbnRlbmNlKSB7XG4gICAgICAgICAgZXZpZGVuY2UucHVzaChtYXRjaGluZ1NlbnRlbmNlLnRyaW0oKSlcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICBcbiAgICByZXR1cm4gZXZpZGVuY2Uuc2xpY2UoMCwgMykgLy8gTGltaXQgdG8gMyBwaWVjZXMgb2YgZXZpZGVuY2VcbiAgfVxuXG4gIC8qKlxuICAgKiBSZWNvcmRzIGEgbGVhcm5pbmcgYmVoYXZpb3IgcGF0dGVyblxuICAgKi9cbiAgc3RhdGljIHJlY29yZEJlaGF2aW9yUGF0dGVybih1c2VySWQ6IHN0cmluZywgYWN0aW9uOiBzdHJpbmcsIGNvbnRleHQ6IHN0cmluZywgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3R5bGVJbmRpY2F0b3JzOiBMZWFybmluZ1N0eWxlW10pIHtcbiAgICB0aGlzLmJlaGF2aW9ycy5wdXNoKHtcbiAgICAgIHVzZXJJZCxcbiAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKSxcbiAgICAgIGFjdGlvbixcbiAgICAgIGNvbnRleHQsXG4gICAgICBzdHlsZUluZGljYXRvcnNcbiAgICB9KVxuXG4gICAgLy8gS2VlcCBvbmx5IHJlY2VudCBiZWhhdmlvcnMgKGxhc3QgMTAwIHBlciB1c2VyKVxuICAgIGNvbnN0IHVzZXJCZWhhdmlvcnMgPSB0aGlzLmJlaGF2aW9ycy5maWx0ZXIoYiA9PiBiLnVzZXJJZCA9PT0gdXNlcklkKVxuICAgIGlmICh1c2VyQmVoYXZpb3JzLmxlbmd0aCA+IDEwMCkge1xuICAgICAgdGhpcy5iZWhhdmlvcnMgPSB0aGlzLmJlaGF2aW9ycy5maWx0ZXIoYiA9PiBiLnVzZXJJZCAhPT0gdXNlcklkKVxuICAgICAgICAuY29uY2F0KHVzZXJCZWhhdmlvcnMuc2xpY2UoLTEwMCkpXG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFVwZGF0ZXMgb3IgY3JlYXRlcyBsZWFybmluZyBwcm9maWxlIGZvciB1c2VyXG4gICAqL1xuICBzdGF0aWMgdXBkYXRlTGVhcm5pbmdQcm9maWxlKHVzZXJJZDogc3RyaW5nLCBpbmRpY2F0b3JzOiBMZWFybmluZ1N0eWxlSW5kaWNhdG9yW10sIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRleHQ/OiBzdHJpbmcpOiBMZWFybmluZ1Byb2ZpbGUge1xuICAgIGxldCBwcm9maWxlID0gdGhpcy5wcm9maWxlcy5nZXQodXNlcklkKSB8fCB0aGlzLmNyZWF0ZUluaXRpYWxQcm9maWxlKHVzZXJJZClcblxuICAgIC8vIFVwZGF0ZSBzdHlsZSBkaXN0cmlidXRpb24gYmFzZWQgb24gbmV3IGluZGljYXRvcnNcbiAgICBmb3IgKGNvbnN0IGluZGljYXRvciBvZiBpbmRpY2F0b3JzKSB7XG4gICAgICBjb25zdCB3ZWlnaHQgPSBpbmRpY2F0b3Iud2VpZ2h0ICogaW5kaWNhdG9yLmNvbmZpZGVuY2VcbiAgICAgIFxuICAgICAgc3dpdGNoIChpbmRpY2F0b3Iuc3R5bGUpIHtcbiAgICAgICAgY2FzZSBMZWFybmluZ1N0eWxlLlZJU1VBTDpcbiAgICAgICAgICBwcm9maWxlLnN0eWxlRGlzdHJpYnV0aW9uLnZpc3VhbCA9IE1hdGgubWluKFxuICAgICAgICAgICAgcHJvZmlsZS5zdHlsZURpc3RyaWJ1dGlvbi52aXN1YWwgKyB3ZWlnaHQgKiAwLjEsIDEuMClcbiAgICAgICAgICBicmVha1xuICAgICAgICBjYXNlIExlYXJuaW5nU3R5bGUuQVVESVRPUlk6XG4gICAgICAgICAgcHJvZmlsZS5zdHlsZURpc3RyaWJ1dGlvbi5hdWRpdG9yeSA9IE1hdGgubWluKFxuICAgICAgICAgICAgcHJvZmlsZS5zdHlsZURpc3RyaWJ1dGlvbi5hdWRpdG9yeSArIHdlaWdodCAqIDAuMSwgMS4wKVxuICAgICAgICAgIGJyZWFrXG4gICAgICAgIGNhc2UgTGVhcm5pbmdTdHlsZS5SRUFESU5HX1dSSVRJTkc6XG4gICAgICAgICAgcHJvZmlsZS5zdHlsZURpc3RyaWJ1dGlvbi5yZWFkaW5nX3dyaXRpbmcgPSBNYXRoLm1pbihcbiAgICAgICAgICAgIHByb2ZpbGUuc3R5bGVEaXN0cmlidXRpb24ucmVhZGluZ193cml0aW5nICsgd2VpZ2h0ICogMC4xLCAxLjApXG4gICAgICAgICAgYnJlYWtcbiAgICAgICAgY2FzZSBMZWFybmluZ1N0eWxlLktJTkVTVEhFVElDOlxuICAgICAgICAgIHByb2ZpbGUuc3R5bGVEaXN0cmlidXRpb24ua2luZXN0aGV0aWMgPSBNYXRoLm1pbihcbiAgICAgICAgICAgIHByb2ZpbGUuc3R5bGVEaXN0cmlidXRpb24ua2luZXN0aGV0aWMgKyB3ZWlnaHQgKiAwLjEsIDEuMClcbiAgICAgICAgICBicmVha1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vIE5vcm1hbGl6ZSBkaXN0cmlidXRpb25cbiAgICBjb25zdCB0b3RhbCA9IHByb2ZpbGUuc3R5bGVEaXN0cmlidXRpb24udmlzdWFsICsgXG4gICAgICAgICAgICAgICAgICBwcm9maWxlLnN0eWxlRGlzdHJpYnV0aW9uLmF1ZGl0b3J5ICtcbiAgICAgICAgICAgICAgICAgIHByb2ZpbGUuc3R5bGVEaXN0cmlidXRpb24ucmVhZGluZ193cml0aW5nICsgXG4gICAgICAgICAgICAgICAgICBwcm9maWxlLnN0eWxlRGlzdHJpYnV0aW9uLmtpbmVzdGhldGljXG5cbiAgICBpZiAodG90YWwgPiAwKSB7XG4gICAgICBwcm9maWxlLnN0eWxlRGlzdHJpYnV0aW9uLnZpc3VhbCAvPSB0b3RhbFxuICAgICAgcHJvZmlsZS5zdHlsZURpc3RyaWJ1dGlvbi5hdWRpdG9yeSAvPSB0b3RhbFxuICAgICAgcHJvZmlsZS5zdHlsZURpc3RyaWJ1dGlvbi5yZWFkaW5nX3dyaXRpbmcgLz0gdG90YWxcbiAgICAgIHByb2ZpbGUuc3R5bGVEaXN0cmlidXRpb24ua2luZXN0aGV0aWMgLz0gdG90YWxcbiAgICB9XG5cbiAgICAvLyBEZXRlcm1pbmUgcHJpbWFyeSBhbmQgc2Vjb25kYXJ5IHN0eWxlc1xuICAgIGNvbnN0IHN0eWxlcyA9IFtcbiAgICAgIHsgc3R5bGU6IExlYXJuaW5nU3R5bGUuVklTVUFMLCBzY29yZTogcHJvZmlsZS5zdHlsZURpc3RyaWJ1dGlvbi52aXN1YWwgfSxcbiAgICAgIHsgc3R5bGU6IExlYXJuaW5nU3R5bGUuQVVESVRPUlksIHNjb3JlOiBwcm9maWxlLnN0eWxlRGlzdHJpYnV0aW9uLmF1ZGl0b3J5IH0sXG4gICAgICB7IHN0eWxlOiBMZWFybmluZ1N0eWxlLlJFQURJTkdfV1JJVElORywgc2NvcmU6IHByb2ZpbGUuc3R5bGVEaXN0cmlidXRpb24ucmVhZGluZ193cml0aW5nIH0sXG4gICAgICB7IHN0eWxlOiBMZWFybmluZ1N0eWxlLktJTkVTVEhFVElDLCBzY29yZTogcHJvZmlsZS5zdHlsZURpc3RyaWJ1dGlvbi5raW5lc3RoZXRpYyB9XG4gICAgXS5zb3J0KChhLCBiKSA9PiBiLnNjb3JlIC0gYS5zY29yZSlcblxuICAgIHByb2ZpbGUucHJpbWFyeVN0eWxlID0gc3R5bGVzWzBdLnNjb3JlID4gMC4zNSA/IHN0eWxlc1swXS5zdHlsZSA6IExlYXJuaW5nU3R5bGUuTVVMVElNT0RBTFxuICAgIHByb2ZpbGUuc2Vjb25kYXJ5U3R5bGUgPSBzdHlsZXNbMV0uc2NvcmUgPiAwLjI1ID8gc3R5bGVzWzFdLnN0eWxlIDogdW5kZWZpbmVkXG5cbiAgICAvLyBVcGRhdGUgYWRhcHRhdGlvbiBwcmVmZXJlbmNlc1xuICAgIHByb2ZpbGUuYWRhcHRhdGlvblByZWZlcmVuY2VzID0ge1xuICAgICAgcHJlZmVyc0RpYWdyYW1zOiBwcm9maWxlLnN0eWxlRGlzdHJpYnV0aW9uLnZpc3VhbCA+IDAuMyxcbiAgICAgIHByZWZlcnNTdGVwQnlTdGVwOiBwcm9maWxlLnN0eWxlRGlzdHJpYnV0aW9uLnJlYWRpbmdfd3JpdGluZyA+IDAuMyxcbiAgICAgIHByZWZlcnNFeGFtcGxlczogcHJvZmlsZS5zdHlsZURpc3RyaWJ1dGlvbi52aXN1YWwgPiAwLjI1IHx8IFxuICAgICAgICAgICAgICAgICAgICAgICBwcm9maWxlLnN0eWxlRGlzdHJpYnV0aW9uLmtpbmVzdGhldGljID4gMC4yNSxcbiAgICAgIHByZWZlcnNJbnRlcmFjdGlvbjogcHJvZmlsZS5zdHlsZURpc3RyaWJ1dGlvbi5raW5lc3RoZXRpYyA+IDAuMyxcbiAgICAgIHByZWZlcnNWaXN1YWxBaWRzOiBwcm9maWxlLnN0eWxlRGlzdHJpYnV0aW9uLnZpc3VhbCA+IDAuMjUsXG4gICAgICBwcmVmZXJzVmVyYmFsRXhwbGFuYXRpb246IHByb2ZpbGUuc3R5bGVEaXN0cmlidXRpb24uYXVkaXRvcnkgPiAwLjNcbiAgICB9XG5cbiAgICBwcm9maWxlLmxhc3RVcGRhdGVkID0gbmV3IERhdGUoKVxuICAgIHByb2ZpbGUuaW50ZXJhY3Rpb25zKytcbiAgICBcbiAgICB0aGlzLnByb2ZpbGVzLnNldCh1c2VySWQsIHByb2ZpbGUpXG4gICAgXG4gICAgY29uc29sZS5sb2coYPCfk4ogTGVhcm5pbmcgcHJvZmlsZSB1cGRhdGVkIGZvciAke3VzZXJJZH06IFByaW1hcnk9JHtwcm9maWxlLnByaW1hcnlTdHlsZX0sIFNlY29uZGFyeT0ke3Byb2ZpbGUuc2Vjb25kYXJ5U3R5bGUgfHwgJ25vbmUnfWApXG4gICAgXG4gICAgcmV0dXJuIHByb2ZpbGVcbiAgfVxuXG4gIC8qKlxuICAgKiBDcmVhdGVzIGluaXRpYWwgbGVhcm5pbmcgcHJvZmlsZVxuICAgKi9cbiAgcHJpdmF0ZSBzdGF0aWMgY3JlYXRlSW5pdGlhbFByb2ZpbGUodXNlcklkOiBzdHJpbmcpOiBMZWFybmluZ1Byb2ZpbGUge1xuICAgIHJldHVybiB7XG4gICAgICB1c2VySWQsXG4gICAgICBwcmltYXJ5U3R5bGU6IExlYXJuaW5nU3R5bGUuTVVMVElNT0RBTCxcbiAgICAgIHNlY29uZGFyeVN0eWxlOiB1bmRlZmluZWQsXG4gICAgICBzdHlsZURpc3RyaWJ1dGlvbjoge1xuICAgICAgICB2aXN1YWw6IDAuMjUsXG4gICAgICAgIGF1ZGl0b3J5OiAwLjI1LFxuICAgICAgICByZWFkaW5nX3dyaXRpbmc6IDAuMjUsXG4gICAgICAgIGtpbmVzdGhldGljOiAwLjI1XG4gICAgICB9LFxuICAgICAgYWRhcHRhdGlvblByZWZlcmVuY2VzOiB7XG4gICAgICAgIHByZWZlcnNEaWFncmFtczogZmFsc2UsXG4gICAgICAgIHByZWZlcnNTdGVwQnlTdGVwOiB0cnVlLFxuICAgICAgICBwcmVmZXJzRXhhbXBsZXM6IHRydWUsXG4gICAgICAgIHByZWZlcnNJbnRlcmFjdGlvbjogZmFsc2UsXG4gICAgICAgIHByZWZlcnNWaXN1YWxBaWRzOiBmYWxzZSxcbiAgICAgICAgcHJlZmVyc1ZlcmJhbEV4cGxhbmF0aW9uOiBmYWxzZVxuICAgICAgfSxcbiAgICAgIGRldGVjdGVkRnJvbToge1xuICAgICAgICBtZXNzYWdlQW5hbHlzaXM6IDAsXG4gICAgICAgIGJlaGF2aW9yUGF0dGVybnM6IDAsXG4gICAgICAgIGV4cGxpY2l0UHJlZmVyZW5jZXM6IDBcbiAgICAgIH0sXG4gICAgICBsYXN0VXBkYXRlZDogbmV3IERhdGUoKSxcbiAgICAgIGludGVyYWN0aW9uczogMFxuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBHZXRzIGxlYXJuaW5nIHByb2ZpbGUgZm9yIHVzZXJcbiAgICovXG4gIHN0YXRpYyBnZXRMZWFybmluZ1Byb2ZpbGUodXNlcklkOiBzdHJpbmcpOiBMZWFybmluZ1Byb2ZpbGUge1xuICAgIHJldHVybiB0aGlzLnByb2ZpbGVzLmdldCh1c2VySWQpIHx8IHRoaXMuY3JlYXRlSW5pdGlhbFByb2ZpbGUodXNlcklkKVxuICB9XG5cbiAgLyoqXG4gICAqIEFkYXB0cyByZXNwb25zZSBjb250ZW50IGJhc2VkIG9uIGxlYXJuaW5nIHByb2ZpbGVcbiAgICovXG4gIHN0YXRpYyBhZGFwdFJlc3BvbnNlVG9MZWFybmluZ1N0eWxlKGNvbnRlbnQ6IHN0cmluZywgcHJvZmlsZTogTGVhcm5pbmdQcm9maWxlKTogc3RyaW5nIHtcbiAgICBsZXQgYWRhcHRlZENvbnRlbnQgPSBjb250ZW50XG5cbiAgICAvLyBWaXN1YWwgbGVhcm5lciBhZGFwdGF0aW9uc1xuICAgIGlmIChwcm9maWxlLmFkYXB0YXRpb25QcmVmZXJlbmNlcy5wcmVmZXJzVmlzdWFsQWlkcykge1xuICAgICAgYWRhcHRlZENvbnRlbnQgPSB0aGlzLmFkZFZpc3VhbEVsZW1lbnRzKGFkYXB0ZWRDb250ZW50LCBwcm9maWxlKVxuICAgIH1cblxuICAgIC8vIEF1ZGl0b3J5IGxlYXJuZXIgYWRhcHRhdGlvbnNcbiAgICBpZiAocHJvZmlsZS5hZGFwdGF0aW9uUHJlZmVyZW5jZXMucHJlZmVyc1ZlcmJhbEV4cGxhbmF0aW9uKSB7XG4gICAgICBhZGFwdGVkQ29udGVudCA9IHRoaXMuYWRkQXVkaXRvcnlFbGVtZW50cyhhZGFwdGVkQ29udGVudCwgcHJvZmlsZSlcbiAgICB9XG5cbiAgICAvLyBSZWFkaW5nL1dyaXRpbmcgbGVhcm5lciBhZGFwdGF0aW9uc1xuICAgIGlmIChwcm9maWxlLmFkYXB0YXRpb25QcmVmZXJlbmNlcy5wcmVmZXJzU3RlcEJ5U3RlcCkge1xuICAgICAgYWRhcHRlZENvbnRlbnQgPSB0aGlzLmFkZFN0cnVjdHVyZWRFbGVtZW50cyhhZGFwdGVkQ29udGVudCwgcHJvZmlsZSlcbiAgICB9XG5cbiAgICAvLyBLaW5lc3RoZXRpYyBsZWFybmVyIGFkYXB0YXRpb25zXG4gICAgaWYgKHByb2ZpbGUuYWRhcHRhdGlvblByZWZlcmVuY2VzLnByZWZlcnNJbnRlcmFjdGlvbikge1xuICAgICAgYWRhcHRlZENvbnRlbnQgPSB0aGlzLmFkZEludGVyYWN0aXZlRWxlbWVudHMoYWRhcHRlZENvbnRlbnQsIHByb2ZpbGUpXG4gICAgfVxuXG4gICAgcmV0dXJuIGFkYXB0ZWRDb250ZW50XG4gIH1cblxuICAvKipcbiAgICogQWRkcyB2aXN1YWwgZWxlbWVudHMgZm9yIHZpc3VhbCBsZWFybmVyc1xuICAgKi9cbiAgcHJpdmF0ZSBzdGF0aWMgYWRkVmlzdWFsRWxlbWVudHMoY29udGVudDogc3RyaW5nLCBwcm9maWxlOiBMZWFybmluZ1Byb2ZpbGUpOiBzdHJpbmcge1xuICAgIGxldCBlbmhhbmNlZCA9IGNvbnRlbnRcblxuICAgIC8vIEFkZCB2aXN1YWwgY3VlcyBhbmQgZm9ybWF0dGluZ1xuICAgIGVuaGFuY2VkID0gZW5oYW5jZWQucmVwbGFjZSgvaW1wb3J0YW50ZTovZ2ksICfwn5SNICoqSU1QT1JUQU5URToqKicpXG4gICAgZW5oYW5jZWQgPSBlbmhhbmNlZC5yZXBsYWNlKC9ub3RhOi9naSwgJ/Cfk50gKipOT1RBOioqJylcbiAgICBlbmhhbmNlZCA9IGVuaGFuY2VkLnJlcGxhY2UoL2VqZW1wbG86L2dpLCAn8J+SoSAqKkVKRU1QTE86KionKVxuICAgIGVuaGFuY2VkID0gZW5oYW5jZWQucmVwbGFjZSgvcmVzdWx0YWRvOi9naSwgJ+KchSAqKlJFU1VMVEFETzoqKicpXG5cbiAgICAvLyBBZGQgdmlzdWFsIHNlcGFyYXRvcnNcbiAgICBpZiAoZW5oYW5jZWQuaW5jbHVkZXMoJ3Bhc28nKSB8fCBlbmhhbmNlZC5pbmNsdWRlcygnc3RlcCcpKSB7XG4gICAgICBlbmhhbmNlZCA9IGVuaGFuY2VkLnJlcGxhY2UoL3Bhc28gKFxcZCspL2dpLCAnXFxu8J+TjSAqKlBBU08gJDEqKlxcbicpXG4gICAgfVxuXG4gICAgcmV0dXJuIGVuaGFuY2VkXG4gIH1cblxuICAvKipcbiAgICogQWRkcyBhdWRpdG9yeSBlbGVtZW50cyBmb3IgYXVkaXRvcnkgbGVhcm5lcnMgIFxuICAgKi9cbiAgcHJpdmF0ZSBzdGF0aWMgYWRkQXVkaXRvcnlFbGVtZW50cyhjb250ZW50OiBzdHJpbmcsIHByb2ZpbGU6IExlYXJuaW5nUHJvZmlsZSk6IHN0cmluZyB7XG4gICAgbGV0IGVuaGFuY2VkID0gY29udGVudFxuXG4gICAgLy8gQWRkIGNvbnZlcnNhdGlvbmFsIHBocmFzZXNcbiAgICBlbmhhbmNlZCA9IFwi8J+Xo++4jyBUZSB2b3kgYSBleHBsaWNhciBlc3RvIHBhc28gYSBwYXNvOlxcblxcblwiICsgZW5oYW5jZWRcbiAgICBcbiAgICAvLyBBZGQgdmVyYmFsIHRyYW5zaXRpb24gcGhyYXNlc1xuICAgIGVuaGFuY2VkID0gZW5oYW5jZWQucmVwbGFjZSgvXFwuIChbQS1aXSkvZywgJy4gQWhvcmEsICQxJylcbiAgICBlbmhhbmNlZCA9IGVuaGFuY2VkLnJlcGxhY2UoLzpcXG4vZywgJy4gRXNjdWNoYSBiaWVuOlxcbicpXG5cbiAgICByZXR1cm4gZW5oYW5jZWRcbiAgfVxuXG4gIC8qKlxuICAgKiBBZGRzIHN0cnVjdHVyZWQgZWxlbWVudHMgZm9yIHJlYWRpbmcvd3JpdGluZyBsZWFybmVyc1xuICAgKi9cbiAgcHJpdmF0ZSBzdGF0aWMgYWRkU3RydWN0dXJlZEVsZW1lbnRzKGNvbnRlbnQ6IHN0cmluZywgcHJvZmlsZTogTGVhcm5pbmdQcm9maWxlKTogc3RyaW5nIHtcbiAgICBsZXQgZW5oYW5jZWQgPSBjb250ZW50XG5cbiAgICAvLyBBZGQgY2xlYXIgc3RydWN0dXJlIGFuZCBidWxsZXQgcG9pbnRzXG4gICAgaWYgKCFlbmhhbmNlZC5pbmNsdWRlcygnKionKSAmJiBlbmhhbmNlZC5sZW5ndGggPiAyMDApIHtcbiAgICAgIGNvbnN0IHNlbnRlbmNlcyA9IGVuaGFuY2VkLnNwbGl0KCcuJylcbiAgICAgIGlmIChzZW50ZW5jZXMubGVuZ3RoID4gMykge1xuICAgICAgICBlbmhhbmNlZCA9IHNlbnRlbmNlc1xuICAgICAgICAgIC5maWx0ZXIocyA9PiBzLnRyaW0oKS5sZW5ndGggPiAxMClcbiAgICAgICAgICAubWFwKChzZW50ZW5jZSwgaW5kZXgpID0+IGAke2luZGV4ICsgMX0uICR7c2VudGVuY2UudHJpbSgpfWApXG4gICAgICAgICAgLmpvaW4oJ1xcbicpXG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIGVuaGFuY2VkXG4gIH1cblxuICAvKipcbiAgICogQWRkcyBpbnRlcmFjdGl2ZSBlbGVtZW50cyBmb3Iga2luZXN0aGV0aWMgbGVhcm5lcnNcbiAgICovXG4gIHByaXZhdGUgc3RhdGljIGFkZEludGVyYWN0aXZlRWxlbWVudHMoY29udGVudDogc3RyaW5nLCBwcm9maWxlOiBMZWFybmluZ1Byb2ZpbGUpOiBzdHJpbmcge1xuICAgIGxldCBlbmhhbmNlZCA9IGNvbnRlbnRcblxuICAgIC8vIEFkZCBhY3Rpb24tb3JpZW50ZWQgbGFuZ3VhZ2VcbiAgICBlbmhhbmNlZCArPSBcIlxcblxcbvCfjq8gKipQcnVlYmEgZXN0bzoqKlwiXG4gICAgZW5oYW5jZWQgKz0gXCJcXG7igKIgQXBsaWNhIGVzdGUgY29uY2VwdG8gYSB1biBwcm9ibGVtYSByZWFsXCJcbiAgICBlbmhhbmNlZCArPSBcIlxcbuKAoiBFeHBlcmltZW50YSBjYW1iaWFuZG8gbG9zIHZhbG9yZXNcIlxuICAgIGVuaGFuY2VkICs9IFwiXFxu4oCiIFByYWN0aWNhIGNvbiBlamVyY2ljaW9zIHNpbWlsYXJlc1wiXG5cbiAgICByZXR1cm4gZW5oYW5jZWRcbiAgfVxuXG4gIC8qKlxuICAgKiBBbmFseXplcyBiZWhhdmlvciBwYXR0ZXJucyB0byBlbmhhbmNlIHByb2ZpbGVcbiAgICovXG4gIHN0YXRpYyBhbmFseXplQmVoYXZpb3JQYXR0ZXJucyh1c2VySWQ6IHN0cmluZyk6IExlYXJuaW5nUHJvZmlsZSB7XG4gICAgY29uc3QgdXNlckJlaGF2aW9ycyA9IHRoaXMuYmVoYXZpb3JzLmZpbHRlcihiID0+IGIudXNlcklkID09PSB1c2VySWQpXG4gICAgY29uc3QgcHJvZmlsZSA9IHRoaXMuZ2V0TGVhcm5pbmdQcm9maWxlKHVzZXJJZClcblxuICAgIGlmICh1c2VyQmVoYXZpb3JzLmxlbmd0aCA8IDUpIHJldHVybiBwcm9maWxlXG5cbiAgICAvLyBBbmFseXplIHBhdHRlcm5zIGluIHJlY2VudCBiZWhhdmlvcnNcbiAgICBjb25zdCByZWNlbnRCZWhhdmlvcnMgPSB1c2VyQmVoYXZpb3JzLnNsaWNlKC0yMClcbiAgICBjb25zdCBzdHlsZUZyZXF1ZW5jeSA9IG5ldyBNYXA8TGVhcm5pbmdTdHlsZSwgbnVtYmVyPigpXG5cbiAgICBmb3IgKGNvbnN0IGJlaGF2aW9yIG9mIHJlY2VudEJlaGF2aW9ycykge1xuICAgICAgZm9yIChjb25zdCBzdHlsZSBvZiBiZWhhdmlvci5zdHlsZUluZGljYXRvcnMpIHtcbiAgICAgICAgc3R5bGVGcmVxdWVuY3kuc2V0KHN0eWxlLCAoc3R5bGVGcmVxdWVuY3kuZ2V0KHN0eWxlKSB8fCAwKSArIDEpXG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gVXBkYXRlIHByb2ZpbGUgYmFzZWQgb24gYmVoYXZpb3JhbCBwYXR0ZXJuc1xuICAgIGNvbnN0IGluZGljYXRvcnM6IExlYXJuaW5nU3R5bGVJbmRpY2F0b3JbXSA9IFtdXG4gICAgZm9yIChjb25zdCBbc3R5bGUsIGZyZXF1ZW5jeV0gb2Ygc3R5bGVGcmVxdWVuY3kuZW50cmllcygpKSB7XG4gICAgICBjb25zdCB3ZWlnaHQgPSBmcmVxdWVuY3kgLyByZWNlbnRCZWhhdmlvcnMubGVuZ3RoXG4gICAgICBpZiAod2VpZ2h0ID4gMC4xKSB7XG4gICAgICAgIGluZGljYXRvcnMucHVzaCh7XG4gICAgICAgICAgc3R5bGUsXG4gICAgICAgICAgd2VpZ2h0LFxuICAgICAgICAgIGV2aWRlbmNlOiBbYERldGVjdGFkbyBlbiAke2ZyZXF1ZW5jeX0gZGUgJHtyZWNlbnRCZWhhdmlvcnMubGVuZ3RofSBpbnRlcmFjY2lvbmVzIHJlY2llbnRlc2BdLFxuICAgICAgICAgIGNvbmZpZGVuY2U6IE1hdGgubWluKHdlaWdodCAqIDIsIDEuMClcbiAgICAgICAgfSlcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gdGhpcy51cGRhdGVMZWFybmluZ1Byb2ZpbGUodXNlcklkLCBpbmRpY2F0b3JzLCAnYmVoYXZpb3JfYW5hbHlzaXMnKVxuICB9XG5cbiAgLyoqXG4gICAqIEdldHMgcHJvZmlsZSBzdGF0aXN0aWNzXG4gICAqL1xuICBzdGF0aWMgZ2V0UHJvZmlsZVN0YXRpc3RpY3ModXNlcklkPzogc3RyaW5nKTogYW55IHtcbiAgICBpZiAodXNlcklkKSB7XG4gICAgICBjb25zdCBwcm9maWxlID0gdGhpcy5wcm9maWxlcy5nZXQodXNlcklkKVxuICAgICAgY29uc3QgYmVoYXZpb3JzID0gdGhpcy5iZWhhdmlvcnMuZmlsdGVyKGIgPT4gYi51c2VySWQgPT09IHVzZXJJZClcbiAgICAgIFxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgcHJvZmlsZTogcHJvZmlsZSB8fCBudWxsLFxuICAgICAgICBiZWhhdmlvckNvdW50OiBiZWhhdmlvcnMubGVuZ3RoLFxuICAgICAgICByZWNlbnRJbnRlcmFjdGlvbnM6IGJlaGF2aW9ycy5maWx0ZXIoYiA9PiBcbiAgICAgICAgICBiLnRpbWVzdGFtcCA+IG5ldyBEYXRlKERhdGUubm93KCkgLSA3ICogMjQgKiA2MCAqIDYwICogMTAwMClcbiAgICAgICAgKS5sZW5ndGhcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4ge1xuICAgICAgdG90YWxQcm9maWxlczogdGhpcy5wcm9maWxlcy5zaXplLFxuICAgICAgdG90YWxCZWhhdmlvcnM6IHRoaXMuYmVoYXZpb3JzLmxlbmd0aCxcbiAgICAgIHN0eWxlRGlzdHJpYnV0aW9uOiB0aGlzLmdldEdsb2JhbFN0eWxlRGlzdHJpYnV0aW9uKClcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogR2V0cyBnbG9iYWwgc3R5bGUgZGlzdHJpYnV0aW9uXG4gICAqL1xuICBwcml2YXRlIHN0YXRpYyBnZXRHbG9iYWxTdHlsZURpc3RyaWJ1dGlvbigpOiBhbnkge1xuICAgIGNvbnN0IGRpc3RyaWJ1dGlvbiA9IHtcbiAgICAgIHZpc3VhbDogMCxcbiAgICAgIGF1ZGl0b3J5OiAwLFxuICAgICAgcmVhZGluZ193cml0aW5nOiAwLFxuICAgICAga2luZXN0aGV0aWM6IDAsXG4gICAgICBtdWx0aW1vZGFsOiAwXG4gICAgfVxuXG4gICAgZm9yIChjb25zdCBwcm9maWxlIG9mIHRoaXMucHJvZmlsZXMudmFsdWVzKCkpIHtcbiAgICAgIHN3aXRjaCAocHJvZmlsZS5wcmltYXJ5U3R5bGUpIHtcbiAgICAgICAgY2FzZSBMZWFybmluZ1N0eWxlLlZJU1VBTDpcbiAgICAgICAgICBkaXN0cmlidXRpb24udmlzdWFsKytcbiAgICAgICAgICBicmVha1xuICAgICAgICBjYXNlIExlYXJuaW5nU3R5bGUuQVVESVRPUlk6XG4gICAgICAgICAgZGlzdHJpYnV0aW9uLmF1ZGl0b3J5KytcbiAgICAgICAgICBicmVha1xuICAgICAgICBjYXNlIExlYXJuaW5nU3R5bGUuUkVBRElOR19XUklUSU5HOlxuICAgICAgICAgIGRpc3RyaWJ1dGlvbi5yZWFkaW5nX3dyaXRpbmcrK1xuICAgICAgICAgIGJyZWFrXG4gICAgICAgIGNhc2UgTGVhcm5pbmdTdHlsZS5LSU5FU1RIRVRJQzpcbiAgICAgICAgICBkaXN0cmlidXRpb24ua2luZXN0aGV0aWMrK1xuICAgICAgICAgIGJyZWFrXG4gICAgICAgIGNhc2UgTGVhcm5pbmdTdHlsZS5NVUxUSU1PREFMOlxuICAgICAgICAgIGRpc3RyaWJ1dGlvbi5tdWx0aW1vZGFsKytcbiAgICAgICAgICBicmVha1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBkaXN0cmlidXRpb25cbiAgfVxuXG4gIC8qKlxuICAgKiBQcm9jZXNzIHVzZXIgbWVzc2FnZSBhbmQgdXBkYXRlIGxlYXJuaW5nIHByb2ZpbGVcbiAgICovXG4gIHN0YXRpYyBwcm9jZXNzVXNlck1lc3NhZ2UodXNlcklkOiBzdHJpbmcsIG1lc3NhZ2U6IHN0cmluZyk6IExlYXJuaW5nUHJvZmlsZSB7XG4gICAgLy8gQW5hbHl6ZSBtZXNzYWdlIGZvciBsZWFybmluZyBzdHlsZSBpbmRpY2F0b3JzXG4gICAgY29uc3QgaW5kaWNhdG9ycyA9IHRoaXMuYW5hbHl6ZU1lc3NhZ2VGb3JMZWFybmluZ1N0eWxlKG1lc3NhZ2UsIHVzZXJJZClcbiAgICBcbiAgICAvLyBVcGRhdGUgbGVhcm5pbmcgcHJvZmlsZSBpZiBpbmRpY2F0b3JzIGZvdW5kXG4gICAgaWYgKGluZGljYXRvcnMubGVuZ3RoID4gMCkge1xuICAgICAgcmV0dXJuIHRoaXMudXBkYXRlTGVhcm5pbmdQcm9maWxlKHVzZXJJZCwgaW5kaWNhdG9ycywgJ21lc3NhZ2VfcHJvY2Vzc2luZycpXG4gICAgfVxuICAgIFxuICAgIC8vIEFuYWx5emUgYmVoYXZpb3IgcGF0dGVybnMgcGVyaW9kaWNhbGx5XG4gICAgY29uc3QgcHJvZmlsZSA9IHRoaXMuZ2V0TGVhcm5pbmdQcm9maWxlKHVzZXJJZClcbiAgICBpZiAocHJvZmlsZS5pbnRlcmFjdGlvbnMgJSAxMCA9PT0gMCkge1xuICAgICAgcmV0dXJuIHRoaXMuYW5hbHl6ZUJlaGF2aW9yUGF0dGVybnModXNlcklkKVxuICAgIH1cbiAgICBcbiAgICByZXR1cm4gcHJvZmlsZVxuICB9XG5cbiAgLyoqXG4gICAqIEdlbmVyYXRlcyBsZWFybmluZyBzdHlsZSByZWNvbW1lbmRhdGlvbnMgZm9yIFNhcmFcbiAgICovXG4gIHN0YXRpYyBnZW5lcmF0ZVN0eWxlUmVjb21tZW5kYXRpb25zKHByb2ZpbGU6IExlYXJuaW5nUHJvZmlsZSk6IHN0cmluZ1tdIHtcbiAgICBjb25zdCByZWNvbW1lbmRhdGlvbnM6IHN0cmluZ1tdID0gW11cbiAgICBcbiAgICBzd2l0Y2ggKHByb2ZpbGUucHJpbWFyeVN0eWxlKSB7XG4gICAgICBjYXNlIExlYXJuaW5nU3R5bGUuVklTVUFMOlxuICAgICAgICByZWNvbW1lbmRhdGlvbnMucHVzaChcIlVzYXIgZGlhZ3JhbWFzIHkgZXNxdWVtYXMgY3VhbmRvIGV4cGxpY28gY29uY2VwdG9zXCIpXG4gICAgICAgIHJlY29tbWVuZGF0aW9ucy5wdXNoKFwiSW5jbHVpciBlamVtcGxvcyB2aXN1YWxlcyB5IGdyw6FmaWNvc1wiKVxuICAgICAgICByZWNvbW1lbmRhdGlvbnMucHVzaChcIkVzdHJ1Y3R1cmFyIGluZm9ybWFjacOzbiBjb24gdmnDsWV0YXMgeSBjb2xvcmVzXCIpXG4gICAgICAgIGJyZWFrXG4gICAgICAgIFxuICAgICAgY2FzZSBMZWFybmluZ1N0eWxlLkFVRElUT1JZOlxuICAgICAgICByZWNvbW1lbmRhdGlvbnMucHVzaChcIkV4cGxpY2FyIGNvbmNlcHRvcyBjb24gbGVuZ3VhamUgY29udmVyc2FjaW9uYWxcIilcbiAgICAgICAgcmVjb21tZW5kYXRpb25zLnB1c2goXCJVc2FyIGFuYWxvZ8OtYXMgeSBtZXTDoWZvcmFzIHZlcmJhbGVzXCIpXG4gICAgICAgIHJlY29tbWVuZGF0aW9ucy5wdXNoKFwiSW5jbHVpciBkaXNjdXNpb25lcyB5IHByZWd1bnRhcyBhYmllcnRhc1wiKVxuICAgICAgICBicmVha1xuICAgICAgICBcbiAgICAgIGNhc2UgTGVhcm5pbmdTdHlsZS5SRUFESU5HX1dSSVRJTkc6XG4gICAgICAgIHJlY29tbWVuZGF0aW9ucy5wdXNoKFwiUHJvcG9yY2lvbmFyIGluZm9ybWFjacOzbiBkZXRhbGxhZGEgcG9yIGVzY3JpdG9cIilcbiAgICAgICAgcmVjb21tZW5kYXRpb25zLnB1c2goXCJDcmVhciBsaXN0YXMgeSByZXPDum1lbmVzIGVzdHJ1Y3R1cmFkb3NcIilcbiAgICAgICAgcmVjb21tZW5kYXRpb25zLnB1c2goXCJJbmNsdWlyIGRlZmluaWNpb25lcyB5IGRlc2NyaXBjaW9uZXMgcHJlY2lzYXNcIilcbiAgICAgICAgYnJlYWtcbiAgICAgICAgXG4gICAgICBjYXNlIExlYXJuaW5nU3R5bGUuS0lORVNUSEVUSUM6XG4gICAgICAgIHJlY29tbWVuZGF0aW9ucy5wdXNoKFwiSW5jbHVpciBlamVyY2ljaW9zIHByw6FjdGljb3MgeSBhY3RpdmlkYWRlc1wiKVxuICAgICAgICByZWNvbW1lbmRhdGlvbnMucHVzaChcIlN1Z2VyaXIgZXhwZXJpbWVudG9zIHkgYXBsaWNhY2lvbmVzIHJlYWxlc1wiKVxuICAgICAgICByZWNvbW1lbmRhdGlvbnMucHVzaChcIlVzYXIgZWplbXBsb3MgY29uY3JldG9zIHkgbWFuaXB1bGFibGVzXCIpXG4gICAgICAgIGJyZWFrXG4gICAgICAgIFxuICAgICAgY2FzZSBMZWFybmluZ1N0eWxlLk1VTFRJTU9EQUw6XG4gICAgICAgIHJlY29tbWVuZGF0aW9ucy5wdXNoKFwiQ29tYmluYXIgbcO6bHRpcGxlcyBlbmZvcXVlcyBkZSBlbnNlw7FhbnphXCIpXG4gICAgICAgIHJlY29tbWVuZGF0aW9ucy5wdXNoKFwiQWRhcHRhciBleHBsaWNhY2lvbmVzIHNlZ8O6biBlbCBjb250ZXh0b1wiKVxuICAgICAgICByZWNvbW1lbmRhdGlvbnMucHVzaChcIk9mcmVjZXIgb3BjaW9uZXMgZGUgYXByZW5kaXphamUgdmFyaWFkYXNcIilcbiAgICAgICAgYnJlYWtcbiAgICB9XG4gICAgXG4gICAgcmV0dXJuIHJlY29tbWVuZGF0aW9uc1xuICB9XG59Il0sIm5hbWVzIjpbIkxlYXJuaW5nU3R5bGUiLCJBZHZhbmNlZExlYXJuaW5nUHJvZmlsZU1hbmFnZXIiLCJwcm9maWxlcyIsIk1hcCIsImJlaGF2aW9ycyIsImFuYWx5emVNZXNzYWdlRm9yTGVhcm5pbmdTdHlsZSIsIm1lc3NhZ2UiLCJ1c2VySWQiLCJtc2dMb3dlciIsInRvTG93ZXJDYXNlIiwiaW5kaWNhdG9ycyIsInZpc3VhbEtleXdvcmRzIiwidmlzdWFsUGhyYXNlcyIsInZpc3VhbFNjb3JlIiwiY2FsY3VsYXRlS2V5d29yZFNjb3JlIiwicHVzaCIsInN0eWxlIiwid2VpZ2h0IiwiZXZpZGVuY2UiLCJleHRyYWN0RXZpZGVuY2UiLCJjb25maWRlbmNlIiwiTWF0aCIsIm1pbiIsImF1ZGl0b3J5S2V5d29yZHMiLCJhdWRpdG9yeVBocmFzZXMiLCJhdWRpdG9yeVNjb3JlIiwicmVhZFdyaXRlS2V5d29yZHMiLCJyZWFkV3JpdGVQaHJhc2VzIiwicmVhZFdyaXRlU2NvcmUiLCJraW5lc3RoZXRpY0tleXdvcmRzIiwia2luZXN0aGV0aWNQaHJhc2VzIiwia2luZXN0aGV0aWNTY29yZSIsImxlbmd0aCIsInJlY29yZEJlaGF2aW9yUGF0dGVybiIsIm1hcCIsImkiLCJzb3J0IiwiYSIsImIiLCJ0ZXh0Iiwia2V5d29yZHMiLCJwaHJhc2VzIiwic2NvcmUiLCJrZXl3b3JkIiwiaW5jbHVkZXMiLCJwaHJhc2UiLCJwYXR0ZXJucyIsInBhdHRlcm4iLCJzZW50ZW5jZXMiLCJzcGxpdCIsIm1hdGNoaW5nU2VudGVuY2UiLCJmaW5kIiwic2VudGVuY2UiLCJ0cmltIiwic2xpY2UiLCJhY3Rpb24iLCJjb250ZXh0Iiwic3R5bGVJbmRpY2F0b3JzIiwidGltZXN0YW1wIiwiRGF0ZSIsInVzZXJCZWhhdmlvcnMiLCJmaWx0ZXIiLCJjb25jYXQiLCJ1cGRhdGVMZWFybmluZ1Byb2ZpbGUiLCJwcm9maWxlIiwiZ2V0IiwiY3JlYXRlSW5pdGlhbFByb2ZpbGUiLCJpbmRpY2F0b3IiLCJzdHlsZURpc3RyaWJ1dGlvbiIsInZpc3VhbCIsImF1ZGl0b3J5IiwicmVhZGluZ193cml0aW5nIiwia2luZXN0aGV0aWMiLCJ0b3RhbCIsInN0eWxlcyIsInByaW1hcnlTdHlsZSIsInNlY29uZGFyeVN0eWxlIiwidW5kZWZpbmVkIiwiYWRhcHRhdGlvblByZWZlcmVuY2VzIiwicHJlZmVyc0RpYWdyYW1zIiwicHJlZmVyc1N0ZXBCeVN0ZXAiLCJwcmVmZXJzRXhhbXBsZXMiLCJwcmVmZXJzSW50ZXJhY3Rpb24iLCJwcmVmZXJzVmlzdWFsQWlkcyIsInByZWZlcnNWZXJiYWxFeHBsYW5hdGlvbiIsImxhc3RVcGRhdGVkIiwiaW50ZXJhY3Rpb25zIiwic2V0IiwiY29uc29sZSIsImxvZyIsImRldGVjdGVkRnJvbSIsIm1lc3NhZ2VBbmFseXNpcyIsImJlaGF2aW9yUGF0dGVybnMiLCJleHBsaWNpdFByZWZlcmVuY2VzIiwiZ2V0TGVhcm5pbmdQcm9maWxlIiwiYWRhcHRSZXNwb25zZVRvTGVhcm5pbmdTdHlsZSIsImNvbnRlbnQiLCJhZGFwdGVkQ29udGVudCIsImFkZFZpc3VhbEVsZW1lbnRzIiwiYWRkQXVkaXRvcnlFbGVtZW50cyIsImFkZFN0cnVjdHVyZWRFbGVtZW50cyIsImFkZEludGVyYWN0aXZlRWxlbWVudHMiLCJlbmhhbmNlZCIsInJlcGxhY2UiLCJzIiwiaW5kZXgiLCJqb2luIiwiYW5hbHl6ZUJlaGF2aW9yUGF0dGVybnMiLCJyZWNlbnRCZWhhdmlvcnMiLCJzdHlsZUZyZXF1ZW5jeSIsImJlaGF2aW9yIiwiZnJlcXVlbmN5IiwiZW50cmllcyIsImdldFByb2ZpbGVTdGF0aXN0aWNzIiwiYmVoYXZpb3JDb3VudCIsInJlY2VudEludGVyYWN0aW9ucyIsIm5vdyIsInRvdGFsUHJvZmlsZXMiLCJzaXplIiwidG90YWxCZWhhdmlvcnMiLCJnZXRHbG9iYWxTdHlsZURpc3RyaWJ1dGlvbiIsImRpc3RyaWJ1dGlvbiIsIm11bHRpbW9kYWwiLCJ2YWx1ZXMiLCJwcm9jZXNzVXNlck1lc3NhZ2UiLCJnZW5lcmF0ZVN0eWxlUmVjb21tZW5kYXRpb25zIiwicmVjb21tZW5kYXRpb25zIl0sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/advanced-learning-profiles.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/ai-providers.ts":
/*!*********************************!*\
  !*** ./src/lib/ai-providers.ts ***!
  \*********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   AIProvider: () => (/* binding */ AIProvider),\n/* harmony export */   AIProviderFactory: () => (/* binding */ AIProviderFactory),\n/* harmony export */   AIService: () => (/* binding */ AIService),\n/* harmony export */   AI_CONFIG: () => (/* binding */ AI_CONFIG),\n/* harmony export */   BaseAIProvider: () => (/* binding */ BaseAIProvider),\n/* harmony export */   GoogleGeminiProvider: () => (/* binding */ GoogleGeminiProvider),\n/* harmony export */   GroqProvider: () => (/* binding */ GroqProvider),\n/* harmony export */   HuggingFaceProvider: () => (/* binding */ HuggingFaceProvider),\n/* harmony export */   OllamaProvider: () => (/* binding */ OllamaProvider),\n/* harmony export */   TemplateProvider: () => (/* binding */ TemplateProvider),\n/* harmony export */   TransformersJSProvider: () => (/* binding */ TransformersJSProvider),\n/* harmony export */   aiService: () => (/* binding */ aiService)\n/* harmony export */ });\n// AI Providers Configuration\n// Supports multiple AI providers with fallback system\nvar AIProvider = /*#__PURE__*/ function(AIProvider) {\n    AIProvider[\"GOOGLE_GEMINI\"] = \"google_gemini\";\n    AIProvider[\"GROQ\"] = \"groq\";\n    AIProvider[\"HUGGING_FACE\"] = \"huggingface\";\n    AIProvider[\"OLLAMA_LOCAL\"] = \"ollama_local\";\n    AIProvider[\"TRANSFORMERS_JS\"] = \"transformers_js\";\n    AIProvider[\"TEMPLATES_ONLY\"] = \"templates_only\";\n    return AIProvider;\n}({});\n// Default configuration - Groq first for ultra-fast responses\nconst AI_CONFIG = [\n    {\n        provider: \"groq\",\n        apiKey: process.env.GROQ_API_KEY,\n        baseUrl: 'https://api.groq.com/openai/v1',\n        model: 'llama-3.3-70b-versatile',\n        enabled: !!process.env.GROQ_API_KEY\n    },\n    {\n        provider: \"google_gemini\",\n        apiKey: process.env.GOOGLE_AI_API_KEY,\n        model: 'gemini-1.5-flash',\n        enabled: !!process.env.GOOGLE_AI_API_KEY\n    },\n    {\n        provider: \"huggingface\",\n        apiKey: process.env.HUGGING_FACE_API_KEY,\n        baseUrl: 'https://api-inference.huggingface.co/models',\n        model: 'microsoft/DialoGPT-large',\n        enabled: !!process.env.HUGGING_FACE_API_KEY\n    },\n    {\n        provider: \"ollama_local\",\n        baseUrl: process.env.OLLAMA_URL || 'http://localhost:11434',\n        model: process.env.OLLAMA_MODEL || 'llama3.1:8b',\n        enabled: process.env.OLLAMA_ENABLED === 'true'\n    },\n    {\n        provider: \"transformers_js\",\n        enabled: process.env.TRANSFORMERS_JS_ENABLED === 'true'\n    },\n    {\n        provider: \"templates_only\",\n        enabled: true // Always available as final fallback\n    }\n];\n// Abstract AI Provider Interface\nclass BaseAIProvider {\n    constructor(config){\n        this.config = config;\n    }\n}\n// Google Gemini Provider\nclass GoogleGeminiProvider extends BaseAIProvider {\n    async generateExercise(prompt) {\n        if (!this.config.apiKey) {\n            throw new Error('Google AI API key not configured');\n        }\n        const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/${this.config.model}:generateContent?key=${this.config.apiKey}`, {\n            method: 'POST',\n            headers: {\n                'Content-Type': 'application/json'\n            },\n            body: JSON.stringify({\n                contents: [\n                    {\n                        parts: [\n                            {\n                                text: prompt\n                            }\n                        ]\n                    }\n                ],\n                generationConfig: {\n                    temperature: 0.7,\n                    topK: 1,\n                    topP: 1,\n                    maxOutputTokens: 500\n                }\n            })\n        });\n        if (!response.ok) {\n            throw new Error(`Google AI API error: ${response.status}`);\n        }\n        const data = await response.json();\n        return data.candidates[0]?.content?.parts[0]?.text || 'Error generating content';\n    }\n    async isAvailable() {\n        return !!this.config.apiKey;\n    }\n}\n// Hugging Face Provider\nclass HuggingFaceProvider extends BaseAIProvider {\n    async generateExercise(prompt) {\n        if (!this.config.apiKey) {\n            throw new Error('Hugging Face API key not configured');\n        }\n        const response = await fetch(`${this.config.baseUrl}/${this.config.model}`, {\n            method: 'POST',\n            headers: {\n                'Authorization': `Bearer ${this.config.apiKey}`,\n                'Content-Type': 'application/json'\n            },\n            body: JSON.stringify({\n                inputs: prompt,\n                parameters: {\n                    max_new_tokens: 300,\n                    temperature: 0.7,\n                    return_full_text: false\n                }\n            })\n        });\n        if (!response.ok) {\n            throw new Error(`Hugging Face API error: ${response.status}`);\n        }\n        const data = await response.json();\n        return data[0]?.generated_text || 'Error generating content';\n    }\n    async isAvailable() {\n        return !!this.config.apiKey;\n    }\n}\n// Ollama Local Provider\nclass OllamaProvider extends BaseAIProvider {\n    async generateExercise(prompt) {\n        try {\n            const response = await fetch(`${this.config.baseUrl}/api/generate`, {\n                method: 'POST',\n                headers: {\n                    'Content-Type': 'application/json'\n                },\n                body: JSON.stringify({\n                    model: this.config.model,\n                    prompt: prompt,\n                    stream: false,\n                    options: {\n                        temperature: 0.7,\n                        num_predict: 300\n                    }\n                })\n            });\n            if (!response.ok) {\n                throw new Error(`Ollama API error: ${response.status}`);\n            }\n            const data = await response.json();\n            return data.response || 'Error generating content';\n        } catch (error) {\n            throw new Error(`Ollama connection failed: ${error}`);\n        }\n    }\n    async isAvailable() {\n        try {\n            const response = await fetch(`${this.config.baseUrl}/api/version`, {\n                method: 'GET',\n                signal: AbortSignal.timeout(3000) // 3 second timeout\n            });\n            return response.ok;\n        } catch  {\n            return false;\n        }\n    }\n}\n// Transformers.js Provider (Browser-based)\nclass TransformersJSProvider extends BaseAIProvider {\n    async generateExercise(prompt) {\n        if (!this.pipeline) {\n            const { pipeline } = await Promise.resolve(/*! import() */).then(__webpack_require__.bind(__webpack_require__, /*! @xenova/transformers */ \"@xenova/transformers\"));\n            this.pipeline = await pipeline('text-generation', 'Xenova/gpt2');\n        }\n        const result = await this.pipeline(prompt, {\n            max_new_tokens: 150,\n            temperature: 0.7\n        });\n        return result[0]?.generated_text?.replace(prompt, '').trim() || 'Error generating content';\n    }\n    async isAvailable() {\n        try {\n            await Promise.resolve(/*! import() */).then(__webpack_require__.bind(__webpack_require__, /*! @xenova/transformers */ \"@xenova/transformers\"));\n            return true;\n        } catch  {\n            return false;\n        }\n    }\n    constructor(...args){\n        super(...args), this.pipeline = null;\n    }\n}\n// Groq Provider\nclass GroqProvider extends BaseAIProvider {\n    async generateExercise(prompt) {\n        if (!this.config.apiKey) {\n            throw new Error('Groq API key not configured');\n        }\n        const response = await fetch(`${this.config.baseUrl}/chat/completions`, {\n            method: 'POST',\n            headers: {\n                'Authorization': `Bearer ${this.config.apiKey}`,\n                'Content-Type': 'application/json'\n            },\n            body: JSON.stringify({\n                model: this.config.model,\n                messages: [\n                    {\n                        role: 'system',\n                        content: 'Eres Sara, un asistente personal acad√©mico especializado en ayudar a estudiantes con organizaci√≥n, planificaci√≥n y aprendizaje. Responde de manera clara, pr√°ctica y motivacional.'\n                    },\n                    {\n                        role: 'user',\n                        content: prompt\n                    }\n                ],\n                temperature: 0.7,\n                max_tokens: 500,\n                top_p: 0.9\n            })\n        });\n        if (!response.ok) {\n            const errorData = await response.text();\n            throw new Error(`Groq API error (${response.status}): ${errorData}`);\n        }\n        const data = await response.json();\n        return data.choices[0]?.message?.content || 'Error generating content';\n    }\n    async isAvailable() {\n        if (!this.config.apiKey) return false;\n        try {\n            const response = await fetch(`${this.config.baseUrl}/models`, {\n                method: 'GET',\n                headers: {\n                    'Authorization': `Bearer ${this.config.apiKey}`\n                },\n                signal: AbortSignal.timeout(5000) // 5 second timeout\n            });\n            return response.ok;\n        } catch  {\n            return false;\n        }\n    }\n}\n// Template Provider (Always Available Fallback)\nclass TemplateProvider extends BaseAIProvider {\n    async generateExercise(prompt) {\n        // This will use the existing template system\n        return 'TEMPLATE_FALLBACK';\n    }\n    async isAvailable() {\n        return true;\n    }\n}\n// Provider Factory\nclass AIProviderFactory {\n    static createProvider(config) {\n        switch(config.provider){\n            case \"google_gemini\":\n                return new GoogleGeminiProvider(config);\n            case \"groq\":\n                return new GroqProvider(config);\n            case \"huggingface\":\n                return new HuggingFaceProvider(config);\n            case \"ollama_local\":\n                return new OllamaProvider(config);\n            case \"transformers_js\":\n                return new TransformersJSProvider(config);\n            case \"templates_only\":\n                return new TemplateProvider(config);\n            default:\n                throw new Error(`Unknown AI provider: ${config.provider}`);\n        }\n    }\n}\n// Main AI Service with Fallback System\nclass AIService {\n    constructor(){\n        this.providers = [];\n        this.currentProviderIndex = 0;\n        this.initializeProviders();\n    }\n    initializeProviders() {\n        this.providers = AI_CONFIG.filter((config)=>config.enabled).map((config)=>AIProviderFactory.createProvider(config));\n    }\n    async generateExercise(prompt) {\n        for(let i = this.currentProviderIndex; i < this.providers.length; i++){\n            const provider = this.providers[i];\n            try {\n                const isAvailable = await provider.isAvailable();\n                if (!isAvailable) {\n                    console.log(`Provider ${i} not available, trying next...`);\n                    continue;\n                }\n                const result = await provider.generateExercise(prompt);\n                if (result === 'TEMPLATE_FALLBACK') {\n                    return result // Special marker for template system\n                    ;\n                }\n                if (result && result.length > 10) {\n                    this.currentProviderIndex = i // Remember working provider\n                    ;\n                    return result;\n                }\n            } catch (error) {\n                console.error(`Provider ${i} failed:`, error);\n                continue;\n            }\n        }\n        // If all providers fail, return template fallback marker\n        return 'TEMPLATE_FALLBACK';\n    }\n    async getAvailableProviders() {\n        const available = [];\n        for(let i = 0; i < this.providers.length; i++){\n            try {\n                const isAvailable = await this.providers[i].isAvailable();\n                if (isAvailable) {\n                    available.push(AI_CONFIG[i].provider);\n                }\n            } catch  {\n            // Provider not available\n            }\n        }\n        return available;\n    }\n}\n// Export singleton instance\nconst aiService = new AIService();\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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RUFBRUQsSUFBSztZQUM5QyxJQUFJO2dCQUNGLE1BQU1yQyxjQUFjLE1BQU0sSUFBSSxDQUFDZ0MsU0FBUyxDQUFDSyxFQUFFLENBQUNyQyxXQUFXO2dCQUN2RCxJQUFJQSxhQUFhO29CQUNmMEMsVUFBVUMsSUFBSSxDQUFDdEYsU0FBUyxDQUFDZ0YsRUFBRSxDQUFDL0UsUUFBUTtnQkFDdEM7WUFDRixFQUFFLE9BQU07WUFDTix5QkFBeUI7WUFDM0I7UUFDRjtRQUNBLE9BQU9vRjtJQUNUO0FBQ0Y7QUFFQSw0QkFBNEI7QUFDckIsTUFBTUUsWUFBWSxJQUFJYixZQUFXIiwic291cmNlcyI6WyIvVXNlcnMvcm9kcmlnb2RpYmVybmFyZG8zM2dtYWlsLmNvbS9Eb2N1bWVudHMvQXBwIERldmVsb3BtZW50IFByb3llY3RzL0ludGVsbGVnbyBQbGF0Zm9ybS9zcmMvbGliL2FpLXByb3ZpZGVycy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBBSSBQcm92aWRlcnMgQ29uZmlndXJhdGlvblxuLy8gU3VwcG9ydHMgbXVsdGlwbGUgQUkgcHJvdmlkZXJzIHdpdGggZmFsbGJhY2sgc3lzdGVtXG5cbmV4cG9ydCBlbnVtIEFJUHJvdmlkZXIge1xuICBHT09HTEVfR0VNSU5JID0gJ2dvb2dsZV9nZW1pbmknLFxuICBHUk9RID0gJ2dyb3EnLFxuICBIVUdHSU5HX0ZBQ0UgPSAnaHVnZ2luZ2ZhY2UnLFxuICBPTExBTUFfTE9DQUwgPSAnb2xsYW1hX2xvY2FsJyxcbiAgVFJBTlNGT1JNRVJTX0pTID0gJ3RyYW5zZm9ybWVyc19qcycsXG4gIFRFTVBMQVRFU19PTkxZID0gJ3RlbXBsYXRlc19vbmx5J1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIEFJQ29uZmlnIHtcbiAgcHJvdmlkZXI6IEFJUHJvdmlkZXJcbiAgYXBpS2V5Pzogc3RyaW5nXG4gIGJhc2VVcmw/OiBzdHJpbmdcbiAgbW9kZWw/OiBzdHJpbmdcbiAgZW5hYmxlZDogYm9vbGVhblxufVxuXG4vLyBEZWZhdWx0IGNvbmZpZ3VyYXRpb24gLSBHcm9xIGZpcnN0IGZvciB1bHRyYS1mYXN0IHJlc3BvbnNlc1xuZXhwb3J0IGNvbnN0IEFJX0NPTkZJRzogQUlDb25maWdbXSA9IFtcbiAge1xuICAgIHByb3ZpZGVyOiBBSVByb3ZpZGVyLkdST1EsXG4gICAgYXBpS2V5OiBwcm9jZXNzLmVudi5HUk9RX0FQSV9LRVksXG4gICAgYmFzZVVybDogJ2h0dHBzOi8vYXBpLmdyb3EuY29tL29wZW5haS92MScsXG4gICAgbW9kZWw6ICdsbGFtYS0zLjMtNzBiLXZlcnNhdGlsZScsIC8vIFVsdHJhLWZhc3Q6IDI0OSB0b2tlbnMvc2VjXG4gICAgZW5hYmxlZDogISFwcm9jZXNzLmVudi5HUk9RX0FQSV9LRVlcbiAgfSxcbiAge1xuICAgIHByb3ZpZGVyOiBBSVByb3ZpZGVyLkdPT0dMRV9HRU1JTkksXG4gICAgYXBpS2V5OiBwcm9jZXNzLmVudi5HT09HTEVfQUlfQVBJX0tFWSxcbiAgICBtb2RlbDogJ2dlbWluaS0xLjUtZmxhc2gnLCAvLyBGcmVlIHRpZXIgbW9kZWwgLSBiYWNrdXBcbiAgICBlbmFibGVkOiAhIXByb2Nlc3MuZW52LkdPT0dMRV9BSV9BUElfS0VZXG4gIH0sXG4gIHtcbiAgICBwcm92aWRlcjogQUlQcm92aWRlci5IVUdHSU5HX0ZBQ0UsXG4gICAgYXBpS2V5OiBwcm9jZXNzLmVudi5IVUdHSU5HX0ZBQ0VfQVBJX0tFWSxcbiAgICBiYXNlVXJsOiAnaHR0cHM6Ly9hcGktaW5mZXJlbmNlLmh1Z2dpbmdmYWNlLmNvL21vZGVscycsXG4gICAgbW9kZWw6ICdtaWNyb3NvZnQvRGlhbG9HUFQtbGFyZ2UnLCAvLyBHb29kIGZvciBlZHVjYXRpb25hbCBjb250ZW50XG4gICAgZW5hYmxlZDogISFwcm9jZXNzLmVudi5IVUdHSU5HX0ZBQ0VfQVBJX0tFWVxuICB9LFxuICB7XG4gICAgcHJvdmlkZXI6IEFJUHJvdmlkZXIuT0xMQU1BX0xPQ0FMLFxuICAgIGJhc2VVcmw6IHByb2Nlc3MuZW52Lk9MTEFNQV9VUkwgfHwgJ2h0dHA6Ly9sb2NhbGhvc3Q6MTE0MzQnLFxuICAgIG1vZGVsOiBwcm9jZXNzLmVudi5PTExBTUFfTU9ERUwgfHwgJ2xsYW1hMy4xOjhiJyxcbiAgICBlbmFibGVkOiBwcm9jZXNzLmVudi5PTExBTUFfRU5BQkxFRCA9PT0gJ3RydWUnXG4gIH0sXG4gIHtcbiAgICBwcm92aWRlcjogQUlQcm92aWRlci5UUkFOU0ZPUk1FUlNfSlMsXG4gICAgZW5hYmxlZDogcHJvY2Vzcy5lbnYuVFJBTlNGT1JNRVJTX0pTX0VOQUJMRUQgPT09ICd0cnVlJ1xuICB9LFxuICB7XG4gICAgcHJvdmlkZXI6IEFJUHJvdmlkZXIuVEVNUExBVEVTX09OTFksXG4gICAgZW5hYmxlZDogdHJ1ZSAvLyBBbHdheXMgYXZhaWxhYmxlIGFzIGZpbmFsIGZhbGxiYWNrXG4gIH1cbl1cblxuLy8gQWJzdHJhY3QgQUkgUHJvdmlkZXIgSW50ZXJmYWNlXG5leHBvcnQgYWJzdHJhY3QgY2xhc3MgQmFzZUFJUHJvdmlkZXIge1xuICBwcm90ZWN0ZWQgY29uZmlnOiBBSUNvbmZpZ1xuXG4gIGNvbnN0cnVjdG9yKGNvbmZpZzogQUlDb25maWcpIHtcbiAgICB0aGlzLmNvbmZpZyA9IGNvbmZpZ1xuICB9XG5cbiAgYWJzdHJhY3QgZ2VuZXJhdGVFeGVyY2lzZShwcm9tcHQ6IHN0cmluZyk6IFByb21pc2U8c3RyaW5nPlxuICBhYnN0cmFjdCBpc0F2YWlsYWJsZSgpOiBQcm9taXNlPGJvb2xlYW4+XG59XG5cbi8vIEdvb2dsZSBHZW1pbmkgUHJvdmlkZXJcbmV4cG9ydCBjbGFzcyBHb29nbGVHZW1pbmlQcm92aWRlciBleHRlbmRzIEJhc2VBSVByb3ZpZGVyIHtcbiAgYXN5bmMgZ2VuZXJhdGVFeGVyY2lzZShwcm9tcHQ6IHN0cmluZyk6IFByb21pc2U8c3RyaW5nPiB7XG4gICAgaWYgKCF0aGlzLmNvbmZpZy5hcGlLZXkpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignR29vZ2xlIEFJIEFQSSBrZXkgbm90IGNvbmZpZ3VyZWQnKVxuICAgIH1cblxuICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2goYGh0dHBzOi8vZ2VuZXJhdGl2ZWxhbmd1YWdlLmdvb2dsZWFwaXMuY29tL3YxYmV0YS9tb2RlbHMvJHt0aGlzLmNvbmZpZy5tb2RlbH06Z2VuZXJhdGVDb250ZW50P2tleT0ke3RoaXMuY29uZmlnLmFwaUtleX1gLCB7XG4gICAgICBtZXRob2Q6ICdQT1NUJyxcbiAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJyxcbiAgICAgIH0sXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgIGNvbnRlbnRzOiBbe1xuICAgICAgICAgIHBhcnRzOiBbe1xuICAgICAgICAgICAgdGV4dDogcHJvbXB0XG4gICAgICAgICAgfV1cbiAgICAgICAgfV0sXG4gICAgICAgIGdlbmVyYXRpb25Db25maWc6IHtcbiAgICAgICAgICB0ZW1wZXJhdHVyZTogMC43LFxuICAgICAgICAgIHRvcEs6IDEsXG4gICAgICAgICAgdG9wUDogMSxcbiAgICAgICAgICBtYXhPdXRwdXRUb2tlbnM6IDUwMCxcbiAgICAgICAgfVxuICAgICAgfSlcbiAgICB9KVxuXG4gICAgaWYgKCFyZXNwb25zZS5vaykge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBHb29nbGUgQUkgQVBJIGVycm9yOiAke3Jlc3BvbnNlLnN0YXR1c31gKVxuICAgIH1cblxuICAgIGNvbnN0IGRhdGEgPSBhd2FpdCByZXNwb25zZS5qc29uKClcbiAgICByZXR1cm4gZGF0YS5jYW5kaWRhdGVzWzBdPy5jb250ZW50Py5wYXJ0c1swXT8udGV4dCB8fCAnRXJyb3IgZ2VuZXJhdGluZyBjb250ZW50J1xuICB9XG5cbiAgYXN5bmMgaXNBdmFpbGFibGUoKTogUHJvbWlzZTxib29sZWFuPiB7XG4gICAgcmV0dXJuICEhdGhpcy5jb25maWcuYXBpS2V5XG4gIH1cbn1cblxuLy8gSHVnZ2luZyBGYWNlIFByb3ZpZGVyXG5leHBvcnQgY2xhc3MgSHVnZ2luZ0ZhY2VQcm92aWRlciBleHRlbmRzIEJhc2VBSVByb3ZpZGVyIHtcbiAgYXN5bmMgZ2VuZXJhdGVFeGVyY2lzZShwcm9tcHQ6IHN0cmluZyk6IFByb21pc2U8c3RyaW5nPiB7XG4gICAgaWYgKCF0aGlzLmNvbmZpZy5hcGlLZXkpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignSHVnZ2luZyBGYWNlIEFQSSBrZXkgbm90IGNvbmZpZ3VyZWQnKVxuICAgIH1cblxuICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2goYCR7dGhpcy5jb25maWcuYmFzZVVybH0vJHt0aGlzLmNvbmZpZy5tb2RlbH1gLCB7XG4gICAgICBtZXRob2Q6ICdQT1NUJyxcbiAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgJ0F1dGhvcml6YXRpb24nOiBgQmVhcmVyICR7dGhpcy5jb25maWcuYXBpS2V5fWAsXG4gICAgICAgICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicsXG4gICAgICB9LFxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICBpbnB1dHM6IHByb21wdCxcbiAgICAgICAgcGFyYW1ldGVyczoge1xuICAgICAgICAgIG1heF9uZXdfdG9rZW5zOiAzMDAsXG4gICAgICAgICAgdGVtcGVyYXR1cmU6IDAuNyxcbiAgICAgICAgICByZXR1cm5fZnVsbF90ZXh0OiBmYWxzZVxuICAgICAgICB9XG4gICAgICB9KVxuICAgIH0pXG5cbiAgICBpZiAoIXJlc3BvbnNlLm9rKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYEh1Z2dpbmcgRmFjZSBBUEkgZXJyb3I6ICR7cmVzcG9uc2Uuc3RhdHVzfWApXG4gICAgfVxuXG4gICAgY29uc3QgZGF0YSA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKVxuICAgIHJldHVybiBkYXRhWzBdPy5nZW5lcmF0ZWRfdGV4dCB8fCAnRXJyb3IgZ2VuZXJhdGluZyBjb250ZW50J1xuICB9XG5cbiAgYXN5bmMgaXNBdmFpbGFibGUoKTogUHJvbWlzZTxib29sZWFuPiB7XG4gICAgcmV0dXJuICEhdGhpcy5jb25maWcuYXBpS2V5XG4gIH1cbn1cblxuLy8gT2xsYW1hIExvY2FsIFByb3ZpZGVyXG5leHBvcnQgY2xhc3MgT2xsYW1hUHJvdmlkZXIgZXh0ZW5kcyBCYXNlQUlQcm92aWRlciB7XG4gIGFzeW5jIGdlbmVyYXRlRXhlcmNpc2UocHJvbXB0OiBzdHJpbmcpOiBQcm9taXNlPHN0cmluZz4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKGAke3RoaXMuY29uZmlnLmJhc2VVcmx9L2FwaS9nZW5lcmF0ZWAsIHtcbiAgICAgICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nLFxuICAgICAgICB9LFxuICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgICAgbW9kZWw6IHRoaXMuY29uZmlnLm1vZGVsLFxuICAgICAgICAgIHByb21wdDogcHJvbXB0LFxuICAgICAgICAgIHN0cmVhbTogZmFsc2UsXG4gICAgICAgICAgb3B0aW9uczoge1xuICAgICAgICAgICAgdGVtcGVyYXR1cmU6IDAuNyxcbiAgICAgICAgICAgIG51bV9wcmVkaWN0OiAzMDBcbiAgICAgICAgICB9XG4gICAgICAgIH0pXG4gICAgICB9KVxuXG4gICAgICBpZiAoIXJlc3BvbnNlLm9rKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihgT2xsYW1hIEFQSSBlcnJvcjogJHtyZXNwb25zZS5zdGF0dXN9YClcbiAgICAgIH1cblxuICAgICAgY29uc3QgZGF0YSA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKVxuICAgICAgcmV0dXJuIGRhdGEucmVzcG9uc2UgfHwgJ0Vycm9yIGdlbmVyYXRpbmcgY29udGVudCdcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBPbGxhbWEgY29ubmVjdGlvbiBmYWlsZWQ6ICR7ZXJyb3J9YClcbiAgICB9XG4gIH1cblxuICBhc3luYyBpc0F2YWlsYWJsZSgpOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaChgJHt0aGlzLmNvbmZpZy5iYXNlVXJsfS9hcGkvdmVyc2lvbmAsIHtcbiAgICAgICAgbWV0aG9kOiAnR0VUJyxcbiAgICAgICAgc2lnbmFsOiBBYm9ydFNpZ25hbC50aW1lb3V0KDMwMDApIC8vIDMgc2Vjb25kIHRpbWVvdXRcbiAgICAgIH0pXG4gICAgICByZXR1cm4gcmVzcG9uc2Uub2tcbiAgICB9IGNhdGNoIHtcbiAgICAgIHJldHVybiBmYWxzZVxuICAgIH1cbiAgfVxufVxuXG4vLyBUcmFuc2Zvcm1lcnMuanMgUHJvdmlkZXIgKEJyb3dzZXItYmFzZWQpXG5leHBvcnQgY2xhc3MgVHJhbnNmb3JtZXJzSlNQcm92aWRlciBleHRlbmRzIEJhc2VBSVByb3ZpZGVyIHtcbiAgcHJpdmF0ZSBwaXBlbGluZTogYW55ID0gbnVsbFxuXG4gIGFzeW5jIGdlbmVyYXRlRXhlcmNpc2UocHJvbXB0OiBzdHJpbmcpOiBQcm9taXNlPHN0cmluZz4ge1xuICAgIGlmICghdGhpcy5waXBlbGluZSkge1xuICAgICAgY29uc3QgeyBwaXBlbGluZSB9ID0gYXdhaXQgaW1wb3J0KCdAeGVub3ZhL3RyYW5zZm9ybWVycycpXG4gICAgICB0aGlzLnBpcGVsaW5lID0gYXdhaXQgcGlwZWxpbmUoJ3RleHQtZ2VuZXJhdGlvbicsICdYZW5vdmEvZ3B0MicpXG4gICAgfVxuXG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5waXBlbGluZShwcm9tcHQsIHtcbiAgICAgIG1heF9uZXdfdG9rZW5zOiAxNTAsXG4gICAgICB0ZW1wZXJhdHVyZTogMC43XG4gICAgfSlcblxuICAgIHJldHVybiByZXN1bHRbMF0/LmdlbmVyYXRlZF90ZXh0Py5yZXBsYWNlKHByb21wdCwgJycpLnRyaW0oKSB8fCAnRXJyb3IgZ2VuZXJhdGluZyBjb250ZW50J1xuICB9XG5cbiAgYXN5bmMgaXNBdmFpbGFibGUoKTogUHJvbWlzZTxib29sZWFuPiB7XG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IGltcG9ydCgnQHhlbm92YS90cmFuc2Zvcm1lcnMnKVxuICAgICAgcmV0dXJuIHRydWVcbiAgICB9IGNhdGNoIHtcbiAgICAgIHJldHVybiBmYWxzZVxuICAgIH1cbiAgfVxufVxuXG4vLyBHcm9xIFByb3ZpZGVyXG5leHBvcnQgY2xhc3MgR3JvcVByb3ZpZGVyIGV4dGVuZHMgQmFzZUFJUHJvdmlkZXIge1xuICBhc3luYyBnZW5lcmF0ZUV4ZXJjaXNlKHByb21wdDogc3RyaW5nKTogUHJvbWlzZTxzdHJpbmc+IHtcbiAgICBpZiAoIXRoaXMuY29uZmlnLmFwaUtleSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdHcm9xIEFQSSBrZXkgbm90IGNvbmZpZ3VyZWQnKVxuICAgIH1cblxuICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2goYCR7dGhpcy5jb25maWcuYmFzZVVybH0vY2hhdC9jb21wbGV0aW9uc2AsIHtcbiAgICAgIG1ldGhvZDogJ1BPU1QnLFxuICAgICAgaGVhZGVyczoge1xuICAgICAgICAnQXV0aG9yaXphdGlvbic6IGBCZWFyZXIgJHt0aGlzLmNvbmZpZy5hcGlLZXl9YCxcbiAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJyxcbiAgICAgIH0sXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgIG1vZGVsOiB0aGlzLmNvbmZpZy5tb2RlbCxcbiAgICAgICAgbWVzc2FnZXM6IFtcbiAgICAgICAgICB7XG4gICAgICAgICAgICByb2xlOiAnc3lzdGVtJyxcbiAgICAgICAgICAgIGNvbnRlbnQ6ICdFcmVzIFNhcmEsIHVuIGFzaXN0ZW50ZSBwZXJzb25hbCBhY2Fkw6ltaWNvIGVzcGVjaWFsaXphZG8gZW4gYXl1ZGFyIGEgZXN0dWRpYW50ZXMgY29uIG9yZ2FuaXphY2nDs24sIHBsYW5pZmljYWNpw7NuIHkgYXByZW5kaXphamUuIFJlc3BvbmRlIGRlIG1hbmVyYSBjbGFyYSwgcHLDoWN0aWNhIHkgbW90aXZhY2lvbmFsLidcbiAgICAgICAgICB9LFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIHJvbGU6ICd1c2VyJyxcbiAgICAgICAgICAgIGNvbnRlbnQ6IHByb21wdFxuICAgICAgICAgIH1cbiAgICAgICAgXSxcbiAgICAgICAgdGVtcGVyYXR1cmU6IDAuNyxcbiAgICAgICAgbWF4X3Rva2VuczogNTAwLFxuICAgICAgICB0b3BfcDogMC45XG4gICAgICB9KVxuICAgIH0pXG5cbiAgICBpZiAoIXJlc3BvbnNlLm9rKSB7XG4gICAgICBjb25zdCBlcnJvckRhdGEgPSBhd2FpdCByZXNwb25zZS50ZXh0KClcbiAgICAgIHRocm93IG5ldyBFcnJvcihgR3JvcSBBUEkgZXJyb3IgKCR7cmVzcG9uc2Uuc3RhdHVzfSk6ICR7ZXJyb3JEYXRhfWApXG4gICAgfVxuXG4gICAgY29uc3QgZGF0YSA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKVxuICAgIHJldHVybiBkYXRhLmNob2ljZXNbMF0/Lm1lc3NhZ2U/LmNvbnRlbnQgfHwgJ0Vycm9yIGdlbmVyYXRpbmcgY29udGVudCdcbiAgfVxuXG4gIGFzeW5jIGlzQXZhaWxhYmxlKCk6IFByb21pc2U8Ym9vbGVhbj4ge1xuICAgIGlmICghdGhpcy5jb25maWcuYXBpS2V5KSByZXR1cm4gZmFsc2VcbiAgICBcbiAgICB0cnkge1xuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaChgJHt0aGlzLmNvbmZpZy5iYXNlVXJsfS9tb2RlbHNgLCB7XG4gICAgICAgIG1ldGhvZDogJ0dFVCcsXG4gICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICAnQXV0aG9yaXphdGlvbic6IGBCZWFyZXIgJHt0aGlzLmNvbmZpZy5hcGlLZXl9YCxcbiAgICAgICAgfSxcbiAgICAgICAgc2lnbmFsOiBBYm9ydFNpZ25hbC50aW1lb3V0KDUwMDApIC8vIDUgc2Vjb25kIHRpbWVvdXRcbiAgICAgIH0pXG4gICAgICByZXR1cm4gcmVzcG9uc2Uub2tcbiAgICB9IGNhdGNoIHtcbiAgICAgIHJldHVybiBmYWxzZVxuICAgIH1cbiAgfVxufVxuXG4vLyBUZW1wbGF0ZSBQcm92aWRlciAoQWx3YXlzIEF2YWlsYWJsZSBGYWxsYmFjaylcbmV4cG9ydCBjbGFzcyBUZW1wbGF0ZVByb3ZpZGVyIGV4dGVuZHMgQmFzZUFJUHJvdmlkZXIge1xuICBhc3luYyBnZW5lcmF0ZUV4ZXJjaXNlKHByb21wdDogc3RyaW5nKTogUHJvbWlzZTxzdHJpbmc+IHtcbiAgICAvLyBUaGlzIHdpbGwgdXNlIHRoZSBleGlzdGluZyB0ZW1wbGF0ZSBzeXN0ZW1cbiAgICByZXR1cm4gJ1RFTVBMQVRFX0ZBTExCQUNLJ1xuICB9XG5cbiAgYXN5bmMgaXNBdmFpbGFibGUoKTogUHJvbWlzZTxib29sZWFuPiB7XG4gICAgcmV0dXJuIHRydWVcbiAgfVxufVxuXG4vLyBQcm92aWRlciBGYWN0b3J5XG5leHBvcnQgY2xhc3MgQUlQcm92aWRlckZhY3Rvcnkge1xuICBzdGF0aWMgY3JlYXRlUHJvdmlkZXIoY29uZmlnOiBBSUNvbmZpZyk6IEJhc2VBSVByb3ZpZGVyIHtcbiAgICBzd2l0Y2ggKGNvbmZpZy5wcm92aWRlcikge1xuICAgICAgY2FzZSBBSVByb3ZpZGVyLkdPT0dMRV9HRU1JTkk6XG4gICAgICAgIHJldHVybiBuZXcgR29vZ2xlR2VtaW5pUHJvdmlkZXIoY29uZmlnKVxuICAgICAgY2FzZSBBSVByb3ZpZGVyLkdST1E6XG4gICAgICAgIHJldHVybiBuZXcgR3JvcVByb3ZpZGVyKGNvbmZpZylcbiAgICAgIGNhc2UgQUlQcm92aWRlci5IVUdHSU5HX0ZBQ0U6XG4gICAgICAgIHJldHVybiBuZXcgSHVnZ2luZ0ZhY2VQcm92aWRlcihjb25maWcpXG4gICAgICBjYXNlIEFJUHJvdmlkZXIuT0xMQU1BX0xPQ0FMOlxuICAgICAgICByZXR1cm4gbmV3IE9sbGFtYVByb3ZpZGVyKGNvbmZpZylcbiAgICAgIGNhc2UgQUlQcm92aWRlci5UUkFOU0ZPUk1FUlNfSlM6XG4gICAgICAgIHJldHVybiBuZXcgVHJhbnNmb3JtZXJzSlNQcm92aWRlcihjb25maWcpXG4gICAgICBjYXNlIEFJUHJvdmlkZXIuVEVNUExBVEVTX09OTFk6XG4gICAgICAgIHJldHVybiBuZXcgVGVtcGxhdGVQcm92aWRlcihjb25maWcpXG4gICAgICBkZWZhdWx0OlxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYFVua25vd24gQUkgcHJvdmlkZXI6ICR7Y29uZmlnLnByb3ZpZGVyfWApXG4gICAgfVxuICB9XG59XG5cbi8vIE1haW4gQUkgU2VydmljZSB3aXRoIEZhbGxiYWNrIFN5c3RlbVxuZXhwb3J0IGNsYXNzIEFJU2VydmljZSB7XG4gIHByaXZhdGUgcHJvdmlkZXJzOiBCYXNlQUlQcm92aWRlcltdID0gW11cbiAgcHJpdmF0ZSBjdXJyZW50UHJvdmlkZXJJbmRleCA9IDBcblxuICBjb25zdHJ1Y3RvcigpIHtcbiAgICB0aGlzLmluaXRpYWxpemVQcm92aWRlcnMoKVxuICB9XG5cbiAgcHJpdmF0ZSBpbml0aWFsaXplUHJvdmlkZXJzKCkge1xuICAgIHRoaXMucHJvdmlkZXJzID0gQUlfQ09ORklHXG4gICAgICAuZmlsdGVyKGNvbmZpZyA9PiBjb25maWcuZW5hYmxlZClcbiAgICAgIC5tYXAoY29uZmlnID0+IEFJUHJvdmlkZXJGYWN0b3J5LmNyZWF0ZVByb3ZpZGVyKGNvbmZpZykpXG4gIH1cblxuICBhc3luYyBnZW5lcmF0ZUV4ZXJjaXNlKHByb21wdDogc3RyaW5nKTogUHJvbWlzZTxzdHJpbmc+IHtcbiAgICBmb3IgKGxldCBpID0gdGhpcy5jdXJyZW50UHJvdmlkZXJJbmRleDsgaSA8IHRoaXMucHJvdmlkZXJzLmxlbmd0aDsgaSsrKSB7XG4gICAgICBjb25zdCBwcm92aWRlciA9IHRoaXMucHJvdmlkZXJzW2ldXG4gICAgICBcbiAgICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IGlzQXZhaWxhYmxlID0gYXdhaXQgcHJvdmlkZXIuaXNBdmFpbGFibGUoKVxuICAgICAgICBpZiAoIWlzQXZhaWxhYmxlKSB7XG4gICAgICAgICAgY29uc29sZS5sb2coYFByb3ZpZGVyICR7aX0gbm90IGF2YWlsYWJsZSwgdHJ5aW5nIG5leHQuLi5gKVxuICAgICAgICAgIGNvbnRpbnVlXG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBwcm92aWRlci5nZW5lcmF0ZUV4ZXJjaXNlKHByb21wdClcbiAgICAgICAgXG4gICAgICAgIGlmIChyZXN1bHQgPT09ICdURU1QTEFURV9GQUxMQkFDSycpIHtcbiAgICAgICAgICByZXR1cm4gcmVzdWx0IC8vIFNwZWNpYWwgbWFya2VyIGZvciB0ZW1wbGF0ZSBzeXN0ZW1cbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgaWYgKHJlc3VsdCAmJiByZXN1bHQubGVuZ3RoID4gMTApIHsgLy8gQmFzaWMgcXVhbGl0eSBjaGVja1xuICAgICAgICAgIHRoaXMuY3VycmVudFByb3ZpZGVySW5kZXggPSBpIC8vIFJlbWVtYmVyIHdvcmtpbmcgcHJvdmlkZXJcbiAgICAgICAgICByZXR1cm4gcmVzdWx0XG4gICAgICAgIH1cbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoYFByb3ZpZGVyICR7aX0gZmFpbGVkOmAsIGVycm9yKVxuICAgICAgICBjb250aW51ZVxuICAgICAgfVxuICAgIH1cblxuICAgIC8vIElmIGFsbCBwcm92aWRlcnMgZmFpbCwgcmV0dXJuIHRlbXBsYXRlIGZhbGxiYWNrIG1hcmtlclxuICAgIHJldHVybiAnVEVNUExBVEVfRkFMTEJBQ0snXG4gIH1cblxuICBhc3luYyBnZXRBdmFpbGFibGVQcm92aWRlcnMoKTogUHJvbWlzZTxzdHJpbmdbXT4ge1xuICAgIGNvbnN0IGF2YWlsYWJsZSA9IFtdXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLnByb3ZpZGVycy5sZW5ndGg7IGkrKykge1xuICAgICAgdHJ5IHtcbiAgICAgICAgY29uc3QgaXNBdmFpbGFibGUgPSBhd2FpdCB0aGlzLnByb3ZpZGVyc1tpXS5pc0F2YWlsYWJsZSgpXG4gICAgICAgIGlmIChpc0F2YWlsYWJsZSkge1xuICAgICAgICAgIGF2YWlsYWJsZS5wdXNoKEFJX0NPTkZJR1tpXS5wcm92aWRlcilcbiAgICAgICAgfVxuICAgICAgfSBjYXRjaCB7XG4gICAgICAgIC8vIFByb3ZpZGVyIG5vdCBhdmFpbGFibGVcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGF2YWlsYWJsZVxuICB9XG59XG5cbi8vIEV4cG9ydCBzaW5nbGV0b24gaW5zdGFuY2VcbmV4cG9ydCBjb25zdCBhaVNlcnZpY2UgPSBuZXcgQUlTZXJ2aWNlKCkiXSwibmFtZXMiOlsiQUlQcm92aWRlciIsIkFJX0NPTkZJRyIsInByb3ZpZGVyIiwiYXBpS2V5IiwicHJvY2VzcyIsImVudiIsIkdST1FfQVBJX0tFWSIsImJhc2VVcmwiLCJtb2RlbCIsImVuYWJsZWQiLCJHT09HTEVfQUlfQVBJX0tFWSIsIkhVR0dJTkdfRkFDRV9BUElfS0VZIiwiT0xMQU1BX1VSTCIsIk9MTEFNQV9NT0RFTCIsIk9MTEFNQV9FTkFCTEVEIiwiVFJBTlNGT1JNRVJTX0pTX0VOQUJMRUQiLCJCYXNlQUlQcm92aWRlciIsImNvbnN0cnVjdG9yIiwiY29uZmlnIiwiR29vZ2xlR2VtaW5pUHJvdmlkZXIiLCJnZW5lcmF0ZUV4ZXJjaXNlIiwicHJvbXB0IiwiRXJyb3IiLCJyZXNwb25zZSIsImZldGNoIiwibWV0aG9kIiwiaGVhZGVycyIsImJvZHkiLCJKU09OIiwic3RyaW5naWZ5IiwiY29udGVudHMiLCJwYXJ0cyIsInRleHQiLCJnZW5lcmF0aW9uQ29uZmlnIiwidGVtcGVyYXR1cmUiLCJ0b3BLIiwidG9wUCIsIm1heE91dHB1dFRva2VucyIsIm9rIiwic3RhdHVzIiwiZGF0YSIsImpzb24iLCJjYW5kaWRhdGVzIiwiY29udGVudCIsImlzQXZhaWxhYmxlIiwiSHVnZ2luZ0ZhY2VQcm92aWRlciIsImlucHV0cyIsInBhcmFtZXRlcnMiLCJtYXhfbmV3X3Rva2VucyIsInJldHVybl9mdWxsX3RleHQiLCJnZW5lcmF0ZWRfdGV4dCIsIk9sbGFtYVByb3ZpZGVyIiwic3RyZWFtIiwib3B0aW9ucyIsIm51bV9wcmVkaWN0IiwiZXJyb3IiLCJzaWduYWwiLCJBYm9ydFNpZ25hbCIsInRpbWVvdXQiLCJUcmFuc2Zvcm1lcnNKU1Byb3ZpZGVyIiwicGlwZWxpbmUiLCJyZXN1bHQiLCJyZXBsYWNlIiwidHJpbSIsIkdyb3FQcm92aWRlciIsIm1lc3NhZ2VzIiwicm9sZSIsIm1heF90b2tlbnMiLCJ0b3BfcCIsImVycm9yRGF0YSIsImNob2ljZXMiLCJtZXNzYWdlIiwiVGVtcGxhdGVQcm92aWRlciIsIkFJUHJvdmlkZXJGYWN0b3J5IiwiY3JlYXRlUHJvdmlkZXIiLCJBSVNlcnZpY2UiLCJwcm92aWRlcnMiLCJjdXJyZW50UHJvdmlkZXJJbmRleCIsImluaXRpYWxpemVQcm92aWRlcnMiLCJmaWx0ZXIiLCJtYXAiLCJpIiwibGVuZ3RoIiwiY29uc29sZSIsImxvZyIsImdldEF2YWlsYWJsZVByb3ZpZGVycyIsImF2YWlsYWJsZSIsInB1c2giLCJhaVNlcnZpY2UiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/ai-providers.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/auth.ts":
/*!*************************!*\
  !*** ./src/lib/auth.ts ***!
  \*************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   authOptions: () => (/* binding */ authOptions)\n/* harmony export */ });\n/* harmony import */ var next_auth_providers_credentials__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next-auth/providers/credentials */ \"(rsc)/./node_modules/next-auth/providers/credentials.js\");\n/* harmony import */ var bcryptjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! bcryptjs */ \"(rsc)/./node_modules/bcryptjs/index.js\");\n/* harmony import */ var _hybrid_storage__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./hybrid-storage */ \"(rsc)/./src/lib/hybrid-storage.ts\");\n\n\n\nconst authOptions = {\n    providers: [\n        (0,next_auth_providers_credentials__WEBPACK_IMPORTED_MODULE_0__[\"default\"])({\n            name: \"credentials\",\n            credentials: {\n                email: {\n                    label: \"Email\",\n                    type: \"email\"\n                },\n                password: {\n                    label: \"Password\",\n                    type: \"password\"\n                }\n            },\n            async authorize (credentials) {\n                if (!credentials?.email || !credentials?.password) {\n                    return null;\n                }\n                // Find user in database\n                const user = await (0,_hybrid_storage__WEBPACK_IMPORTED_MODULE_2__.findUserByEmail)(credentials.email);\n                if (!user || !user.password) {\n                    return null;\n                }\n                const isPasswordValid = await bcryptjs__WEBPACK_IMPORTED_MODULE_1__[\"default\"].compare(credentials.password, user.password);\n                if (!isPasswordValid) {\n                    return null;\n                }\n                return {\n                    id: user.id,\n                    email: user.email,\n                    name: user.name,\n                    role: user.role,\n                    studentId: user.studentId || undefined\n                };\n            }\n        })\n    ],\n    session: {\n        strategy: \"jwt\"\n    },\n    callbacks: {\n        async jwt ({ token, user }) {\n            if (user) {\n                token.role = user.role;\n                token.studentId = user.studentId;\n            }\n            return token;\n        },\n        async session ({ session, token }) {\n            if (token) {\n                session.user.id = token.sub;\n                session.user.role = token.role;\n                session.user.studentId = token.studentId;\n            }\n            return session;\n        },\n        async redirect ({ url, baseUrl }) {\n            // Handle internal redirects\n            if (url.startsWith(\"/\")) return `${baseUrl}${url}`;\n            else if (new URL(url).origin === baseUrl) return url;\n            // Default to home page for external redirects\n            return baseUrl;\n        },\n        async signIn ({ user, account, profile }) {\n            return true;\n        }\n    },\n    pages: {\n        signIn: \"/auth/signin\"\n    }\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvbGliL2F1dGgudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUNpRTtBQUNwQztBQUNxQjtBQUUzQyxNQUFNRyxjQUErQjtJQUMxQ0MsV0FBVztRQUNUSiwyRUFBbUJBLENBQUM7WUFDbEJLLE1BQU07WUFDTkMsYUFBYTtnQkFDWEMsT0FBTztvQkFBRUMsT0FBTztvQkFBU0MsTUFBTTtnQkFBUTtnQkFDdkNDLFVBQVU7b0JBQUVGLE9BQU87b0JBQVlDLE1BQU07Z0JBQVc7WUFDbEQ7WUFDQSxNQUFNRSxXQUFVTCxXQUFXO2dCQUN6QixJQUFJLENBQUNBLGFBQWFDLFNBQVMsQ0FBQ0QsYUFBYUksVUFBVTtvQkFDakQsT0FBTztnQkFDVDtnQkFFQSx3QkFBd0I7Z0JBQ3hCLE1BQU1FLE9BQU8sTUFBTVYsZ0VBQWVBLENBQUNJLFlBQVlDLEtBQUs7Z0JBRXBELElBQUksQ0FBQ0ssUUFBUSxDQUFDQSxLQUFLRixRQUFRLEVBQUU7b0JBQzNCLE9BQU87Z0JBQ1Q7Z0JBRUEsTUFBTUcsa0JBQWtCLE1BQU1aLHdEQUFjLENBQzFDSyxZQUFZSSxRQUFRLEVBQ3BCRSxLQUFLRixRQUFRO2dCQUdmLElBQUksQ0FBQ0csaUJBQWlCO29CQUNwQixPQUFPO2dCQUNUO2dCQUVBLE9BQU87b0JBQ0xFLElBQUlILEtBQUtHLEVBQUU7b0JBQ1hSLE9BQU9LLEtBQUtMLEtBQUs7b0JBQ2pCRixNQUFNTyxLQUFLUCxJQUFJO29CQUNmVyxNQUFNSixLQUFLSSxJQUFJO29CQUNmQyxXQUFXTCxLQUFLSyxTQUFTLElBQUlDO2dCQUMvQjtZQUNGO1FBQ0Y7S0FDRDtJQUNEQyxTQUFTO1FBQ1BDLFVBQVU7SUFDWjtJQUNBQyxXQUFXO1FBQ1QsTUFBTUMsS0FBSSxFQUFFQyxLQUFLLEVBQUVYLElBQUksRUFBRTtZQUN2QixJQUFJQSxNQUFNO2dCQUNSVyxNQUFNUCxJQUFJLEdBQUdKLEtBQUtJLElBQUk7Z0JBQ3RCTyxNQUFNTixTQUFTLEdBQUdMLEtBQUtLLFNBQVM7WUFDbEM7WUFDQSxPQUFPTTtRQUNUO1FBQ0EsTUFBTUosU0FBUSxFQUFFQSxPQUFPLEVBQUVJLEtBQUssRUFBRTtZQUM5QixJQUFJQSxPQUFPO2dCQUNUSixRQUFRUCxJQUFJLENBQUNHLEVBQUUsR0FBR1EsTUFBTUMsR0FBRztnQkFDM0JMLFFBQVFQLElBQUksQ0FBQ0ksSUFBSSxHQUFHTyxNQUFNUCxJQUFJO2dCQUM5QkcsUUFBUVAsSUFBSSxDQUFDSyxTQUFTLEdBQUdNLE1BQU1OLFNBQVM7WUFDMUM7WUFDQSxPQUFPRTtRQUNUO1FBQ0EsTUFBTU0sVUFBUyxFQUFFQyxHQUFHLEVBQUVDLE9BQU8sRUFBRTtZQUM3Qiw0QkFBNEI7WUFDNUIsSUFBSUQsSUFBSUUsVUFBVSxDQUFDLE1BQU0sT0FBTyxHQUFHRCxVQUFVRCxLQUFLO2lCQUM3QyxJQUFJLElBQUlHLElBQUlILEtBQUtJLE1BQU0sS0FBS0gsU0FBUyxPQUFPRDtZQUVqRCw4Q0FBOEM7WUFDOUMsT0FBT0M7UUFDVDtRQUNBLE1BQU1JLFFBQU8sRUFBRW5CLElBQUksRUFBRW9CLE9BQU8sRUFBRUMsT0FBTyxFQUFFO1lBQ3JDLE9BQU87UUFDVDtJQUNGO0lBQ0FDLE9BQU87UUFDTEgsUUFBUTtJQUNWO0FBQ0YsRUFBQyIsInNvdXJjZXMiOlsiL1VzZXJzL3JvZHJpZ29kaWJlcm5hcmRvMzNnbWFpbC5jb20vRG9jdW1lbnRzL0FwcCBEZXZlbG9wbWVudCBQcm95ZWN0cy9JbnRlbGxlZ28gUGxhdGZvcm0vc3JjL2xpYi9hdXRoLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IE5leHRBdXRoT3B0aW9ucyB9IGZyb20gXCJuZXh0LWF1dGhcIlxuaW1wb3J0IENyZWRlbnRpYWxzUHJvdmlkZXIgZnJvbSBcIm5leHQtYXV0aC9wcm92aWRlcnMvY3JlZGVudGlhbHNcIlxuaW1wb3J0IGJjcnlwdCBmcm9tIFwiYmNyeXB0anNcIlxuaW1wb3J0IHsgZmluZFVzZXJCeUVtYWlsIH0gZnJvbSBcIi4vaHlicmlkLXN0b3JhZ2VcIlxuXG5leHBvcnQgY29uc3QgYXV0aE9wdGlvbnM6IE5leHRBdXRoT3B0aW9ucyA9IHtcbiAgcHJvdmlkZXJzOiBbXG4gICAgQ3JlZGVudGlhbHNQcm92aWRlcih7XG4gICAgICBuYW1lOiBcImNyZWRlbnRpYWxzXCIsXG4gICAgICBjcmVkZW50aWFsczoge1xuICAgICAgICBlbWFpbDogeyBsYWJlbDogXCJFbWFpbFwiLCB0eXBlOiBcImVtYWlsXCIgfSxcbiAgICAgICAgcGFzc3dvcmQ6IHsgbGFiZWw6IFwiUGFzc3dvcmRcIiwgdHlwZTogXCJwYXNzd29yZFwiIH1cbiAgICAgIH0sXG4gICAgICBhc3luYyBhdXRob3JpemUoY3JlZGVudGlhbHMpIHtcbiAgICAgICAgaWYgKCFjcmVkZW50aWFscz8uZW1haWwgfHwgIWNyZWRlbnRpYWxzPy5wYXNzd29yZCkge1xuICAgICAgICAgIHJldHVybiBudWxsXG4gICAgICAgIH1cblxuICAgICAgICAvLyBGaW5kIHVzZXIgaW4gZGF0YWJhc2VcbiAgICAgICAgY29uc3QgdXNlciA9IGF3YWl0IGZpbmRVc2VyQnlFbWFpbChjcmVkZW50aWFscy5lbWFpbClcblxuICAgICAgICBpZiAoIXVzZXIgfHwgIXVzZXIucGFzc3dvcmQpIHtcbiAgICAgICAgICByZXR1cm4gbnVsbFxuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgaXNQYXNzd29yZFZhbGlkID0gYXdhaXQgYmNyeXB0LmNvbXBhcmUoXG4gICAgICAgICAgY3JlZGVudGlhbHMucGFzc3dvcmQsXG4gICAgICAgICAgdXNlci5wYXNzd29yZFxuICAgICAgICApXG5cbiAgICAgICAgaWYgKCFpc1Bhc3N3b3JkVmFsaWQpIHtcbiAgICAgICAgICByZXR1cm4gbnVsbFxuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBpZDogdXNlci5pZCxcbiAgICAgICAgICBlbWFpbDogdXNlci5lbWFpbCxcbiAgICAgICAgICBuYW1lOiB1c2VyLm5hbWUsXG4gICAgICAgICAgcm9sZTogdXNlci5yb2xlLFxuICAgICAgICAgIHN0dWRlbnRJZDogdXNlci5zdHVkZW50SWQgfHwgdW5kZWZpbmVkLFxuICAgICAgICB9XG4gICAgICB9XG4gICAgfSlcbiAgXSxcbiAgc2Vzc2lvbjoge1xuICAgIHN0cmF0ZWd5OiBcImp3dFwiLFxuICB9LFxuICBjYWxsYmFja3M6IHtcbiAgICBhc3luYyBqd3QoeyB0b2tlbiwgdXNlciB9KSB7XG4gICAgICBpZiAodXNlcikge1xuICAgICAgICB0b2tlbi5yb2xlID0gdXNlci5yb2xlXG4gICAgICAgIHRva2VuLnN0dWRlbnRJZCA9IHVzZXIuc3R1ZGVudElkXG4gICAgICB9XG4gICAgICByZXR1cm4gdG9rZW5cbiAgICB9LFxuICAgIGFzeW5jIHNlc3Npb24oeyBzZXNzaW9uLCB0b2tlbiB9KSB7XG4gICAgICBpZiAodG9rZW4pIHtcbiAgICAgICAgc2Vzc2lvbi51c2VyLmlkID0gdG9rZW4uc3ViIVxuICAgICAgICBzZXNzaW9uLnVzZXIucm9sZSA9IHRva2VuLnJvbGUgYXMgc3RyaW5nXG4gICAgICAgIHNlc3Npb24udXNlci5zdHVkZW50SWQgPSB0b2tlbi5zdHVkZW50SWQgYXMgc3RyaW5nXG4gICAgICB9XG4gICAgICByZXR1cm4gc2Vzc2lvblxuICAgIH0sXG4gICAgYXN5bmMgcmVkaXJlY3QoeyB1cmwsIGJhc2VVcmwgfSkge1xuICAgICAgLy8gSGFuZGxlIGludGVybmFsIHJlZGlyZWN0c1xuICAgICAgaWYgKHVybC5zdGFydHNXaXRoKFwiL1wiKSkgcmV0dXJuIGAke2Jhc2VVcmx9JHt1cmx9YFxuICAgICAgZWxzZSBpZiAobmV3IFVSTCh1cmwpLm9yaWdpbiA9PT0gYmFzZVVybCkgcmV0dXJuIHVybFxuICAgICAgXG4gICAgICAvLyBEZWZhdWx0IHRvIGhvbWUgcGFnZSBmb3IgZXh0ZXJuYWwgcmVkaXJlY3RzXG4gICAgICByZXR1cm4gYmFzZVVybFxuICAgIH0sXG4gICAgYXN5bmMgc2lnbkluKHsgdXNlciwgYWNjb3VudCwgcHJvZmlsZSB9KSB7XG4gICAgICByZXR1cm4gdHJ1ZVxuICAgIH1cbiAgfSxcbiAgcGFnZXM6IHtcbiAgICBzaWduSW46IFwiL2F1dGgvc2lnbmluXCIsXG4gIH0sXG59Il0sIm5hbWVzIjpbIkNyZWRlbnRpYWxzUHJvdmlkZXIiLCJiY3J5cHQiLCJmaW5kVXNlckJ5RW1haWwiLCJhdXRoT3B0aW9ucyIsInByb3ZpZGVycyIsIm5hbWUiLCJjcmVkZW50aWFscyIsImVtYWlsIiwibGFiZWwiLCJ0eXBlIiwicGFzc3dvcmQiLCJhdXRob3JpemUiLCJ1c2VyIiwiaXNQYXNzd29yZFZhbGlkIiwiY29tcGFyZSIsImlkIiwicm9sZSIsInN0dWRlbnRJZCIsInVuZGVmaW5lZCIsInNlc3Npb24iLCJzdHJhdGVneSIsImNhbGxiYWNrcyIsImp3dCIsInRva2VuIiwic3ViIiwicmVkaXJlY3QiLCJ1cmwiLCJiYXNlVXJsIiwic3RhcnRzV2l0aCIsIlVSTCIsIm9yaWdpbiIsInNpZ25JbiIsImFjY291bnQiLCJwcm9maWxlIiwicGFnZXMiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/auth.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/calendar-ai-integration.ts":
/*!********************************************!*\
  !*** ./src/lib/calendar-ai-integration.ts ***!
  \********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   AICalendarIntegration: () => (/* binding */ AICalendarIntegration),\n/* harmony export */   analyzeConversationForEvents: () => (/* binding */ analyzeConversationForEvents),\n/* harmony export */   convertSuggestionToCalendarEvent: () => (/* binding */ convertSuggestionToCalendarEvent),\n/* harmony export */   createEventFromAI: () => (/* binding */ createEventFromAI),\n/* harmony export */   deleteEventFromAI: () => (/* binding */ deleteEventFromAI),\n/* harmony export */   editEventFromAI: () => (/* binding */ editEventFromAI),\n/* harmony export */   findUserEvents: () => (/* binding */ findUserEvents),\n/* harmony export */   generateEventQuestions: () => (/* binding */ generateEventQuestions),\n/* harmony export */   generateEventSuggestionResponse: () => (/* binding */ generateEventSuggestionResponse)\n/* harmony export */ });\n/* harmony import */ var _calendar_data__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./calendar-data */ \"(rsc)/./src/lib/calendar-data.ts\");\n// Calendar AI Integration Service\n// Integra el sistema de IA tutora con el calendario para crear eventos autom√°ticamente\n\n/**\n * Analiza una conversaci√≥n con la IA para detectar menciones de eventos\n */ function analyzeConversationForEvents(conversationHistory) {\n    const userMessages = conversationHistory.filter((msg)=>msg.role === 'user').map((msg)=>msg.content).join(' ');\n    const analysis = {\n        hasEventMention: false,\n        eventSuggestions: [],\n        questions: [],\n        missingInfo: []\n    };\n    // An√°lisis m√°s inteligente del √∫ltimo mensaje del usuario\n    const lastUserMessage = conversationHistory.length > 0 ? conversationHistory[conversationHistory.length - 1]?.content || userMessages : userMessages;\n    const msgLower = lastUserMessage.toLowerCase();\n    // Detectar intenci√≥n de agendar/crear evento\n    const agendarPatterns = /agendes?|agend[a√°]|cre[ae]|programa|anot[ae]|agrega/i;\n    const isRequestingToSchedule = agendarPatterns.test(lastUserMessage);\n    // Detectar intenci√≥n de editar evento\n    const editarPatterns = /edit[ae]|modific[ae]|cambi[ae]|actualiz[ae]|reprograma/i;\n    const isRequestingToEdit = editarPatterns.test(lastUserMessage);\n    // Detectar intenci√≥n de eliminar evento\n    const eliminarPatterns = /elimin[ae]|borr[ae]|quit[ae]|cancel[ae]|suprimi/i;\n    const isRequestingToDelete = eliminarPatterns.test(lastUserMessage);\n    // Detectar menciones de ex√°menes con mejor parsing\n    if (/(examen|evaluaci[o√≥]n|parcial|final|prueba|test)/i.test(lastUserMessage)) {\n        const eventData = extractEventDataFromMessage(lastUserMessage, 'exam');\n        if (eventData.hasEvent) {\n            // Normalizar subject con acentos correctos\n            const normalizedSubject = normalizeSubjectName(eventData.subject);\n            analysis.eventSuggestions.push({\n                type: 'exam',\n                title: normalizedSubject ? `Examen de ${normalizedSubject}` : 'Examen',\n                subject: normalizedSubject,\n                date: eventData.date,\n                startTime: eventData.startTime,\n                duration: eventData.duration || 120,\n                location: eventData.location,\n                description: eventData.description,\n                priority: 'high',\n                confidence: 0.9\n            });\n            analysis.hasEventMention = true;\n        }\n    } else if (/(estudiar|repasar|preparar|practicar|sesi[o√≥]n.*estudio)/i.test(lastUserMessage)) {\n        const eventData = extractEventDataFromMessage(lastUserMessage, 'study_session');\n        if (eventData.hasEvent) {\n            // Normalizar subject con acentos correctos\n            const normalizedSubject = normalizeSubjectName(eventData.subject) || 'Revisi√≥n General';\n            analysis.eventSuggestions.push({\n                type: 'study_session',\n                title: `Sesi√≥n de Estudio - ${normalizedSubject}`,\n                subject: normalizedSubject,\n                date: eventData.date,\n                startTime: eventData.startTime,\n                duration: eventData.duration || 90,\n                location: eventData.location,\n                description: eventData.description,\n                priority: 'medium',\n                confidence: 0.8\n            });\n            analysis.hasEventMention = true;\n        }\n    }\n    // Solo generar preguntas para informaci√≥n realmente faltante\n    if (analysis.eventSuggestions.length > 0) {\n        const suggestion = analysis.eventSuggestions[0];\n        const questions = [];\n        const missingInfo = [];\n        if (!suggestion.date) {\n            questions.push(\"üìÖ ¬øPara qu√© fecha es?\");\n            missingInfo.push(\"fecha\");\n        }\n        if (!suggestion.startTime) {\n            questions.push(\"üïê ¬øA qu√© hora?\");\n            missingInfo.push(\"hora\");\n        }\n        if (suggestion.type === 'exam' && !suggestion.subject) {\n            questions.push(\"üìö ¬øDe qu√© materia es el examen?\");\n            missingInfo.push(\"materia\");\n        }\n        if (suggestion.type === 'exam' && !suggestion.location) {\n            questions.push(\"üìç ¬øEn qu√© aula ser√°?\");\n            missingInfo.push(\"ubicaci√≥n\");\n        }\n        // Solo agregar preguntas si realmente falta informaci√≥n\n        analysis.questions = questions;\n        analysis.missingInfo = missingInfo;\n    }\n    return analysis;\n}\n/**\n * Extrae datos espec√≠ficos del evento desde el mensaje\n */ function extractEventDataFromMessage(message, eventType) {\n    const msgLower = message.toLowerCase();\n    // Extraer materia de manera m√°s inteligente\n    let subject = null;\n    const subjectPatterns = [\n        /(?:examen|evaluaci[o√≥]n|parcial|final|prueba|test).*?(?:de|en)\\s+([a-z√°√©√≠√≥√∫√±]+)/i,\n        /([a-z√°√©√≠√≥√∫√±]+).*?(?:examen|evaluaci[o√≥]n|parcial|final|prueba|test)/i,\n        /(?:estudiar|repasar|preparar|practicar)\\s+([a-z√°√©√≠√≥√∫√±]+)/i,\n        /(?:sesi[o√≥]n.*?(?:de|en)\\s+([a-z√°√©√≠√≥√∫√±]+))/i\n    ];\n    for (const pattern of subjectPatterns){\n        const match = message.match(pattern);\n        if (match && match[1]) {\n            // Capitalizar primera letra\n            subject = match[1].charAt(0).toUpperCase() + match[1].slice(1).toLowerCase();\n            break;\n        }\n    }\n    // Extraer fecha de manera m√°s inteligente\n    let date = null;\n    let startTime = null;\n    // Detectar fechas espec√≠ficas (dd de mes, dd/mm, etc.)\n    const specificDatePatterns = [\n        /(\\d{1,2})\\s+de\\s+(enero|febrero|marzo|abril|mayo|junio|julio|agosto|septiembre|octubre|noviembre|diciembre)/i,\n        /(\\d{1,2})\\/(\\d{1,2})(?:\\/(\\d{2,4}))?/,\n        /(\\d{1,2})-(\\d{1,2})(?:-(\\d{2,4}))?/,\n        /el\\s+(\\d{1,2})/i\n    ];\n    for (const pattern of specificDatePatterns){\n        const match = message.match(pattern);\n        if (match) {\n            if (pattern.source.includes('de')) {\n                // \"10 de julio\"\n                const day = parseInt(match[1]);\n                const monthName = match[2].toLowerCase();\n                const monthMap = {\n                    'enero': 0,\n                    'febrero': 1,\n                    'marzo': 2,\n                    'abril': 3,\n                    'mayo': 4,\n                    'junio': 5,\n                    'julio': 6,\n                    'agosto': 7,\n                    'septiembre': 8,\n                    'octubre': 9,\n                    'noviembre': 10,\n                    'diciembre': 11\n                };\n                if (monthMap[monthName] !== undefined) {\n                    const now = new Date();\n                    const eventDate = new Date(now.getFullYear(), monthMap[monthName], day);\n                    date = eventDate.toISOString().split('T')[0];\n                }\n            } else if (match[1] && !isNaN(parseInt(match[1]))) {\n                // Formato dd/mm o dd-mm o \"el 10\"\n                const day = parseInt(match[1]);\n                const month = match[2] ? parseInt(match[2]) - 1 : new Date().getMonth();\n                const year = match[3] ? parseInt(match[3]) : new Date().getFullYear();\n                const eventDate = new Date(year, month, day);\n                date = eventDate.toISOString().split('T')[0];\n            }\n            break;\n        }\n    }\n    // Si no se encontr√≥ fecha espec√≠fica, buscar d√≠as relativos\n    if (!date) {\n        const relativeDatePatterns = [\n            {\n                pattern: /ma[√±n]ana/i,\n                days: 1\n            },\n            {\n                pattern: /hoy/i,\n                days: 0\n            },\n            {\n                pattern: /pasado.*ma[√±n]ana/i,\n                days: 2\n            },\n            {\n                pattern: /lunes/i,\n                targetDay: 1\n            },\n            {\n                pattern: /martes/i,\n                targetDay: 2\n            },\n            {\n                pattern: /mi[e√©]rcoles/i,\n                targetDay: 3\n            },\n            {\n                pattern: /jueves/i,\n                targetDay: 4\n            },\n            {\n                pattern: /viernes/i,\n                targetDay: 5\n            },\n            {\n                pattern: /s[a√°]bado/i,\n                targetDay: 6\n            },\n            {\n                pattern: /domingo/i,\n                targetDay: 0\n            }\n        ];\n        for (const { pattern, days, targetDay } of relativeDatePatterns){\n            if (pattern.test(message)) {\n                const now = new Date();\n                let eventDate;\n                if (days !== undefined) {\n                    eventDate = new Date(now.getTime() + days * 24 * 60 * 60 * 1000);\n                } else if (targetDay !== undefined) {\n                    const currentDay = now.getDay();\n                    let daysToAdd = targetDay - currentDay;\n                    if (daysToAdd <= 0) daysToAdd += 7 // Pr√≥xima semana\n                    ;\n                    eventDate = new Date(now.getTime() + daysToAdd * 24 * 60 * 60 * 1000);\n                } else {\n                    continue;\n                }\n                date = eventDate.toISOString().split('T')[0];\n                break;\n            }\n        }\n    }\n    // Extraer hora de manera m√°s inteligente\n    const timePatterns = [\n        /(?:a\\s+las?\\s+)?(\\d{1,2})(?::(\\d{2}))?\\s*(am|pm|a\\.?m\\.?|p\\.?m\\.?)/i,\n        /(?:a\\s+las?\\s+)?(\\d{1,2})(?::(\\d{2}))?\\s*h(?:oras?)?/i,\n        /(\\d{1,2})(?::(\\d{2}))?\\s*(?:de\\s+la\\s+)?(ma[√±n]ana|tarde|noche)/i\n    ];\n    for (const pattern of timePatterns){\n        const match = message.match(pattern);\n        if (match) {\n            let hour = parseInt(match[1]);\n            const minute = match[2] ? parseInt(match[2]) : 0;\n            const period = match[3]?.toLowerCase();\n            // Convertir a formato 24h\n            if (period) {\n                if ((period.includes('pm') || period.includes('p.m') || period === 'tarde' || period === 'noche') && hour < 12) {\n                    hour += 12;\n                } else if ((period.includes('am') || period.includes('a.m') || period === 'ma[√±n]ana') && hour === 12) {\n                    hour = 0;\n                } else if (period === 'noche' && hour < 6) {\n                    hour += 12 // Para casos como \"3 de la noche\" = 15:00\n                    ;\n                }\n            }\n            startTime = `${hour.toString().padStart(2, '0')}:${minute.toString().padStart(2, '0')}`;\n            break;\n        }\n    }\n    // Extraer ubicaci√≥n\n    let location = null;\n    const locationPatterns = [\n        /(?:en\\s+el?\\s+)?(aula|laboratorio|sala|auditorio)\\s+([a-zA-Z0-9]+)/i,\n        /(?:en\\s+)([a-zA-Z\\s]+(?:aula|laboratorio|sala|auditorio)[a-zA-Z0-9\\s]*)/i\n    ];\n    for (const pattern of locationPatterns){\n        const match = message.match(pattern);\n        if (match) {\n            location = match[0].replace(/^en\\s+/i, '').trim();\n            break;\n        }\n    }\n    // Extraer duraci√≥n\n    let duration = null;\n    const durationMatch = message.match(/(?:durante\\s+)?(\\d+)\\s*(horas?|minutos?|min)/i);\n    if (durationMatch) {\n        const value = parseInt(durationMatch[1]);\n        const unit = durationMatch[2].toLowerCase();\n        duration = unit.includes('hora') ? value * 60 : value;\n    }\n    // Extraer descripci√≥n/tema espec√≠fico si se menciona\n    let description = null;\n    const topicPatterns = [\n        /(?:sobre|tema|temas?)\\s+([a-z√°√©√≠√≥√∫√±\\s]+?)(?:\\s+para|\\s+el|\\s+a|$)/i,\n        /(?:sobre)\\s+el\\s+tema\\s+([a-z√°√©√≠√≥√∫√±\\s]+?)(?:\\s+para|\\s+el|\\s+a|$)/i\n    ];\n    for (const pattern of topicPatterns){\n        const match = message.match(pattern);\n        if (match && match[1] && match[1].trim().length > 3) {\n            description = match[1].trim();\n            break;\n        }\n    }\n    return {\n        hasEvent: true,\n        subject,\n        date,\n        startTime,\n        location,\n        duration,\n        description\n    };\n}\n/**\n * Genera preguntas para completar la informaci√≥n de un evento\n */ function generateEventQuestions(suggestion) {\n    const questions = [];\n    if (!suggestion.date) {\n        questions.push(\"üìÖ ¬øPara qu√© fecha es?\");\n    }\n    if (!suggestion.startTime) {\n        questions.push(\"üïê ¬øA qu√© hora?\");\n    }\n    if (suggestion.type === 'exam') {\n        if (!suggestion.subject) {\n            questions.push(\"üìö ¬øDe qu√© materia es el examen?\");\n        }\n        if (!suggestion.location) {\n            questions.push(\"üìç ¬øEn qu√© aula o laboratorio ser√°?\");\n        }\n        if (!suggestion.duration) {\n            questions.push(\"‚è±Ô∏è ¬øCu√°nto tiempo durar√°?\");\n        }\n    }\n    if (suggestion.type === 'study_session') {\n        if (!suggestion.subject) {\n            questions.push(\"üìñ ¬øQu√© tema vas a estudiar?\");\n        }\n        if (!suggestion.duration) {\n            questions.push(\"‚è∞ ¬øCu√°ntas horas planeas estudiar?\");\n        }\n    }\n    if (suggestion.type === 'personal' || suggestion.type === 'extracurricular') {\n        if (!suggestion.location) {\n            questions.push(\"üìç ¬øD√≥nde ser√°?\");\n        }\n    }\n    return questions;\n}\n/**\n * Convierte una sugerencia de evento en un evento de calendario\n */ function convertSuggestionToCalendarEvent(suggestion, userId, additionalInfo) {\n    const merged = {\n        ...suggestion,\n        ...additionalInfo\n    };\n    // Procesar fecha\n    let eventDate = new Date();\n    if (merged.date) {\n        eventDate = parseDateFromText(merged.date);\n    }\n    // Procesar hora\n    let startTime = merged.startTime || '15:00';\n    let endTime = merged.startTime || '16:00';\n    if (merged.duration && merged.startTime) {\n        const start = new Date(`2000-01-01T${merged.startTime}:00`);\n        const end = new Date(start.getTime() + merged.duration * 60000);\n        endTime = end.toTimeString().substring(0, 5);\n    }\n    const event = {\n        id: `ai-event-${Date.now()}`,\n        title: merged.title,\n        date: eventDate,\n        startTime: startTime,\n        endTime: endTime,\n        type: merged.type,\n        color: (0,_calendar_data__WEBPACK_IMPORTED_MODULE_0__.getEventTypeColor)(merged.type),\n        subject: merged.subject,\n        location: merged.location,\n        description: merged.description || 'Creado autom√°ticamente por IA Tutora',\n        priority: merged.priority || 'medium',\n        duration: merged.duration || 60\n    };\n    return event;\n}\n/**\n * Crea un evento autom√°ticamente desde la IA usando el API endpoint dedicado\n */ async function createEventFromAI(suggestion, userId, additionalInfo) {\n    try {\n        const merged = {\n            ...suggestion,\n            ...additionalInfo\n        };\n        // Procesar fecha\n        let eventDate = new Date();\n        if (merged.date) {\n            eventDate = parseDateFromText(merged.date);\n        }\n        // Calcular endTime basado en duration y startTime\n        let endTime = merged.startTime || '16:00';\n        if (merged.duration && merged.startTime) {\n            const start = new Date(`2000-01-01T${merged.startTime}:00`);\n            const end = new Date(start.getTime() + merged.duration * 60000);\n            endTime = end.toTimeString().substring(0, 5);\n        }\n        const eventData = {\n            title: merged.title,\n            type: merged.type,\n            subject: merged.subject,\n            date: eventDate.toISOString(),\n            startTime: merged.startTime || '15:00',\n            endTime: endTime,\n            duration: merged.duration || 60,\n            location: merged.location,\n            description: merged.description || `Creado autom√°ticamente por IA Tutora`,\n            priority: merged.priority || 'medium'\n        };\n        // For server-side execution, call the function directly instead of HTTP fetch\n        try {\n            const { createCalendarEvent } = __webpack_require__(/*! ../app/api/ai-calendar/create-event/route */ \"(rsc)/./src/app/api/ai-calendar/create-event/route.ts\");\n            const mockRequest = {\n                json: async ()=>eventData\n            };\n            const response1 = await createCalendarEvent(mockRequest);\n            const result = await response1.json();\n            return {\n                success: result.success,\n                event: result.event,\n                message: result.message\n            };\n        } catch (directCallError) {\n            console.log('Direct API call failed, trying alternative approach:', directCallError);\n            // Alternative: Use calendar-data functions directly\n            const { addCalendarEvent, getUserCalendarData, createUserCalendarData } = __webpack_require__(/*! ./calendar-data */ \"(rsc)/./src/lib/calendar-data.ts\");\n            // Ensure user has calendar data\n            let userData = getUserCalendarData(userId);\n            if (!userData) {\n                console.log(`üÜï Creating calendar data for user ${userId}`);\n                userData = createUserCalendarData(userId);\n            }\n            const calendarEvent = {\n                id: `ai-event-${Date.now()}`,\n                title: eventData.title,\n                date: new Date(eventData.date),\n                startTime: eventData.startTime,\n                endTime: eventData.endTime,\n                type: eventData.type,\n                color: '#3B82F6',\n                subject: eventData.subject,\n                location: eventData.location,\n                description: eventData.description,\n                priority: eventData.priority,\n                duration: eventData.duration\n            };\n            console.log(`üìÖ Creating event: ${calendarEvent.title} for ${eventData.date} at ${eventData.startTime}`);\n            const success = addCalendarEvent(userId, calendarEvent);\n            return {\n                success,\n                event: success ? calendarEvent : undefined,\n                message: success ? 'Evento creado exitosamente' : 'Error al crear evento'\n            };\n        }\n        const result = await response.json();\n        if (result.success) {\n            console.log(`ü§ñ IA confirm√≥ creaci√≥n: ${result.event.title}`);\n            // Disparar evento del lado del cliente para notificar componentes\n            if (false) {}\n            return {\n                success: true,\n                event: result.event,\n                message: result.message\n            };\n        } else {\n            console.error('‚ùå IA fall√≥ al crear evento:', result.error);\n            return {\n                success: false,\n                message: result.error || 'Error desconocido'\n            };\n        }\n    } catch (error) {\n        console.error('‚ùå Error in AI event creation:', error);\n        return {\n            success: false,\n            message: 'Error de conexi√≥n al crear evento'\n        };\n    }\n}\n/**\n * Parsea fechas desde texto natural\n */ function parseDateFromText(dateText) {\n    const text = dateText.toLowerCase();\n    const today = new Date();\n    if (text.includes('hoy')) {\n        return today;\n    }\n    if (text.includes('ma√±ana') || text.includes('ma[√±n]ana')) {\n        const tomorrow = new Date(today);\n        tomorrow.setDate(today.getDate() + 1);\n        return tomorrow;\n    }\n    if (text.includes('pasado')) {\n        const dayAfterTomorrow = new Date(today);\n        dayAfterTomorrow.setDate(today.getDate() + 2);\n        return dayAfterTomorrow;\n    }\n    // D√≠as de la semana\n    const dayMap = {\n        'lunes': 1,\n        'martes': 2,\n        'mi√©rcoles': 3,\n        'miercoles': 3,\n        'jueves': 4,\n        'viernes': 5,\n        's√°bado': 6,\n        'sabado': 6,\n        'domingo': 0\n    };\n    for (const [dayName, dayNumber] of Object.entries(dayMap)){\n        if (text.includes(dayName)) {\n            const targetDate = new Date(today);\n            const currentDay = today.getDay();\n            let daysToAdd = dayNumber - currentDay;\n            if (daysToAdd <= 0) {\n                daysToAdd += 7 // Pr√≥xima semana\n                ;\n            }\n            targetDate.setDate(today.getDate() + daysToAdd);\n            return targetDate;\n        }\n    }\n    // Si incluye n√∫meros (ej: \"en 3 d√≠as\")\n    const daysMatch = text.match(/en\\s+(\\d+)\\s+d[i√≠]as?/);\n    if (daysMatch) {\n        const days = parseInt(daysMatch[1]);\n        const futureDate = new Date(today);\n        futureDate.setDate(today.getDate() + days);\n        return futureDate;\n    }\n    // Por defecto, devolver ma√±ana\n    const defaultDate = new Date(today);\n    defaultDate.setDate(today.getDate() + 1);\n    return defaultDate;\n}\n/**\n * Genera respuesta de la IA para sugerir crear eventos\n */ function generateEventSuggestionResponse(analysis) {\n    if (!analysis.hasEventMention || analysis.eventSuggestions.length === 0) {\n        return \"\";\n    }\n    const suggestion = analysis.eventSuggestions[0] // Tomar la primera sugerencia\n    ;\n    let response1 = `üìÖ Perfecto! Veo que quieres agendar: **${suggestion.title}**\\n\\n`;\n    // Mostrar informaci√≥n detectada\n    const detectedInfo = [];\n    if (suggestion.subject) detectedInfo.push(`üìö Materia: ${suggestion.subject}`);\n    if (suggestion.date) {\n        const dateObj = new Date(suggestion.date);\n        const formattedDate = dateObj.toLocaleDateString('es-ES', {\n            weekday: 'long',\n            day: 'numeric',\n            month: 'long'\n        });\n        detectedInfo.push(`üìÖ Fecha: ${formattedDate}`);\n    }\n    if (suggestion.startTime) detectedInfo.push(`üïê Hora: ${suggestion.startTime}`);\n    if (suggestion.location) detectedInfo.push(`üìç Ubicaci√≥n: ${suggestion.location}`);\n    if (detectedInfo.length > 0) {\n        response1 += `**Informaci√≥n detectada:**\\n${detectedInfo.join('\\n')}\\n\\n`;\n    }\n    if (analysis.questions.length > 0) {\n        response1 += `Para completar el evento necesito:\\n`;\n        analysis.questions.forEach((question, index)=>{\n            response1 += `${index + 1}. ${question}\\n`;\n        });\n        response1 += `\\n¬øPodr√≠as darme estos detalles?`;\n    } else {\n        response1 += `¬°Tengo toda la informaci√≥n necesaria! ¬øConfirmas que lo agregue a tu calendario?`;\n    }\n    return response1;\n}\n/**\n * Interfaz para el workflow completo de creaci√≥n de eventos por IA\n */ class AICalendarIntegration {\n    constructor(userId){\n        this.pendingSuggestion = null;\n        this.collectedInfo = {};\n        this.userId = userId;\n    }\n    /**\n   * Procesa un mensaje del usuario y detecta si necesita crear eventos\n   */ async processMessage(message, conversationHistory) {\n        const analysis = analyzeConversationForEvents([\n            ...conversationHistory,\n            {\n                role: 'user',\n                content: message\n            }\n        ]);\n        if (analysis.hasEventMention && analysis.eventSuggestions.length > 0) {\n            this.pendingSuggestion = analysis.eventSuggestions[0];\n            if (analysis.questions.length > 0) {\n                return {\n                    needsEventCreation: true,\n                    response: generateEventSuggestionResponse(analysis),\n                    questions: analysis.questions\n                };\n            } else {\n                // Informaci√≥n completa, crear evento directamente\n                const result = await this.createPendingEvent();\n                return {\n                    needsEventCreation: true,\n                    response: result.success ? this.generateSuccessMessage(result.event) : `‚ùå ${result.message || 'Hubo un error al crear el evento. Por favor intenta nuevamente.'}`,\n                    event: result.event\n                };\n            }\n        }\n        return {\n            needsEventCreation: false\n        };\n    }\n    /**\n   * Recopila informaci√≥n adicional del usuario\n   */ collectAdditionalInfo(infoType, value) {\n        if (!this.pendingSuggestion) return false;\n        switch(infoType.toLowerCase()){\n            case 'fecha':\n                this.collectedInfo.date = value;\n                break;\n            case 'hora':\n                this.collectedInfo.startTime = value;\n                break;\n            case 'materia':\n            case 'tema':\n                this.collectedInfo.subject = value;\n                break;\n            case 'ubicaci√≥n':\n            case 'ubicacion':\n                this.collectedInfo.location = value;\n                break;\n            case 'duraci√≥n':\n            case 'duracion':\n                this.collectedInfo.duration = parseInt(value);\n                break;\n        }\n        return true;\n    }\n    /**\n   * Crea el evento pendiente con la informaci√≥n recopilada\n   */ async createPendingEvent() {\n        if (!this.pendingSuggestion) {\n            return {\n                success: false,\n                message: 'No hay evento pendiente'\n            };\n        }\n        const result = await createEventFromAI(this.pendingSuggestion, this.userId, this.collectedInfo);\n        if (result.success) {\n            this.pendingSuggestion = null;\n            this.collectedInfo = {};\n        }\n        return result;\n    }\n    /**\n   * Cancela la creaci√≥n del evento pendiente\n   */ cancelPendingEvent() {\n        this.pendingSuggestion = null;\n        this.collectedInfo = {};\n    }\n    /**\n   * Obtiene la sugerencia pendiente\n   */ getPendingSuggestion() {\n        return this.pendingSuggestion;\n    }\n    /**\n   * Genera mensaje de √©xito con detalles del evento creado\n   */ generateSuccessMessage(event) {\n        let message = `‚úÖ ¬°Perfecto! He creado \"${event.title}\" en tu calendario.`;\n        // Agregar detalles espec√≠ficos\n        const details = [];\n        if (event.date) {\n            const dateStr = event.date.toLocaleDateString('es-ES', {\n                weekday: 'long',\n                day: 'numeric',\n                month: 'long'\n            });\n            details.push(`üìÖ **Fecha**: ${dateStr}`);\n        }\n        if (event.startTime) {\n            details.push(`üïê **Hora**: ${event.startTime}`);\n        }\n        if (event.location) {\n            details.push(`üìç **Ubicaci√≥n**: ${event.location}`);\n        }\n        if (event.subject && event.type === 'exam') {\n            details.push(`üìö **Materia**: ${event.subject}`);\n        }\n        if (event.description && !event.description.includes('Creado autom√°ticamente')) {\n            details.push(`üìù **Tema**: ${event.description}`);\n        }\n        if (details.length > 0) {\n            message += `\\n\\n**Detalles del evento:**\\n${details.join('\\n')}`;\n        }\n        message += `\\n\\nüéØ Puedes ver todos tus eventos en la secci√≥n \"Organizador Inteligente\" de tu calendario.`;\n        return message;\n    }\n}\n/**\n * Busca eventos del usuario por texto de b√∫squeda\n */ function findUserEvents(userId, searchText) {\n    const userData = (0,_calendar_data__WEBPACK_IMPORTED_MODULE_0__.getUserCalendarData)(userId);\n    if (!userData) return [];\n    const search = searchText.toLowerCase();\n    return userData.events.filter((event)=>{\n        return event.title.toLowerCase().includes(search) || event.subject?.toLowerCase().includes(search) || event.description?.toLowerCase().includes(search) || event.location?.toLowerCase().includes(search);\n    });\n}\n/**\n * Edita un evento usando el API endpoint\n */ async function editEventFromAI(eventId, updates) {\n    try {\n        // For server-side execution, call the function directly\n        try {\n            const { updateCalendarEvent } = __webpack_require__(/*! ./calendar-data */ \"(rsc)/./src/lib/calendar-data.ts\");\n            const success = updateCalendarEvent(eventId, updates);\n            return {\n                success,\n                event: success ? {\n                    id: eventId,\n                    ...updates\n                } : undefined,\n                message: success ? 'Evento actualizado exitosamente' : 'Error al actualizar evento'\n            };\n        } catch (error) {\n            console.error('Error updating event:', error);\n            return {\n                success: false,\n                message: 'Error al actualizar evento'\n            };\n        }\n        const result = await response.json();\n        if (result.success) {\n            console.log(`ü§ñ IA edit√≥ evento: ${result.event.title}`);\n            // Disparar evento del lado del cliente\n            if (false) {}\n            return {\n                success: true,\n                event: result.event,\n                message: result.message\n            };\n        } else {\n            return {\n                success: false,\n                message: result.error || 'Error desconocido al editar'\n            };\n        }\n    } catch (error) {\n        console.error('‚ùå Error editing event from AI:', error);\n        return {\n            success: false,\n            message: 'Error de conexi√≥n al editar evento'\n        };\n    }\n}\n/**\n * Elimina un evento usando el API endpoint\n */ async function deleteEventFromAI(eventId) {\n    try {\n        // For server-side execution, call the function directly\n        try {\n            const { deleteCalendarEvent } = __webpack_require__(/*! ./calendar-data */ \"(rsc)/./src/lib/calendar-data.ts\");\n            const deletedEvent = deleteCalendarEvent(eventId);\n            return {\n                success: !!deletedEvent,\n                message: deletedEvent ? `Evento \"${deletedEvent.title}\" eliminado exitosamente` : 'Evento no encontrado'\n            };\n        } catch (error) {\n            console.error('Error deleting event:', error);\n            return {\n                success: false,\n                message: 'Error al eliminar evento'\n            };\n        }\n        const result = await response.json();\n        if (result.success) {\n            console.log(`ü§ñ IA elimin√≥ evento: ${result.deletedEvent.title}`);\n            // Disparar evento del lado del cliente\n            if (false) {}\n            return {\n                success: true,\n                message: result.message\n            };\n        } else {\n            return {\n                success: false,\n                message: result.error || 'Error desconocido al eliminar'\n            };\n        }\n    } catch (error) {\n        console.error('‚ùå Error deleting event from AI:', error);\n        return {\n            success: false,\n            message: 'Error de conexi√≥n al eliminar evento'\n        };\n    }\n}\n/**\n * Normaliza nombres de materias con acentos y may√∫sculas correctas\n */ function normalizeSubjectName(subject) {\n    if (!subject) return null;\n    const normalized = subject.toLowerCase().trim();\n    const subjectMap = {\n        'quimica': 'Qu√≠mica',\n        'qu√≠mica': 'Qu√≠mica',\n        'fisica': 'F√≠sica',\n        'f√≠sica': 'F√≠sica',\n        'matematica': 'Matem√°tica',\n        'matem√°ticas': 'Matem√°ticas',\n        'matematicas': 'Matem√°ticas',\n        'biologia': 'Biolog√≠a',\n        'biolog√≠a': 'Biolog√≠a',\n        'historia': 'Historia',\n        'geografia': 'Geograf√≠a',\n        'geograf√≠a': 'Geograf√≠a',\n        'ingles': 'Ingl√©s',\n        'ingl√©s': 'Ingl√©s',\n        'lengua': 'Lengua y Literatura',\n        'literatura': 'Lengua y Literatura',\n        'filosofia': 'Filosof√≠a',\n        'filosof√≠a': 'Filosof√≠a',\n        'economia': 'Econom√≠a',\n        'econom√≠a': 'Econom√≠a',\n        'educacion fisica': 'Educaci√≥n F√≠sica',\n        'educaci√≥n f√≠sica': 'Educaci√≥n F√≠sica',\n        'ed fisica': 'Educaci√≥n F√≠sica',\n        'arte': 'Arte',\n        'musica': 'M√∫sica',\n        'm√∫sica': 'M√∫sica'\n    };\n    // Buscar coincidencia exacta primero\n    if (subjectMap[normalized]) {\n        return subjectMap[normalized];\n    }\n    // Buscar coincidencia parcial\n    for (const [key, value] of Object.entries(subjectMap)){\n        if (key.includes(normalized) || normalized.includes(key)) {\n            return value;\n        }\n    }\n    // Si no se encuentra, capitalizar primera letra\n    return subject.charAt(0).toUpperCase() + subject.slice(1).toLowerCase();\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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O1FBQ2RYLFFBQVFXLEtBQUssQ0FBQyxtQ0FBbUNBO1FBQ2pELE9BQU87WUFDTGIsU0FBUztZQUNUbkUsU0FBUztRQUNYO0lBQ0Y7QUFDRjtBQUVBOztDQUVDLEdBQ0QsU0FBU2IscUJBQXFCQyxPQUF1QjtJQUNuRCxJQUFJLENBQUNBLFNBQVMsT0FBTztJQUVyQixNQUFNK0ksYUFBYS9JLFFBQVFiLFdBQVcsR0FBR2tFLElBQUk7SUFFN0MsTUFBTTJGLGFBQXFDO1FBQ3pDLFdBQVc7UUFDWCxXQUFXO1FBQ1gsVUFBVTtRQUNWLFVBQVU7UUFDVixjQUFjO1FBQ2QsZUFBZTtRQUNmLGVBQWU7UUFDZixZQUFZO1FBQ1osWUFBWTtRQUNaLFlBQVk7UUFDWixhQUFhO1FBQ2IsYUFBYTtRQUNiLFVBQVU7UUFDVixVQUFVO1FBQ1YsVUFBVTtRQUNWLGNBQWM7UUFDZCxhQUFhO1FBQ2IsYUFBYTtRQUNiLFlBQVk7UUFDWixZQUFZO1FBQ1osb0JBQW9CO1FBQ3BCLG9CQUFvQjtRQUNwQixhQUFhO1FBQ2IsUUFBUTtRQUNSLFVBQVU7UUFDVixVQUFVO0lBQ1o7SUFFQSxxQ0FBcUM7SUFDckMsSUFBSUEsVUFBVSxDQUFDRCxXQUFXLEVBQUU7UUFDMUIsT0FBT0MsVUFBVSxDQUFDRCxXQUFXO0lBQy9CO0lBRUEsOEJBQThCO0lBQzlCLEtBQUssTUFBTSxDQUFDRSxLQUFLMUYsTUFBTSxJQUFJZ0QsT0FBT0MsT0FBTyxDQUFDd0MsWUFBYTtRQUNyRCxJQUFJQyxJQUFJM0gsUUFBUSxDQUFDeUgsZUFBZUEsV0FBV3pILFFBQVEsQ0FBQzJILE1BQU07WUFDeEQsT0FBTzFGO1FBQ1Q7SUFDRjtJQUVBLGdEQUFnRDtJQUNoRCxPQUFPdkQsUUFBUWlCLE1BQU0sQ0FBQyxHQUFHQyxXQUFXLEtBQUtsQixRQUFRbUIsS0FBSyxDQUFDLEdBQUdoQyxXQUFXO0FBQ3ZFIiwic291cmNlcyI6WyIvVXNlcnMvcm9kcmlnb2RpYmVybmFyZG8zM2dtYWlsLmNvbS9Eb2N1bWVudHMvQXBwIERldmVsb3BtZW50IFByb3llY3RzL0ludGVsbGVnbyBQbGF0Zm9ybS9zcmMvbGliL2NhbGVuZGFyLWFpLWludGVncmF0aW9uLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIENhbGVuZGFyIEFJIEludGVncmF0aW9uIFNlcnZpY2Vcbi8vIEludGVncmEgZWwgc2lzdGVtYSBkZSBJQSB0dXRvcmEgY29uIGVsIGNhbGVuZGFyaW8gcGFyYSBjcmVhciBldmVudG9zIGF1dG9tw6F0aWNhbWVudGVcblxuaW1wb3J0IHsgQ2FsZW5kYXJFdmVudCwgYWRkQ2FsZW5kYXJFdmVudCwgZ2V0RXZlbnRUeXBlQ29sb3IsIGdldFVzZXJDYWxlbmRhckRhdGEgfSBmcm9tICcuL2NhbGVuZGFyLWRhdGEnXG5pbXBvcnQgeyBjb252ZXJzYXRpb25FbmdpbmUgfSBmcm9tICcuL2NvbnZlcnNhdGlvbi1lbmdpbmUnXG5cbmV4cG9ydCBpbnRlcmZhY2UgRXZlbnRTdWdnZXN0aW9uIHtcbiAgdHlwZTogJ2V4YW0nIHwgJ3N0dWR5X3Nlc3Npb24nIHwgJ3BlcnNvbmFsJyB8ICdleHRyYWN1cnJpY3VsYXInXG4gIHRpdGxlOiBzdHJpbmdcbiAgc3ViamVjdD86IHN0cmluZ1xuICBkYXRlPzogc3RyaW5nXG4gIHN0YXJ0VGltZT86IHN0cmluZ1xuICBkdXJhdGlvbj86IG51bWJlclxuICBsb2NhdGlvbj86IHN0cmluZ1xuICBkZXNjcmlwdGlvbj86IHN0cmluZ1xuICBwcmlvcml0eT86ICdoaWdoJyB8ICdtZWRpdW0nIHwgJ2xvdydcbiAgY29uZmlkZW5jZTogbnVtYmVyIC8vIDAtMSBuaXZlbCBkZSBjb25maWFuemEgZW4gbGEgc3VnZXJlbmNpYVxufVxuXG5leHBvcnQgaW50ZXJmYWNlIENvbnZlcnNhdGlvbkFuYWx5c2lzIHtcbiAgaGFzRXZlbnRNZW50aW9uOiBib29sZWFuXG4gIGV2ZW50U3VnZ2VzdGlvbnM6IEV2ZW50U3VnZ2VzdGlvbltdXG4gIHF1ZXN0aW9uczogc3RyaW5nW11cbiAgbWlzc2luZ0luZm86IHN0cmluZ1tdXG59XG5cbi8qKlxuICogQW5hbGl6YSB1bmEgY29udmVyc2FjacOzbiBjb24gbGEgSUEgcGFyYSBkZXRlY3RhciBtZW5jaW9uZXMgZGUgZXZlbnRvc1xuICovXG5leHBvcnQgZnVuY3Rpb24gYW5hbHl6ZUNvbnZlcnNhdGlvbkZvckV2ZW50cyhcbiAgY29udmVyc2F0aW9uSGlzdG9yeTogQXJyYXk8eyByb2xlOiAndXNlcicgfCAnYXNzaXN0YW50JywgY29udGVudDogc3RyaW5nIH0+XG4pOiBDb252ZXJzYXRpb25BbmFseXNpcyB7XG4gIGNvbnN0IHVzZXJNZXNzYWdlcyA9IGNvbnZlcnNhdGlvbkhpc3RvcnlcbiAgICAuZmlsdGVyKG1zZyA9PiBtc2cucm9sZSA9PT0gJ3VzZXInKVxuICAgIC5tYXAobXNnID0+IG1zZy5jb250ZW50KVxuICAgIC5qb2luKCcgJylcblxuICBjb25zdCBhbmFseXNpczogQ29udmVyc2F0aW9uQW5hbHlzaXMgPSB7XG4gICAgaGFzRXZlbnRNZW50aW9uOiBmYWxzZSxcbiAgICBldmVudFN1Z2dlc3Rpb25zOiBbXSxcbiAgICBxdWVzdGlvbnM6IFtdLFxuICAgIG1pc3NpbmdJbmZvOiBbXVxuICB9XG5cbiAgLy8gQW7DoWxpc2lzIG3DoXMgaW50ZWxpZ2VudGUgZGVsIMO6bHRpbW8gbWVuc2FqZSBkZWwgdXN1YXJpb1xuICBjb25zdCBsYXN0VXNlck1lc3NhZ2UgPSBjb252ZXJzYXRpb25IaXN0b3J5Lmxlbmd0aCA+IDAgXG4gICAgPyBjb252ZXJzYXRpb25IaXN0b3J5W2NvbnZlcnNhdGlvbkhpc3RvcnkubGVuZ3RoIC0gMV0/LmNvbnRlbnQgfHwgdXNlck1lc3NhZ2VzXG4gICAgOiB1c2VyTWVzc2FnZXNcblxuICBjb25zdCBtc2dMb3dlciA9IGxhc3RVc2VyTWVzc2FnZS50b0xvd2VyQ2FzZSgpXG5cbiAgLy8gRGV0ZWN0YXIgaW50ZW5jacOzbiBkZSBhZ2VuZGFyL2NyZWFyIGV2ZW50b1xuICBjb25zdCBhZ2VuZGFyUGF0dGVybnMgPSAvYWdlbmRlcz98YWdlbmRbYcOhXXxjcmVbYWVdfHByb2dyYW1hfGFub3RbYWVdfGFncmVnYS9pXG4gIGNvbnN0IGlzUmVxdWVzdGluZ1RvU2NoZWR1bGUgPSBhZ2VuZGFyUGF0dGVybnMudGVzdChsYXN0VXNlck1lc3NhZ2UpXG4gIFxuICAvLyBEZXRlY3RhciBpbnRlbmNpw7NuIGRlIGVkaXRhciBldmVudG9cbiAgY29uc3QgZWRpdGFyUGF0dGVybnMgPSAvZWRpdFthZV18bW9kaWZpY1thZV18Y2FtYmlbYWVdfGFjdHVhbGl6W2FlXXxyZXByb2dyYW1hL2lcbiAgY29uc3QgaXNSZXF1ZXN0aW5nVG9FZGl0ID0gZWRpdGFyUGF0dGVybnMudGVzdChsYXN0VXNlck1lc3NhZ2UpXG4gIFxuICAvLyBEZXRlY3RhciBpbnRlbmNpw7NuIGRlIGVsaW1pbmFyIGV2ZW50b1xuICBjb25zdCBlbGltaW5hclBhdHRlcm5zID0gL2VsaW1pblthZV18Ym9yclthZV18cXVpdFthZV18Y2FuY2VsW2FlXXxzdXByaW1pL2lcbiAgY29uc3QgaXNSZXF1ZXN0aW5nVG9EZWxldGUgPSBlbGltaW5hclBhdHRlcm5zLnRlc3QobGFzdFVzZXJNZXNzYWdlKVxuXG4gIC8vIERldGVjdGFyIG1lbmNpb25lcyBkZSBleMOhbWVuZXMgY29uIG1lam9yIHBhcnNpbmdcbiAgaWYgKC8oZXhhbWVufGV2YWx1YWNpW2/Ds11ufHBhcmNpYWx8ZmluYWx8cHJ1ZWJhfHRlc3QpL2kudGVzdChsYXN0VXNlck1lc3NhZ2UpKSB7XG4gICAgY29uc3QgZXZlbnREYXRhID0gZXh0cmFjdEV2ZW50RGF0YUZyb21NZXNzYWdlKGxhc3RVc2VyTWVzc2FnZSwgJ2V4YW0nKVxuICAgIFxuICAgIGlmIChldmVudERhdGEuaGFzRXZlbnQpIHtcbiAgICAgIC8vIE5vcm1hbGl6YXIgc3ViamVjdCBjb24gYWNlbnRvcyBjb3JyZWN0b3NcbiAgICAgIGNvbnN0IG5vcm1hbGl6ZWRTdWJqZWN0ID0gbm9ybWFsaXplU3ViamVjdE5hbWUoZXZlbnREYXRhLnN1YmplY3QpXG4gICAgICBcbiAgICAgIGFuYWx5c2lzLmV2ZW50U3VnZ2VzdGlvbnMucHVzaCh7XG4gICAgICAgIHR5cGU6ICdleGFtJyxcbiAgICAgICAgdGl0bGU6IG5vcm1hbGl6ZWRTdWJqZWN0ID8gYEV4YW1lbiBkZSAke25vcm1hbGl6ZWRTdWJqZWN0fWAgOiAnRXhhbWVuJyxcbiAgICAgICAgc3ViamVjdDogbm9ybWFsaXplZFN1YmplY3QsXG4gICAgICAgIGRhdGU6IGV2ZW50RGF0YS5kYXRlLFxuICAgICAgICBzdGFydFRpbWU6IGV2ZW50RGF0YS5zdGFydFRpbWUsXG4gICAgICAgIGR1cmF0aW9uOiBldmVudERhdGEuZHVyYXRpb24gfHwgMTIwLFxuICAgICAgICBsb2NhdGlvbjogZXZlbnREYXRhLmxvY2F0aW9uLFxuICAgICAgICBkZXNjcmlwdGlvbjogZXZlbnREYXRhLmRlc2NyaXB0aW9uLFxuICAgICAgICBwcmlvcml0eTogJ2hpZ2gnLFxuICAgICAgICBjb25maWRlbmNlOiAwLjlcbiAgICAgIH0pXG4gICAgICBhbmFseXNpcy5oYXNFdmVudE1lbnRpb24gPSB0cnVlXG4gICAgfVxuICB9XG5cbiAgLy8gRGV0ZWN0YXIgbWVuY2lvbmVzIGRlIGVzdHVkaW9cbiAgZWxzZSBpZiAoLyhlc3R1ZGlhcnxyZXBhc2FyfHByZXBhcmFyfHByYWN0aWNhcnxzZXNpW2/Ds11uLiplc3R1ZGlvKS9pLnRlc3QobGFzdFVzZXJNZXNzYWdlKSkge1xuICAgIGNvbnN0IGV2ZW50RGF0YSA9IGV4dHJhY3RFdmVudERhdGFGcm9tTWVzc2FnZShsYXN0VXNlck1lc3NhZ2UsICdzdHVkeV9zZXNzaW9uJylcbiAgICBcbiAgICBpZiAoZXZlbnREYXRhLmhhc0V2ZW50KSB7XG4gICAgICAvLyBOb3JtYWxpemFyIHN1YmplY3QgY29uIGFjZW50b3MgY29ycmVjdG9zXG4gICAgICBjb25zdCBub3JtYWxpemVkU3ViamVjdCA9IG5vcm1hbGl6ZVN1YmplY3ROYW1lKGV2ZW50RGF0YS5zdWJqZWN0KSB8fCAnUmV2aXNpw7NuIEdlbmVyYWwnXG4gICAgICBcbiAgICAgIGFuYWx5c2lzLmV2ZW50U3VnZ2VzdGlvbnMucHVzaCh7XG4gICAgICAgIHR5cGU6ICdzdHVkeV9zZXNzaW9uJyxcbiAgICAgICAgdGl0bGU6IGBTZXNpw7NuIGRlIEVzdHVkaW8gLSAke25vcm1hbGl6ZWRTdWJqZWN0fWAsXG4gICAgICAgIHN1YmplY3Q6IG5vcm1hbGl6ZWRTdWJqZWN0LFxuICAgICAgICBkYXRlOiBldmVudERhdGEuZGF0ZSxcbiAgICAgICAgc3RhcnRUaW1lOiBldmVudERhdGEuc3RhcnRUaW1lLFxuICAgICAgICBkdXJhdGlvbjogZXZlbnREYXRhLmR1cmF0aW9uIHx8IDkwLFxuICAgICAgICBsb2NhdGlvbjogZXZlbnREYXRhLmxvY2F0aW9uLFxuICAgICAgICBkZXNjcmlwdGlvbjogZXZlbnREYXRhLmRlc2NyaXB0aW9uLFxuICAgICAgICBwcmlvcml0eTogJ21lZGl1bScsXG4gICAgICAgIGNvbmZpZGVuY2U6IDAuOFxuICAgICAgfSlcbiAgICAgIGFuYWx5c2lzLmhhc0V2ZW50TWVudGlvbiA9IHRydWVcbiAgICB9XG4gIH1cblxuICAvLyBTb2xvIGdlbmVyYXIgcHJlZ3VudGFzIHBhcmEgaW5mb3JtYWNpw7NuIHJlYWxtZW50ZSBmYWx0YW50ZVxuICBpZiAoYW5hbHlzaXMuZXZlbnRTdWdnZXN0aW9ucy5sZW5ndGggPiAwKSB7XG4gICAgY29uc3Qgc3VnZ2VzdGlvbiA9IGFuYWx5c2lzLmV2ZW50U3VnZ2VzdGlvbnNbMF1cbiAgICBjb25zdCBxdWVzdGlvbnM6IHN0cmluZ1tdID0gW11cbiAgICBjb25zdCBtaXNzaW5nSW5mbzogc3RyaW5nW10gPSBbXVxuXG4gICAgaWYgKCFzdWdnZXN0aW9uLmRhdGUpIHtcbiAgICAgIHF1ZXN0aW9ucy5wdXNoKFwi8J+ThSDCv1BhcmEgcXXDqSBmZWNoYSBlcz9cIilcbiAgICAgIG1pc3NpbmdJbmZvLnB1c2goXCJmZWNoYVwiKVxuICAgIH1cblxuICAgIGlmICghc3VnZ2VzdGlvbi5zdGFydFRpbWUpIHtcbiAgICAgIHF1ZXN0aW9ucy5wdXNoKFwi8J+VkCDCv0EgcXXDqSBob3JhP1wiKVxuICAgICAgbWlzc2luZ0luZm8ucHVzaChcImhvcmFcIilcbiAgICB9XG5cbiAgICBpZiAoc3VnZ2VzdGlvbi50eXBlID09PSAnZXhhbScgJiYgIXN1Z2dlc3Rpb24uc3ViamVjdCkge1xuICAgICAgcXVlc3Rpb25zLnB1c2goXCLwn5OaIMK/RGUgcXXDqSBtYXRlcmlhIGVzIGVsIGV4YW1lbj9cIilcbiAgICAgIG1pc3NpbmdJbmZvLnB1c2goXCJtYXRlcmlhXCIpXG4gICAgfVxuXG4gICAgaWYgKHN1Z2dlc3Rpb24udHlwZSA9PT0gJ2V4YW0nICYmICFzdWdnZXN0aW9uLmxvY2F0aW9uKSB7XG4gICAgICBxdWVzdGlvbnMucHVzaChcIvCfk40gwr9FbiBxdcOpIGF1bGEgc2Vyw6E/XCIpXG4gICAgICBtaXNzaW5nSW5mby5wdXNoKFwidWJpY2FjacOzblwiKVxuICAgIH1cblxuICAgIC8vIFNvbG8gYWdyZWdhciBwcmVndW50YXMgc2kgcmVhbG1lbnRlIGZhbHRhIGluZm9ybWFjacOzblxuICAgIGFuYWx5c2lzLnF1ZXN0aW9ucyA9IHF1ZXN0aW9uc1xuICAgIGFuYWx5c2lzLm1pc3NpbmdJbmZvID0gbWlzc2luZ0luZm9cbiAgfVxuXG4gIHJldHVybiBhbmFseXNpc1xufVxuXG4vKipcbiAqIEV4dHJhZSBkYXRvcyBlc3BlY8OtZmljb3MgZGVsIGV2ZW50byBkZXNkZSBlbCBtZW5zYWplXG4gKi9cbmZ1bmN0aW9uIGV4dHJhY3RFdmVudERhdGFGcm9tTWVzc2FnZShtZXNzYWdlOiBzdHJpbmcsIGV2ZW50VHlwZTogJ2V4YW0nIHwgJ3N0dWR5X3Nlc3Npb24nIHwgJ3BlcnNvbmFsJyB8ICdleHRyYWN1cnJpY3VsYXInKSB7XG4gIGNvbnN0IG1zZ0xvd2VyID0gbWVzc2FnZS50b0xvd2VyQ2FzZSgpXG4gIFxuICAvLyBFeHRyYWVyIG1hdGVyaWEgZGUgbWFuZXJhIG3DoXMgaW50ZWxpZ2VudGVcbiAgbGV0IHN1YmplY3QgPSBudWxsXG4gIGNvbnN0IHN1YmplY3RQYXR0ZXJucyA9IFtcbiAgICAvKD86ZXhhbWVufGV2YWx1YWNpW2/Ds11ufHBhcmNpYWx8ZmluYWx8cHJ1ZWJhfHRlc3QpLio/KD86ZGV8ZW4pXFxzKyhbYS16w6HDqcOtw7PDusOxXSspL2ksXG4gICAgLyhbYS16w6HDqcOtw7PDusOxXSspLio/KD86ZXhhbWVufGV2YWx1YWNpW2/Ds11ufHBhcmNpYWx8ZmluYWx8cHJ1ZWJhfHRlc3QpL2ksXG4gICAgLyg/OmVzdHVkaWFyfHJlcGFzYXJ8cHJlcGFyYXJ8cHJhY3RpY2FyKVxccysoW2EtesOhw6nDrcOzw7rDsV0rKS9pLFxuICAgIC8oPzpzZXNpW2/Ds11uLio/KD86ZGV8ZW4pXFxzKyhbYS16w6HDqcOtw7PDusOxXSspKS9pXG4gIF1cbiAgXG4gIGZvciAoY29uc3QgcGF0dGVybiBvZiBzdWJqZWN0UGF0dGVybnMpIHtcbiAgICBjb25zdCBtYXRjaCA9IG1lc3NhZ2UubWF0Y2gocGF0dGVybilcbiAgICBpZiAobWF0Y2ggJiYgbWF0Y2hbMV0pIHtcbiAgICAgIC8vIENhcGl0YWxpemFyIHByaW1lcmEgbGV0cmFcbiAgICAgIHN1YmplY3QgPSBtYXRjaFsxXS5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSArIG1hdGNoWzFdLnNsaWNlKDEpLnRvTG93ZXJDYXNlKClcbiAgICAgIGJyZWFrXG4gICAgfVxuICB9XG5cbiAgLy8gRXh0cmFlciBmZWNoYSBkZSBtYW5lcmEgbcOhcyBpbnRlbGlnZW50ZVxuICBsZXQgZGF0ZSA9IG51bGxcbiAgbGV0IHN0YXJ0VGltZSA9IG51bGxcbiAgXG4gIC8vIERldGVjdGFyIGZlY2hhcyBlc3BlY8OtZmljYXMgKGRkIGRlIG1lcywgZGQvbW0sIGV0Yy4pXG4gIGNvbnN0IHNwZWNpZmljRGF0ZVBhdHRlcm5zID0gW1xuICAgIC8oXFxkezEsMn0pXFxzK2RlXFxzKyhlbmVyb3xmZWJyZXJvfG1hcnpvfGFicmlsfG1heW98anVuaW98anVsaW98YWdvc3RvfHNlcHRpZW1icmV8b2N0dWJyZXxub3ZpZW1icmV8ZGljaWVtYnJlKS9pLFxuICAgIC8oXFxkezEsMn0pXFwvKFxcZHsxLDJ9KSg/OlxcLyhcXGR7Miw0fSkpPy8sXG4gICAgLyhcXGR7MSwyfSktKFxcZHsxLDJ9KSg/Oi0oXFxkezIsNH0pKT8vLFxuICAgIC9lbFxccysoXFxkezEsMn0pL2lcbiAgXVxuICBcbiAgZm9yIChjb25zdCBwYXR0ZXJuIG9mIHNwZWNpZmljRGF0ZVBhdHRlcm5zKSB7XG4gICAgY29uc3QgbWF0Y2ggPSBtZXNzYWdlLm1hdGNoKHBhdHRlcm4pXG4gICAgaWYgKG1hdGNoKSB7XG4gICAgICBpZiAocGF0dGVybi5zb3VyY2UuaW5jbHVkZXMoJ2RlJykpIHtcbiAgICAgICAgLy8gXCIxMCBkZSBqdWxpb1wiXG4gICAgICAgIGNvbnN0IGRheSA9IHBhcnNlSW50KG1hdGNoWzFdKVxuICAgICAgICBjb25zdCBtb250aE5hbWUgPSBtYXRjaFsyXS50b0xvd2VyQ2FzZSgpXG4gICAgICAgIGNvbnN0IG1vbnRoTWFwOiBSZWNvcmQ8c3RyaW5nLCBudW1iZXI+ID0ge1xuICAgICAgICAgICdlbmVybyc6IDAsICdmZWJyZXJvJzogMSwgJ21hcnpvJzogMiwgJ2FicmlsJzogMyxcbiAgICAgICAgICAnbWF5byc6IDQsICdqdW5pbyc6IDUsICdqdWxpbyc6IDYsICdhZ29zdG8nOiA3LFxuICAgICAgICAgICdzZXB0aWVtYnJlJzogOCwgJ29jdHVicmUnOiA5LCAnbm92aWVtYnJlJzogMTAsICdkaWNpZW1icmUnOiAxMVxuICAgICAgICB9XG4gICAgICAgIGlmIChtb250aE1hcFttb250aE5hbWVdICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICBjb25zdCBub3cgPSBuZXcgRGF0ZSgpXG4gICAgICAgICAgY29uc3QgZXZlbnREYXRlID0gbmV3IERhdGUobm93LmdldEZ1bGxZZWFyKCksIG1vbnRoTWFwW21vbnRoTmFtZV0sIGRheSlcbiAgICAgICAgICBkYXRlID0gZXZlbnREYXRlLnRvSVNPU3RyaW5nKCkuc3BsaXQoJ1QnKVswXVxuICAgICAgICB9XG4gICAgICB9IGVsc2UgaWYgKG1hdGNoWzFdICYmICFpc05hTihwYXJzZUludChtYXRjaFsxXSkpKSB7XG4gICAgICAgIC8vIEZvcm1hdG8gZGQvbW0gbyBkZC1tbSBvIFwiZWwgMTBcIlxuICAgICAgICBjb25zdCBkYXkgPSBwYXJzZUludChtYXRjaFsxXSlcbiAgICAgICAgY29uc3QgbW9udGggPSBtYXRjaFsyXSA/IHBhcnNlSW50KG1hdGNoWzJdKSAtIDEgOiBuZXcgRGF0ZSgpLmdldE1vbnRoKClcbiAgICAgICAgY29uc3QgeWVhciA9IG1hdGNoWzNdID8gcGFyc2VJbnQobWF0Y2hbM10pIDogbmV3IERhdGUoKS5nZXRGdWxsWWVhcigpXG4gICAgICAgIGNvbnN0IGV2ZW50RGF0ZSA9IG5ldyBEYXRlKHllYXIsIG1vbnRoLCBkYXkpXG4gICAgICAgIGRhdGUgPSBldmVudERhdGUudG9JU09TdHJpbmcoKS5zcGxpdCgnVCcpWzBdXG4gICAgICB9XG4gICAgICBicmVha1xuICAgIH1cbiAgfVxuXG4gIC8vIFNpIG5vIHNlIGVuY29udHLDsyBmZWNoYSBlc3BlY8OtZmljYSwgYnVzY2FyIGTDrWFzIHJlbGF0aXZvc1xuICBpZiAoIWRhdGUpIHtcbiAgICBjb25zdCByZWxhdGl2ZURhdGVQYXR0ZXJucyA9IFtcbiAgICAgIHsgcGF0dGVybjogL21hW8Oxbl1hbmEvaSwgZGF5czogMSB9LFxuICAgICAgeyBwYXR0ZXJuOiAvaG95L2ksIGRheXM6IDAgfSxcbiAgICAgIHsgcGF0dGVybjogL3Bhc2Fkby4qbWFbw7FuXWFuYS9pLCBkYXlzOiAyIH0sXG4gICAgICB7IHBhdHRlcm46IC9sdW5lcy9pLCB0YXJnZXREYXk6IDEgfSxcbiAgICAgIHsgcGF0dGVybjogL21hcnRlcy9pLCB0YXJnZXREYXk6IDIgfSxcbiAgICAgIHsgcGF0dGVybjogL21pW2XDqV1yY29sZXMvaSwgdGFyZ2V0RGF5OiAzIH0sXG4gICAgICB7IHBhdHRlcm46IC9qdWV2ZXMvaSwgdGFyZ2V0RGF5OiA0IH0sXG4gICAgICB7IHBhdHRlcm46IC92aWVybmVzL2ksIHRhcmdldERheTogNSB9LFxuICAgICAgeyBwYXR0ZXJuOiAvc1thw6FdYmFkby9pLCB0YXJnZXREYXk6IDYgfSxcbiAgICAgIHsgcGF0dGVybjogL2RvbWluZ28vaSwgdGFyZ2V0RGF5OiAwIH1cbiAgICBdXG5cbiAgICBmb3IgKGNvbnN0IHsgcGF0dGVybiwgZGF5cywgdGFyZ2V0RGF5IH0gb2YgcmVsYXRpdmVEYXRlUGF0dGVybnMpIHtcbiAgICAgIGlmIChwYXR0ZXJuLnRlc3QobWVzc2FnZSkpIHtcbiAgICAgICAgY29uc3Qgbm93ID0gbmV3IERhdGUoKVxuICAgICAgICBsZXQgZXZlbnREYXRlOiBEYXRlXG5cbiAgICAgICAgaWYgKGRheXMgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgIGV2ZW50RGF0ZSA9IG5ldyBEYXRlKG5vdy5nZXRUaW1lKCkgKyBkYXlzICogMjQgKiA2MCAqIDYwICogMTAwMClcbiAgICAgICAgfSBlbHNlIGlmICh0YXJnZXREYXkgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgIGNvbnN0IGN1cnJlbnREYXkgPSBub3cuZ2V0RGF5KClcbiAgICAgICAgICBsZXQgZGF5c1RvQWRkID0gdGFyZ2V0RGF5IC0gY3VycmVudERheVxuICAgICAgICAgIGlmIChkYXlzVG9BZGQgPD0gMCkgZGF5c1RvQWRkICs9IDcgLy8gUHLDs3hpbWEgc2VtYW5hXG4gICAgICAgICAgZXZlbnREYXRlID0gbmV3IERhdGUobm93LmdldFRpbWUoKSArIGRheXNUb0FkZCAqIDI0ICogNjAgKiA2MCAqIDEwMDApXG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgY29udGludWVcbiAgICAgICAgfVxuXG4gICAgICAgIGRhdGUgPSBldmVudERhdGUudG9JU09TdHJpbmcoKS5zcGxpdCgnVCcpWzBdXG4gICAgICAgIGJyZWFrXG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgLy8gRXh0cmFlciBob3JhIGRlIG1hbmVyYSBtw6FzIGludGVsaWdlbnRlXG4gIGNvbnN0IHRpbWVQYXR0ZXJucyA9IFtcbiAgICAvKD86YVxccytsYXM/XFxzKyk/KFxcZHsxLDJ9KSg/OjooXFxkezJ9KSk/XFxzKihhbXxwbXxhXFwuP21cXC4/fHBcXC4/bVxcLj8pL2ksXG4gICAgLyg/OmFcXHMrbGFzP1xccyspPyhcXGR7MSwyfSkoPzo6KFxcZHsyfSkpP1xccypoKD86b3Jhcz8pPy9pLFxuICAgIC8oXFxkezEsMn0pKD86OihcXGR7Mn0pKT9cXHMqKD86ZGVcXHMrbGFcXHMrKT8obWFbw7FuXWFuYXx0YXJkZXxub2NoZSkvaVxuICBdXG5cbiAgZm9yIChjb25zdCBwYXR0ZXJuIG9mIHRpbWVQYXR0ZXJucykge1xuICAgIGNvbnN0IG1hdGNoID0gbWVzc2FnZS5tYXRjaChwYXR0ZXJuKVxuICAgIGlmIChtYXRjaCkge1xuICAgICAgbGV0IGhvdXIgPSBwYXJzZUludChtYXRjaFsxXSlcbiAgICAgIGNvbnN0IG1pbnV0ZSA9IG1hdGNoWzJdID8gcGFyc2VJbnQobWF0Y2hbMl0pIDogMFxuICAgICAgY29uc3QgcGVyaW9kID0gbWF0Y2hbM10/LnRvTG93ZXJDYXNlKClcblxuICAgICAgLy8gQ29udmVydGlyIGEgZm9ybWF0byAyNGhcbiAgICAgIGlmIChwZXJpb2QpIHtcbiAgICAgICAgaWYgKChwZXJpb2QuaW5jbHVkZXMoJ3BtJykgfHwgcGVyaW9kLmluY2x1ZGVzKCdwLm0nKSB8fCBwZXJpb2QgPT09ICd0YXJkZScgfHwgcGVyaW9kID09PSAnbm9jaGUnKSAmJiBob3VyIDwgMTIpIHtcbiAgICAgICAgICBob3VyICs9IDEyXG4gICAgICAgIH0gZWxzZSBpZiAoKHBlcmlvZC5pbmNsdWRlcygnYW0nKSB8fCBwZXJpb2QuaW5jbHVkZXMoJ2EubScpIHx8IHBlcmlvZCA9PT0gJ21hW8Oxbl1hbmEnKSAmJiBob3VyID09PSAxMikge1xuICAgICAgICAgIGhvdXIgPSAwXG4gICAgICAgIH0gZWxzZSBpZiAocGVyaW9kID09PSAnbm9jaGUnICYmIGhvdXIgPCA2KSB7XG4gICAgICAgICAgaG91ciArPSAxMiAvLyBQYXJhIGNhc29zIGNvbW8gXCIzIGRlIGxhIG5vY2hlXCIgPSAxNTowMFxuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIHN0YXJ0VGltZSA9IGAke2hvdXIudG9TdHJpbmcoKS5wYWRTdGFydCgyLCAnMCcpfToke21pbnV0ZS50b1N0cmluZygpLnBhZFN0YXJ0KDIsICcwJyl9YFxuICAgICAgYnJlYWtcbiAgICB9XG4gIH1cblxuICAvLyBFeHRyYWVyIHViaWNhY2nDs25cbiAgbGV0IGxvY2F0aW9uID0gbnVsbFxuICBjb25zdCBsb2NhdGlvblBhdHRlcm5zID0gW1xuICAgIC8oPzplblxccytlbD9cXHMrKT8oYXVsYXxsYWJvcmF0b3Jpb3xzYWxhfGF1ZGl0b3JpbylcXHMrKFthLXpBLVowLTldKykvaSxcbiAgICAvKD86ZW5cXHMrKShbYS16QS1aXFxzXSsoPzphdWxhfGxhYm9yYXRvcmlvfHNhbGF8YXVkaXRvcmlvKVthLXpBLVowLTlcXHNdKikvaVxuICBdXG5cbiAgZm9yIChjb25zdCBwYXR0ZXJuIG9mIGxvY2F0aW9uUGF0dGVybnMpIHtcbiAgICBjb25zdCBtYXRjaCA9IG1lc3NhZ2UubWF0Y2gocGF0dGVybilcbiAgICBpZiAobWF0Y2gpIHtcbiAgICAgIGxvY2F0aW9uID0gbWF0Y2hbMF0ucmVwbGFjZSgvXmVuXFxzKy9pLCAnJykudHJpbSgpXG4gICAgICBicmVha1xuICAgIH1cbiAgfVxuXG4gIC8vIEV4dHJhZXIgZHVyYWNpw7NuXG4gIGxldCBkdXJhdGlvbiA9IG51bGxcbiAgY29uc3QgZHVyYXRpb25NYXRjaCA9IG1lc3NhZ2UubWF0Y2goLyg/OmR1cmFudGVcXHMrKT8oXFxkKylcXHMqKGhvcmFzP3xtaW51dG9zP3xtaW4pL2kpXG4gIGlmIChkdXJhdGlvbk1hdGNoKSB7XG4gICAgY29uc3QgdmFsdWUgPSBwYXJzZUludChkdXJhdGlvbk1hdGNoWzFdKVxuICAgIGNvbnN0IHVuaXQgPSBkdXJhdGlvbk1hdGNoWzJdLnRvTG93ZXJDYXNlKClcbiAgICBkdXJhdGlvbiA9IHVuaXQuaW5jbHVkZXMoJ2hvcmEnKSA/IHZhbHVlICogNjAgOiB2YWx1ZVxuICB9XG5cbiAgLy8gRXh0cmFlciBkZXNjcmlwY2nDs24vdGVtYSBlc3BlY8OtZmljbyBzaSBzZSBtZW5jaW9uYVxuICBsZXQgZGVzY3JpcHRpb24gPSBudWxsXG4gIGNvbnN0IHRvcGljUGF0dGVybnMgPSBbXG4gICAgLyg/OnNvYnJlfHRlbWF8dGVtYXM/KVxccysoW2EtesOhw6nDrcOzw7rDsVxcc10rPykoPzpcXHMrcGFyYXxcXHMrZWx8XFxzK2F8JCkvaSxcbiAgICAvKD86c29icmUpXFxzK2VsXFxzK3RlbWFcXHMrKFthLXrDocOpw63Ds8O6w7FcXHNdKz8pKD86XFxzK3BhcmF8XFxzK2VsfFxccythfCQpL2lcbiAgXVxuICBcbiAgZm9yIChjb25zdCBwYXR0ZXJuIG9mIHRvcGljUGF0dGVybnMpIHtcbiAgICBjb25zdCBtYXRjaCA9IG1lc3NhZ2UubWF0Y2gocGF0dGVybilcbiAgICBpZiAobWF0Y2ggJiYgbWF0Y2hbMV0gJiYgbWF0Y2hbMV0udHJpbSgpLmxlbmd0aCA+IDMpIHtcbiAgICAgIGRlc2NyaXB0aW9uID0gbWF0Y2hbMV0udHJpbSgpXG4gICAgICBicmVha1xuICAgIH1cbiAgfVxuXG4gIHJldHVybiB7XG4gICAgaGFzRXZlbnQ6IHRydWUsXG4gICAgc3ViamVjdCxcbiAgICBkYXRlLFxuICAgIHN0YXJ0VGltZSxcbiAgICBsb2NhdGlvbixcbiAgICBkdXJhdGlvbixcbiAgICBkZXNjcmlwdGlvblxuICB9XG59XG5cbi8qKlxuICogR2VuZXJhIHByZWd1bnRhcyBwYXJhIGNvbXBsZXRhciBsYSBpbmZvcm1hY2nDs24gZGUgdW4gZXZlbnRvXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBnZW5lcmF0ZUV2ZW50UXVlc3Rpb25zKHN1Z2dlc3Rpb246IEV2ZW50U3VnZ2VzdGlvbik6IHN0cmluZ1tdIHtcbiAgY29uc3QgcXVlc3Rpb25zOiBzdHJpbmdbXSA9IFtdXG5cbiAgaWYgKCFzdWdnZXN0aW9uLmRhdGUpIHtcbiAgICBxdWVzdGlvbnMucHVzaChcIvCfk4Ugwr9QYXJhIHF1w6kgZmVjaGEgZXM/XCIpXG4gIH1cblxuICBpZiAoIXN1Z2dlc3Rpb24uc3RhcnRUaW1lKSB7XG4gICAgcXVlc3Rpb25zLnB1c2goXCLwn5WQIMK/QSBxdcOpIGhvcmE/XCIpXG4gIH1cblxuICBpZiAoc3VnZ2VzdGlvbi50eXBlID09PSAnZXhhbScpIHtcbiAgICBpZiAoIXN1Z2dlc3Rpb24uc3ViamVjdCkge1xuICAgICAgcXVlc3Rpb25zLnB1c2goXCLwn5OaIMK/RGUgcXXDqSBtYXRlcmlhIGVzIGVsIGV4YW1lbj9cIilcbiAgICB9XG4gICAgaWYgKCFzdWdnZXN0aW9uLmxvY2F0aW9uKSB7XG4gICAgICBxdWVzdGlvbnMucHVzaChcIvCfk40gwr9FbiBxdcOpIGF1bGEgbyBsYWJvcmF0b3JpbyBzZXLDoT9cIilcbiAgICB9XG4gICAgaWYgKCFzdWdnZXN0aW9uLmR1cmF0aW9uKSB7XG4gICAgICBxdWVzdGlvbnMucHVzaChcIuKPse+4jyDCv0N1w6FudG8gdGllbXBvIGR1cmFyw6E/XCIpXG4gICAgfVxuICB9XG5cbiAgaWYgKHN1Z2dlc3Rpb24udHlwZSA9PT0gJ3N0dWR5X3Nlc3Npb24nKSB7XG4gICAgaWYgKCFzdWdnZXN0aW9uLnN1YmplY3QpIHtcbiAgICAgIHF1ZXN0aW9ucy5wdXNoKFwi8J+TliDCv1F1w6kgdGVtYSB2YXMgYSBlc3R1ZGlhcj9cIilcbiAgICB9XG4gICAgaWYgKCFzdWdnZXN0aW9uLmR1cmF0aW9uKSB7XG4gICAgICBxdWVzdGlvbnMucHVzaChcIuKPsCDCv0N1w6FudGFzIGhvcmFzIHBsYW5lYXMgZXN0dWRpYXI/XCIpXG4gICAgfVxuICB9XG5cbiAgaWYgKHN1Z2dlc3Rpb24udHlwZSA9PT0gJ3BlcnNvbmFsJyB8fCBzdWdnZXN0aW9uLnR5cGUgPT09ICdleHRyYWN1cnJpY3VsYXInKSB7XG4gICAgaWYgKCFzdWdnZXN0aW9uLmxvY2F0aW9uKSB7XG4gICAgICBxdWVzdGlvbnMucHVzaChcIvCfk40gwr9Ew7NuZGUgc2Vyw6E/XCIpXG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIHF1ZXN0aW9uc1xufVxuXG4vKipcbiAqIENvbnZpZXJ0ZSB1bmEgc3VnZXJlbmNpYSBkZSBldmVudG8gZW4gdW4gZXZlbnRvIGRlIGNhbGVuZGFyaW9cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGNvbnZlcnRTdWdnZXN0aW9uVG9DYWxlbmRhckV2ZW50KFxuICBzdWdnZXN0aW9uOiBFdmVudFN1Z2dlc3Rpb24sXG4gIHVzZXJJZDogc3RyaW5nLFxuICBhZGRpdGlvbmFsSW5mbz86IFBhcnRpYWw8RXZlbnRTdWdnZXN0aW9uPlxuKTogQ2FsZW5kYXJFdmVudCB7XG4gIGNvbnN0IG1lcmdlZCA9IHsgLi4uc3VnZ2VzdGlvbiwgLi4uYWRkaXRpb25hbEluZm8gfVxuICBcbiAgLy8gUHJvY2VzYXIgZmVjaGFcbiAgbGV0IGV2ZW50RGF0ZSA9IG5ldyBEYXRlKClcbiAgaWYgKG1lcmdlZC5kYXRlKSB7XG4gICAgZXZlbnREYXRlID0gcGFyc2VEYXRlRnJvbVRleHQobWVyZ2VkLmRhdGUpXG4gIH1cblxuICAvLyBQcm9jZXNhciBob3JhXG4gIGxldCBzdGFydFRpbWUgPSBtZXJnZWQuc3RhcnRUaW1lIHx8ICcxNTowMCdcbiAgbGV0IGVuZFRpbWUgPSBtZXJnZWQuc3RhcnRUaW1lIHx8ICcxNjowMCdcbiAgXG4gIGlmIChtZXJnZWQuZHVyYXRpb24gJiYgbWVyZ2VkLnN0YXJ0VGltZSkge1xuICAgIGNvbnN0IHN0YXJ0ID0gbmV3IERhdGUoYDIwMDAtMDEtMDFUJHttZXJnZWQuc3RhcnRUaW1lfTowMGApXG4gICAgY29uc3QgZW5kID0gbmV3IERhdGUoc3RhcnQuZ2V0VGltZSgpICsgbWVyZ2VkLmR1cmF0aW9uICogNjAwMDApXG4gICAgZW5kVGltZSA9IGVuZC50b1RpbWVTdHJpbmcoKS5zdWJzdHJpbmcoMCwgNSlcbiAgfVxuXG4gIGNvbnN0IGV2ZW50OiBDYWxlbmRhckV2ZW50ID0ge1xuICAgIGlkOiBgYWktZXZlbnQtJHtEYXRlLm5vdygpfWAsXG4gICAgdGl0bGU6IG1lcmdlZC50aXRsZSxcbiAgICBkYXRlOiBldmVudERhdGUsXG4gICAgc3RhcnRUaW1lOiBzdGFydFRpbWUsXG4gICAgZW5kVGltZTogZW5kVGltZSxcbiAgICB0eXBlOiBtZXJnZWQudHlwZSxcbiAgICBjb2xvcjogZ2V0RXZlbnRUeXBlQ29sb3IobWVyZ2VkLnR5cGUpLFxuICAgIHN1YmplY3Q6IG1lcmdlZC5zdWJqZWN0LFxuICAgIGxvY2F0aW9uOiBtZXJnZWQubG9jYXRpb24sXG4gICAgZGVzY3JpcHRpb246IG1lcmdlZC5kZXNjcmlwdGlvbiB8fCAnQ3JlYWRvIGF1dG9tw6F0aWNhbWVudGUgcG9yIElBIFR1dG9yYScsXG4gICAgcHJpb3JpdHk6IG1lcmdlZC5wcmlvcml0eSB8fCAnbWVkaXVtJyxcbiAgICBkdXJhdGlvbjogbWVyZ2VkLmR1cmF0aW9uIHx8IDYwXG4gIH1cblxuICByZXR1cm4gZXZlbnRcbn1cblxuLyoqXG4gKiBDcmVhIHVuIGV2ZW50byBhdXRvbcOhdGljYW1lbnRlIGRlc2RlIGxhIElBIHVzYW5kbyBlbCBBUEkgZW5kcG9pbnQgZGVkaWNhZG9cbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGNyZWF0ZUV2ZW50RnJvbUFJKFxuICBzdWdnZXN0aW9uOiBFdmVudFN1Z2dlc3Rpb24sXG4gIHVzZXJJZDogc3RyaW5nLFxuICBhZGRpdGlvbmFsSW5mbz86IFBhcnRpYWw8RXZlbnRTdWdnZXN0aW9uPlxuKTogUHJvbWlzZTx7IHN1Y2Nlc3M6IGJvb2xlYW47IGV2ZW50PzogQ2FsZW5kYXJFdmVudDsgbWVzc2FnZT86IHN0cmluZyB9PiB7XG4gIHRyeSB7XG4gICAgY29uc3QgbWVyZ2VkID0geyAuLi5zdWdnZXN0aW9uLCAuLi5hZGRpdGlvbmFsSW5mbyB9XG4gICAgXG4gICAgLy8gUHJvY2VzYXIgZmVjaGFcbiAgICBsZXQgZXZlbnREYXRlID0gbmV3IERhdGUoKVxuICAgIGlmIChtZXJnZWQuZGF0ZSkge1xuICAgICAgZXZlbnREYXRlID0gcGFyc2VEYXRlRnJvbVRleHQobWVyZ2VkLmRhdGUpXG4gICAgfVxuICAgIFxuICAgIC8vIENhbGN1bGFyIGVuZFRpbWUgYmFzYWRvIGVuIGR1cmF0aW9uIHkgc3RhcnRUaW1lXG4gICAgbGV0IGVuZFRpbWUgPSBtZXJnZWQuc3RhcnRUaW1lIHx8ICcxNjowMCdcbiAgICBpZiAobWVyZ2VkLmR1cmF0aW9uICYmIG1lcmdlZC5zdGFydFRpbWUpIHtcbiAgICAgIGNvbnN0IHN0YXJ0ID0gbmV3IERhdGUoYDIwMDAtMDEtMDFUJHttZXJnZWQuc3RhcnRUaW1lfTowMGApXG4gICAgICBjb25zdCBlbmQgPSBuZXcgRGF0ZShzdGFydC5nZXRUaW1lKCkgKyBtZXJnZWQuZHVyYXRpb24gKiA2MDAwMClcbiAgICAgIGVuZFRpbWUgPSBlbmQudG9UaW1lU3RyaW5nKCkuc3Vic3RyaW5nKDAsIDUpXG4gICAgfVxuXG4gICAgY29uc3QgZXZlbnREYXRhID0ge1xuICAgICAgdGl0bGU6IG1lcmdlZC50aXRsZSxcbiAgICAgIHR5cGU6IG1lcmdlZC50eXBlLFxuICAgICAgc3ViamVjdDogbWVyZ2VkLnN1YmplY3QsXG4gICAgICBkYXRlOiBldmVudERhdGUudG9JU09TdHJpbmcoKSxcbiAgICAgIHN0YXJ0VGltZTogbWVyZ2VkLnN0YXJ0VGltZSB8fCAnMTU6MDAnLFxuICAgICAgZW5kVGltZTogZW5kVGltZSxcbiAgICAgIGR1cmF0aW9uOiBtZXJnZWQuZHVyYXRpb24gfHwgNjAsXG4gICAgICBsb2NhdGlvbjogbWVyZ2VkLmxvY2F0aW9uLFxuICAgICAgZGVzY3JpcHRpb246IG1lcmdlZC5kZXNjcmlwdGlvbiB8fCBgQ3JlYWRvIGF1dG9tw6F0aWNhbWVudGUgcG9yIElBIFR1dG9yYWAsXG4gICAgICBwcmlvcml0eTogbWVyZ2VkLnByaW9yaXR5IHx8ICdtZWRpdW0nXG4gICAgfVxuXG4gICAgLy8gRm9yIHNlcnZlci1zaWRlIGV4ZWN1dGlvbiwgY2FsbCB0aGUgZnVuY3Rpb24gZGlyZWN0bHkgaW5zdGVhZCBvZiBIVFRQIGZldGNoXG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHsgY3JlYXRlQ2FsZW5kYXJFdmVudCB9ID0gcmVxdWlyZSgnLi4vYXBwL2FwaS9haS1jYWxlbmRhci9jcmVhdGUtZXZlbnQvcm91dGUnKVxuICAgICAgY29uc3QgbW9ja1JlcXVlc3QgPSB7XG4gICAgICAgIGpzb246IGFzeW5jICgpID0+IGV2ZW50RGF0YVxuICAgICAgfVxuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBjcmVhdGVDYWxlbmRhckV2ZW50KG1vY2tSZXF1ZXN0IGFzIGFueSlcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKVxuICAgICAgXG4gICAgICByZXR1cm4ge1xuICAgICAgICBzdWNjZXNzOiByZXN1bHQuc3VjY2VzcyxcbiAgICAgICAgZXZlbnQ6IHJlc3VsdC5ldmVudCxcbiAgICAgICAgbWVzc2FnZTogcmVzdWx0Lm1lc3NhZ2VcbiAgICAgIH1cbiAgICB9IGNhdGNoIChkaXJlY3RDYWxsRXJyb3IpIHtcbiAgICAgIGNvbnNvbGUubG9nKCdEaXJlY3QgQVBJIGNhbGwgZmFpbGVkLCB0cnlpbmcgYWx0ZXJuYXRpdmUgYXBwcm9hY2g6JywgZGlyZWN0Q2FsbEVycm9yKVxuICAgICAgXG4gICAgICAvLyBBbHRlcm5hdGl2ZTogVXNlIGNhbGVuZGFyLWRhdGEgZnVuY3Rpb25zIGRpcmVjdGx5XG4gICAgICBjb25zdCB7IGFkZENhbGVuZGFyRXZlbnQsIGdldFVzZXJDYWxlbmRhckRhdGEsIGNyZWF0ZVVzZXJDYWxlbmRhckRhdGEgfSA9IHJlcXVpcmUoJy4vY2FsZW5kYXItZGF0YScpXG4gICAgICBcbiAgICAgIC8vIEVuc3VyZSB1c2VyIGhhcyBjYWxlbmRhciBkYXRhXG4gICAgICBsZXQgdXNlckRhdGEgPSBnZXRVc2VyQ2FsZW5kYXJEYXRhKHVzZXJJZClcbiAgICAgIGlmICghdXNlckRhdGEpIHtcbiAgICAgICAgY29uc29sZS5sb2coYPCfhpUgQ3JlYXRpbmcgY2FsZW5kYXIgZGF0YSBmb3IgdXNlciAke3VzZXJJZH1gKVxuICAgICAgICB1c2VyRGF0YSA9IGNyZWF0ZVVzZXJDYWxlbmRhckRhdGEodXNlcklkKVxuICAgICAgfVxuICAgICAgXG4gICAgICBjb25zdCBjYWxlbmRhckV2ZW50ID0ge1xuICAgICAgICBpZDogYGFpLWV2ZW50LSR7RGF0ZS5ub3coKX1gLFxuICAgICAgICB0aXRsZTogZXZlbnREYXRhLnRpdGxlLFxuICAgICAgICBkYXRlOiBuZXcgRGF0ZShldmVudERhdGEuZGF0ZSksXG4gICAgICAgIHN0YXJ0VGltZTogZXZlbnREYXRhLnN0YXJ0VGltZSxcbiAgICAgICAgZW5kVGltZTogZXZlbnREYXRhLmVuZFRpbWUsXG4gICAgICAgIHR5cGU6IGV2ZW50RGF0YS50eXBlLFxuICAgICAgICBjb2xvcjogJyMzQjgyRjYnLCAvLyBEZWZhdWx0IGNvbG9yXG4gICAgICAgIHN1YmplY3Q6IGV2ZW50RGF0YS5zdWJqZWN0LFxuICAgICAgICBsb2NhdGlvbjogZXZlbnREYXRhLmxvY2F0aW9uLFxuICAgICAgICBkZXNjcmlwdGlvbjogZXZlbnREYXRhLmRlc2NyaXB0aW9uLFxuICAgICAgICBwcmlvcml0eTogZXZlbnREYXRhLnByaW9yaXR5LFxuICAgICAgICBkdXJhdGlvbjogZXZlbnREYXRhLmR1cmF0aW9uXG4gICAgICB9XG4gICAgICBcbiAgICAgIGNvbnNvbGUubG9nKGDwn5OFIENyZWF0aW5nIGV2ZW50OiAke2NhbGVuZGFyRXZlbnQudGl0bGV9IGZvciAke2V2ZW50RGF0YS5kYXRlfSBhdCAke2V2ZW50RGF0YS5zdGFydFRpbWV9YClcbiAgICAgIGNvbnN0IHN1Y2Nlc3MgPSBhZGRDYWxlbmRhckV2ZW50KHVzZXJJZCwgY2FsZW5kYXJFdmVudClcbiAgICAgIFxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3VjY2VzcyxcbiAgICAgICAgZXZlbnQ6IHN1Y2Nlc3MgPyBjYWxlbmRhckV2ZW50IDogdW5kZWZpbmVkLFxuICAgICAgICBtZXNzYWdlOiBzdWNjZXNzID8gJ0V2ZW50byBjcmVhZG8gZXhpdG9zYW1lbnRlJyA6ICdFcnJvciBhbCBjcmVhciBldmVudG8nXG4gICAgICB9XG4gICAgfVxuXG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgcmVzcG9uc2UuanNvbigpXG4gICAgXG4gICAgaWYgKHJlc3VsdC5zdWNjZXNzKSB7XG4gICAgICBjb25zb2xlLmxvZyhg8J+kliBJQSBjb25maXJtw7MgY3JlYWNpw7NuOiAke3Jlc3VsdC5ldmVudC50aXRsZX1gKVxuICAgICAgXG4gICAgICAvLyBEaXNwYXJhciBldmVudG8gZGVsIGxhZG8gZGVsIGNsaWVudGUgcGFyYSBub3RpZmljYXIgY29tcG9uZW50ZXNcbiAgICAgIGlmICh0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICB3aW5kb3cuZGlzcGF0Y2hFdmVudChuZXcgQ3VzdG9tRXZlbnQoJ2NhbGVuZGFyRXZlbnRDcmVhdGVkJywge1xuICAgICAgICAgICAgZGV0YWlsOiB7IGV2ZW50OiByZXN1bHQuZXZlbnQsIHVzZXJJZCB9XG4gICAgICAgICAgfSkpXG4gICAgICAgIH0sIDIwMClcbiAgICAgIH1cbiAgICAgIFxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgZXZlbnQ6IHJlc3VsdC5ldmVudCxcbiAgICAgICAgbWVzc2FnZTogcmVzdWx0Lm1lc3NhZ2VcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgY29uc29sZS5lcnJvcign4p2MIElBIGZhbGzDsyBhbCBjcmVhciBldmVudG86JywgcmVzdWx0LmVycm9yKVxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIG1lc3NhZ2U6IHJlc3VsdC5lcnJvciB8fCAnRXJyb3IgZGVzY29ub2NpZG8nXG4gICAgICB9XG4gICAgfVxuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBFcnJvciBpbiBBSSBldmVudCBjcmVhdGlvbjonLCBlcnJvcilcbiAgICByZXR1cm4ge1xuICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICBtZXNzYWdlOiAnRXJyb3IgZGUgY29uZXhpw7NuIGFsIGNyZWFyIGV2ZW50bydcbiAgICB9XG4gIH1cbn1cblxuLyoqXG4gKiBQYXJzZWEgZmVjaGFzIGRlc2RlIHRleHRvIG5hdHVyYWxcbiAqL1xuZnVuY3Rpb24gcGFyc2VEYXRlRnJvbVRleHQoZGF0ZVRleHQ6IHN0cmluZyk6IERhdGUge1xuICBjb25zdCB0ZXh0ID0gZGF0ZVRleHQudG9Mb3dlckNhc2UoKVxuICBjb25zdCB0b2RheSA9IG5ldyBEYXRlKClcbiAgXG4gIGlmICh0ZXh0LmluY2x1ZGVzKCdob3knKSkge1xuICAgIHJldHVybiB0b2RheVxuICB9XG4gIFxuICBpZiAodGV4dC5pbmNsdWRlcygnbWHDsWFuYScpIHx8IHRleHQuaW5jbHVkZXMoJ21hW8Oxbl1hbmEnKSkge1xuICAgIGNvbnN0IHRvbW9ycm93ID0gbmV3IERhdGUodG9kYXkpXG4gICAgdG9tb3Jyb3cuc2V0RGF0ZSh0b2RheS5nZXREYXRlKCkgKyAxKVxuICAgIHJldHVybiB0b21vcnJvd1xuICB9XG4gIFxuICBpZiAodGV4dC5pbmNsdWRlcygncGFzYWRvJykpIHtcbiAgICBjb25zdCBkYXlBZnRlclRvbW9ycm93ID0gbmV3IERhdGUodG9kYXkpXG4gICAgZGF5QWZ0ZXJUb21vcnJvdy5zZXREYXRlKHRvZGF5LmdldERhdGUoKSArIDIpXG4gICAgcmV0dXJuIGRheUFmdGVyVG9tb3Jyb3dcbiAgfVxuXG4gIC8vIETDrWFzIGRlIGxhIHNlbWFuYVxuICBjb25zdCBkYXlNYXA6IFJlY29yZDxzdHJpbmcsIG51bWJlcj4gPSB7XG4gICAgJ2x1bmVzJzogMSwgJ21hcnRlcyc6IDIsICdtacOpcmNvbGVzJzogMywgJ21pZXJjb2xlcyc6IDMsXG4gICAgJ2p1ZXZlcyc6IDQsICd2aWVybmVzJzogNSwgJ3PDoWJhZG8nOiA2LCAnc2FiYWRvJzogNiwgJ2RvbWluZ28nOiAwXG4gIH1cblxuICBmb3IgKGNvbnN0IFtkYXlOYW1lLCBkYXlOdW1iZXJdIG9mIE9iamVjdC5lbnRyaWVzKGRheU1hcCkpIHtcbiAgICBpZiAodGV4dC5pbmNsdWRlcyhkYXlOYW1lKSkge1xuICAgICAgY29uc3QgdGFyZ2V0RGF0ZSA9IG5ldyBEYXRlKHRvZGF5KVxuICAgICAgY29uc3QgY3VycmVudERheSA9IHRvZGF5LmdldERheSgpXG4gICAgICBsZXQgZGF5c1RvQWRkID0gZGF5TnVtYmVyIC0gY3VycmVudERheVxuICAgICAgXG4gICAgICBpZiAoZGF5c1RvQWRkIDw9IDApIHtcbiAgICAgICAgZGF5c1RvQWRkICs9IDcgLy8gUHLDs3hpbWEgc2VtYW5hXG4gICAgICB9XG4gICAgICBcbiAgICAgIHRhcmdldERhdGUuc2V0RGF0ZSh0b2RheS5nZXREYXRlKCkgKyBkYXlzVG9BZGQpXG4gICAgICByZXR1cm4gdGFyZ2V0RGF0ZVxuICAgIH1cbiAgfVxuXG4gIC8vIFNpIGluY2x1eWUgbsO6bWVyb3MgKGVqOiBcImVuIDMgZMOtYXNcIilcbiAgY29uc3QgZGF5c01hdGNoID0gdGV4dC5tYXRjaCgvZW5cXHMrKFxcZCspXFxzK2RbacOtXWFzPy8pXG4gIGlmIChkYXlzTWF0Y2gpIHtcbiAgICBjb25zdCBkYXlzID0gcGFyc2VJbnQoZGF5c01hdGNoWzFdKVxuICAgIGNvbnN0IGZ1dHVyZURhdGUgPSBuZXcgRGF0ZSh0b2RheSlcbiAgICBmdXR1cmVEYXRlLnNldERhdGUodG9kYXkuZ2V0RGF0ZSgpICsgZGF5cylcbiAgICByZXR1cm4gZnV0dXJlRGF0ZVxuICB9XG5cbiAgLy8gUG9yIGRlZmVjdG8sIGRldm9sdmVyIG1hw7FhbmFcbiAgY29uc3QgZGVmYXVsdERhdGUgPSBuZXcgRGF0ZSh0b2RheSlcbiAgZGVmYXVsdERhdGUuc2V0RGF0ZSh0b2RheS5nZXREYXRlKCkgKyAxKVxuICByZXR1cm4gZGVmYXVsdERhdGVcbn1cblxuLyoqXG4gKiBHZW5lcmEgcmVzcHVlc3RhIGRlIGxhIElBIHBhcmEgc3VnZXJpciBjcmVhciBldmVudG9zXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBnZW5lcmF0ZUV2ZW50U3VnZ2VzdGlvblJlc3BvbnNlKGFuYWx5c2lzOiBDb252ZXJzYXRpb25BbmFseXNpcyk6IHN0cmluZyB7XG4gIGlmICghYW5hbHlzaXMuaGFzRXZlbnRNZW50aW9uIHx8IGFuYWx5c2lzLmV2ZW50U3VnZ2VzdGlvbnMubGVuZ3RoID09PSAwKSB7XG4gICAgcmV0dXJuIFwiXCJcbiAgfVxuXG4gIGNvbnN0IHN1Z2dlc3Rpb24gPSBhbmFseXNpcy5ldmVudFN1Z2dlc3Rpb25zWzBdIC8vIFRvbWFyIGxhIHByaW1lcmEgc3VnZXJlbmNpYVxuICBcbiAgbGV0IHJlc3BvbnNlID0gYPCfk4UgUGVyZmVjdG8hIFZlbyBxdWUgcXVpZXJlcyBhZ2VuZGFyOiAqKiR7c3VnZ2VzdGlvbi50aXRsZX0qKlxcblxcbmBcbiAgXG4gIC8vIE1vc3RyYXIgaW5mb3JtYWNpw7NuIGRldGVjdGFkYVxuICBjb25zdCBkZXRlY3RlZEluZm86IHN0cmluZ1tdID0gW11cbiAgaWYgKHN1Z2dlc3Rpb24uc3ViamVjdCkgZGV0ZWN0ZWRJbmZvLnB1c2goYPCfk5ogTWF0ZXJpYTogJHtzdWdnZXN0aW9uLnN1YmplY3R9YClcbiAgaWYgKHN1Z2dlc3Rpb24uZGF0ZSkge1xuICAgIGNvbnN0IGRhdGVPYmogPSBuZXcgRGF0ZShzdWdnZXN0aW9uLmRhdGUpXG4gICAgY29uc3QgZm9ybWF0dGVkRGF0ZSA9IGRhdGVPYmoudG9Mb2NhbGVEYXRlU3RyaW5nKCdlcy1FUycsIHtcbiAgICAgIHdlZWtkYXk6ICdsb25nJyxcbiAgICAgIGRheTogJ251bWVyaWMnLCBcbiAgICAgIG1vbnRoOiAnbG9uZydcbiAgICB9KVxuICAgIGRldGVjdGVkSW5mby5wdXNoKGDwn5OFIEZlY2hhOiAke2Zvcm1hdHRlZERhdGV9YClcbiAgfVxuICBpZiAoc3VnZ2VzdGlvbi5zdGFydFRpbWUpIGRldGVjdGVkSW5mby5wdXNoKGDwn5WQIEhvcmE6ICR7c3VnZ2VzdGlvbi5zdGFydFRpbWV9YClcbiAgaWYgKHN1Z2dlc3Rpb24ubG9jYXRpb24pIGRldGVjdGVkSW5mby5wdXNoKGDwn5ONIFViaWNhY2nDs246ICR7c3VnZ2VzdGlvbi5sb2NhdGlvbn1gKVxuICBcbiAgaWYgKGRldGVjdGVkSW5mby5sZW5ndGggPiAwKSB7XG4gICAgcmVzcG9uc2UgKz0gYCoqSW5mb3JtYWNpw7NuIGRldGVjdGFkYToqKlxcbiR7ZGV0ZWN0ZWRJbmZvLmpvaW4oJ1xcbicpfVxcblxcbmBcbiAgfVxuICBcbiAgaWYgKGFuYWx5c2lzLnF1ZXN0aW9ucy5sZW5ndGggPiAwKSB7XG4gICAgcmVzcG9uc2UgKz0gYFBhcmEgY29tcGxldGFyIGVsIGV2ZW50byBuZWNlc2l0bzpcXG5gXG4gICAgYW5hbHlzaXMucXVlc3Rpb25zLmZvckVhY2goKHF1ZXN0aW9uLCBpbmRleCkgPT4ge1xuICAgICAgcmVzcG9uc2UgKz0gYCR7aW5kZXggKyAxfS4gJHtxdWVzdGlvbn1cXG5gXG4gICAgfSlcbiAgICByZXNwb25zZSArPSBgXFxuwr9Qb2Ryw61hcyBkYXJtZSBlc3RvcyBkZXRhbGxlcz9gXG4gIH0gZWxzZSB7XG4gICAgcmVzcG9uc2UgKz0gYMKhVGVuZ28gdG9kYSBsYSBpbmZvcm1hY2nDs24gbmVjZXNhcmlhISDCv0NvbmZpcm1hcyBxdWUgbG8gYWdyZWd1ZSBhIHR1IGNhbGVuZGFyaW8/YFxuICB9XG5cbiAgcmV0dXJuIHJlc3BvbnNlXG59XG5cbi8qKlxuICogSW50ZXJmYXogcGFyYSBlbCB3b3JrZmxvdyBjb21wbGV0byBkZSBjcmVhY2nDs24gZGUgZXZlbnRvcyBwb3IgSUFcbiAqL1xuZXhwb3J0IGNsYXNzIEFJQ2FsZW5kYXJJbnRlZ3JhdGlvbiB7XG4gIHByaXZhdGUgdXNlcklkOiBzdHJpbmdcbiAgcHJpdmF0ZSBwZW5kaW5nU3VnZ2VzdGlvbjogRXZlbnRTdWdnZXN0aW9uIHwgbnVsbCA9IG51bGxcbiAgcHJpdmF0ZSBjb2xsZWN0ZWRJbmZvOiBQYXJ0aWFsPEV2ZW50U3VnZ2VzdGlvbj4gPSB7fVxuXG4gIGNvbnN0cnVjdG9yKHVzZXJJZDogc3RyaW5nKSB7XG4gICAgdGhpcy51c2VySWQgPSB1c2VySWRcbiAgfVxuXG4gIC8qKlxuICAgKiBQcm9jZXNhIHVuIG1lbnNhamUgZGVsIHVzdWFyaW8geSBkZXRlY3RhIHNpIG5lY2VzaXRhIGNyZWFyIGV2ZW50b3NcbiAgICovXG4gIGFzeW5jIHByb2Nlc3NNZXNzYWdlKG1lc3NhZ2U6IHN0cmluZywgY29udmVyc2F0aW9uSGlzdG9yeTogQXJyYXk8eyByb2xlOiAndXNlcicgfCAnYXNzaXN0YW50JywgY29udGVudDogc3RyaW5nIH0+KTogUHJvbWlzZTx7XG4gICAgbmVlZHNFdmVudENyZWF0aW9uOiBib29sZWFuXG4gICAgcmVzcG9uc2U/OiBzdHJpbmdcbiAgICBxdWVzdGlvbnM/OiBzdHJpbmdbXVxuICAgIGV2ZW50PzogQ2FsZW5kYXJFdmVudFxuICB9PiB7XG4gICAgY29uc3QgYW5hbHlzaXMgPSBhbmFseXplQ29udmVyc2F0aW9uRm9yRXZlbnRzKFsuLi5jb252ZXJzYXRpb25IaXN0b3J5LCB7IHJvbGU6ICd1c2VyJywgY29udGVudDogbWVzc2FnZSB9XSlcblxuICAgIGlmIChhbmFseXNpcy5oYXNFdmVudE1lbnRpb24gJiYgYW5hbHlzaXMuZXZlbnRTdWdnZXN0aW9ucy5sZW5ndGggPiAwKSB7XG4gICAgICB0aGlzLnBlbmRpbmdTdWdnZXN0aW9uID0gYW5hbHlzaXMuZXZlbnRTdWdnZXN0aW9uc1swXVxuICAgICAgXG4gICAgICBpZiAoYW5hbHlzaXMucXVlc3Rpb25zLmxlbmd0aCA+IDApIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBuZWVkc0V2ZW50Q3JlYXRpb246IHRydWUsXG4gICAgICAgICAgcmVzcG9uc2U6IGdlbmVyYXRlRXZlbnRTdWdnZXN0aW9uUmVzcG9uc2UoYW5hbHlzaXMpLFxuICAgICAgICAgIHF1ZXN0aW9uczogYW5hbHlzaXMucXVlc3Rpb25zXG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIEluZm9ybWFjacOzbiBjb21wbGV0YSwgY3JlYXIgZXZlbnRvIGRpcmVjdGFtZW50ZVxuICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB0aGlzLmNyZWF0ZVBlbmRpbmdFdmVudCgpXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgbmVlZHNFdmVudENyZWF0aW9uOiB0cnVlLFxuICAgICAgICAgIHJlc3BvbnNlOiByZXN1bHQuc3VjY2VzcyBcbiAgICAgICAgICAgID8gdGhpcy5nZW5lcmF0ZVN1Y2Nlc3NNZXNzYWdlKHJlc3VsdC5ldmVudCEpXG4gICAgICAgICAgICA6IGDinYwgJHtyZXN1bHQubWVzc2FnZSB8fCAnSHVibyB1biBlcnJvciBhbCBjcmVhciBlbCBldmVudG8uIFBvciBmYXZvciBpbnRlbnRhIG51ZXZhbWVudGUuJ31gLFxuICAgICAgICAgIGV2ZW50OiByZXN1bHQuZXZlbnRcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiB7IG5lZWRzRXZlbnRDcmVhdGlvbjogZmFsc2UgfVxuICB9XG5cbiAgLyoqXG4gICAqIFJlY29waWxhIGluZm9ybWFjacOzbiBhZGljaW9uYWwgZGVsIHVzdWFyaW9cbiAgICovXG4gIGNvbGxlY3RBZGRpdGlvbmFsSW5mbyhpbmZvVHlwZTogc3RyaW5nLCB2YWx1ZTogc3RyaW5nKTogYm9vbGVhbiB7XG4gICAgaWYgKCF0aGlzLnBlbmRpbmdTdWdnZXN0aW9uKSByZXR1cm4gZmFsc2VcblxuICAgIHN3aXRjaCAoaW5mb1R5cGUudG9Mb3dlckNhc2UoKSkge1xuICAgICAgY2FzZSAnZmVjaGEnOlxuICAgICAgICB0aGlzLmNvbGxlY3RlZEluZm8uZGF0ZSA9IHZhbHVlXG4gICAgICAgIGJyZWFrXG4gICAgICBjYXNlICdob3JhJzpcbiAgICAgICAgdGhpcy5jb2xsZWN0ZWRJbmZvLnN0YXJ0VGltZSA9IHZhbHVlXG4gICAgICAgIGJyZWFrXG4gICAgICBjYXNlICdtYXRlcmlhJzpcbiAgICAgIGNhc2UgJ3RlbWEnOlxuICAgICAgICB0aGlzLmNvbGxlY3RlZEluZm8uc3ViamVjdCA9IHZhbHVlXG4gICAgICAgIGJyZWFrXG4gICAgICBjYXNlICd1YmljYWNpw7NuJzpcbiAgICAgIGNhc2UgJ3ViaWNhY2lvbic6XG4gICAgICAgIHRoaXMuY29sbGVjdGVkSW5mby5sb2NhdGlvbiA9IHZhbHVlXG4gICAgICAgIGJyZWFrXG4gICAgICBjYXNlICdkdXJhY2nDs24nOlxuICAgICAgY2FzZSAnZHVyYWNpb24nOlxuICAgICAgICB0aGlzLmNvbGxlY3RlZEluZm8uZHVyYXRpb24gPSBwYXJzZUludCh2YWx1ZSlcbiAgICAgICAgYnJlYWtcbiAgICB9XG5cbiAgICByZXR1cm4gdHJ1ZVxuICB9XG5cbiAgLyoqXG4gICAqIENyZWEgZWwgZXZlbnRvIHBlbmRpZW50ZSBjb24gbGEgaW5mb3JtYWNpw7NuIHJlY29waWxhZGFcbiAgICovXG4gIGFzeW5jIGNyZWF0ZVBlbmRpbmdFdmVudCgpOiBQcm9taXNlPHsgc3VjY2VzczogYm9vbGVhbjsgbWVzc2FnZT86IHN0cmluZzsgZXZlbnQ/OiBDYWxlbmRhckV2ZW50IH0+IHtcbiAgICBpZiAoIXRoaXMucGVuZGluZ1N1Z2dlc3Rpb24pIHtcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBtZXNzYWdlOiAnTm8gaGF5IGV2ZW50byBwZW5kaWVudGUnIH1cbiAgICB9XG5cbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjcmVhdGVFdmVudEZyb21BSSh0aGlzLnBlbmRpbmdTdWdnZXN0aW9uLCB0aGlzLnVzZXJJZCwgdGhpcy5jb2xsZWN0ZWRJbmZvKVxuICAgIFxuICAgIGlmIChyZXN1bHQuc3VjY2Vzcykge1xuICAgICAgdGhpcy5wZW5kaW5nU3VnZ2VzdGlvbiA9IG51bGxcbiAgICAgIHRoaXMuY29sbGVjdGVkSW5mbyA9IHt9XG4gICAgfVxuXG4gICAgcmV0dXJuIHJlc3VsdFxuICB9XG5cbiAgLyoqXG4gICAqIENhbmNlbGEgbGEgY3JlYWNpw7NuIGRlbCBldmVudG8gcGVuZGllbnRlXG4gICAqL1xuICBjYW5jZWxQZW5kaW5nRXZlbnQoKTogdm9pZCB7XG4gICAgdGhpcy5wZW5kaW5nU3VnZ2VzdGlvbiA9IG51bGxcbiAgICB0aGlzLmNvbGxlY3RlZEluZm8gPSB7fVxuICB9XG5cbiAgLyoqXG4gICAqIE9idGllbmUgbGEgc3VnZXJlbmNpYSBwZW5kaWVudGVcbiAgICovXG4gIGdldFBlbmRpbmdTdWdnZXN0aW9uKCk6IEV2ZW50U3VnZ2VzdGlvbiB8IG51bGwge1xuICAgIHJldHVybiB0aGlzLnBlbmRpbmdTdWdnZXN0aW9uXG4gIH1cbiAgXG4gIC8qKlxuICAgKiBHZW5lcmEgbWVuc2FqZSBkZSDDqXhpdG8gY29uIGRldGFsbGVzIGRlbCBldmVudG8gY3JlYWRvXG4gICAqL1xuICBwcml2YXRlIGdlbmVyYXRlU3VjY2Vzc01lc3NhZ2UoZXZlbnQ6IENhbGVuZGFyRXZlbnQpOiBzdHJpbmcge1xuICAgIGxldCBtZXNzYWdlID0gYOKchSDCoVBlcmZlY3RvISBIZSBjcmVhZG8gXCIke2V2ZW50LnRpdGxlfVwiIGVuIHR1IGNhbGVuZGFyaW8uYFxuICAgIFxuICAgIC8vIEFncmVnYXIgZGV0YWxsZXMgZXNwZWPDrWZpY29zXG4gICAgY29uc3QgZGV0YWlsczogc3RyaW5nW10gPSBbXVxuICAgIFxuICAgIGlmIChldmVudC5kYXRlKSB7XG4gICAgICBjb25zdCBkYXRlU3RyID0gZXZlbnQuZGF0ZS50b0xvY2FsZURhdGVTdHJpbmcoJ2VzLUVTJywge1xuICAgICAgICB3ZWVrZGF5OiAnbG9uZycsXG4gICAgICAgIGRheTogJ251bWVyaWMnLFxuICAgICAgICBtb250aDogJ2xvbmcnXG4gICAgICB9KVxuICAgICAgZGV0YWlscy5wdXNoKGDwn5OFICoqRmVjaGEqKjogJHtkYXRlU3RyfWApXG4gICAgfVxuICAgIFxuICAgIGlmIChldmVudC5zdGFydFRpbWUpIHtcbiAgICAgIGRldGFpbHMucHVzaChg8J+VkCAqKkhvcmEqKjogJHtldmVudC5zdGFydFRpbWV9YClcbiAgICB9XG4gICAgXG4gICAgaWYgKGV2ZW50LmxvY2F0aW9uKSB7XG4gICAgICBkZXRhaWxzLnB1c2goYPCfk40gKipVYmljYWNpw7NuKio6ICR7ZXZlbnQubG9jYXRpb259YClcbiAgICB9XG4gICAgXG4gICAgaWYgKGV2ZW50LnN1YmplY3QgJiYgZXZlbnQudHlwZSA9PT0gJ2V4YW0nKSB7XG4gICAgICBkZXRhaWxzLnB1c2goYPCfk5ogKipNYXRlcmlhKio6ICR7ZXZlbnQuc3ViamVjdH1gKVxuICAgIH1cbiAgICBcbiAgICBpZiAoZXZlbnQuZGVzY3JpcHRpb24gJiYgIWV2ZW50LmRlc2NyaXB0aW9uLmluY2x1ZGVzKCdDcmVhZG8gYXV0b23DoXRpY2FtZW50ZScpKSB7XG4gICAgICBkZXRhaWxzLnB1c2goYPCfk50gKipUZW1hKio6ICR7ZXZlbnQuZGVzY3JpcHRpb259YClcbiAgICB9XG4gICAgXG4gICAgaWYgKGRldGFpbHMubGVuZ3RoID4gMCkge1xuICAgICAgbWVzc2FnZSArPSBgXFxuXFxuKipEZXRhbGxlcyBkZWwgZXZlbnRvOioqXFxuJHtkZXRhaWxzLmpvaW4oJ1xcbicpfWBcbiAgICB9XG4gICAgXG4gICAgbWVzc2FnZSArPSBgXFxuXFxu8J+OryBQdWVkZXMgdmVyIHRvZG9zIHR1cyBldmVudG9zIGVuIGxhIHNlY2Npw7NuIFwiT3JnYW5pemFkb3IgSW50ZWxpZ2VudGVcIiBkZSB0dSBjYWxlbmRhcmlvLmBcbiAgICBcbiAgICByZXR1cm4gbWVzc2FnZVxuICB9XG59XG5cbi8qKlxuICogQnVzY2EgZXZlbnRvcyBkZWwgdXN1YXJpbyBwb3IgdGV4dG8gZGUgYsO6c3F1ZWRhXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBmaW5kVXNlckV2ZW50cyh1c2VySWQ6IHN0cmluZywgc2VhcmNoVGV4dDogc3RyaW5nKTogQ2FsZW5kYXJFdmVudFtdIHtcbiAgY29uc3QgdXNlckRhdGEgPSBnZXRVc2VyQ2FsZW5kYXJEYXRhKHVzZXJJZClcbiAgaWYgKCF1c2VyRGF0YSkgcmV0dXJuIFtdXG4gIFxuICBjb25zdCBzZWFyY2ggPSBzZWFyY2hUZXh0LnRvTG93ZXJDYXNlKClcbiAgcmV0dXJuIHVzZXJEYXRhLmV2ZW50cy5maWx0ZXIoZXZlbnQgPT4ge1xuICAgIHJldHVybiBldmVudC50aXRsZS50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKHNlYXJjaCkgfHxcbiAgICAgICAgICAgZXZlbnQuc3ViamVjdD8udG9Mb3dlckNhc2UoKS5pbmNsdWRlcyhzZWFyY2gpIHx8XG4gICAgICAgICAgIGV2ZW50LmRlc2NyaXB0aW9uPy50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKHNlYXJjaCkgfHxcbiAgICAgICAgICAgZXZlbnQubG9jYXRpb24/LnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMoc2VhcmNoKVxuICB9KVxufVxuXG4vKipcbiAqIEVkaXRhIHVuIGV2ZW50byB1c2FuZG8gZWwgQVBJIGVuZHBvaW50XG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBlZGl0RXZlbnRGcm9tQUkoXG4gIGV2ZW50SWQ6IHN0cmluZyxcbiAgdXBkYXRlczogUGFydGlhbDxDYWxlbmRhckV2ZW50PlxuKTogUHJvbWlzZTx7IHN1Y2Nlc3M6IGJvb2xlYW47IGV2ZW50PzogQ2FsZW5kYXJFdmVudDsgbWVzc2FnZT86IHN0cmluZyB9PiB7XG4gIHRyeSB7XG4gICAgLy8gRm9yIHNlcnZlci1zaWRlIGV4ZWN1dGlvbiwgY2FsbCB0aGUgZnVuY3Rpb24gZGlyZWN0bHlcbiAgICB0cnkge1xuICAgICAgY29uc3QgeyB1cGRhdGVDYWxlbmRhckV2ZW50IH0gPSByZXF1aXJlKCcuL2NhbGVuZGFyLWRhdGEnKVxuICAgICAgY29uc3Qgc3VjY2VzcyA9IHVwZGF0ZUNhbGVuZGFyRXZlbnQoZXZlbnRJZCwgdXBkYXRlcylcbiAgICAgIFxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3VjY2VzcyxcbiAgICAgICAgZXZlbnQ6IHN1Y2Nlc3MgPyB7IGlkOiBldmVudElkLCAuLi51cGRhdGVzIH0gOiB1bmRlZmluZWQsXG4gICAgICAgIG1lc3NhZ2U6IHN1Y2Nlc3MgPyAnRXZlbnRvIGFjdHVhbGl6YWRvIGV4aXRvc2FtZW50ZScgOiAnRXJyb3IgYWwgYWN0dWFsaXphciBldmVudG8nXG4gICAgICB9XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIHVwZGF0aW5nIGV2ZW50OicsIGVycm9yKVxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIG1lc3NhZ2U6ICdFcnJvciBhbCBhY3R1YWxpemFyIGV2ZW50bydcbiAgICAgIH1cbiAgICB9XG5cbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCByZXNwb25zZS5qc29uKClcbiAgICBcbiAgICBpZiAocmVzdWx0LnN1Y2Nlc3MpIHtcbiAgICAgIGNvbnNvbGUubG9nKGDwn6SWIElBIGVkaXTDsyBldmVudG86ICR7cmVzdWx0LmV2ZW50LnRpdGxlfWApXG4gICAgICBcbiAgICAgIC8vIERpc3BhcmFyIGV2ZW50byBkZWwgbGFkbyBkZWwgY2xpZW50ZVxuICAgICAgaWYgKHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgIHdpbmRvdy5kaXNwYXRjaEV2ZW50KG5ldyBDdXN0b21FdmVudCgnY2FsZW5kYXJFdmVudFVwZGF0ZWQnLCB7XG4gICAgICAgICAgICBkZXRhaWw6IHsgZXZlbnQ6IHJlc3VsdC5ldmVudCwgZXZlbnRJZCB9XG4gICAgICAgICAgfSkpXG4gICAgICAgIH0sIDIwMClcbiAgICAgIH1cbiAgICAgIFxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgZXZlbnQ6IHJlc3VsdC5ldmVudCxcbiAgICAgICAgbWVzc2FnZTogcmVzdWx0Lm1lc3NhZ2VcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIG1lc3NhZ2U6IHJlc3VsdC5lcnJvciB8fCAnRXJyb3IgZGVzY29ub2NpZG8gYWwgZWRpdGFyJ1xuICAgICAgfVxuICAgIH1cbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCfinYwgRXJyb3IgZWRpdGluZyBldmVudCBmcm9tIEFJOicsIGVycm9yKVxuICAgIHJldHVybiB7XG4gICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgIG1lc3NhZ2U6ICdFcnJvciBkZSBjb25leGnDs24gYWwgZWRpdGFyIGV2ZW50bydcbiAgICB9XG4gIH1cbn1cblxuLyoqXG4gKiBFbGltaW5hIHVuIGV2ZW50byB1c2FuZG8gZWwgQVBJIGVuZHBvaW50XG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBkZWxldGVFdmVudEZyb21BSShcbiAgZXZlbnRJZDogc3RyaW5nXG4pOiBQcm9taXNlPHsgc3VjY2VzczogYm9vbGVhbjsgbWVzc2FnZT86IHN0cmluZyB9PiB7XG4gIHRyeSB7XG4gICAgLy8gRm9yIHNlcnZlci1zaWRlIGV4ZWN1dGlvbiwgY2FsbCB0aGUgZnVuY3Rpb24gZGlyZWN0bHlcbiAgICB0cnkge1xuICAgICAgY29uc3QgeyBkZWxldGVDYWxlbmRhckV2ZW50IH0gPSByZXF1aXJlKCcuL2NhbGVuZGFyLWRhdGEnKVxuICAgICAgY29uc3QgZGVsZXRlZEV2ZW50ID0gZGVsZXRlQ2FsZW5kYXJFdmVudChldmVudElkKVxuICAgICAgXG4gICAgICByZXR1cm4ge1xuICAgICAgICBzdWNjZXNzOiAhIWRlbGV0ZWRFdmVudCxcbiAgICAgICAgbWVzc2FnZTogZGVsZXRlZEV2ZW50ID8gXG4gICAgICAgICAgYEV2ZW50byBcIiR7ZGVsZXRlZEV2ZW50LnRpdGxlfVwiIGVsaW1pbmFkbyBleGl0b3NhbWVudGVgIDogXG4gICAgICAgICAgJ0V2ZW50byBubyBlbmNvbnRyYWRvJ1xuICAgICAgfVxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBkZWxldGluZyBldmVudDonLCBlcnJvcilcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBtZXNzYWdlOiAnRXJyb3IgYWwgZWxpbWluYXIgZXZlbnRvJ1xuICAgICAgfVxuICAgIH1cblxuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKVxuICAgIFxuICAgIGlmIChyZXN1bHQuc3VjY2Vzcykge1xuICAgICAgY29uc29sZS5sb2coYPCfpJYgSUEgZWxpbWluw7MgZXZlbnRvOiAke3Jlc3VsdC5kZWxldGVkRXZlbnQudGl0bGV9YClcbiAgICAgIFxuICAgICAgLy8gRGlzcGFyYXIgZXZlbnRvIGRlbCBsYWRvIGRlbCBjbGllbnRlXG4gICAgICBpZiAodHlwZW9mIHdpbmRvdyAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgd2luZG93LmRpc3BhdGNoRXZlbnQobmV3IEN1c3RvbUV2ZW50KCdjYWxlbmRhckV2ZW50RGVsZXRlZCcsIHtcbiAgICAgICAgICAgIGRldGFpbDogeyBldmVudElkLCB0aXRsZTogcmVzdWx0LmRlbGV0ZWRFdmVudC50aXRsZSB9XG4gICAgICAgICAgfSkpXG4gICAgICAgIH0sIDIwMClcbiAgICAgIH1cbiAgICAgIFxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgbWVzc2FnZTogcmVzdWx0Lm1lc3NhZ2VcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIG1lc3NhZ2U6IHJlc3VsdC5lcnJvciB8fCAnRXJyb3IgZGVzY29ub2NpZG8gYWwgZWxpbWluYXInXG4gICAgICB9XG4gICAgfVxuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBFcnJvciBkZWxldGluZyBldmVudCBmcm9tIEFJOicsIGVycm9yKVxuICAgIHJldHVybiB7XG4gICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgIG1lc3NhZ2U6ICdFcnJvciBkZSBjb25leGnDs24gYWwgZWxpbWluYXIgZXZlbnRvJ1xuICAgIH1cbiAgfVxufVxuXG4vKipcbiAqIE5vcm1hbGl6YSBub21icmVzIGRlIG1hdGVyaWFzIGNvbiBhY2VudG9zIHkgbWF5w7pzY3VsYXMgY29ycmVjdGFzXG4gKi9cbmZ1bmN0aW9uIG5vcm1hbGl6ZVN1YmplY3ROYW1lKHN1YmplY3Q/OiBzdHJpbmcgfCBudWxsKTogc3RyaW5nIHwgbnVsbCB7XG4gIGlmICghc3ViamVjdCkgcmV0dXJuIG51bGxcbiAgXG4gIGNvbnN0IG5vcm1hbGl6ZWQgPSBzdWJqZWN0LnRvTG93ZXJDYXNlKCkudHJpbSgpXG4gIFxuICBjb25zdCBzdWJqZWN0TWFwOiBSZWNvcmQ8c3RyaW5nLCBzdHJpbmc+ID0ge1xuICAgICdxdWltaWNhJzogJ1F1w61taWNhJyxcbiAgICAncXXDrW1pY2EnOiAnUXXDrW1pY2EnLFxuICAgICdmaXNpY2EnOiAnRsOtc2ljYScsXG4gICAgJ2bDrXNpY2EnOiAnRsOtc2ljYScsXG4gICAgJ21hdGVtYXRpY2EnOiAnTWF0ZW3DoXRpY2EnLFxuICAgICdtYXRlbcOhdGljYXMnOiAnTWF0ZW3DoXRpY2FzJyxcbiAgICAnbWF0ZW1hdGljYXMnOiAnTWF0ZW3DoXRpY2FzJyxcbiAgICAnYmlvbG9naWEnOiAnQmlvbG9nw61hJyxcbiAgICAnYmlvbG9nw61hJzogJ0Jpb2xvZ8OtYScsXG4gICAgJ2hpc3RvcmlhJzogJ0hpc3RvcmlhJyxcbiAgICAnZ2VvZ3JhZmlhJzogJ0dlb2dyYWbDrWEnLFxuICAgICdnZW9ncmFmw61hJzogJ0dlb2dyYWbDrWEnLFxuICAgICdpbmdsZXMnOiAnSW5nbMOpcycsXG4gICAgJ2luZ2zDqXMnOiAnSW5nbMOpcycsXG4gICAgJ2xlbmd1YSc6ICdMZW5ndWEgeSBMaXRlcmF0dXJhJyxcbiAgICAnbGl0ZXJhdHVyYSc6ICdMZW5ndWEgeSBMaXRlcmF0dXJhJyxcbiAgICAnZmlsb3NvZmlhJzogJ0ZpbG9zb2bDrWEnLFxuICAgICdmaWxvc29mw61hJzogJ0ZpbG9zb2bDrWEnLFxuICAgICdlY29ub21pYSc6ICdFY29ub23DrWEnLFxuICAgICdlY29ub23DrWEnOiAnRWNvbm9tw61hJyxcbiAgICAnZWR1Y2FjaW9uIGZpc2ljYSc6ICdFZHVjYWNpw7NuIEbDrXNpY2EnLFxuICAgICdlZHVjYWNpw7NuIGbDrXNpY2EnOiAnRWR1Y2FjacOzbiBGw61zaWNhJyxcbiAgICAnZWQgZmlzaWNhJzogJ0VkdWNhY2nDs24gRsOtc2ljYScsXG4gICAgJ2FydGUnOiAnQXJ0ZScsXG4gICAgJ211c2ljYSc6ICdNw7pzaWNhJyxcbiAgICAnbcO6c2ljYSc6ICdNw7pzaWNhJ1xuICB9XG4gIFxuICAvLyBCdXNjYXIgY29pbmNpZGVuY2lhIGV4YWN0YSBwcmltZXJvXG4gIGlmIChzdWJqZWN0TWFwW25vcm1hbGl6ZWRdKSB7XG4gICAgcmV0dXJuIHN1YmplY3RNYXBbbm9ybWFsaXplZF1cbiAgfVxuICBcbiAgLy8gQnVzY2FyIGNvaW5jaWRlbmNpYSBwYXJjaWFsXG4gIGZvciAoY29uc3QgW2tleSwgdmFsdWVdIG9mIE9iamVjdC5lbnRyaWVzKHN1YmplY3RNYXApKSB7XG4gICAgaWYgKGtleS5pbmNsdWRlcyhub3JtYWxpemVkKSB8fCBub3JtYWxpemVkLmluY2x1ZGVzKGtleSkpIHtcbiAgICAgIHJldHVybiB2YWx1ZVxuICAgIH1cbiAgfVxuICBcbiAgLy8gU2kgbm8gc2UgZW5jdWVudHJhLCBjYXBpdGFsaXphciBwcmltZXJhIGxldHJhXG4gIHJldHVybiBzdWJqZWN0LmNoYXJBdCgwKS50b1VwcGVyQ2FzZSgpICsgc3ViamVjdC5zbGljZSgxKS50b0xvd2VyQ2FzZSgpXG59Il0sIm5hbWVzIjpbImdldEV2ZW50VHlwZUNvbG9yIiwiZ2V0VXNlckNhbGVuZGFyRGF0YSIsImFuYWx5emVDb252ZXJzYXRpb25Gb3JFdmVudHMiLCJjb252ZXJzYXRpb25IaXN0b3J5IiwidXNlck1lc3NhZ2VzIiwiZmlsdGVyIiwibXNnIiwicm9sZSIsIm1hcCIsImNvbnRlbnQiLCJqb2luIiwiYW5hbHlzaXMiLCJoYXNFdmVudE1lbnRpb24iLCJldmVudFN1Z2dlc3Rpb25zIiwicXVlc3Rpb25zIiwibWlzc2luZ0luZm8iLCJsYXN0VXNlck1lc3NhZ2UiLCJsZW5ndGgiLCJtc2dMb3dlciIsInRvTG93ZXJDYXNlIiwiYWdlbmRhclBhdHRlcm5zIiwiaXNSZXF1ZXN0aW5nVG9TY2hlZHVsZSIsInRlc3QiLCJlZGl0YXJQYXR0ZXJucyIsImlzUmVxdWVzdGluZ1RvRWRpdCIsImVsaW1pbmFyUGF0dGVybnMiLCJpc1JlcXVlc3RpbmdUb0RlbGV0ZSIsImV2ZW50RGF0YSIsImV4dHJhY3RFdmVudERhdGFGcm9tTWVzc2FnZSIsImhhc0V2ZW50Iiwibm9ybWFsaXplZFN1YmplY3QiLCJub3JtYWxpemVTdWJqZWN0TmFtZSIsInN1YmplY3QiLCJwdXNoIiwidHlwZSIsInRpdGxlIiwiZGF0ZSIsInN0YXJ0VGltZSIsImR1cmF0aW9uIiwibG9jYXRpb24iLCJkZXNjcmlwdGlvbiIsInByaW9yaXR5IiwiY29uZmlkZW5jZSIsInN1Z2dlc3Rpb24iLCJtZXNzYWdlIiwiZXZlbnRUeXBlIiwic3ViamVjdFBhdHRlcm5zIiwicGF0dGVybiIsIm1hdGNoIiwiY2hhckF0IiwidG9VcHBlckNhc2UiLCJzbGljZSIsInNwZWNpZmljRGF0ZVBhdHRlcm5zIiwic291cmNlIiwiaW5jbHVkZXMiLCJkYXkiLCJwYXJzZUludCIsIm1vbnRoTmFtZSIsIm1vbnRoTWFwIiwidW5kZWZpbmVkIiwibm93IiwiRGF0ZSIsImV2ZW50RGF0ZSIsImdldEZ1bGxZZWFyIiwidG9JU09TdHJpbmciLCJzcGxpdCIsImlzTmFOIiwibW9udGgiLCJnZXRNb250aCIsInllYXIiLCJyZWxhdGl2ZURhdGVQYXR0ZXJucyIsImRheXMiLCJ0YXJnZXREYXkiLCJnZXRUaW1lIiwiY3VycmVudERheSIsImdldERheSIsImRheXNUb0FkZCIsInRpbWVQYXR0ZXJucyIsImhvdXIiLCJtaW51dGUiLCJwZXJpb2QiLCJ0b1N0cmluZyIsInBhZFN0YXJ0IiwibG9jYXRpb25QYXR0ZXJucyIsInJlcGxhY2UiLCJ0cmltIiwiZHVyYXRpb25NYXRjaCIsInZhbHVlIiwidW5pdCIsInRvcGljUGF0dGVybnMiLCJnZW5lcmF0ZUV2ZW50UXVlc3Rpb25zIiwiY29udmVydFN1Z2dlc3Rpb25Ub0NhbGVuZGFyRXZlbnQiLCJ1c2VySWQiLCJhZGRpdGlvbmFsSW5mbyIsIm1lcmdlZCIsInBhcnNlRGF0ZUZyb21UZXh0IiwiZW5kVGltZSIsInN0YXJ0IiwiZW5kIiwidG9UaW1lU3RyaW5nIiwic3Vic3RyaW5nIiwiZXZlbnQiLCJpZCIsImNvbG9yIiwiY3JlYXRlRXZlbnRGcm9tQUkiLCJjcmVhdGVDYWxlbmRhckV2ZW50IiwicmVxdWlyZSIsIm1vY2tSZXF1ZXN0IiwianNvbiIsInJlc3BvbnNlIiwicmVzdWx0Iiwic3VjY2VzcyIsImRpcmVjdENhbGxFcnJvciIsImNvbnNvbGUiLCJsb2ciLCJhZGRDYWxlbmRhckV2ZW50IiwiY3JlYXRlVXNlckNhbGVuZGFyRGF0YSIsInVzZXJEYXRhIiwiY2FsZW5kYXJFdmVudCIsInNldFRpbWVvdXQiLCJ3aW5kb3ciLCJkaXNwYXRjaEV2ZW50IiwiQ3VzdG9tRXZlbnQiLCJkZXRhaWwiLCJlcnJvciIsImRhdGVUZXh0IiwidGV4dCIsInRvZGF5IiwidG9tb3Jyb3ciLCJzZXREYXRlIiwiZ2V0RGF0ZSIsImRheUFmdGVyVG9tb3Jyb3ciLCJkYXlNYXAiLCJkYXlOYW1lIiwiZGF5TnVtYmVyIiwiT2JqZWN0IiwiZW50cmllcyIsInRhcmdldERhdGUiLCJkYXlzTWF0Y2giLCJmdXR1cmVEYXRlIiwiZGVmYXVsdERhdGUiLCJnZW5lcmF0ZUV2ZW50U3VnZ2VzdGlvblJlc3BvbnNlIiwiZGV0ZWN0ZWRJbmZvIiwiZGF0ZU9iaiIsImZvcm1hdHRlZERhdGUiLCJ0b0xvY2FsZURhdGVTdHJpbmciLCJ3ZWVrZGF5IiwiZm9yRWFjaCIsInF1ZXN0aW9uIiwiaW5kZXgiLCJBSUNhbGVuZGFySW50ZWdyYXRpb24iLCJjb25zdHJ1Y3RvciIsInBlbmRpbmdTdWdnZXN0aW9uIiwiY29sbGVjdGVkSW5mbyIsInByb2Nlc3NNZXNzYWdlIiwibmVlZHNFdmVudENyZWF0aW9uIiwiY3JlYXRlUGVuZGluZ0V2ZW50IiwiZ2VuZXJhdGVTdWNjZXNzTWVzc2FnZSIsImNvbGxlY3RBZGRpdGlvbmFsSW5mbyIsImluZm9UeXBlIiwiY2FuY2VsUGVuZGluZ0V2ZW50IiwiZ2V0UGVuZGluZ1N1Z2dlc3Rpb24iLCJkZXRhaWxzIiwiZGF0ZVN0ciIsImZpbmRVc2VyRXZlbnRzIiwic2VhcmNoVGV4dCIsInNlYXJjaCIsImV2ZW50cyIsImVkaXRFdmVudEZyb21BSSIsImV2ZW50SWQiLCJ1cGRhdGVzIiwidXBkYXRlQ2FsZW5kYXJFdmVudCIsImRlbGV0ZUV2ZW50RnJvbUFJIiwiZGVsZXRlQ2FsZW5kYXJFdmVudCIsImRlbGV0ZWRFdmVudCIsIm5vcm1hbGl6ZWQiLCJzdWJqZWN0TWFwIiwia2V5Il0sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/calendar-ai-integration.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/calendar-data.ts":
/*!**********************************!*\
  !*** ./src/lib/calendar-data.ts ***!
  \**********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   addCalendarEvent: () => (/* binding */ addCalendarEvent),\n/* harmony export */   createUserCalendarData: () => (/* binding */ createUserCalendarData),\n/* harmony export */   deleteCalendarEvent: () => (/* binding */ deleteCalendarEvent),\n/* harmony export */   findAvailableTimeSlots: () => (/* binding */ findAvailableTimeSlots),\n/* harmony export */   getEventTypeColor: () => (/* binding */ getEventTypeColor),\n/* harmony export */   getEventTypeIcon: () => (/* binding */ getEventTypeIcon),\n/* harmony export */   getEventsForDate: () => (/* binding */ getEventsForDate),\n/* harmony export */   getEventsForDateRange: () => (/* binding */ getEventsForDateRange),\n/* harmony export */   getUserCalendarData: () => (/* binding */ getUserCalendarData),\n/* harmony export */   isTimeSlotAvailable: () => (/* binding */ isTimeSlotAvailable),\n/* harmony export */   tempCalendarData: () => (/* binding */ tempCalendarData),\n/* harmony export */   updateCalendarEvent: () => (/* binding */ updateCalendarEvent),\n/* harmony export */   updateUserCalendarData: () => (/* binding */ updateUserCalendarData)\n/* harmony export */ });\n// Calendar Data Models for Smart Calendar\n// Temporary storage for calendar data\nconst globalForCalendarData = globalThis;\nconst tempCalendarData = globalForCalendarData.tempCalendarData ?? [];\nglobalForCalendarData.tempCalendarData = tempCalendarData;\n// Calendar Data Management Functions\nfunction getUserCalendarData(userId) {\n    return tempCalendarData.find((data)=>data.userId === userId);\n}\nfunction createUserCalendarData(userId) {\n    const newData = {\n        userId,\n        schoolSchedule: {\n            monday: [],\n            tuesday: [],\n            wednesday: [],\n            thursday: [],\n            friday: []\n        },\n        studyPreferences: {\n            preferredStudyTime: 'afternoon',\n            dailyStudyHours: 3,\n            maxSessionDuration: 90,\n            breakBetweenSessions: 15,\n            weekendStudyHours: 4,\n            noStudyDays: [\n                0\n            ] // Sunday\n        },\n        events: [],\n        isSetupComplete: false,\n        lastUpdated: new Date()\n    };\n    tempCalendarData.push(newData);\n    return newData;\n}\nfunction updateUserCalendarData(userId, updates) {\n    const index = tempCalendarData.findIndex((data)=>data.userId === userId);\n    if (index !== -1) {\n        tempCalendarData[index] = {\n            ...tempCalendarData[index],\n            ...updates,\n            lastUpdated: new Date()\n        };\n        return true;\n    }\n    return false;\n}\nfunction addCalendarEvent(userId, event) {\n    const userData = getUserCalendarData(userId);\n    if (userData) {\n        userData.events.push(event);\n        userData.lastUpdated = new Date();\n        // Force update in global storage\n        const index = tempCalendarData.findIndex((data)=>data.userId === userId);\n        if (index !== -1) {\n            tempCalendarData[index] = userData;\n        }\n        console.log(`üìÖ Evento agregado: ${event.title} - Total eventos: ${userData.events.length}`);\n        return true;\n    }\n    return false;\n}\nfunction updateCalendarEvent(userId, eventId, updates) {\n    const userData = getUserCalendarData(userId);\n    if (userData) {\n        const eventIndex = userData.events.findIndex((e)=>e.id === eventId);\n        if (eventIndex !== -1) {\n            userData.events[eventIndex] = {\n                ...userData.events[eventIndex],\n                ...updates\n            };\n            userData.lastUpdated = new Date();\n            // Force update in global storage\n            const index = tempCalendarData.findIndex((data)=>data.userId === userId);\n            if (index !== -1) {\n                tempCalendarData[index] = userData;\n            }\n            console.log(`üìÖ Evento actualizado: ${userData.events[eventIndex].title}`);\n            return true;\n        }\n    }\n    return false;\n}\nfunction deleteCalendarEvent(userId, eventId) {\n    const userData = getUserCalendarData(userId);\n    if (userData) {\n        const eventIndex = userData.events.findIndex((e)=>e.id === eventId);\n        if (eventIndex !== -1) {\n            const deletedEvent = userData.events[eventIndex];\n            userData.events.splice(eventIndex, 1);\n            userData.lastUpdated = new Date();\n            // Force update in global storage\n            const index = tempCalendarData.findIndex((data)=>data.userId === userId);\n            if (index !== -1) {\n                tempCalendarData[index] = userData;\n            }\n            console.log(`üìÖ Evento eliminado: ${deletedEvent.title} - Total eventos: ${userData.events.length}`);\n            return true;\n        }\n    }\n    return false;\n}\nfunction getEventsForDate(userId, date) {\n    const userData = getUserCalendarData(userId);\n    if (!userData) return [];\n    const targetDate = new Date(date);\n    targetDate.setHours(0, 0, 0, 0);\n    return userData.events.filter((event)=>{\n        const eventDate = new Date(event.date);\n        eventDate.setHours(0, 0, 0, 0);\n        return eventDate.getTime() === targetDate.getTime();\n    });\n}\nfunction getEventsForDateRange(userId, startDate, endDate) {\n    const userData = getUserCalendarData(userId);\n    if (!userData) return [];\n    return userData.events.filter((event)=>{\n        const eventDate = new Date(event.date);\n        return eventDate >= startDate && eventDate <= endDate;\n    });\n}\n// Utility functions for calendar operations\nfunction isTimeSlotAvailable(userId, date, startTime, endTime) {\n    const userData = getUserCalendarData(userId);\n    if (!userData) return true;\n    const dayName = getDayName(date.getDay());\n    const schoolSlots = userData.schoolSchedule[dayName] || [];\n    // Check school schedule conflicts\n    for (const slot of schoolSlots){\n        if (timeOverlaps(startTime, endTime, slot.start, slot.end)) {\n            return false;\n        }\n    }\n    // Check existing events\n    const dayEvents = getEventsForDate(userId, date);\n    for (const event of dayEvents){\n        if (event.startTime && event.endTime) {\n            if (timeOverlaps(startTime, endTime, event.startTime, event.endTime)) {\n                return false;\n            }\n        }\n    }\n    return true;\n}\nfunction findAvailableTimeSlots(userId, date, duration, preferredTime) {\n    const userData = getUserCalendarData(userId);\n    if (!userData) return [];\n    const slots = [];\n    // Define time ranges based on preference\n    const timeRanges = {\n        morning: [\n            '08:00',\n            '12:00'\n        ],\n        afternoon: [\n            '14:00',\n            '18:00'\n        ],\n        evening: [\n            '19:00',\n            '22:00'\n        ]\n    };\n    const searchRange = preferredTime ? timeRanges[preferredTime] : [\n        '08:00',\n        '22:00'\n    ];\n    const [searchStart, searchEnd] = searchRange;\n    // Generate potential slots every 30 minutes\n    const startMinutes = timeToMinutes(searchStart);\n    const endMinutes = timeToMinutes(searchEnd);\n    for(let minutes = startMinutes; minutes <= endMinutes - duration; minutes += 30){\n        const slotStart = minutesToTime(minutes);\n        const slotEnd = minutesToTime(minutes + duration);\n        if (isTimeSlotAvailable(userId, date, slotStart, slotEnd)) {\n            slots.push({\n                start: slotStart,\n                end: slotEnd\n            });\n        }\n    }\n    return slots;\n}\nfunction getEventTypeColor(type) {\n    const colors = {\n        exam: '#EF4444',\n        study_session: '#3B82F6',\n        class: '#10B981',\n        personal: '#8B5CF6',\n        extracurricular: '#F59E0B' // Orange\n    };\n    return colors[type] || '#64748B';\n}\nfunction getEventTypeIcon(type) {\n    const icons = {\n        exam: 'üìù',\n        study_session: 'üìö',\n        class: 'üéì',\n        personal: 'üë§',\n        extracurricular: 'üèÉ‚Äç‚ôÄÔ∏è'\n    };\n    return icons[type] || 'üìÖ';\n}\n// Helper functions\nfunction getDayName(dayIndex) {\n    const days = [\n        'sunday',\n        'monday',\n        'tuesday',\n        'wednesday',\n        'thursday',\n        'friday',\n        'saturday'\n    ];\n    return days[dayIndex];\n}\nfunction timeToMinutes(time) {\n    const [hours, minutes] = time.split(':').map(Number);\n    return hours * 60 + minutes;\n}\nfunction minutesToTime(minutes) {\n    const hours = Math.floor(minutes / 60);\n    const mins = minutes % 60;\n    return `${hours.toString().padStart(2, '0')}:${mins.toString().padStart(2, '0')}`;\n}\nfunction timeOverlaps(start1, end1, start2, end2) {\n    const start1Minutes = timeToMinutes(start1);\n    const end1Minutes = timeToMinutes(end1);\n    const start2Minutes = timeToMinutes(start2);\n    const end2Minutes = timeToMinutes(end2);\n    return start1Minutes < end2Minutes && end1Minutes > start2Minutes;\n}\n// Initialize demo data\nfunction initDemoCalendarData() {\n    const demoUserId = \"demo-student-fixed\";\n    if (!getUserCalendarData(demoUserId)) {\n        console.log(\"üìÖ Inicializando datos de calendario demo...\");\n        const demoData = createUserCalendarData(demoUserId);\n        // Demo school schedule\n        demoData.schoolSchedule = {\n            monday: [\n                {\n                    start: '08:00',\n                    end: '09:30',\n                    subject: 'Matem√°ticas',\n                    location: 'Aula 201',\n                    color: '#3B82F6'\n                },\n                {\n                    start: '09:45',\n                    end: '11:15',\n                    subject: 'Qu√≠mica',\n                    location: 'Laboratorio A',\n                    color: '#EF4444'\n                },\n                {\n                    start: '11:30',\n                    end: '13:00',\n                    subject: 'Historia',\n                    location: 'Aula 105',\n                    color: '#8B5CF6'\n                }\n            ],\n            tuesday: [\n                {\n                    start: '08:00',\n                    end: '09:30',\n                    subject: 'F√≠sica',\n                    location: 'Laboratorio B',\n                    color: '#10B981'\n                },\n                {\n                    start: '09:45',\n                    end: '11:15',\n                    subject: 'Literatura',\n                    location: 'Aula 203',\n                    color: '#F59E0B'\n                },\n                {\n                    start: '11:30',\n                    end: '13:00',\n                    subject: 'Biolog√≠a',\n                    location: 'Laboratorio C',\n                    color: '#EC4899'\n                }\n            ],\n            wednesday: [\n                {\n                    start: '08:00',\n                    end: '09:30',\n                    subject: 'Matem√°ticas',\n                    location: 'Aula 201',\n                    color: '#3B82F6'\n                },\n                {\n                    start: '09:45',\n                    end: '11:15',\n                    subject: 'Educaci√≥n F√≠sica',\n                    location: 'Gimnasio',\n                    color: '#06B6D4'\n                },\n                {\n                    start: '11:30',\n                    end: '13:00',\n                    subject: 'Arte',\n                    location: 'Taller',\n                    color: '#F97316'\n                }\n            ],\n            thursday: [\n                {\n                    start: '08:00',\n                    end: '09:30',\n                    subject: 'Qu√≠mica',\n                    location: 'Laboratorio A',\n                    color: '#EF4444'\n                },\n                {\n                    start: '09:45',\n                    end: '11:15',\n                    subject: 'F√≠sica',\n                    location: 'Laboratorio B',\n                    color: '#10B981'\n                },\n                {\n                    start: '11:30',\n                    end: '13:00',\n                    subject: 'Historia',\n                    location: 'Aula 105',\n                    color: '#8B5CF6'\n                }\n            ],\n            friday: [\n                {\n                    start: '08:00',\n                    end: '09:30',\n                    subject: 'Biolog√≠a',\n                    location: 'Laboratorio C',\n                    color: '#EC4899'\n                },\n                {\n                    start: '09:45',\n                    end: '11:15',\n                    subject: 'Literatura',\n                    location: 'Aula 203',\n                    color: '#F59E0B'\n                },\n                {\n                    start: '11:30',\n                    end: '13:00',\n                    subject: 'Matem√°ticas',\n                    location: 'Aula 201',\n                    color: '#3B82F6'\n                }\n            ]\n        };\n        // Demo events\n        const now = new Date();\n        const demoEvents = [\n            {\n                id: 'exam-1',\n                title: 'Examen Qu√≠mica Org√°nica',\n                date: new Date(now.getTime() + 7 * 24 * 60 * 60 * 1000),\n                startTime: '10:00',\n                endTime: '12:00',\n                type: 'exam',\n                color: getEventTypeColor('exam'),\n                description: 'Examen parcial de qu√≠mica org√°nica',\n                subject: 'Qu√≠mica',\n                location: 'Laboratorio A'\n            },\n            {\n                id: 'study-1',\n                title: 'Sesi√≥n de Estudio - Matem√°ticas',\n                date: new Date(now.getTime() + 1 * 24 * 60 * 60 * 1000),\n                startTime: '15:00',\n                endTime: '16:30',\n                type: 'study_session',\n                color: getEventTypeColor('study_session'),\n                description: 'Repaso de c√°lculo integral',\n                subject: 'Matem√°ticas'\n            },\n            {\n                id: 'personal-1',\n                title: 'Entrenamiento F√∫tbol',\n                date: new Date(now.getTime() + 2 * 24 * 60 * 60 * 1000),\n                startTime: '17:00',\n                endTime: '18:30',\n                type: 'extracurricular',\n                color: getEventTypeColor('extracurricular'),\n                description: 'Entrenamiento de f√∫tbol',\n                location: 'Campo deportivo'\n            }\n        ];\n        demoEvents.forEach((event)=>{\n            demoData.events.push(event);\n        });\n        demoData.isSetupComplete = true;\n        demoData.lastUpdated = new Date();\n        console.log(\"‚úÖ Datos de calendario demo inicializados\");\n    } else {\n        console.log(\"‚úÖ Datos de calendario demo ya existen\");\n    }\n}\n// Initialize demo data on module load\ninitDemoCalendarData();\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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LEtBQUs7Z0JBQ2xESyxXQUFXO2dCQUNYQyxTQUFTO2dCQUNUNkIsTUFBTTtnQkFDTmtDLE9BQU9uQyxrQkFBa0I7Z0JBQ3pCc0MsYUFBYTtnQkFDYkosVUFBVTtZQUNaO1NBQ0Q7UUFFREcsV0FBV0UsT0FBTyxDQUFDN0YsQ0FBQUE7WUFDakJzRixTQUFTaEcsTUFBTSxDQUFDSSxJQUFJLENBQUNNO1FBQ3ZCO1FBRUFzRixTQUFTL0YsZUFBZSxHQUFHO1FBQzNCK0YsU0FBUzlGLFdBQVcsR0FBRyxJQUFJQztRQUUzQlMsUUFBUUMsR0FBRyxDQUFDO0lBQ2QsT0FBTztRQUNMRCxRQUFRQyxHQUFHLENBQUM7SUFDZDtBQUNGO0FBRUEsc0NBQXNDO0FBQ3RDaUYiLCJzb3VyY2VzIjpbIi9Vc2Vycy9yb2RyaWdvZGliZXJuYXJkbzMzZ21haWwuY29tL0RvY3VtZW50cy9BcHAgRGV2ZWxvcG1lbnQgUHJveWVjdHMvSW50ZWxsZWdvIFBsYXRmb3JtL3NyYy9saWIvY2FsZW5kYXItZGF0YS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDYWxlbmRhciBEYXRhIE1vZGVscyBmb3IgU21hcnQgQ2FsZW5kYXJcblxuZXhwb3J0IGludGVyZmFjZSBUaW1lU2xvdCB7XG4gIHN0YXJ0OiBzdHJpbmcgLy8gXCIwODowMFwiXG4gIGVuZDogc3RyaW5nICAgLy8gXCIwOTozMFwiXG4gIHN1YmplY3Q6IHN0cmluZ1xuICBsb2NhdGlvbj86IHN0cmluZ1xuICBjb2xvcj86IHN0cmluZ1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIFNjaG9vbFNjaGVkdWxlIHtcbiAgbW9uZGF5OiBUaW1lU2xvdFtdXG4gIHR1ZXNkYXk6IFRpbWVTbG90W11cbiAgd2VkbmVzZGF5OiBUaW1lU2xvdFtdXG4gIHRodXJzZGF5OiBUaW1lU2xvdFtdXG4gIGZyaWRheTogVGltZVNsb3RbXVxuICBzYXR1cmRheT86IFRpbWVTbG90W11cbn1cblxuZXhwb3J0IGludGVyZmFjZSBDYWxlbmRhckV2ZW50IHtcbiAgaWQ6IHN0cmluZ1xuICB0aXRsZTogc3RyaW5nXG4gIGRhdGU6IERhdGVcbiAgc3RhcnRUaW1lPzogc3RyaW5nXG4gIGVuZFRpbWU/OiBzdHJpbmdcbiAgdHlwZTogJ2V4YW0nIHwgJ3N0dWR5X3Nlc3Npb24nIHwgJ2NsYXNzJyB8ICdwZXJzb25hbCcgfCAnZXh0cmFjdXJyaWN1bGFyJ1xuICBjb2xvcjogc3RyaW5nXG4gIGRlc2NyaXB0aW9uPzogc3RyaW5nXG4gIHN1YmplY3Q/OiBzdHJpbmdcbiAgbG9jYXRpb24/OiBzdHJpbmdcbiAgcHJpb3JpdHk/OiAnaGlnaCcgfCAnbWVkaXVtJyB8ICdsb3cnXG4gIGR1cmF0aW9uPzogbnVtYmVyIC8vIGluIG1pbnV0ZXNcbiAgaXNSZWN1cnJpbmc/OiBib29sZWFuXG4gIHJlY3VycmluZ1BhdHRlcm4/OiB7XG4gICAgZnJlcXVlbmN5OiAnZGFpbHknIHwgJ3dlZWtseScgfCAnbW9udGhseSdcbiAgICBkYXlzPzogbnVtYmVyW10gLy8gMD1TdW5kYXksIDE9TW9uZGF5LCBldGMuXG4gICAgZW5kRGF0ZT86IERhdGVcbiAgfVxufVxuXG5leHBvcnQgaW50ZXJmYWNlIFN0dWR5UHJlZmVyZW5jZXMge1xuICBwcmVmZXJyZWRTdHVkeVRpbWU6ICdtb3JuaW5nJyB8ICdhZnRlcm5vb24nIHwgJ2V2ZW5pbmcnIHwgJ2ZsZXhpYmxlJ1xuICBkYWlseVN0dWR5SG91cnM6IG51bWJlclxuICBtYXhTZXNzaW9uRHVyYXRpb246IG51bWJlclxuICBicmVha0JldHdlZW5TZXNzaW9uczogbnVtYmVyXG4gIHdlZWtlbmRTdHVkeUhvdXJzOiBudW1iZXJcbiAgbm9TdHVkeURheXM6IG51bWJlcltdIC8vIERheXMgb2Ygd2VlayB0byBhdm9pZCBzdHVkeWluZ1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIFVzZXJDYWxlbmRhckRhdGEge1xuICB1c2VySWQ6IHN0cmluZ1xuICBzY2hvb2xTY2hlZHVsZTogU2Nob29sU2NoZWR1bGVcbiAgc3R1ZHlQcmVmZXJlbmNlczogU3R1ZHlQcmVmZXJlbmNlc1xuICBldmVudHM6IENhbGVuZGFyRXZlbnRbXVxuICBpc1NldHVwQ29tcGxldGU6IGJvb2xlYW5cbiAgbGFzdFVwZGF0ZWQ6IERhdGVcbn1cblxuLy8gVGVtcG9yYXJ5IHN0b3JhZ2UgZm9yIGNhbGVuZGFyIGRhdGFcbmNvbnN0IGdsb2JhbEZvckNhbGVuZGFyRGF0YSA9IGdsb2JhbFRoaXMgYXMgdW5rbm93biBhcyB7XG4gIHRlbXBDYWxlbmRhckRhdGE6IFVzZXJDYWxlbmRhckRhdGFbXSB8IHVuZGVmaW5lZFxufVxuXG5leHBvcnQgY29uc3QgdGVtcENhbGVuZGFyRGF0YTogVXNlckNhbGVuZGFyRGF0YVtdID0gZ2xvYmFsRm9yQ2FsZW5kYXJEYXRhLnRlbXBDYWxlbmRhckRhdGEgPz8gW11cbmdsb2JhbEZvckNhbGVuZGFyRGF0YS50ZW1wQ2FsZW5kYXJEYXRhID0gdGVtcENhbGVuZGFyRGF0YVxuXG4vLyBDYWxlbmRhciBEYXRhIE1hbmFnZW1lbnQgRnVuY3Rpb25zXG5leHBvcnQgZnVuY3Rpb24gZ2V0VXNlckNhbGVuZGFyRGF0YSh1c2VySWQ6IHN0cmluZyk6IFVzZXJDYWxlbmRhckRhdGEgfCB1bmRlZmluZWQge1xuICByZXR1cm4gdGVtcENhbGVuZGFyRGF0YS5maW5kKGRhdGEgPT4gZGF0YS51c2VySWQgPT09IHVzZXJJZClcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZVVzZXJDYWxlbmRhckRhdGEodXNlcklkOiBzdHJpbmcpOiBVc2VyQ2FsZW5kYXJEYXRhIHtcbiAgY29uc3QgbmV3RGF0YTogVXNlckNhbGVuZGFyRGF0YSA9IHtcbiAgICB1c2VySWQsXG4gICAgc2Nob29sU2NoZWR1bGU6IHtcbiAgICAgIG1vbmRheTogW10sXG4gICAgICB0dWVzZGF5OiBbXSxcbiAgICAgIHdlZG5lc2RheTogW10sXG4gICAgICB0aHVyc2RheTogW10sXG4gICAgICBmcmlkYXk6IFtdXG4gICAgfSxcbiAgICBzdHVkeVByZWZlcmVuY2VzOiB7XG4gICAgICBwcmVmZXJyZWRTdHVkeVRpbWU6ICdhZnRlcm5vb24nLFxuICAgICAgZGFpbHlTdHVkeUhvdXJzOiAzLFxuICAgICAgbWF4U2Vzc2lvbkR1cmF0aW9uOiA5MCxcbiAgICAgIGJyZWFrQmV0d2VlblNlc3Npb25zOiAxNSxcbiAgICAgIHdlZWtlbmRTdHVkeUhvdXJzOiA0LFxuICAgICAgbm9TdHVkeURheXM6IFswXSAvLyBTdW5kYXlcbiAgICB9LFxuICAgIGV2ZW50czogW10sXG4gICAgaXNTZXR1cENvbXBsZXRlOiBmYWxzZSxcbiAgICBsYXN0VXBkYXRlZDogbmV3IERhdGUoKVxuICB9XG4gIFxuICB0ZW1wQ2FsZW5kYXJEYXRhLnB1c2gobmV3RGF0YSlcbiAgcmV0dXJuIG5ld0RhdGFcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHVwZGF0ZVVzZXJDYWxlbmRhckRhdGEodXNlcklkOiBzdHJpbmcsIHVwZGF0ZXM6IFBhcnRpYWw8VXNlckNhbGVuZGFyRGF0YT4pOiBib29sZWFuIHtcbiAgY29uc3QgaW5kZXggPSB0ZW1wQ2FsZW5kYXJEYXRhLmZpbmRJbmRleChkYXRhID0+IGRhdGEudXNlcklkID09PSB1c2VySWQpXG4gIGlmIChpbmRleCAhPT0gLTEpIHtcbiAgICB0ZW1wQ2FsZW5kYXJEYXRhW2luZGV4XSA9IHtcbiAgICAgIC4uLnRlbXBDYWxlbmRhckRhdGFbaW5kZXhdLFxuICAgICAgLi4udXBkYXRlcyxcbiAgICAgIGxhc3RVcGRhdGVkOiBuZXcgRGF0ZSgpXG4gICAgfVxuICAgIHJldHVybiB0cnVlXG4gIH1cbiAgcmV0dXJuIGZhbHNlXG59XG5cbmV4cG9ydCBmdW5jdGlvbiBhZGRDYWxlbmRhckV2ZW50KHVzZXJJZDogc3RyaW5nLCBldmVudDogQ2FsZW5kYXJFdmVudCk6IGJvb2xlYW4ge1xuICBjb25zdCB1c2VyRGF0YSA9IGdldFVzZXJDYWxlbmRhckRhdGEodXNlcklkKVxuICBpZiAodXNlckRhdGEpIHtcbiAgICB1c2VyRGF0YS5ldmVudHMucHVzaChldmVudClcbiAgICB1c2VyRGF0YS5sYXN0VXBkYXRlZCA9IG5ldyBEYXRlKClcbiAgICBcbiAgICAvLyBGb3JjZSB1cGRhdGUgaW4gZ2xvYmFsIHN0b3JhZ2VcbiAgICBjb25zdCBpbmRleCA9IHRlbXBDYWxlbmRhckRhdGEuZmluZEluZGV4KGRhdGEgPT4gZGF0YS51c2VySWQgPT09IHVzZXJJZClcbiAgICBpZiAoaW5kZXggIT09IC0xKSB7XG4gICAgICB0ZW1wQ2FsZW5kYXJEYXRhW2luZGV4XSA9IHVzZXJEYXRhXG4gICAgfVxuICAgIFxuICAgIGNvbnNvbGUubG9nKGDwn5OFIEV2ZW50byBhZ3JlZ2FkbzogJHtldmVudC50aXRsZX0gLSBUb3RhbCBldmVudG9zOiAke3VzZXJEYXRhLmV2ZW50cy5sZW5ndGh9YClcbiAgICByZXR1cm4gdHJ1ZVxuICB9XG4gIHJldHVybiBmYWxzZVxufVxuXG5leHBvcnQgZnVuY3Rpb24gdXBkYXRlQ2FsZW5kYXJFdmVudCh1c2VySWQ6IHN0cmluZywgZXZlbnRJZDogc3RyaW5nLCB1cGRhdGVzOiBQYXJ0aWFsPENhbGVuZGFyRXZlbnQ+KTogYm9vbGVhbiB7XG4gIGNvbnN0IHVzZXJEYXRhID0gZ2V0VXNlckNhbGVuZGFyRGF0YSh1c2VySWQpXG4gIGlmICh1c2VyRGF0YSkge1xuICAgIGNvbnN0IGV2ZW50SW5kZXggPSB1c2VyRGF0YS5ldmVudHMuZmluZEluZGV4KGUgPT4gZS5pZCA9PT0gZXZlbnRJZClcbiAgICBpZiAoZXZlbnRJbmRleCAhPT0gLTEpIHtcbiAgICAgIHVzZXJEYXRhLmV2ZW50c1tldmVudEluZGV4XSA9IHtcbiAgICAgICAgLi4udXNlckRhdGEuZXZlbnRzW2V2ZW50SW5kZXhdLFxuICAgICAgICAuLi51cGRhdGVzXG4gICAgICB9XG4gICAgICB1c2VyRGF0YS5sYXN0VXBkYXRlZCA9IG5ldyBEYXRlKClcbiAgICAgIFxuICAgICAgLy8gRm9yY2UgdXBkYXRlIGluIGdsb2JhbCBzdG9yYWdlXG4gICAgICBjb25zdCBpbmRleCA9IHRlbXBDYWxlbmRhckRhdGEuZmluZEluZGV4KGRhdGEgPT4gZGF0YS51c2VySWQgPT09IHVzZXJJZClcbiAgICAgIGlmIChpbmRleCAhPT0gLTEpIHtcbiAgICAgICAgdGVtcENhbGVuZGFyRGF0YVtpbmRleF0gPSB1c2VyRGF0YVxuICAgICAgfVxuICAgICAgXG4gICAgICBjb25zb2xlLmxvZyhg8J+ThSBFdmVudG8gYWN0dWFsaXphZG86ICR7dXNlckRhdGEuZXZlbnRzW2V2ZW50SW5kZXhdLnRpdGxlfWApXG4gICAgICByZXR1cm4gdHJ1ZVxuICAgIH1cbiAgfVxuICByZXR1cm4gZmFsc2Vcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGRlbGV0ZUNhbGVuZGFyRXZlbnQodXNlcklkOiBzdHJpbmcsIGV2ZW50SWQ6IHN0cmluZyk6IGJvb2xlYW4ge1xuICBjb25zdCB1c2VyRGF0YSA9IGdldFVzZXJDYWxlbmRhckRhdGEodXNlcklkKVxuICBpZiAodXNlckRhdGEpIHtcbiAgICBjb25zdCBldmVudEluZGV4ID0gdXNlckRhdGEuZXZlbnRzLmZpbmRJbmRleChlID0+IGUuaWQgPT09IGV2ZW50SWQpXG4gICAgaWYgKGV2ZW50SW5kZXggIT09IC0xKSB7XG4gICAgICBjb25zdCBkZWxldGVkRXZlbnQgPSB1c2VyRGF0YS5ldmVudHNbZXZlbnRJbmRleF1cbiAgICAgIHVzZXJEYXRhLmV2ZW50cy5zcGxpY2UoZXZlbnRJbmRleCwgMSlcbiAgICAgIHVzZXJEYXRhLmxhc3RVcGRhdGVkID0gbmV3IERhdGUoKVxuICAgICAgXG4gICAgICAvLyBGb3JjZSB1cGRhdGUgaW4gZ2xvYmFsIHN0b3JhZ2VcbiAgICAgIGNvbnN0IGluZGV4ID0gdGVtcENhbGVuZGFyRGF0YS5maW5kSW5kZXgoZGF0YSA9PiBkYXRhLnVzZXJJZCA9PT0gdXNlcklkKVxuICAgICAgaWYgKGluZGV4ICE9PSAtMSkge1xuICAgICAgICB0ZW1wQ2FsZW5kYXJEYXRhW2luZGV4XSA9IHVzZXJEYXRhXG4gICAgICB9XG4gICAgICBcbiAgICAgIGNvbnNvbGUubG9nKGDwn5OFIEV2ZW50byBlbGltaW5hZG86ICR7ZGVsZXRlZEV2ZW50LnRpdGxlfSAtIFRvdGFsIGV2ZW50b3M6ICR7dXNlckRhdGEuZXZlbnRzLmxlbmd0aH1gKVxuICAgICAgcmV0dXJuIHRydWVcbiAgICB9XG4gIH1cbiAgcmV0dXJuIGZhbHNlXG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRFdmVudHNGb3JEYXRlKHVzZXJJZDogc3RyaW5nLCBkYXRlOiBEYXRlKTogQ2FsZW5kYXJFdmVudFtdIHtcbiAgY29uc3QgdXNlckRhdGEgPSBnZXRVc2VyQ2FsZW5kYXJEYXRhKHVzZXJJZClcbiAgaWYgKCF1c2VyRGF0YSkgcmV0dXJuIFtdXG4gIFxuICBjb25zdCB0YXJnZXREYXRlID0gbmV3IERhdGUoZGF0ZSlcbiAgdGFyZ2V0RGF0ZS5zZXRIb3VycygwLCAwLCAwLCAwKVxuICBcbiAgcmV0dXJuIHVzZXJEYXRhLmV2ZW50cy5maWx0ZXIoZXZlbnQgPT4ge1xuICAgIGNvbnN0IGV2ZW50RGF0ZSA9IG5ldyBEYXRlKGV2ZW50LmRhdGUpXG4gICAgZXZlbnREYXRlLnNldEhvdXJzKDAsIDAsIDAsIDApXG4gICAgcmV0dXJuIGV2ZW50RGF0ZS5nZXRUaW1lKCkgPT09IHRhcmdldERhdGUuZ2V0VGltZSgpXG4gIH0pXG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRFdmVudHNGb3JEYXRlUmFuZ2UodXNlcklkOiBzdHJpbmcsIHN0YXJ0RGF0ZTogRGF0ZSwgZW5kRGF0ZTogRGF0ZSk6IENhbGVuZGFyRXZlbnRbXSB7XG4gIGNvbnN0IHVzZXJEYXRhID0gZ2V0VXNlckNhbGVuZGFyRGF0YSh1c2VySWQpXG4gIGlmICghdXNlckRhdGEpIHJldHVybiBbXVxuICBcbiAgcmV0dXJuIHVzZXJEYXRhLmV2ZW50cy5maWx0ZXIoZXZlbnQgPT4ge1xuICAgIGNvbnN0IGV2ZW50RGF0ZSA9IG5ldyBEYXRlKGV2ZW50LmRhdGUpXG4gICAgcmV0dXJuIGV2ZW50RGF0ZSA+PSBzdGFydERhdGUgJiYgZXZlbnREYXRlIDw9IGVuZERhdGVcbiAgfSlcbn1cblxuLy8gVXRpbGl0eSBmdW5jdGlvbnMgZm9yIGNhbGVuZGFyIG9wZXJhdGlvbnNcbmV4cG9ydCBmdW5jdGlvbiBpc1RpbWVTbG90QXZhaWxhYmxlKFxuICB1c2VySWQ6IHN0cmluZywgXG4gIGRhdGU6IERhdGUsIFxuICBzdGFydFRpbWU6IHN0cmluZywgXG4gIGVuZFRpbWU6IHN0cmluZ1xuKTogYm9vbGVhbiB7XG4gIGNvbnN0IHVzZXJEYXRhID0gZ2V0VXNlckNhbGVuZGFyRGF0YSh1c2VySWQpXG4gIGlmICghdXNlckRhdGEpIHJldHVybiB0cnVlXG4gIFxuICBjb25zdCBkYXlOYW1lID0gZ2V0RGF5TmFtZShkYXRlLmdldERheSgpKVxuICBjb25zdCBzY2hvb2xTbG90cyA9IHVzZXJEYXRhLnNjaG9vbFNjaGVkdWxlW2RheU5hbWVdIHx8IFtdXG4gIFxuICAvLyBDaGVjayBzY2hvb2wgc2NoZWR1bGUgY29uZmxpY3RzXG4gIGZvciAoY29uc3Qgc2xvdCBvZiBzY2hvb2xTbG90cykge1xuICAgIGlmICh0aW1lT3ZlcmxhcHMoc3RhcnRUaW1lLCBlbmRUaW1lLCBzbG90LnN0YXJ0LCBzbG90LmVuZCkpIHtcbiAgICAgIHJldHVybiBmYWxzZVxuICAgIH1cbiAgfVxuICBcbiAgLy8gQ2hlY2sgZXhpc3RpbmcgZXZlbnRzXG4gIGNvbnN0IGRheUV2ZW50cyA9IGdldEV2ZW50c0ZvckRhdGUodXNlcklkLCBkYXRlKVxuICBmb3IgKGNvbnN0IGV2ZW50IG9mIGRheUV2ZW50cykge1xuICAgIGlmIChldmVudC5zdGFydFRpbWUgJiYgZXZlbnQuZW5kVGltZSkge1xuICAgICAgaWYgKHRpbWVPdmVybGFwcyhzdGFydFRpbWUsIGVuZFRpbWUsIGV2ZW50LnN0YXJ0VGltZSwgZXZlbnQuZW5kVGltZSkpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlXG4gICAgICB9XG4gICAgfVxuICB9XG4gIFxuICByZXR1cm4gdHJ1ZVxufVxuXG5leHBvcnQgZnVuY3Rpb24gZmluZEF2YWlsYWJsZVRpbWVTbG90cyhcbiAgdXNlcklkOiBzdHJpbmcsXG4gIGRhdGU6IERhdGUsXG4gIGR1cmF0aW9uOiBudW1iZXIsIC8vIGluIG1pbnV0ZXNcbiAgcHJlZmVycmVkVGltZT86ICdtb3JuaW5nJyB8ICdhZnRlcm5vb24nIHwgJ2V2ZW5pbmcnXG4pOiB7IHN0YXJ0OiBzdHJpbmc7IGVuZDogc3RyaW5nIH1bXSB7XG4gIGNvbnN0IHVzZXJEYXRhID0gZ2V0VXNlckNhbGVuZGFyRGF0YSh1c2VySWQpXG4gIGlmICghdXNlckRhdGEpIHJldHVybiBbXVxuICBcbiAgY29uc3Qgc2xvdHM6IHsgc3RhcnQ6IHN0cmluZzsgZW5kOiBzdHJpbmcgfVtdID0gW11cbiAgXG4gIC8vIERlZmluZSB0aW1lIHJhbmdlcyBiYXNlZCBvbiBwcmVmZXJlbmNlXG4gIGNvbnN0IHRpbWVSYW5nZXMgPSB7XG4gICAgbW9ybmluZzogWycwODowMCcsICcxMjowMCddLFxuICAgIGFmdGVybm9vbjogWycxNDowMCcsICcxODowMCddLFxuICAgIGV2ZW5pbmc6IFsnMTk6MDAnLCAnMjI6MDAnXVxuICB9XG4gIFxuICBjb25zdCBzZWFyY2hSYW5nZSA9IHByZWZlcnJlZFRpbWUgPyB0aW1lUmFuZ2VzW3ByZWZlcnJlZFRpbWVdIDogWycwODowMCcsICcyMjowMCddXG4gIGNvbnN0IFtzZWFyY2hTdGFydCwgc2VhcmNoRW5kXSA9IHNlYXJjaFJhbmdlXG4gIFxuICAvLyBHZW5lcmF0ZSBwb3RlbnRpYWwgc2xvdHMgZXZlcnkgMzAgbWludXRlc1xuICBjb25zdCBzdGFydE1pbnV0ZXMgPSB0aW1lVG9NaW51dGVzKHNlYXJjaFN0YXJ0KVxuICBjb25zdCBlbmRNaW51dGVzID0gdGltZVRvTWludXRlcyhzZWFyY2hFbmQpXG4gIFxuICBmb3IgKGxldCBtaW51dGVzID0gc3RhcnRNaW51dGVzOyBtaW51dGVzIDw9IGVuZE1pbnV0ZXMgLSBkdXJhdGlvbjsgbWludXRlcyArPSAzMCkge1xuICAgIGNvbnN0IHNsb3RTdGFydCA9IG1pbnV0ZXNUb1RpbWUobWludXRlcylcbiAgICBjb25zdCBzbG90RW5kID0gbWludXRlc1RvVGltZShtaW51dGVzICsgZHVyYXRpb24pXG4gICAgXG4gICAgaWYgKGlzVGltZVNsb3RBdmFpbGFibGUodXNlcklkLCBkYXRlLCBzbG90U3RhcnQsIHNsb3RFbmQpKSB7XG4gICAgICBzbG90cy5wdXNoKHsgc3RhcnQ6IHNsb3RTdGFydCwgZW5kOiBzbG90RW5kIH0pXG4gICAgfVxuICB9XG4gIFxuICByZXR1cm4gc2xvdHNcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGdldEV2ZW50VHlwZUNvbG9yKHR5cGU6IENhbGVuZGFyRXZlbnRbJ3R5cGUnXSk6IHN0cmluZyB7XG4gIGNvbnN0IGNvbG9ycyA9IHtcbiAgICBleGFtOiAnI0VGNDQ0NCcsICAgICAgICAgIC8vIFJlZFxuICAgIHN0dWR5X3Nlc3Npb246ICcjM0I4MkY2JywgLy8gQmx1ZVxuICAgIGNsYXNzOiAnIzEwQjk4MScsICAgICAgICAgLy8gR3JlZW5cbiAgICBwZXJzb25hbDogJyM4QjVDRjYnLCAgICAgIC8vIFB1cnBsZVxuICAgIGV4dHJhY3VycmljdWxhcjogJyNGNTlFMEInIC8vIE9yYW5nZVxuICB9XG4gIHJldHVybiBjb2xvcnNbdHlwZV0gfHwgJyM2NDc0OEInXG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRFdmVudFR5cGVJY29uKHR5cGU6IENhbGVuZGFyRXZlbnRbJ3R5cGUnXSk6IHN0cmluZyB7XG4gIGNvbnN0IGljb25zID0ge1xuICAgIGV4YW06ICfwn5OdJyxcbiAgICBzdHVkeV9zZXNzaW9uOiAn8J+TmicsXG4gICAgY2xhc3M6ICfwn46TJyxcbiAgICBwZXJzb25hbDogJ/CfkaQnLFxuICAgIGV4dHJhY3VycmljdWxhcjogJ/Cfj4PigI3imYDvuI8nXG4gIH1cbiAgcmV0dXJuIGljb25zW3R5cGVdIHx8ICfwn5OFJ1xufVxuXG4vLyBIZWxwZXIgZnVuY3Rpb25zXG5mdW5jdGlvbiBnZXREYXlOYW1lKGRheUluZGV4OiBudW1iZXIpOiBrZXlvZiBTY2hvb2xTY2hlZHVsZSB7XG4gIGNvbnN0IGRheXMgPSBbJ3N1bmRheScsICdtb25kYXknLCAndHVlc2RheScsICd3ZWRuZXNkYXknLCAndGh1cnNkYXknLCAnZnJpZGF5JywgJ3NhdHVyZGF5J11cbiAgcmV0dXJuIGRheXNbZGF5SW5kZXhdIGFzIGtleW9mIFNjaG9vbFNjaGVkdWxlXG59XG5cbmZ1bmN0aW9uIHRpbWVUb01pbnV0ZXModGltZTogc3RyaW5nKTogbnVtYmVyIHtcbiAgY29uc3QgW2hvdXJzLCBtaW51dGVzXSA9IHRpbWUuc3BsaXQoJzonKS5tYXAoTnVtYmVyKVxuICByZXR1cm4gaG91cnMgKiA2MCArIG1pbnV0ZXNcbn1cblxuZnVuY3Rpb24gbWludXRlc1RvVGltZShtaW51dGVzOiBudW1iZXIpOiBzdHJpbmcge1xuICBjb25zdCBob3VycyA9IE1hdGguZmxvb3IobWludXRlcyAvIDYwKVxuICBjb25zdCBtaW5zID0gbWludXRlcyAlIDYwXG4gIHJldHVybiBgJHtob3Vycy50b1N0cmluZygpLnBhZFN0YXJ0KDIsICcwJyl9OiR7bWlucy50b1N0cmluZygpLnBhZFN0YXJ0KDIsICcwJyl9YFxufVxuXG5mdW5jdGlvbiB0aW1lT3ZlcmxhcHMoc3RhcnQxOiBzdHJpbmcsIGVuZDE6IHN0cmluZywgc3RhcnQyOiBzdHJpbmcsIGVuZDI6IHN0cmluZyk6IGJvb2xlYW4ge1xuICBjb25zdCBzdGFydDFNaW51dGVzID0gdGltZVRvTWludXRlcyhzdGFydDEpXG4gIGNvbnN0IGVuZDFNaW51dGVzID0gdGltZVRvTWludXRlcyhlbmQxKVxuICBjb25zdCBzdGFydDJNaW51dGVzID0gdGltZVRvTWludXRlcyhzdGFydDIpXG4gIGNvbnN0IGVuZDJNaW51dGVzID0gdGltZVRvTWludXRlcyhlbmQyKVxuICBcbiAgcmV0dXJuIHN0YXJ0MU1pbnV0ZXMgPCBlbmQyTWludXRlcyAmJiBlbmQxTWludXRlcyA+IHN0YXJ0Mk1pbnV0ZXNcbn1cblxuLy8gSW5pdGlhbGl6ZSBkZW1vIGRhdGFcbmZ1bmN0aW9uIGluaXREZW1vQ2FsZW5kYXJEYXRhKCkge1xuICBjb25zdCBkZW1vVXNlcklkID0gXCJkZW1vLXN0dWRlbnQtZml4ZWRcIlxuICBcbiAgaWYgKCFnZXRVc2VyQ2FsZW5kYXJEYXRhKGRlbW9Vc2VySWQpKSB7XG4gICAgY29uc29sZS5sb2coXCLwn5OFIEluaWNpYWxpemFuZG8gZGF0b3MgZGUgY2FsZW5kYXJpbyBkZW1vLi4uXCIpXG4gICAgXG4gICAgY29uc3QgZGVtb0RhdGEgPSBjcmVhdGVVc2VyQ2FsZW5kYXJEYXRhKGRlbW9Vc2VySWQpXG4gICAgXG4gICAgLy8gRGVtbyBzY2hvb2wgc2NoZWR1bGVcbiAgICBkZW1vRGF0YS5zY2hvb2xTY2hlZHVsZSA9IHtcbiAgICAgIG1vbmRheTogW1xuICAgICAgICB7IHN0YXJ0OiAnMDg6MDAnLCBlbmQ6ICcwOTozMCcsIHN1YmplY3Q6ICdNYXRlbcOhdGljYXMnLCBsb2NhdGlvbjogJ0F1bGEgMjAxJywgY29sb3I6ICcjM0I4MkY2JyB9LFxuICAgICAgICB7IHN0YXJ0OiAnMDk6NDUnLCBlbmQ6ICcxMToxNScsIHN1YmplY3Q6ICdRdcOtbWljYScsIGxvY2F0aW9uOiAnTGFib3JhdG9yaW8gQScsIGNvbG9yOiAnI0VGNDQ0NCcgfSxcbiAgICAgICAgeyBzdGFydDogJzExOjMwJywgZW5kOiAnMTM6MDAnLCBzdWJqZWN0OiAnSGlzdG9yaWEnLCBsb2NhdGlvbjogJ0F1bGEgMTA1JywgY29sb3I6ICcjOEI1Q0Y2JyB9XG4gICAgICBdLFxuICAgICAgdHVlc2RheTogW1xuICAgICAgICB7IHN0YXJ0OiAnMDg6MDAnLCBlbmQ6ICcwOTozMCcsIHN1YmplY3Q6ICdGw61zaWNhJywgbG9jYXRpb246ICdMYWJvcmF0b3JpbyBCJywgY29sb3I6ICcjMTBCOTgxJyB9LFxuICAgICAgICB7IHN0YXJ0OiAnMDk6NDUnLCBlbmQ6ICcxMToxNScsIHN1YmplY3Q6ICdMaXRlcmF0dXJhJywgbG9jYXRpb246ICdBdWxhIDIwMycsIGNvbG9yOiAnI0Y1OUUwQicgfSxcbiAgICAgICAgeyBzdGFydDogJzExOjMwJywgZW5kOiAnMTM6MDAnLCBzdWJqZWN0OiAnQmlvbG9nw61hJywgbG9jYXRpb246ICdMYWJvcmF0b3JpbyBDJywgY29sb3I6ICcjRUM0ODk5JyB9XG4gICAgICBdLFxuICAgICAgd2VkbmVzZGF5OiBbXG4gICAgICAgIHsgc3RhcnQ6ICcwODowMCcsIGVuZDogJzA5OjMwJywgc3ViamVjdDogJ01hdGVtw6F0aWNhcycsIGxvY2F0aW9uOiAnQXVsYSAyMDEnLCBjb2xvcjogJyMzQjgyRjYnIH0sXG4gICAgICAgIHsgc3RhcnQ6ICcwOTo0NScsIGVuZDogJzExOjE1Jywgc3ViamVjdDogJ0VkdWNhY2nDs24gRsOtc2ljYScsIGxvY2F0aW9uOiAnR2ltbmFzaW8nLCBjb2xvcjogJyMwNkI2RDQnIH0sXG4gICAgICAgIHsgc3RhcnQ6ICcxMTozMCcsIGVuZDogJzEzOjAwJywgc3ViamVjdDogJ0FydGUnLCBsb2NhdGlvbjogJ1RhbGxlcicsIGNvbG9yOiAnI0Y5NzMxNicgfVxuICAgICAgXSxcbiAgICAgIHRodXJzZGF5OiBbXG4gICAgICAgIHsgc3RhcnQ6ICcwODowMCcsIGVuZDogJzA5OjMwJywgc3ViamVjdDogJ1F1w61taWNhJywgbG9jYXRpb246ICdMYWJvcmF0b3JpbyBBJywgY29sb3I6ICcjRUY0NDQ0JyB9LFxuICAgICAgICB7IHN0YXJ0OiAnMDk6NDUnLCBlbmQ6ICcxMToxNScsIHN1YmplY3Q6ICdGw61zaWNhJywgbG9jYXRpb246ICdMYWJvcmF0b3JpbyBCJywgY29sb3I6ICcjMTBCOTgxJyB9LFxuICAgICAgICB7IHN0YXJ0OiAnMTE6MzAnLCBlbmQ6ICcxMzowMCcsIHN1YmplY3Q6ICdIaXN0b3JpYScsIGxvY2F0aW9uOiAnQXVsYSAxMDUnLCBjb2xvcjogJyM4QjVDRjYnIH1cbiAgICAgIF0sXG4gICAgICBmcmlkYXk6IFtcbiAgICAgICAgeyBzdGFydDogJzA4OjAwJywgZW5kOiAnMDk6MzAnLCBzdWJqZWN0OiAnQmlvbG9nw61hJywgbG9jYXRpb246ICdMYWJvcmF0b3JpbyBDJywgY29sb3I6ICcjRUM0ODk5JyB9LFxuICAgICAgICB7IHN0YXJ0OiAnMDk6NDUnLCBlbmQ6ICcxMToxNScsIHN1YmplY3Q6ICdMaXRlcmF0dXJhJywgbG9jYXRpb246ICdBdWxhIDIwMycsIGNvbG9yOiAnI0Y1OUUwQicgfSxcbiAgICAgICAgeyBzdGFydDogJzExOjMwJywgZW5kOiAnMTM6MDAnLCBzdWJqZWN0OiAnTWF0ZW3DoXRpY2FzJywgbG9jYXRpb246ICdBdWxhIDIwMScsIGNvbG9yOiAnIzNCODJGNicgfVxuICAgICAgXVxuICAgIH1cbiAgICBcbiAgICAvLyBEZW1vIGV2ZW50c1xuICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKClcbiAgICBjb25zdCBkZW1vRXZlbnRzOiBDYWxlbmRhckV2ZW50W10gPSBbXG4gICAgICB7XG4gICAgICAgIGlkOiAnZXhhbS0xJyxcbiAgICAgICAgdGl0bGU6ICdFeGFtZW4gUXXDrW1pY2EgT3Jnw6FuaWNhJyxcbiAgICAgICAgZGF0ZTogbmV3IERhdGUobm93LmdldFRpbWUoKSArIDcgKiAyNCAqIDYwICogNjAgKiAxMDAwKSxcbiAgICAgICAgc3RhcnRUaW1lOiAnMTA6MDAnLFxuICAgICAgICBlbmRUaW1lOiAnMTI6MDAnLFxuICAgICAgICB0eXBlOiAnZXhhbScsXG4gICAgICAgIGNvbG9yOiBnZXRFdmVudFR5cGVDb2xvcignZXhhbScpLFxuICAgICAgICBkZXNjcmlwdGlvbjogJ0V4YW1lbiBwYXJjaWFsIGRlIHF1w61taWNhIG9yZ8OhbmljYScsXG4gICAgICAgIHN1YmplY3Q6ICdRdcOtbWljYScsXG4gICAgICAgIGxvY2F0aW9uOiAnTGFib3JhdG9yaW8gQSdcbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgIGlkOiAnc3R1ZHktMScsXG4gICAgICAgIHRpdGxlOiAnU2VzacOzbiBkZSBFc3R1ZGlvIC0gTWF0ZW3DoXRpY2FzJyxcbiAgICAgICAgZGF0ZTogbmV3IERhdGUobm93LmdldFRpbWUoKSArIDEgKiAyNCAqIDYwICogNjAgKiAxMDAwKSxcbiAgICAgICAgc3RhcnRUaW1lOiAnMTU6MDAnLFxuICAgICAgICBlbmRUaW1lOiAnMTY6MzAnLFxuICAgICAgICB0eXBlOiAnc3R1ZHlfc2Vzc2lvbicsXG4gICAgICAgIGNvbG9yOiBnZXRFdmVudFR5cGVDb2xvcignc3R1ZHlfc2Vzc2lvbicpLFxuICAgICAgICBkZXNjcmlwdGlvbjogJ1JlcGFzbyBkZSBjw6FsY3VsbyBpbnRlZ3JhbCcsXG4gICAgICAgIHN1YmplY3Q6ICdNYXRlbcOhdGljYXMnXG4gICAgICB9LFxuICAgICAge1xuICAgICAgICBpZDogJ3BlcnNvbmFsLTEnLFxuICAgICAgICB0aXRsZTogJ0VudHJlbmFtaWVudG8gRsO6dGJvbCcsXG4gICAgICAgIGRhdGU6IG5ldyBEYXRlKG5vdy5nZXRUaW1lKCkgKyAyICogMjQgKiA2MCAqIDYwICogMTAwMCksXG4gICAgICAgIHN0YXJ0VGltZTogJzE3OjAwJyxcbiAgICAgICAgZW5kVGltZTogJzE4OjMwJyxcbiAgICAgICAgdHlwZTogJ2V4dHJhY3VycmljdWxhcicsXG4gICAgICAgIGNvbG9yOiBnZXRFdmVudFR5cGVDb2xvcignZXh0cmFjdXJyaWN1bGFyJyksXG4gICAgICAgIGRlc2NyaXB0aW9uOiAnRW50cmVuYW1pZW50byBkZSBmw7p0Ym9sJyxcbiAgICAgICAgbG9jYXRpb246ICdDYW1wbyBkZXBvcnRpdm8nXG4gICAgICB9XG4gICAgXVxuICAgIFxuICAgIGRlbW9FdmVudHMuZm9yRWFjaChldmVudCA9PiB7XG4gICAgICBkZW1vRGF0YS5ldmVudHMucHVzaChldmVudClcbiAgICB9KVxuICAgIFxuICAgIGRlbW9EYXRhLmlzU2V0dXBDb21wbGV0ZSA9IHRydWVcbiAgICBkZW1vRGF0YS5sYXN0VXBkYXRlZCA9IG5ldyBEYXRlKClcbiAgICBcbiAgICBjb25zb2xlLmxvZyhcIuKchSBEYXRvcyBkZSBjYWxlbmRhcmlvIGRlbW8gaW5pY2lhbGl6YWRvc1wiKVxuICB9IGVsc2Uge1xuICAgIGNvbnNvbGUubG9nKFwi4pyFIERhdG9zIGRlIGNhbGVuZGFyaW8gZGVtbyB5YSBleGlzdGVuXCIpXG4gIH1cbn1cblxuLy8gSW5pdGlhbGl6ZSBkZW1vIGRhdGEgb24gbW9kdWxlIGxvYWRcbmluaXREZW1vQ2FsZW5kYXJEYXRhKCkiXSwibmFtZXMiOlsiZ2xvYmFsRm9yQ2FsZW5kYXJEYXRhIiwiZ2xvYmFsVGhpcyIsInRlbXBDYWxlbmRhckRhdGEiLCJnZXRVc2VyQ2FsZW5kYXJEYXRhIiwidXNlcklkIiwiZmluZCIsImRhdGEiLCJjcmVhdGVVc2VyQ2FsZW5kYXJEYXRhIiwibmV3RGF0YSIsInNjaG9vbFNjaGVkdWxlIiwibW9uZGF5IiwidHVlc2RheSIsIndlZG5lc2RheSIsInRodXJzZGF5IiwiZnJpZGF5Iiwic3R1ZHlQcmVmZXJlbmNlcyIsInByZWZlcnJlZFN0dWR5VGltZSIsImRhaWx5U3R1ZHlIb3VycyIsIm1heFNlc3Npb25EdXJhdGlvbiIsImJyZWFrQmV0d2VlblNlc3Npb25zIiwid2Vla2VuZFN0dWR5SG91cnMiLCJub1N0dWR5RGF5cyIsImV2ZW50cyIsImlzU2V0dXBDb21wbGV0ZSIsImxhc3RVcGRhdGVkIiwiRGF0ZSIsInB1c2giLCJ1cGRhdGVVc2VyQ2FsZW5kYXJEYXRhIiwidXBkYXRlcyIsImluZGV4IiwiZmluZEluZGV4IiwiYWRkQ2FsZW5kYXJFdmVudCIsImV2ZW50IiwidXNlckRhdGEiLCJjb25zb2xlIiwibG9nIiwidGl0bGUiLCJsZW5ndGgiLCJ1cGRhdGVDYWxlbmRhckV2ZW50IiwiZXZlbnRJZCIsImV2ZW50SW5kZXgiLCJlIiwiaWQiLCJkZWxldGVDYWxlbmRhckV2ZW50IiwiZGVsZXRlZEV2ZW50Iiwic3BsaWNlIiwiZ2V0RXZlbnRzRm9yRGF0ZSIsImRhdGUiLCJ0YXJnZXREYXRlIiwic2V0SG91cnMiLCJmaWx0ZXIiLCJldmVudERhdGUiLCJnZXRUaW1lIiwiZ2V0RXZlbnRzRm9yRGF0ZVJhbmdlIiwic3RhcnREYXRlIiwiZW5kRGF0ZSIsImlzVGltZVNsb3RBdmFpbGFibGUiLCJzdGFydFRpbWUiLCJlbmRUaW1lIiwiZGF5TmFtZSIsImdldERheU5hbWUiLCJnZXREYXkiLCJzY2hvb2xTbG90cyIsInNsb3QiLCJ0aW1lT3ZlcmxhcHMiLCJzdGFydCIsImVuZCIsImRheUV2ZW50cyIsImZpbmRBdmFpbGFibGVUaW1lU2xvdHMiLCJkdXJhdGlvbiIsInByZWZlcnJlZFRpbWUiLCJzbG90cyIsInRpbWVSYW5nZXMiLCJtb3JuaW5nIiwiYWZ0ZXJub29uIiwiZXZlbmluZyIsInNlYXJjaFJhbmdlIiwic2VhcmNoU3RhcnQiLCJzZWFyY2hFbmQiLCJzdGFydE1pbnV0ZXMiLCJ0aW1lVG9NaW51dGVzIiwiZW5kTWludXRlcyIsIm1pbnV0ZXMiLCJzbG90U3RhcnQiLCJtaW51dGVzVG9UaW1lIiwic2xvdEVuZCIsImdldEV2ZW50VHlwZUNvbG9yIiwidHlwZSIsImNvbG9ycyIsImV4YW0iLCJzdHVkeV9zZXNzaW9uIiwiY2xhc3MiLCJwZXJzb25hbCIsImV4dHJhY3VycmljdWxhciIsImdldEV2ZW50VHlwZUljb24iLCJpY29ucyIsImRheUluZGV4IiwiZGF5cyIsInRpbWUiLCJob3VycyIsInNwbGl0IiwibWFwIiwiTnVtYmVyIiwiTWF0aCIsImZsb29yIiwibWlucyIsInRvU3RyaW5nIiwicGFkU3RhcnQiLCJzdGFydDEiLCJlbmQxIiwic3RhcnQyIiwiZW5kMiIsInN0YXJ0MU1pbnV0ZXMiLCJlbmQxTWludXRlcyIsInN0YXJ0Mk1pbnV0ZXMiLCJlbmQyTWludXRlcyIsImluaXREZW1vQ2FsZW5kYXJEYXRhIiwiZGVtb1VzZXJJZCIsImRlbW9EYXRhIiwic3ViamVjdCIsImxvY2F0aW9uIiwiY29sb3IiLCJub3ciLCJkZW1vRXZlbnRzIiwiZGVzY3JpcHRpb24iLCJmb3JFYWNoIl0sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/calendar-data.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/contextual-conversation-manager.ts":
/*!****************************************************!*\
  !*** ./src/lib/contextual-conversation-manager.ts ***!
  \****************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   ContextualConversationManager: () => (/* binding */ ContextualConversationManager)\n/* harmony export */ });\n/* harmony import */ var _advanced_learning_profiles__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./advanced-learning-profiles */ \"(rsc)/./src/lib/advanced-learning-profiles.ts\");\n/* harmony import */ var _visual_learning_engine__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./visual-learning-engine */ \"(rsc)/./src/lib/visual-learning-engine.ts\");\n/* harmony import */ var _calendar_ai_integration__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./calendar-ai-integration */ \"(rsc)/./src/lib/calendar-ai-integration.ts\");\n// Contextual Conversation Manager for Sara AI\n// Provides intelligent context management and conversation coherence\n\n\n\nclass ContextualConversationManager {\n    static{\n        // Configuration for persistent conversation management\n        this.MAX_TURNS_RETAINED = 20;\n    }\n    static{\n        this.MAX_REFERENCES = 10;\n    }\n    static{\n        this.CONTEXT_DECAY_HOURS = 24;\n    }\n    /**\n   * Processes user message with full contextual awareness\n   */ static async processContextualMessage(userId, message, sessionId, userName) {\n        const actualSessionId = sessionId || `session_${userId}_${Date.now()}`;\n        // Import persistent storage functions\n        const { getConversationSession, createConversationSession, addConversationTurn, addPendingTask, getPendingTasks } = __webpack_require__(/*! ./temp-storage */ \"(rsc)/./src/lib/temp-storage.ts\");\n        // Get or create persistent conversation session\n        let session = getConversationSession(userId, actualSessionId);\n        if (!session) {\n            session = createConversationSession(userId, actualSessionId);\n        }\n        console.log(`üí¨ Processing message for session ${actualSessionId}: \"${message.substring(0, 50)}...\"`);\n        console.log(`üìä Session has ${session.turns.length} previous turns, ${session.pendingTasks.filter((t)=>!t.completed).length} pending tasks`);\n        // Analyze message metadata\n        const messageMetadata = this.analyzeMessageMetadata(message);\n        // Add user turn to persistent storage\n        session = addConversationTurn(userId, actualSessionId, 'user', message, messageMetadata);\n        // Check for pending tasks that might relate to this message\n        const pendingTasks = getPendingTasks(userId, actualSessionId);\n        // Build context from persistent data\n        const context = {\n            userId,\n            sessionId: actualSessionId,\n            currentTopic: session.currentTopic,\n            currentSubject: session.currentSubject,\n            conversationFlow: session.turns.map((turn)=>({\n                    id: turn.id,\n                    timestamp: turn.timestamp,\n                    role: turn.role,\n                    content: turn.content,\n                    metadata: turn.metadata\n                })),\n            contextSummary: this.buildContextSummary(session),\n            activeIntentions: this.extractActiveIntentions(session.turns.slice(-5)),\n            pendingQuestions: [],\n            referenceMemory: this.buildReferenceMemory(session.turns),\n            lastUpdate: new Date()\n        };\n        // Generate contextually aware response\n        const response = await this.generateContextualResponse(context, userName, pendingTasks);\n        // Add assistant turn to persistent storage\n        const assistantMetadata = {\n            confidence: response.continuityScore,\n            visualsGenerated: !!response.visualRecommendation,\n            searchPerformed: response.personalizations.includes('academic_search'),\n            taskCompleted: response.personalizations.includes('task_completed')\n        };\n        addConversationTurn(userId, actualSessionId, 'assistant', response.content, assistantMetadata);\n        return response;\n    }\n    /**\n   * Build context summary from persistent conversation data\n   */ static buildContextSummary(session) {\n        const recentTurns = session.turns.slice(-6);\n        const keyTopics = [\n            ...new Set(recentTurns.map((turn)=>turn.metadata.topic).filter(Boolean))\n        ];\n        const keySubjects = [\n            ...new Set(recentTurns.map((turn)=>turn.metadata.subject).filter(Boolean))\n        ];\n        const summaryParts = [];\n        if (keySubjects.length > 0) {\n            summaryParts.push(`Materias: ${keySubjects.join(', ')}`);\n        }\n        if (keyTopics.length > 0) {\n            summaryParts.push(`Temas: ${keyTopics.join(', ')}`);\n        }\n        return summaryParts.join(' | ') || 'Conversaci√≥n general';\n    }\n    /**\n   * Extract active intentions from recent conversation turns\n   */ static extractActiveIntentions(recentTurns) {\n        const intentions = recentTurns.map((turn)=>turn.metadata.intention).filter(Boolean).slice(-3);\n        return [\n            ...new Set(intentions)\n        ];\n    }\n    /**\n   * Build reference memory from conversation turns\n   */ static buildReferenceMemory(turns) {\n        const references = [];\n        const recentTurns = turns.slice(-10);\n        recentTurns.forEach((turn, index)=>{\n            if (turn.metadata.confidence && turn.metadata.confidence > 0.7) {\n                references.push({\n                    id: `ref_${turn.id}`,\n                    type: this.determineReferenceTypeFromMetadata(turn.metadata),\n                    content: turn.content.substring(0, 100) + '...',\n                    relevanceScore: turn.metadata.confidence,\n                    turnIndex: index,\n                    timestamp: turn.timestamp\n                });\n            }\n        });\n        return references.slice(-5) // Keep only last 5 references\n        ;\n    }\n    /**\n   * Helper to determine reference type from metadata\n   */ static determineReferenceTypeFromMetadata(metadata) {\n        if (metadata.intention === 'continuation') return 'topic_continuation';\n        if (metadata.intention === 'problem_solving') return 'problem_solving';\n        if (metadata.intention === 'explanation') return 'explanation_followup';\n        return 'subject_reference';\n    }\n    /**\n   * Handles calendar task execution with real event creation\n   */ static async handleCalendarTasks(userId, message, conversationHistory, pendingTasks) {\n        console.log(`üîç Checking for calendar tasks in message: \"${message.substring(0, 50)}...\"`);\n        // Initialize calendar integration\n        const calendarIntegration = new _calendar_ai_integration__WEBPACK_IMPORTED_MODULE_2__.AICalendarIntegration(userId);\n        // Analyze message for calendar events\n        const calendarResult = await calendarIntegration.processMessage(message, conversationHistory);\n        if (calendarResult.needsEventCreation) {\n            console.log(`üéØ Calendar task detected and executed!`);\n            // Mark any related pending task as completed\n            if (pendingTasks.length > 0) {\n                const calendarTask = pendingTasks.find((t)=>t.type === 'calendar_event');\n                if (calendarTask) {\n                    const { markTaskCompleted } = __webpack_require__(/*! ./temp-storage */ \"(rsc)/./src/lib/temp-storage.ts\");\n                    markTaskCompleted(userId, 'current-session', calendarTask.id, calendarResult);\n                }\n            }\n            return {\n                type: 'calendar_event_creation',\n                content: calendarResult.response || 'Evento creado exitosamente',\n                metadata: {\n                    suggestedActions: calendarResult.event ? [\n                        'Ver en calendario',\n                        'Editar evento',\n                        'Eliminar evento'\n                    ] : [\n                        'Reintentar',\n                        'Proporcionar m√°s detalles'\n                    ],\n                    eventCreated: !!calendarResult.event\n                }\n            };\n        }\n        return null;\n    }\n    /**\n   * Builds educational prompt based on conversation context\n   */ static buildEducationalPrompt(context, message, userName) {\n        const recentTurns = context.conversationFlow.slice(-3);\n        const conversationContext = recentTurns.map((turn)=>`${turn.role === 'user' ? 'Estudiante' : 'Tutor'}: ${turn.content}`).join('\\n');\n        let prompt = `Eres Sara, una tutora de IA especializada en educaci√≥n secundaria. `;\n        if (userName) {\n            prompt += `El estudiante se llama ${userName}. `;\n        }\n        if (context.currentSubject) {\n            prompt += `Actualmente est√°s ayudando con ${context.currentSubject}. `;\n        }\n        if (context.contextSummary && context.contextSummary !== 'Conversaci√≥n general') {\n            prompt += `Contexto de la conversaci√≥n: ${context.contextSummary}. `;\n        }\n        prompt += `\\n\\nConversaci√≥n reciente:\\n${conversationContext}`;\n        prompt += `\\n\\nNuevo mensaje del estudiante: \"${message}\"`;\n        prompt += `\\n\\nInstrucciones:\\n`;\n        prompt += `- Responde como Sara, la tutora de IA amigable y experta\\n`;\n        prompt += `- Mant√©n coherencia con la conversaci√≥n anterior\\n`;\n        prompt += `- Si detectas que el estudiante quiere agendar algo (examen, sesi√≥n de estudio), menciona que puedes ayudar con eso\\n`;\n        prompt += `- Usa ejemplos concretos y un lenguaje claro para estudiantes de secundaria\\n`;\n        prompt += `- Si es una pregunta acad√©mica, proporciona explicaciones paso a paso\\n`;\n        prompt += `- Mant√©n un tono motivador y positivo\\n\\n`;\n        prompt += `Respuesta de Sara:`;\n        return prompt;\n    }\n    /**\n   * Generates contextual fallback response when AI services fail\n   */ static generateContextualFallback(context, message, userName) {\n        const msgLower = message.toLowerCase();\n        // Calendar-related fallback\n        if (/agendes?|agend[a√°]|cre[ae]|programa|anot[ae]|agrega.*(?:examen|evento|sesi√≥n)/i.test(message)) {\n            return `¬°Hola${userName ? ' ' + userName : ''}! Veo que quieres agendar algo en tu calendario.\\n\\n` + `Por favor proporciona estos detalles:\\n` + `üìÖ **Fecha**: ¬øPara cu√°ndo es?\\n` + `üïê **Hora**: ¬øA qu√© hora?\\n` + `üìö **Tema**: ¬øDe qu√© se trata?\\n\\n` + `Una vez que me des estos datos, podr√© agregarlo a tu calendario autom√°ticamente.`;\n        }\n        // Academic question fallback\n        if (/¬ø|qu√©.*es|c√≥mo|explica|no.*entiendo/i.test(message)) {\n            let response = `Entiendo tu pregunta${userName ? ', ' + userName : ''}.\\n\\n`;\n            if (context.currentSubject) {\n                response += `Para ayudarte mejor con ${context.currentSubject}, `;\n            }\n            response += `¬øpodr√≠as ser m√°s espec√≠fico sobre qu√© parte necesitas que te explique?\\n\\n`;\n            response += `Mientras tanto, puedo:\\n`;\n            response += `‚Ä¢ Explicarte conceptos paso a paso\\n`;\n            response += `‚Ä¢ Ayudarte a resolver ejercicios\\n`;\n            response += `‚Ä¢ Crear recordatorios de estudio\\n`;\n            response += `‚Ä¢ Agendar sesiones de repaso`;\n            return response;\n        }\n        // General fallback with context\n        let response = `¬°Hola${userName ? ' ' + userName : ''}! üëã\\n\\n`;\n        if (context.currentSubject) {\n            response += `Veo que hemos estado trabajando con ${context.currentSubject}. `;\n        }\n        response += `¬øEn qu√© m√°s puedo ayudarte hoy?\\n\\n`;\n        response += `Puedo ayudarte con:\\n`;\n        response += `üìö **Explicar conceptos** de tus materias\\n`;\n        response += `üìù **Resolver ejercicios** paso a paso\\n`;\n        response += `üìÖ **Agendar eventos** en tu calendario\\n`;\n        response += `üéØ **Hacer evaluaciones** adaptativas\\n`;\n        response += `üîç **Buscar informaci√≥n** acad√©mica`;\n        return response;\n    }\n    /**\n   * Analyzes message metadata for context\n   */ static analyzeMessageMetadata(message) {\n        const msgLower = message.toLowerCase();\n        // Subject detection\n        let subject;\n        if (/matem√°ticas?|√°lgebra|geometr√≠a|c√°lculo/.test(msgLower)) {\n            subject = 'matem√°ticas';\n        } else if (/f√≠sica|mec√°nica|cinem√°tica|energ√≠a/.test(msgLower)) {\n            subject = 'f√≠sica';\n        } else if (/qu√≠mica|reacci√≥n|√°tomo|mol√©cula/.test(msgLower)) {\n            subject = 'qu√≠mica';\n        }\n        // Topic detection\n        let topic;\n        const topicMatches = msgLower.match(/(ecuaci√≥n|funci√≥n|derivada|integral|f√≥rmula|problema)/gi);\n        if (topicMatches) {\n            topic = topicMatches[0];\n        }\n        // Intention detection\n        let intention;\n        if (/explica|qu√© es|c√≥mo funciona/.test(msgLower)) {\n            intention = 'explanation';\n        } else if (/resuelve|calcula|encuentra/.test(msgLower)) {\n            intention = 'problem_solving';\n        } else if (/ayuda|no entiendo|estoy confundido/.test(msgLower)) {\n            intention = 'help_request';\n        } else if (/contin√∫a|sigue|y despu√©s/.test(msgLower)) {\n            intention = 'continuation';\n        }\n        // Confidence based on clarity and specificity\n        let confidence = 0.5;\n        if (subject) confidence += 0.2;\n        if (topic) confidence += 0.2;\n        if (intention) confidence += 0.1;\n        return {\n            subject,\n            topic,\n            intention,\n            confidence: Math.min(confidence, 1.0)\n        };\n    }\n    /**\n   * Updates contextual information based on new message\n   */ static async updateContextualInformation(context, message) {\n        const recentTurns = context.conversationFlow.slice(-5);\n        const metadata = recentTurns[recentTurns.length - 1]?.metadata;\n        // Update current topic/subject if detected\n        if (metadata?.subject) {\n            context.currentSubject = metadata.subject;\n        }\n        if (metadata?.topic) {\n            context.currentTopic = metadata.topic;\n        }\n        // Detect conversation continuity patterns\n        if (metadata?.intention === 'continuation') {\n            const lastAssistantTurn = recentTurns.slice().reverse().find((turn)=>turn.role === 'assistant');\n            if (lastAssistantTurn?.metadata?.subject) {\n                context.currentSubject = lastAssistantTurn.metadata.subject;\n            }\n        }\n        // Update active intentions\n        if (metadata?.intention && !context.activeIntentions.includes(metadata.intention)) {\n            context.activeIntentions.push(metadata.intention);\n            // Keep only recent intentions\n            if (context.activeIntentions.length > 3) {\n                context.activeIntentions.shift();\n            }\n        }\n        // Create context references for important information\n        if (metadata?.confidence && metadata.confidence > 0.7) {\n            const reference = {\n                id: `ref_${Date.now()}`,\n                type: this.determineReferenceType(metadata),\n                content: message,\n                relevanceScore: metadata.confidence,\n                turnIndex: context.conversationFlow.length - 1,\n                timestamp: new Date()\n            };\n            context.referenceMemory.push(reference);\n            // Keep only most relevant references\n            if (context.referenceMemory.length > this.MAX_REFERENCES) {\n                context.referenceMemory.sort((a, b)=>b.relevanceScore - a.relevanceScore);\n                context.referenceMemory = context.referenceMemory.slice(0, this.MAX_REFERENCES);\n            }\n        }\n        // Update context summary\n        await this.updateContextSummary(context);\n    }\n    /**\n   * Determines reference type based on metadata\n   */ static determineReferenceType(metadata) {\n        if (metadata.intention === 'continuation') return 'topic_continuation';\n        if (metadata.intention === 'problem_solving') return 'problem_solving';\n        if (metadata.intention === 'explanation') return 'explanation_followup';\n        return 'subject_reference';\n    }\n    /**\n   * Updates context summary with key conversation points\n   */ static async updateContextSummary(context) {\n        const recentTurns = context.conversationFlow.slice(-6);\n        const keyTopics = [\n            ...new Set(recentTurns.map((turn)=>turn.metadata.topic).filter(Boolean))\n        ];\n        const keySubjects = [\n            ...new Set(recentTurns.map((turn)=>turn.metadata.subject).filter(Boolean))\n        ];\n        const summaryParts = [];\n        if (keySubjects.length > 0) {\n            summaryParts.push(`Materias: ${keySubjects.join(', ')}`);\n        }\n        if (keyTopics.length > 0) {\n            summaryParts.push(`Temas: ${keyTopics.join(', ')}`);\n        }\n        if (context.activeIntentions.length > 0) {\n            summaryParts.push(`Intenciones: ${context.activeIntentions.join(', ')}`);\n        }\n        context.contextSummary = summaryParts.join(' | ') || 'Conversaci√≥n general';\n    }\n    /**\n   * Generates contextually aware response using persistent storage\n   */ static async generateContextualResponse(context, userName, pendingTasks = []) {\n        // Get learning profile for personalization\n        const learningProfile = _advanced_learning_profiles__WEBPACK_IMPORTED_MODULE_0__.AdvancedLearningProfileManager.getLearningProfile(context.userId);\n        // Update learning profile based on current message\n        const latestMessage = context.conversationFlow[context.conversationFlow.length - 1]?.content || '';\n        _advanced_learning_profiles__WEBPACK_IMPORTED_MODULE_0__.AdvancedLearningProfileManager.processUserMessage(context.userId, latestMessage);\n        // Analyze conversation for continuity\n        const continuityAnalysis = this.analyzeContinuity(context);\n        // üéØ FIRST PRIORITY: Check for calendar task execution\n        const calendarResult = await this.handleCalendarTasks(context.userId, latestMessage, this.formatConversationHistory(context), pendingTasks);\n        if (calendarResult) {\n            console.log(`üìÖ Calendar task executed: ${calendarResult.type}`);\n            return {\n                content: calendarResult.content,\n                context,\n                continuityScore: 0.9,\n                personalizations: [\n                    'calendar_task_executed'\n                ],\n                suggestedFollowups: calendarResult.metadata?.suggestedActions || []\n            };\n        }\n        // Generate base response using AI providers directly\n        const { aiService } = __webpack_require__(/*! ./ai-providers */ \"(rsc)/./src/lib/ai-providers.ts\");\n        let baseContent = '';\n        try {\n            // Create educational prompt based on context\n            const educationalPrompt = this.buildEducationalPrompt(context, latestMessage, userName);\n            baseContent = await aiService.generateExercise(educationalPrompt);\n            // If AI service returns fallback template, use contextual fallback\n            if (baseContent === 'TEMPLATE_FALLBACK') {\n                baseContent = this.generateContextualFallback(context, latestMessage, userName);\n            }\n        } catch (error) {\n            console.error('AI service error, using contextual fallback:', error);\n            baseContent = this.generateContextualFallback(context, latestMessage, userName);\n        }\n        // Enhance response with contextual information\n        let enhancedContent = baseContent;\n        // Add continuity references if relevant\n        if (continuityAnalysis.shouldReference) {\n            enhancedContent = this.addContinuityReferences(enhancedContent, context);\n        }\n        // Apply learning style adaptations\n        enhancedContent = _advanced_learning_profiles__WEBPACK_IMPORTED_MODULE_0__.AdvancedLearningProfileManager.adaptResponseToLearningStyle(enhancedContent, learningProfile);\n        // Determine personalizations applied\n        const personalizations = [];\n        if (continuityAnalysis.shouldReference) personalizations.push('context_reference');\n        if (learningProfile.primaryStyle !== 'multimodal') personalizations.push('learning_style_adaptation');\n        if (pendingTasks.length > 0) personalizations.push('task_aware');\n        // Generate visual recommendations\n        let visualRecommendation;\n        if (learningProfile.adaptationPreferences.prefersVisualAids && (context.currentSubject || context.currentTopic)) {\n            visualRecommendation = {\n                type: _visual_learning_engine__WEBPACK_IMPORTED_MODULE_1__.VisualLearningEngine.detectOptimalVisualType(enhancedContent, context.currentSubject),\n                reason: `Recomendado para tu perfil de aprendizaje ${learningProfile.primaryStyle}`\n            };\n        }\n        // Generate follow-up suggestions\n        const followups = this.generateContextualFollowups(context, learningProfile);\n        return {\n            content: enhancedContent,\n            context,\n            continuityScore: continuityAnalysis.score,\n            personalizations,\n            suggestedFollowups: followups,\n            visualRecommendation\n        };\n    }\n    /**\n   * Analyzes conversation continuity\n   */ static analyzeContinuity(context) {\n        const recentTurns = context.conversationFlow.slice(-4);\n        let score = 0.5 // Base score\n        ;\n        let shouldReference = false;\n        let referenceType;\n        // Check for topic continuity\n        const topics = recentTurns.map((turn)=>turn.metadata.topic).filter(Boolean);\n        if (topics.length > 1 && topics[topics.length - 1] === topics[topics.length - 2]) {\n            score += 0.2;\n            shouldReference = true;\n            referenceType = 'topic_continuity';\n        }\n        // Check for subject continuity\n        const subjects = recentTurns.map((turn)=>turn.metadata.subject).filter(Boolean);\n        if (subjects.length > 1 && subjects[subjects.length - 1] === subjects[subjects.length - 2]) {\n            score += 0.15;\n            shouldReference = true;\n            referenceType = 'subject_continuity';\n        }\n        // Check for continuation indicators\n        const latestMessage = recentTurns[recentTurns.length - 1]?.content?.toLowerCase() || '';\n        if (/contin√∫a|sigue|y despu√©s|tambi√©n|adem√°s/.test(latestMessage)) {\n            score += 0.25;\n            shouldReference = true;\n            referenceType = 'explicit_continuation';\n        }\n        // Check for question follow-up patterns\n        const hasQuestionFollowup = recentTurns.some((turn, index)=>index > 0 && turn.role === 'user' && /por qu√©|c√≥mo|cu√°ndo|d√≥nde|explica/.test(turn.content.toLowerCase()) && recentTurns[index - 1]?.role === 'assistant');\n        if (hasQuestionFollowup) {\n            score += 0.1;\n            shouldReference = true;\n            referenceType = 'followup_question';\n        }\n        return {\n            score: Math.min(score, 1.0),\n            shouldReference,\n            referenceType\n        };\n    }\n    /**\n   * Adds continuity references to response\n   */ static addContinuityReferences(content, context) {\n        const recentAssistantTurns = context.conversationFlow.filter((turn)=>turn.role === 'assistant').slice(-2);\n        if (recentAssistantTurns.length === 0) return content;\n        const lastTopic = context.currentTopic;\n        const lastSubject = context.currentSubject;\n        let referencePrefix = '';\n        if (lastTopic && lastSubject) {\n            referencePrefix = `Continuando con ${lastTopic} en ${lastSubject}: `;\n        } else if (lastTopic) {\n            referencePrefix = `Siguiendo con el tema de ${lastTopic}: `;\n        } else if (lastSubject) {\n            referencePrefix = `Continuando con ${lastSubject}: `;\n        } else {\n            referencePrefix = `Como mencion√© anteriormente: `;\n        }\n        return referencePrefix + content;\n    }\n    /**\n   * Generates contextual follow-up suggestions\n   */ static generateContextualFollowups(context, learningProfile) {\n        const followups = [];\n        // Based on current topic/subject\n        if (context.currentTopic) {\n            followups.push(`¬øTienes m√°s preguntas sobre ${context.currentTopic}?`);\n        }\n        if (context.currentSubject) {\n            followups.push(`¬øTe gustar√≠a ver ejercicios de ${context.currentSubject}?`);\n        }\n        // Based on learning style\n        if (learningProfile.adaptationPreferences.prefersVisualAids) {\n            followups.push('¬øTe ayudar√≠a ver un diagrama de esto?');\n        }\n        if (learningProfile.adaptationPreferences.prefersInteraction) {\n            followups.push('¬øQuieres practicar con un ejercicio?');\n        }\n        // Based on active intentions\n        if (context.activeIntentions.includes('explanation')) {\n            followups.push('¬øNecesitas que profundice en alg√∫n aspecto espec√≠fico?');\n        }\n        if (context.activeIntentions.includes('problem_solving')) {\n            followups.push('¬øQuieres que resolvamos otro problema similar?');\n        }\n        // Generic contextual followups\n        if (context.conversationFlow.length > 3) {\n            followups.push('¬øHay algo que no qued√≥ claro?');\n        }\n        return followups.slice(0, 3) // Limit to 3 suggestions\n        ;\n    }\n    /**\n   * Formats conversation history for external engines\n   */ static formatConversationHistory(context) {\n        return context.conversationFlow.slice(-10) // Last 10 turns\n        .map((turn)=>({\n                role: turn.role,\n                content: turn.content\n            }));\n    }\n    /**\n   * Maintains context memory by cleaning old data\n   */ static maintainContextMemory(context) {\n        // Keep only recent turns\n        if (context.conversationFlow.length > this.MAX_TURNS_RETAINED) {\n            context.conversationFlow = context.conversationFlow.slice(-this.MAX_TURNS_RETAINED);\n        }\n        // Clean old references\n        const cutoffTime = new Date(Date.now() - 12 * 60 * 60 * 1000) // 12 hours\n        ;\n        context.referenceMemory = context.referenceMemory.filter((ref)=>ref.timestamp > cutoffTime);\n        // Clean old intentions\n        if (context.activeIntentions.length > 3) {\n            context.activeIntentions = context.activeIntentions.slice(-3);\n        }\n    }\n    /**\n   * Gets conversation statistics using persistent storage\n   */ static getConversationStats(userId) {\n        const { getUserActiveSessions } = __webpack_require__(/*! ./temp-storage */ \"(rsc)/./src/lib/temp-storage.ts\");\n        if (userId) {\n            const userSessions = getUserActiveSessions(userId);\n            return {\n                activeContexts: userSessions.length,\n                totalTurns: userSessions.reduce((sum, session)=>sum + session.turns.length, 0),\n                currentTopics: [\n                    ...new Set(userSessions.map((session)=>session.currentTopic).filter(Boolean))\n                ],\n                currentSubjects: [\n                    ...new Set(userSessions.map((session)=>session.currentSubject).filter(Boolean))\n                ]\n            };\n        }\n        // For global stats, we need to import the conversations array\n        const { tempConversations } = __webpack_require__(/*! ./temp-storage */ \"(rsc)/./src/lib/temp-storage.ts\");\n        const activeConversations = tempConversations.filter((session)=>{\n            const oneHourAgo = new Date(Date.now() - 60 * 60 * 1000);\n            return session.lastUpdate > oneHourAgo;\n        });\n        return {\n            totalActiveContexts: activeConversations.length,\n            totalUsers: new Set(activeConversations.map((session)=>session.userId)).size,\n            averageContextAge: this.calculateAverageContextAgeFromSessions(activeConversations)\n        };\n    }\n    /**\n   * Calculates average context age from persistent sessions\n   */ static calculateAverageContextAgeFromSessions(sessions) {\n        if (sessions.length === 0) return 0;\n        const now = Date.now();\n        const totalAge = sessions.reduce((sum, session)=>sum + (now - new Date(session.lastUpdate).getTime()), 0);\n        return Math.round(totalAge / sessions.length / (60 * 1000)) // Average age in minutes\n        ;\n    }\n    /**\n   * Forces cleanup of all contexts (useful for testing)\n   */ static clearAllContexts() {\n        const { cleanupOldConversations } = __webpack_require__(/*! ./temp-storage */ \"(rsc)/./src/lib/temp-storage.ts\");\n        cleanupOldConversations();\n        console.log('üßπ All conversation contexts cleared using persistent storage');\n    }\n    /**\n   * Gets active context for user (useful for debugging)\n   */ static getActiveContext(userId, sessionId) {\n        const { getConversationSession, getUserActiveSessions } = __webpack_require__(/*! ./temp-storage */ \"(rsc)/./src/lib/temp-storage.ts\");\n        if (sessionId) {\n            const session = getConversationSession(userId, sessionId);\n            if (session) {\n                return {\n                    userId: session.userId,\n                    sessionId: session.sessionId,\n                    currentTopic: session.currentTopic,\n                    currentSubject: session.currentSubject,\n                    conversationFlow: session.turns,\n                    contextSummary: this.buildContextSummary(session),\n                    activeIntentions: this.extractActiveIntentions(session.turns.slice(-5)),\n                    pendingQuestions: [],\n                    referenceMemory: this.buildReferenceMemory(session.turns),\n                    lastUpdate: session.lastUpdate\n                };\n            }\n        }\n        // Find any active session for user\n        const activeSessions = getUserActiveSessions(userId);\n        if (activeSessions.length > 0) {\n            const session = activeSessions[0];\n            return {\n                userId: session.userId,\n                sessionId: session.sessionId,\n                currentTopic: session.currentTopic,\n                currentSubject: session.currentSubject,\n                conversationFlow: session.turns,\n                contextSummary: this.buildContextSummary(session),\n                activeIntentions: this.extractActiveIntentions(session.turns.slice(-5)),\n                pendingQuestions: [],\n                referenceMemory: this.buildReferenceMemory(session.turns),\n                lastUpdate: session.lastUpdate\n            };\n        }\n        return null;\n    }\n} // Persistent storage cleanup is handled by temp-storage.ts\n // No need for additional cleanup intervals\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvbGliL2NvbnRleHR1YWwtY29udmVyc2F0aW9uLW1hbmFnZXIudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUFBLDhDQUE4QztBQUM5QyxxRUFBcUU7QUFHUTtBQUNkO0FBRWdDO0FBb0R4RixNQUFNRzs7UUFFWCx1REFBdUQ7YUFDL0JDLHFCQUFxQjs7O2FBQ3JCQyxpQkFBaUI7OzthQUNqQkMsc0JBQXNCOztJQUU5Qzs7R0FFQyxHQUNELGFBQWFDLHlCQUNYQyxNQUFjLEVBQ2RDLE9BQWUsRUFDZkMsU0FBa0IsRUFDbEJDLFFBQWlCLEVBQ1k7UUFFN0IsTUFBTUMsa0JBQWtCRixhQUFhLENBQUMsUUFBUSxFQUFFRixPQUFPLENBQUMsRUFBRUssS0FBS0MsR0FBRyxJQUFJO1FBRXRFLHNDQUFzQztRQUN0QyxNQUFNLEVBQ0pDLHNCQUFzQixFQUN0QkMseUJBQXlCLEVBQ3pCQyxtQkFBbUIsRUFDbkJDLGNBQWMsRUFDZEMsZUFBZSxFQUNoQixHQUFHQyxtQkFBT0EsQ0FBQyx1REFBZ0I7UUFFNUIsZ0RBQWdEO1FBQ2hELElBQUlDLFVBQVVOLHVCQUF1QlAsUUFBUUk7UUFDN0MsSUFBSSxDQUFDUyxTQUFTO1lBQ1pBLFVBQVVMLDBCQUEwQlIsUUFBUUk7UUFDOUM7UUFFQVUsUUFBUUMsR0FBRyxDQUFDLENBQUMsa0NBQWtDLEVBQUVYLGdCQUFnQixHQUFHLEVBQUVILFFBQVFlLFNBQVMsQ0FBQyxHQUFHLElBQUksSUFBSSxDQUFDO1FBQ3BHRixRQUFRQyxHQUFHLENBQUMsQ0FBQyxlQUFlLEVBQUVGLFFBQVFJLEtBQUssQ0FBQ0MsTUFBTSxDQUFDLGlCQUFpQixFQUFFTCxRQUFRTSxZQUFZLENBQUNDLE1BQU0sQ0FBQ0MsQ0FBQUEsSUFBSyxDQUFDQSxFQUFFQyxTQUFTLEVBQUVKLE1BQU0sQ0FBQyxjQUFjLENBQUM7UUFFM0ksMkJBQTJCO1FBQzNCLE1BQU1LLGtCQUFrQixJQUFJLENBQUNDLHNCQUFzQixDQUFDdkI7UUFFcEQsc0NBQXNDO1FB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QyxrQkFBa0IsRUFBRTtvQkFDcEJDLGlCQUFpQixJQUFJLENBQUNDLG9CQUFvQixDQUFDOUIsUUFBUUksS0FBSztvQkFDeEQyQixZQUFZL0IsUUFBUStCLFVBQVU7Z0JBQ2hDO1lBQ0Y7UUFDRjtRQUVBLG1DQUFtQztRQUNuQyxNQUFNOEgsaUJBQWlCdkIsc0JBQXNCbko7UUFDN0MsSUFBSTBLLGVBQWV4SixNQUFNLEdBQUcsR0FBRztZQUM3QixNQUFNTCxVQUFVNkosY0FBYyxDQUFDLEVBQUU7WUFDakMsT0FBTztnQkFDTDFLLFFBQVFhLFFBQVFiLE1BQU07Z0JBQ3RCRSxXQUFXVyxRQUFRWCxTQUFTO2dCQUM1QndCLGNBQWNiLFFBQVFhLFlBQVk7Z0JBQ2xDQyxnQkFBZ0JkLFFBQVFjLGNBQWM7Z0JBQ3RDQyxrQkFBa0JmLFFBQVFJLEtBQUs7Z0JBQy9CbUIsZ0JBQWdCLElBQUksQ0FBQ0MsbUJBQW1CLENBQUN4QjtnQkFDekN5QixrQkFBa0IsSUFBSSxDQUFDQyx1QkFBdUIsQ0FBQzFCLFFBQVFJLEtBQUssQ0FBQ3VCLEtBQUssQ0FBQyxDQUFDO2dCQUNwRUMsa0JBQWtCLEVBQUU7Z0JBQ3BCQyxpQkFBaUIsSUFBSSxDQUFDQyxvQkFBb0IsQ0FBQzlCLFFBQVFJLEtBQUs7Z0JBQ3hEMkIsWUFBWS9CLFFBQVErQixVQUFVO1lBQ2hDO1FBQ0Y7UUFFQSxPQUFPO0lBQ1Q7QUFDRixFQUVBLDJEQUEyRDtDQUMzRCwyQ0FBMkMiLCJzb3VyY2VzIjpbIi9Vc2Vycy9yb2RyaWdvZGliZXJuYXJkbzMzZ21haWwuY29tL0RvY3VtZW50cy9BcHAgRGV2ZWxvcG1lbnQgUHJveWVjdHMvSW50ZWxsZWdvIFBsYXRmb3JtL3NyYy9saWIvY29udGV4dHVhbC1jb252ZXJzYXRpb24tbWFuYWdlci50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb250ZXh0dWFsIENvbnZlcnNhdGlvbiBNYW5hZ2VyIGZvciBTYXJhIEFJXG4vLyBQcm92aWRlcyBpbnRlbGxpZ2VudCBjb250ZXh0IG1hbmFnZW1lbnQgYW5kIGNvbnZlcnNhdGlvbiBjb2hlcmVuY2VcblxuaW1wb3J0IHsgQ29udmVyc2F0aW9uTWVtb3J5TWFuYWdlciB9IGZyb20gJy4vY29udmVyc2F0aW9uLW1lbW9yeSdcbmltcG9ydCB7IEFkdmFuY2VkTGVhcm5pbmdQcm9maWxlTWFuYWdlciB9IGZyb20gJy4vYWR2YW5jZWQtbGVhcm5pbmctcHJvZmlsZXMnXG5pbXBvcnQgeyBWaXN1YWxMZWFybmluZ0VuZ2luZSB9IGZyb20gJy4vdmlzdWFsLWxlYXJuaW5nLWVuZ2luZSdcbmltcG9ydCB7IEFjYWRlbWljU2VhcmNoRW5naW5lIH0gZnJvbSAnLi9hY2FkZW1pYy1zZWFyY2gtZW5naW5lJ1xuaW1wb3J0IHsgQUlDYWxlbmRhckludGVncmF0aW9uLCBhbmFseXplQ29udmVyc2F0aW9uRm9yRXZlbnRzIH0gZnJvbSAnLi9jYWxlbmRhci1haS1pbnRlZ3JhdGlvbidcblxuZXhwb3J0IGludGVyZmFjZSBDb252ZXJzYXRpb25Db250ZXh0IHtcbiAgdXNlcklkOiBzdHJpbmdcbiAgc2Vzc2lvbklkOiBzdHJpbmdcbiAgY3VycmVudFRvcGljPzogc3RyaW5nXG4gIGN1cnJlbnRTdWJqZWN0Pzogc3RyaW5nXG4gIGNvbnZlcnNhdGlvbkZsb3c6IENvbnZlcnNhdGlvblR1cm5bXVxuICBjb250ZXh0U3VtbWFyeTogc3RyaW5nXG4gIGFjdGl2ZUludGVudGlvbnM6IHN0cmluZ1tdXG4gIHBlbmRpbmdRdWVzdGlvbnM6IHN0cmluZ1tdXG4gIHJlZmVyZW5jZU1lbW9yeTogQ29udGV4dFJlZmVyZW5jZVtdXG4gIGxhc3RVcGRhdGU6IERhdGVcbn1cblxuZXhwb3J0IGludGVyZmFjZSBDb252ZXJzYXRpb25UdXJuIHtcbiAgaWQ6IHN0cmluZ1xuICB0aW1lc3RhbXA6IERhdGVcbiAgcm9sZTogJ3VzZXInIHwgJ2Fzc2lzdGFudCdcbiAgY29udGVudDogc3RyaW5nXG4gIG1ldGFkYXRhOiB7XG4gICAgc3ViamVjdD86IHN0cmluZ1xuICAgIHRvcGljPzogc3RyaW5nXG4gICAgaW50ZW50aW9uPzogc3RyaW5nXG4gICAgZW1vdGlvbj86IHN0cmluZ1xuICAgIGNvbmZpZGVuY2U/OiBudW1iZXJcbiAgICB2aXN1YWxzR2VuZXJhdGVkPzogYm9vbGVhblxuICAgIHNlYXJjaFBlcmZvcm1lZD86IGJvb2xlYW5cbiAgfVxufVxuXG5leHBvcnQgaW50ZXJmYWNlIENvbnRleHRSZWZlcmVuY2Uge1xuICBpZDogc3RyaW5nXG4gIHR5cGU6ICd0b3BpY19jb250aW51YXRpb24nIHwgJ3N1YmplY3RfcmVmZXJlbmNlJyB8ICdwcm9ibGVtX3NvbHZpbmcnIHwgJ2V4cGxhbmF0aW9uX2ZvbGxvd3VwJ1xuICBjb250ZW50OiBzdHJpbmdcbiAgcmVsZXZhbmNlU2NvcmU6IG51bWJlclxuICB0dXJuSW5kZXg6IG51bWJlclxuICB0aW1lc3RhbXA6IERhdGVcbn1cblxuZXhwb3J0IGludGVyZmFjZSBDb250ZXh0dWFsUmVzcG9uc2Uge1xuICBjb250ZW50OiBzdHJpbmdcbiAgY29udGV4dDogQ29udmVyc2F0aW9uQ29udGV4dFxuICBjb250aW51aXR5U2NvcmU6IG51bWJlclxuICBwZXJzb25hbGl6YXRpb25zOiBzdHJpbmdbXVxuICBzdWdnZXN0ZWRGb2xsb3d1cHM6IHN0cmluZ1tdXG4gIHZpc3VhbFJlY29tbWVuZGF0aW9uPzoge1xuICAgIHR5cGU6IHN0cmluZ1xuICAgIHJlYXNvbjogc3RyaW5nXG4gIH1cbn1cblxuZXhwb3J0IGNsYXNzIENvbnRleHR1YWxDb252ZXJzYXRpb25NYW5hZ2VyIHtcbiAgXG4gIC8vIENvbmZpZ3VyYXRpb24gZm9yIHBlcnNpc3RlbnQgY29udmVyc2F0aW9uIG1hbmFnZW1lbnRcbiAgcHJpdmF0ZSBzdGF0aWMgcmVhZG9ubHkgTUFYX1RVUk5TX1JFVEFJTkVEID0gMjBcbiAgcHJpdmF0ZSBzdGF0aWMgcmVhZG9ubHkgTUFYX1JFRkVSRU5DRVMgPSAxMFxuICBwcml2YXRlIHN0YXRpYyByZWFkb25seSBDT05URVhUX0RFQ0FZX0hPVVJTID0gMjRcblxuICAvKipcbiAgICogUHJvY2Vzc2VzIHVzZXIgbWVzc2FnZSB3aXRoIGZ1bGwgY29udGV4dHVhbCBhd2FyZW5lc3NcbiAgICovXG4gIHN0YXRpYyBhc3luYyBwcm9jZXNzQ29udGV4dHVhbE1lc3NhZ2UoXG4gICAgdXNlcklkOiBzdHJpbmcsIFxuICAgIG1lc3NhZ2U6IHN0cmluZywgXG4gICAgc2Vzc2lvbklkPzogc3RyaW5nLFxuICAgIHVzZXJOYW1lPzogc3RyaW5nXG4gICk6IFByb21pc2U8Q29udGV4dHVhbFJlc3BvbnNlPiB7XG4gICAgXG4gICAgY29uc3QgYWN0dWFsU2Vzc2lvbklkID0gc2Vzc2lvbklkIHx8IGBzZXNzaW9uXyR7dXNlcklkfV8ke0RhdGUubm93KCl9YFxuICAgIFxuICAgIC8vIEltcG9ydCBwZXJzaXN0ZW50IHN0b3JhZ2UgZnVuY3Rpb25zXG4gICAgY29uc3QgeyBcbiAgICAgIGdldENvbnZlcnNhdGlvblNlc3Npb24sIFxuICAgICAgY3JlYXRlQ29udmVyc2F0aW9uU2Vzc2lvbiwgXG4gICAgICBhZGRDb252ZXJzYXRpb25UdXJuLCBcbiAgICAgIGFkZFBlbmRpbmdUYXNrLFxuICAgICAgZ2V0UGVuZGluZ1Rhc2tzIFxuICAgIH0gPSByZXF1aXJlKCcuL3RlbXAtc3RvcmFnZScpXG4gICAgXG4gICAgLy8gR2V0IG9yIGNyZWF0ZSBwZXJzaXN0ZW50IGNvbnZlcnNhdGlvbiBzZXNzaW9uXG4gICAgbGV0IHNlc3Npb24gPSBnZXRDb252ZXJzYXRpb25TZXNzaW9uKHVzZXJJZCwgYWN0dWFsU2Vzc2lvbklkKVxuICAgIGlmICghc2Vzc2lvbikge1xuICAgICAgc2Vzc2lvbiA9IGNyZWF0ZUNvbnZlcnNhdGlvblNlc3Npb24odXNlcklkLCBhY3R1YWxTZXNzaW9uSWQpXG4gICAgfVxuICAgIFxuICAgIGNvbnNvbGUubG9nKGDwn5KsIFByb2Nlc3NpbmcgbWVzc2FnZSBmb3Igc2Vzc2lvbiAke2FjdHVhbFNlc3Npb25JZH06IFwiJHttZXNzYWdlLnN1YnN0cmluZygwLCA1MCl9Li4uXCJgKVxuICAgIGNvbnNvbGUubG9nKGDwn5OKIFNlc3Npb24gaGFzICR7c2Vzc2lvbi50dXJucy5sZW5ndGh9IHByZXZpb3VzIHR1cm5zLCAke3Nlc3Npb24ucGVuZGluZ1Rhc2tzLmZpbHRlcih0ID0+ICF0LmNvbXBsZXRlZCkubGVuZ3RofSBwZW5kaW5nIHRhc2tzYClcbiAgICBcbiAgICAvLyBBbmFseXplIG1lc3NhZ2UgbWV0YWRhdGFcbiAgICBjb25zdCBtZXNzYWdlTWV0YWRhdGEgPSB0aGlzLmFuYWx5emVNZXNzYWdlTWV0YWRhdGEobWVzc2FnZSlcbiAgICBcbiAgICAvLyBBZGQgdXNlciB0dXJuIHRvIHBlcnNpc3RlbnQgc3RvcmFnZVxuICAgIHNlc3Npb24gPSBhZGRDb252ZXJzYXRpb25UdXJuKHVzZXJJZCwgYWN0dWFsU2Vzc2lvbklkLCAndXNlcicsIG1lc3NhZ2UsIG1lc3NhZ2VNZXRhZGF0YSlcbiAgICBcbiAgICAvLyBDaGVjayBmb3IgcGVuZGluZyB0YXNrcyB0aGF0IG1pZ2h0IHJlbGF0ZSB0byB0aGlzIG1lc3NhZ2VcbiAgICBjb25zdCBwZW5kaW5nVGFza3MgPSBnZXRQZW5kaW5nVGFza3ModXNlcklkLCBhY3R1YWxTZXNzaW9uSWQpXG4gICAgXG4gICAgLy8gQnVpbGQgY29udGV4dCBmcm9tIHBlcnNpc3RlbnQgZGF0YVxuICAgIGNvbnN0IGNvbnRleHQ6IENvbnZlcnNhdGlvbkNvbnRleHQgPSB7XG4gICAgICB1c2VySWQsXG4gICAgICBzZXNzaW9uSWQ6IGFjdHVhbFNlc3Npb25JZCxcbiAgICAgIGN1cnJlbnRUb3BpYzogc2Vzc2lvbi5jdXJyZW50VG9waWMsXG4gICAgICBjdXJyZW50U3ViamVjdDogc2Vzc2lvbi5jdXJyZW50U3ViamVjdCxcbiAgICAgIGNvbnZlcnNhdGlvbkZsb3c6IHNlc3Npb24udHVybnMubWFwKHR1cm4gPT4gKHtcbiAgICAgICAgaWQ6IHR1cm4uaWQsXG4gICAgICAgIHRpbWVzdGFtcDogdHVybi50aW1lc3RhbXAsXG4gICAgICAgIHJvbGU6IHR1cm4ucm9sZSxcbiAgICAgICAgY29udGVudDogdHVybi5jb250ZW50LFxuICAgICAgICBtZXRhZGF0YTogdHVybi5tZXRhZGF0YVxuICAgICAgfSkpLFxuICAgICAgY29udGV4dFN1bW1hcnk6IHRoaXMuYnVpbGRDb250ZXh0U3VtbWFyeShzZXNzaW9uKSxcbiAgICAgIGFjdGl2ZUludGVudGlvbnM6IHRoaXMuZXh0cmFjdEFjdGl2ZUludGVudGlvbnMoc2Vzc2lvbi50dXJucy5zbGljZSgtNSkpLFxuICAgICAgcGVuZGluZ1F1ZXN0aW9uczogW10sXG4gICAgICByZWZlcmVuY2VNZW1vcnk6IHRoaXMuYnVpbGRSZWZlcmVuY2VNZW1vcnkoc2Vzc2lvbi50dXJucyksXG4gICAgICBsYXN0VXBkYXRlOiBuZXcgRGF0ZSgpXG4gICAgfVxuICAgIFxuICAgIC8vIEdlbmVyYXRlIGNvbnRleHR1YWxseSBhd2FyZSByZXNwb25zZVxuICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgdGhpcy5nZW5lcmF0ZUNvbnRleHR1YWxSZXNwb25zZShjb250ZXh0LCB1c2VyTmFtZSwgcGVuZGluZ1Rhc2tzKVxuICAgIFxuICAgIC8vIEFkZCBhc3Npc3RhbnQgdHVybiB0byBwZXJzaXN0ZW50IHN0b3JhZ2VcbiAgICBjb25zdCBhc3Npc3RhbnRNZXRhZGF0YSA9IHtcbiAgICAgIGNvbmZpZGVuY2U6IHJlc3BvbnNlLmNvbnRpbnVpdHlTY29yZSxcbiAgICAgIHZpc3VhbHNHZW5lcmF0ZWQ6ICEhcmVzcG9uc2UudmlzdWFsUmVjb21tZW5kYXRpb24sXG4gICAgICBzZWFyY2hQZXJmb3JtZWQ6IHJlc3BvbnNlLnBlcnNvbmFsaXphdGlvbnMuaW5jbHVkZXMoJ2FjYWRlbWljX3NlYXJjaCcpLFxuICAgICAgdGFza0NvbXBsZXRlZDogcmVzcG9uc2UucGVyc29uYWxpemF0aW9ucy5pbmNsdWRlcygndGFza19jb21wbGV0ZWQnKVxuICAgIH1cbiAgICBcbiAgICBhZGRDb252ZXJzYXRpb25UdXJuKHVzZXJJZCwgYWN0dWFsU2Vzc2lvbklkLCAnYXNzaXN0YW50JywgcmVzcG9uc2UuY29udGVudCwgYXNzaXN0YW50TWV0YWRhdGEpXG4gICAgXG4gICAgcmV0dXJuIHJlc3BvbnNlXG4gIH1cblxuICAvKipcbiAgICogQnVpbGQgY29udGV4dCBzdW1tYXJ5IGZyb20gcGVyc2lzdGVudCBjb252ZXJzYXRpb24gZGF0YVxuICAgKi9cbiAgcHJpdmF0ZSBzdGF0aWMgYnVpbGRDb250ZXh0U3VtbWFyeShzZXNzaW9uOiBhbnkpOiBzdHJpbmcge1xuICAgIGNvbnN0IHJlY2VudFR1cm5zID0gc2Vzc2lvbi50dXJucy5zbGljZSgtNilcbiAgICBjb25zdCBrZXlUb3BpY3MgPSBbLi4ubmV3IFNldChyZWNlbnRUdXJuc1xuICAgICAgLm1hcCgodHVybjogYW55KSA9PiB0dXJuLm1ldGFkYXRhLnRvcGljKVxuICAgICAgLmZpbHRlcihCb29sZWFuKSldXG4gICAgXG4gICAgY29uc3Qga2V5U3ViamVjdHMgPSBbLi4ubmV3IFNldChyZWNlbnRUdXJuc1xuICAgICAgLm1hcCgodHVybjogYW55KSA9PiB0dXJuLm1ldGFkYXRhLnN1YmplY3QpXG4gICAgICAuZmlsdGVyKEJvb2xlYW4pKV1cbiAgICBcbiAgICBjb25zdCBzdW1tYXJ5UGFydHM6IHN0cmluZ1tdID0gW11cbiAgICBcbiAgICBpZiAoa2V5U3ViamVjdHMubGVuZ3RoID4gMCkge1xuICAgICAgc3VtbWFyeVBhcnRzLnB1c2goYE1hdGVyaWFzOiAke2tleVN1YmplY3RzLmpvaW4oJywgJyl9YClcbiAgICB9XG4gICAgXG4gICAgaWYgKGtleVRvcGljcy5sZW5ndGggPiAwKSB7XG4gICAgICBzdW1tYXJ5UGFydHMucHVzaChgVGVtYXM6ICR7a2V5VG9waWNzLmpvaW4oJywgJyl9YClcbiAgICB9XG4gICAgXG4gICAgcmV0dXJuIHN1bW1hcnlQYXJ0cy5qb2luKCcgfCAnKSB8fCAnQ29udmVyc2FjacOzbiBnZW5lcmFsJ1xuICB9XG5cbiAgLyoqXG4gICAqIEV4dHJhY3QgYWN0aXZlIGludGVudGlvbnMgZnJvbSByZWNlbnQgY29udmVyc2F0aW9uIHR1cm5zXG4gICAqL1xuICBwcml2YXRlIHN0YXRpYyBleHRyYWN0QWN0aXZlSW50ZW50aW9ucyhyZWNlbnRUdXJuczogYW55W10pOiBzdHJpbmdbXSB7XG4gICAgY29uc3QgaW50ZW50aW9ucyA9IHJlY2VudFR1cm5zXG4gICAgICAubWFwKCh0dXJuOiBhbnkpID0+IHR1cm4ubWV0YWRhdGEuaW50ZW50aW9uKVxuICAgICAgLmZpbHRlcihCb29sZWFuKVxuICAgICAgLnNsaWNlKC0zKVxuICAgIFxuICAgIHJldHVybiBbLi4ubmV3IFNldChpbnRlbnRpb25zKV1cbiAgfVxuXG4gIC8qKlxuICAgKiBCdWlsZCByZWZlcmVuY2UgbWVtb3J5IGZyb20gY29udmVyc2F0aW9uIHR1cm5zXG4gICAqL1xuICBwcml2YXRlIHN0YXRpYyBidWlsZFJlZmVyZW5jZU1lbW9yeSh0dXJuczogYW55W10pOiBDb250ZXh0UmVmZXJlbmNlW10ge1xuICAgIGNvbnN0IHJlZmVyZW5jZXM6IENvbnRleHRSZWZlcmVuY2VbXSA9IFtdXG4gICAgY29uc3QgcmVjZW50VHVybnMgPSB0dXJucy5zbGljZSgtMTApXG4gICAgXG4gICAgcmVjZW50VHVybnMuZm9yRWFjaCgodHVybiwgaW5kZXgpID0+IHtcbiAgICAgIGlmICh0dXJuLm1ldGFkYXRhLmNvbmZpZGVuY2UgJiYgdHVybi5tZXRhZGF0YS5jb25maWRlbmNlID4gMC43KSB7XG4gICAgICAgIHJlZmVyZW5jZXMucHVzaCh7XG4gICAgICAgICAgaWQ6IGByZWZfJHt0dXJuLmlkfWAsXG4gICAgICAgICAgdHlwZTogdGhpcy5kZXRlcm1pbmVSZWZlcmVuY2VUeXBlRnJvbU1ldGFkYXRhKHR1cm4ubWV0YWRhdGEpLFxuICAgICAgICAgIGNvbnRlbnQ6IHR1cm4uY29udGVudC5zdWJzdHJpbmcoMCwgMTAwKSArICcuLi4nLFxuICAgICAgICAgIHJlbGV2YW5jZVNjb3JlOiB0dXJuLm1ldGFkYXRhLmNvbmZpZGVuY2UsXG4gICAgICAgICAgdHVybkluZGV4OiBpbmRleCxcbiAgICAgICAgICB0aW1lc3RhbXA6IHR1cm4udGltZXN0YW1wXG4gICAgICAgIH0pXG4gICAgICB9XG4gICAgfSlcbiAgICBcbiAgICByZXR1cm4gcmVmZXJlbmNlcy5zbGljZSgtNSkgLy8gS2VlcCBvbmx5IGxhc3QgNSByZWZlcmVuY2VzXG4gIH1cblxuICAvKipcbiAgICogSGVscGVyIHRvIGRldGVybWluZSByZWZlcmVuY2UgdHlwZSBmcm9tIG1ldGFkYXRhXG4gICAqL1xuICBwcml2YXRlIHN0YXRpYyBkZXRlcm1pbmVSZWZlcmVuY2VUeXBlRnJvbU1ldGFkYXRhKG1ldGFkYXRhOiBhbnkpOiBDb250ZXh0UmVmZXJlbmNlWyd0eXBlJ10ge1xuICAgIGlmIChtZXRhZGF0YS5pbnRlbnRpb24gPT09ICdjb250aW51YXRpb24nKSByZXR1cm4gJ3RvcGljX2NvbnRpbnVhdGlvbidcbiAgICBpZiAobWV0YWRhdGEuaW50ZW50aW9uID09PSAncHJvYmxlbV9zb2x2aW5nJykgcmV0dXJuICdwcm9ibGVtX3NvbHZpbmcnXG4gICAgaWYgKG1ldGFkYXRhLmludGVudGlvbiA9PT0gJ2V4cGxhbmF0aW9uJykgcmV0dXJuICdleHBsYW5hdGlvbl9mb2xsb3d1cCdcbiAgICByZXR1cm4gJ3N1YmplY3RfcmVmZXJlbmNlJ1xuICB9XG5cbiAgLyoqXG4gICAqIEhhbmRsZXMgY2FsZW5kYXIgdGFzayBleGVjdXRpb24gd2l0aCByZWFsIGV2ZW50IGNyZWF0aW9uXG4gICAqL1xuICBwcml2YXRlIHN0YXRpYyBhc3luYyBoYW5kbGVDYWxlbmRhclRhc2tzKFxuICAgIHVzZXJJZDogc3RyaW5nLFxuICAgIG1lc3NhZ2U6IHN0cmluZyxcbiAgICBjb252ZXJzYXRpb25IaXN0b3J5OiBBcnJheTx7IHJvbGU6ICd1c2VyJyB8ICdhc3Npc3RhbnQnLCBjb250ZW50OiBzdHJpbmcgfT4sXG4gICAgcGVuZGluZ1Rhc2tzOiBhbnlbXVxuICApOiBQcm9taXNlPHsgdHlwZTogc3RyaW5nOyBjb250ZW50OiBzdHJpbmc7IG1ldGFkYXRhPzogYW55IH0gfCBudWxsPiB7XG4gICAgXG4gICAgY29uc29sZS5sb2coYPCflI0gQ2hlY2tpbmcgZm9yIGNhbGVuZGFyIHRhc2tzIGluIG1lc3NhZ2U6IFwiJHttZXNzYWdlLnN1YnN0cmluZygwLCA1MCl9Li4uXCJgKVxuICAgIFxuICAgIC8vIEluaXRpYWxpemUgY2FsZW5kYXIgaW50ZWdyYXRpb25cbiAgICBjb25zdCBjYWxlbmRhckludGVncmF0aW9uID0gbmV3IEFJQ2FsZW5kYXJJbnRlZ3JhdGlvbih1c2VySWQpXG4gICAgXG4gICAgLy8gQW5hbHl6ZSBtZXNzYWdlIGZvciBjYWxlbmRhciBldmVudHNcbiAgICBjb25zdCBjYWxlbmRhclJlc3VsdCA9IGF3YWl0IGNhbGVuZGFySW50ZWdyYXRpb24ucHJvY2Vzc01lc3NhZ2UobWVzc2FnZSwgY29udmVyc2F0aW9uSGlzdG9yeSlcbiAgICBcbiAgICBpZiAoY2FsZW5kYXJSZXN1bHQubmVlZHNFdmVudENyZWF0aW9uKSB7XG4gICAgICBjb25zb2xlLmxvZyhg8J+OryBDYWxlbmRhciB0YXNrIGRldGVjdGVkIGFuZCBleGVjdXRlZCFgKVxuICAgICAgXG4gICAgICAvLyBNYXJrIGFueSByZWxhdGVkIHBlbmRpbmcgdGFzayBhcyBjb21wbGV0ZWRcbiAgICAgIGlmIChwZW5kaW5nVGFza3MubGVuZ3RoID4gMCkge1xuICAgICAgICBjb25zdCBjYWxlbmRhclRhc2sgPSBwZW5kaW5nVGFza3MuZmluZCh0ID0+IHQudHlwZSA9PT0gJ2NhbGVuZGFyX2V2ZW50JylcbiAgICAgICAgaWYgKGNhbGVuZGFyVGFzaykge1xuICAgICAgICAgIGNvbnN0IHsgbWFya1Rhc2tDb21wbGV0ZWQgfSA9IHJlcXVpcmUoJy4vdGVtcC1zdG9yYWdlJylcbiAgICAgICAgICBtYXJrVGFza0NvbXBsZXRlZCh1c2VySWQsICdjdXJyZW50LXNlc3Npb24nLCBjYWxlbmRhclRhc2suaWQsIGNhbGVuZGFyUmVzdWx0KVxuICAgICAgICB9XG4gICAgICB9XG4gICAgICBcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHR5cGU6ICdjYWxlbmRhcl9ldmVudF9jcmVhdGlvbicsXG4gICAgICAgIGNvbnRlbnQ6IGNhbGVuZGFyUmVzdWx0LnJlc3BvbnNlIHx8ICdFdmVudG8gY3JlYWRvIGV4aXRvc2FtZW50ZScsXG4gICAgICAgIG1ldGFkYXRhOiB7XG4gICAgICAgICAgc3VnZ2VzdGVkQWN0aW9uczogY2FsZW5kYXJSZXN1bHQuZXZlbnQgXG4gICAgICAgICAgICA/IFsnVmVyIGVuIGNhbGVuZGFyaW8nLCAnRWRpdGFyIGV2ZW50bycsICdFbGltaW5hciBldmVudG8nXVxuICAgICAgICAgICAgOiBbJ1JlaW50ZW50YXInLCAnUHJvcG9yY2lvbmFyIG3DoXMgZGV0YWxsZXMnXSxcbiAgICAgICAgICBldmVudENyZWF0ZWQ6ICEhY2FsZW5kYXJSZXN1bHQuZXZlbnRcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICBcbiAgICByZXR1cm4gbnVsbFxuICB9XG5cbiAgLyoqXG4gICAqIEJ1aWxkcyBlZHVjYXRpb25hbCBwcm9tcHQgYmFzZWQgb24gY29udmVyc2F0aW9uIGNvbnRleHRcbiAgICovXG4gIHByaXZhdGUgc3RhdGljIGJ1aWxkRWR1Y2F0aW9uYWxQcm9tcHQoXG4gICAgY29udGV4dDogQ29udmVyc2F0aW9uQ29udGV4dCxcbiAgICBtZXNzYWdlOiBzdHJpbmcsXG4gICAgdXNlck5hbWU/OiBzdHJpbmdcbiAgKTogc3RyaW5nIHtcbiAgICBjb25zdCByZWNlbnRUdXJucyA9IGNvbnRleHQuY29udmVyc2F0aW9uRmxvdy5zbGljZSgtMylcbiAgICBjb25zdCBjb252ZXJzYXRpb25Db250ZXh0ID0gcmVjZW50VHVybnNcbiAgICAgIC5tYXAodHVybiA9PiBgJHt0dXJuLnJvbGUgPT09ICd1c2VyJyA/ICdFc3R1ZGlhbnRlJyA6ICdUdXRvcid9OiAke3R1cm4uY29udGVudH1gKVxuICAgICAgLmpvaW4oJ1xcbicpXG4gICAgXG4gICAgbGV0IHByb21wdCA9IGBFcmVzIFNhcmEsIHVuYSB0dXRvcmEgZGUgSUEgZXNwZWNpYWxpemFkYSBlbiBlZHVjYWNpw7NuIHNlY3VuZGFyaWEuIGBcbiAgICBcbiAgICBpZiAodXNlck5hbWUpIHtcbiAgICAgIHByb21wdCArPSBgRWwgZXN0dWRpYW50ZSBzZSBsbGFtYSAke3VzZXJOYW1lfS4gYFxuICAgIH1cbiAgICBcbiAgICBpZiAoY29udGV4dC5jdXJyZW50U3ViamVjdCkge1xuICAgICAgcHJvbXB0ICs9IGBBY3R1YWxtZW50ZSBlc3TDoXMgYXl1ZGFuZG8gY29uICR7Y29udGV4dC5jdXJyZW50U3ViamVjdH0uIGBcbiAgICB9XG4gICAgXG4gICAgaWYgKGNvbnRleHQuY29udGV4dFN1bW1hcnkgJiYgY29udGV4dC5jb250ZXh0U3VtbWFyeSAhPT0gJ0NvbnZlcnNhY2nDs24gZ2VuZXJhbCcpIHtcbiAgICAgIHByb21wdCArPSBgQ29udGV4dG8gZGUgbGEgY29udmVyc2FjacOzbjogJHtjb250ZXh0LmNvbnRleHRTdW1tYXJ5fS4gYFxuICAgIH1cbiAgICBcbiAgICBwcm9tcHQgKz0gYFxcblxcbkNvbnZlcnNhY2nDs24gcmVjaWVudGU6XFxuJHtjb252ZXJzYXRpb25Db250ZXh0fWBcbiAgICBwcm9tcHQgKz0gYFxcblxcbk51ZXZvIG1lbnNhamUgZGVsIGVzdHVkaWFudGU6IFwiJHttZXNzYWdlfVwiYFxuICAgIFxuICAgIHByb21wdCArPSBgXFxuXFxuSW5zdHJ1Y2Npb25lczpcXG5gXG4gICAgcHJvbXB0ICs9IGAtIFJlc3BvbmRlIGNvbW8gU2FyYSwgbGEgdHV0b3JhIGRlIElBIGFtaWdhYmxlIHkgZXhwZXJ0YVxcbmBcbiAgICBwcm9tcHQgKz0gYC0gTWFudMOpbiBjb2hlcmVuY2lhIGNvbiBsYSBjb252ZXJzYWNpw7NuIGFudGVyaW9yXFxuYFxuICAgIHByb21wdCArPSBgLSBTaSBkZXRlY3RhcyBxdWUgZWwgZXN0dWRpYW50ZSBxdWllcmUgYWdlbmRhciBhbGdvIChleGFtZW4sIHNlc2nDs24gZGUgZXN0dWRpbyksIG1lbmNpb25hIHF1ZSBwdWVkZXMgYXl1ZGFyIGNvbiBlc29cXG5gXG4gICAgcHJvbXB0ICs9IGAtIFVzYSBlamVtcGxvcyBjb25jcmV0b3MgeSB1biBsZW5ndWFqZSBjbGFybyBwYXJhIGVzdHVkaWFudGVzIGRlIHNlY3VuZGFyaWFcXG5gXG4gICAgcHJvbXB0ICs9IGAtIFNpIGVzIHVuYSBwcmVndW50YSBhY2Fkw6ltaWNhLCBwcm9wb3JjaW9uYSBleHBsaWNhY2lvbmVzIHBhc28gYSBwYXNvXFxuYFxuICAgIHByb21wdCArPSBgLSBNYW50w6luIHVuIHRvbm8gbW90aXZhZG9yIHkgcG9zaXRpdm9cXG5cXG5gXG4gICAgcHJvbXB0ICs9IGBSZXNwdWVzdGEgZGUgU2FyYTpgXG4gICAgXG4gICAgcmV0dXJuIHByb21wdFxuICB9XG5cbiAgLyoqXG4gICAqIEdlbmVyYXRlcyBjb250ZXh0dWFsIGZhbGxiYWNrIHJlc3BvbnNlIHdoZW4gQUkgc2VydmljZXMgZmFpbFxuICAgKi9cbiAgcHJpdmF0ZSBzdGF0aWMgZ2VuZXJhdGVDb250ZXh0dWFsRmFsbGJhY2soXG4gICAgY29udGV4dDogQ29udmVyc2F0aW9uQ29udGV4dCxcbiAgICBtZXNzYWdlOiBzdHJpbmcsXG4gICAgdXNlck5hbWU/OiBzdHJpbmdcbiAgKTogc3RyaW5nIHtcbiAgICBjb25zdCBtc2dMb3dlciA9IG1lc3NhZ2UudG9Mb3dlckNhc2UoKVxuICAgIFxuICAgIC8vIENhbGVuZGFyLXJlbGF0ZWQgZmFsbGJhY2tcbiAgICBpZiAoL2FnZW5kZXM/fGFnZW5kW2HDoV18Y3JlW2FlXXxwcm9ncmFtYXxhbm90W2FlXXxhZ3JlZ2EuKig/OmV4YW1lbnxldmVudG98c2VzacOzbikvaS50ZXN0KG1lc3NhZ2UpKSB7XG4gICAgICByZXR1cm4gYMKhSG9sYSR7dXNlck5hbWUgPyAnICcgKyB1c2VyTmFtZSA6ICcnfSEgVmVvIHF1ZSBxdWllcmVzIGFnZW5kYXIgYWxnbyBlbiB0dSBjYWxlbmRhcmlvLlxcblxcbmAgK1xuICAgICAgICBgUG9yIGZhdm9yIHByb3BvcmNpb25hIGVzdG9zIGRldGFsbGVzOlxcbmAgK1xuICAgICAgICBg8J+ThSAqKkZlY2hhKio6IMK/UGFyYSBjdcOhbmRvIGVzP1xcbmAgK1xuICAgICAgICBg8J+VkCAqKkhvcmEqKjogwr9BIHF1w6kgaG9yYT9cXG5gICtcbiAgICAgICAgYPCfk5ogKipUZW1hKio6IMK/RGUgcXXDqSBzZSB0cmF0YT9cXG5cXG5gICtcbiAgICAgICAgYFVuYSB2ZXogcXVlIG1lIGRlcyBlc3RvcyBkYXRvcywgcG9kcsOpIGFncmVnYXJsbyBhIHR1IGNhbGVuZGFyaW8gYXV0b23DoXRpY2FtZW50ZS5gXG4gICAgfVxuICAgIFxuICAgIC8vIEFjYWRlbWljIHF1ZXN0aW9uIGZhbGxiYWNrXG4gICAgaWYgKC/Cv3xxdcOpLiplc3xjw7Ntb3xleHBsaWNhfG5vLiplbnRpZW5kby9pLnRlc3QobWVzc2FnZSkpIHtcbiAgICAgIGxldCByZXNwb25zZSA9IGBFbnRpZW5kbyB0dSBwcmVndW50YSR7dXNlck5hbWUgPyAnLCAnICsgdXNlck5hbWUgOiAnJ30uXFxuXFxuYFxuICAgICAgXG4gICAgICBpZiAoY29udGV4dC5jdXJyZW50U3ViamVjdCkge1xuICAgICAgICByZXNwb25zZSArPSBgUGFyYSBheXVkYXJ0ZSBtZWpvciBjb24gJHtjb250ZXh0LmN1cnJlbnRTdWJqZWN0fSwgYFxuICAgICAgfVxuICAgICAgXG4gICAgICByZXNwb25zZSArPSBgwr9wb2Ryw61hcyBzZXIgbcOhcyBlc3BlY8OtZmljbyBzb2JyZSBxdcOpIHBhcnRlIG5lY2VzaXRhcyBxdWUgdGUgZXhwbGlxdWU/XFxuXFxuYFxuICAgICAgcmVzcG9uc2UgKz0gYE1pZW50cmFzIHRhbnRvLCBwdWVkbzpcXG5gXG4gICAgICByZXNwb25zZSArPSBg4oCiIEV4cGxpY2FydGUgY29uY2VwdG9zIHBhc28gYSBwYXNvXFxuYFxuICAgICAgcmVzcG9uc2UgKz0gYOKAoiBBeXVkYXJ0ZSBhIHJlc29sdmVyIGVqZXJjaWNpb3NcXG5gXG4gICAgICByZXNwb25zZSArPSBg4oCiIENyZWFyIHJlY29yZGF0b3Jpb3MgZGUgZXN0dWRpb1xcbmBcbiAgICAgIHJlc3BvbnNlICs9IGDigKIgQWdlbmRhciBzZXNpb25lcyBkZSByZXBhc29gXG4gICAgICBcbiAgICAgIHJldHVybiByZXNwb25zZVxuICAgIH1cbiAgICBcbiAgICAvLyBHZW5lcmFsIGZhbGxiYWNrIHdpdGggY29udGV4dFxuICAgIGxldCByZXNwb25zZSA9IGDCoUhvbGEke3VzZXJOYW1lID8gJyAnICsgdXNlck5hbWUgOiAnJ30hIPCfkYtcXG5cXG5gXG4gICAgXG4gICAgaWYgKGNvbnRleHQuY3VycmVudFN1YmplY3QpIHtcbiAgICAgIHJlc3BvbnNlICs9IGBWZW8gcXVlIGhlbW9zIGVzdGFkbyB0cmFiYWphbmRvIGNvbiAke2NvbnRleHQuY3VycmVudFN1YmplY3R9LiBgXG4gICAgfVxuICAgIFxuICAgIHJlc3BvbnNlICs9IGDCv0VuIHF1w6kgbcOhcyBwdWVkbyBheXVkYXJ0ZSBob3k/XFxuXFxuYFxuICAgIHJlc3BvbnNlICs9IGBQdWVkbyBheXVkYXJ0ZSBjb246XFxuYFxuICAgIHJlc3BvbnNlICs9IGDwn5OaICoqRXhwbGljYXIgY29uY2VwdG9zKiogZGUgdHVzIG1hdGVyaWFzXFxuYFxuICAgIHJlc3BvbnNlICs9IGDwn5OdICoqUmVzb2x2ZXIgZWplcmNpY2lvcyoqIHBhc28gYSBwYXNvXFxuYFxuICAgIHJlc3BvbnNlICs9IGDwn5OFICoqQWdlbmRhciBldmVudG9zKiogZW4gdHUgY2FsZW5kYXJpb1xcbmBcbiAgICByZXNwb25zZSArPSBg8J+OryAqKkhhY2VyIGV2YWx1YWNpb25lcyoqIGFkYXB0YXRpdmFzXFxuYFxuICAgIHJlc3BvbnNlICs9IGDwn5SNICoqQnVzY2FyIGluZm9ybWFjacOzbioqIGFjYWTDqW1pY2FgXG4gICAgXG4gICAgcmV0dXJuIHJlc3BvbnNlXG4gIH1cblxuICAvKipcbiAgICogQW5hbHl6ZXMgbWVzc2FnZSBtZXRhZGF0YSBmb3IgY29udGV4dFxuICAgKi9cbiAgcHJpdmF0ZSBzdGF0aWMgYW5hbHl6ZU1lc3NhZ2VNZXRhZGF0YShtZXNzYWdlOiBzdHJpbmcpOiBDb252ZXJzYXRpb25UdXJuWydtZXRhZGF0YSddIHtcbiAgICBjb25zdCBtc2dMb3dlciA9IG1lc3NhZ2UudG9Mb3dlckNhc2UoKVxuICAgIFxuICAgIC8vIFN1YmplY3QgZGV0ZWN0aW9uXG4gICAgbGV0IHN1YmplY3Q6IHN0cmluZyB8IHVuZGVmaW5lZFxuICAgIGlmICgvbWF0ZW3DoXRpY2FzP3zDoWxnZWJyYXxnZW9tZXRyw61hfGPDoWxjdWxvLy50ZXN0KG1zZ0xvd2VyKSkge1xuICAgICAgc3ViamVjdCA9ICdtYXRlbcOhdGljYXMnXG4gICAgfSBlbHNlIGlmICgvZsOtc2ljYXxtZWPDoW5pY2F8Y2luZW3DoXRpY2F8ZW5lcmfDrWEvLnRlc3QobXNnTG93ZXIpKSB7XG4gICAgICBzdWJqZWN0ID0gJ2bDrXNpY2EnXG4gICAgfSBlbHNlIGlmICgvcXXDrW1pY2F8cmVhY2Npw7NufMOhdG9tb3xtb2zDqWN1bGEvLnRlc3QobXNnTG93ZXIpKSB7XG4gICAgICBzdWJqZWN0ID0gJ3F1w61taWNhJ1xuICAgIH1cbiAgICBcbiAgICAvLyBUb3BpYyBkZXRlY3Rpb25cbiAgICBsZXQgdG9waWM6IHN0cmluZyB8IHVuZGVmaW5lZFxuICAgIGNvbnN0IHRvcGljTWF0Y2hlcyA9IG1zZ0xvd2VyLm1hdGNoKC8oZWN1YWNpw7NufGZ1bmNpw7NufGRlcml2YWRhfGludGVncmFsfGbDs3JtdWxhfHByb2JsZW1hKS9naSlcbiAgICBpZiAodG9waWNNYXRjaGVzKSB7XG4gICAgICB0b3BpYyA9IHRvcGljTWF0Y2hlc1swXVxuICAgIH1cbiAgICBcbiAgICAvLyBJbnRlbnRpb24gZGV0ZWN0aW9uXG4gICAgbGV0IGludGVudGlvbjogc3RyaW5nIHwgdW5kZWZpbmVkXG4gICAgaWYgKC9leHBsaWNhfHF1w6kgZXN8Y8OzbW8gZnVuY2lvbmEvLnRlc3QobXNnTG93ZXIpKSB7XG4gICAgICBpbnRlbnRpb24gPSAnZXhwbGFuYXRpb24nXG4gICAgfSBlbHNlIGlmICgvcmVzdWVsdmV8Y2FsY3VsYXxlbmN1ZW50cmEvLnRlc3QobXNnTG93ZXIpKSB7XG4gICAgICBpbnRlbnRpb24gPSAncHJvYmxlbV9zb2x2aW5nJ1xuICAgIH0gZWxzZSBpZiAoL2F5dWRhfG5vIGVudGllbmRvfGVzdG95IGNvbmZ1bmRpZG8vLnRlc3QobXNnTG93ZXIpKSB7XG4gICAgICBpbnRlbnRpb24gPSAnaGVscF9yZXF1ZXN0J1xuICAgIH0gZWxzZSBpZiAoL2NvbnRpbsO6YXxzaWd1ZXx5IGRlc3B1w6lzLy50ZXN0KG1zZ0xvd2VyKSkge1xuICAgICAgaW50ZW50aW9uID0gJ2NvbnRpbnVhdGlvbidcbiAgICB9XG4gICAgXG4gICAgLy8gQ29uZmlkZW5jZSBiYXNlZCBvbiBjbGFyaXR5IGFuZCBzcGVjaWZpY2l0eVxuICAgIGxldCBjb25maWRlbmNlID0gMC41XG4gICAgaWYgKHN1YmplY3QpIGNvbmZpZGVuY2UgKz0gMC4yXG4gICAgaWYgKHRvcGljKSBjb25maWRlbmNlICs9IDAuMlxuICAgIGlmIChpbnRlbnRpb24pIGNvbmZpZGVuY2UgKz0gMC4xXG4gICAgXG4gICAgcmV0dXJuIHsgc3ViamVjdCwgdG9waWMsIGludGVudGlvbiwgY29uZmlkZW5jZTogTWF0aC5taW4oY29uZmlkZW5jZSwgMS4wKSB9XG4gIH1cblxuICAvKipcbiAgICogVXBkYXRlcyBjb250ZXh0dWFsIGluZm9ybWF0aW9uIGJhc2VkIG9uIG5ldyBtZXNzYWdlXG4gICAqL1xuICBwcml2YXRlIHN0YXRpYyBhc3luYyB1cGRhdGVDb250ZXh0dWFsSW5mb3JtYXRpb24oY29udGV4dDogQ29udmVyc2F0aW9uQ29udGV4dCwgbWVzc2FnZTogc3RyaW5nKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgY29uc3QgcmVjZW50VHVybnMgPSBjb250ZXh0LmNvbnZlcnNhdGlvbkZsb3cuc2xpY2UoLTUpXG4gICAgY29uc3QgbWV0YWRhdGEgPSByZWNlbnRUdXJuc1tyZWNlbnRUdXJucy5sZW5ndGggLSAxXT8ubWV0YWRhdGFcbiAgICBcbiAgICAvLyBVcGRhdGUgY3VycmVudCB0b3BpYy9zdWJqZWN0IGlmIGRldGVjdGVkXG4gICAgaWYgKG1ldGFkYXRhPy5zdWJqZWN0KSB7XG4gICAgICBjb250ZXh0LmN1cnJlbnRTdWJqZWN0ID0gbWV0YWRhdGEuc3ViamVjdFxuICAgIH1cbiAgICBpZiAobWV0YWRhdGE/LnRvcGljKSB7XG4gICAgICBjb250ZXh0LmN1cnJlbnRUb3BpYyA9IG1ldGFkYXRhLnRvcGljXG4gICAgfVxuICAgIFxuICAgIC8vIERldGVjdCBjb252ZXJzYXRpb24gY29udGludWl0eSBwYXR0ZXJuc1xuICAgIGlmIChtZXRhZGF0YT8uaW50ZW50aW9uID09PSAnY29udGludWF0aW9uJykge1xuICAgICAgY29uc3QgbGFzdEFzc2lzdGFudFR1cm4gPSByZWNlbnRUdXJuc1xuICAgICAgICAuc2xpY2UoKVxuICAgICAgICAucmV2ZXJzZSgpXG4gICAgICAgIC5maW5kKHR1cm4gPT4gdHVybi5yb2xlID09PSAnYXNzaXN0YW50JylcbiAgICAgIFxuICAgICAgaWYgKGxhc3RBc3Npc3RhbnRUdXJuPy5tZXRhZGF0YT8uc3ViamVjdCkge1xuICAgICAgICBjb250ZXh0LmN1cnJlbnRTdWJqZWN0ID0gbGFzdEFzc2lzdGFudFR1cm4ubWV0YWRhdGEuc3ViamVjdFxuICAgICAgfVxuICAgIH1cbiAgICBcbiAgICAvLyBVcGRhdGUgYWN0aXZlIGludGVudGlvbnNcbiAgICBpZiAobWV0YWRhdGE/LmludGVudGlvbiAmJiAhY29udGV4dC5hY3RpdmVJbnRlbnRpb25zLmluY2x1ZGVzKG1ldGFkYXRhLmludGVudGlvbikpIHtcbiAgICAgIGNvbnRleHQuYWN0aXZlSW50ZW50aW9ucy5wdXNoKG1ldGFkYXRhLmludGVudGlvbilcbiAgICAgIFxuICAgICAgLy8gS2VlcCBvbmx5IHJlY2VudCBpbnRlbnRpb25zXG4gICAgICBpZiAoY29udGV4dC5hY3RpdmVJbnRlbnRpb25zLmxlbmd0aCA+IDMpIHtcbiAgICAgICAgY29udGV4dC5hY3RpdmVJbnRlbnRpb25zLnNoaWZ0KClcbiAgICAgIH1cbiAgICB9XG4gICAgXG4gICAgLy8gQ3JlYXRlIGNvbnRleHQgcmVmZXJlbmNlcyBmb3IgaW1wb3J0YW50IGluZm9ybWF0aW9uXG4gICAgaWYgKG1ldGFkYXRhPy5jb25maWRlbmNlICYmIG1ldGFkYXRhLmNvbmZpZGVuY2UgPiAwLjcpIHtcbiAgICAgIGNvbnN0IHJlZmVyZW5jZTogQ29udGV4dFJlZmVyZW5jZSA9IHtcbiAgICAgICAgaWQ6IGByZWZfJHtEYXRlLm5vdygpfWAsXG4gICAgICAgIHR5cGU6IHRoaXMuZGV0ZXJtaW5lUmVmZXJlbmNlVHlwZShtZXRhZGF0YSksXG4gICAgICAgIGNvbnRlbnQ6IG1lc3NhZ2UsXG4gICAgICAgIHJlbGV2YW5jZVNjb3JlOiBtZXRhZGF0YS5jb25maWRlbmNlLFxuICAgICAgICB0dXJuSW5kZXg6IGNvbnRleHQuY29udmVyc2F0aW9uRmxvdy5sZW5ndGggLSAxLFxuICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKClcbiAgICAgIH1cbiAgICAgIFxuICAgICAgY29udGV4dC5yZWZlcmVuY2VNZW1vcnkucHVzaChyZWZlcmVuY2UpXG4gICAgICBcbiAgICAgIC8vIEtlZXAgb25seSBtb3N0IHJlbGV2YW50IHJlZmVyZW5jZXNcbiAgICAgIGlmIChjb250ZXh0LnJlZmVyZW5jZU1lbW9yeS5sZW5ndGggPiB0aGlzLk1BWF9SRUZFUkVOQ0VTKSB7XG4gICAgICAgIGNvbnRleHQucmVmZXJlbmNlTWVtb3J5LnNvcnQoKGEsIGIpID0+IGIucmVsZXZhbmNlU2NvcmUgLSBhLnJlbGV2YW5jZVNjb3JlKVxuICAgICAgICBjb250ZXh0LnJlZmVyZW5jZU1lbW9yeSA9IGNvbnRleHQucmVmZXJlbmNlTWVtb3J5LnNsaWNlKDAsIHRoaXMuTUFYX1JFRkVSRU5DRVMpXG4gICAgICB9XG4gICAgfVxuICAgIFxuICAgIC8vIFVwZGF0ZSBjb250ZXh0IHN1bW1hcnlcbiAgICBhd2FpdCB0aGlzLnVwZGF0ZUNvbnRleHRTdW1tYXJ5KGNvbnRleHQpXG4gIH1cblxuICAvKipcbiAgICogRGV0ZXJtaW5lcyByZWZlcmVuY2UgdHlwZSBiYXNlZCBvbiBtZXRhZGF0YVxuICAgKi9cbiAgcHJpdmF0ZSBzdGF0aWMgZGV0ZXJtaW5lUmVmZXJlbmNlVHlwZShtZXRhZGF0YTogQ29udmVyc2F0aW9uVHVyblsnbWV0YWRhdGEnXSk6IENvbnRleHRSZWZlcmVuY2VbJ3R5cGUnXSB7XG4gICAgaWYgKG1ldGFkYXRhLmludGVudGlvbiA9PT0gJ2NvbnRpbnVhdGlvbicpIHJldHVybiAndG9waWNfY29udGludWF0aW9uJ1xuICAgIGlmIChtZXRhZGF0YS5pbnRlbnRpb24gPT09ICdwcm9ibGVtX3NvbHZpbmcnKSByZXR1cm4gJ3Byb2JsZW1fc29sdmluZydcbiAgICBpZiAobWV0YWRhdGEuaW50ZW50aW9uID09PSAnZXhwbGFuYXRpb24nKSByZXR1cm4gJ2V4cGxhbmF0aW9uX2ZvbGxvd3VwJ1xuICAgIHJldHVybiAnc3ViamVjdF9yZWZlcmVuY2UnXG4gIH1cblxuICAvKipcbiAgICogVXBkYXRlcyBjb250ZXh0IHN1bW1hcnkgd2l0aCBrZXkgY29udmVyc2F0aW9uIHBvaW50c1xuICAgKi9cbiAgcHJpdmF0ZSBzdGF0aWMgYXN5bmMgdXBkYXRlQ29udGV4dFN1bW1hcnkoY29udGV4dDogQ29udmVyc2F0aW9uQ29udGV4dCk6IFByb21pc2U8dm9pZD4ge1xuICAgIGNvbnN0IHJlY2VudFR1cm5zID0gY29udGV4dC5jb252ZXJzYXRpb25GbG93LnNsaWNlKC02KVxuICAgIGNvbnN0IGtleVRvcGljcyA9IFsuLi5uZXcgU2V0KHJlY2VudFR1cm5zXG4gICAgICAubWFwKHR1cm4gPT4gdHVybi5tZXRhZGF0YS50b3BpYylcbiAgICAgIC5maWx0ZXIoQm9vbGVhbikpXVxuICAgIFxuICAgIGNvbnN0IGtleVN1YmplY3RzID0gWy4uLm5ldyBTZXQocmVjZW50VHVybnNcbiAgICAgIC5tYXAodHVybiA9PiB0dXJuLm1ldGFkYXRhLnN1YmplY3QpXG4gICAgICAuZmlsdGVyKEJvb2xlYW4pKV1cbiAgICBcbiAgICBjb25zdCBzdW1tYXJ5UGFydHM6IHN0cmluZ1tdID0gW11cbiAgICBcbiAgICBpZiAoa2V5U3ViamVjdHMubGVuZ3RoID4gMCkge1xuICAgICAgc3VtbWFyeVBhcnRzLnB1c2goYE1hdGVyaWFzOiAke2tleVN1YmplY3RzLmpvaW4oJywgJyl9YClcbiAgICB9XG4gICAgXG4gICAgaWYgKGtleVRvcGljcy5sZW5ndGggPiAwKSB7XG4gICAgICBzdW1tYXJ5UGFydHMucHVzaChgVGVtYXM6ICR7a2V5VG9waWNzLmpvaW4oJywgJyl9YClcbiAgICB9XG4gICAgXG4gICAgaWYgKGNvbnRleHQuYWN0aXZlSW50ZW50aW9ucy5sZW5ndGggPiAwKSB7XG4gICAgICBzdW1tYXJ5UGFydHMucHVzaChgSW50ZW5jaW9uZXM6ICR7Y29udGV4dC5hY3RpdmVJbnRlbnRpb25zLmpvaW4oJywgJyl9YClcbiAgICB9XG4gICAgXG4gICAgY29udGV4dC5jb250ZXh0U3VtbWFyeSA9IHN1bW1hcnlQYXJ0cy5qb2luKCcgfCAnKSB8fCAnQ29udmVyc2FjacOzbiBnZW5lcmFsJ1xuICB9XG5cbiAgLyoqXG4gICAqIEdlbmVyYXRlcyBjb250ZXh0dWFsbHkgYXdhcmUgcmVzcG9uc2UgdXNpbmcgcGVyc2lzdGVudCBzdG9yYWdlXG4gICAqL1xuICBwcml2YXRlIHN0YXRpYyBhc3luYyBnZW5lcmF0ZUNvbnRleHR1YWxSZXNwb25zZShcbiAgICBjb250ZXh0OiBDb252ZXJzYXRpb25Db250ZXh0LCBcbiAgICB1c2VyTmFtZT86IHN0cmluZyxcbiAgICBwZW5kaW5nVGFza3M6IGFueVtdID0gW11cbiAgKTogUHJvbWlzZTxDb250ZXh0dWFsUmVzcG9uc2U+IHtcbiAgICBcbiAgICAvLyBHZXQgbGVhcm5pbmcgcHJvZmlsZSBmb3IgcGVyc29uYWxpemF0aW9uXG4gICAgY29uc3QgbGVhcm5pbmdQcm9maWxlID0gQWR2YW5jZWRMZWFybmluZ1Byb2ZpbGVNYW5hZ2VyLmdldExlYXJuaW5nUHJvZmlsZShjb250ZXh0LnVzZXJJZClcbiAgICBcbiAgICAvLyBVcGRhdGUgbGVhcm5pbmcgcHJvZmlsZSBiYXNlZCBvbiBjdXJyZW50IG1lc3NhZ2VcbiAgICBjb25zdCBsYXRlc3RNZXNzYWdlID0gY29udGV4dC5jb252ZXJzYXRpb25GbG93W2NvbnRleHQuY29udmVyc2F0aW9uRmxvdy5sZW5ndGggLSAxXT8uY29udGVudCB8fCAnJ1xuICAgIEFkdmFuY2VkTGVhcm5pbmdQcm9maWxlTWFuYWdlci5wcm9jZXNzVXNlck1lc3NhZ2UoY29udGV4dC51c2VySWQsIGxhdGVzdE1lc3NhZ2UpXG4gICAgXG4gICAgLy8gQW5hbHl6ZSBjb252ZXJzYXRpb24gZm9yIGNvbnRpbnVpdHlcbiAgICBjb25zdCBjb250aW51aXR5QW5hbHlzaXMgPSB0aGlzLmFuYWx5emVDb250aW51aXR5KGNvbnRleHQpXG4gICAgXG4gICAgLy8g8J+OryBGSVJTVCBQUklPUklUWTogQ2hlY2sgZm9yIGNhbGVuZGFyIHRhc2sgZXhlY3V0aW9uXG4gICAgY29uc3QgY2FsZW5kYXJSZXN1bHQgPSBhd2FpdCB0aGlzLmhhbmRsZUNhbGVuZGFyVGFza3MoXG4gICAgICBjb250ZXh0LnVzZXJJZCxcbiAgICAgIGxhdGVzdE1lc3NhZ2UsXG4gICAgICB0aGlzLmZvcm1hdENvbnZlcnNhdGlvbkhpc3RvcnkoY29udGV4dCksXG4gICAgICBwZW5kaW5nVGFza3NcbiAgICApXG4gICAgXG4gICAgaWYgKGNhbGVuZGFyUmVzdWx0KSB7XG4gICAgICBjb25zb2xlLmxvZyhg8J+ThSBDYWxlbmRhciB0YXNrIGV4ZWN1dGVkOiAke2NhbGVuZGFyUmVzdWx0LnR5cGV9YClcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGNvbnRlbnQ6IGNhbGVuZGFyUmVzdWx0LmNvbnRlbnQsXG4gICAgICAgIGNvbnRleHQsXG4gICAgICAgIGNvbnRpbnVpdHlTY29yZTogMC45LFxuICAgICAgICBwZXJzb25hbGl6YXRpb25zOiBbJ2NhbGVuZGFyX3Rhc2tfZXhlY3V0ZWQnXSxcbiAgICAgICAgc3VnZ2VzdGVkRm9sbG93dXBzOiBjYWxlbmRhclJlc3VsdC5tZXRhZGF0YT8uc3VnZ2VzdGVkQWN0aW9ucyB8fCBbXVxuICAgICAgfVxuICAgIH1cblxuICAgIC8vIEdlbmVyYXRlIGJhc2UgcmVzcG9uc2UgdXNpbmcgQUkgcHJvdmlkZXJzIGRpcmVjdGx5XG4gICAgY29uc3QgeyBhaVNlcnZpY2UgfSA9IHJlcXVpcmUoJy4vYWktcHJvdmlkZXJzJylcbiAgICBsZXQgYmFzZUNvbnRlbnQgPSAnJ1xuICAgIFxuICAgIHRyeSB7XG4gICAgICAvLyBDcmVhdGUgZWR1Y2F0aW9uYWwgcHJvbXB0IGJhc2VkIG9uIGNvbnRleHRcbiAgICAgIGNvbnN0IGVkdWNhdGlvbmFsUHJvbXB0ID0gdGhpcy5idWlsZEVkdWNhdGlvbmFsUHJvbXB0KGNvbnRleHQsIGxhdGVzdE1lc3NhZ2UsIHVzZXJOYW1lKVxuICAgICAgYmFzZUNvbnRlbnQgPSBhd2FpdCBhaVNlcnZpY2UuZ2VuZXJhdGVFeGVyY2lzZShlZHVjYXRpb25hbFByb21wdClcbiAgICAgIFxuICAgICAgLy8gSWYgQUkgc2VydmljZSByZXR1cm5zIGZhbGxiYWNrIHRlbXBsYXRlLCB1c2UgY29udGV4dHVhbCBmYWxsYmFja1xuICAgICAgaWYgKGJhc2VDb250ZW50ID09PSAnVEVNUExBVEVfRkFMTEJBQ0snKSB7XG4gICAgICAgIGJhc2VDb250ZW50ID0gdGhpcy5nZW5lcmF0ZUNvbnRleHR1YWxGYWxsYmFjayhjb250ZXh0LCBsYXRlc3RNZXNzYWdlLCB1c2VyTmFtZSlcbiAgICAgIH1cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignQUkgc2VydmljZSBlcnJvciwgdXNpbmcgY29udGV4dHVhbCBmYWxsYmFjazonLCBlcnJvcilcbiAgICAgIGJhc2VDb250ZW50ID0gdGhpcy5nZW5lcmF0ZUNvbnRleHR1YWxGYWxsYmFjayhjb250ZXh0LCBsYXRlc3RNZXNzYWdlLCB1c2VyTmFtZSlcbiAgICB9XG4gICAgXG4gICAgLy8gRW5oYW5jZSByZXNwb25zZSB3aXRoIGNvbnRleHR1YWwgaW5mb3JtYXRpb25cbiAgICBsZXQgZW5oYW5jZWRDb250ZW50ID0gYmFzZUNvbnRlbnRcbiAgICBcbiAgICAvLyBBZGQgY29udGludWl0eSByZWZlcmVuY2VzIGlmIHJlbGV2YW50XG4gICAgaWYgKGNvbnRpbnVpdHlBbmFseXNpcy5zaG91bGRSZWZlcmVuY2UpIHtcbiAgICAgIGVuaGFuY2VkQ29udGVudCA9IHRoaXMuYWRkQ29udGludWl0eVJlZmVyZW5jZXMoZW5oYW5jZWRDb250ZW50LCBjb250ZXh0KVxuICAgIH1cbiAgICBcbiAgICAvLyBBcHBseSBsZWFybmluZyBzdHlsZSBhZGFwdGF0aW9uc1xuICAgIGVuaGFuY2VkQ29udGVudCA9IEFkdmFuY2VkTGVhcm5pbmdQcm9maWxlTWFuYWdlci5hZGFwdFJlc3BvbnNlVG9MZWFybmluZ1N0eWxlKFxuICAgICAgZW5oYW5jZWRDb250ZW50LCBcbiAgICAgIGxlYXJuaW5nUHJvZmlsZVxuICAgIClcbiAgICBcbiAgICAvLyBEZXRlcm1pbmUgcGVyc29uYWxpemF0aW9ucyBhcHBsaWVkXG4gICAgY29uc3QgcGVyc29uYWxpemF0aW9uczogc3RyaW5nW10gPSBbXVxuICAgIGlmIChjb250aW51aXR5QW5hbHlzaXMuc2hvdWxkUmVmZXJlbmNlKSBwZXJzb25hbGl6YXRpb25zLnB1c2goJ2NvbnRleHRfcmVmZXJlbmNlJylcbiAgICBpZiAobGVhcm5pbmdQcm9maWxlLnByaW1hcnlTdHlsZSAhPT0gJ211bHRpbW9kYWwnKSBwZXJzb25hbGl6YXRpb25zLnB1c2goJ2xlYXJuaW5nX3N0eWxlX2FkYXB0YXRpb24nKVxuICAgIGlmIChwZW5kaW5nVGFza3MubGVuZ3RoID4gMCkgcGVyc29uYWxpemF0aW9ucy5wdXNoKCd0YXNrX2F3YXJlJylcbiAgICBcbiAgICAvLyBHZW5lcmF0ZSB2aXN1YWwgcmVjb21tZW5kYXRpb25zXG4gICAgbGV0IHZpc3VhbFJlY29tbWVuZGF0aW9uOiBDb250ZXh0dWFsUmVzcG9uc2VbJ3Zpc3VhbFJlY29tbWVuZGF0aW9uJ11cbiAgICBpZiAobGVhcm5pbmdQcm9maWxlLmFkYXB0YXRpb25QcmVmZXJlbmNlcy5wcmVmZXJzVmlzdWFsQWlkcyAmJiBcbiAgICAgICAgKGNvbnRleHQuY3VycmVudFN1YmplY3QgfHwgY29udGV4dC5jdXJyZW50VG9waWMpKSB7XG4gICAgICBcbiAgICAgIHZpc3VhbFJlY29tbWVuZGF0aW9uID0ge1xuICAgICAgICB0eXBlOiBWaXN1YWxMZWFybmluZ0VuZ2luZS5kZXRlY3RPcHRpbWFsVmlzdWFsVHlwZShlbmhhbmNlZENvbnRlbnQsIGNvbnRleHQuY3VycmVudFN1YmplY3QpLFxuICAgICAgICByZWFzb246IGBSZWNvbWVuZGFkbyBwYXJhIHR1IHBlcmZpbCBkZSBhcHJlbmRpemFqZSAke2xlYXJuaW5nUHJvZmlsZS5wcmltYXJ5U3R5bGV9YFxuICAgICAgfVxuICAgIH1cbiAgICBcbiAgICAvLyBHZW5lcmF0ZSBmb2xsb3ctdXAgc3VnZ2VzdGlvbnNcbiAgICBjb25zdCBmb2xsb3d1cHMgPSB0aGlzLmdlbmVyYXRlQ29udGV4dHVhbEZvbGxvd3Vwcyhjb250ZXh0LCBsZWFybmluZ1Byb2ZpbGUpXG4gICAgXG4gICAgcmV0dXJuIHtcbiAgICAgIGNvbnRlbnQ6IGVuaGFuY2VkQ29udGVudCxcbiAgICAgIGNvbnRleHQsXG4gICAgICBjb250aW51aXR5U2NvcmU6IGNvbnRpbnVpdHlBbmFseXNpcy5zY29yZSxcbiAgICAgIHBlcnNvbmFsaXphdGlvbnMsXG4gICAgICBzdWdnZXN0ZWRGb2xsb3d1cHM6IGZvbGxvd3VwcyxcbiAgICAgIHZpc3VhbFJlY29tbWVuZGF0aW9uXG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEFuYWx5emVzIGNvbnZlcnNhdGlvbiBjb250aW51aXR5XG4gICAqL1xuICBwcml2YXRlIHN0YXRpYyBhbmFseXplQ29udGludWl0eShjb250ZXh0OiBDb252ZXJzYXRpb25Db250ZXh0KTogeyBcbiAgICBzY29yZTogbnVtYmVyLCBcbiAgICBzaG91bGRSZWZlcmVuY2U6IGJvb2xlYW4sIFxuICAgIHJlZmVyZW5jZVR5cGU/OiBzdHJpbmcgXG4gIH0ge1xuICAgIGNvbnN0IHJlY2VudFR1cm5zID0gY29udGV4dC5jb252ZXJzYXRpb25GbG93LnNsaWNlKC00KVxuICAgIGxldCBzY29yZSA9IDAuNSAvLyBCYXNlIHNjb3JlXG4gICAgbGV0IHNob3VsZFJlZmVyZW5jZSA9IGZhbHNlXG4gICAgbGV0IHJlZmVyZW5jZVR5cGU6IHN0cmluZyB8IHVuZGVmaW5lZFxuICAgIFxuICAgIC8vIENoZWNrIGZvciB0b3BpYyBjb250aW51aXR5XG4gICAgY29uc3QgdG9waWNzID0gcmVjZW50VHVybnMubWFwKHR1cm4gPT4gdHVybi5tZXRhZGF0YS50b3BpYykuZmlsdGVyKEJvb2xlYW4pXG4gICAgaWYgKHRvcGljcy5sZW5ndGggPiAxICYmIHRvcGljc1t0b3BpY3MubGVuZ3RoIC0gMV0gPT09IHRvcGljc1t0b3BpY3MubGVuZ3RoIC0gMl0pIHtcbiAgICAgIHNjb3JlICs9IDAuMlxuICAgICAgc2hvdWxkUmVmZXJlbmNlID0gdHJ1ZVxuICAgICAgcmVmZXJlbmNlVHlwZSA9ICd0b3BpY19jb250aW51aXR5J1xuICAgIH1cbiAgICBcbiAgICAvLyBDaGVjayBmb3Igc3ViamVjdCBjb250aW51aXR5XG4gICAgY29uc3Qgc3ViamVjdHMgPSByZWNlbnRUdXJucy5tYXAodHVybiA9PiB0dXJuLm1ldGFkYXRhLnN1YmplY3QpLmZpbHRlcihCb29sZWFuKVxuICAgIGlmIChzdWJqZWN0cy5sZW5ndGggPiAxICYmIHN1YmplY3RzW3N1YmplY3RzLmxlbmd0aCAtIDFdID09PSBzdWJqZWN0c1tzdWJqZWN0cy5sZW5ndGggLSAyXSkge1xuICAgICAgc2NvcmUgKz0gMC4xNVxuICAgICAgc2hvdWxkUmVmZXJlbmNlID0gdHJ1ZVxuICAgICAgcmVmZXJlbmNlVHlwZSA9ICdzdWJqZWN0X2NvbnRpbnVpdHknXG4gICAgfVxuICAgIFxuICAgIC8vIENoZWNrIGZvciBjb250aW51YXRpb24gaW5kaWNhdG9yc1xuICAgIGNvbnN0IGxhdGVzdE1lc3NhZ2UgPSByZWNlbnRUdXJuc1tyZWNlbnRUdXJucy5sZW5ndGggLSAxXT8uY29udGVudD8udG9Mb3dlckNhc2UoKSB8fCAnJ1xuICAgIGlmICgvY29udGluw7phfHNpZ3VlfHkgZGVzcHXDqXN8dGFtYmnDqW58YWRlbcOhcy8udGVzdChsYXRlc3RNZXNzYWdlKSkge1xuICAgICAgc2NvcmUgKz0gMC4yNVxuICAgICAgc2hvdWxkUmVmZXJlbmNlID0gdHJ1ZVxuICAgICAgcmVmZXJlbmNlVHlwZSA9ICdleHBsaWNpdF9jb250aW51YXRpb24nXG4gICAgfVxuICAgIFxuICAgIC8vIENoZWNrIGZvciBxdWVzdGlvbiBmb2xsb3ctdXAgcGF0dGVybnNcbiAgICBjb25zdCBoYXNRdWVzdGlvbkZvbGxvd3VwID0gcmVjZW50VHVybnMuc29tZSgodHVybiwgaW5kZXgpID0+IFxuICAgICAgaW5kZXggPiAwICYmIFxuICAgICAgdHVybi5yb2xlID09PSAndXNlcicgJiYgXG4gICAgICAvcG9yIHF1w6l8Y8OzbW98Y3XDoW5kb3xkw7NuZGV8ZXhwbGljYS8udGVzdCh0dXJuLmNvbnRlbnQudG9Mb3dlckNhc2UoKSkgJiZcbiAgICAgIHJlY2VudFR1cm5zW2luZGV4IC0gMV0/LnJvbGUgPT09ICdhc3Npc3RhbnQnXG4gICAgKVxuICAgIFxuICAgIGlmIChoYXNRdWVzdGlvbkZvbGxvd3VwKSB7XG4gICAgICBzY29yZSArPSAwLjFcbiAgICAgIHNob3VsZFJlZmVyZW5jZSA9IHRydWVcbiAgICAgIHJlZmVyZW5jZVR5cGUgPSAnZm9sbG93dXBfcXVlc3Rpb24nXG4gICAgfVxuICAgIFxuICAgIHJldHVybiB7IFxuICAgICAgc2NvcmU6IE1hdGgubWluKHNjb3JlLCAxLjApLCBcbiAgICAgIHNob3VsZFJlZmVyZW5jZSwgXG4gICAgICByZWZlcmVuY2VUeXBlIFxuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBBZGRzIGNvbnRpbnVpdHkgcmVmZXJlbmNlcyB0byByZXNwb25zZVxuICAgKi9cbiAgcHJpdmF0ZSBzdGF0aWMgYWRkQ29udGludWl0eVJlZmVyZW5jZXMoY29udGVudDogc3RyaW5nLCBjb250ZXh0OiBDb252ZXJzYXRpb25Db250ZXh0KTogc3RyaW5nIHtcbiAgICBjb25zdCByZWNlbnRBc3Npc3RhbnRUdXJucyA9IGNvbnRleHQuY29udmVyc2F0aW9uRmxvd1xuICAgICAgLmZpbHRlcih0dXJuID0+IHR1cm4ucm9sZSA9PT0gJ2Fzc2lzdGFudCcpXG4gICAgICAuc2xpY2UoLTIpXG4gICAgXG4gICAgaWYgKHJlY2VudEFzc2lzdGFudFR1cm5zLmxlbmd0aCA9PT0gMCkgcmV0dXJuIGNvbnRlbnRcbiAgICBcbiAgICBjb25zdCBsYXN0VG9waWMgPSBjb250ZXh0LmN1cnJlbnRUb3BpY1xuICAgIGNvbnN0IGxhc3RTdWJqZWN0ID0gY29udGV4dC5jdXJyZW50U3ViamVjdFxuICAgIFxuICAgIGxldCByZWZlcmVuY2VQcmVmaXggPSAnJ1xuICAgIFxuICAgIGlmIChsYXN0VG9waWMgJiYgbGFzdFN1YmplY3QpIHtcbiAgICAgIHJlZmVyZW5jZVByZWZpeCA9IGBDb250aW51YW5kbyBjb24gJHtsYXN0VG9waWN9IGVuICR7bGFzdFN1YmplY3R9OiBgXG4gICAgfSBlbHNlIGlmIChsYXN0VG9waWMpIHtcbiAgICAgIHJlZmVyZW5jZVByZWZpeCA9IGBTaWd1aWVuZG8gY29uIGVsIHRlbWEgZGUgJHtsYXN0VG9waWN9OiBgXG4gICAgfSBlbHNlIGlmIChsYXN0U3ViamVjdCkge1xuICAgICAgcmVmZXJlbmNlUHJlZml4ID0gYENvbnRpbnVhbmRvIGNvbiAke2xhc3RTdWJqZWN0fTogYFxuICAgIH0gZWxzZSB7XG4gICAgICByZWZlcmVuY2VQcmVmaXggPSBgQ29tbyBtZW5jaW9uw6kgYW50ZXJpb3JtZW50ZTogYFxuICAgIH1cbiAgICBcbiAgICByZXR1cm4gcmVmZXJlbmNlUHJlZml4ICsgY29udGVudFxuICB9XG5cbiAgLyoqXG4gICAqIEdlbmVyYXRlcyBjb250ZXh0dWFsIGZvbGxvdy11cCBzdWdnZXN0aW9uc1xuICAgKi9cbiAgcHJpdmF0ZSBzdGF0aWMgZ2VuZXJhdGVDb250ZXh0dWFsRm9sbG93dXBzKFxuICAgIGNvbnRleHQ6IENvbnZlcnNhdGlvbkNvbnRleHQsIFxuICAgIGxlYXJuaW5nUHJvZmlsZTogYW55XG4gICk6IHN0cmluZ1tdIHtcbiAgICBjb25zdCBmb2xsb3d1cHM6IHN0cmluZ1tdID0gW11cbiAgICBcbiAgICAvLyBCYXNlZCBvbiBjdXJyZW50IHRvcGljL3N1YmplY3RcbiAgICBpZiAoY29udGV4dC5jdXJyZW50VG9waWMpIHtcbiAgICAgIGZvbGxvd3Vwcy5wdXNoKGDCv1RpZW5lcyBtw6FzIHByZWd1bnRhcyBzb2JyZSAke2NvbnRleHQuY3VycmVudFRvcGljfT9gKVxuICAgIH1cbiAgICBcbiAgICBpZiAoY29udGV4dC5jdXJyZW50U3ViamVjdCkge1xuICAgICAgZm9sbG93dXBzLnB1c2goYMK/VGUgZ3VzdGFyw61hIHZlciBlamVyY2ljaW9zIGRlICR7Y29udGV4dC5jdXJyZW50U3ViamVjdH0/YClcbiAgICB9XG4gICAgXG4gICAgLy8gQmFzZWQgb24gbGVhcm5pbmcgc3R5bGVcbiAgICBpZiAobGVhcm5pbmdQcm9maWxlLmFkYXB0YXRpb25QcmVmZXJlbmNlcy5wcmVmZXJzVmlzdWFsQWlkcykge1xuICAgICAgZm9sbG93dXBzLnB1c2goJ8K/VGUgYXl1ZGFyw61hIHZlciB1biBkaWFncmFtYSBkZSBlc3RvPycpXG4gICAgfVxuICAgIFxuICAgIGlmIChsZWFybmluZ1Byb2ZpbGUuYWRhcHRhdGlvblByZWZlcmVuY2VzLnByZWZlcnNJbnRlcmFjdGlvbikge1xuICAgICAgZm9sbG93dXBzLnB1c2goJ8K/UXVpZXJlcyBwcmFjdGljYXIgY29uIHVuIGVqZXJjaWNpbz8nKVxuICAgIH1cbiAgICBcbiAgICAvLyBCYXNlZCBvbiBhY3RpdmUgaW50ZW50aW9uc1xuICAgIGlmIChjb250ZXh0LmFjdGl2ZUludGVudGlvbnMuaW5jbHVkZXMoJ2V4cGxhbmF0aW9uJykpIHtcbiAgICAgIGZvbGxvd3Vwcy5wdXNoKCfCv05lY2VzaXRhcyBxdWUgcHJvZnVuZGljZSBlbiBhbGfDum4gYXNwZWN0byBlc3BlY8OtZmljbz8nKVxuICAgIH1cbiAgICBcbiAgICBpZiAoY29udGV4dC5hY3RpdmVJbnRlbnRpb25zLmluY2x1ZGVzKCdwcm9ibGVtX3NvbHZpbmcnKSkge1xuICAgICAgZm9sbG93dXBzLnB1c2goJ8K/UXVpZXJlcyBxdWUgcmVzb2x2YW1vcyBvdHJvIHByb2JsZW1hIHNpbWlsYXI/JylcbiAgICB9XG4gICAgXG4gICAgLy8gR2VuZXJpYyBjb250ZXh0dWFsIGZvbGxvd3Vwc1xuICAgIGlmIChjb250ZXh0LmNvbnZlcnNhdGlvbkZsb3cubGVuZ3RoID4gMykge1xuICAgICAgZm9sbG93dXBzLnB1c2goJ8K/SGF5IGFsZ28gcXVlIG5vIHF1ZWTDsyBjbGFybz8nKVxuICAgIH1cbiAgICBcbiAgICByZXR1cm4gZm9sbG93dXBzLnNsaWNlKDAsIDMpIC8vIExpbWl0IHRvIDMgc3VnZ2VzdGlvbnNcbiAgfVxuXG4gIC8qKlxuICAgKiBGb3JtYXRzIGNvbnZlcnNhdGlvbiBoaXN0b3J5IGZvciBleHRlcm5hbCBlbmdpbmVzXG4gICAqL1xuICBwcml2YXRlIHN0YXRpYyBmb3JtYXRDb252ZXJzYXRpb25IaXN0b3J5KGNvbnRleHQ6IENvbnZlcnNhdGlvbkNvbnRleHQpOiBBcnJheTx7IHJvbGU6ICd1c2VyJyB8ICdhc3Npc3RhbnQnLCBjb250ZW50OiBzdHJpbmcgfT4ge1xuICAgIHJldHVybiBjb250ZXh0LmNvbnZlcnNhdGlvbkZsb3dcbiAgICAgIC5zbGljZSgtMTApIC8vIExhc3QgMTAgdHVybnNcbiAgICAgIC5tYXAodHVybiA9PiAoe1xuICAgICAgICByb2xlOiB0dXJuLnJvbGUsXG4gICAgICAgIGNvbnRlbnQ6IHR1cm4uY29udGVudFxuICAgICAgfSkpXG4gIH1cblxuICAvKipcbiAgICogTWFpbnRhaW5zIGNvbnRleHQgbWVtb3J5IGJ5IGNsZWFuaW5nIG9sZCBkYXRhXG4gICAqL1xuICBwcml2YXRlIHN0YXRpYyBtYWludGFpbkNvbnRleHRNZW1vcnkoY29udGV4dDogQ29udmVyc2F0aW9uQ29udGV4dCk6IHZvaWQge1xuICAgIC8vIEtlZXAgb25seSByZWNlbnQgdHVybnNcbiAgICBpZiAoY29udGV4dC5jb252ZXJzYXRpb25GbG93Lmxlbmd0aCA+IHRoaXMuTUFYX1RVUk5TX1JFVEFJTkVEKSB7XG4gICAgICBjb250ZXh0LmNvbnZlcnNhdGlvbkZsb3cgPSBjb250ZXh0LmNvbnZlcnNhdGlvbkZsb3cuc2xpY2UoLXRoaXMuTUFYX1RVUk5TX1JFVEFJTkVEKVxuICAgIH1cbiAgICBcbiAgICAvLyBDbGVhbiBvbGQgcmVmZXJlbmNlc1xuICAgIGNvbnN0IGN1dG9mZlRpbWUgPSBuZXcgRGF0ZShEYXRlLm5vdygpIC0gKDEyICogNjAgKiA2MCAqIDEwMDApKSAvLyAxMiBob3Vyc1xuICAgIGNvbnRleHQucmVmZXJlbmNlTWVtb3J5ID0gY29udGV4dC5yZWZlcmVuY2VNZW1vcnkuZmlsdGVyKFxuICAgICAgcmVmID0+IHJlZi50aW1lc3RhbXAgPiBjdXRvZmZUaW1lXG4gICAgKVxuICAgIFxuICAgIC8vIENsZWFuIG9sZCBpbnRlbnRpb25zXG4gICAgaWYgKGNvbnRleHQuYWN0aXZlSW50ZW50aW9ucy5sZW5ndGggPiAzKSB7XG4gICAgICBjb250ZXh0LmFjdGl2ZUludGVudGlvbnMgPSBjb250ZXh0LmFjdGl2ZUludGVudGlvbnMuc2xpY2UoLTMpXG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEdldHMgY29udmVyc2F0aW9uIHN0YXRpc3RpY3MgdXNpbmcgcGVyc2lzdGVudCBzdG9yYWdlXG4gICAqL1xuICBzdGF0aWMgZ2V0Q29udmVyc2F0aW9uU3RhdHModXNlcklkPzogc3RyaW5nKTogYW55IHtcbiAgICBjb25zdCB7IGdldFVzZXJBY3RpdmVTZXNzaW9ucyB9ID0gcmVxdWlyZSgnLi90ZW1wLXN0b3JhZ2UnKVxuICAgIFxuICAgIGlmICh1c2VySWQpIHtcbiAgICAgIGNvbnN0IHVzZXJTZXNzaW9ucyA9IGdldFVzZXJBY3RpdmVTZXNzaW9ucyh1c2VySWQpXG4gICAgICBcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGFjdGl2ZUNvbnRleHRzOiB1c2VyU2Vzc2lvbnMubGVuZ3RoLFxuICAgICAgICB0b3RhbFR1cm5zOiB1c2VyU2Vzc2lvbnMucmVkdWNlKChzdW06IG51bWJlciwgc2Vzc2lvbjogYW55KSA9PiBzdW0gKyBzZXNzaW9uLnR1cm5zLmxlbmd0aCwgMCksXG4gICAgICAgIGN1cnJlbnRUb3BpY3M6IFsuLi5uZXcgU2V0KHVzZXJTZXNzaW9ucy5tYXAoKHNlc3Npb246IGFueSkgPT4gc2Vzc2lvbi5jdXJyZW50VG9waWMpLmZpbHRlcihCb29sZWFuKSldLFxuICAgICAgICBjdXJyZW50U3ViamVjdHM6IFsuLi5uZXcgU2V0KHVzZXJTZXNzaW9ucy5tYXAoKHNlc3Npb246IGFueSkgPT4gc2Vzc2lvbi5jdXJyZW50U3ViamVjdCkuZmlsdGVyKEJvb2xlYW4pKV1cbiAgICAgIH1cbiAgICB9XG4gICAgXG4gICAgLy8gRm9yIGdsb2JhbCBzdGF0cywgd2UgbmVlZCB0byBpbXBvcnQgdGhlIGNvbnZlcnNhdGlvbnMgYXJyYXlcbiAgICBjb25zdCB7IHRlbXBDb252ZXJzYXRpb25zIH0gPSByZXF1aXJlKCcuL3RlbXAtc3RvcmFnZScpXG4gICAgY29uc3QgYWN0aXZlQ29udmVyc2F0aW9ucyA9IHRlbXBDb252ZXJzYXRpb25zLmZpbHRlcigoc2Vzc2lvbjogYW55KSA9PiB7XG4gICAgICBjb25zdCBvbmVIb3VyQWdvID0gbmV3IERhdGUoRGF0ZS5ub3coKSAtICg2MCAqIDYwICogMTAwMCkpXG4gICAgICByZXR1cm4gc2Vzc2lvbi5sYXN0VXBkYXRlID4gb25lSG91ckFnb1xuICAgIH0pXG4gICAgXG4gICAgcmV0dXJuIHtcbiAgICAgIHRvdGFsQWN0aXZlQ29udGV4dHM6IGFjdGl2ZUNvbnZlcnNhdGlvbnMubGVuZ3RoLFxuICAgICAgdG90YWxVc2VyczogbmV3IFNldChhY3RpdmVDb252ZXJzYXRpb25zLm1hcCgoc2Vzc2lvbjogYW55KSA9PiBzZXNzaW9uLnVzZXJJZCkpLnNpemUsXG4gICAgICBhdmVyYWdlQ29udGV4dEFnZTogdGhpcy5jYWxjdWxhdGVBdmVyYWdlQ29udGV4dEFnZUZyb21TZXNzaW9ucyhhY3RpdmVDb252ZXJzYXRpb25zKVxuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBDYWxjdWxhdGVzIGF2ZXJhZ2UgY29udGV4dCBhZ2UgZnJvbSBwZXJzaXN0ZW50IHNlc3Npb25zXG4gICAqL1xuICBwcml2YXRlIHN0YXRpYyBjYWxjdWxhdGVBdmVyYWdlQ29udGV4dEFnZUZyb21TZXNzaW9ucyhzZXNzaW9uczogYW55W10pOiBudW1iZXIge1xuICAgIGlmIChzZXNzaW9ucy5sZW5ndGggPT09IDApIHJldHVybiAwXG4gICAgXG4gICAgY29uc3Qgbm93ID0gRGF0ZS5ub3coKVxuICAgIGNvbnN0IHRvdGFsQWdlID0gc2Vzc2lvbnMucmVkdWNlKChzdW06IG51bWJlciwgc2Vzc2lvbjogYW55KSA9PiBcbiAgICAgIHN1bSArIChub3cgLSBuZXcgRGF0ZShzZXNzaW9uLmxhc3RVcGRhdGUpLmdldFRpbWUoKSksIDApXG4gICAgXG4gICAgcmV0dXJuIE1hdGgucm91bmQodG90YWxBZ2UgLyBzZXNzaW9ucy5sZW5ndGggLyAoNjAgKiAxMDAwKSkgLy8gQXZlcmFnZSBhZ2UgaW4gbWludXRlc1xuICB9XG5cbiAgLyoqXG4gICAqIEZvcmNlcyBjbGVhbnVwIG9mIGFsbCBjb250ZXh0cyAodXNlZnVsIGZvciB0ZXN0aW5nKVxuICAgKi9cbiAgc3RhdGljIGNsZWFyQWxsQ29udGV4dHMoKTogdm9pZCB7XG4gICAgY29uc3QgeyBjbGVhbnVwT2xkQ29udmVyc2F0aW9ucyB9ID0gcmVxdWlyZSgnLi90ZW1wLXN0b3JhZ2UnKVxuICAgIGNsZWFudXBPbGRDb252ZXJzYXRpb25zKClcbiAgICBjb25zb2xlLmxvZygn8J+nuSBBbGwgY29udmVyc2F0aW9uIGNvbnRleHRzIGNsZWFyZWQgdXNpbmcgcGVyc2lzdGVudCBzdG9yYWdlJylcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXRzIGFjdGl2ZSBjb250ZXh0IGZvciB1c2VyICh1c2VmdWwgZm9yIGRlYnVnZ2luZylcbiAgICovXG4gIHN0YXRpYyBnZXRBY3RpdmVDb250ZXh0KHVzZXJJZDogc3RyaW5nLCBzZXNzaW9uSWQ/OiBzdHJpbmcpOiBDb252ZXJzYXRpb25Db250ZXh0IHwgbnVsbCB7XG4gICAgY29uc3QgeyBnZXRDb252ZXJzYXRpb25TZXNzaW9uLCBnZXRVc2VyQWN0aXZlU2Vzc2lvbnMgfSA9IHJlcXVpcmUoJy4vdGVtcC1zdG9yYWdlJylcbiAgICBcbiAgICBpZiAoc2Vzc2lvbklkKSB7XG4gICAgICBjb25zdCBzZXNzaW9uID0gZ2V0Q29udmVyc2F0aW9uU2Vzc2lvbih1c2VySWQsIHNlc3Npb25JZClcbiAgICAgIGlmIChzZXNzaW9uKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgdXNlcklkOiBzZXNzaW9uLnVzZXJJZCxcbiAgICAgICAgICBzZXNzaW9uSWQ6IHNlc3Npb24uc2Vzc2lvbklkLFxuICAgICAgICAgIGN1cnJlbnRUb3BpYzogc2Vzc2lvbi5jdXJyZW50VG9waWMsXG4gICAgICAgICAgY3VycmVudFN1YmplY3Q6IHNlc3Npb24uY3VycmVudFN1YmplY3QsXG4gICAgICAgICAgY29udmVyc2F0aW9uRmxvdzogc2Vzc2lvbi50dXJucyxcbiAgICAgICAgICBjb250ZXh0U3VtbWFyeTogdGhpcy5idWlsZENvbnRleHRTdW1tYXJ5KHNlc3Npb24pLFxuICAgICAgICAgIGFjdGl2ZUludGVudGlvbnM6IHRoaXMuZXh0cmFjdEFjdGl2ZUludGVudGlvbnMoc2Vzc2lvbi50dXJucy5zbGljZSgtNSkpLFxuICAgICAgICAgIHBlbmRpbmdRdWVzdGlvbnM6IFtdLFxuICAgICAgICAgIHJlZmVyZW5jZU1lbW9yeTogdGhpcy5idWlsZFJlZmVyZW5jZU1lbW9yeShzZXNzaW9uLnR1cm5zKSxcbiAgICAgICAgICBsYXN0VXBkYXRlOiBzZXNzaW9uLmxhc3RVcGRhdGVcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICBcbiAgICAvLyBGaW5kIGFueSBhY3RpdmUgc2Vzc2lvbiBmb3IgdXNlclxuICAgIGNvbnN0IGFjdGl2ZVNlc3Npb25zID0gZ2V0VXNlckFjdGl2ZVNlc3Npb25zKHVzZXJJZClcbiAgICBpZiAoYWN0aXZlU2Vzc2lvbnMubGVuZ3RoID4gMCkge1xuICAgICAgY29uc3Qgc2Vzc2lvbiA9IGFjdGl2ZVNlc3Npb25zWzBdXG4gICAgICByZXR1cm4ge1xuICAgICAgICB1c2VySWQ6IHNlc3Npb24udXNlcklkLFxuICAgICAgICBzZXNzaW9uSWQ6IHNlc3Npb24uc2Vzc2lvbklkLFxuICAgICAgICBjdXJyZW50VG9waWM6IHNlc3Npb24uY3VycmVudFRvcGljLFxuICAgICAgICBjdXJyZW50U3ViamVjdDogc2Vzc2lvbi5jdXJyZW50U3ViamVjdCxcbiAgICAgICAgY29udmVyc2F0aW9uRmxvdzogc2Vzc2lvbi50dXJucyxcbiAgICAgICAgY29udGV4dFN1bW1hcnk6IHRoaXMuYnVpbGRDb250ZXh0U3VtbWFyeShzZXNzaW9uKSxcbiAgICAgICAgYWN0aXZlSW50ZW50aW9uczogdGhpcy5leHRyYWN0QWN0aXZlSW50ZW50aW9ucyhzZXNzaW9uLnR1cm5zLnNsaWNlKC01KSksXG4gICAgICAgIHBlbmRpbmdRdWVzdGlvbnM6IFtdLFxuICAgICAgICByZWZlcmVuY2VNZW1vcnk6IHRoaXMuYnVpbGRSZWZlcmVuY2VNZW1vcnkoc2Vzc2lvbi50dXJucyksXG4gICAgICAgIGxhc3RVcGRhdGU6IHNlc3Npb24ubGFzdFVwZGF0ZVxuICAgICAgfVxuICAgIH1cbiAgICBcbiAgICByZXR1cm4gbnVsbFxuICB9XG59XG5cbi8vIFBlcnNpc3RlbnQgc3RvcmFnZSBjbGVhbnVwIGlzIGhhbmRsZWQgYnkgdGVtcC1zdG9yYWdlLnRzXG4vLyBObyBuZWVkIGZvciBhZGRpdGlvbmFsIGNsZWFudXAgaW50ZXJ2YWxzIl0sIm5hbWVzIjpbIkFkdmFuY2VkTGVhcm5pbmdQcm9maWxlTWFuYWdlciIsIlZpc3VhbExlYXJuaW5nRW5naW5lIiwiQUlDYWxlbmRhckludGVncmF0aW9uIiwiQ29udGV4dHVhbENvbnZlcnNhdGlvbk1hbmFnZXIiLCJNQVhfVFVSTlNfUkVUQUlORUQiLCJNQVhfUkVGRVJFTkNFUyIsIkNPTlRFWFRfREVDQVlfSE9VUlMiLCJwcm9jZXNzQ29udGV4dHVhbE1lc3NhZ2UiLCJ1c2VySWQiLCJtZXNzYWdlIiwic2Vzc2lvbklkIiwidXNlck5hbWUiLCJhY3R1YWxTZXNzaW9uSWQiLCJEYXRlIiwibm93IiwiZ2V0Q29udmVyc2F0aW9uU2Vzc2lvbiIsImNyZWF0ZUNvbnZlcnNhdGlvblNlc3Npb24iLCJhZGRDb252ZXJzYXRpb25UdXJuIiwiYWRkUGVuZGluZ1Rhc2siLCJnZXRQZW5kaW5nVGFza3MiLCJyZXF1aXJlIiwic2Vzc2lvbiIsImNvbnNvbGUiLCJsb2ciLCJzdWJzdHJpbmciLCJ0dXJucyIsImxlbmd0aCIsInBlbmRpbmdUYXNrcyIsImZpbHRlciIsInQiLCJjb21wbGV0ZWQiLCJtZXNzYWdlTWV0YWRhdGEiLCJhbmFseXplTWVzc2FnZU1ldGFkYXRhIiwiY29udGV4dCIsImN1cnJlbnRUb3BpYyIsImN1cnJlbnRTdWJqZWN0IiwiY29udmVyc2F0aW9uRmxvdyIsIm1hcCIsInR1cm4iLCJpZCIsInRpbWVzdGFtcCIsInJvbGUiLCJjb250ZW50IiwibWV0YWRhdGEiLCJjb250ZXh0U3VtbWFyeSIsImJ1aWxkQ29udGV4dFN1bW1hcnkiLCJhY3RpdmVJbnRlbnRpb25zIiwiZXh0cmFjdEFjdGl2ZUludGVudGlvbnMiLCJzbGljZSIsInBlbmRpbmdRdWVzdGlvbnMiLCJyZWZlcmVuY2VNZW1vcnkiLCJidWlsZFJlZmVyZW5jZU1lbW9yeSIsImxhc3RVcGRhdGUiLCJyZXNwb25zZSIsImdlbmVyYXRlQ29udGV4dHVhbFJlc3BvbnNlIiwiYXNzaXN0YW50TWV0YWRhdGEiLCJjb25maWRlbmNlIiwiY29udGludWl0eVNjb3JlIiwidmlzdWFsc0dlbmVyYXRlZCIsInZpc3VhbFJlY29tbWVuZGF0aW9uIiwic2VhcmNoUGVyZm9ybWVkIiwicGVyc29uYWxpemF0aW9ucyIsImluY2x1ZGVzIiwidGFza0NvbXBsZXRlZCIsInJlY2VudFR1cm5zIiwia2V5VG9waWNzIiwiU2V0IiwidG9waWMiLCJCb29sZWFuIiwia2V5U3ViamVjdHMiLCJzdWJqZWN0Iiwic3VtbWFyeVBhcnRzIiwicHVzaCIsImpvaW4iLCJpbnRlbnRpb25zIiwiaW50ZW50aW9uIiwicmVmZXJlbmNlcyIsImZvckVhY2giLCJpbmRleCIsInR5cGUiLCJkZXRlcm1pbmVSZWZlcmVuY2VUeXBlRnJvbU1ldGFkYXRhIiwicmVsZXZhbmNlU2NvcmUiLCJ0dXJuSW5kZXgiLCJoYW5kbGVDYWxlbmRhclRhc2tzIiwiY29udmVyc2F0aW9uSGlzdG9yeSIsImNhbGVuZGFySW50ZWdyYXRpb24iLCJjYWxlbmRhclJlc3VsdCIsInByb2Nlc3NNZXNzYWdlIiwibmVlZHNFdmVudENyZWF0aW9uIiwiY2FsZW5kYXJUYXNrIiwiZmluZCIsIm1hcmtUYXNrQ29tcGxldGVkIiwic3VnZ2VzdGVkQWN0aW9ucyIsImV2ZW50IiwiZXZlbnRDcmVhdGVkIiwiYnVpbGRFZHVjYXRpb25hbFByb21wdCIsImNvbnZlcnNhdGlvbkNvbnRleHQiLCJwcm9tcHQiLCJnZW5lcmF0ZUNvbnRleHR1YWxGYWxsYmFjayIsIm1zZ0xvd2VyIiwidG9Mb3dlckNhc2UiLCJ0ZXN0IiwidG9waWNNYXRjaGVzIiwibWF0Y2giLCJNYXRoIiwibWluIiwidXBkYXRlQ29udGV4dHVhbEluZm9ybWF0aW9uIiwibGFzdEFzc2lzdGFudFR1cm4iLCJyZXZlcnNlIiwic2hpZnQiLCJyZWZlcmVuY2UiLCJkZXRlcm1pbmVSZWZlcmVuY2VUeXBlIiwic29ydCIsImEiLCJiIiwidXBkYXRlQ29udGV4dFN1bW1hcnkiLCJsZWFybmluZ1Byb2ZpbGUiLCJnZXRMZWFybmluZ1Byb2ZpbGUiLCJsYXRlc3RNZXNzYWdlIiwicHJvY2Vzc1VzZXJNZXNzYWdlIiwiY29udGludWl0eUFuYWx5c2lzIiwiYW5hbHl6ZUNvbnRpbnVpdHkiLCJmb3JtYXRDb252ZXJzYXRpb25IaXN0b3J5Iiwic3VnZ2VzdGVkRm9sbG93dXBzIiwiYWlTZXJ2aWNlIiwiYmFzZUNvbnRlbnQiLCJlZHVjYXRpb25hbFByb21wdCIsImdlbmVyYXRlRXhlcmNpc2UiLCJlcnJvciIsImVuaGFuY2VkQ29udGVudCIsInNob3VsZFJlZmVyZW5jZSIsImFkZENvbnRpbnVpdHlSZWZlcmVuY2VzIiwiYWRhcHRSZXNwb25zZVRvTGVhcm5pbmdTdHlsZSIsInByaW1hcnlTdHlsZSIsImFkYXB0YXRpb25QcmVmZXJlbmNlcyIsInByZWZlcnNWaXN1YWxBaWRzIiwiZGV0ZWN0T3B0aW1hbFZpc3VhbFR5cGUiLCJyZWFzb24iLCJmb2xsb3d1cHMiLCJnZW5lcmF0ZUNvbnRleHR1YWxGb2xsb3d1cHMiLCJzY29yZSIsInJlZmVyZW5jZVR5cGUiLCJ0b3BpY3MiLCJzdWJqZWN0cyIsImhhc1F1ZXN0aW9uRm9sbG93dXAiLCJzb21lIiwicmVjZW50QXNzaXN0YW50VHVybnMiLCJsYXN0VG9waWMiLCJsYXN0U3ViamVjdCIsInJlZmVyZW5jZVByZWZpeCIsInByZWZlcnNJbnRlcmFjdGlvbiIsIm1haW50YWluQ29udGV4dE1lbW9yeSIsImN1dG9mZlRpbWUiLCJyZWYiLCJnZXRDb252ZXJzYXRpb25TdGF0cyIsImdldFVzZXJBY3RpdmVTZXNzaW9ucyIsInVzZXJTZXNzaW9ucyIsImFjdGl2ZUNvbnRleHRzIiwidG90YWxUdXJucyIsInJlZHVjZSIsInN1bSIsImN1cnJlbnRUb3BpY3MiLCJjdXJyZW50U3ViamVjdHMiLCJ0ZW1wQ29udmVyc2F0aW9ucyIsImFjdGl2ZUNvbnZlcnNhdGlvbnMiLCJvbmVIb3VyQWdvIiwidG90YWxBY3RpdmVDb250ZXh0cyIsInRvdGFsVXNlcnMiLCJzaXplIiwiYXZlcmFnZUNvbnRleHRBZ2UiLCJjYWxjdWxhdGVBdmVyYWdlQ29udGV4dEFnZUZyb21TZXNzaW9ucyIsInNlc3Npb25zIiwidG90YWxBZ2UiLCJnZXRUaW1lIiwicm91bmQiLCJjbGVhckFsbENvbnRleHRzIiwiY2xlYW51cE9sZENvbnZlcnNhdGlvbnMiLCJnZXRBY3RpdmVDb250ZXh0IiwiYWN0aXZlU2Vzc2lvbnMiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/contextual-conversation-manager.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/hybrid-storage.ts":
/*!***********************************!*\
  !*** ./src/lib/hybrid-storage.ts ***!
  \***********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   canSubmitThisWeek: () => (/* binding */ canSubmitThisWeek),\n/* harmony export */   createProgressReport: () => (/* binding */ createProgressReport),\n/* harmony export */   createUser: () => (/* binding */ createUser),\n/* harmony export */   findProgressReportByUserAndWeek: () => (/* binding */ findProgressReportByUserAndWeek),\n/* harmony export */   findProgressReportsByUser: () => (/* binding */ findProgressReportsByUser),\n/* harmony export */   findUserByEmail: () => (/* binding */ findUserByEmail),\n/* harmony export */   findUserById: () => (/* binding */ findUserById),\n/* harmony export */   findUsersByRole: () => (/* binding */ findUsersByRole),\n/* harmony export */   generateStudentId: () => (/* binding */ generateStudentId),\n/* harmony export */   getAllProgressReports: () => (/* binding */ getAllProgressReports),\n/* harmony export */   getAllUsers: () => (/* binding */ getAllUsers),\n/* harmony export */   getCurrentWeekEnd: () => (/* binding */ getCurrentWeekEnd),\n/* harmony export */   getCurrentWeekStart: () => (/* binding */ getCurrentWeekStart),\n/* harmony export */   getMonthWeeks: () => (/* binding */ getMonthWeeks),\n/* harmony export */   initializeStorage: () => (/* binding */ initializeStorage),\n/* harmony export */   validateStudentId: () => (/* binding */ validateStudentId)\n/* harmony export */ });\n/* harmony import */ var _temp_storage__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./temp-storage */ \"(rsc)/./src/lib/temp-storage.ts\");\n// Hybrid storage system that can work with database or fallback to temp-storage\n\n// For now, use temp-storage exclusively to ensure stability\nconst useDatabase = false;\nconsole.log('üîÑ Using temp-storage system for reliability');\n// Initialize the storage system\nasync function initializeStorage() {\n    console.log('‚úÖ Temp-storage system initialized');\n}\n// User management functions with fallback\nasync function createUser(userData) {\n    const hashedPassword = (__webpack_require__(/*! bcryptjs */ \"(rsc)/./node_modules/bcryptjs/umd/index.js\").hashSync)(userData.password, 12);\n    const user = {\n        id: Date.now().toString(),\n        ...userData,\n        password: hashedPassword,\n        createdAt: new Date(),\n        updatedAt: new Date(),\n        status: 'ACTIVE'\n    };\n    _temp_storage__WEBPACK_IMPORTED_MODULE_0__.addUser(user);\n    return user;\n}\nasync function findUserByEmail(email) {\n    return _temp_storage__WEBPACK_IMPORTED_MODULE_0__.findUserByEmail(email);\n}\nasync function getAllUsers() {\n    return _temp_storage__WEBPACK_IMPORTED_MODULE_0__.getAllUsers();\n}\nasync function findUsersByRole(role) {\n    return _temp_storage__WEBPACK_IMPORTED_MODULE_0__.findUsersByRole(role);\n}\nasync function findUserById(id) {\n    return _temp_storage__WEBPACK_IMPORTED_MODULE_0__.findUserById(id);\n}\nasync function generateStudentId() {\n    return _temp_storage__WEBPACK_IMPORTED_MODULE_0__.generateStudentId();\n}\n// Progress reports functions with fallback\nasync function createProgressReport(data) {\n    const report = {\n        id: Date.now().toString(),\n        userId: data.userId,\n        weekStart: data.weekStart,\n        weekEnd: data.weekEnd,\n        submittedAt: new Date(),\n        responses: data.responses\n    };\n    _temp_storage__WEBPACK_IMPORTED_MODULE_0__.addWeeklyReport(report);\n    return report;\n}\nasync function findProgressReportsByUser(userId) {\n    return _temp_storage__WEBPACK_IMPORTED_MODULE_0__.findWeeklyReportsByUser(userId);\n}\nasync function getAllProgressReports() {\n    return _temp_storage__WEBPACK_IMPORTED_MODULE_0__.getAllWeeklyReports();\n}\nasync function findProgressReportByUserAndWeek(userId, weekStart) {\n    return _temp_storage__WEBPACK_IMPORTED_MODULE_0__.findWeeklyReportByUserAndWeek(userId, weekStart);\n}\nasync function canSubmitThisWeek(userId) {\n    return _temp_storage__WEBPACK_IMPORTED_MODULE_0__.canSubmitThisWeek(userId);\n}\n// Utility functions (same for both)\nfunction getCurrentWeekStart() {\n    return _temp_storage__WEBPACK_IMPORTED_MODULE_0__.getCurrentWeekStart();\n}\nfunction getCurrentWeekEnd() {\n    return _temp_storage__WEBPACK_IMPORTED_MODULE_0__.getCurrentWeekEnd();\n}\nfunction getMonthWeeks(year, month) {\n    return _temp_storage__WEBPACK_IMPORTED_MODULE_0__.getMonthWeeks(year, month);\n}\nfunction validateStudentId(studentId) {\n    return _temp_storage__WEBPACK_IMPORTED_MODULE_0__.validateStudentId(studentId);\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvbGliL2h5YnJpZC1zdG9yYWdlLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUEsZ0ZBQWdGO0FBQ25DO0FBRTdDLDREQUE0RDtBQUM1RCxNQUFNQyxjQUFjO0FBRXBCQyxRQUFRQyxHQUFHLENBQUM7QUFFWixnQ0FBZ0M7QUFDekIsZUFBZUM7SUFDcEJGLFFBQVFDLEdBQUcsQ0FBQztBQUNkO0FBRUEsMENBQTBDO0FBQ25DLGVBQWVFLFdBQVdDLFFBQWE7SUFDNUMsTUFBTUMsaUJBQWlCQyw0RkFBNEIsQ0FBQ0YsU0FBU0ksUUFBUSxFQUFFO0lBQ3ZFLE1BQU1DLE9BQU87UUFDWEMsSUFBSUMsS0FBS0MsR0FBRyxHQUFHQyxRQUFRO1FBQ3ZCLEdBQUdULFFBQVE7UUFDWEksVUFBVUg7UUFDVlMsV0FBVyxJQUFJSDtRQUNmSSxXQUFXLElBQUlKO1FBQ2ZLLFFBQVE7SUFDVjtJQUNBbEIsa0RBQW1CLENBQUNXO0lBQ3BCLE9BQU9BO0FBQ1Q7QUFFTyxlQUFlUyxnQkFBZ0JDLEtBQWE7SUFDakQsT0FBT3JCLDBEQUEyQixDQUFDcUI7QUFDckM7QUFFTyxlQUFlQztJQUNwQixPQUFPdEIsc0RBQXVCO0FBQ2hDO0FBRU8sZUFBZXVCLGdCQUFnQkMsSUFBUztJQUM3QyxPQUFPeEIsMERBQTJCLENBQUN3QjtBQUNyQztBQUVPLGVBQWVDLGFBQWFiLEVBQVU7SUFDM0MsT0FBT1osdURBQXdCLENBQUNZO0FBQ2xDO0FBRU8sZUFBZWM7SUFDcEIsT0FBTzFCLDREQUE2QjtBQUN0QztBQUVBLDJDQUEyQztBQUNwQyxlQUFlMkIscUJBQXFCQyxJQUFTO0lBQ2xELE1BQU1DLFNBQVM7UUFDYmpCLElBQUlDLEtBQUtDLEdBQUcsR0FBR0MsUUFBUTtRQUN2QmUsUUFBUUYsS0FBS0UsTUFBTTtRQUNuQkMsV0FBV0gsS0FBS0csU0FBUztRQUN6QkMsU0FBU0osS0FBS0ksT0FBTztRQUNyQkMsYUFBYSxJQUFJcEI7UUFDakJxQixXQUFXTixLQUFLTSxTQUFTO0lBQzNCO0lBQ0FsQywwREFBMkIsQ0FBQzZCO0lBQzVCLE9BQU9BO0FBQ1Q7QUFFTyxlQUFlTywwQkFBMEJOLE1BQWM7SUFDNUQsT0FBTzlCLGtFQUFtQyxDQUFDOEI7QUFDN0M7QUFFTyxlQUFlUTtJQUNwQixPQUFPdEMsOERBQStCO0FBQ3hDO0FBRU8sZUFBZXdDLGdDQUFnQ1YsTUFBYyxFQUFFQyxTQUFlO0lBQ25GLE9BQU8vQix3RUFBeUMsQ0FBQzhCLFFBQVFDO0FBQzNEO0FBRU8sZUFBZVcsa0JBQWtCWixNQUFjO0lBQ3BELE9BQU85Qiw0REFBNkIsQ0FBQzhCO0FBQ3ZDO0FBRUEsb0NBQW9DO0FBQzdCLFNBQVNhO0lBQ2QsT0FBTzNDLDhEQUErQjtBQUN4QztBQUVPLFNBQVM0QztJQUNkLE9BQU81Qyw0REFBNkI7QUFDdEM7QUFFTyxTQUFTNkMsY0FBY0MsSUFBWSxFQUFFQyxLQUFhO0lBQ3ZELE9BQU8vQyx3REFBeUIsQ0FBQzhDLE1BQU1DO0FBQ3pDO0FBRU8sU0FBU0Msa0JBQWtCQyxTQUFpQjtJQUNqRCxPQUFPakQsNERBQTZCLENBQUNpRDtBQUN2QyIsInNvdXJjZXMiOlsiL1VzZXJzL3JvZHJpZ29kaWJlcm5hcmRvMzNnbWFpbC5jb20vRG9jdW1lbnRzL0FwcCBEZXZlbG9wbWVudCBQcm95ZWN0cy9JbnRlbGxlZ28gUGxhdGZvcm0vc3JjL2xpYi9oeWJyaWQtc3RvcmFnZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBIeWJyaWQgc3RvcmFnZSBzeXN0ZW0gdGhhdCBjYW4gd29yayB3aXRoIGRhdGFiYXNlIG9yIGZhbGxiYWNrIHRvIHRlbXAtc3RvcmFnZVxuaW1wb3J0ICogYXMgdGVtcFN0b3JhZ2UgZnJvbSAnLi90ZW1wLXN0b3JhZ2UnXG5cbi8vIEZvciBub3csIHVzZSB0ZW1wLXN0b3JhZ2UgZXhjbHVzaXZlbHkgdG8gZW5zdXJlIHN0YWJpbGl0eVxuY29uc3QgdXNlRGF0YWJhc2UgPSBmYWxzZVxuXG5jb25zb2xlLmxvZygn8J+UhCBVc2luZyB0ZW1wLXN0b3JhZ2Ugc3lzdGVtIGZvciByZWxpYWJpbGl0eScpXG5cbi8vIEluaXRpYWxpemUgdGhlIHN0b3JhZ2Ugc3lzdGVtXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gaW5pdGlhbGl6ZVN0b3JhZ2UoKSB7XG4gIGNvbnNvbGUubG9nKCfinIUgVGVtcC1zdG9yYWdlIHN5c3RlbSBpbml0aWFsaXplZCcpXG59XG5cbi8vIFVzZXIgbWFuYWdlbWVudCBmdW5jdGlvbnMgd2l0aCBmYWxsYmFja1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGNyZWF0ZVVzZXIodXNlckRhdGE6IGFueSkge1xuICBjb25zdCBoYXNoZWRQYXNzd29yZCA9IHJlcXVpcmUoJ2JjcnlwdGpzJykuaGFzaFN5bmModXNlckRhdGEucGFzc3dvcmQsIDEyKVxuICBjb25zdCB1c2VyID0ge1xuICAgIGlkOiBEYXRlLm5vdygpLnRvU3RyaW5nKCksXG4gICAgLi4udXNlckRhdGEsXG4gICAgcGFzc3dvcmQ6IGhhc2hlZFBhc3N3b3JkLFxuICAgIGNyZWF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICB1cGRhdGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgc3RhdHVzOiAnQUNUSVZFJyBhcyBjb25zdCxcbiAgfVxuICB0ZW1wU3RvcmFnZS5hZGRVc2VyKHVzZXIpXG4gIHJldHVybiB1c2VyXG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBmaW5kVXNlckJ5RW1haWwoZW1haWw6IHN0cmluZykge1xuICByZXR1cm4gdGVtcFN0b3JhZ2UuZmluZFVzZXJCeUVtYWlsKGVtYWlsKVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0QWxsVXNlcnMoKSB7XG4gIHJldHVybiB0ZW1wU3RvcmFnZS5nZXRBbGxVc2VycygpXG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBmaW5kVXNlcnNCeVJvbGUocm9sZTogYW55KSB7XG4gIHJldHVybiB0ZW1wU3RvcmFnZS5maW5kVXNlcnNCeVJvbGUocm9sZSlcbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGZpbmRVc2VyQnlJZChpZDogc3RyaW5nKSB7XG4gIHJldHVybiB0ZW1wU3RvcmFnZS5maW5kVXNlckJ5SWQoaWQpXG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZW5lcmF0ZVN0dWRlbnRJZCgpIHtcbiAgcmV0dXJuIHRlbXBTdG9yYWdlLmdlbmVyYXRlU3R1ZGVudElkKClcbn1cblxuLy8gUHJvZ3Jlc3MgcmVwb3J0cyBmdW5jdGlvbnMgd2l0aCBmYWxsYmFja1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGNyZWF0ZVByb2dyZXNzUmVwb3J0KGRhdGE6IGFueSkge1xuICBjb25zdCByZXBvcnQgPSB7XG4gICAgaWQ6IERhdGUubm93KCkudG9TdHJpbmcoKSxcbiAgICB1c2VySWQ6IGRhdGEudXNlcklkLFxuICAgIHdlZWtTdGFydDogZGF0YS53ZWVrU3RhcnQsXG4gICAgd2Vla0VuZDogZGF0YS53ZWVrRW5kLFxuICAgIHN1Ym1pdHRlZEF0OiBuZXcgRGF0ZSgpLFxuICAgIHJlc3BvbnNlczogZGF0YS5yZXNwb25zZXNcbiAgfVxuICB0ZW1wU3RvcmFnZS5hZGRXZWVrbHlSZXBvcnQocmVwb3J0KVxuICByZXR1cm4gcmVwb3J0XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBmaW5kUHJvZ3Jlc3NSZXBvcnRzQnlVc2VyKHVzZXJJZDogc3RyaW5nKSB7XG4gIHJldHVybiB0ZW1wU3RvcmFnZS5maW5kV2Vla2x5UmVwb3J0c0J5VXNlcih1c2VySWQpXG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRBbGxQcm9ncmVzc1JlcG9ydHMoKSB7XG4gIHJldHVybiB0ZW1wU3RvcmFnZS5nZXRBbGxXZWVrbHlSZXBvcnRzKClcbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGZpbmRQcm9ncmVzc1JlcG9ydEJ5VXNlckFuZFdlZWsodXNlcklkOiBzdHJpbmcsIHdlZWtTdGFydDogRGF0ZSkge1xuICByZXR1cm4gdGVtcFN0b3JhZ2UuZmluZFdlZWtseVJlcG9ydEJ5VXNlckFuZFdlZWsodXNlcklkLCB3ZWVrU3RhcnQpXG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjYW5TdWJtaXRUaGlzV2Vlayh1c2VySWQ6IHN0cmluZykge1xuICByZXR1cm4gdGVtcFN0b3JhZ2UuY2FuU3VibWl0VGhpc1dlZWsodXNlcklkKVxufVxuXG4vLyBVdGlsaXR5IGZ1bmN0aW9ucyAoc2FtZSBmb3IgYm90aClcbmV4cG9ydCBmdW5jdGlvbiBnZXRDdXJyZW50V2Vla1N0YXJ0KCkge1xuICByZXR1cm4gdGVtcFN0b3JhZ2UuZ2V0Q3VycmVudFdlZWtTdGFydCgpXG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRDdXJyZW50V2Vla0VuZCgpIHtcbiAgcmV0dXJuIHRlbXBTdG9yYWdlLmdldEN1cnJlbnRXZWVrRW5kKClcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGdldE1vbnRoV2Vla3MoeWVhcjogbnVtYmVyLCBtb250aDogbnVtYmVyKSB7XG4gIHJldHVybiB0ZW1wU3RvcmFnZS5nZXRNb250aFdlZWtzKHllYXIsIG1vbnRoKVxufVxuXG5leHBvcnQgZnVuY3Rpb24gdmFsaWRhdGVTdHVkZW50SWQoc3R1ZGVudElkOiBzdHJpbmcpIHtcbiAgcmV0dXJuIHRlbXBTdG9yYWdlLnZhbGlkYXRlU3R1ZGVudElkKHN0dWRlbnRJZClcbn0iXSwibmFtZXMiOlsidGVtcFN0b3JhZ2UiLCJ1c2VEYXRhYmFzZSIsImNvbnNvbGUiLCJsb2ciLCJpbml0aWFsaXplU3RvcmFnZSIsImNyZWF0ZVVzZXIiLCJ1c2VyRGF0YSIsImhhc2hlZFBhc3N3b3JkIiwicmVxdWlyZSIsImhhc2hTeW5jIiwicGFzc3dvcmQiLCJ1c2VyIiwiaWQiLCJEYXRlIiwibm93IiwidG9TdHJpbmciLCJjcmVhdGVkQXQiLCJ1cGRhdGVkQXQiLCJzdGF0dXMiLCJhZGRVc2VyIiwiZmluZFVzZXJCeUVtYWlsIiwiZW1haWwiLCJnZXRBbGxVc2VycyIsImZpbmRVc2Vyc0J5Um9sZSIsInJvbGUiLCJmaW5kVXNlckJ5SWQiLCJnZW5lcmF0ZVN0dWRlbnRJZCIsImNyZWF0ZVByb2dyZXNzUmVwb3J0IiwiZGF0YSIsInJlcG9ydCIsInVzZXJJZCIsIndlZWtTdGFydCIsIndlZWtFbmQiLCJzdWJtaXR0ZWRBdCIsInJlc3BvbnNlcyIsImFkZFdlZWtseVJlcG9ydCIsImZpbmRQcm9ncmVzc1JlcG9ydHNCeVVzZXIiLCJmaW5kV2Vla2x5UmVwb3J0c0J5VXNlciIsImdldEFsbFByb2dyZXNzUmVwb3J0cyIsImdldEFsbFdlZWtseVJlcG9ydHMiLCJmaW5kUHJvZ3Jlc3NSZXBvcnRCeVVzZXJBbmRXZWVrIiwiZmluZFdlZWtseVJlcG9ydEJ5VXNlckFuZFdlZWsiLCJjYW5TdWJtaXRUaGlzV2VlayIsImdldEN1cnJlbnRXZWVrU3RhcnQiLCJnZXRDdXJyZW50V2Vla0VuZCIsImdldE1vbnRoV2Vla3MiLCJ5ZWFyIiwibW9udGgiLCJ2YWxpZGF0ZVN0dWRlbnRJZCIsInN0dWRlbnRJZCJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/hybrid-storage.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/temp-storage.ts":
/*!*********************************!*\
  !*** ./src/lib/temp-storage.ts ***!
  \*********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   addConversationTurn: () => (/* binding */ addConversationTurn),\n/* harmony export */   addPendingTask: () => (/* binding */ addPendingTask),\n/* harmony export */   addUser: () => (/* binding */ addUser),\n/* harmony export */   addWeeklyReport: () => (/* binding */ addWeeklyReport),\n/* harmony export */   canSubmitThisWeek: () => (/* binding */ canSubmitThisWeek),\n/* harmony export */   cleanupOldConversations: () => (/* binding */ cleanupOldConversations),\n/* harmony export */   createConversationSession: () => (/* binding */ createConversationSession),\n/* harmony export */   deleteUser: () => (/* binding */ deleteUser),\n/* harmony export */   findEventById: () => (/* binding */ findEventById),\n/* harmony export */   findUserByEmail: () => (/* binding */ findUserByEmail),\n/* harmony export */   findUserById: () => (/* binding */ findUserById),\n/* harmony export */   findUserByStudentId: () => (/* binding */ findUserByStudentId),\n/* harmony export */   findUsersByProgram: () => (/* binding */ findUsersByProgram),\n/* harmony export */   findUsersByRole: () => (/* binding */ findUsersByRole),\n/* harmony export */   findUsersByStatus: () => (/* binding */ findUsersByStatus),\n/* harmony export */   findWeeklyReportByUserAndWeek: () => (/* binding */ findWeeklyReportByUserAndWeek),\n/* harmony export */   findWeeklyReportsByUser: () => (/* binding */ findWeeklyReportsByUser),\n/* harmony export */   generateStudentId: () => (/* binding */ generateStudentId),\n/* harmony export */   getAllCalendarEvents: () => (/* binding */ getAllCalendarEvents),\n/* harmony export */   getAllUsers: () => (/* binding */ getAllUsers),\n/* harmony export */   getAllWeeklyReports: () => (/* binding */ getAllWeeklyReports),\n/* harmony export */   getConversationHistory: () => (/* binding */ getConversationHistory),\n/* harmony export */   getConversationSession: () => (/* binding */ getConversationSession),\n/* harmony export */   getCurrentWeekEnd: () => (/* binding */ getCurrentWeekEnd),\n/* harmony export */   getCurrentWeekStart: () => (/* binding */ getCurrentWeekStart),\n/* harmony export */   getEvents: () => (/* binding */ getEvents),\n/* harmony export */   getEventsForDateRange: () => (/* binding */ getEventsForDateRange),\n/* harmony export */   getMonthWeeks: () => (/* binding */ getMonthWeeks),\n/* harmony export */   getPendingTasks: () => (/* binding */ getPendingTasks),\n/* harmony export */   getUpcomingEvents: () => (/* binding */ getUpcomingEvents),\n/* harmony export */   getUserActiveSessions: () => (/* binding */ getUserActiveSessions),\n/* harmony export */   getWeekDates: () => (/* binding */ getWeekDates),\n/* harmony export */   getWeeklyReportsByDateRange: () => (/* binding */ getWeeklyReportsByDateRange),\n/* harmony export */   markTaskCompleted: () => (/* binding */ markTaskCompleted),\n/* harmony export */   tempConversations: () => (/* binding */ tempConversations),\n/* harmony export */   tempUsers: () => (/* binding */ tempUsers),\n/* harmony export */   tempWeeklyReports: () => (/* binding */ tempWeeklyReports),\n/* harmony export */   updateConversationSession: () => (/* binding */ updateConversationSession),\n/* harmony export */   updateUser: () => (/* binding */ updateUser),\n/* harmony export */   validateStudentId: () => (/* binding */ validateStudentId)\n/* harmony export */ });\n/* harmony import */ var bcryptjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! bcryptjs */ \"(rsc)/./node_modules/bcryptjs/index.js\");\n// Temporary user storage - replace with database later\n// Singleton pattern to persist data across requests\nconst globalForStorage = globalThis;\nconst tempUsers = globalForStorage.tempUsers ?? [];\nconst tempWeeklyReports = globalForStorage.tempWeeklyReports ?? [];\n// Assign to globalThis to persist across requests\nglobalForStorage.tempUsers = tempUsers;\nglobalForStorage.tempWeeklyReports = tempWeeklyReports;\nfunction addUser(user) {\n    tempUsers.push(user);\n}\nfunction findUserByEmail(email) {\n    return tempUsers.find((user)=>user.email === email);\n}\nfunction findUserByStudentId(studentId) {\n    return tempUsers.find((user)=>user.studentId === studentId);\n}\nfunction findUserById(id) {\n    return tempUsers.find((user)=>user.id === id);\n}\nfunction getAllUsers() {\n    return tempUsers;\n}\nfunction findUsersByRole(role) {\n    return tempUsers.filter((user)=>user.role === role);\n}\nfunction findUsersByProgram(program) {\n    return tempUsers.filter((user)=>user.program === program);\n}\nfunction findUsersByStatus(status) {\n    return tempUsers.filter((user)=>user.status === status);\n}\nfunction updateUser(id, updates) {\n    const userIndex = tempUsers.findIndex((user)=>user.id === id);\n    if (userIndex !== -1) {\n        tempUsers[userIndex] = {\n            ...tempUsers[userIndex],\n            ...updates,\n            updatedAt: new Date()\n        };\n        return tempUsers[userIndex];\n    }\n    return null;\n}\nfunction deleteUser(id) {\n    const userIndex = tempUsers.findIndex((user)=>user.id === id);\n    if (userIndex !== -1) {\n        return tempUsers.splice(userIndex, 1)[0];\n    }\n    return null;\n}\nfunction validateStudentId(studentId) {\n    // Formato sugerido: EST-YYYY-XXX (ej: EST-2024-001)\n    const studentIdRegex = /^EST-\\d{4}-\\d{3}$/;\n    return studentIdRegex.test(studentId);\n}\nfunction generateStudentId() {\n    const currentYear = new Date().getFullYear();\n    const existingIds = tempUsers.filter((user)=>user.studentId && user.studentId.startsWith(`EST-${currentYear}`)).map((user)=>user.studentId).sort();\n    let nextNumber = 1;\n    if (existingIds.length > 0) {\n        const lastId = existingIds[existingIds.length - 1];\n        const lastNumber = parseInt(lastId.split('-')[2]);\n        nextNumber = lastNumber + 1;\n    }\n    return `EST-${currentYear}-${nextNumber.toString().padStart(3, '0')}`;\n}\n// Weekly Reports Functions\nfunction addWeeklyReport(report) {\n    tempWeeklyReports.push(report);\n}\nfunction findWeeklyReportsByUser(userId) {\n    return tempWeeklyReports.filter((report)=>report.userId === userId);\n}\nfunction findWeeklyReportByUserAndWeek(userId, weekStart) {\n    return tempWeeklyReports.find((report)=>report.userId === userId && report.weekStart.getTime() === weekStart.getTime());\n}\nfunction getAllWeeklyReports() {\n    return tempWeeklyReports;\n}\nfunction getWeeklyReportsByDateRange(startDate, endDate) {\n    return tempWeeklyReports.filter((report)=>report.weekStart >= startDate && report.weekEnd <= endDate);\n}\n// Date utility functions\nfunction getCurrentWeekStart() {\n    const now = new Date();\n    const monday = new Date(now);\n    const day = now.getDay();\n    const diff = now.getDate() - day + (day === 0 ? -6 : 1 // Adjust for Sunday\n    );\n    monday.setDate(diff);\n    monday.setHours(0, 0, 0, 0);\n    return monday;\n}\nfunction getCurrentWeekEnd() {\n    const weekStart = getCurrentWeekStart();\n    const weekEnd = new Date(weekStart);\n    weekEnd.setDate(weekStart.getDate() + 6);\n    weekEnd.setHours(23, 59, 59, 999);\n    return weekEnd;\n}\nfunction canSubmitThisWeek(userId) {\n    const weekStart = getCurrentWeekStart();\n    const weekEnd = getCurrentWeekEnd();\n    const currentDate = new Date();\n    const existingReport = findWeeklyReportByUserAndWeek(userId, weekStart);\n    // Can submit if:\n    // 1. We are currently in this week (currentDate is between weekStart and weekEnd)\n    // 2. No report exists for this week\n    const isCurrentWeek = currentDate >= weekStart && currentDate <= weekEnd;\n    console.log(`üîç Debug canSubmitThisWeek for user ${userId}:`);\n    console.log(`  Current date: ${currentDate.toISOString()}`);\n    console.log(`  Week start: ${weekStart.toISOString()}`);\n    console.log(`  Week end: ${weekEnd.toISOString()}`);\n    console.log(`  Is current week: ${isCurrentWeek}`);\n    console.log(`  Existing report: ${existingReport ? 'YES' : 'NO'}`);\n    console.log(`  Can submit: ${isCurrentWeek && !existingReport}`);\n    return isCurrentWeek && !existingReport;\n}\nfunction getWeekDates(date) {\n    const start = new Date(date);\n    const day = start.getDay();\n    const diff = start.getDate() - day + (day === 0 ? -6 : 1);\n    start.setDate(diff);\n    start.setHours(0, 0, 0, 0);\n    const end = new Date(start);\n    end.setDate(start.getDate() + 6);\n    end.setHours(23, 59, 59, 999);\n    return {\n        start,\n        end\n    };\n}\nfunction getMonthWeeks(year, month) {\n    const weeks = [];\n    const firstDay = new Date(year, month, 1);\n    const lastDay = new Date(year, month + 1, 0);\n    let current = new Date(firstDay);\n    // Adjust to start from Monday of first week\n    const dayOfWeek = current.getDay();\n    const daysToSubtract = dayOfWeek === 0 ? 6 : dayOfWeek - 1;\n    current.setDate(current.getDate() - daysToSubtract);\n    while(current <= lastDay){\n        const weekStart = new Date(current);\n        const weekEnd = new Date(current);\n        weekEnd.setDate(weekStart.getDate() + 6);\n        weeks.push({\n            start: weekStart,\n            end: weekEnd\n        });\n        current.setDate(current.getDate() + 7);\n    }\n    return weeks;\n}\n// ===== CALENDAR FUNCTIONS =====\n// These functions integrate with the calendar system for Sara AI\nfunction getEvents(userId) {\n    // Import calendar data functions\n    try {\n        const { getUserCalendarData } = __webpack_require__(/*! ./calendar-data */ \"(rsc)/./src/lib/calendar-data.ts\");\n        const userData = getUserCalendarData(userId);\n        return userData?.events || [];\n    } catch (error) {\n        console.error('Error getting calendar events:', error);\n        return [];\n    }\n}\nfunction getAllCalendarEvents(userId) {\n    // Alias for getEvents for compatibility\n    return getEvents(userId);\n}\nfunction getUpcomingEvents(userId, days = 30) {\n    try {\n        const allEvents = getEvents(userId);\n        const now = new Date();\n        const futureDate = new Date();\n        futureDate.setDate(futureDate.getDate() + days);\n        return allEvents.filter((event)=>{\n            const eventDate = new Date(event.date);\n            return eventDate >= now && eventDate <= futureDate;\n        }).sort((a, b)=>new Date(a.date).getTime() - new Date(b.date).getTime());\n    } catch (error) {\n        console.error('Error getting upcoming events:', error);\n        return [];\n    }\n}\nfunction getEventsForDateRange(userId, startDate, endDate) {\n    try {\n        const allEvents = getEvents(userId);\n        return allEvents.filter((event)=>{\n            const eventDate = new Date(event.date);\n            return eventDate >= startDate && eventDate <= endDate;\n        });\n    } catch (error) {\n        console.error('Error getting events for date range:', error);\n        return [];\n    }\n}\nfunction findEventById(userId, eventId) {\n    try {\n        const allEvents = getEvents(userId);\n        return allEvents.find((event)=>event.id === eventId) || null;\n    } catch (error) {\n        console.error('Error finding event by ID:', error);\n        return null;\n    }\n}\n// Global storage for conversations\nconst globalForConversations = globalThis;\nconst tempConversations = globalForConversations.tempConversations ?? [];\nglobalForConversations.tempConversations = tempConversations;\nfunction getConversationSession(userId, sessionId) {\n    return tempConversations.find((session)=>session.userId === userId && session.sessionId === sessionId) || null;\n}\nfunction createConversationSession(userId, sessionId) {\n    // First remove any old session for the same user/sessionId\n    const existingIndex = tempConversations.findIndex((session)=>session.userId === userId && session.sessionId === sessionId);\n    if (existingIndex !== -1) {\n        tempConversations.splice(existingIndex, 1);\n    }\n    const newSession = {\n        userId,\n        sessionId,\n        turns: [],\n        currentTopic: undefined,\n        currentSubject: undefined,\n        pendingTasks: [],\n        lastUpdate: new Date()\n    };\n    tempConversations.push(newSession);\n    console.log(`üí¨ Created conversation session ${sessionId} for user ${userId}`);\n    return newSession;\n}\nfunction updateConversationSession(session) {\n    const index = tempConversations.findIndex((s)=>s.userId === session.userId && s.sessionId === session.sessionId);\n    if (index !== -1) {\n        tempConversations[index] = {\n            ...session,\n            lastUpdate: new Date()\n        };\n        console.log(`üí¨ Updated session ${session.sessionId} - ${session.turns.length} turns`);\n    } else {\n        tempConversations.push({\n            ...session,\n            lastUpdate: new Date()\n        });\n        console.log(`üí¨ Created new session ${session.sessionId} during update`);\n    }\n    return session;\n}\nfunction addConversationTurn(userId, sessionId, role, content, metadata = {}) {\n    let session = getConversationSession(userId, sessionId);\n    if (!session) {\n        session = createConversationSession(userId, sessionId);\n    }\n    const turn = {\n        id: `turn_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,\n        timestamp: new Date(),\n        role,\n        content,\n        metadata\n    };\n    session.turns.push(turn);\n    // Keep only last 20 turns per session\n    if (session.turns.length > 20) {\n        session.turns = session.turns.slice(-20);\n    }\n    return updateConversationSession(session);\n}\nfunction addPendingTask(userId, sessionId, type, description, data) {\n    let session = getConversationSession(userId, sessionId);\n    if (!session) {\n        session = createConversationSession(userId, sessionId);\n    }\n    const task = {\n        id: `task_${Date.now()}`,\n        type,\n        description,\n        data,\n        completed: false,\n        createdAt: new Date()\n    };\n    session.pendingTasks.push(task);\n    console.log(`üìã Added pending task: ${description}`);\n    updateConversationSession(session);\n}\nfunction markTaskCompleted(userId, sessionId, taskId, result) {\n    const session = getConversationSession(userId, sessionId);\n    if (!session) return false;\n    const task = session.pendingTasks.find((t)=>t.id === taskId);\n    if (!task) return false;\n    task.completed = true;\n    if (result) {\n        task.data.result = result;\n    }\n    console.log(`‚úÖ Completed task: ${task.description}`);\n    updateConversationSession(session);\n    return true;\n}\nfunction getPendingTasks(userId, sessionId) {\n    const session = getConversationSession(userId, sessionId);\n    if (!session) return [];\n    return session.pendingTasks.filter((task)=>!task.completed);\n}\nfunction getConversationHistory(userId, sessionId, limit = 10) {\n    const session = getConversationSession(userId, sessionId);\n    if (!session) return [];\n    return session.turns.slice(-limit);\n}\nfunction getUserActiveSessions(userId) {\n    const oneHourAgo = new Date(Date.now() - 60 * 60 * 1000);\n    return tempConversations.filter((session)=>session.userId === userId && session.lastUpdate > oneHourAgo);\n}\nfunction cleanupOldConversations() {\n    const sixHoursAgo = new Date(Date.now() - 6 * 60 * 60 * 1000);\n    const before = tempConversations.length;\n    // Remove conversations older than 6 hours\n    for(let i = tempConversations.length - 1; i >= 0; i--){\n        if (tempConversations[i].lastUpdate < sixHoursAgo) {\n            tempConversations.splice(i, 1);\n        }\n    }\n    const after = tempConversations.length;\n    if (before !== after) {\n        console.log(`üßπ Cleaned up ${before - after} old conversation sessions`);\n    }\n}\n// Initialize default users automatically\n\nfunction initDefaultUsers() {\n    // Check if demo users already exist to avoid duplicates\n    const studentExists = findUserByEmail(\"estudiante@demo.com\");\n    const instructorExists = findUserByEmail(\"instructor@demo.com\");\n    if (!studentExists || !instructorExists) {\n        console.log(\"üîß Inicializando usuarios por defecto...\");\n        try {\n            const hashedPassword = bcryptjs__WEBPACK_IMPORTED_MODULE_0__[\"default\"].hashSync(\"Estudiante123!!!\", 12);\n            // Only add student if doesn't exist\n            if (!studentExists) {\n                addUser({\n                    id: \"demo-student-fixed\",\n                    name: \"Estudiante Demo\",\n                    email: \"estudiante@demo.com\",\n                    password: hashedPassword,\n                    role: \"STUDENT\",\n                    studentId: \"EST-2025-001\",\n                    status: \"ACTIVE\",\n                    enrollmentYear: 2025,\n                    academicYear: \"2025-2026\",\n                    program: \"Ingenier√≠a en Sistemas\",\n                    phoneNumber: \"+1234567890\",\n                    dateOfBirth: new Date(\"2000-01-01\"),\n                    address: \"Demo Address 123\",\n                    emergencyContact: {\n                        name: \"Contacto Demo\",\n                        phone: \"+0987654321\",\n                        relationship: \"Padre\"\n                    },\n                    createdAt: new Date(),\n                    updatedAt: new Date()\n                });\n                console.log(\"‚úÖ Usuario estudiante demo creado\");\n            }\n            // Only add instructor if doesn't exist\n            if (!instructorExists) {\n                addUser({\n                    id: \"demo-instructor-fixed\",\n                    name: \"Instructor Demo\",\n                    email: \"instructor@demo.com\",\n                    password: hashedPassword,\n                    role: \"INSTRUCTOR\",\n                    studentId: null,\n                    status: \"ACTIVE\",\n                    enrollmentYear: 2025,\n                    academicYear: \"2025-2026\",\n                    createdAt: new Date(),\n                    updatedAt: new Date()\n                });\n                console.log(\"‚úÖ Usuario instructor demo creado\");\n            }\n            console.log(\"‚úÖ Verificaci√≥n de usuarios por defecto completada\");\n        } catch (error) {\n            console.error(\"‚ùå Error creando usuarios por defecto:\", error);\n        }\n    } else {\n        console.log(\"‚úÖ Usuarios demo ya existen, no se reinicializan\");\n    }\n    // Always check and initialize sample reports\n    initSampleReports();\n}\nfunction initSampleReports() {\n    // Check if sample reports already exist for demo student\n    const existingSampleReports = tempWeeklyReports.filter((report)=>report.userId === \"demo-student-fixed\");\n    if (existingSampleReports.length === 0) {\n        console.log(\"üìù Inicializando reportes de muestra...\");\n        try {\n            // Get current week dates\n            const now = new Date();\n            const currentWeek = getCurrentWeekStart();\n            const currentWeekEnd = getCurrentWeekEnd();\n            // Previous week\n            const prevWeek = new Date(currentWeek);\n            prevWeek.setDate(prevWeek.getDate() - 7);\n            const prevWeekEnd = new Date(currentWeekEnd);\n            prevWeekEnd.setDate(prevWeekEnd.getDate() - 7);\n            // Sample report from previous week\n            addWeeklyReport({\n                id: \"sample-report-1\",\n                userId: \"demo-student-fixed\",\n                weekStart: prevWeek,\n                weekEnd: prevWeekEnd,\n                submittedAt: new Date(prevWeekEnd.getTime() - 24 * 60 * 60 * 1000),\n                responses: {\n                    temasYDominio: \"Esta semana trabajamos con JavaScript b√°sico - Nivel 3: Domino funciones y arrays, y estoy aprendiendo objetos complejos.\",\n                    evidenciaAprendizaje: \"Complet√© un proyecto de To-Do List usando JavaScript vanilla. Implement√© funciones para agregar, editar y eliminar tareas usando arrays y objetos.\",\n                    dificultadesEstrategias: \"Tuve dificultades con el manejo de eventos en JavaScript. Lo resolv√≠ practicando con ejemplos y consultando documentaci√≥n de MDN.\",\n                    conexionesAplicacion: \"Los conceptos de eventos se conectan con la interactividad en aplicaciones web. Puedo aplicarlo para crear interfaces m√°s din√°micas.\",\n                    comentariosAdicionales: \"Me siento m√°s confiado con JavaScript. Quiero seguir practicando con proyectos m√°s complejos.\"\n                }\n            });\n            // Two weeks ago report  \n            const twoWeeksAgo = new Date(currentWeek);\n            twoWeeksAgo.setDate(twoWeeksAgo.getDate() - 14);\n            const twoWeeksAgoEnd = new Date(currentWeekEnd);\n            twoWeeksAgoEnd.setDate(twoWeeksAgoEnd.getDate() - 14);\n            addWeeklyReport({\n                id: \"sample-report-2\",\n                userId: \"demo-student-fixed\",\n                weekStart: twoWeeksAgo,\n                weekEnd: twoWeeksAgoEnd,\n                submittedAt: new Date(twoWeeksAgoEnd.getTime() - 12 * 60 * 60 * 1000),\n                responses: {\n                    temasYDominio: \"Esta semana estudiamos CSS Grid y Flexbox - Nivel 2: Entiendo los conceptos b√°sicos pero a√∫n tengo dudas con layouts complejos.\",\n                    evidenciaAprendizaje: \"Recre√© el layout de una p√°gina web usando CSS Grid. Logr√© hacer una estructura responsive con header, sidebar y main content.\",\n                    dificultadesEstrategias: \"Me confund√≠ con las propiedades grid-template-areas. Resolv√≠ el problema dibujando el layout en papel primero.\",\n                    conexionesAplicacion: \"CSS Grid es perfecto para crear layouts de p√°ginas web modernas. Lo usar√© en mi proyecto final de p√°gina portfolio.\",\n                    comentariosAdicionales: \"CSS es m√°s divertido de lo que pensaba. Me gusta ver los resultados visuales inmediatos.\"\n                }\n            });\n            console.log(\"‚úÖ Reportes de muestra creados exitosamente\");\n        } catch (error) {\n            console.error(\"‚ùå Error creando reportes de muestra:\", error);\n        }\n    } else {\n        console.log(\"‚úÖ Reportes de muestra ya existen, no se reinicializan\");\n    }\n}\n// Initialize on module load\ninitDefaultUsers();\n// Start conversation cleanup interval\nsetInterval(cleanupOldConversations, 30 * 60 * 1000) // Every 30 minutes\n;\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QixNQUFNQyxjQUFjLElBQUk3SixLQUFLa0o7WUFDN0JXLFlBQVlySCxPQUFPLENBQUNxSCxZQUFZdEgsT0FBTyxLQUFLO1lBQzVDLE1BQU11SCxpQkFBaUIsSUFBSTlKLEtBQUttSjtZQUNoQ1csZUFBZXRILE9BQU8sQ0FBQ3NILGVBQWV2SCxPQUFPLEtBQUs7WUFFbERsQixnQkFBZ0I7Z0JBQ2RuQyxJQUFJO2dCQUNKc0MsUUFBUTtnQkFDUkUsV0FBV21JO2dCQUNYN0gsU0FBUzhIO2dCQUNUUixhQUFhLElBQUl0SixLQUFLOEosZUFBZW5JLE9BQU8sS0FBSyxLQUFLLEtBQUssS0FBSztnQkFDaEU0SCxXQUFXO29CQUNUQyxlQUFlO29CQUNmQyxzQkFBc0I7b0JBQ3RCQyx5QkFBeUI7b0JBQ3pCQyxzQkFBc0I7b0JBQ3RCQyx3QkFBd0I7Z0JBQzFCO1lBQ0Y7WUFFQTdHLFFBQVFDLEdBQUcsQ0FBQztRQUNkLEVBQUUsT0FBT29CLE9BQU87WUFDZHJCLFFBQVFxQixLQUFLLENBQUMsd0NBQXdDQTtRQUN4RDtJQUNGLE9BQU87UUFDTHJCLFFBQVFDLEdBQUcsQ0FBQztJQUNkO0FBQ0Y7QUFFQSw0QkFBNEI7QUFDNUJpRjtBQUVBLHNDQUFzQztBQUN0QzhCLFlBQVlwQyx5QkFBeUIsS0FBSyxLQUFLLE1BQU0sbUJBQW1CIiwic291cmNlcyI6WyIvVXNlcnMvcm9kcmlnb2RpYmVybmFyZG8zM2dtYWlsLmNvbS9Eb2N1bWVudHMvQXBwIERldmVsb3BtZW50IFByb3llY3RzL0ludGVsbGVnbyBQbGF0Zm9ybS9zcmMvbGliL3RlbXAtc3RvcmFnZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBUZW1wb3JhcnkgdXNlciBzdG9yYWdlIC0gcmVwbGFjZSB3aXRoIGRhdGFiYXNlIGxhdGVyXG5pbnRlcmZhY2UgVGVtcFVzZXIge1xuICBpZDogc3RyaW5nXG4gIG5hbWU6IHN0cmluZ1xuICBlbWFpbDogc3RyaW5nXG4gIHBhc3N3b3JkOiBzdHJpbmdcbiAgc3R1ZGVudElkPzogc3RyaW5nIHwgbnVsbFxuICByb2xlOiBzdHJpbmdcbiAgY3JlYXRlZEF0OiBEYXRlXG4gIHVwZGF0ZWRBdDogRGF0ZVxuICBpbWFnZT86IHN0cmluZ1xuICAvLyBBY2FkZW1pYyBmaWVsZHNcbiAgcHJvZ3JhbT86IHN0cmluZyAvLyBDYXJyZXJhL3Byb2dyYW1hIGRlIGVzdHVkaW9zXG4gIGFjYWRlbWljWWVhcj86IHN0cmluZyAvLyBBw7FvIGFjYWTDqW1pY28gKGVqOiBcIjIwMjQtMjAyNVwiKVxuICBlbnJvbGxtZW50WWVhcj86IG51bWJlciAvLyBBw7FvIGRlIGluZ3Jlc29cbiAgc3RhdHVzPzogXCJBQ1RJVkVcIiB8IFwiSU5BQ1RJVkVcIiB8IFwiU1VTUEVOREVEXCIgLy8gRXN0YWRvIGRlbCBlc3R1ZGlhbnRlXG4gIHBob25lTnVtYmVyPzogc3RyaW5nXG4gIGRhdGVPZkJpcnRoPzogRGF0ZVxuICBhZGRyZXNzPzogc3RyaW5nXG4gIGVtZXJnZW5jeUNvbnRhY3Q/OiB7XG4gICAgbmFtZTogc3RyaW5nXG4gICAgcGhvbmU6IHN0cmluZ1xuICAgIHJlbGF0aW9uc2hpcDogc3RyaW5nXG4gIH1cbiAgcHJlZmVyZW5jZXM/OiB7XG4gICAgZW1haWxOb3RpZmljYXRpb25zOiBib29sZWFuXG4gICAgcHVzaE5vdGlmaWNhdGlvbnM6IGJvb2xlYW5cbiAgICB3ZWVrbHlSZW1pbmRlcnM6IGJvb2xlYW5cbiAgICBwcm9ncmVzc1JlcG9ydHM6IGJvb2xlYW5cbiAgfVxufVxuXG5pbnRlcmZhY2UgQXR0YWNoZWRGaWxlIHtcbiAgZmlsZW5hbWU6IHN0cmluZ1xuICBvcmlnaW5hbE5hbWU6IHN0cmluZ1xuICBzaXplOiBudW1iZXJcbiAgdHlwZTogc3RyaW5nXG4gIHVybDogc3RyaW5nXG59XG5cbmludGVyZmFjZSBXZWVrbHlSZXBvcnQge1xuICBpZDogc3RyaW5nXG4gIHVzZXJJZDogc3RyaW5nXG4gIHdlZWtTdGFydDogRGF0ZVxuICB3ZWVrRW5kOiBEYXRlXG4gIHN1Ym1pdHRlZEF0OiBEYXRlXG4gIHJlc3BvbnNlczoge1xuICAgIHRlbWFzWURvbWluaW86IHN0cmluZyAvLyBQcmVndW50YSAxXG4gICAgZXZpZGVuY2lhQXByZW5kaXphamU6IHN0cmluZyAvLyBQcmVndW50YSAyXG4gICAgZGlmaWN1bHRhZGVzRXN0cmF0ZWdpYXM6IHN0cmluZyAvLyBQcmVndW50YSAzXG4gICAgY29uZXhpb25lc0FwbGljYWNpb246IHN0cmluZyAvLyBQcmVndW50YSA0XG4gICAgY29tZW50YXJpb3NBZGljaW9uYWxlcz86IHN0cmluZyAvLyBQcmVndW50YSA1IChvcGNpb25hbClcbiAgfVxuICBhdHRhY2htZW50cz86IEF0dGFjaGVkRmlsZVtdIC8vIEFyY2hpdm9zIGFkanVudG9zXG59XG5cbi8vIFNpbmdsZXRvbiBwYXR0ZXJuIHRvIHBlcnNpc3QgZGF0YSBhY3Jvc3MgcmVxdWVzdHNcbmNvbnN0IGdsb2JhbEZvclN0b3JhZ2UgPSBnbG9iYWxUaGlzIGFzIHVua25vd24gYXMge1xuICB0ZW1wVXNlcnM6IFRlbXBVc2VyW10gfCB1bmRlZmluZWRcbiAgdGVtcFdlZWtseVJlcG9ydHM6IFdlZWtseVJlcG9ydFtdIHwgdW5kZWZpbmVkXG59XG5cbmV4cG9ydCBjb25zdCB0ZW1wVXNlcnM6IFRlbXBVc2VyW10gPSBnbG9iYWxGb3JTdG9yYWdlLnRlbXBVc2VycyA/PyBbXVxuZXhwb3J0IGNvbnN0IHRlbXBXZWVrbHlSZXBvcnRzOiBXZWVrbHlSZXBvcnRbXSA9IGdsb2JhbEZvclN0b3JhZ2UudGVtcFdlZWtseVJlcG9ydHMgPz8gW11cblxuLy8gQXNzaWduIHRvIGdsb2JhbFRoaXMgdG8gcGVyc2lzdCBhY3Jvc3MgcmVxdWVzdHNcbmdsb2JhbEZvclN0b3JhZ2UudGVtcFVzZXJzID0gdGVtcFVzZXJzXG5nbG9iYWxGb3JTdG9yYWdlLnRlbXBXZWVrbHlSZXBvcnRzID0gdGVtcFdlZWtseVJlcG9ydHNcblxuZXhwb3J0IGZ1bmN0aW9uIGFkZFVzZXIodXNlcjogVGVtcFVzZXIpIHtcbiAgdGVtcFVzZXJzLnB1c2godXNlcilcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGZpbmRVc2VyQnlFbWFpbChlbWFpbDogc3RyaW5nKSB7XG4gIHJldHVybiB0ZW1wVXNlcnMuZmluZCh1c2VyID0+IHVzZXIuZW1haWwgPT09IGVtYWlsKVxufVxuXG5leHBvcnQgZnVuY3Rpb24gZmluZFVzZXJCeVN0dWRlbnRJZChzdHVkZW50SWQ6IHN0cmluZykge1xuICByZXR1cm4gdGVtcFVzZXJzLmZpbmQodXNlciA9PiB1c2VyLnN0dWRlbnRJZCA9PT0gc3R1ZGVudElkKVxufVxuXG5leHBvcnQgZnVuY3Rpb24gZmluZFVzZXJCeUlkKGlkOiBzdHJpbmcpIHtcbiAgcmV0dXJuIHRlbXBVc2Vycy5maW5kKHVzZXIgPT4gdXNlci5pZCA9PT0gaWQpXG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRBbGxVc2VycygpIHtcbiAgcmV0dXJuIHRlbXBVc2Vyc1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZmluZFVzZXJzQnlSb2xlKHJvbGU6IHN0cmluZykge1xuICByZXR1cm4gdGVtcFVzZXJzLmZpbHRlcih1c2VyID0+IHVzZXIucm9sZSA9PT0gcm9sZSlcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGZpbmRVc2Vyc0J5UHJvZ3JhbShwcm9ncmFtOiBzdHJpbmcpIHtcbiAgcmV0dXJuIHRlbXBVc2Vycy5maWx0ZXIodXNlciA9PiB1c2VyLnByb2dyYW0gPT09IHByb2dyYW0pXG59XG5cbmV4cG9ydCBmdW5jdGlvbiBmaW5kVXNlcnNCeVN0YXR1cyhzdGF0dXM6IFwiQUNUSVZFXCIgfCBcIklOQUNUSVZFXCIgfCBcIlNVU1BFTkRFRFwiKSB7XG4gIHJldHVybiB0ZW1wVXNlcnMuZmlsdGVyKHVzZXIgPT4gdXNlci5zdGF0dXMgPT09IHN0YXR1cylcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHVwZGF0ZVVzZXIoaWQ6IHN0cmluZywgdXBkYXRlczogUGFydGlhbDxUZW1wVXNlcj4pIHtcbiAgY29uc3QgdXNlckluZGV4ID0gdGVtcFVzZXJzLmZpbmRJbmRleCh1c2VyID0+IHVzZXIuaWQgPT09IGlkKVxuICBpZiAodXNlckluZGV4ICE9PSAtMSkge1xuICAgIHRlbXBVc2Vyc1t1c2VySW5kZXhdID0ge1xuICAgICAgLi4udGVtcFVzZXJzW3VzZXJJbmRleF0sXG4gICAgICAuLi51cGRhdGVzLFxuICAgICAgdXBkYXRlZEF0OiBuZXcgRGF0ZSgpXG4gICAgfVxuICAgIHJldHVybiB0ZW1wVXNlcnNbdXNlckluZGV4XVxuICB9XG4gIHJldHVybiBudWxsXG59XG5cbmV4cG9ydCBmdW5jdGlvbiBkZWxldGVVc2VyKGlkOiBzdHJpbmcpIHtcbiAgY29uc3QgdXNlckluZGV4ID0gdGVtcFVzZXJzLmZpbmRJbmRleCh1c2VyID0+IHVzZXIuaWQgPT09IGlkKVxuICBpZiAodXNlckluZGV4ICE9PSAtMSkge1xuICAgIHJldHVybiB0ZW1wVXNlcnMuc3BsaWNlKHVzZXJJbmRleCwgMSlbMF1cbiAgfVxuICByZXR1cm4gbnVsbFxufVxuXG5leHBvcnQgZnVuY3Rpb24gdmFsaWRhdGVTdHVkZW50SWQoc3R1ZGVudElkOiBzdHJpbmcpOiBib29sZWFuIHtcbiAgLy8gRm9ybWF0byBzdWdlcmlkbzogRVNULVlZWVktWFhYIChlajogRVNULTIwMjQtMDAxKVxuICBjb25zdCBzdHVkZW50SWRSZWdleCA9IC9eRVNULVxcZHs0fS1cXGR7M30kL1xuICByZXR1cm4gc3R1ZGVudElkUmVnZXgudGVzdChzdHVkZW50SWQpXG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZW5lcmF0ZVN0dWRlbnRJZCgpOiBzdHJpbmcge1xuICBjb25zdCBjdXJyZW50WWVhciA9IG5ldyBEYXRlKCkuZ2V0RnVsbFllYXIoKVxuICBjb25zdCBleGlzdGluZ0lkcyA9IHRlbXBVc2Vyc1xuICAgIC5maWx0ZXIodXNlciA9PiB1c2VyLnN0dWRlbnRJZCAmJiB1c2VyLnN0dWRlbnRJZC5zdGFydHNXaXRoKGBFU1QtJHtjdXJyZW50WWVhcn1gKSlcbiAgICAubWFwKHVzZXIgPT4gdXNlci5zdHVkZW50SWQhKVxuICAgIC5zb3J0KClcblxuICBsZXQgbmV4dE51bWJlciA9IDFcbiAgaWYgKGV4aXN0aW5nSWRzLmxlbmd0aCA+IDApIHtcbiAgICBjb25zdCBsYXN0SWQgPSBleGlzdGluZ0lkc1tleGlzdGluZ0lkcy5sZW5ndGggLSAxXVxuICAgIGNvbnN0IGxhc3ROdW1iZXIgPSBwYXJzZUludChsYXN0SWQuc3BsaXQoJy0nKVsyXSlcbiAgICBuZXh0TnVtYmVyID0gbGFzdE51bWJlciArIDFcbiAgfVxuXG4gIHJldHVybiBgRVNULSR7Y3VycmVudFllYXJ9LSR7bmV4dE51bWJlci50b1N0cmluZygpLnBhZFN0YXJ0KDMsICcwJyl9YFxufVxuXG4vLyBXZWVrbHkgUmVwb3J0cyBGdW5jdGlvbnNcbmV4cG9ydCBmdW5jdGlvbiBhZGRXZWVrbHlSZXBvcnQocmVwb3J0OiBXZWVrbHlSZXBvcnQpIHtcbiAgdGVtcFdlZWtseVJlcG9ydHMucHVzaChyZXBvcnQpXG59XG5cbmV4cG9ydCBmdW5jdGlvbiBmaW5kV2Vla2x5UmVwb3J0c0J5VXNlcih1c2VySWQ6IHN0cmluZyk6IFdlZWtseVJlcG9ydFtdIHtcbiAgcmV0dXJuIHRlbXBXZWVrbHlSZXBvcnRzLmZpbHRlcihyZXBvcnQgPT4gcmVwb3J0LnVzZXJJZCA9PT0gdXNlcklkKVxufVxuXG5leHBvcnQgZnVuY3Rpb24gZmluZFdlZWtseVJlcG9ydEJ5VXNlckFuZFdlZWsodXNlcklkOiBzdHJpbmcsIHdlZWtTdGFydDogRGF0ZSk6IFdlZWtseVJlcG9ydCB8IHVuZGVmaW5lZCB7XG4gIHJldHVybiB0ZW1wV2Vla2x5UmVwb3J0cy5maW5kKHJlcG9ydCA9PiBcbiAgICByZXBvcnQudXNlcklkID09PSB1c2VySWQgJiYgXG4gICAgcmVwb3J0LndlZWtTdGFydC5nZXRUaW1lKCkgPT09IHdlZWtTdGFydC5nZXRUaW1lKClcbiAgKVxufVxuXG5leHBvcnQgZnVuY3Rpb24gZ2V0QWxsV2Vla2x5UmVwb3J0cygpOiBXZWVrbHlSZXBvcnRbXSB7XG4gIHJldHVybiB0ZW1wV2Vla2x5UmVwb3J0c1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZ2V0V2Vla2x5UmVwb3J0c0J5RGF0ZVJhbmdlKHN0YXJ0RGF0ZTogRGF0ZSwgZW5kRGF0ZTogRGF0ZSk6IFdlZWtseVJlcG9ydFtdIHtcbiAgcmV0dXJuIHRlbXBXZWVrbHlSZXBvcnRzLmZpbHRlcihyZXBvcnQgPT4gXG4gICAgcmVwb3J0LndlZWtTdGFydCA+PSBzdGFydERhdGUgJiYgcmVwb3J0LndlZWtFbmQgPD0gZW5kRGF0ZVxuICApXG59XG5cbi8vIERhdGUgdXRpbGl0eSBmdW5jdGlvbnNcbmV4cG9ydCBmdW5jdGlvbiBnZXRDdXJyZW50V2Vla1N0YXJ0KCk6IERhdGUge1xuICBjb25zdCBub3cgPSBuZXcgRGF0ZSgpXG4gIGNvbnN0IG1vbmRheSA9IG5ldyBEYXRlKG5vdylcbiAgY29uc3QgZGF5ID0gbm93LmdldERheSgpXG4gIGNvbnN0IGRpZmYgPSBub3cuZ2V0RGF0ZSgpIC0gZGF5ICsgKGRheSA9PT0gMCA/IC02IDogMSkgLy8gQWRqdXN0IGZvciBTdW5kYXlcbiAgbW9uZGF5LnNldERhdGUoZGlmZilcbiAgbW9uZGF5LnNldEhvdXJzKDAsIDAsIDAsIDApXG4gIHJldHVybiBtb25kYXlcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGdldEN1cnJlbnRXZWVrRW5kKCk6IERhdGUge1xuICBjb25zdCB3ZWVrU3RhcnQgPSBnZXRDdXJyZW50V2Vla1N0YXJ0KClcbiAgY29uc3Qgd2Vla0VuZCA9IG5ldyBEYXRlKHdlZWtTdGFydClcbiAgd2Vla0VuZC5zZXREYXRlKHdlZWtTdGFydC5nZXREYXRlKCkgKyA2KVxuICB3ZWVrRW5kLnNldEhvdXJzKDIzLCA1OSwgNTksIDk5OSlcbiAgcmV0dXJuIHdlZWtFbmRcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGNhblN1Ym1pdFRoaXNXZWVrKHVzZXJJZDogc3RyaW5nKTogYm9vbGVhbiB7XG4gIGNvbnN0IHdlZWtTdGFydCA9IGdldEN1cnJlbnRXZWVrU3RhcnQoKVxuICBjb25zdCB3ZWVrRW5kID0gZ2V0Q3VycmVudFdlZWtFbmQoKVxuICBjb25zdCBjdXJyZW50RGF0ZSA9IG5ldyBEYXRlKClcbiAgY29uc3QgZXhpc3RpbmdSZXBvcnQgPSBmaW5kV2Vla2x5UmVwb3J0QnlVc2VyQW5kV2Vlayh1c2VySWQsIHdlZWtTdGFydClcbiAgXG4gIC8vIENhbiBzdWJtaXQgaWY6XG4gIC8vIDEuIFdlIGFyZSBjdXJyZW50bHkgaW4gdGhpcyB3ZWVrIChjdXJyZW50RGF0ZSBpcyBiZXR3ZWVuIHdlZWtTdGFydCBhbmQgd2Vla0VuZClcbiAgLy8gMi4gTm8gcmVwb3J0IGV4aXN0cyBmb3IgdGhpcyB3ZWVrXG4gIGNvbnN0IGlzQ3VycmVudFdlZWsgPSBjdXJyZW50RGF0ZSA+PSB3ZWVrU3RhcnQgJiYgY3VycmVudERhdGUgPD0gd2Vla0VuZFxuICBcbiAgY29uc29sZS5sb2coYPCflI0gRGVidWcgY2FuU3VibWl0VGhpc1dlZWsgZm9yIHVzZXIgJHt1c2VySWR9OmApXG4gIGNvbnNvbGUubG9nKGAgIEN1cnJlbnQgZGF0ZTogJHtjdXJyZW50RGF0ZS50b0lTT1N0cmluZygpfWApXG4gIGNvbnNvbGUubG9nKGAgIFdlZWsgc3RhcnQ6ICR7d2Vla1N0YXJ0LnRvSVNPU3RyaW5nKCl9YClcbiAgY29uc29sZS5sb2coYCAgV2VlayBlbmQ6ICR7d2Vla0VuZC50b0lTT1N0cmluZygpfWApXG4gIGNvbnNvbGUubG9nKGAgIElzIGN1cnJlbnQgd2VlazogJHtpc0N1cnJlbnRXZWVrfWApXG4gIGNvbnNvbGUubG9nKGAgIEV4aXN0aW5nIHJlcG9ydDogJHtleGlzdGluZ1JlcG9ydCA/ICdZRVMnIDogJ05PJ31gKVxuICBjb25zb2xlLmxvZyhgICBDYW4gc3VibWl0OiAke2lzQ3VycmVudFdlZWsgJiYgIWV4aXN0aW5nUmVwb3J0fWApXG4gIFxuICByZXR1cm4gaXNDdXJyZW50V2VlayAmJiAhZXhpc3RpbmdSZXBvcnRcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGdldFdlZWtEYXRlcyhkYXRlOiBEYXRlKTogeyBzdGFydDogRGF0ZTsgZW5kOiBEYXRlIH0ge1xuICBjb25zdCBzdGFydCA9IG5ldyBEYXRlKGRhdGUpXG4gIGNvbnN0IGRheSA9IHN0YXJ0LmdldERheSgpXG4gIGNvbnN0IGRpZmYgPSBzdGFydC5nZXREYXRlKCkgLSBkYXkgKyAoZGF5ID09PSAwID8gLTYgOiAxKVxuICBzdGFydC5zZXREYXRlKGRpZmYpXG4gIHN0YXJ0LnNldEhvdXJzKDAsIDAsIDAsIDApXG4gIFxuICBjb25zdCBlbmQgPSBuZXcgRGF0ZShzdGFydClcbiAgZW5kLnNldERhdGUoc3RhcnQuZ2V0RGF0ZSgpICsgNilcbiAgZW5kLnNldEhvdXJzKDIzLCA1OSwgNTksIDk5OSlcbiAgXG4gIHJldHVybiB7IHN0YXJ0LCBlbmQgfVxufVxuXG5leHBvcnQgZnVuY3Rpb24gZ2V0TW9udGhXZWVrcyh5ZWFyOiBudW1iZXIsIG1vbnRoOiBudW1iZXIpOiBBcnJheTx7IHN0YXJ0OiBEYXRlOyBlbmQ6IERhdGUgfT4ge1xuICBjb25zdCB3ZWVrcyA9IFtdXG4gIGNvbnN0IGZpcnN0RGF5ID0gbmV3IERhdGUoeWVhciwgbW9udGgsIDEpXG4gIGNvbnN0IGxhc3REYXkgPSBuZXcgRGF0ZSh5ZWFyLCBtb250aCArIDEsIDApXG4gIFxuICBsZXQgY3VycmVudCA9IG5ldyBEYXRlKGZpcnN0RGF5KVxuICBcbiAgLy8gQWRqdXN0IHRvIHN0YXJ0IGZyb20gTW9uZGF5IG9mIGZpcnN0IHdlZWtcbiAgY29uc3QgZGF5T2ZXZWVrID0gY3VycmVudC5nZXREYXkoKVxuICBjb25zdCBkYXlzVG9TdWJ0cmFjdCA9IGRheU9mV2VlayA9PT0gMCA/IDYgOiBkYXlPZldlZWsgLSAxXG4gIGN1cnJlbnQuc2V0RGF0ZShjdXJyZW50LmdldERhdGUoKSAtIGRheXNUb1N1YnRyYWN0KVxuICBcbiAgd2hpbGUgKGN1cnJlbnQgPD0gbGFzdERheSkge1xuICAgIGNvbnN0IHdlZWtTdGFydCA9IG5ldyBEYXRlKGN1cnJlbnQpXG4gICAgY29uc3Qgd2Vla0VuZCA9IG5ldyBEYXRlKGN1cnJlbnQpXG4gICAgd2Vla0VuZC5zZXREYXRlKHdlZWtTdGFydC5nZXREYXRlKCkgKyA2KVxuICAgIFxuICAgIHdlZWtzLnB1c2goeyBzdGFydDogd2Vla1N0YXJ0LCBlbmQ6IHdlZWtFbmQgfSlcbiAgICBjdXJyZW50LnNldERhdGUoY3VycmVudC5nZXREYXRlKCkgKyA3KVxuICB9XG4gIFxuICByZXR1cm4gd2Vla3Ncbn1cblxuLy8gPT09PT0gQ0FMRU5EQVIgRlVOQ1RJT05TID09PT09XG4vLyBUaGVzZSBmdW5jdGlvbnMgaW50ZWdyYXRlIHdpdGggdGhlIGNhbGVuZGFyIHN5c3RlbSBmb3IgU2FyYSBBSVxuXG5leHBvcnQgZnVuY3Rpb24gZ2V0RXZlbnRzKHVzZXJJZDogc3RyaW5nKTogYW55W10ge1xuICAvLyBJbXBvcnQgY2FsZW5kYXIgZGF0YSBmdW5jdGlvbnNcbiAgdHJ5IHtcbiAgICBjb25zdCB7IGdldFVzZXJDYWxlbmRhckRhdGEgfSA9IHJlcXVpcmUoJy4vY2FsZW5kYXItZGF0YScpXG4gICAgY29uc3QgdXNlckRhdGEgPSBnZXRVc2VyQ2FsZW5kYXJEYXRhKHVzZXJJZClcbiAgICByZXR1cm4gdXNlckRhdGE/LmV2ZW50cyB8fCBbXVxuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGdldHRpbmcgY2FsZW5kYXIgZXZlbnRzOicsIGVycm9yKVxuICAgIHJldHVybiBbXVxuICB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRBbGxDYWxlbmRhckV2ZW50cyh1c2VySWQ6IHN0cmluZyk6IGFueVtdIHtcbiAgLy8gQWxpYXMgZm9yIGdldEV2ZW50cyBmb3IgY29tcGF0aWJpbGl0eVxuICByZXR1cm4gZ2V0RXZlbnRzKHVzZXJJZClcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGdldFVwY29taW5nRXZlbnRzKHVzZXJJZDogc3RyaW5nLCBkYXlzOiBudW1iZXIgPSAzMCk6IGFueVtdIHtcbiAgdHJ5IHtcbiAgICBjb25zdCBhbGxFdmVudHMgPSBnZXRFdmVudHModXNlcklkKVxuICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKClcbiAgICBjb25zdCBmdXR1cmVEYXRlID0gbmV3IERhdGUoKVxuICAgIGZ1dHVyZURhdGUuc2V0RGF0ZShmdXR1cmVEYXRlLmdldERhdGUoKSArIGRheXMpXG4gICAgXG4gICAgcmV0dXJuIGFsbEV2ZW50cy5maWx0ZXIoZXZlbnQgPT4ge1xuICAgICAgY29uc3QgZXZlbnREYXRlID0gbmV3IERhdGUoZXZlbnQuZGF0ZSlcbiAgICAgIHJldHVybiBldmVudERhdGUgPj0gbm93ICYmIGV2ZW50RGF0ZSA8PSBmdXR1cmVEYXRlXG4gICAgfSkuc29ydCgoYSwgYikgPT4gbmV3IERhdGUoYS5kYXRlKS5nZXRUaW1lKCkgLSBuZXcgRGF0ZShiLmRhdGUpLmdldFRpbWUoKSlcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBnZXR0aW5nIHVwY29taW5nIGV2ZW50czonLCBlcnJvcilcbiAgICByZXR1cm4gW11cbiAgfVxufVxuXG5leHBvcnQgZnVuY3Rpb24gZ2V0RXZlbnRzRm9yRGF0ZVJhbmdlKHVzZXJJZDogc3RyaW5nLCBzdGFydERhdGU6IERhdGUsIGVuZERhdGU6IERhdGUpOiBhbnlbXSB7XG4gIHRyeSB7XG4gICAgY29uc3QgYWxsRXZlbnRzID0gZ2V0RXZlbnRzKHVzZXJJZClcbiAgICByZXR1cm4gYWxsRXZlbnRzLmZpbHRlcihldmVudCA9PiB7XG4gICAgICBjb25zdCBldmVudERhdGUgPSBuZXcgRGF0ZShldmVudC5kYXRlKVxuICAgICAgcmV0dXJuIGV2ZW50RGF0ZSA+PSBzdGFydERhdGUgJiYgZXZlbnREYXRlIDw9IGVuZERhdGVcbiAgICB9KVxuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGdldHRpbmcgZXZlbnRzIGZvciBkYXRlIHJhbmdlOicsIGVycm9yKVxuICAgIHJldHVybiBbXVxuICB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBmaW5kRXZlbnRCeUlkKHVzZXJJZDogc3RyaW5nLCBldmVudElkOiBzdHJpbmcpOiBhbnkgfCBudWxsIHtcbiAgdHJ5IHtcbiAgICBjb25zdCBhbGxFdmVudHMgPSBnZXRFdmVudHModXNlcklkKVxuICAgIHJldHVybiBhbGxFdmVudHMuZmluZChldmVudCA9PiBldmVudC5pZCA9PT0gZXZlbnRJZCkgfHwgbnVsbFxuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGZpbmRpbmcgZXZlbnQgYnkgSUQ6JywgZXJyb3IpXG4gICAgcmV0dXJuIG51bGxcbiAgfVxufVxuXG4vLyA9PT09PSBDT05WRVJTQVRJT04gTUVNT1JZIEZVTkNUSU9OUyA9PT09PVxuLy8gUGVyc2lzdGVudCBjb252ZXJzYXRpb24gc3RvcmFnZSBmb3IgU2FyYSBBSVxuXG5pbnRlcmZhY2UgQ29udmVyc2F0aW9uVHVybiB7XG4gIGlkOiBzdHJpbmdcbiAgdGltZXN0YW1wOiBEYXRlXG4gIHJvbGU6ICd1c2VyJyB8ICdhc3Npc3RhbnQnXG4gIGNvbnRlbnQ6IHN0cmluZ1xuICBtZXRhZGF0YToge1xuICAgIHN1YmplY3Q/OiBzdHJpbmdcbiAgICB0b3BpYz86IHN0cmluZ1xuICAgIGludGVudGlvbj86IHN0cmluZ1xuICAgIHRhc2tDb21wbGV0ZWQ/OiBib29sZWFuXG4gICAgZXZlbnRDcmVhdGVkPzogYm9vbGVhblxuICB9XG59XG5cbmludGVyZmFjZSBDb252ZXJzYXRpb25TZXNzaW9uIHtcbiAgdXNlcklkOiBzdHJpbmdcbiAgc2Vzc2lvbklkOiBzdHJpbmdcbiAgdHVybnM6IENvbnZlcnNhdGlvblR1cm5bXVxuICBjdXJyZW50VG9waWM/OiBzdHJpbmdcbiAgY3VycmVudFN1YmplY3Q/OiBzdHJpbmdcbiAgcGVuZGluZ1Rhc2tzOiBBcnJheTx7XG4gICAgaWQ6IHN0cmluZ1xuICAgIHR5cGU6ICdjYWxlbmRhcl9ldmVudCcgfCAnYWNhZGVtaWNfc2VhcmNoJyB8ICdyZW1pbmRlcidcbiAgICBkZXNjcmlwdGlvbjogc3RyaW5nXG4gICAgZGF0YTogYW55XG4gICAgY29tcGxldGVkOiBib29sZWFuXG4gICAgY3JlYXRlZEF0OiBEYXRlXG4gIH0+XG4gIGxhc3RVcGRhdGU6IERhdGVcbn1cblxuLy8gR2xvYmFsIHN0b3JhZ2UgZm9yIGNvbnZlcnNhdGlvbnNcbmNvbnN0IGdsb2JhbEZvckNvbnZlcnNhdGlvbnMgPSBnbG9iYWxUaGlzIGFzIHVua25vd24gYXMge1xuICB0ZW1wQ29udmVyc2F0aW9uczogQ29udmVyc2F0aW9uU2Vzc2lvbltdIHwgdW5kZWZpbmVkXG59XG5cbmV4cG9ydCBjb25zdCB0ZW1wQ29udmVyc2F0aW9uczogQ29udmVyc2F0aW9uU2Vzc2lvbltdID0gZ2xvYmFsRm9yQ29udmVyc2F0aW9ucy50ZW1wQ29udmVyc2F0aW9ucyA/PyBbXVxuZ2xvYmFsRm9yQ29udmVyc2F0aW9ucy50ZW1wQ29udmVyc2F0aW9ucyA9IHRlbXBDb252ZXJzYXRpb25zXG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRDb252ZXJzYXRpb25TZXNzaW9uKHVzZXJJZDogc3RyaW5nLCBzZXNzaW9uSWQ6IHN0cmluZyk6IENvbnZlcnNhdGlvblNlc3Npb24gfCBudWxsIHtcbiAgcmV0dXJuIHRlbXBDb252ZXJzYXRpb25zLmZpbmQoc2Vzc2lvbiA9PiBcbiAgICBzZXNzaW9uLnVzZXJJZCA9PT0gdXNlcklkICYmIHNlc3Npb24uc2Vzc2lvbklkID09PSBzZXNzaW9uSWRcbiAgKSB8fCBudWxsXG59XG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVDb252ZXJzYXRpb25TZXNzaW9uKHVzZXJJZDogc3RyaW5nLCBzZXNzaW9uSWQ6IHN0cmluZyk6IENvbnZlcnNhdGlvblNlc3Npb24ge1xuICAvLyBGaXJzdCByZW1vdmUgYW55IG9sZCBzZXNzaW9uIGZvciB0aGUgc2FtZSB1c2VyL3Nlc3Npb25JZFxuICBjb25zdCBleGlzdGluZ0luZGV4ID0gdGVtcENvbnZlcnNhdGlvbnMuZmluZEluZGV4KHNlc3Npb24gPT4gXG4gICAgc2Vzc2lvbi51c2VySWQgPT09IHVzZXJJZCAmJiBzZXNzaW9uLnNlc3Npb25JZCA9PT0gc2Vzc2lvbklkXG4gIClcbiAgaWYgKGV4aXN0aW5nSW5kZXggIT09IC0xKSB7XG4gICAgdGVtcENvbnZlcnNhdGlvbnMuc3BsaWNlKGV4aXN0aW5nSW5kZXgsIDEpXG4gIH1cblxuICBjb25zdCBuZXdTZXNzaW9uOiBDb252ZXJzYXRpb25TZXNzaW9uID0ge1xuICAgIHVzZXJJZCxcbiAgICBzZXNzaW9uSWQsXG4gICAgdHVybnM6IFtdLFxuICAgIGN1cnJlbnRUb3BpYzogdW5kZWZpbmVkLFxuICAgIGN1cnJlbnRTdWJqZWN0OiB1bmRlZmluZWQsXG4gICAgcGVuZGluZ1Rhc2tzOiBbXSxcbiAgICBsYXN0VXBkYXRlOiBuZXcgRGF0ZSgpXG4gIH1cbiAgXG4gIHRlbXBDb252ZXJzYXRpb25zLnB1c2gobmV3U2Vzc2lvbilcbiAgY29uc29sZS5sb2coYPCfkqwgQ3JlYXRlZCBjb252ZXJzYXRpb24gc2Vzc2lvbiAke3Nlc3Npb25JZH0gZm9yIHVzZXIgJHt1c2VySWR9YClcbiAgcmV0dXJuIG5ld1Nlc3Npb25cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHVwZGF0ZUNvbnZlcnNhdGlvblNlc3Npb24oc2Vzc2lvbjogQ29udmVyc2F0aW9uU2Vzc2lvbik6IENvbnZlcnNhdGlvblNlc3Npb24ge1xuICBjb25zdCBpbmRleCA9IHRlbXBDb252ZXJzYXRpb25zLmZpbmRJbmRleChzID0+IFxuICAgIHMudXNlcklkID09PSBzZXNzaW9uLnVzZXJJZCAmJiBzLnNlc3Npb25JZCA9PT0gc2Vzc2lvbi5zZXNzaW9uSWRcbiAgKVxuICBcbiAgaWYgKGluZGV4ICE9PSAtMSkge1xuICAgIHRlbXBDb252ZXJzYXRpb25zW2luZGV4XSA9IHsgLi4uc2Vzc2lvbiwgbGFzdFVwZGF0ZTogbmV3IERhdGUoKSB9XG4gICAgY29uc29sZS5sb2coYPCfkqwgVXBkYXRlZCBzZXNzaW9uICR7c2Vzc2lvbi5zZXNzaW9uSWR9IC0gJHtzZXNzaW9uLnR1cm5zLmxlbmd0aH0gdHVybnNgKVxuICB9IGVsc2Uge1xuICAgIHRlbXBDb252ZXJzYXRpb25zLnB1c2goeyAuLi5zZXNzaW9uLCBsYXN0VXBkYXRlOiBuZXcgRGF0ZSgpIH0pXG4gICAgY29uc29sZS5sb2coYPCfkqwgQ3JlYXRlZCBuZXcgc2Vzc2lvbiAke3Nlc3Npb24uc2Vzc2lvbklkfSBkdXJpbmcgdXBkYXRlYClcbiAgfVxuICBcbiAgcmV0dXJuIHNlc3Npb25cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGFkZENvbnZlcnNhdGlvblR1cm4oXG4gIHVzZXJJZDogc3RyaW5nLCBcbiAgc2Vzc2lvbklkOiBzdHJpbmcsIFxuICByb2xlOiAndXNlcicgfCAnYXNzaXN0YW50JywgXG4gIGNvbnRlbnQ6IHN0cmluZyxcbiAgbWV0YWRhdGE6IENvbnZlcnNhdGlvblR1cm5bJ21ldGFkYXRhJ10gPSB7fVxuKTogQ29udmVyc2F0aW9uU2Vzc2lvbiB7XG4gIGxldCBzZXNzaW9uID0gZ2V0Q29udmVyc2F0aW9uU2Vzc2lvbih1c2VySWQsIHNlc3Npb25JZClcbiAgaWYgKCFzZXNzaW9uKSB7XG4gICAgc2Vzc2lvbiA9IGNyZWF0ZUNvbnZlcnNhdGlvblNlc3Npb24odXNlcklkLCBzZXNzaW9uSWQpXG4gIH1cbiAgXG4gIGNvbnN0IHR1cm46IENvbnZlcnNhdGlvblR1cm4gPSB7XG4gICAgaWQ6IGB0dXJuXyR7RGF0ZS5ub3coKX1fJHtNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKDM2KS5zdWJzdHIoMiwgOSl9YCxcbiAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCksXG4gICAgcm9sZSxcbiAgICBjb250ZW50LFxuICAgIG1ldGFkYXRhXG4gIH1cbiAgXG4gIHNlc3Npb24udHVybnMucHVzaCh0dXJuKVxuICBcbiAgLy8gS2VlcCBvbmx5IGxhc3QgMjAgdHVybnMgcGVyIHNlc3Npb25cbiAgaWYgKHNlc3Npb24udHVybnMubGVuZ3RoID4gMjApIHtcbiAgICBzZXNzaW9uLnR1cm5zID0gc2Vzc2lvbi50dXJucy5zbGljZSgtMjApXG4gIH1cbiAgXG4gIHJldHVybiB1cGRhdGVDb252ZXJzYXRpb25TZXNzaW9uKHNlc3Npb24pXG59XG5cbmV4cG9ydCBmdW5jdGlvbiBhZGRQZW5kaW5nVGFzayhcbiAgdXNlcklkOiBzdHJpbmcsXG4gIHNlc3Npb25JZDogc3RyaW5nLFxuICB0eXBlOiAnY2FsZW5kYXJfZXZlbnQnIHwgJ2FjYWRlbWljX3NlYXJjaCcgfCAncmVtaW5kZXInLFxuICBkZXNjcmlwdGlvbjogc3RyaW5nLFxuICBkYXRhOiBhbnlcbik6IHZvaWQge1xuICBsZXQgc2Vzc2lvbiA9IGdldENvbnZlcnNhdGlvblNlc3Npb24odXNlcklkLCBzZXNzaW9uSWQpXG4gIGlmICghc2Vzc2lvbikge1xuICAgIHNlc3Npb24gPSBjcmVhdGVDb252ZXJzYXRpb25TZXNzaW9uKHVzZXJJZCwgc2Vzc2lvbklkKVxuICB9XG4gIFxuICBjb25zdCB0YXNrID0ge1xuICAgIGlkOiBgdGFza18ke0RhdGUubm93KCl9YCxcbiAgICB0eXBlLFxuICAgIGRlc2NyaXB0aW9uLFxuICAgIGRhdGEsXG4gICAgY29tcGxldGVkOiBmYWxzZSxcbiAgICBjcmVhdGVkQXQ6IG5ldyBEYXRlKClcbiAgfVxuICBcbiAgc2Vzc2lvbi5wZW5kaW5nVGFza3MucHVzaCh0YXNrKVxuICBjb25zb2xlLmxvZyhg8J+TiyBBZGRlZCBwZW5kaW5nIHRhc2s6ICR7ZGVzY3JpcHRpb259YClcbiAgXG4gIHVwZGF0ZUNvbnZlcnNhdGlvblNlc3Npb24oc2Vzc2lvbilcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIG1hcmtUYXNrQ29tcGxldGVkKFxuICB1c2VySWQ6IHN0cmluZyxcbiAgc2Vzc2lvbklkOiBzdHJpbmcsXG4gIHRhc2tJZDogc3RyaW5nLFxuICByZXN1bHQ/OiBhbnlcbik6IGJvb2xlYW4ge1xuICBjb25zdCBzZXNzaW9uID0gZ2V0Q29udmVyc2F0aW9uU2Vzc2lvbih1c2VySWQsIHNlc3Npb25JZClcbiAgaWYgKCFzZXNzaW9uKSByZXR1cm4gZmFsc2VcbiAgXG4gIGNvbnN0IHRhc2sgPSBzZXNzaW9uLnBlbmRpbmdUYXNrcy5maW5kKHQgPT4gdC5pZCA9PT0gdGFza0lkKVxuICBpZiAoIXRhc2spIHJldHVybiBmYWxzZVxuICBcbiAgdGFzay5jb21wbGV0ZWQgPSB0cnVlXG4gIGlmIChyZXN1bHQpIHtcbiAgICB0YXNrLmRhdGEucmVzdWx0ID0gcmVzdWx0XG4gIH1cbiAgXG4gIGNvbnNvbGUubG9nKGDinIUgQ29tcGxldGVkIHRhc2s6ICR7dGFzay5kZXNjcmlwdGlvbn1gKVxuICB1cGRhdGVDb252ZXJzYXRpb25TZXNzaW9uKHNlc3Npb24pXG4gIHJldHVybiB0cnVlXG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRQZW5kaW5nVGFza3ModXNlcklkOiBzdHJpbmcsIHNlc3Npb25JZDogc3RyaW5nKTogQXJyYXk8e1xuICBpZDogc3RyaW5nXG4gIHR5cGU6ICdjYWxlbmRhcl9ldmVudCcgfCAnYWNhZGVtaWNfc2VhcmNoJyB8ICdyZW1pbmRlcidcbiAgZGVzY3JpcHRpb246IHN0cmluZ1xuICBkYXRhOiBhbnlcbiAgY29tcGxldGVkOiBib29sZWFuXG4gIGNyZWF0ZWRBdDogRGF0ZVxufT4ge1xuICBjb25zdCBzZXNzaW9uID0gZ2V0Q29udmVyc2F0aW9uU2Vzc2lvbih1c2VySWQsIHNlc3Npb25JZClcbiAgaWYgKCFzZXNzaW9uKSByZXR1cm4gW11cbiAgXG4gIHJldHVybiBzZXNzaW9uLnBlbmRpbmdUYXNrcy5maWx0ZXIodGFzayA9PiAhdGFzay5jb21wbGV0ZWQpXG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRDb252ZXJzYXRpb25IaXN0b3J5KHVzZXJJZDogc3RyaW5nLCBzZXNzaW9uSWQ6IHN0cmluZywgbGltaXQ6IG51bWJlciA9IDEwKTogQ29udmVyc2F0aW9uVHVybltdIHtcbiAgY29uc3Qgc2Vzc2lvbiA9IGdldENvbnZlcnNhdGlvblNlc3Npb24odXNlcklkLCBzZXNzaW9uSWQpXG4gIGlmICghc2Vzc2lvbikgcmV0dXJuIFtdXG4gIFxuICByZXR1cm4gc2Vzc2lvbi50dXJucy5zbGljZSgtbGltaXQpXG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRVc2VyQWN0aXZlU2Vzc2lvbnModXNlcklkOiBzdHJpbmcpOiBDb252ZXJzYXRpb25TZXNzaW9uW10ge1xuICBjb25zdCBvbmVIb3VyQWdvID0gbmV3IERhdGUoRGF0ZS5ub3coKSAtICg2MCAqIDYwICogMTAwMCkpXG4gIHJldHVybiB0ZW1wQ29udmVyc2F0aW9ucy5maWx0ZXIoc2Vzc2lvbiA9PiBcbiAgICBzZXNzaW9uLnVzZXJJZCA9PT0gdXNlcklkICYmIHNlc3Npb24ubGFzdFVwZGF0ZSA+IG9uZUhvdXJBZ29cbiAgKVxufVxuXG5leHBvcnQgZnVuY3Rpb24gY2xlYW51cE9sZENvbnZlcnNhdGlvbnMoKTogdm9pZCB7XG4gIGNvbnN0IHNpeEhvdXJzQWdvID0gbmV3IERhdGUoRGF0ZS5ub3coKSAtICg2ICogNjAgKiA2MCAqIDEwMDApKVxuICBjb25zdCBiZWZvcmUgPSB0ZW1wQ29udmVyc2F0aW9ucy5sZW5ndGhcbiAgXG4gIC8vIFJlbW92ZSBjb252ZXJzYXRpb25zIG9sZGVyIHRoYW4gNiBob3Vyc1xuICBmb3IgKGxldCBpID0gdGVtcENvbnZlcnNhdGlvbnMubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIHtcbiAgICBpZiAodGVtcENvbnZlcnNhdGlvbnNbaV0ubGFzdFVwZGF0ZSA8IHNpeEhvdXJzQWdvKSB7XG4gICAgICB0ZW1wQ29udmVyc2F0aW9ucy5zcGxpY2UoaSwgMSlcbiAgICB9XG4gIH1cbiAgXG4gIGNvbnN0IGFmdGVyID0gdGVtcENvbnZlcnNhdGlvbnMubGVuZ3RoXG4gIGlmIChiZWZvcmUgIT09IGFmdGVyKSB7XG4gICAgY29uc29sZS5sb2coYPCfp7kgQ2xlYW5lZCB1cCAke2JlZm9yZSAtIGFmdGVyfSBvbGQgY29udmVyc2F0aW9uIHNlc3Npb25zYClcbiAgfVxufVxuXG4vLyBJbml0aWFsaXplIGRlZmF1bHQgdXNlcnMgYXV0b21hdGljYWxseVxuaW1wb3J0IGJjcnlwdCBmcm9tIFwiYmNyeXB0anNcIlxuXG5mdW5jdGlvbiBpbml0RGVmYXVsdFVzZXJzKCkge1xuICAvLyBDaGVjayBpZiBkZW1vIHVzZXJzIGFscmVhZHkgZXhpc3QgdG8gYXZvaWQgZHVwbGljYXRlc1xuICBjb25zdCBzdHVkZW50RXhpc3RzID0gZmluZFVzZXJCeUVtYWlsKFwiZXN0dWRpYW50ZUBkZW1vLmNvbVwiKVxuICBjb25zdCBpbnN0cnVjdG9yRXhpc3RzID0gZmluZFVzZXJCeUVtYWlsKFwiaW5zdHJ1Y3RvckBkZW1vLmNvbVwiKVxuICBcbiAgaWYgKCFzdHVkZW50RXhpc3RzIHx8ICFpbnN0cnVjdG9yRXhpc3RzKSB7XG4gICAgY29uc29sZS5sb2coXCLwn5SnIEluaWNpYWxpemFuZG8gdXN1YXJpb3MgcG9yIGRlZmVjdG8uLi5cIilcbiAgICBcbiAgICB0cnkge1xuICAgICAgY29uc3QgaGFzaGVkUGFzc3dvcmQgPSBiY3J5cHQuaGFzaFN5bmMoXCJFc3R1ZGlhbnRlMTIzISEhXCIsIDEyKVxuICAgICAgXG4gICAgICAvLyBPbmx5IGFkZCBzdHVkZW50IGlmIGRvZXNuJ3QgZXhpc3RcbiAgICAgIGlmICghc3R1ZGVudEV4aXN0cykge1xuICAgICAgICBhZGRVc2VyKHtcbiAgICAgICAgICBpZDogXCJkZW1vLXN0dWRlbnQtZml4ZWRcIixcbiAgICAgICAgICBuYW1lOiBcIkVzdHVkaWFudGUgRGVtb1wiLFxuICAgICAgICAgIGVtYWlsOiBcImVzdHVkaWFudGVAZGVtby5jb21cIixcbiAgICAgICAgICBwYXNzd29yZDogaGFzaGVkUGFzc3dvcmQsXG4gICAgICAgICAgcm9sZTogXCJTVFVERU5UXCIsXG4gICAgICAgICAgc3R1ZGVudElkOiBcIkVTVC0yMDI1LTAwMVwiLFxuICAgICAgICAgIHN0YXR1czogXCJBQ1RJVkVcIixcbiAgICAgICAgICBlbnJvbGxtZW50WWVhcjogMjAyNSxcbiAgICAgICAgICBhY2FkZW1pY1llYXI6IFwiMjAyNS0yMDI2XCIsXG4gICAgICAgICAgcHJvZ3JhbTogXCJJbmdlbmllcsOtYSBlbiBTaXN0ZW1hc1wiLFxuICAgICAgICAgIHBob25lTnVtYmVyOiBcIisxMjM0NTY3ODkwXCIsXG4gICAgICAgICAgZGF0ZU9mQmlydGg6IG5ldyBEYXRlKFwiMjAwMC0wMS0wMVwiKSxcbiAgICAgICAgICBhZGRyZXNzOiBcIkRlbW8gQWRkcmVzcyAxMjNcIixcbiAgICAgICAgICBlbWVyZ2VuY3lDb250YWN0OiB7XG4gICAgICAgICAgICBuYW1lOiBcIkNvbnRhY3RvIERlbW9cIixcbiAgICAgICAgICAgIHBob25lOiBcIiswOTg3NjU0MzIxXCIsXG4gICAgICAgICAgICByZWxhdGlvbnNoaXA6IFwiUGFkcmVcIlxuICAgICAgICAgIH0sXG4gICAgICAgICAgY3JlYXRlZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgICAgfSlcbiAgICAgICAgY29uc29sZS5sb2coXCLinIUgVXN1YXJpbyBlc3R1ZGlhbnRlIGRlbW8gY3JlYWRvXCIpXG4gICAgICB9XG4gICAgICBcbiAgICAgIC8vIE9ubHkgYWRkIGluc3RydWN0b3IgaWYgZG9lc24ndCBleGlzdFxuICAgICAgaWYgKCFpbnN0cnVjdG9yRXhpc3RzKSB7XG4gICAgICAgIGFkZFVzZXIoe1xuICAgICAgICAgIGlkOiBcImRlbW8taW5zdHJ1Y3Rvci1maXhlZFwiLFxuICAgICAgICAgIG5hbWU6IFwiSW5zdHJ1Y3RvciBEZW1vXCIsXG4gICAgICAgICAgZW1haWw6IFwiaW5zdHJ1Y3RvckBkZW1vLmNvbVwiLFxuICAgICAgICAgIHBhc3N3b3JkOiBoYXNoZWRQYXNzd29yZCxcbiAgICAgICAgICByb2xlOiBcIklOU1RSVUNUT1JcIixcbiAgICAgICAgICBzdHVkZW50SWQ6IG51bGwsXG4gICAgICAgICAgc3RhdHVzOiBcIkFDVElWRVwiLFxuICAgICAgICAgIGVucm9sbG1lbnRZZWFyOiAyMDI1LFxuICAgICAgICAgIGFjYWRlbWljWWVhcjogXCIyMDI1LTIwMjZcIixcbiAgICAgICAgICBjcmVhdGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICAgICAgdXBkYXRlZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgICB9KVxuICAgICAgICBjb25zb2xlLmxvZyhcIuKchSBVc3VhcmlvIGluc3RydWN0b3IgZGVtbyBjcmVhZG9cIilcbiAgICAgIH1cbiAgICAgIFxuICAgICAgY29uc29sZS5sb2coXCLinIUgVmVyaWZpY2FjacOzbiBkZSB1c3VhcmlvcyBwb3IgZGVmZWN0byBjb21wbGV0YWRhXCIpXG4gICAgICBcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcihcIuKdjCBFcnJvciBjcmVhbmRvIHVzdWFyaW9zIHBvciBkZWZlY3RvOlwiLCBlcnJvcilcbiAgICB9XG4gIH0gZWxzZSB7XG4gICAgY29uc29sZS5sb2coXCLinIUgVXN1YXJpb3MgZGVtbyB5YSBleGlzdGVuLCBubyBzZSByZWluaWNpYWxpemFuXCIpXG4gIH1cbiAgXG4gIC8vIEFsd2F5cyBjaGVjayBhbmQgaW5pdGlhbGl6ZSBzYW1wbGUgcmVwb3J0c1xuICBpbml0U2FtcGxlUmVwb3J0cygpXG59XG5cbmZ1bmN0aW9uIGluaXRTYW1wbGVSZXBvcnRzKCkge1xuICAvLyBDaGVjayBpZiBzYW1wbGUgcmVwb3J0cyBhbHJlYWR5IGV4aXN0IGZvciBkZW1vIHN0dWRlbnRcbiAgY29uc3QgZXhpc3RpbmdTYW1wbGVSZXBvcnRzID0gdGVtcFdlZWtseVJlcG9ydHMuZmlsdGVyKHJlcG9ydCA9PiByZXBvcnQudXNlcklkID09PSBcImRlbW8tc3R1ZGVudC1maXhlZFwiKVxuICBcbiAgaWYgKGV4aXN0aW5nU2FtcGxlUmVwb3J0cy5sZW5ndGggPT09IDApIHtcbiAgICBjb25zb2xlLmxvZyhcIvCfk50gSW5pY2lhbGl6YW5kbyByZXBvcnRlcyBkZSBtdWVzdHJhLi4uXCIpXG4gICAgXG4gICAgdHJ5IHtcbiAgICAgIC8vIEdldCBjdXJyZW50IHdlZWsgZGF0ZXNcbiAgICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKClcbiAgICAgIGNvbnN0IGN1cnJlbnRXZWVrID0gZ2V0Q3VycmVudFdlZWtTdGFydCgpXG4gICAgICBjb25zdCBjdXJyZW50V2Vla0VuZCA9IGdldEN1cnJlbnRXZWVrRW5kKClcbiAgICAgIFxuICAgICAgLy8gUHJldmlvdXMgd2Vla1xuICAgICAgY29uc3QgcHJldldlZWsgPSBuZXcgRGF0ZShjdXJyZW50V2VlaylcbiAgICAgIHByZXZXZWVrLnNldERhdGUocHJldldlZWsuZ2V0RGF0ZSgpIC0gNylcbiAgICAgIGNvbnN0IHByZXZXZWVrRW5kID0gbmV3IERhdGUoY3VycmVudFdlZWtFbmQpXG4gICAgICBwcmV2V2Vla0VuZC5zZXREYXRlKHByZXZXZWVrRW5kLmdldERhdGUoKSAtIDcpXG4gICAgICBcbiAgICAgIC8vIFNhbXBsZSByZXBvcnQgZnJvbSBwcmV2aW91cyB3ZWVrXG4gICAgICBhZGRXZWVrbHlSZXBvcnQoe1xuICAgICAgICBpZDogXCJzYW1wbGUtcmVwb3J0LTFcIixcbiAgICAgICAgdXNlcklkOiBcImRlbW8tc3R1ZGVudC1maXhlZFwiLFxuICAgICAgICB3ZWVrU3RhcnQ6IHByZXZXZWVrLFxuICAgICAgICB3ZWVrRW5kOiBwcmV2V2Vla0VuZCxcbiAgICAgICAgc3VibWl0dGVkQXQ6IG5ldyBEYXRlKHByZXZXZWVrRW5kLmdldFRpbWUoKSAtIDI0ICogNjAgKiA2MCAqIDEwMDApLCAvLyAxIGRheSBiZWZvcmUgd2VlayBlbmRcbiAgICAgICAgcmVzcG9uc2VzOiB7XG4gICAgICAgICAgdGVtYXNZRG9taW5pbzogXCJFc3RhIHNlbWFuYSB0cmFiYWphbW9zIGNvbiBKYXZhU2NyaXB0IGLDoXNpY28gLSBOaXZlbCAzOiBEb21pbm8gZnVuY2lvbmVzIHkgYXJyYXlzLCB5IGVzdG95IGFwcmVuZGllbmRvIG9iamV0b3MgY29tcGxlam9zLlwiLFxuICAgICAgICAgIGV2aWRlbmNpYUFwcmVuZGl6YWplOiBcIkNvbXBsZXTDqSB1biBwcm95ZWN0byBkZSBUby1EbyBMaXN0IHVzYW5kbyBKYXZhU2NyaXB0IHZhbmlsbGEuIEltcGxlbWVudMOpIGZ1bmNpb25lcyBwYXJhIGFncmVnYXIsIGVkaXRhciB5IGVsaW1pbmFyIHRhcmVhcyB1c2FuZG8gYXJyYXlzIHkgb2JqZXRvcy5cIixcbiAgICAgICAgICBkaWZpY3VsdGFkZXNFc3RyYXRlZ2lhczogXCJUdXZlIGRpZmljdWx0YWRlcyBjb24gZWwgbWFuZWpvIGRlIGV2ZW50b3MgZW4gSmF2YVNjcmlwdC4gTG8gcmVzb2x2w60gcHJhY3RpY2FuZG8gY29uIGVqZW1wbG9zIHkgY29uc3VsdGFuZG8gZG9jdW1lbnRhY2nDs24gZGUgTUROLlwiLFxuICAgICAgICAgIGNvbmV4aW9uZXNBcGxpY2FjaW9uOiBcIkxvcyBjb25jZXB0b3MgZGUgZXZlbnRvcyBzZSBjb25lY3RhbiBjb24gbGEgaW50ZXJhY3RpdmlkYWQgZW4gYXBsaWNhY2lvbmVzIHdlYi4gUHVlZG8gYXBsaWNhcmxvIHBhcmEgY3JlYXIgaW50ZXJmYWNlcyBtw6FzIGRpbsOhbWljYXMuXCIsXG4gICAgICAgICAgY29tZW50YXJpb3NBZGljaW9uYWxlczogXCJNZSBzaWVudG8gbcOhcyBjb25maWFkbyBjb24gSmF2YVNjcmlwdC4gUXVpZXJvIHNlZ3VpciBwcmFjdGljYW5kbyBjb24gcHJveWVjdG9zIG3DoXMgY29tcGxlam9zLlwiXG4gICAgICAgIH1cbiAgICAgIH0pXG4gICAgICBcbiAgICAgIC8vIFR3byB3ZWVrcyBhZ28gcmVwb3J0ICBcbiAgICAgIGNvbnN0IHR3b1dlZWtzQWdvID0gbmV3IERhdGUoY3VycmVudFdlZWspXG4gICAgICB0d29XZWVrc0Fnby5zZXREYXRlKHR3b1dlZWtzQWdvLmdldERhdGUoKSAtIDE0KVxuICAgICAgY29uc3QgdHdvV2Vla3NBZ29FbmQgPSBuZXcgRGF0ZShjdXJyZW50V2Vla0VuZClcbiAgICAgIHR3b1dlZWtzQWdvRW5kLnNldERhdGUodHdvV2Vla3NBZ29FbmQuZ2V0RGF0ZSgpIC0gMTQpXG4gICAgICBcbiAgICAgIGFkZFdlZWtseVJlcG9ydCh7XG4gICAgICAgIGlkOiBcInNhbXBsZS1yZXBvcnQtMlwiLFxuICAgICAgICB1c2VySWQ6IFwiZGVtby1zdHVkZW50LWZpeGVkXCIsIFxuICAgICAgICB3ZWVrU3RhcnQ6IHR3b1dlZWtzQWdvLFxuICAgICAgICB3ZWVrRW5kOiB0d29XZWVrc0Fnb0VuZCxcbiAgICAgICAgc3VibWl0dGVkQXQ6IG5ldyBEYXRlKHR3b1dlZWtzQWdvRW5kLmdldFRpbWUoKSAtIDEyICogNjAgKiA2MCAqIDEwMDApLCAvLyAxMiBob3VycyBiZWZvcmUgd2VlayBlbmRcbiAgICAgICAgcmVzcG9uc2VzOiB7XG4gICAgICAgICAgdGVtYXNZRG9taW5pbzogXCJFc3RhIHNlbWFuYSBlc3R1ZGlhbW9zIENTUyBHcmlkIHkgRmxleGJveCAtIE5pdmVsIDI6IEVudGllbmRvIGxvcyBjb25jZXB0b3MgYsOhc2ljb3MgcGVybyBhw7puIHRlbmdvIGR1ZGFzIGNvbiBsYXlvdXRzIGNvbXBsZWpvcy5cIixcbiAgICAgICAgICBldmlkZW5jaWFBcHJlbmRpemFqZTogXCJSZWNyZcOpIGVsIGxheW91dCBkZSB1bmEgcMOhZ2luYSB3ZWIgdXNhbmRvIENTUyBHcmlkLiBMb2dyw6kgaGFjZXIgdW5hIGVzdHJ1Y3R1cmEgcmVzcG9uc2l2ZSBjb24gaGVhZGVyLCBzaWRlYmFyIHkgbWFpbiBjb250ZW50LlwiLFxuICAgICAgICAgIGRpZmljdWx0YWRlc0VzdHJhdGVnaWFzOiBcIk1lIGNvbmZ1bmTDrSBjb24gbGFzIHByb3BpZWRhZGVzIGdyaWQtdGVtcGxhdGUtYXJlYXMuIFJlc29sdsOtIGVsIHByb2JsZW1hIGRpYnVqYW5kbyBlbCBsYXlvdXQgZW4gcGFwZWwgcHJpbWVyby5cIixcbiAgICAgICAgICBjb25leGlvbmVzQXBsaWNhY2lvbjogXCJDU1MgR3JpZCBlcyBwZXJmZWN0byBwYXJhIGNyZWFyIGxheW91dHMgZGUgcMOhZ2luYXMgd2ViIG1vZGVybmFzLiBMbyB1c2Fyw6kgZW4gbWkgcHJveWVjdG8gZmluYWwgZGUgcMOhZ2luYSBwb3J0Zm9saW8uXCIsXG4gICAgICAgICAgY29tZW50YXJpb3NBZGljaW9uYWxlczogXCJDU1MgZXMgbcOhcyBkaXZlcnRpZG8gZGUgbG8gcXVlIHBlbnNhYmEuIE1lIGd1c3RhIHZlciBsb3MgcmVzdWx0YWRvcyB2aXN1YWxlcyBpbm1lZGlhdG9zLlwiXG4gICAgICAgIH1cbiAgICAgIH0pXG4gICAgICBcbiAgICAgIGNvbnNvbGUubG9nKFwi4pyFIFJlcG9ydGVzIGRlIG11ZXN0cmEgY3JlYWRvcyBleGl0b3NhbWVudGVcIilcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcihcIuKdjCBFcnJvciBjcmVhbmRvIHJlcG9ydGVzIGRlIG11ZXN0cmE6XCIsIGVycm9yKVxuICAgIH1cbiAgfSBlbHNlIHtcbiAgICBjb25zb2xlLmxvZyhcIuKchSBSZXBvcnRlcyBkZSBtdWVzdHJhIHlhIGV4aXN0ZW4sIG5vIHNlIHJlaW5pY2lhbGl6YW5cIilcbiAgfVxufVxuXG4vLyBJbml0aWFsaXplIG9uIG1vZHVsZSBsb2FkXG5pbml0RGVmYXVsdFVzZXJzKClcblxuLy8gU3RhcnQgY29udmVyc2F0aW9uIGNsZWFudXAgaW50ZXJ2YWxcbnNldEludGVydmFsKGNsZWFudXBPbGRDb252ZXJzYXRpb25zLCAzMCAqIDYwICogMTAwMCkgLy8gRXZlcnkgMzAgbWludXRlcyJdLCJuYW1lcyI6WyJnbG9iYWxGb3JTdG9yYWdlIiwiZ2xvYmFsVGhpcyIsInRlbXBVc2VycyIsInRlbXBXZWVrbHlSZXBvcnRzIiwiYWRkVXNlciIsInVzZXIiLCJwdXNoIiwiZmluZFVzZXJCeUVtYWlsIiwiZW1haWwiLCJmaW5kIiwiZmluZFVzZXJCeVN0dWRlbnRJZCIsInN0dWRlbnRJZCIsImZpbmRVc2VyQnlJZCIsImlkIiwiZ2V0QWxsVXNlcnMiLCJmaW5kVXNlcnNCeVJvbGUiLCJyb2xlIiwiZmlsdGVyIiwiZmluZFVzZXJzQnlQcm9ncmFtIiwicHJvZ3JhbSIsImZpbmRVc2Vyc0J5U3RhdHVzIiwic3RhdHVzIiwidXBkYXRlVXNlciIsInVwZGF0ZXMiLCJ1c2VySW5kZXgiLCJmaW5kSW5kZXgiLCJ1cGRhdGVkQXQiLCJEYXRlIiwiZGVsZXRlVXNlciIsInNwbGljZSIsInZhbGlkYXRlU3R1ZGVudElkIiwic3R1ZGVudElkUmVnZXgiLCJ0ZXN0IiwiZ2VuZXJhdGVTdHVkZW50SWQiLCJjdXJyZW50WWVhciIsImdldEZ1bGxZZWFyIiwiZXhpc3RpbmdJZHMiLCJzdGFydHNXaXRoIiwibWFwIiwic29ydCIsIm5leHROdW1iZXIiLCJsZW5ndGgiLCJsYXN0SWQiLCJsYXN0TnVtYmVyIiwicGFyc2VJbnQiLCJzcGxpdCIsInRvU3RyaW5nIiwicGFkU3RhcnQiLCJhZGRXZWVrbHlSZXBvcnQiLCJyZXBvcnQiLCJmaW5kV2Vla2x5UmVwb3J0c0J5VXNlciIsInVzZXJJZCIsImZpbmRXZWVrbHlSZXBvcnRCeVVzZXJBbmRXZWVrIiwid2Vla1N0YXJ0IiwiZ2V0VGltZSIsImdldEFsbFdlZWtseVJlcG9ydHMiLCJnZXRXZWVrbHlSZXBvcnRzQnlEYXRlUmFuZ2UiLCJzdGFydERhdGUiLCJlbmREYXRlIiwid2Vla0VuZCIsImdldEN1cnJlbnRXZWVrU3RhcnQiLCJub3ciLCJtb25kYXkiLCJkYXkiLCJnZXREYXkiLCJkaWZmIiwiZ2V0RGF0ZSIsInNldERhdGUiLCJzZXRIb3VycyIsImdldEN1cnJlbnRXZWVrRW5kIiwiY2FuU3VibWl0VGhpc1dlZWsiLCJjdXJyZW50RGF0ZSIsImV4aXN0aW5nUmVwb3J0IiwiaXNDdXJyZW50V2VlayIsImNvbnNvbGUiLCJsb2ciLCJ0b0lTT1N0cmluZyIsImdldFdlZWtEYXRlcyIsImRhdGUiLCJzdGFydCIsImVuZCIsImdldE1vbnRoV2Vla3MiLCJ5ZWFyIiwibW9udGgiLCJ3ZWVrcyIsImZpcnN0RGF5IiwibGFzdERheSIsImN1cnJlbnQiLCJkYXlPZldlZWsiLCJkYXlzVG9TdWJ0cmFjdCIsImdldEV2ZW50cyIsImdldFVzZXJDYWxlbmRhckRhdGEiLCJyZXF1aXJlIiwidXNlckRhdGEiLCJldmVudHMiLCJlcnJvciIsImdldEFsbENhbGVuZGFyRXZlbnRzIiwiZ2V0VXBjb21pbmdFdmVudHMiLCJkYXlzIiwiYWxsRXZlbnRzIiwiZnV0dXJlRGF0ZSIsImV2ZW50IiwiZXZlbnREYXRlIiwiYSIsImIiLCJnZXRFdmVudHNGb3JEYXRlUmFuZ2UiLCJmaW5kRXZlbnRCeUlkIiwiZXZlbnRJZCIsImdsb2JhbEZvckNvbnZlcnNhdGlvbnMiLCJ0ZW1wQ29udmVyc2F0aW9ucyIsImdldENvbnZlcnNhdGlvblNlc3Npb24iLCJzZXNzaW9uSWQiLCJzZXNzaW9uIiwiY3JlYXRlQ29udmVyc2F0aW9uU2Vzc2lvbiIsImV4aXN0aW5nSW5kZXgiLCJuZXdTZXNzaW9uIiwidHVybnMiLCJjdXJyZW50VG9waWMiLCJ1bmRlZmluZWQiLCJjdXJyZW50U3ViamVjdCIsInBlbmRpbmdUYXNrcyIsImxhc3RVcGRhdGUiLCJ1cGRhdGVDb252ZXJzYXRpb25TZXNzaW9uIiwiaW5kZXgiLCJzIiwiYWRkQ29udmVyc2F0aW9uVHVybiIsImNvbnRlbnQiLCJtZXRhZGF0YSIsInR1cm4iLCJNYXRoIiwicmFuZG9tIiwic3Vic3RyIiwidGltZXN0YW1wIiwic2xpY2UiLCJhZGRQZW5kaW5nVGFzayIsInR5cGUiLCJkZXNjcmlwdGlvbiIsImRhdGEiLCJ0YXNrIiwiY29tcGxldGVkIiwiY3JlYXRlZEF0IiwibWFya1Rhc2tDb21wbGV0ZWQiLCJ0YXNrSWQiLCJyZXN1bHQiLCJ0IiwiZ2V0UGVuZGluZ1Rhc2tzIiwiZ2V0Q29udmVyc2F0aW9uSGlzdG9yeSIsImxpbWl0IiwiZ2V0VXNlckFjdGl2ZVNlc3Npb25zIiwib25lSG91ckFnbyIsImNsZWFudXBPbGRDb252ZXJzYXRpb25zIiwic2l4SG91cnNBZ28iLCJiZWZvcmUiLCJpIiwiYWZ0ZXIiLCJiY3J5cHQiLCJpbml0RGVmYXVsdFVzZXJzIiwic3R1ZGVudEV4aXN0cyIsImluc3RydWN0b3JFeGlzdHMiLCJoYXNoZWRQYXNzd29yZCIsImhhc2hTeW5jIiwibmFtZSIsInBhc3N3b3JkIiwiZW5yb2xsbWVudFllYXIiLCJhY2FkZW1pY1llYXIiLCJwaG9uZU51bWJlciIsImRhdGVPZkJpcnRoIiwiYWRkcmVzcyIsImVtZXJnZW5jeUNvbnRhY3QiLCJwaG9uZSIsInJlbGF0aW9uc2hpcCIsImluaXRTYW1wbGVSZXBvcnRzIiwiZXhpc3RpbmdTYW1wbGVSZXBvcnRzIiwiY3VycmVudFdlZWsiLCJjdXJyZW50V2Vla0VuZCIsInByZXZXZWVrIiwicHJldldlZWtFbmQiLCJzdWJtaXR0ZWRBdCIsInJlc3BvbnNlcyIsInRlbWFzWURvbWluaW8iLCJldmlkZW5jaWFBcHJlbmRpemFqZSIsImRpZmljdWx0YWRlc0VzdHJhdGVnaWFzIiwiY29uZXhpb25lc0FwbGljYWNpb24iLCJjb21lbnRhcmlvc0FkaWNpb25hbGVzIiwidHdvV2Vla3NBZ28iLCJ0d29XZWVrc0Fnb0VuZCIsInNldEludGVydmFsIl0sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/temp-storage.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/visual-learning-engine.ts":
/*!*******************************************!*\
  !*** ./src/lib/visual-learning-engine.ts ***!
  \*******************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   VisualLearningEngine: () => (/* binding */ VisualLearningEngine),\n/* harmony export */   VisualType: () => (/* binding */ VisualType)\n/* harmony export */ });\n// Visual Learning Engine for Sara AI\n// Generates ASCII diagrams, conceptual maps, and visual representations for enhanced learning\nvar VisualType = /*#__PURE__*/ function(VisualType) {\n    VisualType[\"CONCEPT_MAP\"] = \"concept_map\";\n    VisualType[\"FLOWCHART\"] = \"flowchart\";\n    VisualType[\"HIERARCHY\"] = \"hierarchy\";\n    VisualType[\"TIMELINE\"] = \"timeline\";\n    VisualType[\"DIAGRAM\"] = \"diagram\";\n    VisualType[\"FORMULA_VISUALIZATION\"] = \"formula_visualization\";\n    VisualType[\"CHEMICAL_STRUCTURE\"] = \"chemical_structure\";\n    VisualType[\"MATH_GRAPH\"] = \"math_graph\";\n    VisualType[\"PROCESS_FLOW\"] = \"process_flow\";\n    return VisualType;\n}({});\nclass VisualLearningEngine {\n    /**\n   * Generates visual representation based on content and type\n   */ static generateVisual(content, type, subject) {\n        switch(type){\n            case \"concept_map\":\n                return this.generateConceptMap(content, subject);\n            case \"flowchart\":\n                return this.generateFlowchart(content);\n            case \"hierarchy\":\n                return this.generateHierarchy(content);\n            case \"timeline\":\n                return this.generateTimeline(content);\n            case \"formula_visualization\":\n                return this.generateFormulaVisualization(content);\n            case \"chemical_structure\":\n                return this.generateChemicalStructure(content);\n            case \"process_flow\":\n                return this.generateProcessFlow(content);\n            default:\n                return this.generateGenericDiagram(content);\n        }\n    }\n    /**\n   * Auto-detects the best visual type for content\n   */ static detectOptimalVisualType(content, subject) {\n        const contentLower = content.toLowerCase();\n        // Chemical formulas and structures\n        if (subject === 'chemistry' || subject === 'qu√≠mica' || /h2o|co2|nacl|ch4|formula|molecular|√°tomo|mol√©cula/.test(contentLower)) {\n            return \"chemical_structure\";\n        }\n        // Mathematical formulas\n        if (subject === 'mathematics' || subject === 'matem√°ticas' || /ecuaci√≥n|formula|funci√≥n|derivada|integral|gr√°fica/.test(contentLower)) {\n            return \"formula_visualization\";\n        }\n        // Process or step-by-step content\n        if (/paso|step|proceso|luego|despu√©s|entonces|primero|segundo/.test(contentLower)) {\n            return \"process_flow\";\n        }\n        // Hierarchical content\n        if (/clasificaci√≥n|categor√≠a|tipo|nivel|jerarqu√≠a|superior|inferior/.test(contentLower)) {\n            return \"hierarchy\";\n        }\n        // Timeline content\n        if (/a√±o|fecha|siglo|√©poca|antes|despu√©s|historia|cronolog√≠a/.test(contentLower)) {\n            return \"timeline\";\n        }\n        // Conceptual relationships\n        if (/relaci√≥n|concepto|idea|conecta|vincula|asocia/.test(contentLower)) {\n            return \"concept_map\";\n        }\n        // Default to flowchart for general content\n        return \"flowchart\";\n    }\n    /**\n   * Generates concept map visualization\n   */ static generateConceptMap(content, subject) {\n        const concepts = this.extractConcepts(content);\n        const mainConcept = concepts[0] || 'Concepto Principal';\n        const relatedConcepts = concepts.slice(1, 5);\n        let ascii = `\n‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n‚îÇ   ${this.centerText(mainConcept, 17)}   ‚îÇ\n‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n          ‚îÇ\n    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n    ‚îÇ           ‚îÇ`;\n        relatedConcepts.forEach((concept, index)=>{\n            if (index < 2) {\n                ascii += `\n‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n‚îÇ ${this.centerText(concept, 12)} ‚îÇ    ‚îÇ              ‚îÇ\n‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò`;\n            }\n        });\n        if (relatedConcepts.length > 2) {\n            ascii += `\n    ‚îÇ           ‚îÇ\n‚îå‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îê`;\n            relatedConcepts.slice(2, 4).forEach((concept)=>{\n                ascii += `\n‚îÇ ${this.centerText(concept, 7)} ‚îÇ ‚îÇ         ‚îÇ`;\n            });\n            ascii += `\n‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò`;\n        }\n        return {\n            type: \"concept_map\",\n            ascii: ascii,\n            description: `Mapa conceptual que muestra las relaciones entre ${mainConcept} y conceptos relacionados`,\n            elements: concepts.map((concept, index)=>({\n                    id: `concept_${index}`,\n                    type: \"concept_map\",\n                    title: concept,\n                    content: `Concepto: ${concept}`,\n                    connections: index === 0 ? relatedConcepts : [\n                        mainConcept\n                    ]\n                })),\n            instructions: [\n                'El concepto central aparece en la parte superior',\n                'Las l√≠neas conectan conceptos relacionados',\n                'Los conceptos secundarios se ramifican del principal'\n            ]\n        };\n    }\n    /**\n   * Generates flowchart visualization\n   */ static generateFlowchart(content) {\n        const steps = this.extractSteps(content);\n        let ascii = `‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\\n‚îÇ   INICIO    ‚îÇ\\n‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\\n       ‚îÇ\\n       ‚ñº`;\n        steps.forEach((step, index)=>{\n            const stepText = this.truncateText(step, 15);\n            ascii += `\n‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n‚îÇ ${this.centerText(stepText, 15)} ‚îÇ\n‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n          ‚îÇ\n          ‚ñº`;\n        });\n        ascii += `\n‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n‚îÇ    FIN      ‚îÇ\n‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò`;\n        return {\n            type: \"flowchart\",\n            ascii: ascii,\n            description: `Diagrama de flujo que muestra ${steps.length} pasos del proceso`,\n            elements: steps.map((step, index)=>({\n                    id: `step_${index}`,\n                    type: \"flowchart\",\n                    title: `Paso ${index + 1}`,\n                    content: step,\n                    connections: index < steps.length - 1 ? [\n                        `step_${index + 1}`\n                    ] : []\n                })),\n            instructions: [\n                'Sigue las flechas de arriba hacia abajo',\n                'Cada caja representa un paso del proceso',\n                'El flujo va desde INICIO hasta FIN'\n            ]\n        };\n    }\n    /**\n   * Generates hierarchy visualization\n   */ static generateHierarchy(content) {\n        const hierarchyItems = this.extractHierarchy(content);\n        const root = hierarchyItems[0] || 'Elemento Principal';\n        const children = hierarchyItems.slice(1, 4);\n        const grandchildren = hierarchyItems.slice(4, 8);\n        let ascii = `\n                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n                    ‚îÇ ${this.centerText(root, 16)} ‚îÇ\n                    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n                              ‚îÇ\n                 ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê`;\n        children.forEach((child, index)=>{\n            const spacing = index === 0 ? '     ' : index === 1 ? '           ' : '                 ';\n            ascii += `\n        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê${spacing}‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n        ‚îÇ ${this.centerText(child, 11)} ‚îÇ${spacing}‚îÇ             ‚îÇ\n        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò${spacing}‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò`;\n        });\n        if (grandchildren.length > 0) {\n            ascii += `\n              ‚îÇ                     ‚îÇ\n        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê`;\n            grandchildren.slice(0, 2).forEach((item)=>{\n                ascii += `\n        ‚îÇ ${this.centerText(item, 9)} ‚îÇ         ‚îÇ           ‚îÇ`;\n            });\n            ascii += `\n        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò`;\n        }\n        return {\n            type: \"hierarchy\",\n            ascii: ascii,\n            description: `Jerarqu√≠a que muestra la estructura de ${root} con ${children.length} niveles`,\n            elements: hierarchyItems.map((item, index)=>({\n                    id: `hierarchy_${index}`,\n                    type: \"hierarchy\",\n                    title: item,\n                    content: `Elemento de jerarqu√≠a: ${item}`,\n                    connections: index === 0 ? children : []\n                })),\n            instructions: [\n                'El elemento principal est√° en la parte superior',\n                'Los elementos secundarios se conectan hacia abajo',\n                'Cada nivel representa una subdivisi√≥n'\n            ]\n        };\n    }\n    /**\n   * Generates timeline visualization\n   */ static generateTimeline(content) {\n        const timeEvents = this.extractTimelineEvents(content);\n        let ascii = `‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\\n`;\n        timeEvents.forEach((event, index)=>{\n            const eventText = this.truncateText(event.event, 20);\n            const timeText = event.time || `T${index + 1}`;\n            if (index % 2 === 0) {\n                // Event above timeline\n                ascii += `‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\\n‚îÇ ${this.centerText(eventText, 19)} ‚îÇ\\n‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\\n           ‚îÇ\\n`;\n                ascii += `‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îø‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\\n`;\n                ascii += `           ${timeText}\\n\\n`;\n            } else {\n                // Event below timeline\n                ascii += `           ‚îÇ\\n           ‚îº\\n‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\\n‚îÇ ${this.centerText(eventText, 19)} ‚îÇ\\n‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\\n`;\n            }\n        });\n        return {\n            type: \"timeline\",\n            ascii: ascii,\n            description: `L√≠nea de tiempo con ${timeEvents.length} eventos cronol√≥gicos`,\n            elements: timeEvents.map((event, index)=>({\n                    id: `event_${index}`,\n                    type: \"timeline\",\n                    title: event.time || `Evento ${index + 1}`,\n                    content: event.event,\n                    connections: []\n                })),\n            instructions: [\n                'Los eventos se muestran en orden cronol√≥gico',\n                'La l√≠nea horizontal representa el tiempo',\n                'Los eventos alternos aparecen arriba y abajo de la l√≠nea'\n            ]\n        };\n    }\n    /**\n   * Generates formula visualization\n   */ static generateFormulaVisualization(content) {\n        const formula = this.extractFormula(content);\n        const variables = this.extractVariables(content);\n        let ascii = `\n‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó\n‚ïë         F√ìRMULA MATEM√ÅTICA        ‚ïë\n‚ï†‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï£\n‚ïë                                   ‚ïë\n‚ïë         ${this.centerText(formula, 19)}         ‚ïë\n‚ïë                                   ‚ïë\n‚ï†‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï£\n‚ïë           VARIABLES:              ‚ïë`;\n        variables.forEach((variable)=>{\n            ascii += `\n‚ïë  ${variable.symbol} = ${this.truncateText(variable.description, 20)}    ‚ïë`;\n        });\n        ascii += `\n‚ïë                                   ‚ïë\n‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù\n\n    Representaci√≥n visual:\n    \n         ${formula}\n         ‚Üô     ‚Üò\n    Variable   Resultado\n      ${variables[0]?.symbol || 'x'}         y`;\n        return {\n            type: \"formula_visualization\",\n            ascii: ascii,\n            description: `Visualizaci√≥n de la f√≥rmula ${formula} con ${variables.length} variables`,\n            elements: [\n                {\n                    id: 'formula_main',\n                    type: \"formula_visualization\",\n                    title: 'F√≥rmula Principal',\n                    content: formula,\n                    connections: variables.map((_, index)=>`var_${index}`)\n                }\n            ].concat(variables.map((variable, index)=>({\n                    id: `var_${index}`,\n                    type: \"formula_visualization\",\n                    title: variable.symbol,\n                    content: variable.description,\n                    connections: []\n                }))),\n            instructions: [\n                'La f√≥rmula principal se muestra en el centro',\n                'Las variables se definen en la tabla inferior',\n                'Sustituye los valores para resolver'\n            ]\n        };\n    }\n    /**\n   * Generates chemical structure visualization\n   */ static generateChemicalStructure(content) {\n        const molecule = this.extractMolecule(content);\n        const atoms = this.extractAtoms(content);\n        let ascii = '';\n        // Simple molecular representations\n        if (molecule.toLowerCase().includes('h2o') || molecule.toLowerCase().includes('agua')) {\n            ascii = `\n        Estructura del Agua (H‚ÇÇO)\n        \n            H\n            ‚îÇ\n        H‚îÄO‚îÄH    o    H‚îÄO‚îÄH\n            \n        Representaci√≥n angular:\n        \n            H\n             \\\\\n              O\n             /\n            H\n              \n        √Ångulo H-O-H: 104.5¬∞`;\n        } else if (molecule.toLowerCase().includes('co2')) {\n            ascii = `\n        Estructura del CO‚ÇÇ\n        \n        O‚ïêC‚ïêO\n        \n        Lineal, 180¬∞\n        \n        Enlaces dobles:\n        O ‚ïê‚ïê C ‚ïê‚ïê O`;\n        } else if (molecule.toLowerCase().includes('ch4') || molecule.toLowerCase().includes('metano')) {\n            ascii = `\n        Estructura del Metano (CH‚ÇÑ)\n        \n           H\n           ‚îÇ\n        H‚îÄC‚îÄH\n           ‚îÇ\n           H\n           \n        Tetra√©drica\n        √Ångulo H-C-H: 109.5¬∞`;\n        } else {\n            ascii = `\n        Estructura Molecular\n        \n        ${molecule}\n        \n        √Åtomos identificados:\n        ${atoms.map((atom)=>`‚Ä¢ ${atom}`).join('\\n        ')}\n        \n        Representaci√≥n esquem√°tica:\n        \n        [√Åtomo1]‚îÄ[√Åtomo2]‚îÄ[√Åtomo3]`;\n        }\n        return {\n            type: \"chemical_structure\",\n            ascii: ascii,\n            description: `Estructura qu√≠mica de ${molecule} mostrando ${atoms.length} tipos de √°tomos`,\n            elements: [\n                {\n                    id: 'molecule_main',\n                    type: \"chemical_structure\",\n                    title: molecule,\n                    content: `Mol√©cula: ${molecule}`,\n                    connections: atoms.map((_, index)=>`atom_${index}`)\n                }\n            ].concat(atoms.map((atom, index)=>({\n                    id: `atom_${index}`,\n                    type: \"chemical_structure\",\n                    title: atom,\n                    content: `√Åtomo: ${atom}`,\n                    connections: []\n                }))),\n            instructions: [\n                'Los √°tomos se representan con sus s√≠mbolos',\n                'Las l√≠neas representan enlaces qu√≠micos',\n                'Los √°ngulos muestran la geometr√≠a molecular'\n            ]\n        };\n    }\n    /**\n   * Generates process flow visualization\n   */ static generateProcessFlow(content) {\n        const processes = this.extractProcesses(content);\n        let ascii = `\n    FLUJO DEL PROCESO\n    \n    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê`;\n        processes.forEach((process, index)=>{\n            const processText = this.truncateText(process, 15);\n            if (index === 0) {\n                ascii += `\n    ‚îÇ   ${this.centerText(processText, 9)}   ‚îÇ\n    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n          ‚îÇ\n          ‚ñº`;\n            } else {\n                ascii += `\n    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n    ‚îÇ   ${this.centerText(processText, 9)}   ‚îÇ\n    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n          ‚îÇ\n          ‚ñº`;\n            }\n        });\n        ascii += `\n    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n    ‚îÇ   FINAL     ‚îÇ\n    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò`;\n        return {\n            type: \"process_flow\",\n            ascii: ascii,\n            description: `Flujo de proceso con ${processes.length} etapas secuenciales`,\n            elements: processes.map((process, index)=>({\n                    id: `process_${index}`,\n                    type: \"process_flow\",\n                    title: `Proceso ${index + 1}`,\n                    content: process,\n                    connections: index < processes.length - 1 ? [\n                        `process_${index + 1}`\n                    ] : []\n                })),\n            instructions: [\n                'Sigue el flujo de arriba hacia abajo',\n                'Cada caja representa una etapa del proceso',\n                'Las flechas indican la secuencia'\n            ]\n        };\n    }\n    /**\n   * Generates generic diagram\n   */ static generateGenericDiagram(content) {\n        const keyPoints = this.extractKeyPoints(content, 4);\n        let ascii = `\n    ‚ï≠‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ïÆ\n    ‚îÇ        DIAGRAMA GENERAL         ‚îÇ\n    ‚ï∞‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ïØ\n                  ‚îÇ`;\n        keyPoints.forEach((point, index)=>{\n            const pointText = this.truncateText(point, 20);\n            ascii += `\n                  ‚ñº\n    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n    ‚îÇ ${index + 1}. ${this.leftAlign(pointText, 23)} ‚îÇ\n    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò`;\n        });\n        return {\n            type: \"diagram\",\n            ascii: ascii,\n            description: `Diagrama general con ${keyPoints.length} elementos principales`,\n            elements: keyPoints.map((point, index)=>({\n                    id: `point_${index}`,\n                    type: \"diagram\",\n                    title: `Punto ${index + 1}`,\n                    content: point,\n                    connections: []\n                })),\n            instructions: [\n                'Cada elemento se presenta de forma secuencial',\n                'Los n√∫meros indican el orden de importancia',\n                'Revisa cada punto para comprensi√≥n completa'\n            ]\n        };\n    }\n    // ===== UTILITY FUNCTIONS =====\n    /**\n   * Extracts main concepts from content\n   */ static extractConcepts(content) {\n        const sentences = content.split(/[.!?]+/);\n        const concepts = [];\n        for (const sentence of sentences){\n            const words = sentence.trim().split(' ');\n            const importantWords = words.filter((word)=>word.length > 4 && ![\n                    'este',\n                    'esta',\n                    'estos',\n                    'estas',\n                    'cuando',\n                    'donde',\n                    'porque'\n                ].includes(word.toLowerCase()));\n            if (importantWords.length > 0) {\n                concepts.push(importantWords[0]);\n            }\n            if (concepts.length >= 5) break;\n        }\n        return concepts.length > 0 ? concepts : [\n            'Concepto Principal'\n        ];\n    }\n    /**\n   * Extracts steps from content\n   */ static extractSteps(content) {\n        // Look for numbered steps or sequential indicators\n        const stepPatterns = [\n            /\\d+[.)]\\s*([^.!?]+)/g,\n            /paso \\d+:?\\s*([^.!?]+)/gi,\n            /(primero|segundo|tercero|luego|despu√©s|finalmente)[,:]?\\s*([^.!?]+)/gi\n        ];\n        const steps = [];\n        for (const pattern of stepPatterns){\n            let match;\n            while((match = pattern.exec(content)) !== null && steps.length < 6){\n                const step = match[1] || match[2];\n                if (step && step.trim().length > 5) {\n                    steps.push(step.trim());\n                }\n            }\n        }\n        if (steps.length === 0) {\n            // Fallback: split by sentences\n            const sentences = content.split(/[.!?]+/);\n            steps.push(...sentences.slice(0, 4).filter((s)=>s.trim().length > 10));\n        }\n        return steps.slice(0, 5);\n    }\n    /**\n   * Extracts hierarchy items\n   */ static extractHierarchy(content) {\n        const hierarchyWords = [\n            'principal',\n            'secundario',\n            'tipo',\n            'categor√≠a',\n            'clase',\n            'grupo'\n        ];\n        const items = [];\n        const sentences = content.split(/[.!?]+/);\n        for (const sentence of sentences){\n            for (const word of hierarchyWords){\n                if (sentence.toLowerCase().includes(word)) {\n                    const cleanSentence = sentence.replace(/^\\s*\\d+[.)]\\s*/, '').trim();\n                    if (cleanSentence.length > 5) {\n                        items.push(cleanSentence);\n                        break;\n                    }\n                }\n            }\n            if (items.length >= 6) break;\n        }\n        return items.length > 0 ? items : [\n            'Elemento Principal',\n            'Subelemento 1',\n            'Subelemento 2'\n        ];\n    }\n    /**\n   * Extracts timeline events\n   */ static extractTimelineEvents(content) {\n        const timePattern = /(\\d{4}|\\d{1,2}:\\d{2}|siglo \\w+|era \\w+)/gi;\n        const events = [];\n        const sentences = content.split(/[.!?]+/);\n        for (const sentence of sentences){\n            const timeMatch = sentence.match(timePattern);\n            if (timeMatch) {\n                events.push({\n                    time: timeMatch[0],\n                    event: sentence.replace(timePattern, '').trim()\n                });\n            }\n        }\n        if (events.length === 0) {\n            // Fallback timeline\n            const keyEvents = sentences.slice(0, 3).filter((s)=>s.trim().length > 10);\n            keyEvents.forEach((event, index)=>{\n                events.push({\n                    time: `T${index + 1}`,\n                    event: event.trim()\n                });\n            });\n        }\n        return events.slice(0, 5);\n    }\n    /**\n   * Extracts formula from content\n   */ static extractFormula(content) {\n        // Look for mathematical expressions\n        const formulaPatterns = [\n            /([a-zA-Z]\\s*[=]\\s*[^.!?]+)/,\n            /([a-zA-Z]+\\s*\\(\\s*[a-zA-Z,\\s]+\\s*\\))/,\n            /(f\\([x-z]\\)\\s*=\\s*[^.!?]+)/i,\n            /([xy]\\s*=\\s*[^.!?]+)/\n        ];\n        for (const pattern of formulaPatterns){\n            const match = content.match(pattern);\n            if (match) {\n                return match[1].trim();\n            }\n        }\n        // Fallback\n        if (content.includes('=')) {\n            const parts = content.split('=');\n            if (parts.length >= 2) {\n                return `${parts[0].trim()} = ${parts[1].split(/[.!?]/)[0].trim()}`;\n            }\n        }\n        return 'y = f(x)';\n    }\n    /**\n   * Extracts variables from content\n   */ static extractVariables(content) {\n        const variables = [];\n        // Look for variable definitions like \"donde x es...\"\n        const varPattern = /([a-zA-Z])\\s+es\\s+([^.!?]+)/gi;\n        let match;\n        while((match = varPattern.exec(content)) !== null && variables.length < 4){\n            variables.push({\n                symbol: match[1],\n                description: match[2].trim()\n            });\n        }\n        if (variables.length === 0) {\n            variables.push({\n                symbol: 'x',\n                description: 'variable independiente'\n            }, {\n                symbol: 'y',\n                description: 'variable dependiente'\n            });\n        }\n        return variables;\n    }\n    /**\n   * Extracts molecule information\n   */ static extractMolecule(content) {\n        const moleculePatterns = [\n            /([A-Z][a-z]?\\d*)+/g,\n            /(agua|metano|di√≥xido|carbono|ox√≠geno|hidr√≥geno)/i\n        ];\n        for (const pattern of moleculePatterns){\n            const match = content.match(pattern);\n            if (match) {\n                return match[0];\n            }\n        }\n        return 'Mol√©cula';\n    }\n    /**\n   * Extracts atoms from content\n   */ static extractAtoms(content) {\n        const atomSymbols = content.match(/[A-Z][a-z]?/g) || [];\n        const uniqueAtoms = [\n            ...new Set(atomSymbols)\n        ];\n        if (uniqueAtoms.length === 0) {\n            return [\n                'C',\n                'H',\n                'O'\n            ];\n        }\n        return uniqueAtoms.slice(0, 5);\n    }\n    /**\n   * Extracts processes from content\n   */ static extractProcesses(content) {\n        const processes = this.extractSteps(content);\n        return processes.length > 0 ? processes : [\n            'Proceso 1',\n            'Proceso 2',\n            'Proceso 3'\n        ];\n    }\n    /**\n   * Extracts key points from content\n   */ static extractKeyPoints(content, limit = 4) {\n        const sentences = content.split(/[.!?]+/);\n        return sentences.filter((s)=>s.trim().length > 10).slice(0, limit).map((s)=>s.trim());\n    }\n    // ===== TEXT FORMATTING UTILITIES =====\n    /**\n   * Centers text in a fixed width\n   */ static centerText(text, width) {\n        const truncated = this.truncateText(text, width);\n        const padding = Math.max(0, width - truncated.length);\n        const leftPad = Math.floor(padding / 2);\n        const rightPad = padding - leftPad;\n        return ' '.repeat(leftPad) + truncated + ' '.repeat(rightPad);\n    }\n    /**\n   * Left aligns text in a fixed width\n   */ static leftAlign(text, width) {\n        const truncated = this.truncateText(text, width);\n        const padding = Math.max(0, width - truncated.length);\n        return truncated + ' '.repeat(padding);\n    }\n    /**\n   * Truncates text to fit width\n   */ static truncateText(text, maxWidth) {\n        if (text.length <= maxWidth) {\n            return text;\n        }\n        return text.substring(0, maxWidth - 3) + '...';\n    }\n    /**\n   * Main entry point - analyzes content and generates appropriate visual\n   */ static generateOptimalVisual(content, subject) {\n        const optimalType = this.detectOptimalVisualType(content, subject);\n        return this.generateVisual(content, optimalType, subject);\n    }\n    /**\n   * Generates multiple visual options for user to choose from\n   */ static generateVisualOptions(content, subject) {\n        const primaryType = this.detectOptimalVisualType(content, subject);\n        const options = [\n            this.generateVisual(content, primaryType, subject)\n        ];\n        // Add alternative visualizations\n        const alternativeTypes = [\n            \"concept_map\",\n            \"flowchart\",\n            \"diagram\"\n        ];\n        for (const type of alternativeTypes){\n            if (type !== primaryType && options.length < 3) {\n                options.push(this.generateVisual(content, type, subject));\n            }\n        }\n        return options;\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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Q0FBQ0MsU0FBU0MsTUFBTUM7WUFDbEQ7UUFDRjtRQUVBLE9BQU93SDtJQUNUO0FBQ0YiLCJzb3VyY2VzIjpbIi9Vc2Vycy9yb2RyaWdvZGliZXJuYXJkbzMzZ21haWwuY29tL0RvY3VtZW50cy9BcHAgRGV2ZWxvcG1lbnQgUHJveWVjdHMvSW50ZWxsZWdvIFBsYXRmb3JtL3NyYy9saWIvdmlzdWFsLWxlYXJuaW5nLWVuZ2luZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBWaXN1YWwgTGVhcm5pbmcgRW5naW5lIGZvciBTYXJhIEFJXG4vLyBHZW5lcmF0ZXMgQVNDSUkgZGlhZ3JhbXMsIGNvbmNlcHR1YWwgbWFwcywgYW5kIHZpc3VhbCByZXByZXNlbnRhdGlvbnMgZm9yIGVuaGFuY2VkIGxlYXJuaW5nXG5cbmV4cG9ydCBlbnVtIFZpc3VhbFR5cGUge1xuICBDT05DRVBUX01BUCA9ICdjb25jZXB0X21hcCcsXG4gIEZMT1dDSEFSVCA9ICdmbG93Y2hhcnQnLFxuICBISUVSQVJDSFkgPSAnaGllcmFyY2h5JyxcbiAgVElNRUxJTkUgPSAndGltZWxpbmUnLFxuICBESUFHUkFNID0gJ2RpYWdyYW0nLFxuICBGT1JNVUxBX1ZJU1VBTElaQVRJT04gPSAnZm9ybXVsYV92aXN1YWxpemF0aW9uJyxcbiAgQ0hFTUlDQUxfU1RSVUNUVVJFID0gJ2NoZW1pY2FsX3N0cnVjdHVyZScsXG4gIE1BVEhfR1JBUEggPSAnbWF0aF9ncmFwaCcsXG4gIFBST0NFU1NfRkxPVyA9ICdwcm9jZXNzX2Zsb3cnXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgVmlzdWFsRWxlbWVudCB7XG4gIGlkOiBzdHJpbmdcbiAgdHlwZTogVmlzdWFsVHlwZVxuICB0aXRsZTogc3RyaW5nXG4gIGNvbnRlbnQ6IHN0cmluZ1xuICBjb25uZWN0aW9ucz86IHN0cmluZ1tdXG4gIG1ldGFkYXRhPzoge1xuICAgIHN1YmplY3Q/OiBzdHJpbmdcbiAgICBkaWZmaWN1bHR5PzogJ2Jhc2ljJyB8ICdpbnRlcm1lZGlhdGUnIHwgJ2FkdmFuY2VkJ1xuICAgIGtleXdvcmRzPzogc3RyaW5nW11cbiAgfVxufVxuXG5leHBvcnQgaW50ZXJmYWNlIFZpc3VhbFJlcHJlc2VudGF0aW9uIHtcbiAgdHlwZTogVmlzdWFsVHlwZVxuICBhc2NpaTogc3RyaW5nXG4gIGRlc2NyaXB0aW9uOiBzdHJpbmdcbiAgZWxlbWVudHM6IFZpc3VhbEVsZW1lbnRbXVxuICBpbnN0cnVjdGlvbnM6IHN0cmluZ1tdXG59XG5cbmV4cG9ydCBjbGFzcyBWaXN1YWxMZWFybmluZ0VuZ2luZSB7XG5cbiAgLyoqXG4gICAqIEdlbmVyYXRlcyB2aXN1YWwgcmVwcmVzZW50YXRpb24gYmFzZWQgb24gY29udGVudCBhbmQgdHlwZVxuICAgKi9cbiAgc3RhdGljIGdlbmVyYXRlVmlzdWFsKGNvbnRlbnQ6IHN0cmluZywgdHlwZTogVmlzdWFsVHlwZSwgc3ViamVjdD86IHN0cmluZyk6IFZpc3VhbFJlcHJlc2VudGF0aW9uIHtcbiAgICBzd2l0Y2ggKHR5cGUpIHtcbiAgICAgIGNhc2UgVmlzdWFsVHlwZS5DT05DRVBUX01BUDpcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2VuZXJhdGVDb25jZXB0TWFwKGNvbnRlbnQsIHN1YmplY3QpXG4gICAgICBjYXNlIFZpc3VhbFR5cGUuRkxPV0NIQVJUOlxuICAgICAgICByZXR1cm4gdGhpcy5nZW5lcmF0ZUZsb3djaGFydChjb250ZW50KVxuICAgICAgY2FzZSBWaXN1YWxUeXBlLkhJRVJBUkNIWTpcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2VuZXJhdGVIaWVyYXJjaHkoY29udGVudClcbiAgICAgIGNhc2UgVmlzdWFsVHlwZS5USU1FTElORTpcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2VuZXJhdGVUaW1lbGluZShjb250ZW50KVxuICAgICAgY2FzZSBWaXN1YWxUeXBlLkZPUk1VTEFfVklTVUFMSVpBVElPTjpcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2VuZXJhdGVGb3JtdWxhVmlzdWFsaXphdGlvbihjb250ZW50KVxuICAgICAgY2FzZSBWaXN1YWxUeXBlLkNIRU1JQ0FMX1NUUlVDVFVSRTpcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2VuZXJhdGVDaGVtaWNhbFN0cnVjdHVyZShjb250ZW50KVxuICAgICAgY2FzZSBWaXN1YWxUeXBlLlBST0NFU1NfRkxPVzpcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2VuZXJhdGVQcm9jZXNzRmxvdyhjb250ZW50KVxuICAgICAgZGVmYXVsdDpcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2VuZXJhdGVHZW5lcmljRGlhZ3JhbShjb250ZW50KVxuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBBdXRvLWRldGVjdHMgdGhlIGJlc3QgdmlzdWFsIHR5cGUgZm9yIGNvbnRlbnRcbiAgICovXG4gIHN0YXRpYyBkZXRlY3RPcHRpbWFsVmlzdWFsVHlwZShjb250ZW50OiBzdHJpbmcsIHN1YmplY3Q/OiBzdHJpbmcpOiBWaXN1YWxUeXBlIHtcbiAgICBjb25zdCBjb250ZW50TG93ZXIgPSBjb250ZW50LnRvTG93ZXJDYXNlKClcblxuICAgIC8vIENoZW1pY2FsIGZvcm11bGFzIGFuZCBzdHJ1Y3R1cmVzXG4gICAgaWYgKHN1YmplY3QgPT09ICdjaGVtaXN0cnknIHx8IHN1YmplY3QgPT09ICdxdcOtbWljYScgfHwgXG4gICAgICAgIC9oMm98Y28yfG5hY2x8Y2g0fGZvcm11bGF8bW9sZWN1bGFyfMOhdG9tb3xtb2zDqWN1bGEvLnRlc3QoY29udGVudExvd2VyKSkge1xuICAgICAgcmV0dXJuIFZpc3VhbFR5cGUuQ0hFTUlDQUxfU1RSVUNUVVJFXG4gICAgfVxuXG4gICAgLy8gTWF0aGVtYXRpY2FsIGZvcm11bGFzXG4gICAgaWYgKHN1YmplY3QgPT09ICdtYXRoZW1hdGljcycgfHwgc3ViamVjdCA9PT0gJ21hdGVtw6F0aWNhcycgfHwgXG4gICAgICAgIC9lY3VhY2nDs258Zm9ybXVsYXxmdW5jacOzbnxkZXJpdmFkYXxpbnRlZ3JhbHxncsOhZmljYS8udGVzdChjb250ZW50TG93ZXIpKSB7XG4gICAgICByZXR1cm4gVmlzdWFsVHlwZS5GT1JNVUxBX1ZJU1VBTElaQVRJT05cbiAgICB9XG5cbiAgICAvLyBQcm9jZXNzIG9yIHN0ZXAtYnktc3RlcCBjb250ZW50XG4gICAgaWYgKC9wYXNvfHN0ZXB8cHJvY2Vzb3xsdWVnb3xkZXNwdcOpc3xlbnRvbmNlc3xwcmltZXJvfHNlZ3VuZG8vLnRlc3QoY29udGVudExvd2VyKSkge1xuICAgICAgcmV0dXJuIFZpc3VhbFR5cGUuUFJPQ0VTU19GTE9XXG4gICAgfVxuXG4gICAgLy8gSGllcmFyY2hpY2FsIGNvbnRlbnRcbiAgICBpZiAoL2NsYXNpZmljYWNpw7NufGNhdGVnb3LDrWF8dGlwb3xuaXZlbHxqZXJhcnF1w61hfHN1cGVyaW9yfGluZmVyaW9yLy50ZXN0KGNvbnRlbnRMb3dlcikpIHtcbiAgICAgIHJldHVybiBWaXN1YWxUeXBlLkhJRVJBUkNIWVxuICAgIH1cblxuICAgIC8vIFRpbWVsaW5lIGNvbnRlbnRcbiAgICBpZiAoL2HDsW98ZmVjaGF8c2lnbG98w6lwb2NhfGFudGVzfGRlc3B1w6lzfGhpc3RvcmlhfGNyb25vbG9nw61hLy50ZXN0KGNvbnRlbnRMb3dlcikpIHtcbiAgICAgIHJldHVybiBWaXN1YWxUeXBlLlRJTUVMSU5FXG4gICAgfVxuXG4gICAgLy8gQ29uY2VwdHVhbCByZWxhdGlvbnNoaXBzXG4gICAgaWYgKC9yZWxhY2nDs258Y29uY2VwdG98aWRlYXxjb25lY3RhfHZpbmN1bGF8YXNvY2lhLy50ZXN0KGNvbnRlbnRMb3dlcikpIHtcbiAgICAgIHJldHVybiBWaXN1YWxUeXBlLkNPTkNFUFRfTUFQXG4gICAgfVxuXG4gICAgLy8gRGVmYXVsdCB0byBmbG93Y2hhcnQgZm9yIGdlbmVyYWwgY29udGVudFxuICAgIHJldHVybiBWaXN1YWxUeXBlLkZMT1dDSEFSVFxuICB9XG5cbiAgLyoqXG4gICAqIEdlbmVyYXRlcyBjb25jZXB0IG1hcCB2aXN1YWxpemF0aW9uXG4gICAqL1xuICBzdGF0aWMgZ2VuZXJhdGVDb25jZXB0TWFwKGNvbnRlbnQ6IHN0cmluZywgc3ViamVjdD86IHN0cmluZyk6IFZpc3VhbFJlcHJlc2VudGF0aW9uIHtcbiAgICBjb25zdCBjb25jZXB0cyA9IHRoaXMuZXh0cmFjdENvbmNlcHRzKGNvbnRlbnQpXG4gICAgY29uc3QgbWFpbkNvbmNlcHQgPSBjb25jZXB0c1swXSB8fCAnQ29uY2VwdG8gUHJpbmNpcGFsJ1xuICAgIGNvbnN0IHJlbGF0ZWRDb25jZXB0cyA9IGNvbmNlcHRzLnNsaWNlKDEsIDUpXG5cbiAgICBsZXQgYXNjaWkgPSBgXG7ilIzilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilJBcbuKUgiAgICR7dGhpcy5jZW50ZXJUZXh0KG1haW5Db25jZXB0LCAxNyl9ICAg4pSCXG7ilJTilIDilIDilIDilIDilIDilIDilIDilIDilIDilKzilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilJhcbiAgICAgICAgICDilIJcbiAgICDilIzilIDilIDilIDilIDilIDilLTilIDilIDilIDilIDilIDilJBcbiAgICDilIIgICAgICAgICAgIOKUgmBcblxuICAgIHJlbGF0ZWRDb25jZXB0cy5mb3JFYWNoKChjb25jZXB0LCBpbmRleCkgPT4ge1xuICAgICAgaWYgKGluZGV4IDwgMikge1xuICAgICAgICBhc2NpaSArPSBgXG7ilIzilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilJAgICAg4pSM4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSQXG7ilIIgJHt0aGlzLmNlbnRlclRleHQoY29uY2VwdCwgMTIpfSDilIIgICAg4pSCICAgICAgICAgICAgICDilIJcbuKUlOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUmCAgICDilJTilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilJhgXG4gICAgICB9XG4gICAgfSlcblxuICAgIGlmIChyZWxhdGVkQ29uY2VwdHMubGVuZ3RoID4gMikge1xuICAgICAgYXNjaWkgKz0gYFxuICAgIOKUgiAgICAgICAgICAg4pSCXG7ilIzilIDilIDilIDilLTilIDilIDilIDilIDilIDilJAg4pSM4pSA4pSA4pSA4pSA4pSA4pS04pSA4pSA4pSA4pSQYFxuICAgICAgcmVsYXRlZENvbmNlcHRzLnNsaWNlKDIsIDQpLmZvckVhY2goY29uY2VwdCA9PiB7XG4gICAgICAgIGFzY2lpICs9IGBcbuKUgiAke3RoaXMuY2VudGVyVGV4dChjb25jZXB0LCA3KX0g4pSCIOKUgiAgICAgICAgIOKUgmBcbiAgICAgIH0pXG4gICAgICBhc2NpaSArPSBgXG7ilJTilIDilIDilIDilIDilIDilIDilIDilIDilIDilJgg4pSU4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSYYFxuICAgIH1cblxuICAgIHJldHVybiB7XG4gICAgICB0eXBlOiBWaXN1YWxUeXBlLkNPTkNFUFRfTUFQLFxuICAgICAgYXNjaWk6IGFzY2lpLFxuICAgICAgZGVzY3JpcHRpb246IGBNYXBhIGNvbmNlcHR1YWwgcXVlIG11ZXN0cmEgbGFzIHJlbGFjaW9uZXMgZW50cmUgJHttYWluQ29uY2VwdH0geSBjb25jZXB0b3MgcmVsYWNpb25hZG9zYCxcbiAgICAgIGVsZW1lbnRzOiBjb25jZXB0cy5tYXAoKGNvbmNlcHQsIGluZGV4KSA9PiAoe1xuICAgICAgICBpZDogYGNvbmNlcHRfJHtpbmRleH1gLFxuICAgICAgICB0eXBlOiBWaXN1YWxUeXBlLkNPTkNFUFRfTUFQLFxuICAgICAgICB0aXRsZTogY29uY2VwdCxcbiAgICAgICAgY29udGVudDogYENvbmNlcHRvOiAke2NvbmNlcHR9YCxcbiAgICAgICAgY29ubmVjdGlvbnM6IGluZGV4ID09PSAwID8gcmVsYXRlZENvbmNlcHRzIDogW21haW5Db25jZXB0XVxuICAgICAgfSkpLFxuICAgICAgaW5zdHJ1Y3Rpb25zOiBbXG4gICAgICAgICdFbCBjb25jZXB0byBjZW50cmFsIGFwYXJlY2UgZW4gbGEgcGFydGUgc3VwZXJpb3InLFxuICAgICAgICAnTGFzIGzDrW5lYXMgY29uZWN0YW4gY29uY2VwdG9zIHJlbGFjaW9uYWRvcycsXG4gICAgICAgICdMb3MgY29uY2VwdG9zIHNlY3VuZGFyaW9zIHNlIHJhbWlmaWNhbiBkZWwgcHJpbmNpcGFsJ1xuICAgICAgXVxuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBHZW5lcmF0ZXMgZmxvd2NoYXJ0IHZpc3VhbGl6YXRpb25cbiAgICovXG4gIHN0YXRpYyBnZW5lcmF0ZUZsb3djaGFydChjb250ZW50OiBzdHJpbmcpOiBWaXN1YWxSZXByZXNlbnRhdGlvbiB7XG4gICAgY29uc3Qgc3RlcHMgPSB0aGlzLmV4dHJhY3RTdGVwcyhjb250ZW50KVxuICAgIFxuICAgIGxldCBhc2NpaSA9IGDilIzilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilJBcXG7ilIIgICBJTklDSU8gICAg4pSCXFxu4pSU4pSA4pSA4pSA4pSA4pSA4pSA4pSs4pSA4pSA4pSA4pSA4pSA4pSA4pSYXFxuICAgICAgIOKUglxcbiAgICAgICDilrxgXG5cbiAgICBzdGVwcy5mb3JFYWNoKChzdGVwLCBpbmRleCkgPT4ge1xuICAgICAgY29uc3Qgc3RlcFRleHQgPSB0aGlzLnRydW5jYXRlVGV4dChzdGVwLCAxNSlcbiAgICAgIGFzY2lpICs9IGBcbuKUjOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUkFxu4pSCICR7dGhpcy5jZW50ZXJUZXh0KHN0ZXBUZXh0LCAxNSl9IOKUglxu4pSU4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSs4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSYXG4gICAgICAgICAg4pSCXG4gICAgICAgICAg4pa8YFxuICAgIH0pXG5cbiAgICBhc2NpaSArPSBgXG7ilIzilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilJBcbuKUgiAgICBGSU4gICAgICDilIJcbuKUlOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUmGBcblxuICAgIHJldHVybiB7XG4gICAgICB0eXBlOiBWaXN1YWxUeXBlLkZMT1dDSEFSVCxcbiAgICAgIGFzY2lpOiBhc2NpaSxcbiAgICAgIGRlc2NyaXB0aW9uOiBgRGlhZ3JhbWEgZGUgZmx1am8gcXVlIG11ZXN0cmEgJHtzdGVwcy5sZW5ndGh9IHBhc29zIGRlbCBwcm9jZXNvYCxcbiAgICAgIGVsZW1lbnRzOiBzdGVwcy5tYXAoKHN0ZXAsIGluZGV4KSA9PiAoe1xuICAgICAgICBpZDogYHN0ZXBfJHtpbmRleH1gLFxuICAgICAgICB0eXBlOiBWaXN1YWxUeXBlLkZMT1dDSEFSVCxcbiAgICAgICAgdGl0bGU6IGBQYXNvICR7aW5kZXggKyAxfWAsXG4gICAgICAgIGNvbnRlbnQ6IHN0ZXAsXG4gICAgICAgIGNvbm5lY3Rpb25zOiBpbmRleCA8IHN0ZXBzLmxlbmd0aCAtIDEgPyBbYHN0ZXBfJHtpbmRleCArIDF9YF0gOiBbXVxuICAgICAgfSkpLFxuICAgICAgaW5zdHJ1Y3Rpb25zOiBbXG4gICAgICAgICdTaWd1ZSBsYXMgZmxlY2hhcyBkZSBhcnJpYmEgaGFjaWEgYWJham8nLFxuICAgICAgICAnQ2FkYSBjYWphIHJlcHJlc2VudGEgdW4gcGFzbyBkZWwgcHJvY2VzbycsXG4gICAgICAgICdFbCBmbHVqbyB2YSBkZXNkZSBJTklDSU8gaGFzdGEgRklOJ1xuICAgICAgXVxuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBHZW5lcmF0ZXMgaGllcmFyY2h5IHZpc3VhbGl6YXRpb25cbiAgICovXG4gIHN0YXRpYyBnZW5lcmF0ZUhpZXJhcmNoeShjb250ZW50OiBzdHJpbmcpOiBWaXN1YWxSZXByZXNlbnRhdGlvbiB7XG4gICAgY29uc3QgaGllcmFyY2h5SXRlbXMgPSB0aGlzLmV4dHJhY3RIaWVyYXJjaHkoY29udGVudClcbiAgICBjb25zdCByb290ID0gaGllcmFyY2h5SXRlbXNbMF0gfHwgJ0VsZW1lbnRvIFByaW5jaXBhbCdcbiAgICBjb25zdCBjaGlsZHJlbiA9IGhpZXJhcmNoeUl0ZW1zLnNsaWNlKDEsIDQpXG4gICAgY29uc3QgZ3JhbmRjaGlsZHJlbiA9IGhpZXJhcmNoeUl0ZW1zLnNsaWNlKDQsIDgpXG5cbiAgICBsZXQgYXNjaWkgPSBgXG4gICAgICAgICAgICAgICAgICAgIOKUjOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUkFxuICAgICAgICAgICAgICAgICAgICDilIIgJHt0aGlzLmNlbnRlclRleHQocm9vdCwgMTYpfSDilIJcbiAgICAgICAgICAgICAgICAgICAg4pSU4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSs4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSYXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICDilIJcbiAgICAgICAgICAgICAgICAg4pSM4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pS84pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSQYFxuXG4gICAgY2hpbGRyZW4uZm9yRWFjaCgoY2hpbGQsIGluZGV4KSA9PiB7XG4gICAgICBjb25zdCBzcGFjaW5nID0gaW5kZXggPT09IDAgPyAnICAgICAnIDogaW5kZXggPT09IDEgPyAnICAgICAgICAgICAnIDogJyAgICAgICAgICAgICAgICAgJ1xuICAgICAgYXNjaWkgKz0gYFxuICAgICAgICDilIzilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilJAke3NwYWNpbmd94pSM4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSQXG4gICAgICAgIOKUgiAke3RoaXMuY2VudGVyVGV4dChjaGlsZCwgMTEpfSDilIIke3NwYWNpbmd94pSCICAgICAgICAgICAgIOKUglxuICAgICAgICDilJTilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilJgke3NwYWNpbmd94pSU4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSYYFxuICAgIH0pXG5cbiAgICBpZiAoZ3JhbmRjaGlsZHJlbi5sZW5ndGggPiAwKSB7XG4gICAgICBhc2NpaSArPSBgXG4gICAgICAgICAgICAgIOKUgiAgICAgICAgICAgICAgICAgICAgIOKUglxuICAgICAgICDilIzilIDilIDilIDilIDilIDilLTilIDilIDilIDilIDilIDilJAgICAgICAgICDilIzilIDilIDilIDilIDilIDilLTilIDilIDilIDilIDilIDilJBgXG4gICAgICBncmFuZGNoaWxkcmVuLnNsaWNlKDAsIDIpLmZvckVhY2goaXRlbSA9PiB7XG4gICAgICAgIGFzY2lpICs9IGBcbiAgICAgICAg4pSCICR7dGhpcy5jZW50ZXJUZXh0KGl0ZW0sIDkpfSDilIIgICAgICAgICDilIIgICAgICAgICAgIOKUgmBcbiAgICAgIH0pXG4gICAgICBhc2NpaSArPSBgXG4gICAgICAgIOKUlOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUmCAgICAgICAgIOKUlOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUmGBcbiAgICB9XG5cbiAgICByZXR1cm4ge1xuICAgICAgdHlwZTogVmlzdWFsVHlwZS5ISUVSQVJDSFksXG4gICAgICBhc2NpaTogYXNjaWksXG4gICAgICBkZXNjcmlwdGlvbjogYEplcmFycXXDrWEgcXVlIG11ZXN0cmEgbGEgZXN0cnVjdHVyYSBkZSAke3Jvb3R9IGNvbiAke2NoaWxkcmVuLmxlbmd0aH0gbml2ZWxlc2AsXG4gICAgICBlbGVtZW50czogaGllcmFyY2h5SXRlbXMubWFwKChpdGVtLCBpbmRleCkgPT4gKHtcbiAgICAgICAgaWQ6IGBoaWVyYXJjaHlfJHtpbmRleH1gLFxuICAgICAgICB0eXBlOiBWaXN1YWxUeXBlLkhJRVJBUkNIWSxcbiAgICAgICAgdGl0bGU6IGl0ZW0sXG4gICAgICAgIGNvbnRlbnQ6IGBFbGVtZW50byBkZSBqZXJhcnF1w61hOiAke2l0ZW19YCxcbiAgICAgICAgY29ubmVjdGlvbnM6IGluZGV4ID09PSAwID8gY2hpbGRyZW4gOiBbXVxuICAgICAgfSkpLFxuICAgICAgaW5zdHJ1Y3Rpb25zOiBbXG4gICAgICAgICdFbCBlbGVtZW50byBwcmluY2lwYWwgZXN0w6EgZW4gbGEgcGFydGUgc3VwZXJpb3InLFxuICAgICAgICAnTG9zIGVsZW1lbnRvcyBzZWN1bmRhcmlvcyBzZSBjb25lY3RhbiBoYWNpYSBhYmFqbycsXG4gICAgICAgICdDYWRhIG5pdmVsIHJlcHJlc2VudGEgdW5hIHN1YmRpdmlzacOzbidcbiAgICAgIF1cbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogR2VuZXJhdGVzIHRpbWVsaW5lIHZpc3VhbGl6YXRpb25cbiAgICovXG4gIHN0YXRpYyBnZW5lcmF0ZVRpbWVsaW5lKGNvbnRlbnQ6IHN0cmluZyk6IFZpc3VhbFJlcHJlc2VudGF0aW9uIHtcbiAgICBjb25zdCB0aW1lRXZlbnRzID0gdGhpcy5leHRyYWN0VGltZWxpbmVFdmVudHMoY29udGVudClcbiAgICBcbiAgICBsZXQgYXNjaWkgPSBg4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSBXFxuYFxuICAgIFxuICAgIHRpbWVFdmVudHMuZm9yRWFjaCgoZXZlbnQsIGluZGV4KSA9PiB7XG4gICAgICBjb25zdCBldmVudFRleHQgPSB0aGlzLnRydW5jYXRlVGV4dChldmVudC5ldmVudCwgMjApXG4gICAgICBjb25zdCB0aW1lVGV4dCA9IGV2ZW50LnRpbWUgfHwgYFQke2luZGV4ICsgMX1gXG4gICAgICBcbiAgICAgIGlmIChpbmRleCAlIDIgPT09IDApIHtcbiAgICAgICAgLy8gRXZlbnQgYWJvdmUgdGltZWxpbmVcbiAgICAgICAgYXNjaWkgKz0gYOKUjOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUkFxcbuKUgiAke3RoaXMuY2VudGVyVGV4dChldmVudFRleHQsIDE5KX0g4pSCXFxu4pSU4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSs4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSYXFxuICAgICAgICAgICDilIJcXG5gXG4gICAgICAgIGFzY2lpICs9IGDilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilL/ilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIFcXG5gXG4gICAgICAgIGFzY2lpICs9IGAgICAgICAgICAgICR7dGltZVRleHR9XFxuXFxuYFxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gRXZlbnQgYmVsb3cgdGltZWxpbmVcbiAgICAgICAgYXNjaWkgKz0gYCAgICAgICAgICAg4pSCXFxuICAgICAgICAgICDilLxcXG7ilIzilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilLTilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilJBcXG7ilIIgJHt0aGlzLmNlbnRlclRleHQoZXZlbnRUZXh0LCAxOSl9IOKUglxcbuKUlOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUmFxcbmBcbiAgICAgIH1cbiAgICB9KVxuXG4gICAgcmV0dXJuIHtcbiAgICAgIHR5cGU6IFZpc3VhbFR5cGUuVElNRUxJTkUsXG4gICAgICBhc2NpaTogYXNjaWksXG4gICAgICBkZXNjcmlwdGlvbjogYEzDrW5lYSBkZSB0aWVtcG8gY29uICR7dGltZUV2ZW50cy5sZW5ndGh9IGV2ZW50b3MgY3Jvbm9sw7NnaWNvc2AsXG4gICAgICBlbGVtZW50czogdGltZUV2ZW50cy5tYXAoKGV2ZW50LCBpbmRleCkgPT4gKHtcbiAgICAgICAgaWQ6IGBldmVudF8ke2luZGV4fWAsXG4gICAgICAgIHR5cGU6IFZpc3VhbFR5cGUuVElNRUxJTkUsXG4gICAgICAgIHRpdGxlOiBldmVudC50aW1lIHx8IGBFdmVudG8gJHtpbmRleCArIDF9YCxcbiAgICAgICAgY29udGVudDogZXZlbnQuZXZlbnQsXG4gICAgICAgIGNvbm5lY3Rpb25zOiBbXVxuICAgICAgfSkpLFxuICAgICAgaW5zdHJ1Y3Rpb25zOiBbXG4gICAgICAgICdMb3MgZXZlbnRvcyBzZSBtdWVzdHJhbiBlbiBvcmRlbiBjcm9ub2zDs2dpY28nLFxuICAgICAgICAnTGEgbMOtbmVhIGhvcml6b250YWwgcmVwcmVzZW50YSBlbCB0aWVtcG8nLFxuICAgICAgICAnTG9zIGV2ZW50b3MgYWx0ZXJub3MgYXBhcmVjZW4gYXJyaWJhIHkgYWJham8gZGUgbGEgbMOtbmVhJ1xuICAgICAgXVxuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBHZW5lcmF0ZXMgZm9ybXVsYSB2aXN1YWxpemF0aW9uXG4gICAqL1xuICBzdGF0aWMgZ2VuZXJhdGVGb3JtdWxhVmlzdWFsaXphdGlvbihjb250ZW50OiBzdHJpbmcpOiBWaXN1YWxSZXByZXNlbnRhdGlvbiB7XG4gICAgY29uc3QgZm9ybXVsYSA9IHRoaXMuZXh0cmFjdEZvcm11bGEoY29udGVudClcbiAgICBjb25zdCB2YXJpYWJsZXMgPSB0aGlzLmV4dHJhY3RWYXJpYWJsZXMoY29udGVudClcbiAgICBcbiAgICBsZXQgYXNjaWkgPSBgXG7ilZTilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZdcbuKVkSAgICAgICAgIEbDk1JNVUxBIE1BVEVNw4FUSUNBICAgICAgICDilZFcbuKVoOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVo1xu4pWRICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICDilZFcbuKVkSAgICAgICAgICR7dGhpcy5jZW50ZXJUZXh0KGZvcm11bGEsIDE5KX0gICAgICAgICDilZFcbuKVkSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg4pWRXG7ilaDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilaNcbuKVkSAgICAgICAgICAgVkFSSUFCTEVTOiAgICAgICAgICAgICAg4pWRYFxuXG4gICAgdmFyaWFibGVzLmZvckVhY2godmFyaWFibGUgPT4ge1xuICAgICAgYXNjaWkgKz0gYFxu4pWRICAke3ZhcmlhYmxlLnN5bWJvbH0gPSAke3RoaXMudHJ1bmNhdGVUZXh0KHZhcmlhYmxlLmRlc2NyaXB0aW9uLCAyMCl9ICAgIOKVkWBcbiAgICB9KVxuXG4gICAgYXNjaWkgKz0gYFxu4pWRICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICDilZFcbuKVmuKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVnVxuXG4gICAgUmVwcmVzZW50YWNpw7NuIHZpc3VhbDpcbiAgICBcbiAgICAgICAgICR7Zm9ybXVsYX1cbiAgICAgICAgIOKGmSAgICAg4oaYXG4gICAgVmFyaWFibGUgICBSZXN1bHRhZG9cbiAgICAgICR7dmFyaWFibGVzWzBdPy5zeW1ib2wgfHwgJ3gnfSAgICAgICAgIHlgXG5cbiAgICByZXR1cm4ge1xuICAgICAgdHlwZTogVmlzdWFsVHlwZS5GT1JNVUxBX1ZJU1VBTElaQVRJT04sXG4gICAgICBhc2NpaTogYXNjaWksXG4gICAgICBkZXNjcmlwdGlvbjogYFZpc3VhbGl6YWNpw7NuIGRlIGxhIGbDs3JtdWxhICR7Zm9ybXVsYX0gY29uICR7dmFyaWFibGVzLmxlbmd0aH0gdmFyaWFibGVzYCxcbiAgICAgIGVsZW1lbnRzOiBbe1xuICAgICAgICBpZDogJ2Zvcm11bGFfbWFpbicsXG4gICAgICAgIHR5cGU6IFZpc3VhbFR5cGUuRk9STVVMQV9WSVNVQUxJWkFUSU9OLFxuICAgICAgICB0aXRsZTogJ0bDs3JtdWxhIFByaW5jaXBhbCcsXG4gICAgICAgIGNvbnRlbnQ6IGZvcm11bGEsXG4gICAgICAgIGNvbm5lY3Rpb25zOiB2YXJpYWJsZXMubWFwKChfLCBpbmRleCkgPT4gYHZhcl8ke2luZGV4fWApXG4gICAgICB9XS5jb25jYXQodmFyaWFibGVzLm1hcCgodmFyaWFibGUsIGluZGV4KSA9PiAoe1xuICAgICAgICBpZDogYHZhcl8ke2luZGV4fWAsXG4gICAgICAgIHR5cGU6IFZpc3VhbFR5cGUuRk9STVVMQV9WSVNVQUxJWkFUSU9OLFxuICAgICAgICB0aXRsZTogdmFyaWFibGUuc3ltYm9sLFxuICAgICAgICBjb250ZW50OiB2YXJpYWJsZS5kZXNjcmlwdGlvbixcbiAgICAgICAgY29ubmVjdGlvbnM6IFtdXG4gICAgICB9KSkpLFxuICAgICAgaW5zdHJ1Y3Rpb25zOiBbXG4gICAgICAgICdMYSBmw7NybXVsYSBwcmluY2lwYWwgc2UgbXVlc3RyYSBlbiBlbCBjZW50cm8nLFxuICAgICAgICAnTGFzIHZhcmlhYmxlcyBzZSBkZWZpbmVuIGVuIGxhIHRhYmxhIGluZmVyaW9yJyxcbiAgICAgICAgJ1N1c3RpdHV5ZSBsb3MgdmFsb3JlcyBwYXJhIHJlc29sdmVyJ1xuICAgICAgXVxuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBHZW5lcmF0ZXMgY2hlbWljYWwgc3RydWN0dXJlIHZpc3VhbGl6YXRpb25cbiAgICovXG4gIHN0YXRpYyBnZW5lcmF0ZUNoZW1pY2FsU3RydWN0dXJlKGNvbnRlbnQ6IHN0cmluZyk6IFZpc3VhbFJlcHJlc2VudGF0aW9uIHtcbiAgICBjb25zdCBtb2xlY3VsZSA9IHRoaXMuZXh0cmFjdE1vbGVjdWxlKGNvbnRlbnQpXG4gICAgY29uc3QgYXRvbXMgPSB0aGlzLmV4dHJhY3RBdG9tcyhjb250ZW50KVxuICAgIFxuICAgIGxldCBhc2NpaSA9ICcnXG5cbiAgICAvLyBTaW1wbGUgbW9sZWN1bGFyIHJlcHJlc2VudGF0aW9uc1xuICAgIGlmIChtb2xlY3VsZS50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKCdoMm8nKSB8fCBtb2xlY3VsZS50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKCdhZ3VhJykpIHtcbiAgICAgIGFzY2lpID0gYFxuICAgICAgICBFc3RydWN0dXJhIGRlbCBBZ3VhIChI4oKCTylcbiAgICAgICAgXG4gICAgICAgICAgICBIXG4gICAgICAgICAgICDilIJcbiAgICAgICAgSOKUgE/ilIBIICAgIG8gICAgSOKUgE/ilIBIXG4gICAgICAgICAgICBcbiAgICAgICAgUmVwcmVzZW50YWNpw7NuIGFuZ3VsYXI6XG4gICAgICAgIFxuICAgICAgICAgICAgSFxuICAgICAgICAgICAgIFxcXFxcbiAgICAgICAgICAgICAgT1xuICAgICAgICAgICAgIC9cbiAgICAgICAgICAgIEhcbiAgICAgICAgICAgICAgXG4gICAgICAgIMOBbmd1bG8gSC1PLUg6IDEwNC41wrBgXG4gICAgfSBlbHNlIGlmIChtb2xlY3VsZS50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKCdjbzInKSkge1xuICAgICAgYXNjaWkgPSBgXG4gICAgICAgIEVzdHJ1Y3R1cmEgZGVsIENP4oKCXG4gICAgICAgIFxuICAgICAgICBP4pWQQ+KVkE9cbiAgICAgICAgXG4gICAgICAgIExpbmVhbCwgMTgwwrBcbiAgICAgICAgXG4gICAgICAgIEVubGFjZXMgZG9ibGVzOlxuICAgICAgICBPIOKVkOKVkCBDIOKVkOKVkCBPYFxuICAgIH0gZWxzZSBpZiAobW9sZWN1bGUudG9Mb3dlckNhc2UoKS5pbmNsdWRlcygnY2g0JykgfHwgbW9sZWN1bGUudG9Mb3dlckNhc2UoKS5pbmNsdWRlcygnbWV0YW5vJykpIHtcbiAgICAgIGFzY2lpID0gYFxuICAgICAgICBFc3RydWN0dXJhIGRlbCBNZXRhbm8gKENI4oKEKVxuICAgICAgICBcbiAgICAgICAgICAgSFxuICAgICAgICAgICDilIJcbiAgICAgICAgSOKUgEPilIBIXG4gICAgICAgICAgIOKUglxuICAgICAgICAgICBIXG4gICAgICAgICAgIFxuICAgICAgICBUZXRyYcOpZHJpY2FcbiAgICAgICAgw4FuZ3VsbyBILUMtSDogMTA5LjXCsGBcbiAgICB9IGVsc2Uge1xuICAgICAgYXNjaWkgPSBgXG4gICAgICAgIEVzdHJ1Y3R1cmEgTW9sZWN1bGFyXG4gICAgICAgIFxuICAgICAgICAke21vbGVjdWxlfVxuICAgICAgICBcbiAgICAgICAgw4F0b21vcyBpZGVudGlmaWNhZG9zOlxuICAgICAgICAke2F0b21zLm1hcChhdG9tID0+IGDigKIgJHthdG9tfWApLmpvaW4oJ1xcbiAgICAgICAgJyl9XG4gICAgICAgIFxuICAgICAgICBSZXByZXNlbnRhY2nDs24gZXNxdWVtw6F0aWNhOlxuICAgICAgICBcbiAgICAgICAgW8OBdG9tbzFd4pSAW8OBdG9tbzJd4pSAW8OBdG9tbzNdYFxuICAgIH1cblxuICAgIHJldHVybiB7XG4gICAgICB0eXBlOiBWaXN1YWxUeXBlLkNIRU1JQ0FMX1NUUlVDVFVSRSxcbiAgICAgIGFzY2lpOiBhc2NpaSxcbiAgICAgIGRlc2NyaXB0aW9uOiBgRXN0cnVjdHVyYSBxdcOtbWljYSBkZSAke21vbGVjdWxlfSBtb3N0cmFuZG8gJHthdG9tcy5sZW5ndGh9IHRpcG9zIGRlIMOhdG9tb3NgLFxuICAgICAgZWxlbWVudHM6IFt7XG4gICAgICAgIGlkOiAnbW9sZWN1bGVfbWFpbicsXG4gICAgICAgIHR5cGU6IFZpc3VhbFR5cGUuQ0hFTUlDQUxfU1RSVUNUVVJFLFxuICAgICAgICB0aXRsZTogbW9sZWN1bGUsXG4gICAgICAgIGNvbnRlbnQ6IGBNb2zDqWN1bGE6ICR7bW9sZWN1bGV9YCxcbiAgICAgICAgY29ubmVjdGlvbnM6IGF0b21zLm1hcCgoXywgaW5kZXgpID0+IGBhdG9tXyR7aW5kZXh9YClcbiAgICAgIH1dLmNvbmNhdChhdG9tcy5tYXAoKGF0b20sIGluZGV4KSA9PiAoe1xuICAgICAgICBpZDogYGF0b21fJHtpbmRleH1gLFxuICAgICAgICB0eXBlOiBWaXN1YWxUeXBlLkNIRU1JQ0FMX1NUUlVDVFVSRSxcbiAgICAgICAgdGl0bGU6IGF0b20sXG4gICAgICAgIGNvbnRlbnQ6IGDDgXRvbW86ICR7YXRvbX1gLFxuICAgICAgICBjb25uZWN0aW9uczogW11cbiAgICAgIH0pKSksXG4gICAgICBpbnN0cnVjdGlvbnM6IFtcbiAgICAgICAgJ0xvcyDDoXRvbW9zIHNlIHJlcHJlc2VudGFuIGNvbiBzdXMgc8OtbWJvbG9zJyxcbiAgICAgICAgJ0xhcyBsw61uZWFzIHJlcHJlc2VudGFuIGVubGFjZXMgcXXDrW1pY29zJyxcbiAgICAgICAgJ0xvcyDDoW5ndWxvcyBtdWVzdHJhbiBsYSBnZW9tZXRyw61hIG1vbGVjdWxhcidcbiAgICAgIF1cbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogR2VuZXJhdGVzIHByb2Nlc3MgZmxvdyB2aXN1YWxpemF0aW9uXG4gICAqL1xuICBzdGF0aWMgZ2VuZXJhdGVQcm9jZXNzRmxvdyhjb250ZW50OiBzdHJpbmcpOiBWaXN1YWxSZXByZXNlbnRhdGlvbiB7XG4gICAgY29uc3QgcHJvY2Vzc2VzID0gdGhpcy5leHRyYWN0UHJvY2Vzc2VzKGNvbnRlbnQpXG4gICAgXG4gICAgbGV0IGFzY2lpID0gYFxuICAgIEZMVUpPIERFTCBQUk9DRVNPXG4gICAgXG4gICAg4pSM4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSQYFxuXG4gICAgcHJvY2Vzc2VzLmZvckVhY2goKHByb2Nlc3MsIGluZGV4KSA9PiB7XG4gICAgICBjb25zdCBwcm9jZXNzVGV4dCA9IHRoaXMudHJ1bmNhdGVUZXh0KHByb2Nlc3MsIDE1KVxuICAgICAgaWYgKGluZGV4ID09PSAwKSB7XG4gICAgICAgIGFzY2lpICs9IGBcbiAgICDilIIgICAke3RoaXMuY2VudGVyVGV4dChwcm9jZXNzVGV4dCwgOSl9ICAg4pSCXG4gICAg4pSU4pSA4pSA4pSA4pSA4pSA4pSs4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSYXG4gICAgICAgICAg4pSCXG4gICAgICAgICAg4pa8YFxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgYXNjaWkgKz0gYFxuICAgIOKUjOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUkFxuICAgIOKUgiAgICR7dGhpcy5jZW50ZXJUZXh0KHByb2Nlc3NUZXh0LCA5KX0gICDilIJcbiAgICDilJTilIDilIDilIDilIDilIDilKzilIDilIDilIDilIDilIDilIDilIDilJhcbiAgICAgICAgICDilIJcbiAgICAgICAgICDilrxgXG4gICAgICB9XG4gICAgfSlcblxuICAgIGFzY2lpICs9IGBcbiAgICDilIzilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilJBcbiAgICDilIIgICBGSU5BTCAgICAg4pSCXG4gICAg4pSU4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSYYFxuXG4gICAgcmV0dXJuIHtcbiAgICAgIHR5cGU6IFZpc3VhbFR5cGUuUFJPQ0VTU19GTE9XLFxuICAgICAgYXNjaWk6IGFzY2lpLFxuICAgICAgZGVzY3JpcHRpb246IGBGbHVqbyBkZSBwcm9jZXNvIGNvbiAke3Byb2Nlc3Nlcy5sZW5ndGh9IGV0YXBhcyBzZWN1ZW5jaWFsZXNgLFxuICAgICAgZWxlbWVudHM6IHByb2Nlc3Nlcy5tYXAoKHByb2Nlc3MsIGluZGV4KSA9PiAoe1xuICAgICAgICBpZDogYHByb2Nlc3NfJHtpbmRleH1gLFxuICAgICAgICB0eXBlOiBWaXN1YWxUeXBlLlBST0NFU1NfRkxPVyxcbiAgICAgICAgdGl0bGU6IGBQcm9jZXNvICR7aW5kZXggKyAxfWAsXG4gICAgICAgIGNvbnRlbnQ6IHByb2Nlc3MsXG4gICAgICAgIGNvbm5lY3Rpb25zOiBpbmRleCA8IHByb2Nlc3Nlcy5sZW5ndGggLSAxID8gW2Bwcm9jZXNzXyR7aW5kZXggKyAxfWBdIDogW11cbiAgICAgIH0pKSxcbiAgICAgIGluc3RydWN0aW9uczogW1xuICAgICAgICAnU2lndWUgZWwgZmx1am8gZGUgYXJyaWJhIGhhY2lhIGFiYWpvJyxcbiAgICAgICAgJ0NhZGEgY2FqYSByZXByZXNlbnRhIHVuYSBldGFwYSBkZWwgcHJvY2VzbycsXG4gICAgICAgICdMYXMgZmxlY2hhcyBpbmRpY2FuIGxhIHNlY3VlbmNpYSdcbiAgICAgIF1cbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogR2VuZXJhdGVzIGdlbmVyaWMgZGlhZ3JhbVxuICAgKi9cbiAgc3RhdGljIGdlbmVyYXRlR2VuZXJpY0RpYWdyYW0oY29udGVudDogc3RyaW5nKTogVmlzdWFsUmVwcmVzZW50YXRpb24ge1xuICAgIGNvbnN0IGtleVBvaW50cyA9IHRoaXMuZXh0cmFjdEtleVBvaW50cyhjb250ZW50LCA0KVxuICAgIFxuICAgIGxldCBhc2NpaSA9IGBcbiAgICDila3ilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDila5cbiAgICDilIIgICAgICAgIERJQUdSQU1BIEdFTkVSQUwgICAgICAgICDilIJcbiAgICDilbDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilKzilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDila9cbiAgICAgICAgICAgICAgICAgIOKUgmBcblxuICAgIGtleVBvaW50cy5mb3JFYWNoKChwb2ludCwgaW5kZXgpID0+IHtcbiAgICAgIGNvbnN0IHBvaW50VGV4dCA9IHRoaXMudHJ1bmNhdGVUZXh0KHBvaW50LCAyMClcbiAgICAgIGFzY2lpICs9IGBcbiAgICAgICAgICAgICAgICAgIOKWvFxuICAgIOKUjOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUkFxuICAgIOKUgiAke2luZGV4ICsgMX0uICR7dGhpcy5sZWZ0QWxpZ24ocG9pbnRUZXh0LCAyMyl9IOKUglxuICAgIOKUlOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUmGBcbiAgICB9KVxuXG4gICAgcmV0dXJuIHtcbiAgICAgIHR5cGU6IFZpc3VhbFR5cGUuRElBR1JBTSxcbiAgICAgIGFzY2lpOiBhc2NpaSxcbiAgICAgIGRlc2NyaXB0aW9uOiBgRGlhZ3JhbWEgZ2VuZXJhbCBjb24gJHtrZXlQb2ludHMubGVuZ3RofSBlbGVtZW50b3MgcHJpbmNpcGFsZXNgLFxuICAgICAgZWxlbWVudHM6IGtleVBvaW50cy5tYXAoKHBvaW50LCBpbmRleCkgPT4gKHtcbiAgICAgICAgaWQ6IGBwb2ludF8ke2luZGV4fWAsXG4gICAgICAgIHR5cGU6IFZpc3VhbFR5cGUuRElBR1JBTSxcbiAgICAgICAgdGl0bGU6IGBQdW50byAke2luZGV4ICsgMX1gLFxuICAgICAgICBjb250ZW50OiBwb2ludCxcbiAgICAgICAgY29ubmVjdGlvbnM6IFtdXG4gICAgICB9KSksXG4gICAgICBpbnN0cnVjdGlvbnM6IFtcbiAgICAgICAgJ0NhZGEgZWxlbWVudG8gc2UgcHJlc2VudGEgZGUgZm9ybWEgc2VjdWVuY2lhbCcsXG4gICAgICAgICdMb3MgbsO6bWVyb3MgaW5kaWNhbiBlbCBvcmRlbiBkZSBpbXBvcnRhbmNpYScsXG4gICAgICAgICdSZXZpc2EgY2FkYSBwdW50byBwYXJhIGNvbXByZW5zacOzbiBjb21wbGV0YSdcbiAgICAgIF1cbiAgICB9XG4gIH1cblxuICAvLyA9PT09PSBVVElMSVRZIEZVTkNUSU9OUyA9PT09PVxuXG4gIC8qKlxuICAgKiBFeHRyYWN0cyBtYWluIGNvbmNlcHRzIGZyb20gY29udGVudFxuICAgKi9cbiAgcHJpdmF0ZSBzdGF0aWMgZXh0cmFjdENvbmNlcHRzKGNvbnRlbnQ6IHN0cmluZyk6IHN0cmluZ1tdIHtcbiAgICBjb25zdCBzZW50ZW5jZXMgPSBjb250ZW50LnNwbGl0KC9bLiE/XSsvKVxuICAgIGNvbnN0IGNvbmNlcHRzOiBzdHJpbmdbXSA9IFtdXG4gICAgXG4gICAgZm9yIChjb25zdCBzZW50ZW5jZSBvZiBzZW50ZW5jZXMpIHtcbiAgICAgIGNvbnN0IHdvcmRzID0gc2VudGVuY2UudHJpbSgpLnNwbGl0KCcgJylcbiAgICAgIGNvbnN0IGltcG9ydGFudFdvcmRzID0gd29yZHMuZmlsdGVyKHdvcmQgPT4gXG4gICAgICAgIHdvcmQubGVuZ3RoID4gNCAmJiBcbiAgICAgICAgIVsnZXN0ZScsICdlc3RhJywgJ2VzdG9zJywgJ2VzdGFzJywgJ2N1YW5kbycsICdkb25kZScsICdwb3JxdWUnXS5pbmNsdWRlcyh3b3JkLnRvTG93ZXJDYXNlKCkpXG4gICAgICApXG4gICAgICBcbiAgICAgIGlmIChpbXBvcnRhbnRXb3Jkcy5sZW5ndGggPiAwKSB7XG4gICAgICAgIGNvbmNlcHRzLnB1c2goaW1wb3J0YW50V29yZHNbMF0pXG4gICAgICB9XG4gICAgICBcbiAgICAgIGlmIChjb25jZXB0cy5sZW5ndGggPj0gNSkgYnJlYWtcbiAgICB9XG4gICAgXG4gICAgcmV0dXJuIGNvbmNlcHRzLmxlbmd0aCA+IDAgPyBjb25jZXB0cyA6IFsnQ29uY2VwdG8gUHJpbmNpcGFsJ11cbiAgfVxuXG4gIC8qKlxuICAgKiBFeHRyYWN0cyBzdGVwcyBmcm9tIGNvbnRlbnRcbiAgICovXG4gIHByaXZhdGUgc3RhdGljIGV4dHJhY3RTdGVwcyhjb250ZW50OiBzdHJpbmcpOiBzdHJpbmdbXSB7XG4gICAgLy8gTG9vayBmb3IgbnVtYmVyZWQgc3RlcHMgb3Igc2VxdWVudGlhbCBpbmRpY2F0b3JzXG4gICAgY29uc3Qgc3RlcFBhdHRlcm5zID0gW1xuICAgICAgL1xcZCtbLildXFxzKihbXi4hP10rKS9nLFxuICAgICAgL3Bhc28gXFxkKzo/XFxzKihbXi4hP10rKS9naSxcbiAgICAgIC8ocHJpbWVyb3xzZWd1bmRvfHRlcmNlcm98bHVlZ298ZGVzcHXDqXN8ZmluYWxtZW50ZSlbLDpdP1xccyooW14uIT9dKykvZ2lcbiAgICBdXG4gICAgXG4gICAgY29uc3Qgc3RlcHM6IHN0cmluZ1tdID0gW11cbiAgICBcbiAgICBmb3IgKGNvbnN0IHBhdHRlcm4gb2Ygc3RlcFBhdHRlcm5zKSB7XG4gICAgICBsZXQgbWF0Y2hcbiAgICAgIHdoaWxlICgobWF0Y2ggPSBwYXR0ZXJuLmV4ZWMoY29udGVudCkpICE9PSBudWxsICYmIHN0ZXBzLmxlbmd0aCA8IDYpIHtcbiAgICAgICAgY29uc3Qgc3RlcCA9IG1hdGNoWzFdIHx8IG1hdGNoWzJdXG4gICAgICAgIGlmIChzdGVwICYmIHN0ZXAudHJpbSgpLmxlbmd0aCA+IDUpIHtcbiAgICAgICAgICBzdGVwcy5wdXNoKHN0ZXAudHJpbSgpKVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIFxuICAgIGlmIChzdGVwcy5sZW5ndGggPT09IDApIHtcbiAgICAgIC8vIEZhbGxiYWNrOiBzcGxpdCBieSBzZW50ZW5jZXNcbiAgICAgIGNvbnN0IHNlbnRlbmNlcyA9IGNvbnRlbnQuc3BsaXQoL1suIT9dKy8pXG4gICAgICBzdGVwcy5wdXNoKC4uLnNlbnRlbmNlcy5zbGljZSgwLCA0KS5maWx0ZXIocyA9PiBzLnRyaW0oKS5sZW5ndGggPiAxMCkpXG4gICAgfVxuICAgIFxuICAgIHJldHVybiBzdGVwcy5zbGljZSgwLCA1KVxuICB9XG5cbiAgLyoqXG4gICAqIEV4dHJhY3RzIGhpZXJhcmNoeSBpdGVtc1xuICAgKi9cbiAgcHJpdmF0ZSBzdGF0aWMgZXh0cmFjdEhpZXJhcmNoeShjb250ZW50OiBzdHJpbmcpOiBzdHJpbmdbXSB7XG4gICAgY29uc3QgaGllcmFyY2h5V29yZHMgPSBbJ3ByaW5jaXBhbCcsICdzZWN1bmRhcmlvJywgJ3RpcG8nLCAnY2F0ZWdvcsOtYScsICdjbGFzZScsICdncnVwbyddXG4gICAgY29uc3QgaXRlbXM6IHN0cmluZ1tdID0gW11cbiAgICBjb25zdCBzZW50ZW5jZXMgPSBjb250ZW50LnNwbGl0KC9bLiE/XSsvKVxuICAgIFxuICAgIGZvciAoY29uc3Qgc2VudGVuY2Ugb2Ygc2VudGVuY2VzKSB7XG4gICAgICBmb3IgKGNvbnN0IHdvcmQgb2YgaGllcmFyY2h5V29yZHMpIHtcbiAgICAgICAgaWYgKHNlbnRlbmNlLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMod29yZCkpIHtcbiAgICAgICAgICBjb25zdCBjbGVhblNlbnRlbmNlID0gc2VudGVuY2UucmVwbGFjZSgvXlxccypcXGQrWy4pXVxccyovLCAnJykudHJpbSgpXG4gICAgICAgICAgaWYgKGNsZWFuU2VudGVuY2UubGVuZ3RoID4gNSkge1xuICAgICAgICAgICAgaXRlbXMucHVzaChjbGVhblNlbnRlbmNlKVxuICAgICAgICAgICAgYnJlYWtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGlmIChpdGVtcy5sZW5ndGggPj0gNikgYnJlYWtcbiAgICB9XG4gICAgXG4gICAgcmV0dXJuIGl0ZW1zLmxlbmd0aCA+IDAgPyBpdGVtcyA6IFsnRWxlbWVudG8gUHJpbmNpcGFsJywgJ1N1YmVsZW1lbnRvIDEnLCAnU3ViZWxlbWVudG8gMiddXG4gIH1cblxuICAvKipcbiAgICogRXh0cmFjdHMgdGltZWxpbmUgZXZlbnRzXG4gICAqL1xuICBwcml2YXRlIHN0YXRpYyBleHRyYWN0VGltZWxpbmVFdmVudHMoY29udGVudDogc3RyaW5nKTogQXJyYXk8e3RpbWU6IHN0cmluZywgZXZlbnQ6IHN0cmluZ30+IHtcbiAgICBjb25zdCB0aW1lUGF0dGVybiA9IC8oXFxkezR9fFxcZHsxLDJ9OlxcZHsyfXxzaWdsbyBcXHcrfGVyYSBcXHcrKS9naVxuICAgIGNvbnN0IGV2ZW50czogQXJyYXk8e3RpbWU6IHN0cmluZywgZXZlbnQ6IHN0cmluZ30+ID0gW11cbiAgICBjb25zdCBzZW50ZW5jZXMgPSBjb250ZW50LnNwbGl0KC9bLiE/XSsvKVxuICAgIFxuICAgIGZvciAoY29uc3Qgc2VudGVuY2Ugb2Ygc2VudGVuY2VzKSB7XG4gICAgICBjb25zdCB0aW1lTWF0Y2ggPSBzZW50ZW5jZS5tYXRjaCh0aW1lUGF0dGVybilcbiAgICAgIGlmICh0aW1lTWF0Y2gpIHtcbiAgICAgICAgZXZlbnRzLnB1c2goe1xuICAgICAgICAgIHRpbWU6IHRpbWVNYXRjaFswXSxcbiAgICAgICAgICBldmVudDogc2VudGVuY2UucmVwbGFjZSh0aW1lUGF0dGVybiwgJycpLnRyaW0oKVxuICAgICAgICB9KVxuICAgICAgfVxuICAgIH1cbiAgICBcbiAgICBpZiAoZXZlbnRzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgLy8gRmFsbGJhY2sgdGltZWxpbmVcbiAgICAgIGNvbnN0IGtleUV2ZW50cyA9IHNlbnRlbmNlcy5zbGljZSgwLCAzKS5maWx0ZXIocyA9PiBzLnRyaW0oKS5sZW5ndGggPiAxMClcbiAgICAgIGtleUV2ZW50cy5mb3JFYWNoKChldmVudCwgaW5kZXgpID0+IHtcbiAgICAgICAgZXZlbnRzLnB1c2goe1xuICAgICAgICAgIHRpbWU6IGBUJHtpbmRleCArIDF9YCxcbiAgICAgICAgICBldmVudDogZXZlbnQudHJpbSgpXG4gICAgICAgIH0pXG4gICAgICB9KVxuICAgIH1cbiAgICBcbiAgICByZXR1cm4gZXZlbnRzLnNsaWNlKDAsIDUpXG4gIH1cblxuICAvKipcbiAgICogRXh0cmFjdHMgZm9ybXVsYSBmcm9tIGNvbnRlbnRcbiAgICovXG4gIHByaXZhdGUgc3RhdGljIGV4dHJhY3RGb3JtdWxhKGNvbnRlbnQ6IHN0cmluZyk6IHN0cmluZyB7XG4gICAgLy8gTG9vayBmb3IgbWF0aGVtYXRpY2FsIGV4cHJlc3Npb25zXG4gICAgY29uc3QgZm9ybXVsYVBhdHRlcm5zID0gW1xuICAgICAgLyhbYS16QS1aXVxccypbPV1cXHMqW14uIT9dKykvLFxuICAgICAgLyhbYS16QS1aXStcXHMqXFwoXFxzKlthLXpBLVosXFxzXStcXHMqXFwpKS8sXG4gICAgICAvKGZcXChbeC16XVxcKVxccyo9XFxzKlteLiE/XSspL2ksXG4gICAgICAvKFt4eV1cXHMqPVxccypbXi4hP10rKS9cbiAgICBdXG4gICAgXG4gICAgZm9yIChjb25zdCBwYXR0ZXJuIG9mIGZvcm11bGFQYXR0ZXJucykge1xuICAgICAgY29uc3QgbWF0Y2ggPSBjb250ZW50Lm1hdGNoKHBhdHRlcm4pXG4gICAgICBpZiAobWF0Y2gpIHtcbiAgICAgICAgcmV0dXJuIG1hdGNoWzFdLnRyaW0oKVxuICAgICAgfVxuICAgIH1cbiAgICBcbiAgICAvLyBGYWxsYmFja1xuICAgIGlmIChjb250ZW50LmluY2x1ZGVzKCc9JykpIHtcbiAgICAgIGNvbnN0IHBhcnRzID0gY29udGVudC5zcGxpdCgnPScpXG4gICAgICBpZiAocGFydHMubGVuZ3RoID49IDIpIHtcbiAgICAgICAgcmV0dXJuIGAke3BhcnRzWzBdLnRyaW0oKX0gPSAke3BhcnRzWzFdLnNwbGl0KC9bLiE/XS8pWzBdLnRyaW0oKX1gXG4gICAgICB9XG4gICAgfVxuICAgIFxuICAgIHJldHVybiAneSA9IGYoeCknXG4gIH1cblxuICAvKipcbiAgICogRXh0cmFjdHMgdmFyaWFibGVzIGZyb20gY29udGVudFxuICAgKi9cbiAgcHJpdmF0ZSBzdGF0aWMgZXh0cmFjdFZhcmlhYmxlcyhjb250ZW50OiBzdHJpbmcpOiBBcnJheTx7c3ltYm9sOiBzdHJpbmcsIGRlc2NyaXB0aW9uOiBzdHJpbmd9PiB7XG4gICAgY29uc3QgdmFyaWFibGVzOiBBcnJheTx7c3ltYm9sOiBzdHJpbmcsIGRlc2NyaXB0aW9uOiBzdHJpbmd9PiA9IFtdXG4gICAgXG4gICAgLy8gTG9vayBmb3IgdmFyaWFibGUgZGVmaW5pdGlvbnMgbGlrZSBcImRvbmRlIHggZXMuLi5cIlxuICAgIGNvbnN0IHZhclBhdHRlcm4gPSAvKFthLXpBLVpdKVxccytlc1xccysoW14uIT9dKykvZ2lcbiAgICBsZXQgbWF0Y2hcbiAgICBcbiAgICB3aGlsZSAoKG1hdGNoID0gdmFyUGF0dGVybi5leGVjKGNvbnRlbnQpKSAhPT0gbnVsbCAmJiB2YXJpYWJsZXMubGVuZ3RoIDwgNCkge1xuICAgICAgdmFyaWFibGVzLnB1c2goe1xuICAgICAgICBzeW1ib2w6IG1hdGNoWzFdLFxuICAgICAgICBkZXNjcmlwdGlvbjogbWF0Y2hbMl0udHJpbSgpXG4gICAgICB9KVxuICAgIH1cbiAgICBcbiAgICBpZiAodmFyaWFibGVzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgdmFyaWFibGVzLnB1c2goXG4gICAgICAgIHsgc3ltYm9sOiAneCcsIGRlc2NyaXB0aW9uOiAndmFyaWFibGUgaW5kZXBlbmRpZW50ZScgfSxcbiAgICAgICAgeyBzeW1ib2w6ICd5JywgZGVzY3JpcHRpb246ICd2YXJpYWJsZSBkZXBlbmRpZW50ZScgfVxuICAgICAgKVxuICAgIH1cbiAgICBcbiAgICByZXR1cm4gdmFyaWFibGVzXG4gIH1cblxuICAvKipcbiAgICogRXh0cmFjdHMgbW9sZWN1bGUgaW5mb3JtYXRpb25cbiAgICovXG4gIHByaXZhdGUgc3RhdGljIGV4dHJhY3RNb2xlY3VsZShjb250ZW50OiBzdHJpbmcpOiBzdHJpbmcge1xuICAgIGNvbnN0IG1vbGVjdWxlUGF0dGVybnMgPSBbXG4gICAgICAvKFtBLVpdW2Etel0/XFxkKikrL2csICAvLyBDaGVtaWNhbCBmb3JtdWxhIHBhdHRlcm5cbiAgICAgIC8oYWd1YXxtZXRhbm98ZGnDs3hpZG98Y2FyYm9ub3xveMOtZ2Vub3xoaWRyw7NnZW5vKS9pXG4gICAgXVxuICAgIFxuICAgIGZvciAoY29uc3QgcGF0dGVybiBvZiBtb2xlY3VsZVBhdHRlcm5zKSB7XG4gICAgICBjb25zdCBtYXRjaCA9IGNvbnRlbnQubWF0Y2gocGF0dGVybilcbiAgICAgIGlmIChtYXRjaCkge1xuICAgICAgICByZXR1cm4gbWF0Y2hbMF1cbiAgICAgIH1cbiAgICB9XG4gICAgXG4gICAgcmV0dXJuICdNb2zDqWN1bGEnXG4gIH1cblxuICAvKipcbiAgICogRXh0cmFjdHMgYXRvbXMgZnJvbSBjb250ZW50XG4gICAqL1xuICBwcml2YXRlIHN0YXRpYyBleHRyYWN0QXRvbXMoY29udGVudDogc3RyaW5nKTogc3RyaW5nW10ge1xuICAgIGNvbnN0IGF0b21TeW1ib2xzID0gY29udGVudC5tYXRjaCgvW0EtWl1bYS16XT8vZykgfHwgW11cbiAgICBjb25zdCB1bmlxdWVBdG9tcyA9IFsuLi5uZXcgU2V0KGF0b21TeW1ib2xzKV1cbiAgICBcbiAgICBpZiAodW5pcXVlQXRvbXMubGVuZ3RoID09PSAwKSB7XG4gICAgICByZXR1cm4gWydDJywgJ0gnLCAnTyddXG4gICAgfVxuICAgIFxuICAgIHJldHVybiB1bmlxdWVBdG9tcy5zbGljZSgwLCA1KVxuICB9XG5cbiAgLyoqXG4gICAqIEV4dHJhY3RzIHByb2Nlc3NlcyBmcm9tIGNvbnRlbnRcbiAgICovXG4gIHByaXZhdGUgc3RhdGljIGV4dHJhY3RQcm9jZXNzZXMoY29udGVudDogc3RyaW5nKTogc3RyaW5nW10ge1xuICAgIGNvbnN0IHByb2Nlc3NlcyA9IHRoaXMuZXh0cmFjdFN0ZXBzKGNvbnRlbnQpXG4gICAgcmV0dXJuIHByb2Nlc3Nlcy5sZW5ndGggPiAwID8gcHJvY2Vzc2VzIDogWydQcm9jZXNvIDEnLCAnUHJvY2VzbyAyJywgJ1Byb2Nlc28gMyddXG4gIH1cblxuICAvKipcbiAgICogRXh0cmFjdHMga2V5IHBvaW50cyBmcm9tIGNvbnRlbnRcbiAgICovXG4gIHByaXZhdGUgc3RhdGljIGV4dHJhY3RLZXlQb2ludHMoY29udGVudDogc3RyaW5nLCBsaW1pdDogbnVtYmVyID0gNCk6IHN0cmluZ1tdIHtcbiAgICBjb25zdCBzZW50ZW5jZXMgPSBjb250ZW50LnNwbGl0KC9bLiE/XSsvKVxuICAgIHJldHVybiBzZW50ZW5jZXNcbiAgICAgIC5maWx0ZXIocyA9PiBzLnRyaW0oKS5sZW5ndGggPiAxMClcbiAgICAgIC5zbGljZSgwLCBsaW1pdClcbiAgICAgIC5tYXAocyA9PiBzLnRyaW0oKSlcbiAgfVxuXG4gIC8vID09PT09IFRFWFQgRk9STUFUVElORyBVVElMSVRJRVMgPT09PT1cblxuICAvKipcbiAgICogQ2VudGVycyB0ZXh0IGluIGEgZml4ZWQgd2lkdGhcbiAgICovXG4gIHByaXZhdGUgc3RhdGljIGNlbnRlclRleHQodGV4dDogc3RyaW5nLCB3aWR0aDogbnVtYmVyKTogc3RyaW5nIHtcbiAgICBjb25zdCB0cnVuY2F0ZWQgPSB0aGlzLnRydW5jYXRlVGV4dCh0ZXh0LCB3aWR0aClcbiAgICBjb25zdCBwYWRkaW5nID0gTWF0aC5tYXgoMCwgd2lkdGggLSB0cnVuY2F0ZWQubGVuZ3RoKVxuICAgIGNvbnN0IGxlZnRQYWQgPSBNYXRoLmZsb29yKHBhZGRpbmcgLyAyKVxuICAgIGNvbnN0IHJpZ2h0UGFkID0gcGFkZGluZyAtIGxlZnRQYWRcbiAgICByZXR1cm4gJyAnLnJlcGVhdChsZWZ0UGFkKSArIHRydW5jYXRlZCArICcgJy5yZXBlYXQocmlnaHRQYWQpXG4gIH1cblxuICAvKipcbiAgICogTGVmdCBhbGlnbnMgdGV4dCBpbiBhIGZpeGVkIHdpZHRoXG4gICAqL1xuICBwcml2YXRlIHN0YXRpYyBsZWZ0QWxpZ24odGV4dDogc3RyaW5nLCB3aWR0aDogbnVtYmVyKTogc3RyaW5nIHtcbiAgICBjb25zdCB0cnVuY2F0ZWQgPSB0aGlzLnRydW5jYXRlVGV4dCh0ZXh0LCB3aWR0aClcbiAgICBjb25zdCBwYWRkaW5nID0gTWF0aC5tYXgoMCwgd2lkdGggLSB0cnVuY2F0ZWQubGVuZ3RoKVxuICAgIHJldHVybiB0cnVuY2F0ZWQgKyAnICcucmVwZWF0KHBhZGRpbmcpXG4gIH1cblxuICAvKipcbiAgICogVHJ1bmNhdGVzIHRleHQgdG8gZml0IHdpZHRoXG4gICAqL1xuICBwcml2YXRlIHN0YXRpYyB0cnVuY2F0ZVRleHQodGV4dDogc3RyaW5nLCBtYXhXaWR0aDogbnVtYmVyKTogc3RyaW5nIHtcbiAgICBpZiAodGV4dC5sZW5ndGggPD0gbWF4V2lkdGgpIHtcbiAgICAgIHJldHVybiB0ZXh0XG4gICAgfVxuICAgIHJldHVybiB0ZXh0LnN1YnN0cmluZygwLCBtYXhXaWR0aCAtIDMpICsgJy4uLidcbiAgfVxuXG4gIC8qKlxuICAgKiBNYWluIGVudHJ5IHBvaW50IC0gYW5hbHl6ZXMgY29udGVudCBhbmQgZ2VuZXJhdGVzIGFwcHJvcHJpYXRlIHZpc3VhbFxuICAgKi9cbiAgc3RhdGljIGdlbmVyYXRlT3B0aW1hbFZpc3VhbChjb250ZW50OiBzdHJpbmcsIHN1YmplY3Q/OiBzdHJpbmcpOiBWaXN1YWxSZXByZXNlbnRhdGlvbiB7XG4gICAgY29uc3Qgb3B0aW1hbFR5cGUgPSB0aGlzLmRldGVjdE9wdGltYWxWaXN1YWxUeXBlKGNvbnRlbnQsIHN1YmplY3QpXG4gICAgcmV0dXJuIHRoaXMuZ2VuZXJhdGVWaXN1YWwoY29udGVudCwgb3B0aW1hbFR5cGUsIHN1YmplY3QpXG4gIH1cblxuICAvKipcbiAgICogR2VuZXJhdGVzIG11bHRpcGxlIHZpc3VhbCBvcHRpb25zIGZvciB1c2VyIHRvIGNob29zZSBmcm9tXG4gICAqL1xuICBzdGF0aWMgZ2VuZXJhdGVWaXN1YWxPcHRpb25zKGNvbnRlbnQ6IHN0cmluZywgc3ViamVjdD86IHN0cmluZyk6IFZpc3VhbFJlcHJlc2VudGF0aW9uW10ge1xuICAgIGNvbnN0IHByaW1hcnlUeXBlID0gdGhpcy5kZXRlY3RPcHRpbWFsVmlzdWFsVHlwZShjb250ZW50LCBzdWJqZWN0KVxuICAgIGNvbnN0IG9wdGlvbnM6IFZpc3VhbFJlcHJlc2VudGF0aW9uW10gPSBbXG4gICAgICB0aGlzLmdlbmVyYXRlVmlzdWFsKGNvbnRlbnQsIHByaW1hcnlUeXBlLCBzdWJqZWN0KVxuICAgIF1cblxuICAgIC8vIEFkZCBhbHRlcm5hdGl2ZSB2aXN1YWxpemF0aW9uc1xuICAgIGNvbnN0IGFsdGVybmF0aXZlVHlwZXMgPSBbVmlzdWFsVHlwZS5DT05DRVBUX01BUCwgVmlzdWFsVHlwZS5GTE9XQ0hBUlQsIFZpc3VhbFR5cGUuRElBR1JBTV1cbiAgICBcbiAgICBmb3IgKGNvbnN0IHR5cGUgb2YgYWx0ZXJuYXRpdmVUeXBlcykge1xuICAgICAgaWYgKHR5cGUgIT09IHByaW1hcnlUeXBlICYmIG9wdGlvbnMubGVuZ3RoIDwgMykge1xuICAgICAgICBvcHRpb25zLnB1c2godGhpcy5nZW5lcmF0ZVZpc3VhbChjb250ZW50LCB0eXBlLCBzdWJqZWN0KSlcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gb3B0aW9uc1xuICB9XG59Il0sIm5hbWVzIjpbIlZpc3VhbFR5cGUiLCJWaXN1YWxMZWFybmluZ0VuZ2luZSIsImdlbmVyYXRlVmlzdWFsIiwiY29udGVudCIsInR5cGUiLCJzdWJqZWN0IiwiZ2VuZXJhdGVDb25jZXB0TWFwIiwiZ2VuZXJhdGVGbG93Y2hhcnQiLCJnZW5lcmF0ZUhpZXJhcmNoeSIsImdlbmVyYXRlVGltZWxpbmUiLCJnZW5lcmF0ZUZvcm11bGFWaXN1YWxpemF0aW9uIiwiZ2VuZXJhdGVDaGVtaWNhbFN0cnVjdHVyZSIsImdlbmVyYXRlUHJvY2Vzc0Zsb3ciLCJnZW5lcmF0ZUdlbmVyaWNEaWFncmFtIiwiZGV0ZWN0T3B0aW1hbFZpc3VhbFR5cGUiLCJjb250ZW50TG93ZXIiLCJ0b0xvd2VyQ2FzZSIsInRlc3QiLCJjb25jZXB0cyIsImV4dHJhY3RDb25jZXB0cyIsIm1haW5Db25jZXB0IiwicmVsYXRlZENvbmNlcHRzIiwic2xpY2UiLCJhc2NpaSIsImNlbnRlclRleHQiLCJmb3JFYWNoIiwiY29uY2VwdCIsImluZGV4IiwibGVuZ3RoIiwiZGVzY3JpcHRpb24iLCJlbGVtZW50cyIsIm1hcCIsImlkIiwidGl0bGUiLCJjb25uZWN0aW9ucyIsImluc3RydWN0aW9ucyIsInN0ZXBzIiwiZXh0cmFjdFN0ZXBzIiwic3RlcCIsInN0ZXBUZXh0IiwidHJ1bmNhdGVUZXh0IiwiaGllcmFyY2h5SXRlbXMiLCJleHRyYWN0SGllcmFyY2h5Iiwicm9vdCIsImNoaWxkcmVuIiwiZ3JhbmRjaGlsZHJlbiIsImNoaWxkIiwic3BhY2luZyIsIml0ZW0iLCJ0aW1lRXZlbnRzIiwiZXh0cmFjdFRpbWVsaW5lRXZlbnRzIiwiZXZlbnQiLCJldmVudFRleHQiLCJ0aW1lVGV4dCIsInRpbWUiLCJmb3JtdWxhIiwiZXh0cmFjdEZvcm11bGEiLCJ2YXJpYWJsZXMiLCJleHRyYWN0VmFyaWFibGVzIiwidmFyaWFibGUiLCJzeW1ib2wiLCJfIiwiY29uY2F0IiwibW9sZWN1bGUiLCJleHRyYWN0TW9sZWN1bGUiLCJhdG9tcyIsImV4dHJhY3RBdG9tcyIsImluY2x1ZGVzIiwiYXRvbSIsImpvaW4iLCJwcm9jZXNzZXMiLCJleHRyYWN0UHJvY2Vzc2VzIiwicHJvY2VzcyIsInByb2Nlc3NUZXh0Iiwia2V5UG9pbnRzIiwiZXh0cmFjdEtleVBvaW50cyIsInBvaW50IiwicG9pbnRUZXh0IiwibGVmdEFsaWduIiwic2VudGVuY2VzIiwic3BsaXQiLCJzZW50ZW5jZSIsIndvcmRzIiwidHJpbSIsImltcG9ydGFudFdvcmRzIiwiZmlsdGVyIiwid29yZCIsInB1c2giLCJzdGVwUGF0dGVybnMiLCJwYXR0ZXJuIiwibWF0Y2giLCJleGVjIiwicyIsImhpZXJhcmNoeVdvcmRzIiwiaXRlbXMiLCJjbGVhblNlbnRlbmNlIiwicmVwbGFjZSIsInRpbWVQYXR0ZXJuIiwiZXZlbnRzIiwidGltZU1hdGNoIiwia2V5RXZlbnRzIiwiZm9ybXVsYVBhdHRlcm5zIiwicGFydHMiLCJ2YXJQYXR0ZXJuIiwibW9sZWN1bGVQYXR0ZXJucyIsImF0b21TeW1ib2xzIiwidW5pcXVlQXRvbXMiLCJTZXQiLCJsaW1pdCIsInRleHQiLCJ3aWR0aCIsInRydW5jYXRlZCIsInBhZGRpbmciLCJNYXRoIiwibWF4IiwibGVmdFBhZCIsImZsb29yIiwicmlnaHRQYWQiLCJyZXBlYXQiLCJtYXhXaWR0aCIsInN1YnN0cmluZyIsImdlbmVyYXRlT3B0aW1hbFZpc3VhbCIsIm9wdGltYWxUeXBlIiwiZ2VuZXJhdGVWaXN1YWxPcHRpb25zIiwicHJpbWFyeVR5cGUiLCJvcHRpb25zIiwiYWx0ZXJuYXRpdmVUeXBlcyJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/visual-learning-engine.ts\n");

/***/ }),

/***/ "(ssr)/./node_modules/next/dist/build/webpack/loaders/next-flight-client-entry-loader.js?server=true!":
/*!******************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-flight-client-entry-loader.js?server=true! ***!
  \******************************************************************************************************/
/***/ (() => {



/***/ }),

/***/ "../app-render/after-task-async-storage.external":
/*!***********************************************************************************!*\
  !*** external "next/dist/server/app-render/after-task-async-storage.external.js" ***!
  \***********************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/server/app-render/after-task-async-storage.external.js");

/***/ }),

/***/ "../app-render/work-async-storage.external":
/*!*****************************************************************************!*\
  !*** external "next/dist/server/app-render/work-async-storage.external.js" ***!
  \*****************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/server/app-render/work-async-storage.external.js");

/***/ }),

/***/ "./work-unit-async-storage.external":
/*!**********************************************************************************!*\
  !*** external "next/dist/server/app-render/work-unit-async-storage.external.js" ***!
  \**********************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/server/app-render/work-unit-async-storage.external.js");

/***/ }),

/***/ "@xenova/transformers":
/*!***************************************!*\
  !*** external "@xenova/transformers" ***!
  \***************************************/
/***/ ((module) => {

"use strict";
module.exports = import("@xenova/transformers");;

/***/ }),

/***/ "assert":
/*!*************************!*\
  !*** external "assert" ***!
  \*************************/
/***/ ((module) => {

"use strict";
module.exports = require("assert");

/***/ }),

/***/ "buffer":
/*!*************************!*\
  !*** external "buffer" ***!
  \*************************/
/***/ ((module) => {

"use strict";
module.exports = require("buffer");

/***/ }),

/***/ "crypto":
/*!*************************!*\
  !*** external "crypto" ***!
  \*************************/
/***/ ((module) => {

"use strict";
module.exports = require("crypto");

/***/ }),

/***/ "events":
/*!*************************!*\
  !*** external "events" ***!
  \*************************/
/***/ ((module) => {

"use strict";
module.exports = require("events");

/***/ }),

/***/ "http":
/*!***********************!*\
  !*** external "http" ***!
  \***********************/
/***/ ((module) => {

"use strict";
module.exports = require("http");

/***/ }),

/***/ "https":
/*!************************!*\
  !*** external "https" ***!
  \************************/
/***/ ((module) => {

"use strict";
module.exports = require("https");

/***/ }),

/***/ "next/dist/compiled/next-server/app-page.runtime.dev.js":
/*!*************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-page.runtime.dev.js" ***!
  \*************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/compiled/next-server/app-page.runtime.dev.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "querystring":
/*!******************************!*\
  !*** external "querystring" ***!
  \******************************/
/***/ ((module) => {

"use strict";
module.exports = require("querystring");

/***/ }),

/***/ "url":
/*!**********************!*\
  !*** external "url" ***!
  \**********************/
/***/ ((module) => {

"use strict";
module.exports = require("url");

/***/ }),

/***/ "util":
/*!***********************!*\
  !*** external "util" ***!
  \***********************/
/***/ ((module) => {

"use strict";
module.exports = require("util");

/***/ }),

/***/ "zlib":
/*!***********************!*\
  !*** external "zlib" ***!
  \***********************/
/***/ ((module) => {

"use strict";
module.exports = require("zlib");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next","vendor-chunks/jose","vendor-chunks/next-auth","vendor-chunks/openid-client","vendor-chunks/bcryptjs","vendor-chunks/@babel","vendor-chunks/oauth","vendor-chunks/preact","vendor-chunks/uuid","vendor-chunks/yallist","vendor-chunks/preact-render-to-string","vendor-chunks/cookie","vendor-chunks/oidc-token-hash","vendor-chunks/@panva"], () => (__webpack_exec__("(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader/index.js?name=app%2Fapi%2Fdebug-sara-memory%2Froute&page=%2Fapi%2Fdebug-sara-memory%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fdebug-sara-memory%2Froute.ts&appDir=%2FUsers%2Frodrigodibernardo33gmail.com%2FDocuments%2FApp%20Development%20Proyects%2FIntellego%20Platform%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Frodrigodibernardo33gmail.com%2FDocuments%2FApp%20Development%20Proyects%2FIntellego%20Platform&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();